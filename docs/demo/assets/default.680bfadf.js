var ye=Object.defineProperty;var we=(e,t,n)=>t in e?ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var b=(e,t,n)=>(we(e,typeof t!="symbol"?t+"":t,n),n);import{r as x,S as ne,m as oe,o as U,b as N,d as re,e as be,E as Pe,T as Ae,F as W,j as f,f as M,a as k,V as I,g as se,L as D,h as ie,i as Ie,B as Te,k as J,M as Ce,D as Ee,l as ae,n as ue,q as Me,s as ke,t as G,C as Se,v as Le,w as L,p as V,P as Fe,x as Re,y as Ue,z as Ve,O as ze,W as Be,A as H,G as K}from"./vendor.d3e0753c.js";const Ne=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}};Ne();const O=window.requestAnimationFrame||(e=>setTimeout(e,16)),De=window.cancelAnimationFrame||clearTimeout;function ce(e,t=0){t<=0?O(e):O(()=>ce(e,t-1))}function Q(e,t=60){let n=-1,r=0,o=-1;const i=1e3/t;function u(a){o===-1&&(o=a),n=O(u),!(a-r<i)&&(r=a,e&&e(a-o))}return n=O(u),function(){De(n)}}class Oe extends ne{constructor(){super();b(this,"$five");b(this,"configs");b(this,"videoAgentScene");b(this,"vreoUnit");b(this,"stopInterval");b(this,"playing",!1);b(this,"visible",!1);b(this,"popUp",null);b(this,"drawerConfig",null);oe(this,{visible:U,setVisible:N,playing:U,setPlaying:N,popUp:U.ref,openPopUp:N,drawerConfig:U.ref,openDrawer:N}),re(()=>this.playing,t=>{this.emit(t?"playing":"paused")})}get isAudio(){var t,n;return!((n=(t=this.videoAgentScene)==null?void 0:t.videoAgentMesh.videoUrl)==null?void 0:n.endsWith(".mp4"))}openPopUp(t){if(!t){this.popUp=null;return}this.popUp=t}setVisible(t){this.visible=t}setPlaying(t){this.playing=t}openDrawer(t){var n;if(!t){this.drawerConfig={content:"",height:(n=this.drawerConfig)==null?void 0:n.height};return}this.drawerConfig=t}get ready(){return!!this.videoAgentScene}get currentTime(){var t;return((t=this.videoAgentScene)==null?void 0:t.videoAgentMesh.currentTime)||0}get currentKeyframes(){return this.vreoUnit?this.vreoUnit.keyframes.filter(n=>{if(n.parsed)return!1;const r=this.currentTime-n.start;return r<=100&&r>=0}):[]}get videoInstance(){var t;return(t=this.videoAgentScene)==null?void 0:t.videoAgentMesh.videoInstance}requestAnimationFrameLoop(t){var r,o,i,u;if((r=this.videoInstance)==null?void 0:r.ended){this.setPlaying(!1),this.videoInstance.pause();return}if(!this.playing){((o=this.videoInstance)==null?void 0:o.paused)||(i=this.videoInstance)==null||i.pause();return}((u=this.videoInstance)==null?void 0:u.paused)&&this.playing&&this.videoInstance.play(),this.currentKeyframes.forEach(a=>{a.parsed||(a.parsed=!0,this.emit(a.type,a),t&&t(a.type,a))})}run(t){this.stopInterval||(this.stopInterval=Q(()=>this.requestAnimationFrameLoop(t)))}dispose(){this.setPlaying(!1),this.currentKeyframes&&this.currentKeyframes.forEach(t=>t.parsed=!1),this.vreoUnit=void 0,this.videoInstance&&(this.videoInstance.currentTime=0),this.stopInterval&&(this.stopInterval(),this.stopInterval=void 0)}}const le=x.exports.createContext(null);function C(){const e=be.useContext(le);if(!e)throw new Error('\u6CA1\u6709\u627E\u5230 "ControllerContext"');return e}function F(){const e=C();if(!e.$five)throw new Error('\u6CA1\u6709\u627E\u5230 "five" \u5B9E\u4F8B');return e.$five}function X(){const e=F();return t=>e.project2d(t,!1)}var j;(function(e){e.Move="Move",e.Rotate="Rotate"})(j||(j={}));var S;(function(e){e.Clockwise="Clockwise",e.Anticlockwise="Anticlockwise",e.Loop="Loop"})(S||(S={}));const de=Pe;function je(e,t,n,r=de.Linear.None){const o=new Ae(e).to(t,n).easing(r);ce(()=>o.start(0));const i=Q(a=>{o.update(a)===!1&&i()}),u=[];return o.onDestroy=a=>(u.push(a),o),o.destroy=function(){this.stop(),Object.assign(o,{_onStartCallback:null,_onUpdateCallback:null,_onCompleteCallback:null,_onStopCallbackL:null});let a;for(;a=u.shift();)a();i()},o}function $e(e,t){return je({progress:0},{progress:1},e,t)}const $=Math.PI*2;function fe(e){return e%$}function pe(e){return(e%$+$)%$}const Y=(e,t,n)=>{const r=Math.PI,o=r*2;return e=pe(e),t=pe(t),n===S.Anticlockwise&&e<t&&(e+=o),n===S.Clockwise&&t<e&&(t+=o),n===S.Loop&&t-e>r?Y(e,t,S.Anticlockwise):n===S.Loop&&e-t>r?Y(e,t,S.Clockwise):{from:e,to:t}};function Z(e,t,n){return e+(t-e)*n}const qe=e=>{const t=(o,i,u={preload:!0})=>new Promise(async(a,d)=>{if(u.asyncStartCallback&&u.asyncStartCallback(),e.panoIndex===void 0)return d(!1);if(o.mode&&o.mode!==e.currentMode&&await new Promise(p=>{!o.mode||(e.once("modeChange",s=>{e.once("initAnimationEnded",()=>{s===o.mode&&p(!0)})}),e.changeMode(o.mode,{fov:o.fov||void 0,latitude:o.latitude||void 0,longitude:o.longitude||void 0,panoIndex:o.panoIndex||void 0}))}),o.mode===W.Mode.Floorplan||(u.preload&&o.panoIndex!==void 0&&o.panoIndex!==e.panoIndex&&await e.preloadPano(o.panoIndex),u.asyncEndCallback&&u.asyncEndCallback(),o.panoIndex===void 0&&o.fov===void 0&&o.latitude===void 0&&o.longitude===void 0))return a(!0);const l=o.panoIndex!==void 0?o.panoIndex:e.panoIndex;if(l!==void 0){const p=Object.assign(o,{duration:i,moveEndCallback:()=>a(!0),moveCancelCallback:()=>{a(!0)}});await e.moveToPano(l,p)}else d(!1)}),n=o=>{const i=e.state,u=fe(i.latitude),a=fe(o.latitude),{from:d,to:l}=Y(i.longitude,o.longitude,o.rotation||S.Loop),p=i.fov,s=o.fov;return{from:{latitude:u,longitude:d,fov:p},to:{latitude:a,longitude:l,fov:s}}};return{move:t,rotate:async(o,i,u={})=>{u.asyncStartCallback&&u.asyncStartCallback(),o.mode&&e.currentMode!==o.mode&&await e.changeMode(o.mode),o.mode===W.Mode.Panorama&&e.currentMode===W.Mode.Panorama&&o.panoIndex!==void 0&&o.panoIndex!==e.panoIndex&&(u.preload&&await e.preloadPano(o.panoIndex),await new Promise((l,p)=>{e.moveToPano(o.panoIndex,{moveEndCallback:()=>l(!0),moveCancelCallback:()=>p(!1),effect:"fade"})})),u.asyncEndCallback&&u.asyncEndCallback();const{from:a,to:d}=n(o);return await new Promise((l,p)=>{const s=({progress:m})=>{const w={};w.longitude=Z(a.longitude,d.longitude,m),w.latitude=Z(a.latitude,d.latitude,m),w.fov=Z(a.fov,d.fov,m),e.setState(w,!0)},c=()=>{l(!0)},g=()=>{l(!1)},h=o.rotateSpeed?Math.ceil(Math.abs(d.longitude-a.longitude)/o.rotateSpeed*1e3):i,v=$e(h,de.Linear.None).onUpdate(s).onComplete(c).onDestroy(g);o.rotation===S.Loop&&v.repeat(1/0).yoyo(!0),setTimeout(()=>{v.destroy(),l(!0)},i)})}}};var P;(function(e){e.CameraMovement="CameraMovement",e.PanoTag="PanoTag",e.PanoTextLabel="PanoTextLabel",e.Prompter="Prompter",e.UpdateVRPanorama="UpdateVRPanorama",e.ModelVideo="ModelVideo",e.PanoEffect="PanoEffect",e.InfoPanel="InfoPanel",e.VideoEffect="VideoEffect",e.BgMusic="BgMusic",e.Exit="Exit",e.Custom="Custom"})(P||(P={}));var z;(function(e){e.Text="Text",e.Image="Image"})(z||(z={}));var me;(function(e){e.Distance="Distance"})(me||(me={}));var R;(function(e){e.Image="Image",e.Video="Video"})(R||(R={}));var ee;(function(e){e.Drawer="Drawer",e.PopUp="PopUp"})(ee||(ee={}));function _e(){const e=C(),t=F(),n=x.exports.useRef();return x.exports.useEffect(()=>{const r=async o=>{n.current||(n.current=qe(t));const{start:i,end:u,data:a}=o,d=a,l=d.effect;l===j.Rotate?await n.current.rotate(a,u-i):l===j.Move?await n.current.move(a,u-i):d.panoIndex!==void 0&&d.panoIndex!==t.panoIndex?await n.current.move(a,u-i):await n.current.rotate(a,u-i)};return e.on(P.CameraMovement,r),()=>{e.off(P.CameraMovement,r)}},[e]),f(M,{})}function ve({url:e,children:t}){return k("div",{className:"vreo-infoPanel vreo-infoPanel--img",children:[t,f("div",{className:"vreo-infoPanelImg",style:{backgroundImage:`url(${e})`}})]})}function he({url:e,children:t}){return k("div",{className:"vreo-infoPanel vreo-infoPanel--video",children:[t,f("div",{className:"vreo-infoPanelWrapper",children:f("video",{playsInline:!0,autoPlay:!0,className:"vreo-infoPanelVideo",src:e})})]})}const q=e=>!e.title&&!e.subTitle?null:k("div",{className:"vreo-infoPanel-title",children:[f("div",{className:"vreo-infoPanel-t1",children:e.title}),f("div",{className:"vreo-infoPanel-t2",children:e.subTitle})]});function We(){const e=x.exports.useRef(),t=C();return x.exports.useEffect(()=>{var r;if(((r=t.configs)==null?void 0:r.keyframeMap.InfoPanel)===!1)return;const n=o=>{const{start:i,end:u,data:a}=o,d=a,{title:l,subTitle:p,style:s}=d;do{if(s===ee.PopUp){d.type===R.Image?t.openPopUp(f(ve,{url:d.url,children:f(q,{title:l,subTitle:p})})):d.type===R.Video&&t.openPopUp(f(he,{url:d.url,children:f(q,{title:l,subTitle:p})}));break}d.type===R.Image?t.openDrawer({content:f(ve,{url:d.url,children:f(q,{title:l,subTitle:p})}),height:"60vh"}):d.type===R.Video&&t.openDrawer({content:f(he,{url:d.url,children:f(q,{title:l,subTitle:p})}),height:"60vh"})}while(!1);e.current=setTimeout(()=>{t.openDrawer(!1),t.openPopUp(!1)},u-i)};return t.on(P.InfoPanel,n),()=>{t.off(P.InfoPanel,n),e.current&&clearTimeout(e.current)}},[t]),f(M,{})}const Je=(e,{videoElement:t})=>{const n={videoMeshes:[],videoTextureEnabled:!1,videoSource:"",rectPoints:[],enabled:!1,videoElement:t},r=s=>{n.videoTexture&&(n.videoTexture.image.muted=s,n.videoTexture.image.play())},o=()=>n.videoTexture?n.videoTexture.image.muted:!0,i=()=>{if(n.enabled||!n.videoTexture)return;n.enabled=!0,n.videoMeshes=a(),n.videoMeshes.forEach(c=>e.scene.add(c));const s=()=>{if(!n.videoTexture)return;const c=()=>{var g;!n.videoTexture||((g=n.videoTexture)==null||g.image.removeEventListener("timeupdate",c),n.videoTextureEnabled=!0,n.videoMeshes.forEach(h=>{h.material.map!==n.videoTexture&&(h.material.map=n.videoTexture)}),e.needsRender=!0)};n.videoTexture.image.addEventListener("timeupdate",c),n.videoTexture&&n.videoMeshes.length&&n.videoTexture.image.play()};if(e.model.loaded)s();else return e.once("modelLoaded",()=>s())},u=()=>{!n.enabled||(n.enabled=!1,n.videoMeshes.forEach(s=>{s.geometry.dispose(),s.material.dispose(),e.scene.remove(s),n.videoTexture&&n.videoTexture.image.pause()}),n.videoMeshes=[],e.needsRender=!0)},a=()=>n.rectPoints.map((s,c)=>{const g=new Te,h=128,v=[];v.push(s[0].x,s[0].y,s[0].z);for(let y=1;y<h;y++)v.push(s[0].x+(s[1].x-s[0].x)*y/h,s[0].y+(s[1].y-s[0].y)*y/h,s[0].z+(s[1].z-s[0].z)*y/h);v.push(s[1].x,s[1].y,s[1].z),v.push(s[2].x,s[2].y,s[2].z);for(let y=1;y<h;y++)v.push(s[2].x+(s[3].x-s[2].x)*y/h,s[2].y+(s[3].y-s[2].y)*y/h,s[2].z+(s[3].z-s[2].z)*y/h);v.push(s[3].x,s[3].y,s[3].z);const m=[];m.push(0,1);for(let y=1;y<h;y++)m.push(0,1-y/h);m.push(0,0),m.push(1,0);for(let y=1;y<h;y++)m.push(1,y/h);m.push(1,1);const w=[];for(let y=0;y<h;y++)w.push(y,y+1,h*2-y,y,h*2-y,h*2+1-y);g.setAttribute("position",new J(new Float32Array(v),3)),g.setAttribute("uv",new J(new Float32Array(m),2)),g.setIndex(new J(new Uint32Array(w),1));const T=new Ce({map:n.videoTextureEnabled?n.videoTexture:n.imageTexture,side:Ee}),A=new ae(g,T);return A.renderOrder=1,A.name=`video-${c}-${performance.now()}`,A}),d=s=>{const c=new ue().load(s);return c.minFilter=D,c.magFilter=D,c.format=ie,c},l=(s,c)=>new Promise((g,h)=>{const v=new XMLHttpRequest;v.onreadystatechange=()=>{if(v.readyState==4)if(v.status==200){const m=window.URL||window.webkitURL;c=c||document.createElement("video"),c.crossOrigin="anonymous",c.autoplay=!0,c.muted=!0,c.loop=!0,c.playsInline=!0,c.src=m.createObjectURL(v.response);const w=new se(c);w.minFilter=D,w.magFilter=D,w.format=ie,g(Object.assign(w,{videoSource:s}))}else h(new Error("Video download Error: "+v.status))},v.onerror=m=>h(m),v.open("GET",s),v.responseType="blob",v.send()}),p=async(s,c)=>{const{video_src:g,video_poster_src:h,points:v}=s;n.videoSource=g,n.rectPoints=v.map(m=>m.map(({x:w,y:T,z:A})=>new I(w,T,A))),n.imageTexture=d(h),c&&(n.videoElement=c),n.videoTexture=await l(n.videoSource,n.videoElement),n.enabled=!!s.enable,n.enabled&&i()};return e.on("modeChange",()=>r(!0)),e.on("wantsTapGesture",s=>{if(!n.enabled)return;const[c]=s.intersectObjects(e.scene.children,!0);if(!!c&&/^video/.test(c.object.name))return n.videoTexture&&r(!n.videoTexture.image.muted),!1}),e.on("panoArrived",()=>{if(!n.enabled||o())return;const s=e.camera.position;n.rectPoints.find(g=>{const h=g.reduce((v,m)=>new I(v.x+m.x/g.length,v.y+m.y/g.length,v.z+m.z/g.length),new I);return g.map(v=>new I((v.x+h.x)/2,(v.y+h.y)/2,(v.z+h.z)/2)).filter(v=>{v=v.clone().sub(s).normalize();const m=new Ie(s,v),[w]=m.intersectObjects(e.scene.children,!0);return!!w&&/^video/.test(w.object.name)}).length>=2})||r(!0)}),e.on("renderFrame",()=>{n.videoMeshes.forEach(s=>{s&&(s.needsRender=!0)})}),e.on("load",s=>{s.modelTVVideoData&&p(s.modelTVVideoData)}),{enable:i,disable:u,load:p}};function Ge(e){const t=new Me;return t.fromArray(e),n=>{const r=new I(...n);return r.applyMatrix4(t),r.toArray()}}function He(){const e=C(),t=F(),n=x.exports.useRef(),r=x.exports.useRef();return x.exports.useEffect(()=>{const o=async i=>{var h,v;n.current||(n.current=Je(t,{}));const{start:u,end:a}=i,{videoSrc:d,videoPosterSrc:l,vertexs:p,matrixWorld:s}=i.data,c=(()=>{if(p.length<4)throw new Error("ModelVideo: \u9876\u70B9\u6570\u636E\u96C6\u5408\u4E0D\u591F\uFF0C\u65E0\u6CD5\u7EC4\u6210\u77E9\u5F62 ....");if(p.length===4)return p;const m=new ke;return p.forEach(w=>m.expandByPoint(new I(w.x,w.y,w.z))),[new I(m.min.x,m.max.y,m.max.z),new I(m.min.x,m.min.y,m.max.z),new I(m.max.x,m.min.y,m.max.z),new I(m.max.x,m.max.y,m.max.z)]})(),g=(()=>{if(s){const m=Ge(s);return[c.map(w=>{const T=m([w.x,w.y,w.z]);return{x:T[0],y:T[1],z:T[2]}})]}return[c]})();n.current.disable(),await n.current.load({video_src:d,video_poster_src:l,points:g},(v=(h=e.configs)==null?void 0:h.videos)==null?void 0:v.modelTVVideo),n.current.enable(),r.current=setTimeout(()=>{var m;return(m=n.current)==null?void 0:m.disable()},a-u)};return e.on(P.ModelVideo,o),()=>{e.off(P.ModelVideo,o),r.current&&clearTimeout(r.current)}},[e]),f(M,{})}class Ke extends G.Tween{constructor(){super(...arguments);b(this,"disposeMethods",[]);b(this,"animationFrameDisposer");b(this,"onDispose",t=>(this.disposeMethods.push(t),this));b(this,"play",()=>(this.start(),this.animationFrameDisposer=Q(()=>this.update()),this));b(this,"dispose",()=>{var t;this.stop(),(t=this.animationFrameDisposer)==null||t.call(this),this.disposeMethods.forEach(n=>n()),this.disposeMethods=[],G.remove(this)})}}function Qe(e,t=G.Easing.Linear.None){const n=new Ke({progress:0}).to({progress:1});return e!==void 0&&n.duration(e),t!==void 0&&n.easing(t),n}function Xe(e,t,n){const r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAIVBMVEUAAAD////////////////////////////////////////PIev5AAAACnRSTlMAG/Py2baba05un7UgfgAAAHJJREFUKM9joBpgLHVSCRdA4metAoJlCJHmVWBgAeNzroKCCVCBLpjACqgJVjCBxRBT2FbBQQJYQAohsBAsUIUQWA4WiEIILAULeCEEloAFtBACizAEMLRgGIphLabDMJ2O6TlM72MGECIIMQIZIxqoBQCPvpJ/e9FaAAAAAABJRU5ErkJggg==",o=new ue().load(r),i=new Se(16777215),u=new Le;u.setMaterial({linewidth:2,color:i});const a=u.points.material;return a.map=o,a.color.set(i),u.line.material.depthTest=!1,Qe().onUpdate(({progress:d})=>{const l=.5-d/2,p=.5+d/2,s=t.clone().lerp(n,l),c=t.clone().lerp(n,p);u.setPoints(s,c)}).onStart(()=>e.scene.add(u)).onDispose(()=>{e.scene.remove(u),e.needsRender=!0})}function Ye(){const[e,t]=x.exports.useState(null),n=F(),r=x.exports.useRef(null),[o,i]=x.exports.useState(null),u=x.exports.useRef(),a=C(),d=X(),l=()=>{r.current&&r.current.dispose()};return x.exports.useEffect(()=>{const p=s=>{const{start:c,end:g,data:h}=s,v=h,[m,w]=v.twoVertexs,T=new I(m.x,m.y,m.z),A=new I(w.x,w.y,w.z);r.current=Xe(n,T.clone(),A.clone()),r.current.play();const y=T.lerp(A,.5),_=T.distanceTo(A),B=d(y);if(!B)return;const{x:xe,y:ge}=B;t({center:y,distance:_}),i({left:xe,top:ge}),u.current=setTimeout(()=>{t(null),i(null),l()},g-c)};return a.on(P.PanoEffect,p),()=>{a.off(P.PanoEffect,p),u.current&&clearTimeout(u.current),l()}},[a]),x.exports.useEffect(()=>{const p=()=>{if(!(e==null?void 0:e.center))return;const{x:s,y:c,z:g}=e.center,h=d(new I(s,c,g));if(!h)return;const{x:v,y:m}=h;i({left:v,top:m})};return n.on("currentStateChange",p),()=>{n.off("currentStateChange",p)}},[e==null?void 0:e.center]),f(M,{children:f("div",{className:L("PanoEffect",{"PanoEffect--notHidden":e}),style:{left:((o==null?void 0:o.left)||0)+"px",top:((o==null?void 0:o.top)||0)+"px"},children:(e==null?void 0:e.distance.toFixed(4))+"m"})})}function Ze(){const[e,t]=x.exports.useState(null),[n,r]=x.exports.useState(null),o=x.exports.useRef(),i=C(),u=F(),a=X();x.exports.useEffect(()=>{var p;if(((p=i.configs)==null?void 0:p.keyframeMap.PanoTag)===!1)return;const l=s=>{const{start:c,end:g,data:h}=s,v=h,m=v.vertex,{x:w,y:T,z:A}=v.vertex,y=a(new I(w,T,A));if(!y)return;const{x:_,y:B}=y;t({vertex:m,text:v.text||z.Text,type:v.type,imgUrl:v.imgUrl}),r({left:_,top:B}),o.current=setTimeout(()=>{t(null),r(null)},g-c)};return i.on(P.PanoTag,l),()=>{i.off(P.PanoTag,l),o.current&&clearTimeout(o.current)}},[i]),x.exports.useEffect(()=>{const l=()=>{if(!(e==null?void 0:e.vertex))return;const{x:p,y:s,z:c}=e.vertex,g=a(new I(p,s,c));if(!g)return;const{x:h,y:v}=g;r({left:h,top:v})};return u.on("currentStateChange",l),()=>{u.off("currentStateChange",l)}},[e==null?void 0:e.vertex]);const d=(()=>{if(!!e){if(e.type===z.Text)return f(M,{children:f("span",{children:e.text})});if(e.type===z.Image)return k(M,{children:[f("img",{className:"PanoTag-img",src:e.imgUrl,alt:e.text||""}),f("span",{className:"PanoTag-txt",children:e.text})]})}})();return f(M,{children:k("div",{className:L("PanoTag",{"PanoTag--notHidden":e}),style:{left:((n==null?void 0:n.left)||0)+"px",top:((n==null?void 0:n.top)||0)+"px"},children:[f("div",{className:"PanoTag-point"}),k("div",{className:"PanoTag-content",children:[k("span",{className:"PanoTag-linewrap",children:[f("span",{className:"PanoTag-slashline"}),f("span",{className:"PanoTag-straightline"})]}),f("div",{onClick:()=>{e==null?void 0:e.imgUrl},className:"PanoTag-box PanoTag-box--"+((e==null?void 0:e.type)||""),children:d})]})]})})}function et(){const[e,t]=x.exports.useState(null),n=x.exports.useRef(),r=C(),o=X();return x.exports.useEffect(()=>{var u;if(((u=r.configs)==null?void 0:u.keyframeMap.PanoTextLabel)===!1)return;const i=a=>{const{start:d,end:l,data:p}=a,s=p,{x:c,y:g,z:h}=s.vertex,v=o(new I(c,g,h));if(!v)return;const{x:m,y:w}=v;t({left:m,top:w,text:p.text||"",fontSize:p.fontSize||16}),n.current=setTimeout(()=>t(null),l-d)};return r.on(P.PanoTextLabel,i),()=>{r.off(P.PanoTextLabel,i),n.current&&clearTimeout(n.current)}},[r]),f("div",{className:L("PanoTextLabel",{"PanoTextLabel--notHidden":e}),style:{left:((e==null?void 0:e.left)||0)+"px",top:((e==null?void 0:e.top)||0)+"px"},children:f("div",{className:"PanoTextLabel-wrapper",children:f("div",{style:{fontSize:`${(e==null?void 0:e.fontSize)||16}px`},className:"PanoText-innerText",children:(e==null?void 0:e.text)||""})})})}function tt(){const[e,t]=x.exports.useState(""),[n,r]=x.exports.useState(!0),o=x.exports.useRef(null),i=C();return x.exports.useEffect(()=>{var a;if(((a=i.configs)==null?void 0:a.keyframeMap.Prompter)===!1)return;const u=d=>{const{start:l,end:p,data:s}=d;t(s.text),r(!1),o.current&&(clearTimeout(o.current),o.current=null),o.current=setTimeout(()=>{r(!0),t(""),o.current&&clearTimeout(o.current),o.current=null},p-l)};return i.on(P.Prompter,u),()=>{i.off(P.Prompter,u)}},[i]),f("div",{className:L("vreo-prompter",{"vreo-prompter--hidden":n,"vreo-prompter--audio":i.isAudio}),children:f("div",{className:"vreo-prompter-text",children:f("div",{className:"vreo-prompter-innerText",children:e})})})}function nt(){const e=C(),t=F(),n=x.exports.useRef(null),r=x.exports.useRef(null),o=x.exports.useCallback(()=>{if(r.current=null,n.current){const a=V(n.current);t.load(a)}},[]),i=x.exports.useCallback(()=>{if(n.current){const a=V(n.current);Object.assign(window,{$rawWork:a}),t.load(a)}},[]),u=x.exports.useCallback(()=>{!r.current||t.load(r.current)},[]);return x.exports.useEffect(()=>{const a=d=>{var s;n.current||(n.current=t.work.raw.works);const l=d.data;if(l.work){r.current=V(l.work),t.load(r.current);return}const p=(s=t.work)==null?void 0:s.raw.works[0];if(l.dynamic_scene&&!l.panorama){const g=JSON.parse(p).panorama,h=l.dynamic_scene.images.index;g.list[h]=l.dynamic_scene.images,l.panorama=g,delete l.dynamic_scene}Object.assign(window,{$work1:JSON.parse(p),$work2:l,parseWork:V}),r.current=V([p,l]),t.load(r.current)};return e.on(P.UpdateVRPanorama,a),e.on(P.Exit,o),e.on("loaded",o),e.on("paused",i),e.on("playing",u),()=>{e.off(P.UpdateVRPanorama,a),e.off(P.Exit,o),e.off("loaded",o),e.off("paused",i),e.off("playing",u)}},[]),f(M,{})}const ot=e=>{if(!e)return;const t=()=>{e.removeEventListener("canplaythrough",t);try{e.play()}catch{}};e.addEventListener("canplaythrough",t),e.load()},rt=Math.PI,te=rt*2;function st(){const e=x.exports.useRef(null),t=x.exports.useRef(),n=C(),r=x.exports.useRef(),[o,i]=x.exports.useState(!1),u=F(),a=d=>{!t.current||(t.current.src=d)};return x.exports.useEffect(()=>{const d=async l=>{const{start:p,end:s}=l,{videoSrc:c,fov:g,direction:h,panoIndex:v,vector:m}=l.data,[w,T]=(()=>{if(m)return[m.longitude,m.latitude];if(!h)return[0,0];let A=-Math.atan2(h.x,-h.z);A=(A%te+te)%te;const y=-Math.asin(h.y/1);return[A,y]})();u.setState({fov:g,panoIndex:v,longitude:w,latitude:T},!0),a(c),ot(t.current),i(!0),r.current=setTimeout(()=>{var A,y;((A=t.current)==null?void 0:A.paused)||(y=t.current)==null||y.pause(),i(!1),a("")},s-p)};return n.on(P.VideoEffect,d),()=>{n.off(P.VideoEffect,d),r.current&&clearTimeout(r.current)}},[n]),x.exports.useEffect(()=>{var l,p;if(!e.current)return;const d=((p=(l=n.configs)==null?void 0:l.videos)==null?void 0:p.videoEffect)||document.createElement("video");d.setAttribute("playsinline","true"),d.setAttribute("webkit-playsinline","true"),d.setAttribute("autoplay","true"),d.setAttribute("key","VideoEffect-video"),d.setAttribute("class","VideoEffect-video"),t.current=d,e.current.append(t.current),document.addEventListener("WeixinJSBridgeReady",function(){var s;(s=t.current)==null||s.play()},!1),!!e.current},[]),f("div",{ref:e,className:L("VideoEffect",{"VideoEffect--visible":o})})}const it={blob:e=>{const t=()=>null;return new Promise((n,r)=>{const o=new XMLHttpRequest,i=()=>{o.ontimeout=t,o.onreadystatechange=t,o.onprogress=t,o.onabort=t};o.ontimeout=()=>{r(new Error("timeout")),i()},o.onreadystatechange=()=>{o.readyState===4&&(o.status===0&&!o.response||(o.status===200||o.status===0?(n(o.response),i()):(r(new Error("status:"+o.status)),i())))},o.open("GET",e,!0),o.responseType="blob",o.send(null)})}},at=`
varying vec2 vUv;
varying vec2 vColorUv;
varying vec2 vMaskUv;
void main(){
  vUv = uv;
  vColorUv = vec2(uv.x / 2.0, uv.y);
  vMaskUv = vec2(0.5 + uv.x / 2.0, uv.y);
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,ut=()=>`
uniform int enable;
uniform sampler2D map;
varying vec2 vUv;
varying vec2 vColorUv;
varying vec2 vMaskUv;

vec3 hsv2rgb(vec3 c) {
  const vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

vec3 rgb2hsv(vec3 c) {
  const vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
  vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
  vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

  float d = q.x - min(q.w, q.y);
  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + 0.001)), d / (q.x + 0.001), q.x);
}

void main(void) {
  vec3 color = texture2D(map, vUv).xyz;
  float amask = 1.0;

  float ref = color.r;
  if (ref < color.b) ref = color.b;
  amask = color.g - ref + 0.1;
  amask = smoothstep(0.1, 0.3, amask);
  amask = 1.0 - amask;

  vec3 target = rgb2hsv(vec3(0.0 / 255.0, 255.0 / 255.0, 0.0 / 255.0));
  vec3 hsv = rgb2hsv(color);
  float distance = abs(hsv.x - target.x);
  if (distance < 0.15) {
    hsv.y = 0.0;
  }
  color = hsv2rgb(hsv);

  gl_FragColor = vec4(color.rgb, amask * float(enable));
}
`,E={};class ct extends ae{constructor(t,n,r,o,i={}){if(!i.videoInstance)if(E.videoInstance)i.videoInstance=E.videoInstance;else{const c=document.createElement("video");c.style.opacity="0",c.style.display="none",document.body.append(c),i.videoInstance=c,E.videoInstance=c,c.playsInline=!0,c.controls=!1}const u=new Fe(t,n,r,o),a=new se(i.videoInstance),d=new Re({uniforms:{map:{value:a},enable:{value:0}},vertexShader:at,fragmentShader:ut(),transparent:!0});super(u,d);b(this,"options");b(this,"videoUrl");b(this,"freeze");b(this,"paused");b(this,"audioInstance");b(this,"$removeEventListener");if(this.options=i,this.freeze=!1,this.paused=!0,i.audioInstance)this.audioInstance=i.audioInstance;else if(E.audioInstance)this.audioInstance=E.audioInstance;else{const c=document.createElement("audio");c.crossOrigin="",c.muted=!1,c.setAttribute("playsinline","true"),c.setAttribute("webkit-playsinline","true"),c.setAttribute("autoplay","false"),c.setAttribute("style","display: none;"),document.body.appendChild(c),this.audioInstance=c,E.audioInstance=c}oe(this,{paused:U});const l=c=>Ue(()=>this.paused=c),p=()=>l(!0),s=()=>l(!1);this.videoInstance.addEventListener("pause",p),this.videoInstance.addEventListener("play",s),this.$removeEventListener=()=>{this.videoInstance.removeEventListener("pause",p),this.videoInstance.removeEventListener("play",s)}}get videoInstance(){var r;return((r=this.videoUrl)==null?void 0:r.endsWith("mp3"))?this.audioInstance:this.material.uniforms.map.value.image}async update(t){if(this.videoUrl===t)return;this.videoUrl=t,this.freeze=!0,await this.videoInstance.pause();const n=this.material.uniforms;this.videoInstance.muted=!0,this.videoInstance.src=await URL.createObjectURL(await it.blob(this.videoUrl)),this.videoInstance.setAttribute("data-src",this.videoUrl);const r=()=>{var o;this.videoInstance.currentTime!==0&&(this.freeze=!1,this.videoInstance.muted=!1,n.enable.value=((o=this.videoUrl)==null?void 0:o.endsWith(".mp4"))?1:0,this.videoInstance.removeEventListener("timeupdate",r,!1))};this.videoInstance.addEventListener("timeupdate",r,!1)}async play(t=""){return t=t||"",t?t===this.videoUrl?(this.videoInstance.currentTime=0,await this.videoInstance.play(),!0):(await this.update(t),this.videoInstance.pause(),await new Promise(n=>setTimeout(async()=>{this.videoInstance.currentTime=0,await this.videoInstance.play(),n(!0)},20))):(this.videoUrl?await this.videoInstance.play():console.warn("\u8B66\u544A\uFF1A\u89C6\u9891\u8D44\u6E90\u672A\u521D\u59CB\u5316\u3002"),!0)}get currentTime(){return this.videoInstance.currentTime*1e3}dispose(){this.$removeEventListener(),E.audioInstance&&(document.body.removeChild(E.audioInstance),E.audioInstance=void 0),E.videoInstance&&(document.body.removeChild(E.videoInstance),E.videoInstance=void 0)}}class lt{constructor(t,n=!0,r={}){b(this,"videoAgentMesh");b(this,"scene",new Ve);b(this,"camera",new ze(-240,240,135,-135));b(this,"renderer",new Be({alpha:!0}));b(this,"container");b(this,"run",()=>{var n;const t=this.renderer.domElement;!(this.videoAgentMesh.paused||this.videoAgentMesh.freeze)&&this.videoAgentMesh.currentTime>1e3&&this.renderer.render(this.scene,this.camera),((n=this.videoAgentMesh.videoUrl)==null?void 0:n.endsWith(".mp4"))?t.style.display!=="block"&&(t.style.display="block"):t.style.display!=="none"&&(t.style.display="none"),requestAnimationFrame(this.run)});b(this,"dispose",()=>{var t;(t=this.videoAgentMesh)==null||t.dispose()});this.container=t,this.camera.position.set(0,0,10),this.camera.lookAt(0,0,0);const o={width:t.offsetWidth,height:t.offsetHeight},i=this.renderer.domElement;i.classList.add("VideoAgent-canvas"),this.renderer.setSize(o.width*window.devicePixelRatio,o.height*window.devicePixelRatio),i.setAttribute("style",`width: ${o.width}px;height: ${o.height}px;`),this.videoAgentMesh=new ct(480,270,1,1,r),n&&(t.append(i),this.scene.add(this.videoAgentMesh),this.run())}}function dt(e){const t=x.exports.useRef(null),n=C();return x.exports.useEffect(()=>{if(!t.current)throw new Error("React \u6E32\u67D3\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5 ...");if(n.videoAgentScene){console.warn('"VideoAgentScene" \u91CD\u590D\u521D\u59CB\u5316\uFF0C\u5DF2\u88AB\u8FC7\u6EE4 ...');return}const r=new lt(t.current,!0,e.options||{});return n.videoAgentScene=r,()=>{var o;n.dispose(),(o=n.videoAgentScene)==null||o.dispose()}},[]),f("div",{className:"VideoAgent",onClick:()=>{!e.onClick||e.onClick()},ref:t,children:f("div",{className:"VideoAgent-play"})})}function ft(){const e=C(),t=x.exports.useRef(null),n=x.exports.useCallback(()=>{t.current&&(clearTimeout(t.current),t.current=null)},[]);return x.exports.useEffect(()=>{const r=new Audio;r.setAttribute("id","vreo-singleton-bgmusic"),r.style.display="none",r.setAttribute("playsinline","true"),r.loop=!0,document.body.append(r);const o=i=>{const{start:u,end:a}=i,{url:d}=i.data;r.src=d;const l=()=>{r.play()};r.addEventListener("canplaythrough",l),n();const p=()=>{r.pause(),r.currentTime=0,r.src="",n(),r.removeEventListener("canplaythrough",l)},s=a-u||5e3;t.current=setTimeout(()=>{p()},s),e.once("paused",()=>{p()})};return e.on(P.BgMusic,o),()=>{e.off(P.BgMusic,o),document.body.removeChild(r),n()}}),f(M,{})}const pt=H(({controller:e})=>{var t,n;return f("div",{className:L("vreo-panel",{"vreo-panel--hidden":!e.visible}),children:k("div",{className:"vreo-panel-inner",children:[f(dt,{onClick:()=>{e.isAudio||(e.playing?e.setPlaying(!1):e.setPlaying(!0))},options:((t=e.configs)==null?void 0:t.videoAgentMeshOptions)||{}}),f(tt,{}),(n=e.configs)==null?void 0:n.customPanelChildren]})})});function mt(){const e=C();return k(M,{children:[k(M,{children:[f(_e,{}),f(He,{}),f(nt,{}),f(st,{}),f(Ze,{}),f(et,{}),f(We,{}),f(Ye,{}),f(ft,{})]}),f(pt,{controller:e})]})}const vt=H(({controller:e})=>{var r;const t="400px",n=(()=>{var i;const o=(i=e.drawerConfig)==null?void 0:i.height;return o?typeof o=="number"?o+"px":o:"max-content"})();return f("div",{className:L("vreo-drawer",{"vreo-drawer-visible":e.drawerConfig&&e.drawerConfig.content}),onClick:()=>e.openDrawer(!1),children:f("div",{className:"vreo-drawer-inner",style:{height:n,maxHeight:t},children:((r=e.drawerConfig)==null?void 0:r.content)||""})})});function ht(){const e=C();return f(vt,{controller:e})}const xt=H(({controller:e})=>f("div",{className:L("vreo-PopUp",{"vreo-PopUp-visible":e.popUp}),onClick:()=>e.openPopUp(!1),children:f("div",{className:"vreo-PopUp-inner",children:e.popUp||""})}));function gt(){const e=C();return f(xt,{controller:e})}class bt extends ne{constructor(t,n={}){super();b(this,"$five");b(this,"controller");b(this,"configs");if(this.controller=new Oe,this.$five=this.controller.$five=t,!n.containter){const r=document.querySelector("#vreo-app")||document.createElement("div");K.exports.unmountComponentAtNode(r),r.setAttribute("id","vreo-app"),n.containter=r,document.body.append(r)}this.configs=Object.freeze(Object.assign({keyframeMap:{}},n)),this.controller.configs=this.configs,K.exports.render(k(le.Provider,{value:this.controller,children:[f(mt,{}),f(ht,{}),f(gt,{}),this.configs.customKeyframes&&this.configs.customKeyframes.map((r,o)=>f(r,{subscribe:{on:(i,u)=>this.on(i,u),once:(i,u)=>this.once(i,u),off:(i,u)=>this.off(i,u)},five:t},o))]}),n.containter),re(()=>this.controller.playing,r=>{this.emit(r?"playing":"paused")})}async load(t,n=0,r=!1,o=!1){var i,u,a,d;if(o&&(t=JSON.parse(JSON.stringify(t))),this.controller.visible||(this.controller.setVisible(!0),await new Promise(l=>{setTimeout(()=>l(!0),500)})),this.controller.stopInterval&&(this.controller.stopInterval(),this.controller.stopInterval=void 0),this.controller.vreoUnit=t,(i=this.controller.videoInstance)==null||i.pause(),this.$five.imageOptions.size&&((u=this.configs.imageOptions)==null?void 0:u.size)&&this.$five.imageOptions.size>this.configs.imageOptions.size&&(this.$five.imageOptions.size=this.configs.imageOptions.size),r||r===void 0&&this.configs.autoPreload){const l=t.keyframes.filter(s=>!(s.type!==P.CameraMovement||s.data.panoIndex===void 0)).reduce((s,c)=>{const g=c.data.panoIndex;return s[g]||(s[g]=!0),s},{}),p=Object.keys(l);for(let s=0;s<p.length;s++)await this.$five.preloadPano(Number(p[s]))}return this.emit("loaded",t),this.controller.emit("loaded",t),t.video.url&&(((a=this.controller.videoAgentScene)==null?void 0:a.videoAgentMesh.videoInstance)&&(this.controller.videoAgentScene.videoAgentMesh.videoInstance.currentTime=n/1e3),await((d=this.controller.videoAgentScene)==null?void 0:d.videoAgentMesh.play(t.video.url)),this.play()),this.controller.run((l,p)=>this.emit(l,p)),!0}get paused(){return!this.controller.playing}play(){return this.controller.playing||this.controller.setPlaying(!0),!0}pause(){this.controller.setPlaying(!1)}show(){this.controller.setVisible(!0)}hide(){this.controller.setVisible(!1)}dispose(){this.pause(),this.controller.dispose(),this.configs.containter&&K.exports.unmountComponentAtNode(this.configs.containter)}}console.log(`

\u250F\u2501\u2501\u2501\u2513\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u250F\u2513\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u2503\u250F\u2501\u2513\u2503\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2503\u2503\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u2503\u2517\u2501\u251B\u2503\u250F\u2501\u2501\u2513\u250F\u2501\u2501\u2513\u2501\u2503\u2503\u2501\u250F\u2501\u2501\u2513\u250F\u2501\u2501\u2513\u250F\u2501\u2501\u2513
\u2503\u250F\u2513\u250F\u251B\u2503\u250F\u2513\u2503\u2517\u2501\u2513\u2503\u2501\u2503\u2503\u2501\u2503\u2501\u2501\u252B\u2503\u250F\u2513\u2503\u2503\u250F\u2513\u2503
\u2503\u2503\u2503\u2517\u2513\u2503\u2503\u2501\u252B\u2503\u2517\u251B\u2517\u2513\u2503\u2517\u2513\u2523\u2501\u2501\u2503\u2503\u2503\u2501\u252B\u2503\u2503\u2501\u252B
\u2517\u251B\u2517\u2501\u251B\u2517\u2501\u2501\u251B\u2517\u2501\u2501\u2501\u251B\u2517\u2501\u251B\u2517\u2501\u2501\u251B\u2517\u2501\u2501\u251B\u2517\u2501\u2501\u251B
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 

`);export{bt as P,P as V};
