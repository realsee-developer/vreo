(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production_min;function requireReact_production_min(){if(hasRequiredReact_production_min)return react_production_min;hasRequiredReact_production_min=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),m=Symbol.iterator;function y(j){return j===null||typeof j!="object"?null:(j=m&&j[m]||j["@@iterator"],typeof j=="function"?j:null)}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,b={};function T(j,re,pe){this.props=j,this.context=re,this.refs=b,this.updater=pe||A}T.prototype.isReactComponent={},T.prototype.setState=function(j,re){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,re,"setState")},T.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function _(){}_.prototype=T.prototype;function S(j,re,pe){this.props=j,this.context=re,this.refs=b,this.updater=pe||A}var C=S.prototype=new _;C.constructor=S,M(C,T.prototype),C.isPureReactComponent=!0;var P=Array.isArray,F=Object.prototype.hasOwnProperty,O={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function V(j,re,pe){var ge,_e={},he=null,Fe=null;if(re!=null)for(ge in re.ref!==void 0&&(Fe=re.ref),re.key!==void 0&&(he=""+re.key),re)F.call(re,ge)&&!N.hasOwnProperty(ge)&&(_e[ge]=re[ge]);var Re=arguments.length-2;if(Re===1)_e.children=pe;else if(1<Re){for(var Le=Array(Re),Se=0;Se<Re;Se++)Le[Se]=arguments[Se+2];_e.children=Le}if(j&&j.defaultProps)for(ge in Re=j.defaultProps,Re)_e[ge]===void 0&&(_e[ge]=Re[ge]);return{$$typeof:e,type:j,key:he,ref:Fe,props:_e,_owner:O.current}}function q(j,re){return{$$typeof:e,type:j.type,key:re,ref:j.ref,props:j.props,_owner:j._owner}}function Q(j){return typeof j=="object"&&j!==null&&j.$$typeof===e}function z(j){var re={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(pe){return re[pe]})}var H=/\/+/g;function W(j,re){return typeof j=="object"&&j!==null&&j.key!=null?z(""+j.key):re.toString(36)}function J(j,re,pe,ge,_e){var he=typeof j;(he==="undefined"||he==="boolean")&&(j=null);var Fe=!1;if(j===null)Fe=!0;else switch(he){case"string":case"number":Fe=!0;break;case"object":switch(j.$$typeof){case e:case t:Fe=!0}}if(Fe)return Fe=j,_e=_e(Fe),j=ge===""?"."+W(Fe,0):ge,P(_e)?(pe="",j!=null&&(pe=j.replace(H,"$&/")+"/"),J(_e,re,pe,"",function(Se){return Se})):_e!=null&&(Q(_e)&&(_e=q(_e,pe+(!_e.key||Fe&&Fe.key===_e.key?"":(""+_e.key).replace(H,"$&/")+"/")+j)),re.push(_e)),1;if(Fe=0,ge=ge===""?".":ge+":",P(j))for(var Re=0;Re<j.length;Re++){he=j[Re];var Le=ge+W(he,Re);Fe+=J(he,re,pe,Le,_e)}else if(Le=y(j),typeof Le=="function")for(j=Le.call(j),Re=0;!(he=j.next()).done;)he=he.value,Le=ge+W(he,Re++),Fe+=J(he,re,pe,Le,_e);else if(he==="object")throw re=String(j),Error("Objects are not valid as a React child (found: "+(re==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":re)+"). If you meant to render a collection of children, use an array instead.");return Fe}function G(j,re,pe){if(j==null)return j;var ge=[],_e=0;return J(j,ge,"","",function(he){return re.call(pe,he,_e++)}),ge}function te(j){if(j._status===-1){var re=j._result;re=re(),re.then(function(pe){(j._status===0||j._status===-1)&&(j._status=1,j._result=pe)},function(pe){(j._status===0||j._status===-1)&&(j._status=2,j._result=pe)}),j._status===-1&&(j._status=0,j._result=re)}if(j._status===1)return j._result.default;throw j._result}var X={current:null},K={transition:null},Z={ReactCurrentDispatcher:X,ReactCurrentBatchConfig:K,ReactCurrentOwner:O};function ee(){throw Error("act(...) is not supported in production builds of React.")}return react_production_min.Children={map:G,forEach:function(j,re,pe){G(j,function(){re.apply(this,arguments)},pe)},count:function(j){var re=0;return G(j,function(){re++}),re},toArray:function(j){return G(j,function(re){return re})||[]},only:function(j){if(!Q(j))throw Error("React.Children.only expected to receive a single React element child.");return j}},react_production_min.Component=T,react_production_min.Fragment=r,react_production_min.Profiler=o,react_production_min.PureComponent=S,react_production_min.StrictMode=n,react_production_min.Suspense=c,react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z,react_production_min.act=ee,react_production_min.cloneElement=function(j,re,pe){if(j==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+j+".");var ge=M({},j.props),_e=j.key,he=j.ref,Fe=j._owner;if(re!=null){if(re.ref!==void 0&&(he=re.ref,Fe=O.current),re.key!==void 0&&(_e=""+re.key),j.type&&j.type.defaultProps)var Re=j.type.defaultProps;for(Le in re)F.call(re,Le)&&!N.hasOwnProperty(Le)&&(ge[Le]=re[Le]===void 0&&Re!==void 0?Re[Le]:re[Le])}var Le=arguments.length-2;if(Le===1)ge.children=pe;else if(1<Le){Re=Array(Le);for(var Se=0;Se<Le;Se++)Re[Se]=arguments[Se+2];ge.children=Re}return{$$typeof:e,type:j.type,key:_e,ref:he,props:ge,_owner:Fe}},react_production_min.createContext=function(j){return j={$$typeof:l,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},j.Provider={$$typeof:s,_context:j},j.Consumer=j},react_production_min.createElement=V,react_production_min.createFactory=function(j){var re=V.bind(null,j);return re.type=j,re},react_production_min.createRef=function(){return{current:null}},react_production_min.forwardRef=function(j){return{$$typeof:u,render:j}},react_production_min.isValidElement=Q,react_production_min.lazy=function(j){return{$$typeof:f,_payload:{_status:-1,_result:j},_init:te}},react_production_min.memo=function(j,re){return{$$typeof:h,type:j,compare:re===void 0?null:re}},react_production_min.startTransition=function(j){var re=K.transition;K.transition={};try{j()}finally{K.transition=re}},react_production_min.unstable_act=ee,react_production_min.useCallback=function(j,re){return X.current.useCallback(j,re)},react_production_min.useContext=function(j){return X.current.useContext(j)},react_production_min.useDebugValue=function(){},react_production_min.useDeferredValue=function(j){return X.current.useDeferredValue(j)},react_production_min.useEffect=function(j,re){return X.current.useEffect(j,re)},react_production_min.useId=function(){return X.current.useId()},react_production_min.useImperativeHandle=function(j,re,pe){return X.current.useImperativeHandle(j,re,pe)},react_production_min.useInsertionEffect=function(j,re){return X.current.useInsertionEffect(j,re)},react_production_min.useLayoutEffect=function(j,re){return X.current.useLayoutEffect(j,re)},react_production_min.useMemo=function(j,re){return X.current.useMemo(j,re)},react_production_min.useReducer=function(j,re,pe){return X.current.useReducer(j,re,pe)},react_production_min.useRef=function(j){return X.current.useRef(j)},react_production_min.useState=function(j){return X.current.useState(j)},react_production_min.useSyncExternalStore=function(j,re,pe){return X.current.useSyncExternalStore(j,re,pe)},react_production_min.useTransition=function(){return X.current.useTransition()},react_production_min.version="18.3.1",react_production_min}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production_min()),react.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production_min;function requireReactJsxRuntime_production_min(){if(hasRequiredReactJsxRuntime_production_min)return reactJsxRuntime_production_min;hasRequiredReactJsxRuntime_production_min=1;var e=requireReact(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(u,c,h){var f,m={},y=null,A=null;h!==void 0&&(y=""+h),c.key!==void 0&&(y=""+c.key),c.ref!==void 0&&(A=c.ref);for(f in c)n.call(c,f)&&!s.hasOwnProperty(f)&&(m[f]=c[f]);if(u&&u.defaultProps)for(f in c=u.defaultProps,c)m[f]===void 0&&(m[f]=c[f]);return{$$typeof:t,type:u,key:y,ref:A,props:m,_owner:o.current}}return reactJsxRuntime_production_min.Fragment=r,reactJsxRuntime_production_min.jsx=l,reactJsxRuntime_production_min.jsxs=l,reactJsxRuntime_production_min}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production_min()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),reactExports=requireReact();const React=getDefaultExportFromCjs(reactExports);var reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production_min;function requireScheduler_production_min(){return hasRequiredScheduler_production_min||(hasRequiredScheduler_production_min=1,function(e){function t(K,Z){var ee=K.length;K.push(Z);e:for(;0<ee;){var j=ee-1>>>1,re=K[j];if(0<o(re,Z))K[j]=Z,K[ee]=re,ee=j;else break e}}function r(K){return K.length===0?null:K[0]}function n(K){if(K.length===0)return null;var Z=K[0],ee=K.pop();if(ee!==Z){K[0]=ee;e:for(var j=0,re=K.length,pe=re>>>1;j<pe;){var ge=2*(j+1)-1,_e=K[ge],he=ge+1,Fe=K[he];if(0>o(_e,ee))he<re&&0>o(Fe,_e)?(K[j]=Fe,K[he]=ee,j=he):(K[j]=_e,K[ge]=ee,j=ge);else if(he<re&&0>o(Fe,ee))K[j]=Fe,K[he]=ee,j=he;else break e}}return Z}function o(K,Z){var ee=K.sortIndex-Z.sortIndex;return ee!==0?ee:K.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var l=Date,u=l.now();e.unstable_now=function(){return l.now()-u}}var c=[],h=[],f=1,m=null,y=3,A=!1,M=!1,b=!1,T=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(K){for(var Z=r(h);Z!==null;){if(Z.callback===null)n(h);else if(Z.startTime<=K)n(h),Z.sortIndex=Z.expirationTime,t(c,Z);else break;Z=r(h)}}function P(K){if(b=!1,C(K),!M)if(r(c)!==null)M=!0,te(F);else{var Z=r(h);Z!==null&&X(P,Z.startTime-K)}}function F(K,Z){M=!1,b&&(b=!1,_(V),V=-1),A=!0;var ee=y;try{for(C(Z),m=r(c);m!==null&&(!(m.expirationTime>Z)||K&&!z());){var j=m.callback;if(typeof j=="function"){m.callback=null,y=m.priorityLevel;var re=j(m.expirationTime<=Z);Z=e.unstable_now(),typeof re=="function"?m.callback=re:m===r(c)&&n(c),C(Z)}else n(c);m=r(c)}if(m!==null)var pe=!0;else{var ge=r(h);ge!==null&&X(P,ge.startTime-Z),pe=!1}return pe}finally{m=null,y=ee,A=!1}}var O=!1,N=null,V=-1,q=5,Q=-1;function z(){return!(e.unstable_now()-Q<q)}function H(){if(N!==null){var K=e.unstable_now();Q=K;var Z=!0;try{Z=N(!0,K)}finally{Z?W():(O=!1,N=null)}}else O=!1}var W;if(typeof S=="function")W=function(){S(H)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,G=J.port2;J.port1.onmessage=H,W=function(){G.postMessage(null)}}else W=function(){T(H,0)};function te(K){N=K,O||(O=!0,W())}function X(K,Z){V=T(function(){K(e.unstable_now())},Z)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(K){K.callback=null},e.unstable_continueExecution=function(){M||A||(M=!0,te(F))},e.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<K?Math.floor(1e3/K):5},e.unstable_getCurrentPriorityLevel=function(){return y},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(K){switch(y){case 1:case 2:case 3:var Z=3;break;default:Z=y}var ee=y;y=Z;try{return K()}finally{y=ee}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(K,Z){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var ee=y;y=K;try{return Z()}finally{y=ee}},e.unstable_scheduleCallback=function(K,Z,ee){var j=e.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?j+ee:j):ee=j,K){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=ee+re,K={id:f++,callback:Z,priorityLevel:K,startTime:ee,expirationTime:re,sortIndex:-1},ee>j?(K.sortIndex=ee,t(h,K),r(c)===null&&K===r(h)&&(b?(_(V),V=-1):b=!0,X(P,ee-j))):(K.sortIndex=re,t(c,K),M||A||(M=!0,te(F))),K},e.unstable_shouldYield=z,e.unstable_wrapCallback=function(K){var Z=y;return function(){var ee=y;y=Z;try{return K.apply(this,arguments)}finally{y=ee}}}}(scheduler_production_min)),scheduler_production_min}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production_min()),scheduler.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production_min;function requireReactDom_production_min(){if(hasRequiredReactDom_production_min)return reactDom_production_min;hasRequiredReactDom_production_min=1;var e=requireReact(),t=requireScheduler();function r(d){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+d,w=1;w<arguments.length;w++)v+="&args[]="+encodeURIComponent(arguments[w]);return"Minified React error #"+d+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,o={};function s(d,v){l(d,v),l(d+"Capture",v)}function l(d,v){for(o[d]=v,d=0;d<v.length;d++)n.add(v[d])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},m={};function y(d){return c.call(m,d)?!0:c.call(f,d)?!1:h.test(d)?m[d]=!0:(f[d]=!0,!1)}function A(d,v,w,I){if(w!==null&&w.type===0)return!1;switch(typeof v){case"function":case"symbol":return!0;case"boolean":return I?!1:w!==null?!w.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function M(d,v,w,I){if(v===null||typeof v>"u"||A(d,v,w,I))return!0;if(I)return!1;if(w!==null)switch(w.type){case 3:return!v;case 4:return v===!1;case 5:return isNaN(v);case 6:return isNaN(v)||1>v}return!1}function b(d,v,w,I,D,U,$){this.acceptsBooleans=v===2||v===3||v===4,this.attributeName=I,this.attributeNamespace=D,this.mustUseProperty=w,this.propertyName=d,this.type=v,this.sanitizeURL=U,this.removeEmptyString=$}var T={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){T[d]=new b(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var v=d[0];T[v]=new b(v,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){T[d]=new b(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){T[d]=new b(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){T[d]=new b(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){T[d]=new b(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){T[d]=new b(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){T[d]=new b(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){T[d]=new b(d,5,!1,d.toLowerCase(),null,!1,!1)});var _=/[\-:]([a-z])/g;function S(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var v=d.replace(_,S);T[v]=new b(v,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var v=d.replace(_,S);T[v]=new b(v,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var v=d.replace(_,S);T[v]=new b(v,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){T[d]=new b(d,1,!1,d.toLowerCase(),null,!1,!1)}),T.xlinkHref=new b("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){T[d]=new b(d,1,!1,d.toLowerCase(),null,!0,!0)});function C(d,v,w,I){var D=T.hasOwnProperty(v)?T[v]:null;(D!==null?D.type!==0:I||!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(M(v,w,D,I)&&(w=null),I||D===null?y(v)&&(w===null?d.removeAttribute(v):d.setAttribute(v,""+w)):D.mustUseProperty?d[D.propertyName]=w===null?D.type===3?!1:"":w:(v=D.attributeName,I=D.attributeNamespace,w===null?d.removeAttribute(v):(D=D.type,w=D===3||D===4&&w===!0?"":""+w,I?d.setAttributeNS(I,v,w):d.setAttribute(v,w))))}var P=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,F=Symbol.for("react.element"),O=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),V=Symbol.for("react.strict_mode"),q=Symbol.for("react.profiler"),Q=Symbol.for("react.provider"),z=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),J=Symbol.for("react.suspense_list"),G=Symbol.for("react.memo"),te=Symbol.for("react.lazy"),X=Symbol.for("react.offscreen"),K=Symbol.iterator;function Z(d){return d===null||typeof d!="object"?null:(d=K&&d[K]||d["@@iterator"],typeof d=="function"?d:null)}var ee=Object.assign,j;function re(d){if(j===void 0)try{throw Error()}catch(w){var v=w.stack.trim().match(/\n( *(at )?)/);j=v&&v[1]||""}return`
`+j+d}var pe=!1;function ge(d,v){if(!d||pe)return"";pe=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(Oe){var I=Oe}Reflect.construct(d,[],v)}else{try{v.call()}catch(Oe){I=Oe}d.call(v.prototype)}else{try{throw Error()}catch(Oe){I=Oe}d()}}catch(Oe){if(Oe&&I&&typeof Oe.stack=="string"){for(var D=Oe.stack.split(`
`),U=I.stack.split(`
`),$=D.length-1,de=U.length-1;1<=$&&0<=de&&D[$]!==U[de];)de--;for(;1<=$&&0<=de;$--,de--)if(D[$]!==U[de]){if($!==1||de!==1)do if($--,de--,0>de||D[$]!==U[de]){var ye=`
`+D[$].replace(" at new "," at ");return d.displayName&&ye.includes("<anonymous>")&&(ye=ye.replace("<anonymous>",d.displayName)),ye}while(1<=$&&0<=de);break}}}finally{pe=!1,Error.prepareStackTrace=w}return(d=d?d.displayName||d.name:"")?re(d):""}function _e(d){switch(d.tag){case 5:return re(d.type);case 16:return re("Lazy");case 13:return re("Suspense");case 19:return re("SuspenseList");case 0:case 2:case 15:return d=ge(d.type,!1),d;case 11:return d=ge(d.type.render,!1),d;case 1:return d=ge(d.type,!0),d;default:return""}}function he(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case N:return"Fragment";case O:return"Portal";case q:return"Profiler";case V:return"StrictMode";case W:return"Suspense";case J:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case z:return(d.displayName||"Context")+".Consumer";case Q:return(d._context.displayName||"Context")+".Provider";case H:var v=d.render;return d=d.displayName,d||(d=v.displayName||v.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case G:return v=d.displayName||null,v!==null?v:he(d.type)||"Memo";case te:v=d._payload,d=d._init;try{return he(d(v))}catch{}}return null}function Fe(d){var v=d.type;switch(d.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=v.render,d=d.displayName||d.name||"",v.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return he(v);case 8:return v===V?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function Re(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Le(d){var v=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(v==="checkbox"||v==="radio")}function Se(d){var v=Le(d)?"checked":"value",w=Object.getOwnPropertyDescriptor(d.constructor.prototype,v),I=""+d[v];if(!d.hasOwnProperty(v)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var D=w.get,U=w.set;return Object.defineProperty(d,v,{configurable:!0,get:function(){return D.call(this)},set:function($){I=""+$,U.call(this,$)}}),Object.defineProperty(d,v,{enumerable:w.enumerable}),{getValue:function(){return I},setValue:function($){I=""+$},stopTracking:function(){d._valueTracker=null,delete d[v]}}}}function we(d){d._valueTracker||(d._valueTracker=Se(d))}function Ve(d){if(!d)return!1;var v=d._valueTracker;if(!v)return!0;var w=v.getValue(),I="";return d&&(I=Le(d)?d.checked?"true":"false":d.value),d=I,d!==w?(v.setValue(d),!0):!1}function je(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function st(d,v){var w=v.checked;return ee({},v,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:w??d._wrapperState.initialChecked})}function We(d,v){var w=v.defaultValue==null?"":v.defaultValue,I=v.checked!=null?v.checked:v.defaultChecked;w=Re(v.value!=null?v.value:w),d._wrapperState={initialChecked:I,initialValue:w,controlled:v.type==="checkbox"||v.type==="radio"?v.checked!=null:v.value!=null}}function bt(d,v){v=v.checked,v!=null&&C(d,"checked",v,!1)}function oe(d,v){bt(d,v);var w=Re(v.value),I=v.type;if(w!=null)I==="number"?(w===0&&d.value===""||d.value!=w)&&(d.value=""+w):d.value!==""+w&&(d.value=""+w);else if(I==="submit"||I==="reset"){d.removeAttribute("value");return}v.hasOwnProperty("value")?Qe(d,v.type,w):v.hasOwnProperty("defaultValue")&&Qe(d,v.type,Re(v.defaultValue)),v.checked==null&&v.defaultChecked!=null&&(d.defaultChecked=!!v.defaultChecked)}function ue(d,v,w){if(v.hasOwnProperty("value")||v.hasOwnProperty("defaultValue")){var I=v.type;if(!(I!=="submit"&&I!=="reset"||v.value!==void 0&&v.value!==null))return;v=""+d._wrapperState.initialValue,w||v===d.value||(d.value=v),d.defaultValue=v}w=d.name,w!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,w!==""&&(d.name=w)}function Qe(d,v,w){(v!=="number"||je(d.ownerDocument)!==d)&&(w==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+w&&(d.defaultValue=""+w))}var Me=Array.isArray;function De(d,v,w,I){if(d=d.options,v){v={};for(var D=0;D<w.length;D++)v["$"+w[D]]=!0;for(w=0;w<d.length;w++)D=v.hasOwnProperty("$"+d[w].value),d[w].selected!==D&&(d[w].selected=D),D&&I&&(d[w].defaultSelected=!0)}else{for(w=""+Re(w),v=null,D=0;D<d.length;D++){if(d[D].value===w){d[D].selected=!0,I&&(d[D].defaultSelected=!0);return}v!==null||d[D].disabled||(v=d[D])}v!==null&&(v.selected=!0)}}function be(d,v){if(v.dangerouslySetInnerHTML!=null)throw Error(r(91));return ee({},v,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function ze(d,v){var w=v.value;if(w==null){if(w=v.children,v=v.defaultValue,w!=null){if(v!=null)throw Error(r(92));if(Me(w)){if(1<w.length)throw Error(r(93));w=w[0]}v=w}v==null&&(v=""),w=v}d._wrapperState={initialValue:Re(w)}}function at(d,v){var w=Re(v.value),I=Re(v.defaultValue);w!=null&&(w=""+w,w!==d.value&&(d.value=w),v.defaultValue==null&&d.defaultValue!==w&&(d.defaultValue=w)),I!=null&&(d.defaultValue=""+I)}function ot(d){var v=d.textContent;v===d._wrapperState.initialValue&&v!==""&&v!==null&&(d.value=v)}function nt(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ue(d,v){return d==null||d==="http://www.w3.org/1999/xhtml"?nt(v):d==="http://www.w3.org/2000/svg"&&v==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var He,qe=function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(v,w,I,D){MSApp.execUnsafeLocalFunction(function(){return d(v,w,I,D)})}:d}(function(d,v){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=v;else{for(He=He||document.createElement("div"),He.innerHTML="<svg>"+v.valueOf().toString()+"</svg>",v=He.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;v.firstChild;)d.appendChild(v.firstChild)}});function ke(d,v){if(v){var w=d.firstChild;if(w&&w===d.lastChild&&w.nodeType===3){w.nodeValue=v;return}}d.textContent=v}var ve={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ye=["Webkit","ms","Moz","O"];Object.keys(ve).forEach(function(d){Ye.forEach(function(v){v=v+d.charAt(0).toUpperCase()+d.substring(1),ve[v]=ve[d]})});function tt(d,v,w){return v==null||typeof v=="boolean"||v===""?"":w||typeof v!="number"||v===0||ve.hasOwnProperty(d)&&ve[d]?(""+v).trim():v+"px"}function xt(d,v){d=d.style;for(var w in v)if(v.hasOwnProperty(w)){var I=w.indexOf("--")===0,D=tt(w,v[w],I);w==="float"&&(w="cssFloat"),I?d.setProperty(w,D):d[w]=D}}var Ze=ee({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function lt(d,v){if(v){if(Ze[d]&&(v.children!=null||v.dangerouslySetInnerHTML!=null))throw Error(r(137,d));if(v.dangerouslySetInnerHTML!=null){if(v.children!=null)throw Error(r(60));if(typeof v.dangerouslySetInnerHTML!="object"||!("__html"in v.dangerouslySetInnerHTML))throw Error(r(61))}if(v.style!=null&&typeof v.style!="object")throw Error(r(62))}}function Pt(d,v){if(d.indexOf("-")===-1)return typeof v.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lt=null;function Gt(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Rt=null,Ft=null,Nt=null;function Ht(d){if(d=Ui(d)){if(typeof Rt!="function")throw Error(r(280));var v=d.stateNode;v&&(v=ya(v),Rt(d.stateNode,d.type,v))}}function or(d){Ft?Nt?Nt.push(d):Nt=[d]:Ft=d}function Xt(){if(Ft){var d=Ft,v=Nt;if(Nt=Ft=null,Ht(d),v)for(d=0;d<v.length;d++)Ht(v[d])}}function Zt(d,v){return d(v)}function ae(){}var Pe=!1;function Te(d,v,w){if(Pe)return d(v,w);Pe=!0;try{return Zt(d,v,w)}finally{Pe=!1,(Ft!==null||Nt!==null)&&(ae(),Xt())}}function Ne(d,v){var w=d.stateNode;if(w===null)return null;var I=ya(w);if(I===null)return null;w=I[v];e:switch(v){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(d=d.type,I=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!I;break e;default:d=!1}if(d)return null;if(w&&typeof w!="function")throw Error(r(231,v,typeof w));return w}var it=!1;if(u)try{var ft={};Object.defineProperty(ft,"passive",{get:function(){it=!0}}),window.addEventListener("test",ft,ft),window.removeEventListener("test",ft,ft)}catch{it=!1}function gt(d,v,w,I,D,U,$,de,ye){var Oe=Array.prototype.slice.call(arguments,3);try{v.apply(w,Oe)}catch(Ke){this.onError(Ke)}}var ut=!1,vt=null,yt=!1,Ot=null,It={onError:function(d){ut=!0,vt=d}};function Tt(d,v,w,I,D,U,$,de,ye){ut=!1,vt=null,gt.apply(It,arguments)}function ht(d,v,w,I,D,U,$,de,ye){if(Tt.apply(this,arguments),ut){if(ut){var Oe=vt;ut=!1,vt=null}else throw Error(r(198));yt||(yt=!0,Ot=Oe)}}function St(d){var v=d,w=d;if(d.alternate)for(;v.return;)v=v.return;else{d=v;do v=d,(v.flags&4098)!==0&&(w=v.return),d=v.return;while(d)}return v.tag===3?w:null}function zt(d){if(d.tag===13){var v=d.memoizedState;if(v===null&&(d=d.alternate,d!==null&&(v=d.memoizedState)),v!==null)return v.dehydrated}return null}function Dt(d){if(St(d)!==d)throw Error(r(188))}function Et(d){var v=d.alternate;if(!v){if(v=St(d),v===null)throw Error(r(188));return v!==d?null:d}for(var w=d,I=v;;){var D=w.return;if(D===null)break;var U=D.alternate;if(U===null){if(I=D.return,I!==null){w=I;continue}break}if(D.child===U.child){for(U=D.child;U;){if(U===w)return Dt(D),d;if(U===I)return Dt(D),v;U=U.sibling}throw Error(r(188))}if(w.return!==I.return)w=D,I=U;else{for(var $=!1,de=D.child;de;){if(de===w){$=!0,w=D,I=U;break}if(de===I){$=!0,I=D,w=U;break}de=de.sibling}if(!$){for(de=U.child;de;){if(de===w){$=!0,w=U,I=D;break}if(de===I){$=!0,I=U,w=D;break}de=de.sibling}if(!$)throw Error(r(189))}}if(w.alternate!==I)throw Error(r(190))}if(w.tag!==3)throw Error(r(188));return w.stateNode.current===w?d:v}function jt(d){return d=Et(d),d!==null?kt(d):null}function kt(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var v=kt(d);if(v!==null)return v;d=d.sibling}return null}var pr=t.unstable_scheduleCallback,fr=t.unstable_cancelCallback,Dn=t.unstable_shouldYield,pn=t.unstable_requestPaint,Vt=t.unstable_now,fn=t.unstable_getCurrentPriorityLevel,Or=t.unstable_ImmediatePriority,Dr=t.unstable_UserBlockingPriority,Yr=t.unstable_NormalPriority,kr=t.unstable_LowPriority,Nr=t.unstable_IdlePriority,kn=null,Rr=null;function Zn(d){if(Rr&&typeof Rr.onCommitFiberRoot=="function")try{Rr.onCommitFiberRoot(kn,d,void 0,(d.current.flags&128)===128)}catch{}}var Yt=Math.clz32?Math.clz32:_i,Yn=Math.log,xi=Math.LN2;function _i(d){return d>>>=0,d===0?32:31-(Yn(d)/xi|0)|0}var vn=64,mn=4194304;function $r(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function jr(d,v){var w=d.pendingLanes;if(w===0)return 0;var I=0,D=d.suspendedLanes,U=d.pingedLanes,$=w&268435455;if($!==0){var de=$&~D;de!==0?I=$r(de):(U&=$,U!==0&&(I=$r(U)))}else $=w&~D,$!==0?I=$r($):U!==0&&(I=$r(U));if(I===0)return 0;if(v!==0&&v!==I&&(v&D)===0&&(D=I&-I,U=v&-v,D>=U||D===16&&(U&4194240)!==0))return v;if((I&4)!==0&&(I|=w&16),v=d.entangledLanes,v!==0)for(d=d.entanglements,v&=I;0<v;)w=31-Yt(v),D=1<<w,I|=d[w],v&=~D;return I}function io(d,v){switch(d){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ra(d,v){for(var w=d.suspendedLanes,I=d.pingedLanes,D=d.expirationTimes,U=d.pendingLanes;0<U;){var $=31-Yt(U),de=1<<$,ye=D[$];ye===-1?((de&w)===0||(de&I)!==0)&&(D[$]=io(de,v)):ye<=v&&(d.expiredLanes|=de),U&=~de}}function Nn(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function Si(){var d=vn;return vn<<=1,(vn&4194240)===0&&(vn=64),d}function Mi(d){for(var v=[],w=0;31>w;w++)v.push(d);return v}function Y(d,v,w){d.pendingLanes|=v,v!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,v=31-Yt(v),d[v]=w}function ne(d,v){var w=d.pendingLanes&~v;d.pendingLanes=v,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=v,d.mutableReadLanes&=v,d.entangledLanes&=v,v=d.entanglements;var I=d.eventTimes;for(d=d.expirationTimes;0<w;){var D=31-Yt(w),U=1<<D;v[D]=0,I[D]=-1,d[D]=-1,w&=~U}}function me(d,v){var w=d.entangledLanes|=v;for(d=d.entanglements;w;){var I=31-Yt(w),D=1<<I;D&v|d[I]&v&&(d[I]|=v),w&=~D}}var Ee=0;function Xe(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var _t,Bt,$t,ir,gr,Mr=!1,na=[],gn=null,yn=null,An=null,wi=new Map,Ei=new Map,bn=[],Yu="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Fs(d,v){switch(d){case"focusin":case"focusout":gn=null;break;case"dragenter":case"dragleave":yn=null;break;case"mouseover":case"mouseout":An=null;break;case"pointerover":case"pointerout":wi.delete(v.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ei.delete(v.pointerId)}}function Ti(d,v,w,I,D,U){return d===null||d.nativeEvent!==U?(d={blockedOn:v,domEventName:w,eventSystemFlags:I,nativeEvent:U,targetContainers:[D]},v!==null&&(v=Ui(v),v!==null&&Bt(v)),d):(d.eventSystemFlags|=I,v=d.targetContainers,D!==null&&v.indexOf(D)===-1&&v.push(D),d)}function $u(d,v,w,I,D){switch(v){case"focusin":return gn=Ti(gn,d,v,w,I,D),!0;case"dragenter":return yn=Ti(yn,d,v,w,I,D),!0;case"mouseover":return An=Ti(An,d,v,w,I,D),!0;case"pointerover":var U=D.pointerId;return wi.set(U,Ti(wi.get(U)||null,d,v,w,I,D)),!0;case"gotpointercapture":return U=D.pointerId,Ei.set(U,Ti(Ei.get(U)||null,d,v,w,I,D)),!0}return!1}function Os(d){var v=Vn(d.target);if(v!==null){var w=St(v);if(w!==null){if(v=w.tag,v===13){if(v=zt(w),v!==null){d.blockedOn=v,gr(d.priority,function(){$t(w)});return}}else if(v===3&&w.stateNode.current.memoizedState.isDehydrated){d.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}d.blockedOn=null}function ia(d){if(d.blockedOn!==null)return!1;for(var v=d.targetContainers;0<v.length;){var w=oo(d.domEventName,d.eventSystemFlags,v[0],d.nativeEvent);if(w===null){w=d.nativeEvent;var I=new w.constructor(w.type,w);Lt=I,w.target.dispatchEvent(I),Lt=null}else return v=Ui(w),v!==null&&Bt(v),d.blockedOn=w,!1;v.shift()}return!0}function Ds(d,v,w){ia(d)&&w.delete(v)}function tc(){Mr=!1,gn!==null&&ia(gn)&&(gn=null),yn!==null&&ia(yn)&&(yn=null),An!==null&&ia(An)&&(An=null),wi.forEach(Ds),Ei.forEach(Ds)}function Ci(d,v){d.blockedOn===v&&(d.blockedOn=null,Mr||(Mr=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,tc)))}function Pi(d){function v(D){return Ci(D,d)}if(0<na.length){Ci(na[0],d);for(var w=1;w<na.length;w++){var I=na[w];I.blockedOn===d&&(I.blockedOn=null)}}for(gn!==null&&Ci(gn,d),yn!==null&&Ci(yn,d),An!==null&&Ci(An,d),wi.forEach(v),Ei.forEach(v),w=0;w<bn.length;w++)I=bn[w],I.blockedOn===d&&(I.blockedOn=null);for(;0<bn.length&&(w=bn[0],w.blockedOn===null);)Os(w),w.blockedOn===null&&bn.shift()}var $n=P.ReactCurrentBatchConfig,aa=!0;function rc(d,v,w,I){var D=Ee,U=$n.transition;$n.transition=null;try{Ee=1,ao(d,v,w,I)}finally{Ee=D,$n.transition=U}}function nc(d,v,w,I){var D=Ee,U=$n.transition;$n.transition=null;try{Ee=4,ao(d,v,w,I)}finally{Ee=D,$n.transition=U}}function ao(d,v,w,I){if(aa){var D=oo(d,v,w,I);if(D===null)Mo(d,v,I,oa,w),Fs(d,I);else if($u(D,d,v,w,I))I.stopPropagation();else if(Fs(d,I),v&4&&-1<Yu.indexOf(d)){for(;D!==null;){var U=Ui(D);if(U!==null&&_t(U),U=oo(d,v,w,I),U===null&&Mo(d,v,I,oa,w),U===D)break;D=U}D!==null&&I.stopPropagation()}else Mo(d,v,I,null,w)}}var oa=null;function oo(d,v,w,I){if(oa=null,d=Gt(I),d=Vn(d),d!==null)if(v=St(d),v===null)d=null;else if(w=v.tag,w===13){if(d=zt(v),d!==null)return d;d=null}else if(w===3){if(v.stateNode.current.memoizedState.isDehydrated)return v.tag===3?v.stateNode.containerInfo:null;d=null}else v!==d&&(d=null);return oa=d,null}function ks(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(fn()){case Or:return 1;case Dr:return 4;case Yr:case kr:return 16;case Nr:return 536870912;default:return 16}default:return 16}}var xn=null,so=null,sa=null;function Ns(){if(sa)return sa;var d,v=so,w=v.length,I,D="value"in xn?xn.value:xn.textContent,U=D.length;for(d=0;d<w&&v[d]===D[d];d++);var $=w-d;for(I=1;I<=$&&v[w-I]===D[U-I];I++);return sa=D.slice(d,1<I?1-I:void 0)}function la(d){var v=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&v===13&&(d=13)):d=v,d===10&&(d=13),32<=d||d===13?d:0}function ua(){return!0}function Vs(){return!1}function Ir(d){function v(w,I,D,U,$){this._reactName=w,this._targetInst=D,this.type=I,this.nativeEvent=U,this.target=$,this.currentTarget=null;for(var de in d)d.hasOwnProperty(de)&&(w=d[de],this[de]=w?w(U):U[de]);return this.isDefaultPrevented=(U.defaultPrevented!=null?U.defaultPrevented:U.returnValue===!1)?ua:Vs,this.isPropagationStopped=Vs,this}return ee(v.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=ua)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=ua)},persist:function(){},isPersistent:ua}),v}var ei={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lo=Ir(ei),Ri=ee({},ei,{view:0,detail:0}),ic=Ir(Ri),uo,co,Ii,ca=ee({},Ri,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:po,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Ii&&(Ii&&d.type==="mousemove"?(uo=d.screenX-Ii.screenX,co=d.screenY-Ii.screenY):co=uo=0,Ii=d),uo)},movementY:function(d){return"movementY"in d?d.movementY:co}}),zs=Ir(ca),ac=ee({},ca,{dataTransfer:0}),oc=Ir(ac),sc=ee({},Ri,{relatedTarget:0}),ho=Ir(sc),lc=ee({},ei,{animationName:0,elapsedTime:0,pseudoElement:0}),uc=Ir(lc),cc=ee({},ei,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),hc=Ir(cc),dc=ee({},ei,{data:0}),Us=Ir(dc),pc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mc(d){var v=this.nativeEvent;return v.getModifierState?v.getModifierState(d):(d=vc[d])?!!v[d]:!1}function po(){return mc}var gc=ee({},Ri,{key:function(d){if(d.key){var v=pc[d.key]||d.key;if(v!=="Unidentified")return v}return d.type==="keypress"?(d=la(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?fc[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:po,charCode:function(d){return d.type==="keypress"?la(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?la(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),yc=Ir(gc),Ac=ee({},ca,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gs=Ir(Ac),bc=ee({},Ri,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:po}),xc=Ir(bc),_c=ee({},ei,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sc=Ir(_c),Mc=ee({},ca,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),wc=Ir(Mc),Ec=[9,13,27,32],fo=u&&"CompositionEvent"in window,Li=null;u&&"documentMode"in document&&(Li=document.documentMode);var Tc=u&&"TextEvent"in window&&!Li,Hs=u&&(!fo||Li&&8<Li&&11>=Li),qs=" ",js=!1;function Ws(d,v){switch(d){case"keyup":return Ec.indexOf(v.keyCode)!==-1;case"keydown":return v.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Qs(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var ti=!1;function Cc(d,v){switch(d){case"compositionend":return Qs(v);case"keypress":return v.which!==32?null:(js=!0,qs);case"textInput":return d=v.data,d===qs&&js?null:d;default:return null}}function Pc(d,v){if(ti)return d==="compositionend"||!fo&&Ws(d,v)?(d=Ns(),sa=so=xn=null,ti=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(v.ctrlKey||v.altKey||v.metaKey)||v.ctrlKey&&v.altKey){if(v.char&&1<v.char.length)return v.char;if(v.which)return String.fromCharCode(v.which)}return null;case"compositionend":return Hs&&v.locale!=="ko"?null:v.data;default:return null}}var Rc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Js(d){var v=d&&d.nodeName&&d.nodeName.toLowerCase();return v==="input"?!!Rc[d.type]:v==="textarea"}function Xs(d,v,w,I){or(I),v=va(v,"onChange"),0<v.length&&(w=new lo("onChange","change",null,w,I),d.push({event:w,listeners:v}))}var Bi=null,Fi=null;function Ic(d){pl(d,0)}function ha(d){var v=oi(d);if(Ve(v))return d}function Lc(d,v){if(d==="change")return v}var Ks=!1;if(u){var vo;if(u){var mo="oninput"in document;if(!mo){var Zs=document.createElement("div");Zs.setAttribute("oninput","return;"),mo=typeof Zs.oninput=="function"}vo=mo}else vo=!1;Ks=vo&&(!document.documentMode||9<document.documentMode)}function Ys(){Bi&&(Bi.detachEvent("onpropertychange",$s),Fi=Bi=null)}function $s(d){if(d.propertyName==="value"&&ha(Fi)){var v=[];Xs(v,Fi,d,Gt(d)),Te(Ic,v)}}function Bc(d,v,w){d==="focusin"?(Ys(),Bi=v,Fi=w,Bi.attachEvent("onpropertychange",$s)):d==="focusout"&&Ys()}function Fc(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return ha(Fi)}function Oc(d,v){if(d==="click")return ha(v)}function Dc(d,v){if(d==="input"||d==="change")return ha(v)}function kc(d,v){return d===v&&(d!==0||1/d===1/v)||d!==d&&v!==v}var Wr=typeof Object.is=="function"?Object.is:kc;function Oi(d,v){if(Wr(d,v))return!0;if(typeof d!="object"||d===null||typeof v!="object"||v===null)return!1;var w=Object.keys(d),I=Object.keys(v);if(w.length!==I.length)return!1;for(I=0;I<w.length;I++){var D=w[I];if(!c.call(v,D)||!Wr(d[D],v[D]))return!1}return!0}function el(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function tl(d,v){var w=el(d);d=0;for(var I;w;){if(w.nodeType===3){if(I=d+w.textContent.length,d<=v&&I>=v)return{node:w,offset:v-d};d=I}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=el(w)}}function rl(d,v){return d&&v?d===v?!0:d&&d.nodeType===3?!1:v&&v.nodeType===3?rl(d,v.parentNode):"contains"in d?d.contains(v):d.compareDocumentPosition?!!(d.compareDocumentPosition(v)&16):!1:!1}function nl(){for(var d=window,v=je();v instanceof d.HTMLIFrameElement;){try{var w=typeof v.contentWindow.location.href=="string"}catch{w=!1}if(w)d=v.contentWindow;else break;v=je(d.document)}return v}function go(d){var v=d&&d.nodeName&&d.nodeName.toLowerCase();return v&&(v==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||v==="textarea"||d.contentEditable==="true")}function Nc(d){var v=nl(),w=d.focusedElem,I=d.selectionRange;if(v!==w&&w&&w.ownerDocument&&rl(w.ownerDocument.documentElement,w)){if(I!==null&&go(w)){if(v=I.start,d=I.end,d===void 0&&(d=v),"selectionStart"in w)w.selectionStart=v,w.selectionEnd=Math.min(d,w.value.length);else if(d=(v=w.ownerDocument||document)&&v.defaultView||window,d.getSelection){d=d.getSelection();var D=w.textContent.length,U=Math.min(I.start,D);I=I.end===void 0?U:Math.min(I.end,D),!d.extend&&U>I&&(D=I,I=U,U=D),D=tl(w,U);var $=tl(w,I);D&&$&&(d.rangeCount!==1||d.anchorNode!==D.node||d.anchorOffset!==D.offset||d.focusNode!==$.node||d.focusOffset!==$.offset)&&(v=v.createRange(),v.setStart(D.node,D.offset),d.removeAllRanges(),U>I?(d.addRange(v),d.extend($.node,$.offset)):(v.setEnd($.node,$.offset),d.addRange(v)))}}for(v=[],d=w;d=d.parentNode;)d.nodeType===1&&v.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<v.length;w++)d=v[w],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var Vc=u&&"documentMode"in document&&11>=document.documentMode,ri=null,yo=null,Di=null,Ao=!1;function il(d,v,w){var I=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;Ao||ri==null||ri!==je(I)||(I=ri,"selectionStart"in I&&go(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),Di&&Oi(Di,I)||(Di=I,I=va(yo,"onSelect"),0<I.length&&(v=new lo("onSelect","select",null,v,w),d.push({event:v,listeners:I}),v.target=ri)))}function da(d,v){var w={};return w[d.toLowerCase()]=v.toLowerCase(),w["Webkit"+d]="webkit"+v,w["Moz"+d]="moz"+v,w}var ni={animationend:da("Animation","AnimationEnd"),animationiteration:da("Animation","AnimationIteration"),animationstart:da("Animation","AnimationStart"),transitionend:da("Transition","TransitionEnd")},bo={},al={};u&&(al=document.createElement("div").style,"AnimationEvent"in window||(delete ni.animationend.animation,delete ni.animationiteration.animation,delete ni.animationstart.animation),"TransitionEvent"in window||delete ni.transitionend.transition);function pa(d){if(bo[d])return bo[d];if(!ni[d])return d;var v=ni[d],w;for(w in v)if(v.hasOwnProperty(w)&&w in al)return bo[d]=v[w];return d}var ol=pa("animationend"),sl=pa("animationiteration"),ll=pa("animationstart"),ul=pa("transitionend"),cl=new Map,hl="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _n(d,v){cl.set(d,v),s(v,[d])}for(var xo=0;xo<hl.length;xo++){var _o=hl[xo],zc=_o.toLowerCase(),Uc=_o[0].toUpperCase()+_o.slice(1);_n(zc,"on"+Uc)}_n(ol,"onAnimationEnd"),_n(sl,"onAnimationIteration"),_n(ll,"onAnimationStart"),_n("dblclick","onDoubleClick"),_n("focusin","onFocus"),_n("focusout","onBlur"),_n(ul,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ki="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Gc=new Set("cancel close invalid load scroll toggle".split(" ").concat(ki));function dl(d,v,w){var I=d.type||"unknown-event";d.currentTarget=w,ht(I,v,void 0,d),d.currentTarget=null}function pl(d,v){v=(v&4)!==0;for(var w=0;w<d.length;w++){var I=d[w],D=I.event;I=I.listeners;e:{var U=void 0;if(v)for(var $=I.length-1;0<=$;$--){var de=I[$],ye=de.instance,Oe=de.currentTarget;if(de=de.listener,ye!==U&&D.isPropagationStopped())break e;dl(D,de,Oe),U=ye}else for($=0;$<I.length;$++){if(de=I[$],ye=de.instance,Oe=de.currentTarget,de=de.listener,ye!==U&&D.isPropagationStopped())break e;dl(D,de,Oe),U=ye}}}if(yt)throw d=Ot,yt=!1,Ot=null,d}function Qt(d,v){var w=v[Ro];w===void 0&&(w=v[Ro]=new Set);var I=d+"__bubble";w.has(I)||(vl(v,d,2,!1),w.add(I))}function So(d,v,w){var I=0;v&&(I|=4),vl(w,d,I,v)}var fa="_reactListening"+Math.random().toString(36).slice(2);function Ni(d){if(!d[fa]){d[fa]=!0,n.forEach(function(w){w!=="selectionchange"&&(Gc.has(w)||So(w,!1,d),So(w,!0,d))});var v=d.nodeType===9?d:d.ownerDocument;v===null||v[fa]||(v[fa]=!0,So("selectionchange",!1,v))}}function vl(d,v,w,I){switch(ks(v)){case 1:var D=rc;break;case 4:D=nc;break;default:D=ao}w=D.bind(null,v,w,d),D=void 0,!it||v!=="touchstart"&&v!=="touchmove"&&v!=="wheel"||(D=!0),I?D!==void 0?d.addEventListener(v,w,{capture:!0,passive:D}):d.addEventListener(v,w,!0):D!==void 0?d.addEventListener(v,w,{passive:D}):d.addEventListener(v,w,!1)}function Mo(d,v,w,I,D){var U=I;if((v&1)===0&&(v&2)===0&&I!==null)e:for(;;){if(I===null)return;var $=I.tag;if($===3||$===4){var de=I.stateNode.containerInfo;if(de===D||de.nodeType===8&&de.parentNode===D)break;if($===4)for($=I.return;$!==null;){var ye=$.tag;if((ye===3||ye===4)&&(ye=$.stateNode.containerInfo,ye===D||ye.nodeType===8&&ye.parentNode===D))return;$=$.return}for(;de!==null;){if($=Vn(de),$===null)return;if(ye=$.tag,ye===5||ye===6){I=U=$;continue e}de=de.parentNode}}I=I.return}Te(function(){var Oe=U,Ke=Gt(w),$e=[];e:{var Je=cl.get(d);if(Je!==void 0){var ct=lo,pt=d;switch(d){case"keypress":if(la(w)===0)break e;case"keydown":case"keyup":ct=yc;break;case"focusin":pt="focus",ct=ho;break;case"focusout":pt="blur",ct=ho;break;case"beforeblur":case"afterblur":ct=ho;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ct=zs;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ct=oc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ct=xc;break;case ol:case sl:case ll:ct=uc;break;case ul:ct=Sc;break;case"scroll":ct=ic;break;case"wheel":ct=wc;break;case"copy":case"cut":case"paste":ct=hc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ct=Gs}var mt=(v&4)!==0,ar=!mt&&d==="scroll",Ce=mt?Je!==null?Je+"Capture":null:Je;mt=[];for(var xe=Oe,Be;xe!==null;){Be=xe;var rt=Be.stateNode;if(Be.tag===5&&rt!==null&&(Be=rt,Ce!==null&&(rt=Ne(xe,Ce),rt!=null&&mt.push(Vi(xe,rt,Be)))),ar)break;xe=xe.return}0<mt.length&&(Je=new ct(Je,pt,null,w,Ke),$e.push({event:Je,listeners:mt}))}}if((v&7)===0){e:{if(Je=d==="mouseover"||d==="pointerover",ct=d==="mouseout"||d==="pointerout",Je&&w!==Lt&&(pt=w.relatedTarget||w.fromElement)&&(Vn(pt)||pt[an]))break e;if((ct||Je)&&(Je=Ke.window===Ke?Ke:(Je=Ke.ownerDocument)?Je.defaultView||Je.parentWindow:window,ct?(pt=w.relatedTarget||w.toElement,ct=Oe,pt=pt?Vn(pt):null,pt!==null&&(ar=St(pt),pt!==ar||pt.tag!==5&&pt.tag!==6)&&(pt=null)):(ct=null,pt=Oe),ct!==pt)){if(mt=zs,rt="onMouseLeave",Ce="onMouseEnter",xe="mouse",(d==="pointerout"||d==="pointerover")&&(mt=Gs,rt="onPointerLeave",Ce="onPointerEnter",xe="pointer"),ar=ct==null?Je:oi(ct),Be=pt==null?Je:oi(pt),Je=new mt(rt,xe+"leave",ct,w,Ke),Je.target=ar,Je.relatedTarget=Be,rt=null,Vn(Ke)===Oe&&(mt=new mt(Ce,xe+"enter",pt,w,Ke),mt.target=Be,mt.relatedTarget=ar,rt=mt),ar=rt,ct&&pt)t:{for(mt=ct,Ce=pt,xe=0,Be=mt;Be;Be=ii(Be))xe++;for(Be=0,rt=Ce;rt;rt=ii(rt))Be++;for(;0<xe-Be;)mt=ii(mt),xe--;for(;0<Be-xe;)Ce=ii(Ce),Be--;for(;xe--;){if(mt===Ce||Ce!==null&&mt===Ce.alternate)break t;mt=ii(mt),Ce=ii(Ce)}mt=null}else mt=null;ct!==null&&ml($e,Je,ct,mt,!1),pt!==null&&ar!==null&&ml($e,ar,pt,mt,!0)}}e:{if(Je=Oe?oi(Oe):window,ct=Je.nodeName&&Je.nodeName.toLowerCase(),ct==="select"||ct==="input"&&Je.type==="file")var At=Lc;else if(Js(Je))if(Ks)At=Dc;else{At=Fc;var Mt=Bc}else(ct=Je.nodeName)&&ct.toLowerCase()==="input"&&(Je.type==="checkbox"||Je.type==="radio")&&(At=Oc);if(At&&(At=At(d,Oe))){Xs($e,At,w,Ke);break e}Mt&&Mt(d,Je,Oe),d==="focusout"&&(Mt=Je._wrapperState)&&Mt.controlled&&Je.type==="number"&&Qe(Je,"number",Je.value)}switch(Mt=Oe?oi(Oe):window,d){case"focusin":(Js(Mt)||Mt.contentEditable==="true")&&(ri=Mt,yo=Oe,Di=null);break;case"focusout":Di=yo=ri=null;break;case"mousedown":Ao=!0;break;case"contextmenu":case"mouseup":case"dragend":Ao=!1,il($e,w,Ke);break;case"selectionchange":if(Vc)break;case"keydown":case"keyup":il($e,w,Ke)}var wt;if(fo)e:{switch(d){case"compositionstart":var Ct="onCompositionStart";break e;case"compositionend":Ct="onCompositionEnd";break e;case"compositionupdate":Ct="onCompositionUpdate";break e}Ct=void 0}else ti?Ws(d,w)&&(Ct="onCompositionEnd"):d==="keydown"&&w.keyCode===229&&(Ct="onCompositionStart");Ct&&(Hs&&w.locale!=="ko"&&(ti||Ct!=="onCompositionStart"?Ct==="onCompositionEnd"&&ti&&(wt=Ns()):(xn=Ke,so="value"in xn?xn.value:xn.textContent,ti=!0)),Mt=va(Oe,Ct),0<Mt.length&&(Ct=new Us(Ct,d,null,w,Ke),$e.push({event:Ct,listeners:Mt}),wt?Ct.data=wt:(wt=Qs(w),wt!==null&&(Ct.data=wt)))),(wt=Tc?Cc(d,w):Pc(d,w))&&(Oe=va(Oe,"onBeforeInput"),0<Oe.length&&(Ke=new Us("onBeforeInput","beforeinput",null,w,Ke),$e.push({event:Ke,listeners:Oe}),Ke.data=wt))}pl($e,v)})}function Vi(d,v,w){return{instance:d,listener:v,currentTarget:w}}function va(d,v){for(var w=v+"Capture",I=[];d!==null;){var D=d,U=D.stateNode;D.tag===5&&U!==null&&(D=U,U=Ne(d,w),U!=null&&I.unshift(Vi(d,U,D)),U=Ne(d,v),U!=null&&I.push(Vi(d,U,D))),d=d.return}return I}function ii(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function ml(d,v,w,I,D){for(var U=v._reactName,$=[];w!==null&&w!==I;){var de=w,ye=de.alternate,Oe=de.stateNode;if(ye!==null&&ye===I)break;de.tag===5&&Oe!==null&&(de=Oe,D?(ye=Ne(w,U),ye!=null&&$.unshift(Vi(w,ye,de))):D||(ye=Ne(w,U),ye!=null&&$.push(Vi(w,ye,de)))),w=w.return}$.length!==0&&d.push({event:v,listeners:$})}var Hc=/\r\n?/g,qc=/\u0000|\uFFFD/g;function gl(d){return(typeof d=="string"?d:""+d).replace(Hc,`
`).replace(qc,"")}function ma(d,v,w){if(v=gl(v),gl(d)!==v&&w)throw Error(r(425))}function ga(){}var wo=null,Eo=null;function To(d,v){return d==="textarea"||d==="noscript"||typeof v.children=="string"||typeof v.children=="number"||typeof v.dangerouslySetInnerHTML=="object"&&v.dangerouslySetInnerHTML!==null&&v.dangerouslySetInnerHTML.__html!=null}var Co=typeof setTimeout=="function"?setTimeout:void 0,jc=typeof clearTimeout=="function"?clearTimeout:void 0,yl=typeof Promise=="function"?Promise:void 0,Wc=typeof queueMicrotask=="function"?queueMicrotask:typeof yl<"u"?function(d){return yl.resolve(null).then(d).catch(Qc)}:Co;function Qc(d){setTimeout(function(){throw d})}function Po(d,v){var w=v,I=0;do{var D=w.nextSibling;if(d.removeChild(w),D&&D.nodeType===8)if(w=D.data,w==="/$"){if(I===0){d.removeChild(D),Pi(v);return}I--}else w!=="$"&&w!=="$?"&&w!=="$!"||I++;w=D}while(w);Pi(v)}function Sn(d){for(;d!=null;d=d.nextSibling){var v=d.nodeType;if(v===1||v===3)break;if(v===8){if(v=d.data,v==="$"||v==="$!"||v==="$?")break;if(v==="/$")return null}}return d}function Al(d){d=d.previousSibling;for(var v=0;d;){if(d.nodeType===8){var w=d.data;if(w==="$"||w==="$!"||w==="$?"){if(v===0)return d;v--}else w==="/$"&&v++}d=d.previousSibling}return null}var ai=Math.random().toString(36).slice(2),en="__reactFiber$"+ai,zi="__reactProps$"+ai,an="__reactContainer$"+ai,Ro="__reactEvents$"+ai,Jc="__reactListeners$"+ai,Xc="__reactHandles$"+ai;function Vn(d){var v=d[en];if(v)return v;for(var w=d.parentNode;w;){if(v=w[an]||w[en]){if(w=v.alternate,v.child!==null||w!==null&&w.child!==null)for(d=Al(d);d!==null;){if(w=d[en])return w;d=Al(d)}return v}d=w,w=d.parentNode}return null}function Ui(d){return d=d[en]||d[an],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function oi(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(r(33))}function ya(d){return d[zi]||null}var Io=[],si=-1;function Mn(d){return{current:d}}function Jt(d){0>si||(d.current=Io[si],Io[si]=null,si--)}function Wt(d,v){si++,Io[si]=d.current,d.current=v}var wn={},yr=Mn(wn),wr=Mn(!1),zn=wn;function li(d,v){var w=d.type.contextTypes;if(!w)return wn;var I=d.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===v)return I.__reactInternalMemoizedMaskedChildContext;var D={},U;for(U in w)D[U]=v[U];return I&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=v,d.__reactInternalMemoizedMaskedChildContext=D),D}function Er(d){return d=d.childContextTypes,d!=null}function Aa(){Jt(wr),Jt(yr)}function bl(d,v,w){if(yr.current!==wn)throw Error(r(168));Wt(yr,v),Wt(wr,w)}function xl(d,v,w){var I=d.stateNode;if(v=v.childContextTypes,typeof I.getChildContext!="function")return w;I=I.getChildContext();for(var D in I)if(!(D in v))throw Error(r(108,Fe(d)||"Unknown",D));return ee({},w,I)}function ba(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||wn,zn=yr.current,Wt(yr,d),Wt(wr,wr.current),!0}function _l(d,v,w){var I=d.stateNode;if(!I)throw Error(r(169));w?(d=xl(d,v,zn),I.__reactInternalMemoizedMergedChildContext=d,Jt(wr),Jt(yr),Wt(yr,d)):Jt(wr),Wt(wr,w)}var on=null,xa=!1,Lo=!1;function Sl(d){on===null?on=[d]:on.push(d)}function Kc(d){xa=!0,Sl(d)}function En(){if(!Lo&&on!==null){Lo=!0;var d=0,v=Ee;try{var w=on;for(Ee=1;d<w.length;d++){var I=w[d];do I=I(!0);while(I!==null)}on=null,xa=!1}catch(D){throw on!==null&&(on=on.slice(d+1)),pr(Or,En),D}finally{Ee=v,Lo=!1}}return null}var ui=[],ci=0,Sa=null,Ma=0,Vr=[],zr=0,Un=null,sn=1,ln="";function Gn(d,v){ui[ci++]=Ma,ui[ci++]=Sa,Sa=d,Ma=v}function Ml(d,v,w){Vr[zr++]=sn,Vr[zr++]=ln,Vr[zr++]=Un,Un=d;var I=sn;d=ln;var D=32-Yt(I)-1;I&=~(1<<D),w+=1;var U=32-Yt(v)+D;if(30<U){var $=D-D%5;U=(I&(1<<$)-1).toString(32),I>>=$,D-=$,sn=1<<32-Yt(v)+D|w<<D|I,ln=U+d}else sn=1<<U|w<<D|I,ln=d}function Bo(d){d.return!==null&&(Gn(d,1),Ml(d,1,0))}function Fo(d){for(;d===Sa;)Sa=ui[--ci],ui[ci]=null,Ma=ui[--ci],ui[ci]=null;for(;d===Un;)Un=Vr[--zr],Vr[zr]=null,ln=Vr[--zr],Vr[zr]=null,sn=Vr[--zr],Vr[zr]=null}var Lr=null,Br=null,Kt=!1,Qr=null;function wl(d,v){var w=qr(5,null,null,0);w.elementType="DELETED",w.stateNode=v,w.return=d,v=d.deletions,v===null?(d.deletions=[w],d.flags|=16):v.push(w)}function El(d,v){switch(d.tag){case 5:var w=d.type;return v=v.nodeType!==1||w.toLowerCase()!==v.nodeName.toLowerCase()?null:v,v!==null?(d.stateNode=v,Lr=d,Br=Sn(v.firstChild),!0):!1;case 6:return v=d.pendingProps===""||v.nodeType!==3?null:v,v!==null?(d.stateNode=v,Lr=d,Br=null,!0):!1;case 13:return v=v.nodeType!==8?null:v,v!==null?(w=Un!==null?{id:sn,overflow:ln}:null,d.memoizedState={dehydrated:v,treeContext:w,retryLane:1073741824},w=qr(18,null,null,0),w.stateNode=v,w.return=d,d.child=w,Lr=d,Br=null,!0):!1;default:return!1}}function Oo(d){return(d.mode&1)!==0&&(d.flags&128)===0}function Do(d){if(Kt){var v=Br;if(v){var w=v;if(!El(d,v)){if(Oo(d))throw Error(r(418));v=Sn(w.nextSibling);var I=Lr;v&&El(d,v)?wl(I,w):(d.flags=d.flags&-4097|2,Kt=!1,Lr=d)}}else{if(Oo(d))throw Error(r(418));d.flags=d.flags&-4097|2,Kt=!1,Lr=d}}}function Tl(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;Lr=d}function wa(d){if(d!==Lr)return!1;if(!Kt)return Tl(d),Kt=!0,!1;var v;if((v=d.tag!==3)&&!(v=d.tag!==5)&&(v=d.type,v=v!=="head"&&v!=="body"&&!To(d.type,d.memoizedProps)),v&&(v=Br)){if(Oo(d))throw Cl(),Error(r(418));for(;v;)wl(d,v),v=Sn(v.nextSibling)}if(Tl(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));e:{for(d=d.nextSibling,v=0;d;){if(d.nodeType===8){var w=d.data;if(w==="/$"){if(v===0){Br=Sn(d.nextSibling);break e}v--}else w!=="$"&&w!=="$!"&&w!=="$?"||v++}d=d.nextSibling}Br=null}}else Br=Lr?Sn(d.stateNode.nextSibling):null;return!0}function Cl(){for(var d=Br;d;)d=Sn(d.nextSibling)}function hi(){Br=Lr=null,Kt=!1}function ko(d){Qr===null?Qr=[d]:Qr.push(d)}var Zc=P.ReactCurrentBatchConfig;function Gi(d,v,w){if(d=w.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(w._owner){if(w=w._owner,w){if(w.tag!==1)throw Error(r(309));var I=w.stateNode}if(!I)throw Error(r(147,d));var D=I,U=""+d;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===U?v.ref:(v=function($){var de=D.refs;$===null?delete de[U]:de[U]=$},v._stringRef=U,v)}if(typeof d!="string")throw Error(r(284));if(!w._owner)throw Error(r(290,d))}return d}function Ea(d,v){throw d=Object.prototype.toString.call(v),Error(r(31,d==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":d))}function Pl(d){var v=d._init;return v(d._payload)}function Rl(d){function v(Ce,xe){if(d){var Be=Ce.deletions;Be===null?(Ce.deletions=[xe],Ce.flags|=16):Be.push(xe)}}function w(Ce,xe){if(!d)return null;for(;xe!==null;)v(Ce,xe),xe=xe.sibling;return null}function I(Ce,xe){for(Ce=new Map;xe!==null;)xe.key!==null?Ce.set(xe.key,xe):Ce.set(xe.index,xe),xe=xe.sibling;return Ce}function D(Ce,xe){return Ce=Fn(Ce,xe),Ce.index=0,Ce.sibling=null,Ce}function U(Ce,xe,Be){return Ce.index=Be,d?(Be=Ce.alternate,Be!==null?(Be=Be.index,Be<xe?(Ce.flags|=2,xe):Be):(Ce.flags|=2,xe)):(Ce.flags|=1048576,xe)}function $(Ce){return d&&Ce.alternate===null&&(Ce.flags|=2),Ce}function de(Ce,xe,Be,rt){return xe===null||xe.tag!==6?(xe=Cs(Be,Ce.mode,rt),xe.return=Ce,xe):(xe=D(xe,Be),xe.return=Ce,xe)}function ye(Ce,xe,Be,rt){var At=Be.type;return At===N?Ke(Ce,xe,Be.props.children,rt,Be.key):xe!==null&&(xe.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===te&&Pl(At)===xe.type)?(rt=D(xe,Be.props),rt.ref=Gi(Ce,xe,Be),rt.return=Ce,rt):(rt=Ka(Be.type,Be.key,Be.props,null,Ce.mode,rt),rt.ref=Gi(Ce,xe,Be),rt.return=Ce,rt)}function Oe(Ce,xe,Be,rt){return xe===null||xe.tag!==4||xe.stateNode.containerInfo!==Be.containerInfo||xe.stateNode.implementation!==Be.implementation?(xe=Ps(Be,Ce.mode,rt),xe.return=Ce,xe):(xe=D(xe,Be.children||[]),xe.return=Ce,xe)}function Ke(Ce,xe,Be,rt,At){return xe===null||xe.tag!==7?(xe=Kn(Be,Ce.mode,rt,At),xe.return=Ce,xe):(xe=D(xe,Be),xe.return=Ce,xe)}function $e(Ce,xe,Be){if(typeof xe=="string"&&xe!==""||typeof xe=="number")return xe=Cs(""+xe,Ce.mode,Be),xe.return=Ce,xe;if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case F:return Be=Ka(xe.type,xe.key,xe.props,null,Ce.mode,Be),Be.ref=Gi(Ce,null,xe),Be.return=Ce,Be;case O:return xe=Ps(xe,Ce.mode,Be),xe.return=Ce,xe;case te:var rt=xe._init;return $e(Ce,rt(xe._payload),Be)}if(Me(xe)||Z(xe))return xe=Kn(xe,Ce.mode,Be,null),xe.return=Ce,xe;Ea(Ce,xe)}return null}function Je(Ce,xe,Be,rt){var At=xe!==null?xe.key:null;if(typeof Be=="string"&&Be!==""||typeof Be=="number")return At!==null?null:de(Ce,xe,""+Be,rt);if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case F:return Be.key===At?ye(Ce,xe,Be,rt):null;case O:return Be.key===At?Oe(Ce,xe,Be,rt):null;case te:return At=Be._init,Je(Ce,xe,At(Be._payload),rt)}if(Me(Be)||Z(Be))return At!==null?null:Ke(Ce,xe,Be,rt,null);Ea(Ce,Be)}return null}function ct(Ce,xe,Be,rt,At){if(typeof rt=="string"&&rt!==""||typeof rt=="number")return Ce=Ce.get(Be)||null,de(xe,Ce,""+rt,At);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case F:return Ce=Ce.get(rt.key===null?Be:rt.key)||null,ye(xe,Ce,rt,At);case O:return Ce=Ce.get(rt.key===null?Be:rt.key)||null,Oe(xe,Ce,rt,At);case te:var Mt=rt._init;return ct(Ce,xe,Be,Mt(rt._payload),At)}if(Me(rt)||Z(rt))return Ce=Ce.get(Be)||null,Ke(xe,Ce,rt,At,null);Ea(xe,rt)}return null}function pt(Ce,xe,Be,rt){for(var At=null,Mt=null,wt=xe,Ct=xe=0,dr=null;wt!==null&&Ct<Be.length;Ct++){wt.index>Ct?(dr=wt,wt=null):dr=wt.sibling;var qt=Je(Ce,wt,Be[Ct],rt);if(qt===null){wt===null&&(wt=dr);break}d&&wt&&qt.alternate===null&&v(Ce,wt),xe=U(qt,xe,Ct),Mt===null?At=qt:Mt.sibling=qt,Mt=qt,wt=dr}if(Ct===Be.length)return w(Ce,wt),Kt&&Gn(Ce,Ct),At;if(wt===null){for(;Ct<Be.length;Ct++)wt=$e(Ce,Be[Ct],rt),wt!==null&&(xe=U(wt,xe,Ct),Mt===null?At=wt:Mt.sibling=wt,Mt=wt);return Kt&&Gn(Ce,Ct),At}for(wt=I(Ce,wt);Ct<Be.length;Ct++)dr=ct(wt,Ce,Ct,Be[Ct],rt),dr!==null&&(d&&dr.alternate!==null&&wt.delete(dr.key===null?Ct:dr.key),xe=U(dr,xe,Ct),Mt===null?At=dr:Mt.sibling=dr,Mt=dr);return d&&wt.forEach(function(On){return v(Ce,On)}),Kt&&Gn(Ce,Ct),At}function mt(Ce,xe,Be,rt){var At=Z(Be);if(typeof At!="function")throw Error(r(150));if(Be=At.call(Be),Be==null)throw Error(r(151));for(var Mt=At=null,wt=xe,Ct=xe=0,dr=null,qt=Be.next();wt!==null&&!qt.done;Ct++,qt=Be.next()){wt.index>Ct?(dr=wt,wt=null):dr=wt.sibling;var On=Je(Ce,wt,qt.value,rt);if(On===null){wt===null&&(wt=dr);break}d&&wt&&On.alternate===null&&v(Ce,wt),xe=U(On,xe,Ct),Mt===null?At=On:Mt.sibling=On,Mt=On,wt=dr}if(qt.done)return w(Ce,wt),Kt&&Gn(Ce,Ct),At;if(wt===null){for(;!qt.done;Ct++,qt=Be.next())qt=$e(Ce,qt.value,rt),qt!==null&&(xe=U(qt,xe,Ct),Mt===null?At=qt:Mt.sibling=qt,Mt=qt);return Kt&&Gn(Ce,Ct),At}for(wt=I(Ce,wt);!qt.done;Ct++,qt=Be.next())qt=ct(wt,Ce,Ct,qt.value,rt),qt!==null&&(d&&qt.alternate!==null&&wt.delete(qt.key===null?Ct:qt.key),xe=U(qt,xe,Ct),Mt===null?At=qt:Mt.sibling=qt,Mt=qt);return d&&wt.forEach(function(Rh){return v(Ce,Rh)}),Kt&&Gn(Ce,Ct),At}function ar(Ce,xe,Be,rt){if(typeof Be=="object"&&Be!==null&&Be.type===N&&Be.key===null&&(Be=Be.props.children),typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case F:e:{for(var At=Be.key,Mt=xe;Mt!==null;){if(Mt.key===At){if(At=Be.type,At===N){if(Mt.tag===7){w(Ce,Mt.sibling),xe=D(Mt,Be.props.children),xe.return=Ce,Ce=xe;break e}}else if(Mt.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===te&&Pl(At)===Mt.type){w(Ce,Mt.sibling),xe=D(Mt,Be.props),xe.ref=Gi(Ce,Mt,Be),xe.return=Ce,Ce=xe;break e}w(Ce,Mt);break}else v(Ce,Mt);Mt=Mt.sibling}Be.type===N?(xe=Kn(Be.props.children,Ce.mode,rt,Be.key),xe.return=Ce,Ce=xe):(rt=Ka(Be.type,Be.key,Be.props,null,Ce.mode,rt),rt.ref=Gi(Ce,xe,Be),rt.return=Ce,Ce=rt)}return $(Ce);case O:e:{for(Mt=Be.key;xe!==null;){if(xe.key===Mt)if(xe.tag===4&&xe.stateNode.containerInfo===Be.containerInfo&&xe.stateNode.implementation===Be.implementation){w(Ce,xe.sibling),xe=D(xe,Be.children||[]),xe.return=Ce,Ce=xe;break e}else{w(Ce,xe);break}else v(Ce,xe);xe=xe.sibling}xe=Ps(Be,Ce.mode,rt),xe.return=Ce,Ce=xe}return $(Ce);case te:return Mt=Be._init,ar(Ce,xe,Mt(Be._payload),rt)}if(Me(Be))return pt(Ce,xe,Be,rt);if(Z(Be))return mt(Ce,xe,Be,rt);Ea(Ce,Be)}return typeof Be=="string"&&Be!==""||typeof Be=="number"?(Be=""+Be,xe!==null&&xe.tag===6?(w(Ce,xe.sibling),xe=D(xe,Be),xe.return=Ce,Ce=xe):(w(Ce,xe),xe=Cs(Be,Ce.mode,rt),xe.return=Ce,Ce=xe),$(Ce)):w(Ce,xe)}return ar}var di=Rl(!0),Il=Rl(!1),Ta=Mn(null),Ca=null,pi=null,No=null;function Vo(){No=pi=Ca=null}function zo(d){var v=Ta.current;Jt(Ta),d._currentValue=v}function Uo(d,v,w){for(;d!==null;){var I=d.alternate;if((d.childLanes&v)!==v?(d.childLanes|=v,I!==null&&(I.childLanes|=v)):I!==null&&(I.childLanes&v)!==v&&(I.childLanes|=v),d===w)break;d=d.return}}function fi(d,v){Ca=d,No=pi=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&v)!==0&&(Tr=!0),d.firstContext=null)}function Ur(d){var v=d._currentValue;if(No!==d)if(d={context:d,memoizedValue:v,next:null},pi===null){if(Ca===null)throw Error(r(308));pi=d,Ca.dependencies={lanes:0,firstContext:d}}else pi=pi.next=d;return v}var Hn=null;function Go(d){Hn===null?Hn=[d]:Hn.push(d)}function Ll(d,v,w,I){var D=v.interleaved;return D===null?(w.next=w,Go(v)):(w.next=D.next,D.next=w),v.interleaved=w,un(d,I)}function un(d,v){d.lanes|=v;var w=d.alternate;for(w!==null&&(w.lanes|=v),w=d,d=d.return;d!==null;)d.childLanes|=v,w=d.alternate,w!==null&&(w.childLanes|=v),w=d,d=d.return;return w.tag===3?w.stateNode:null}var Tn=!1;function Ho(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bl(d,v){d=d.updateQueue,v.updateQueue===d&&(v.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function cn(d,v){return{eventTime:d,lane:v,tag:0,payload:null,callback:null,next:null}}function Cn(d,v,w){var I=d.updateQueue;if(I===null)return null;if(I=I.shared,(Ut&2)!==0){var D=I.pending;return D===null?v.next=v:(v.next=D.next,D.next=v),I.pending=v,un(d,w)}return D=I.interleaved,D===null?(v.next=v,Go(I)):(v.next=D.next,D.next=v),I.interleaved=v,un(d,w)}function Pa(d,v,w){if(v=v.updateQueue,v!==null&&(v=v.shared,(w&4194240)!==0)){var I=v.lanes;I&=d.pendingLanes,w|=I,v.lanes=w,me(d,w)}}function Fl(d,v){var w=d.updateQueue,I=d.alternate;if(I!==null&&(I=I.updateQueue,w===I)){var D=null,U=null;if(w=w.firstBaseUpdate,w!==null){do{var $={eventTime:w.eventTime,lane:w.lane,tag:w.tag,payload:w.payload,callback:w.callback,next:null};U===null?D=U=$:U=U.next=$,w=w.next}while(w!==null);U===null?D=U=v:U=U.next=v}else D=U=v;w={baseState:I.baseState,firstBaseUpdate:D,lastBaseUpdate:U,shared:I.shared,effects:I.effects},d.updateQueue=w;return}d=w.lastBaseUpdate,d===null?w.firstBaseUpdate=v:d.next=v,w.lastBaseUpdate=v}function Ra(d,v,w,I){var D=d.updateQueue;Tn=!1;var U=D.firstBaseUpdate,$=D.lastBaseUpdate,de=D.shared.pending;if(de!==null){D.shared.pending=null;var ye=de,Oe=ye.next;ye.next=null,$===null?U=Oe:$.next=Oe,$=ye;var Ke=d.alternate;Ke!==null&&(Ke=Ke.updateQueue,de=Ke.lastBaseUpdate,de!==$&&(de===null?Ke.firstBaseUpdate=Oe:de.next=Oe,Ke.lastBaseUpdate=ye))}if(U!==null){var $e=D.baseState;$=0,Ke=Oe=ye=null,de=U;do{var Je=de.lane,ct=de.eventTime;if((I&Je)===Je){Ke!==null&&(Ke=Ke.next={eventTime:ct,lane:0,tag:de.tag,payload:de.payload,callback:de.callback,next:null});e:{var pt=d,mt=de;switch(Je=v,ct=w,mt.tag){case 1:if(pt=mt.payload,typeof pt=="function"){$e=pt.call(ct,$e,Je);break e}$e=pt;break e;case 3:pt.flags=pt.flags&-65537|128;case 0:if(pt=mt.payload,Je=typeof pt=="function"?pt.call(ct,$e,Je):pt,Je==null)break e;$e=ee({},$e,Je);break e;case 2:Tn=!0}}de.callback!==null&&de.lane!==0&&(d.flags|=64,Je=D.effects,Je===null?D.effects=[de]:Je.push(de))}else ct={eventTime:ct,lane:Je,tag:de.tag,payload:de.payload,callback:de.callback,next:null},Ke===null?(Oe=Ke=ct,ye=$e):Ke=Ke.next=ct,$|=Je;if(de=de.next,de===null){if(de=D.shared.pending,de===null)break;Je=de,de=Je.next,Je.next=null,D.lastBaseUpdate=Je,D.shared.pending=null}}while(!0);if(Ke===null&&(ye=$e),D.baseState=ye,D.firstBaseUpdate=Oe,D.lastBaseUpdate=Ke,v=D.shared.interleaved,v!==null){D=v;do $|=D.lane,D=D.next;while(D!==v)}else U===null&&(D.shared.lanes=0);Wn|=$,d.lanes=$,d.memoizedState=$e}}function Ol(d,v,w){if(d=v.effects,v.effects=null,d!==null)for(v=0;v<d.length;v++){var I=d[v],D=I.callback;if(D!==null){if(I.callback=null,I=w,typeof D!="function")throw Error(r(191,D));D.call(I)}}}var Hi={},tn=Mn(Hi),qi=Mn(Hi),ji=Mn(Hi);function qn(d){if(d===Hi)throw Error(r(174));return d}function qo(d,v){switch(Wt(ji,v),Wt(qi,d),Wt(tn,Hi),d=v.nodeType,d){case 9:case 11:v=(v=v.documentElement)?v.namespaceURI:Ue(null,"");break;default:d=d===8?v.parentNode:v,v=d.namespaceURI||null,d=d.tagName,v=Ue(v,d)}Jt(tn),Wt(tn,v)}function vi(){Jt(tn),Jt(qi),Jt(ji)}function Dl(d){qn(ji.current);var v=qn(tn.current),w=Ue(v,d.type);v!==w&&(Wt(qi,d),Wt(tn,w))}function jo(d){qi.current===d&&(Jt(tn),Jt(qi))}var er=Mn(0);function Ia(d){for(var v=d;v!==null;){if(v.tag===13){var w=v.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===d)break;for(;v.sibling===null;){if(v.return===null||v.return===d)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var Wo=[];function Qo(){for(var d=0;d<Wo.length;d++)Wo[d]._workInProgressVersionPrimary=null;Wo.length=0}var La=P.ReactCurrentDispatcher,Jo=P.ReactCurrentBatchConfig,jn=0,tr=null,lr=null,cr=null,Ba=!1,Wi=!1,Qi=0,Yc=0;function Ar(){throw Error(r(321))}function Xo(d,v){if(v===null)return!1;for(var w=0;w<v.length&&w<d.length;w++)if(!Wr(d[w],v[w]))return!1;return!0}function Ko(d,v,w,I,D,U){if(jn=U,tr=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,La.current=d===null||d.memoizedState===null?rh:nh,d=w(I,D),Wi){U=0;do{if(Wi=!1,Qi=0,25<=U)throw Error(r(301));U+=1,cr=lr=null,v.updateQueue=null,La.current=ih,d=w(I,D)}while(Wi)}if(La.current=Da,v=lr!==null&&lr.next!==null,jn=0,cr=lr=tr=null,Ba=!1,v)throw Error(r(300));return d}function Zo(){var d=Qi!==0;return Qi=0,d}function rn(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cr===null?tr.memoizedState=cr=d:cr=cr.next=d,cr}function Gr(){if(lr===null){var d=tr.alternate;d=d!==null?d.memoizedState:null}else d=lr.next;var v=cr===null?tr.memoizedState:cr.next;if(v!==null)cr=v,lr=d;else{if(d===null)throw Error(r(310));lr=d,d={memoizedState:lr.memoizedState,baseState:lr.baseState,baseQueue:lr.baseQueue,queue:lr.queue,next:null},cr===null?tr.memoizedState=cr=d:cr=cr.next=d}return cr}function Ji(d,v){return typeof v=="function"?v(d):v}function Yo(d){var v=Gr(),w=v.queue;if(w===null)throw Error(r(311));w.lastRenderedReducer=d;var I=lr,D=I.baseQueue,U=w.pending;if(U!==null){if(D!==null){var $=D.next;D.next=U.next,U.next=$}I.baseQueue=D=U,w.pending=null}if(D!==null){U=D.next,I=I.baseState;var de=$=null,ye=null,Oe=U;do{var Ke=Oe.lane;if((jn&Ke)===Ke)ye!==null&&(ye=ye.next={lane:0,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null}),I=Oe.hasEagerState?Oe.eagerState:d(I,Oe.action);else{var $e={lane:Ke,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null};ye===null?(de=ye=$e,$=I):ye=ye.next=$e,tr.lanes|=Ke,Wn|=Ke}Oe=Oe.next}while(Oe!==null&&Oe!==U);ye===null?$=I:ye.next=de,Wr(I,v.memoizedState)||(Tr=!0),v.memoizedState=I,v.baseState=$,v.baseQueue=ye,w.lastRenderedState=I}if(d=w.interleaved,d!==null){D=d;do U=D.lane,tr.lanes|=U,Wn|=U,D=D.next;while(D!==d)}else D===null&&(w.lanes=0);return[v.memoizedState,w.dispatch]}function $o(d){var v=Gr(),w=v.queue;if(w===null)throw Error(r(311));w.lastRenderedReducer=d;var I=w.dispatch,D=w.pending,U=v.memoizedState;if(D!==null){w.pending=null;var $=D=D.next;do U=d(U,$.action),$=$.next;while($!==D);Wr(U,v.memoizedState)||(Tr=!0),v.memoizedState=U,v.baseQueue===null&&(v.baseState=U),w.lastRenderedState=U}return[U,I]}function kl(){}function Nl(d,v){var w=tr,I=Gr(),D=v(),U=!Wr(I.memoizedState,D);if(U&&(I.memoizedState=D,Tr=!0),I=I.queue,es(Ul.bind(null,w,I,d),[d]),I.getSnapshot!==v||U||cr!==null&&cr.memoizedState.tag&1){if(w.flags|=2048,Xi(9,zl.bind(null,w,I,D,v),void 0,null),hr===null)throw Error(r(349));(jn&30)!==0||Vl(w,v,D)}return D}function Vl(d,v,w){d.flags|=16384,d={getSnapshot:v,value:w},v=tr.updateQueue,v===null?(v={lastEffect:null,stores:null},tr.updateQueue=v,v.stores=[d]):(w=v.stores,w===null?v.stores=[d]:w.push(d))}function zl(d,v,w,I){v.value=w,v.getSnapshot=I,Gl(v)&&Hl(d)}function Ul(d,v,w){return w(function(){Gl(v)&&Hl(d)})}function Gl(d){var v=d.getSnapshot;d=d.value;try{var w=v();return!Wr(d,w)}catch{return!0}}function Hl(d){var v=un(d,1);v!==null&&Zr(v,d,1,-1)}function ql(d){var v=rn();return typeof d=="function"&&(d=d()),v.memoizedState=v.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ji,lastRenderedState:d},v.queue=d,d=d.dispatch=th.bind(null,tr,d),[v.memoizedState,d]}function Xi(d,v,w,I){return d={tag:d,create:v,destroy:w,deps:I,next:null},v=tr.updateQueue,v===null?(v={lastEffect:null,stores:null},tr.updateQueue=v,v.lastEffect=d.next=d):(w=v.lastEffect,w===null?v.lastEffect=d.next=d:(I=w.next,w.next=d,d.next=I,v.lastEffect=d)),d}function jl(){return Gr().memoizedState}function Fa(d,v,w,I){var D=rn();tr.flags|=d,D.memoizedState=Xi(1|v,w,void 0,I===void 0?null:I)}function Oa(d,v,w,I){var D=Gr();I=I===void 0?null:I;var U=void 0;if(lr!==null){var $=lr.memoizedState;if(U=$.destroy,I!==null&&Xo(I,$.deps)){D.memoizedState=Xi(v,w,U,I);return}}tr.flags|=d,D.memoizedState=Xi(1|v,w,U,I)}function Wl(d,v){return Fa(8390656,8,d,v)}function es(d,v){return Oa(2048,8,d,v)}function Ql(d,v){return Oa(4,2,d,v)}function Jl(d,v){return Oa(4,4,d,v)}function Xl(d,v){if(typeof v=="function")return d=d(),v(d),function(){v(null)};if(v!=null)return d=d(),v.current=d,function(){v.current=null}}function Kl(d,v,w){return w=w!=null?w.concat([d]):null,Oa(4,4,Xl.bind(null,v,d),w)}function ts(){}function Zl(d,v){var w=Gr();v=v===void 0?null:v;var I=w.memoizedState;return I!==null&&v!==null&&Xo(v,I[1])?I[0]:(w.memoizedState=[d,v],d)}function Yl(d,v){var w=Gr();v=v===void 0?null:v;var I=w.memoizedState;return I!==null&&v!==null&&Xo(v,I[1])?I[0]:(d=d(),w.memoizedState=[d,v],d)}function $l(d,v,w){return(jn&21)===0?(d.baseState&&(d.baseState=!1,Tr=!0),d.memoizedState=w):(Wr(w,v)||(w=Si(),tr.lanes|=w,Wn|=w,d.baseState=!0),v)}function $c(d,v){var w=Ee;Ee=w!==0&&4>w?w:4,d(!0);var I=Jo.transition;Jo.transition={};try{d(!1),v()}finally{Ee=w,Jo.transition=I}}function eu(){return Gr().memoizedState}function eh(d,v,w){var I=Ln(d);if(w={lane:I,action:w,hasEagerState:!1,eagerState:null,next:null},tu(d))ru(v,w);else if(w=Ll(d,v,w,I),w!==null){var D=Sr();Zr(w,d,I,D),nu(w,v,I)}}function th(d,v,w){var I=Ln(d),D={lane:I,action:w,hasEagerState:!1,eagerState:null,next:null};if(tu(d))ru(v,D);else{var U=d.alternate;if(d.lanes===0&&(U===null||U.lanes===0)&&(U=v.lastRenderedReducer,U!==null))try{var $=v.lastRenderedState,de=U($,w);if(D.hasEagerState=!0,D.eagerState=de,Wr(de,$)){var ye=v.interleaved;ye===null?(D.next=D,Go(v)):(D.next=ye.next,ye.next=D),v.interleaved=D;return}}catch{}finally{}w=Ll(d,v,D,I),w!==null&&(D=Sr(),Zr(w,d,I,D),nu(w,v,I))}}function tu(d){var v=d.alternate;return d===tr||v!==null&&v===tr}function ru(d,v){Wi=Ba=!0;var w=d.pending;w===null?v.next=v:(v.next=w.next,w.next=v),d.pending=v}function nu(d,v,w){if((w&4194240)!==0){var I=v.lanes;I&=d.pendingLanes,w|=I,v.lanes=w,me(d,w)}}var Da={readContext:Ur,useCallback:Ar,useContext:Ar,useEffect:Ar,useImperativeHandle:Ar,useInsertionEffect:Ar,useLayoutEffect:Ar,useMemo:Ar,useReducer:Ar,useRef:Ar,useState:Ar,useDebugValue:Ar,useDeferredValue:Ar,useTransition:Ar,useMutableSource:Ar,useSyncExternalStore:Ar,useId:Ar,unstable_isNewReconciler:!1},rh={readContext:Ur,useCallback:function(d,v){return rn().memoizedState=[d,v===void 0?null:v],d},useContext:Ur,useEffect:Wl,useImperativeHandle:function(d,v,w){return w=w!=null?w.concat([d]):null,Fa(4194308,4,Xl.bind(null,v,d),w)},useLayoutEffect:function(d,v){return Fa(4194308,4,d,v)},useInsertionEffect:function(d,v){return Fa(4,2,d,v)},useMemo:function(d,v){var w=rn();return v=v===void 0?null:v,d=d(),w.memoizedState=[d,v],d},useReducer:function(d,v,w){var I=rn();return v=w!==void 0?w(v):v,I.memoizedState=I.baseState=v,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:v},I.queue=d,d=d.dispatch=eh.bind(null,tr,d),[I.memoizedState,d]},useRef:function(d){var v=rn();return d={current:d},v.memoizedState=d},useState:ql,useDebugValue:ts,useDeferredValue:function(d){return rn().memoizedState=d},useTransition:function(){var d=ql(!1),v=d[0];return d=$c.bind(null,d[1]),rn().memoizedState=d,[v,d]},useMutableSource:function(){},useSyncExternalStore:function(d,v,w){var I=tr,D=rn();if(Kt){if(w===void 0)throw Error(r(407));w=w()}else{if(w=v(),hr===null)throw Error(r(349));(jn&30)!==0||Vl(I,v,w)}D.memoizedState=w;var U={value:w,getSnapshot:v};return D.queue=U,Wl(Ul.bind(null,I,U,d),[d]),I.flags|=2048,Xi(9,zl.bind(null,I,U,w,v),void 0,null),w},useId:function(){var d=rn(),v=hr.identifierPrefix;if(Kt){var w=ln,I=sn;w=(I&~(1<<32-Yt(I)-1)).toString(32)+w,v=":"+v+"R"+w,w=Qi++,0<w&&(v+="H"+w.toString(32)),v+=":"}else w=Yc++,v=":"+v+"r"+w.toString(32)+":";return d.memoizedState=v},unstable_isNewReconciler:!1},nh={readContext:Ur,useCallback:Zl,useContext:Ur,useEffect:es,useImperativeHandle:Kl,useInsertionEffect:Ql,useLayoutEffect:Jl,useMemo:Yl,useReducer:Yo,useRef:jl,useState:function(){return Yo(Ji)},useDebugValue:ts,useDeferredValue:function(d){var v=Gr();return $l(v,lr.memoizedState,d)},useTransition:function(){var d=Yo(Ji)[0],v=Gr().memoizedState;return[d,v]},useMutableSource:kl,useSyncExternalStore:Nl,useId:eu,unstable_isNewReconciler:!1},ih={readContext:Ur,useCallback:Zl,useContext:Ur,useEffect:es,useImperativeHandle:Kl,useInsertionEffect:Ql,useLayoutEffect:Jl,useMemo:Yl,useReducer:$o,useRef:jl,useState:function(){return $o(Ji)},useDebugValue:ts,useDeferredValue:function(d){var v=Gr();return lr===null?v.memoizedState=d:$l(v,lr.memoizedState,d)},useTransition:function(){var d=$o(Ji)[0],v=Gr().memoizedState;return[d,v]},useMutableSource:kl,useSyncExternalStore:Nl,useId:eu,unstable_isNewReconciler:!1};function Jr(d,v){if(d&&d.defaultProps){v=ee({},v),d=d.defaultProps;for(var w in d)v[w]===void 0&&(v[w]=d[w]);return v}return v}function rs(d,v,w,I){v=d.memoizedState,w=w(I,v),w=w==null?v:ee({},v,w),d.memoizedState=w,d.lanes===0&&(d.updateQueue.baseState=w)}var ka={isMounted:function(d){return(d=d._reactInternals)?St(d)===d:!1},enqueueSetState:function(d,v,w){d=d._reactInternals;var I=Sr(),D=Ln(d),U=cn(I,D);U.payload=v,w!=null&&(U.callback=w),v=Cn(d,U,D),v!==null&&(Zr(v,d,D,I),Pa(v,d,D))},enqueueReplaceState:function(d,v,w){d=d._reactInternals;var I=Sr(),D=Ln(d),U=cn(I,D);U.tag=1,U.payload=v,w!=null&&(U.callback=w),v=Cn(d,U,D),v!==null&&(Zr(v,d,D,I),Pa(v,d,D))},enqueueForceUpdate:function(d,v){d=d._reactInternals;var w=Sr(),I=Ln(d),D=cn(w,I);D.tag=2,v!=null&&(D.callback=v),v=Cn(d,D,I),v!==null&&(Zr(v,d,I,w),Pa(v,d,I))}};function iu(d,v,w,I,D,U,$){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(I,U,$):v.prototype&&v.prototype.isPureReactComponent?!Oi(w,I)||!Oi(D,U):!0}function au(d,v,w){var I=!1,D=wn,U=v.contextType;return typeof U=="object"&&U!==null?U=Ur(U):(D=Er(v)?zn:yr.current,I=v.contextTypes,U=(I=I!=null)?li(d,D):wn),v=new v(w,U),d.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=ka,d.stateNode=v,v._reactInternals=d,I&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=D,d.__reactInternalMemoizedMaskedChildContext=U),v}function ou(d,v,w,I){d=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(w,I),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(w,I),v.state!==d&&ka.enqueueReplaceState(v,v.state,null)}function ns(d,v,w,I){var D=d.stateNode;D.props=w,D.state=d.memoizedState,D.refs={},Ho(d);var U=v.contextType;typeof U=="object"&&U!==null?D.context=Ur(U):(U=Er(v)?zn:yr.current,D.context=li(d,U)),D.state=d.memoizedState,U=v.getDerivedStateFromProps,typeof U=="function"&&(rs(d,v,U,w),D.state=d.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof D.getSnapshotBeforeUpdate=="function"||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(v=D.state,typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount(),v!==D.state&&ka.enqueueReplaceState(D,D.state,null),Ra(d,w,D,I),D.state=d.memoizedState),typeof D.componentDidMount=="function"&&(d.flags|=4194308)}function mi(d,v){try{var w="",I=v;do w+=_e(I),I=I.return;while(I);var D=w}catch(U){D=`
Error generating stack: `+U.message+`
`+U.stack}return{value:d,source:v,stack:D,digest:null}}function is(d,v,w){return{value:d,source:null,stack:w??null,digest:v??null}}function as(d,v){try{console.error(v.value)}catch(w){setTimeout(function(){throw w})}}var ah=typeof WeakMap=="function"?WeakMap:Map;function su(d,v,w){w=cn(-1,w),w.tag=3,w.payload={element:null};var I=v.value;return w.callback=function(){qa||(qa=!0,bs=I),as(d,v)},w}function lu(d,v,w){w=cn(-1,w),w.tag=3;var I=d.type.getDerivedStateFromError;if(typeof I=="function"){var D=v.value;w.payload=function(){return I(D)},w.callback=function(){as(d,v)}}var U=d.stateNode;return U!==null&&typeof U.componentDidCatch=="function"&&(w.callback=function(){as(d,v),typeof I!="function"&&(Rn===null?Rn=new Set([this]):Rn.add(this));var $=v.stack;this.componentDidCatch(v.value,{componentStack:$!==null?$:""})}),w}function uu(d,v,w){var I=d.pingCache;if(I===null){I=d.pingCache=new ah;var D=new Set;I.set(v,D)}else D=I.get(v),D===void 0&&(D=new Set,I.set(v,D));D.has(w)||(D.add(w),d=Ah.bind(null,d,v,w),v.then(d,d))}function cu(d){do{var v;if((v=d.tag===13)&&(v=d.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return d;d=d.return}while(d!==null);return null}function hu(d,v,w,I,D){return(d.mode&1)===0?(d===v?d.flags|=65536:(d.flags|=128,w.flags|=131072,w.flags&=-52805,w.tag===1&&(w.alternate===null?w.tag=17:(v=cn(-1,1),v.tag=2,Cn(w,v,1))),w.lanes|=1),d):(d.flags|=65536,d.lanes=D,d)}var oh=P.ReactCurrentOwner,Tr=!1;function _r(d,v,w,I){v.child=d===null?Il(v,null,w,I):di(v,d.child,w,I)}function du(d,v,w,I,D){w=w.render;var U=v.ref;return fi(v,D),I=Ko(d,v,w,I,U,D),w=Zo(),d!==null&&!Tr?(v.updateQueue=d.updateQueue,v.flags&=-2053,d.lanes&=~D,hn(d,v,D)):(Kt&&w&&Bo(v),v.flags|=1,_r(d,v,I,D),v.child)}function pu(d,v,w,I,D){if(d===null){var U=w.type;return typeof U=="function"&&!Ts(U)&&U.defaultProps===void 0&&w.compare===null&&w.defaultProps===void 0?(v.tag=15,v.type=U,fu(d,v,U,I,D)):(d=Ka(w.type,null,I,v,v.mode,D),d.ref=v.ref,d.return=v,v.child=d)}if(U=d.child,(d.lanes&D)===0){var $=U.memoizedProps;if(w=w.compare,w=w!==null?w:Oi,w($,I)&&d.ref===v.ref)return hn(d,v,D)}return v.flags|=1,d=Fn(U,I),d.ref=v.ref,d.return=v,v.child=d}function fu(d,v,w,I,D){if(d!==null){var U=d.memoizedProps;if(Oi(U,I)&&d.ref===v.ref)if(Tr=!1,v.pendingProps=I=U,(d.lanes&D)!==0)(d.flags&131072)!==0&&(Tr=!0);else return v.lanes=d.lanes,hn(d,v,D)}return os(d,v,w,I,D)}function vu(d,v,w){var I=v.pendingProps,D=I.children,U=d!==null?d.memoizedState:null;if(I.mode==="hidden")if((v.mode&1)===0)v.memoizedState={baseLanes:0,cachePool:null,transitions:null},Wt(yi,Fr),Fr|=w;else{if((w&1073741824)===0)return d=U!==null?U.baseLanes|w:w,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:d,cachePool:null,transitions:null},v.updateQueue=null,Wt(yi,Fr),Fr|=d,null;v.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=U!==null?U.baseLanes:w,Wt(yi,Fr),Fr|=I}else U!==null?(I=U.baseLanes|w,v.memoizedState=null):I=w,Wt(yi,Fr),Fr|=I;return _r(d,v,D,w),v.child}function mu(d,v){var w=v.ref;(d===null&&w!==null||d!==null&&d.ref!==w)&&(v.flags|=512,v.flags|=2097152)}function os(d,v,w,I,D){var U=Er(w)?zn:yr.current;return U=li(v,U),fi(v,D),w=Ko(d,v,w,I,U,D),I=Zo(),d!==null&&!Tr?(v.updateQueue=d.updateQueue,v.flags&=-2053,d.lanes&=~D,hn(d,v,D)):(Kt&&I&&Bo(v),v.flags|=1,_r(d,v,w,D),v.child)}function gu(d,v,w,I,D){if(Er(w)){var U=!0;ba(v)}else U=!1;if(fi(v,D),v.stateNode===null)Va(d,v),au(v,w,I),ns(v,w,I,D),I=!0;else if(d===null){var $=v.stateNode,de=v.memoizedProps;$.props=de;var ye=$.context,Oe=w.contextType;typeof Oe=="object"&&Oe!==null?Oe=Ur(Oe):(Oe=Er(w)?zn:yr.current,Oe=li(v,Oe));var Ke=w.getDerivedStateFromProps,$e=typeof Ke=="function"||typeof $.getSnapshotBeforeUpdate=="function";$e||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(de!==I||ye!==Oe)&&ou(v,$,I,Oe),Tn=!1;var Je=v.memoizedState;$.state=Je,Ra(v,I,$,D),ye=v.memoizedState,de!==I||Je!==ye||wr.current||Tn?(typeof Ke=="function"&&(rs(v,w,Ke,I),ye=v.memoizedState),(de=Tn||iu(v,w,de,I,Je,ye,Oe))?($e||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount()),typeof $.componentDidMount=="function"&&(v.flags|=4194308)):(typeof $.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=I,v.memoizedState=ye),$.props=I,$.state=ye,$.context=Oe,I=de):(typeof $.componentDidMount=="function"&&(v.flags|=4194308),I=!1)}else{$=v.stateNode,Bl(d,v),de=v.memoizedProps,Oe=v.type===v.elementType?de:Jr(v.type,de),$.props=Oe,$e=v.pendingProps,Je=$.context,ye=w.contextType,typeof ye=="object"&&ye!==null?ye=Ur(ye):(ye=Er(w)?zn:yr.current,ye=li(v,ye));var ct=w.getDerivedStateFromProps;(Ke=typeof ct=="function"||typeof $.getSnapshotBeforeUpdate=="function")||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(de!==$e||Je!==ye)&&ou(v,$,I,ye),Tn=!1,Je=v.memoizedState,$.state=Je,Ra(v,I,$,D);var pt=v.memoizedState;de!==$e||Je!==pt||wr.current||Tn?(typeof ct=="function"&&(rs(v,w,ct,I),pt=v.memoizedState),(Oe=Tn||iu(v,w,Oe,I,Je,pt,ye)||!1)?(Ke||typeof $.UNSAFE_componentWillUpdate!="function"&&typeof $.componentWillUpdate!="function"||(typeof $.componentWillUpdate=="function"&&$.componentWillUpdate(I,pt,ye),typeof $.UNSAFE_componentWillUpdate=="function"&&$.UNSAFE_componentWillUpdate(I,pt,ye)),typeof $.componentDidUpdate=="function"&&(v.flags|=4),typeof $.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof $.componentDidUpdate!="function"||de===d.memoizedProps&&Je===d.memoizedState||(v.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||de===d.memoizedProps&&Je===d.memoizedState||(v.flags|=1024),v.memoizedProps=I,v.memoizedState=pt),$.props=I,$.state=pt,$.context=ye,I=Oe):(typeof $.componentDidUpdate!="function"||de===d.memoizedProps&&Je===d.memoizedState||(v.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||de===d.memoizedProps&&Je===d.memoizedState||(v.flags|=1024),I=!1)}return ss(d,v,w,I,U,D)}function ss(d,v,w,I,D,U){mu(d,v);var $=(v.flags&128)!==0;if(!I&&!$)return D&&_l(v,w,!1),hn(d,v,U);I=v.stateNode,oh.current=v;var de=$&&typeof w.getDerivedStateFromError!="function"?null:I.render();return v.flags|=1,d!==null&&$?(v.child=di(v,d.child,null,U),v.child=di(v,null,de,U)):_r(d,v,de,U),v.memoizedState=I.state,D&&_l(v,w,!0),v.child}function yu(d){var v=d.stateNode;v.pendingContext?bl(d,v.pendingContext,v.pendingContext!==v.context):v.context&&bl(d,v.context,!1),qo(d,v.containerInfo)}function Au(d,v,w,I,D){return hi(),ko(D),v.flags|=256,_r(d,v,w,I),v.child}var ls={dehydrated:null,treeContext:null,retryLane:0};function us(d){return{baseLanes:d,cachePool:null,transitions:null}}function bu(d,v,w){var I=v.pendingProps,D=er.current,U=!1,$=(v.flags&128)!==0,de;if((de=$)||(de=d!==null&&d.memoizedState===null?!1:(D&2)!==0),de?(U=!0,v.flags&=-129):(d===null||d.memoizedState!==null)&&(D|=1),Wt(er,D&1),d===null)return Do(v),d=v.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((v.mode&1)===0?v.lanes=1:d.data==="$!"?v.lanes=8:v.lanes=1073741824,null):($=I.children,d=I.fallback,U?(I=v.mode,U=v.child,$={mode:"hidden",children:$},(I&1)===0&&U!==null?(U.childLanes=0,U.pendingProps=$):U=Za($,I,0,null),d=Kn(d,I,w,null),U.return=v,d.return=v,U.sibling=d,v.child=U,v.child.memoizedState=us(w),v.memoizedState=ls,d):cs(v,$));if(D=d.memoizedState,D!==null&&(de=D.dehydrated,de!==null))return sh(d,v,$,I,de,D,w);if(U){U=I.fallback,$=v.mode,D=d.child,de=D.sibling;var ye={mode:"hidden",children:I.children};return($&1)===0&&v.child!==D?(I=v.child,I.childLanes=0,I.pendingProps=ye,v.deletions=null):(I=Fn(D,ye),I.subtreeFlags=D.subtreeFlags&14680064),de!==null?U=Fn(de,U):(U=Kn(U,$,w,null),U.flags|=2),U.return=v,I.return=v,I.sibling=U,v.child=I,I=U,U=v.child,$=d.child.memoizedState,$=$===null?us(w):{baseLanes:$.baseLanes|w,cachePool:null,transitions:$.transitions},U.memoizedState=$,U.childLanes=d.childLanes&~w,v.memoizedState=ls,I}return U=d.child,d=U.sibling,I=Fn(U,{mode:"visible",children:I.children}),(v.mode&1)===0&&(I.lanes=w),I.return=v,I.sibling=null,d!==null&&(w=v.deletions,w===null?(v.deletions=[d],v.flags|=16):w.push(d)),v.child=I,v.memoizedState=null,I}function cs(d,v){return v=Za({mode:"visible",children:v},d.mode,0,null),v.return=d,d.child=v}function Na(d,v,w,I){return I!==null&&ko(I),di(v,d.child,null,w),d=cs(v,v.pendingProps.children),d.flags|=2,v.memoizedState=null,d}function sh(d,v,w,I,D,U,$){if(w)return v.flags&256?(v.flags&=-257,I=is(Error(r(422))),Na(d,v,$,I)):v.memoizedState!==null?(v.child=d.child,v.flags|=128,null):(U=I.fallback,D=v.mode,I=Za({mode:"visible",children:I.children},D,0,null),U=Kn(U,D,$,null),U.flags|=2,I.return=v,U.return=v,I.sibling=U,v.child=I,(v.mode&1)!==0&&di(v,d.child,null,$),v.child.memoizedState=us($),v.memoizedState=ls,U);if((v.mode&1)===0)return Na(d,v,$,null);if(D.data==="$!"){if(I=D.nextSibling&&D.nextSibling.dataset,I)var de=I.dgst;return I=de,U=Error(r(419)),I=is(U,I,void 0),Na(d,v,$,I)}if(de=($&d.childLanes)!==0,Tr||de){if(I=hr,I!==null){switch($&-$){case 4:D=2;break;case 16:D=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:D=32;break;case 536870912:D=268435456;break;default:D=0}D=(D&(I.suspendedLanes|$))!==0?0:D,D!==0&&D!==U.retryLane&&(U.retryLane=D,un(d,D),Zr(I,d,D,-1))}return Es(),I=is(Error(r(421))),Na(d,v,$,I)}return D.data==="$?"?(v.flags|=128,v.child=d.child,v=bh.bind(null,d),D._reactRetry=v,null):(d=U.treeContext,Br=Sn(D.nextSibling),Lr=v,Kt=!0,Qr=null,d!==null&&(Vr[zr++]=sn,Vr[zr++]=ln,Vr[zr++]=Un,sn=d.id,ln=d.overflow,Un=v),v=cs(v,I.children),v.flags|=4096,v)}function xu(d,v,w){d.lanes|=v;var I=d.alternate;I!==null&&(I.lanes|=v),Uo(d.return,v,w)}function hs(d,v,w,I,D){var U=d.memoizedState;U===null?d.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:I,tail:w,tailMode:D}:(U.isBackwards=v,U.rendering=null,U.renderingStartTime=0,U.last=I,U.tail=w,U.tailMode=D)}function _u(d,v,w){var I=v.pendingProps,D=I.revealOrder,U=I.tail;if(_r(d,v,I.children,w),I=er.current,(I&2)!==0)I=I&1|2,v.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=v.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&xu(d,w,v);else if(d.tag===19)xu(d,w,v);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===v)break e;for(;d.sibling===null;){if(d.return===null||d.return===v)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}I&=1}if(Wt(er,I),(v.mode&1)===0)v.memoizedState=null;else switch(D){case"forwards":for(w=v.child,D=null;w!==null;)d=w.alternate,d!==null&&Ia(d)===null&&(D=w),w=w.sibling;w=D,w===null?(D=v.child,v.child=null):(D=w.sibling,w.sibling=null),hs(v,!1,D,w,U);break;case"backwards":for(w=null,D=v.child,v.child=null;D!==null;){if(d=D.alternate,d!==null&&Ia(d)===null){v.child=D;break}d=D.sibling,D.sibling=w,w=D,D=d}hs(v,!0,w,null,U);break;case"together":hs(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function Va(d,v){(v.mode&1)===0&&d!==null&&(d.alternate=null,v.alternate=null,v.flags|=2)}function hn(d,v,w){if(d!==null&&(v.dependencies=d.dependencies),Wn|=v.lanes,(w&v.childLanes)===0)return null;if(d!==null&&v.child!==d.child)throw Error(r(153));if(v.child!==null){for(d=v.child,w=Fn(d,d.pendingProps),v.child=w,w.return=v;d.sibling!==null;)d=d.sibling,w=w.sibling=Fn(d,d.pendingProps),w.return=v;w.sibling=null}return v.child}function lh(d,v,w){switch(v.tag){case 3:yu(v),hi();break;case 5:Dl(v);break;case 1:Er(v.type)&&ba(v);break;case 4:qo(v,v.stateNode.containerInfo);break;case 10:var I=v.type._context,D=v.memoizedProps.value;Wt(Ta,I._currentValue),I._currentValue=D;break;case 13:if(I=v.memoizedState,I!==null)return I.dehydrated!==null?(Wt(er,er.current&1),v.flags|=128,null):(w&v.child.childLanes)!==0?bu(d,v,w):(Wt(er,er.current&1),d=hn(d,v,w),d!==null?d.sibling:null);Wt(er,er.current&1);break;case 19:if(I=(w&v.childLanes)!==0,(d.flags&128)!==0){if(I)return _u(d,v,w);v.flags|=128}if(D=v.memoizedState,D!==null&&(D.rendering=null,D.tail=null,D.lastEffect=null),Wt(er,er.current),I)break;return null;case 22:case 23:return v.lanes=0,vu(d,v,w)}return hn(d,v,w)}var Su,ds,Mu,wu;Su=function(d,v){for(var w=v.child;w!==null;){if(w.tag===5||w.tag===6)d.appendChild(w.stateNode);else if(w.tag!==4&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===v)break;for(;w.sibling===null;){if(w.return===null||w.return===v)return;w=w.return}w.sibling.return=w.return,w=w.sibling}},ds=function(){},Mu=function(d,v,w,I){var D=d.memoizedProps;if(D!==I){d=v.stateNode,qn(tn.current);var U=null;switch(w){case"input":D=st(d,D),I=st(d,I),U=[];break;case"select":D=ee({},D,{value:void 0}),I=ee({},I,{value:void 0}),U=[];break;case"textarea":D=be(d,D),I=be(d,I),U=[];break;default:typeof D.onClick!="function"&&typeof I.onClick=="function"&&(d.onclick=ga)}lt(w,I);var $;w=null;for(Oe in D)if(!I.hasOwnProperty(Oe)&&D.hasOwnProperty(Oe)&&D[Oe]!=null)if(Oe==="style"){var de=D[Oe];for($ in de)de.hasOwnProperty($)&&(w||(w={}),w[$]="")}else Oe!=="dangerouslySetInnerHTML"&&Oe!=="children"&&Oe!=="suppressContentEditableWarning"&&Oe!=="suppressHydrationWarning"&&Oe!=="autoFocus"&&(o.hasOwnProperty(Oe)?U||(U=[]):(U=U||[]).push(Oe,null));for(Oe in I){var ye=I[Oe];if(de=D!=null?D[Oe]:void 0,I.hasOwnProperty(Oe)&&ye!==de&&(ye!=null||de!=null))if(Oe==="style")if(de){for($ in de)!de.hasOwnProperty($)||ye&&ye.hasOwnProperty($)||(w||(w={}),w[$]="");for($ in ye)ye.hasOwnProperty($)&&de[$]!==ye[$]&&(w||(w={}),w[$]=ye[$])}else w||(U||(U=[]),U.push(Oe,w)),w=ye;else Oe==="dangerouslySetInnerHTML"?(ye=ye?ye.__html:void 0,de=de?de.__html:void 0,ye!=null&&de!==ye&&(U=U||[]).push(Oe,ye)):Oe==="children"?typeof ye!="string"&&typeof ye!="number"||(U=U||[]).push(Oe,""+ye):Oe!=="suppressContentEditableWarning"&&Oe!=="suppressHydrationWarning"&&(o.hasOwnProperty(Oe)?(ye!=null&&Oe==="onScroll"&&Qt("scroll",d),U||de===ye||(U=[])):(U=U||[]).push(Oe,ye))}w&&(U=U||[]).push("style",w);var Oe=U;(v.updateQueue=Oe)&&(v.flags|=4)}},wu=function(d,v,w,I){w!==I&&(v.flags|=4)};function Ki(d,v){if(!Kt)switch(d.tailMode){case"hidden":v=d.tail;for(var w=null;v!==null;)v.alternate!==null&&(w=v),v=v.sibling;w===null?d.tail=null:w.sibling=null;break;case"collapsed":w=d.tail;for(var I=null;w!==null;)w.alternate!==null&&(I=w),w=w.sibling;I===null?v||d.tail===null?d.tail=null:d.tail.sibling=null:I.sibling=null}}function br(d){var v=d.alternate!==null&&d.alternate.child===d.child,w=0,I=0;if(v)for(var D=d.child;D!==null;)w|=D.lanes|D.childLanes,I|=D.subtreeFlags&14680064,I|=D.flags&14680064,D.return=d,D=D.sibling;else for(D=d.child;D!==null;)w|=D.lanes|D.childLanes,I|=D.subtreeFlags,I|=D.flags,D.return=d,D=D.sibling;return d.subtreeFlags|=I,d.childLanes=w,v}function uh(d,v,w){var I=v.pendingProps;switch(Fo(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return br(v),null;case 1:return Er(v.type)&&Aa(),br(v),null;case 3:return I=v.stateNode,vi(),Jt(wr),Jt(yr),Qo(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(d===null||d.child===null)&&(wa(v)?v.flags|=4:d===null||d.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,Qr!==null&&(Ss(Qr),Qr=null))),ds(d,v),br(v),null;case 5:jo(v);var D=qn(ji.current);if(w=v.type,d!==null&&v.stateNode!=null)Mu(d,v,w,I,D),d.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!I){if(v.stateNode===null)throw Error(r(166));return br(v),null}if(d=qn(tn.current),wa(v)){I=v.stateNode,w=v.type;var U=v.memoizedProps;switch(I[en]=v,I[zi]=U,d=(v.mode&1)!==0,w){case"dialog":Qt("cancel",I),Qt("close",I);break;case"iframe":case"object":case"embed":Qt("load",I);break;case"video":case"audio":for(D=0;D<ki.length;D++)Qt(ki[D],I);break;case"source":Qt("error",I);break;case"img":case"image":case"link":Qt("error",I),Qt("load",I);break;case"details":Qt("toggle",I);break;case"input":We(I,U),Qt("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!U.multiple},Qt("invalid",I);break;case"textarea":ze(I,U),Qt("invalid",I)}lt(w,U),D=null;for(var $ in U)if(U.hasOwnProperty($)){var de=U[$];$==="children"?typeof de=="string"?I.textContent!==de&&(U.suppressHydrationWarning!==!0&&ma(I.textContent,de,d),D=["children",de]):typeof de=="number"&&I.textContent!==""+de&&(U.suppressHydrationWarning!==!0&&ma(I.textContent,de,d),D=["children",""+de]):o.hasOwnProperty($)&&de!=null&&$==="onScroll"&&Qt("scroll",I)}switch(w){case"input":we(I),ue(I,U,!0);break;case"textarea":we(I),ot(I);break;case"select":case"option":break;default:typeof U.onClick=="function"&&(I.onclick=ga)}I=D,v.updateQueue=I,I!==null&&(v.flags|=4)}else{$=D.nodeType===9?D:D.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=nt(w)),d==="http://www.w3.org/1999/xhtml"?w==="script"?(d=$.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof I.is=="string"?d=$.createElement(w,{is:I.is}):(d=$.createElement(w),w==="select"&&($=d,I.multiple?$.multiple=!0:I.size&&($.size=I.size))):d=$.createElementNS(d,w),d[en]=v,d[zi]=I,Su(d,v,!1,!1),v.stateNode=d;e:{switch($=Pt(w,I),w){case"dialog":Qt("cancel",d),Qt("close",d),D=I;break;case"iframe":case"object":case"embed":Qt("load",d),D=I;break;case"video":case"audio":for(D=0;D<ki.length;D++)Qt(ki[D],d);D=I;break;case"source":Qt("error",d),D=I;break;case"img":case"image":case"link":Qt("error",d),Qt("load",d),D=I;break;case"details":Qt("toggle",d),D=I;break;case"input":We(d,I),D=st(d,I),Qt("invalid",d);break;case"option":D=I;break;case"select":d._wrapperState={wasMultiple:!!I.multiple},D=ee({},I,{value:void 0}),Qt("invalid",d);break;case"textarea":ze(d,I),D=be(d,I),Qt("invalid",d);break;default:D=I}lt(w,D),de=D;for(U in de)if(de.hasOwnProperty(U)){var ye=de[U];U==="style"?xt(d,ye):U==="dangerouslySetInnerHTML"?(ye=ye?ye.__html:void 0,ye!=null&&qe(d,ye)):U==="children"?typeof ye=="string"?(w!=="textarea"||ye!=="")&&ke(d,ye):typeof ye=="number"&&ke(d,""+ye):U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&U!=="autoFocus"&&(o.hasOwnProperty(U)?ye!=null&&U==="onScroll"&&Qt("scroll",d):ye!=null&&C(d,U,ye,$))}switch(w){case"input":we(d),ue(d,I,!1);break;case"textarea":we(d),ot(d);break;case"option":I.value!=null&&d.setAttribute("value",""+Re(I.value));break;case"select":d.multiple=!!I.multiple,U=I.value,U!=null?De(d,!!I.multiple,U,!1):I.defaultValue!=null&&De(d,!!I.multiple,I.defaultValue,!0);break;default:typeof D.onClick=="function"&&(d.onclick=ga)}switch(w){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}}I&&(v.flags|=4)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return br(v),null;case 6:if(d&&v.stateNode!=null)wu(d,v,d.memoizedProps,I);else{if(typeof I!="string"&&v.stateNode===null)throw Error(r(166));if(w=qn(ji.current),qn(tn.current),wa(v)){if(I=v.stateNode,w=v.memoizedProps,I[en]=v,(U=I.nodeValue!==w)&&(d=Lr,d!==null))switch(d.tag){case 3:ma(I.nodeValue,w,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&ma(I.nodeValue,w,(d.mode&1)!==0)}U&&(v.flags|=4)}else I=(w.nodeType===9?w:w.ownerDocument).createTextNode(I),I[en]=v,v.stateNode=I}return br(v),null;case 13:if(Jt(er),I=v.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(Kt&&Br!==null&&(v.mode&1)!==0&&(v.flags&128)===0)Cl(),hi(),v.flags|=98560,U=!1;else if(U=wa(v),I!==null&&I.dehydrated!==null){if(d===null){if(!U)throw Error(r(318));if(U=v.memoizedState,U=U!==null?U.dehydrated:null,!U)throw Error(r(317));U[en]=v}else hi(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;br(v),U=!1}else Qr!==null&&(Ss(Qr),Qr=null),U=!0;if(!U)return v.flags&65536?v:null}return(v.flags&128)!==0?(v.lanes=w,v):(I=I!==null,I!==(d!==null&&d.memoizedState!==null)&&I&&(v.child.flags|=8192,(v.mode&1)!==0&&(d===null||(er.current&1)!==0?ur===0&&(ur=3):Es())),v.updateQueue!==null&&(v.flags|=4),br(v),null);case 4:return vi(),ds(d,v),d===null&&Ni(v.stateNode.containerInfo),br(v),null;case 10:return zo(v.type._context),br(v),null;case 17:return Er(v.type)&&Aa(),br(v),null;case 19:if(Jt(er),U=v.memoizedState,U===null)return br(v),null;if(I=(v.flags&128)!==0,$=U.rendering,$===null)if(I)Ki(U,!1);else{if(ur!==0||d!==null&&(d.flags&128)!==0)for(d=v.child;d!==null;){if($=Ia(d),$!==null){for(v.flags|=128,Ki(U,!1),I=$.updateQueue,I!==null&&(v.updateQueue=I,v.flags|=4),v.subtreeFlags=0,I=w,w=v.child;w!==null;)U=w,d=I,U.flags&=14680066,$=U.alternate,$===null?(U.childLanes=0,U.lanes=d,U.child=null,U.subtreeFlags=0,U.memoizedProps=null,U.memoizedState=null,U.updateQueue=null,U.dependencies=null,U.stateNode=null):(U.childLanes=$.childLanes,U.lanes=$.lanes,U.child=$.child,U.subtreeFlags=0,U.deletions=null,U.memoizedProps=$.memoizedProps,U.memoizedState=$.memoizedState,U.updateQueue=$.updateQueue,U.type=$.type,d=$.dependencies,U.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),w=w.sibling;return Wt(er,er.current&1|2),v.child}d=d.sibling}U.tail!==null&&Vt()>Ai&&(v.flags|=128,I=!0,Ki(U,!1),v.lanes=4194304)}else{if(!I)if(d=Ia($),d!==null){if(v.flags|=128,I=!0,w=d.updateQueue,w!==null&&(v.updateQueue=w,v.flags|=4),Ki(U,!0),U.tail===null&&U.tailMode==="hidden"&&!$.alternate&&!Kt)return br(v),null}else 2*Vt()-U.renderingStartTime>Ai&&w!==1073741824&&(v.flags|=128,I=!0,Ki(U,!1),v.lanes=4194304);U.isBackwards?($.sibling=v.child,v.child=$):(w=U.last,w!==null?w.sibling=$:v.child=$,U.last=$)}return U.tail!==null?(v=U.tail,U.rendering=v,U.tail=v.sibling,U.renderingStartTime=Vt(),v.sibling=null,w=er.current,Wt(er,I?w&1|2:w&1),v):(br(v),null);case 22:case 23:return ws(),I=v.memoizedState!==null,d!==null&&d.memoizedState!==null!==I&&(v.flags|=8192),I&&(v.mode&1)!==0?(Fr&1073741824)!==0&&(br(v),v.subtreeFlags&6&&(v.flags|=8192)):br(v),null;case 24:return null;case 25:return null}throw Error(r(156,v.tag))}function ch(d,v){switch(Fo(v),v.tag){case 1:return Er(v.type)&&Aa(),d=v.flags,d&65536?(v.flags=d&-65537|128,v):null;case 3:return vi(),Jt(wr),Jt(yr),Qo(),d=v.flags,(d&65536)!==0&&(d&128)===0?(v.flags=d&-65537|128,v):null;case 5:return jo(v),null;case 13:if(Jt(er),d=v.memoizedState,d!==null&&d.dehydrated!==null){if(v.alternate===null)throw Error(r(340));hi()}return d=v.flags,d&65536?(v.flags=d&-65537|128,v):null;case 19:return Jt(er),null;case 4:return vi(),null;case 10:return zo(v.type._context),null;case 22:case 23:return ws(),null;case 24:return null;default:return null}}var za=!1,xr=!1,hh=typeof WeakSet=="function"?WeakSet:Set,dt=null;function gi(d,v){var w=d.ref;if(w!==null)if(typeof w=="function")try{w(null)}catch(I){nr(d,v,I)}else w.current=null}function ps(d,v,w){try{w()}catch(I){nr(d,v,I)}}var Eu=!1;function dh(d,v){if(wo=aa,d=nl(),go(d)){if("selectionStart"in d)var w={start:d.selectionStart,end:d.selectionEnd};else e:{w=(w=d.ownerDocument)&&w.defaultView||window;var I=w.getSelection&&w.getSelection();if(I&&I.rangeCount!==0){w=I.anchorNode;var D=I.anchorOffset,U=I.focusNode;I=I.focusOffset;try{w.nodeType,U.nodeType}catch{w=null;break e}var $=0,de=-1,ye=-1,Oe=0,Ke=0,$e=d,Je=null;t:for(;;){for(var ct;$e!==w||D!==0&&$e.nodeType!==3||(de=$+D),$e!==U||I!==0&&$e.nodeType!==3||(ye=$+I),$e.nodeType===3&&($+=$e.nodeValue.length),(ct=$e.firstChild)!==null;)Je=$e,$e=ct;for(;;){if($e===d)break t;if(Je===w&&++Oe===D&&(de=$),Je===U&&++Ke===I&&(ye=$),(ct=$e.nextSibling)!==null)break;$e=Je,Je=$e.parentNode}$e=ct}w=de===-1||ye===-1?null:{start:de,end:ye}}else w=null}w=w||{start:0,end:0}}else w=null;for(Eo={focusedElem:d,selectionRange:w},aa=!1,dt=v;dt!==null;)if(v=dt,d=v.child,(v.subtreeFlags&1028)!==0&&d!==null)d.return=v,dt=d;else for(;dt!==null;){v=dt;try{var pt=v.alternate;if((v.flags&1024)!==0)switch(v.tag){case 0:case 11:case 15:break;case 1:if(pt!==null){var mt=pt.memoizedProps,ar=pt.memoizedState,Ce=v.stateNode,xe=Ce.getSnapshotBeforeUpdate(v.elementType===v.type?mt:Jr(v.type,mt),ar);Ce.__reactInternalSnapshotBeforeUpdate=xe}break;case 3:var Be=v.stateNode.containerInfo;Be.nodeType===1?Be.textContent="":Be.nodeType===9&&Be.documentElement&&Be.removeChild(Be.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(rt){nr(v,v.return,rt)}if(d=v.sibling,d!==null){d.return=v.return,dt=d;break}dt=v.return}return pt=Eu,Eu=!1,pt}function Zi(d,v,w){var I=v.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var D=I=I.next;do{if((D.tag&d)===d){var U=D.destroy;D.destroy=void 0,U!==void 0&&ps(v,w,U)}D=D.next}while(D!==I)}}function Ua(d,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var w=v=v.next;do{if((w.tag&d)===d){var I=w.create;w.destroy=I()}w=w.next}while(w!==v)}}function fs(d){var v=d.ref;if(v!==null){var w=d.stateNode;switch(d.tag){case 5:d=w;break;default:d=w}typeof v=="function"?v(d):v.current=d}}function Tu(d){var v=d.alternate;v!==null&&(d.alternate=null,Tu(v)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(v=d.stateNode,v!==null&&(delete v[en],delete v[zi],delete v[Ro],delete v[Jc],delete v[Xc])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function Cu(d){return d.tag===5||d.tag===3||d.tag===4}function Pu(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||Cu(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function vs(d,v,w){var I=d.tag;if(I===5||I===6)d=d.stateNode,v?w.nodeType===8?w.parentNode.insertBefore(d,v):w.insertBefore(d,v):(w.nodeType===8?(v=w.parentNode,v.insertBefore(d,w)):(v=w,v.appendChild(d)),w=w._reactRootContainer,w!=null||v.onclick!==null||(v.onclick=ga));else if(I!==4&&(d=d.child,d!==null))for(vs(d,v,w),d=d.sibling;d!==null;)vs(d,v,w),d=d.sibling}function ms(d,v,w){var I=d.tag;if(I===5||I===6)d=d.stateNode,v?w.insertBefore(d,v):w.appendChild(d);else if(I!==4&&(d=d.child,d!==null))for(ms(d,v,w),d=d.sibling;d!==null;)ms(d,v,w),d=d.sibling}var vr=null,Xr=!1;function Pn(d,v,w){for(w=w.child;w!==null;)Ru(d,v,w),w=w.sibling}function Ru(d,v,w){if(Rr&&typeof Rr.onCommitFiberUnmount=="function")try{Rr.onCommitFiberUnmount(kn,w)}catch{}switch(w.tag){case 5:xr||gi(w,v);case 6:var I=vr,D=Xr;vr=null,Pn(d,v,w),vr=I,Xr=D,vr!==null&&(Xr?(d=vr,w=w.stateNode,d.nodeType===8?d.parentNode.removeChild(w):d.removeChild(w)):vr.removeChild(w.stateNode));break;case 18:vr!==null&&(Xr?(d=vr,w=w.stateNode,d.nodeType===8?Po(d.parentNode,w):d.nodeType===1&&Po(d,w),Pi(d)):Po(vr,w.stateNode));break;case 4:I=vr,D=Xr,vr=w.stateNode.containerInfo,Xr=!0,Pn(d,v,w),vr=I,Xr=D;break;case 0:case 11:case 14:case 15:if(!xr&&(I=w.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){D=I=I.next;do{var U=D,$=U.destroy;U=U.tag,$!==void 0&&((U&2)!==0||(U&4)!==0)&&ps(w,v,$),D=D.next}while(D!==I)}Pn(d,v,w);break;case 1:if(!xr&&(gi(w,v),I=w.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=w.memoizedProps,I.state=w.memoizedState,I.componentWillUnmount()}catch(de){nr(w,v,de)}Pn(d,v,w);break;case 21:Pn(d,v,w);break;case 22:w.mode&1?(xr=(I=xr)||w.memoizedState!==null,Pn(d,v,w),xr=I):Pn(d,v,w);break;default:Pn(d,v,w)}}function Iu(d){var v=d.updateQueue;if(v!==null){d.updateQueue=null;var w=d.stateNode;w===null&&(w=d.stateNode=new hh),v.forEach(function(I){var D=xh.bind(null,d,I);w.has(I)||(w.add(I),I.then(D,D))})}}function Kr(d,v){var w=v.deletions;if(w!==null)for(var I=0;I<w.length;I++){var D=w[I];try{var U=d,$=v,de=$;e:for(;de!==null;){switch(de.tag){case 5:vr=de.stateNode,Xr=!1;break e;case 3:vr=de.stateNode.containerInfo,Xr=!0;break e;case 4:vr=de.stateNode.containerInfo,Xr=!0;break e}de=de.return}if(vr===null)throw Error(r(160));Ru(U,$,D),vr=null,Xr=!1;var ye=D.alternate;ye!==null&&(ye.return=null),D.return=null}catch(Oe){nr(D,v,Oe)}}if(v.subtreeFlags&12854)for(v=v.child;v!==null;)Lu(v,d),v=v.sibling}function Lu(d,v){var w=d.alternate,I=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Kr(v,d),nn(d),I&4){try{Zi(3,d,d.return),Ua(3,d)}catch(mt){nr(d,d.return,mt)}try{Zi(5,d,d.return)}catch(mt){nr(d,d.return,mt)}}break;case 1:Kr(v,d),nn(d),I&512&&w!==null&&gi(w,w.return);break;case 5:if(Kr(v,d),nn(d),I&512&&w!==null&&gi(w,w.return),d.flags&32){var D=d.stateNode;try{ke(D,"")}catch(mt){nr(d,d.return,mt)}}if(I&4&&(D=d.stateNode,D!=null)){var U=d.memoizedProps,$=w!==null?w.memoizedProps:U,de=d.type,ye=d.updateQueue;if(d.updateQueue=null,ye!==null)try{de==="input"&&U.type==="radio"&&U.name!=null&&bt(D,U),Pt(de,$);var Oe=Pt(de,U);for($=0;$<ye.length;$+=2){var Ke=ye[$],$e=ye[$+1];Ke==="style"?xt(D,$e):Ke==="dangerouslySetInnerHTML"?qe(D,$e):Ke==="children"?ke(D,$e):C(D,Ke,$e,Oe)}switch(de){case"input":oe(D,U);break;case"textarea":at(D,U);break;case"select":var Je=D._wrapperState.wasMultiple;D._wrapperState.wasMultiple=!!U.multiple;var ct=U.value;ct!=null?De(D,!!U.multiple,ct,!1):Je!==!!U.multiple&&(U.defaultValue!=null?De(D,!!U.multiple,U.defaultValue,!0):De(D,!!U.multiple,U.multiple?[]:"",!1))}D[zi]=U}catch(mt){nr(d,d.return,mt)}}break;case 6:if(Kr(v,d),nn(d),I&4){if(d.stateNode===null)throw Error(r(162));D=d.stateNode,U=d.memoizedProps;try{D.nodeValue=U}catch(mt){nr(d,d.return,mt)}}break;case 3:if(Kr(v,d),nn(d),I&4&&w!==null&&w.memoizedState.isDehydrated)try{Pi(v.containerInfo)}catch(mt){nr(d,d.return,mt)}break;case 4:Kr(v,d),nn(d);break;case 13:Kr(v,d),nn(d),D=d.child,D.flags&8192&&(U=D.memoizedState!==null,D.stateNode.isHidden=U,!U||D.alternate!==null&&D.alternate.memoizedState!==null||(As=Vt())),I&4&&Iu(d);break;case 22:if(Ke=w!==null&&w.memoizedState!==null,d.mode&1?(xr=(Oe=xr)||Ke,Kr(v,d),xr=Oe):Kr(v,d),nn(d),I&8192){if(Oe=d.memoizedState!==null,(d.stateNode.isHidden=Oe)&&!Ke&&(d.mode&1)!==0)for(dt=d,Ke=d.child;Ke!==null;){for($e=dt=Ke;dt!==null;){switch(Je=dt,ct=Je.child,Je.tag){case 0:case 11:case 14:case 15:Zi(4,Je,Je.return);break;case 1:gi(Je,Je.return);var pt=Je.stateNode;if(typeof pt.componentWillUnmount=="function"){I=Je,w=Je.return;try{v=I,pt.props=v.memoizedProps,pt.state=v.memoizedState,pt.componentWillUnmount()}catch(mt){nr(I,w,mt)}}break;case 5:gi(Je,Je.return);break;case 22:if(Je.memoizedState!==null){Ou($e);continue}}ct!==null?(ct.return=Je,dt=ct):Ou($e)}Ke=Ke.sibling}e:for(Ke=null,$e=d;;){if($e.tag===5){if(Ke===null){Ke=$e;try{D=$e.stateNode,Oe?(U=D.style,typeof U.setProperty=="function"?U.setProperty("display","none","important"):U.display="none"):(de=$e.stateNode,ye=$e.memoizedProps.style,$=ye!=null&&ye.hasOwnProperty("display")?ye.display:null,de.style.display=tt("display",$))}catch(mt){nr(d,d.return,mt)}}}else if($e.tag===6){if(Ke===null)try{$e.stateNode.nodeValue=Oe?"":$e.memoizedProps}catch(mt){nr(d,d.return,mt)}}else if(($e.tag!==22&&$e.tag!==23||$e.memoizedState===null||$e===d)&&$e.child!==null){$e.child.return=$e,$e=$e.child;continue}if($e===d)break e;for(;$e.sibling===null;){if($e.return===null||$e.return===d)break e;Ke===$e&&(Ke=null),$e=$e.return}Ke===$e&&(Ke=null),$e.sibling.return=$e.return,$e=$e.sibling}}break;case 19:Kr(v,d),nn(d),I&4&&Iu(d);break;case 21:break;default:Kr(v,d),nn(d)}}function nn(d){var v=d.flags;if(v&2){try{e:{for(var w=d.return;w!==null;){if(Cu(w)){var I=w;break e}w=w.return}throw Error(r(160))}switch(I.tag){case 5:var D=I.stateNode;I.flags&32&&(ke(D,""),I.flags&=-33);var U=Pu(d);ms(d,U,D);break;case 3:case 4:var $=I.stateNode.containerInfo,de=Pu(d);vs(d,de,$);break;default:throw Error(r(161))}}catch(ye){nr(d,d.return,ye)}d.flags&=-3}v&4096&&(d.flags&=-4097)}function ph(d,v,w){dt=d,Bu(d)}function Bu(d,v,w){for(var I=(d.mode&1)!==0;dt!==null;){var D=dt,U=D.child;if(D.tag===22&&I){var $=D.memoizedState!==null||za;if(!$){var de=D.alternate,ye=de!==null&&de.memoizedState!==null||xr;de=za;var Oe=xr;if(za=$,(xr=ye)&&!Oe)for(dt=D;dt!==null;)$=dt,ye=$.child,$.tag===22&&$.memoizedState!==null?Du(D):ye!==null?(ye.return=$,dt=ye):Du(D);for(;U!==null;)dt=U,Bu(U),U=U.sibling;dt=D,za=de,xr=Oe}Fu(d)}else(D.subtreeFlags&8772)!==0&&U!==null?(U.return=D,dt=U):Fu(d)}}function Fu(d){for(;dt!==null;){var v=dt;if((v.flags&8772)!==0){var w=v.alternate;try{if((v.flags&8772)!==0)switch(v.tag){case 0:case 11:case 15:xr||Ua(5,v);break;case 1:var I=v.stateNode;if(v.flags&4&&!xr)if(w===null)I.componentDidMount();else{var D=v.elementType===v.type?w.memoizedProps:Jr(v.type,w.memoizedProps);I.componentDidUpdate(D,w.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var U=v.updateQueue;U!==null&&Ol(v,U,I);break;case 3:var $=v.updateQueue;if($!==null){if(w=null,v.child!==null)switch(v.child.tag){case 5:w=v.child.stateNode;break;case 1:w=v.child.stateNode}Ol(v,$,w)}break;case 5:var de=v.stateNode;if(w===null&&v.flags&4){w=de;var ye=v.memoizedProps;switch(v.type){case"button":case"input":case"select":case"textarea":ye.autoFocus&&w.focus();break;case"img":ye.src&&(w.src=ye.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(v.memoizedState===null){var Oe=v.alternate;if(Oe!==null){var Ke=Oe.memoizedState;if(Ke!==null){var $e=Ke.dehydrated;$e!==null&&Pi($e)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}xr||v.flags&512&&fs(v)}catch(Je){nr(v,v.return,Je)}}if(v===d){dt=null;break}if(w=v.sibling,w!==null){w.return=v.return,dt=w;break}dt=v.return}}function Ou(d){for(;dt!==null;){var v=dt;if(v===d){dt=null;break}var w=v.sibling;if(w!==null){w.return=v.return,dt=w;break}dt=v.return}}function Du(d){for(;dt!==null;){var v=dt;try{switch(v.tag){case 0:case 11:case 15:var w=v.return;try{Ua(4,v)}catch(ye){nr(v,w,ye)}break;case 1:var I=v.stateNode;if(typeof I.componentDidMount=="function"){var D=v.return;try{I.componentDidMount()}catch(ye){nr(v,D,ye)}}var U=v.return;try{fs(v)}catch(ye){nr(v,U,ye)}break;case 5:var $=v.return;try{fs(v)}catch(ye){nr(v,$,ye)}}}catch(ye){nr(v,v.return,ye)}if(v===d){dt=null;break}var de=v.sibling;if(de!==null){de.return=v.return,dt=de;break}dt=v.return}}var fh=Math.ceil,Ga=P.ReactCurrentDispatcher,gs=P.ReactCurrentOwner,Hr=P.ReactCurrentBatchConfig,Ut=0,hr=null,sr=null,mr=0,Fr=0,yi=Mn(0),ur=0,Yi=null,Wn=0,Ha=0,ys=0,$i=null,Cr=null,As=0,Ai=1/0,dn=null,qa=!1,bs=null,Rn=null,ja=!1,In=null,Wa=0,ea=0,xs=null,Qa=-1,Ja=0;function Sr(){return(Ut&6)!==0?Vt():Qa!==-1?Qa:Qa=Vt()}function Ln(d){return(d.mode&1)===0?1:(Ut&2)!==0&&mr!==0?mr&-mr:Zc.transition!==null?(Ja===0&&(Ja=Si()),Ja):(d=Ee,d!==0||(d=window.event,d=d===void 0?16:ks(d.type)),d)}function Zr(d,v,w,I){if(50<ea)throw ea=0,xs=null,Error(r(185));Y(d,w,I),((Ut&2)===0||d!==hr)&&(d===hr&&((Ut&2)===0&&(Ha|=w),ur===4&&Bn(d,mr)),Pr(d,I),w===1&&Ut===0&&(v.mode&1)===0&&(Ai=Vt()+500,xa&&En()))}function Pr(d,v){var w=d.callbackNode;ra(d,v);var I=jr(d,d===hr?mr:0);if(I===0)w!==null&&fr(w),d.callbackNode=null,d.callbackPriority=0;else if(v=I&-I,d.callbackPriority!==v){if(w!=null&&fr(w),v===1)d.tag===0?Kc(Nu.bind(null,d)):Sl(Nu.bind(null,d)),Wc(function(){(Ut&6)===0&&En()}),w=null;else{switch(Xe(I)){case 1:w=Or;break;case 4:w=Dr;break;case 16:w=Yr;break;case 536870912:w=Nr;break;default:w=Yr}w=Wu(w,ku.bind(null,d))}d.callbackPriority=v,d.callbackNode=w}}function ku(d,v){if(Qa=-1,Ja=0,(Ut&6)!==0)throw Error(r(327));var w=d.callbackNode;if(bi()&&d.callbackNode!==w)return null;var I=jr(d,d===hr?mr:0);if(I===0)return null;if((I&30)!==0||(I&d.expiredLanes)!==0||v)v=Xa(d,I);else{v=I;var D=Ut;Ut|=2;var U=zu();(hr!==d||mr!==v)&&(dn=null,Ai=Vt()+500,Jn(d,v));do try{gh();break}catch(de){Vu(d,de)}while(!0);Vo(),Ga.current=U,Ut=D,sr!==null?v=0:(hr=null,mr=0,v=ur)}if(v!==0){if(v===2&&(D=Nn(d),D!==0&&(I=D,v=_s(d,D))),v===1)throw w=Yi,Jn(d,0),Bn(d,I),Pr(d,Vt()),w;if(v===6)Bn(d,I);else{if(D=d.current.alternate,(I&30)===0&&!vh(D)&&(v=Xa(d,I),v===2&&(U=Nn(d),U!==0&&(I=U,v=_s(d,U))),v===1))throw w=Yi,Jn(d,0),Bn(d,I),Pr(d,Vt()),w;switch(d.finishedWork=D,d.finishedLanes=I,v){case 0:case 1:throw Error(r(345));case 2:Xn(d,Cr,dn);break;case 3:if(Bn(d,I),(I&130023424)===I&&(v=As+500-Vt(),10<v)){if(jr(d,0)!==0)break;if(D=d.suspendedLanes,(D&I)!==I){Sr(),d.pingedLanes|=d.suspendedLanes&D;break}d.timeoutHandle=Co(Xn.bind(null,d,Cr,dn),v);break}Xn(d,Cr,dn);break;case 4:if(Bn(d,I),(I&4194240)===I)break;for(v=d.eventTimes,D=-1;0<I;){var $=31-Yt(I);U=1<<$,$=v[$],$>D&&(D=$),I&=~U}if(I=D,I=Vt()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*fh(I/1960))-I,10<I){d.timeoutHandle=Co(Xn.bind(null,d,Cr,dn),I);break}Xn(d,Cr,dn);break;case 5:Xn(d,Cr,dn);break;default:throw Error(r(329))}}}return Pr(d,Vt()),d.callbackNode===w?ku.bind(null,d):null}function _s(d,v){var w=$i;return d.current.memoizedState.isDehydrated&&(Jn(d,v).flags|=256),d=Xa(d,v),d!==2&&(v=Cr,Cr=w,v!==null&&Ss(v)),d}function Ss(d){Cr===null?Cr=d:Cr.push.apply(Cr,d)}function vh(d){for(var v=d;;){if(v.flags&16384){var w=v.updateQueue;if(w!==null&&(w=w.stores,w!==null))for(var I=0;I<w.length;I++){var D=w[I],U=D.getSnapshot;D=D.value;try{if(!Wr(U(),D))return!1}catch{return!1}}}if(w=v.child,v.subtreeFlags&16384&&w!==null)w.return=v,v=w;else{if(v===d)break;for(;v.sibling===null;){if(v.return===null||v.return===d)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function Bn(d,v){for(v&=~ys,v&=~Ha,d.suspendedLanes|=v,d.pingedLanes&=~v,d=d.expirationTimes;0<v;){var w=31-Yt(v),I=1<<w;d[w]=-1,v&=~I}}function Nu(d){if((Ut&6)!==0)throw Error(r(327));bi();var v=jr(d,0);if((v&1)===0)return Pr(d,Vt()),null;var w=Xa(d,v);if(d.tag!==0&&w===2){var I=Nn(d);I!==0&&(v=I,w=_s(d,I))}if(w===1)throw w=Yi,Jn(d,0),Bn(d,v),Pr(d,Vt()),w;if(w===6)throw Error(r(345));return d.finishedWork=d.current.alternate,d.finishedLanes=v,Xn(d,Cr,dn),Pr(d,Vt()),null}function Ms(d,v){var w=Ut;Ut|=1;try{return d(v)}finally{Ut=w,Ut===0&&(Ai=Vt()+500,xa&&En())}}function Qn(d){In!==null&&In.tag===0&&(Ut&6)===0&&bi();var v=Ut;Ut|=1;var w=Hr.transition,I=Ee;try{if(Hr.transition=null,Ee=1,d)return d()}finally{Ee=I,Hr.transition=w,Ut=v,(Ut&6)===0&&En()}}function ws(){Fr=yi.current,Jt(yi)}function Jn(d,v){d.finishedWork=null,d.finishedLanes=0;var w=d.timeoutHandle;if(w!==-1&&(d.timeoutHandle=-1,jc(w)),sr!==null)for(w=sr.return;w!==null;){var I=w;switch(Fo(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&Aa();break;case 3:vi(),Jt(wr),Jt(yr),Qo();break;case 5:jo(I);break;case 4:vi();break;case 13:Jt(er);break;case 19:Jt(er);break;case 10:zo(I.type._context);break;case 22:case 23:ws()}w=w.return}if(hr=d,sr=d=Fn(d.current,null),mr=Fr=v,ur=0,Yi=null,ys=Ha=Wn=0,Cr=$i=null,Hn!==null){for(v=0;v<Hn.length;v++)if(w=Hn[v],I=w.interleaved,I!==null){w.interleaved=null;var D=I.next,U=w.pending;if(U!==null){var $=U.next;U.next=D,I.next=$}w.pending=I}Hn=null}return d}function Vu(d,v){do{var w=sr;try{if(Vo(),La.current=Da,Ba){for(var I=tr.memoizedState;I!==null;){var D=I.queue;D!==null&&(D.pending=null),I=I.next}Ba=!1}if(jn=0,cr=lr=tr=null,Wi=!1,Qi=0,gs.current=null,w===null||w.return===null){ur=1,Yi=v,sr=null;break}e:{var U=d,$=w.return,de=w,ye=v;if(v=mr,de.flags|=32768,ye!==null&&typeof ye=="object"&&typeof ye.then=="function"){var Oe=ye,Ke=de,$e=Ke.tag;if((Ke.mode&1)===0&&($e===0||$e===11||$e===15)){var Je=Ke.alternate;Je?(Ke.updateQueue=Je.updateQueue,Ke.memoizedState=Je.memoizedState,Ke.lanes=Je.lanes):(Ke.updateQueue=null,Ke.memoizedState=null)}var ct=cu($);if(ct!==null){ct.flags&=-257,hu(ct,$,de,U,v),ct.mode&1&&uu(U,Oe,v),v=ct,ye=Oe;var pt=v.updateQueue;if(pt===null){var mt=new Set;mt.add(ye),v.updateQueue=mt}else pt.add(ye);break e}else{if((v&1)===0){uu(U,Oe,v),Es();break e}ye=Error(r(426))}}else if(Kt&&de.mode&1){var ar=cu($);if(ar!==null){(ar.flags&65536)===0&&(ar.flags|=256),hu(ar,$,de,U,v),ko(mi(ye,de));break e}}U=ye=mi(ye,de),ur!==4&&(ur=2),$i===null?$i=[U]:$i.push(U),U=$;do{switch(U.tag){case 3:U.flags|=65536,v&=-v,U.lanes|=v;var Ce=su(U,ye,v);Fl(U,Ce);break e;case 1:de=ye;var xe=U.type,Be=U.stateNode;if((U.flags&128)===0&&(typeof xe.getDerivedStateFromError=="function"||Be!==null&&typeof Be.componentDidCatch=="function"&&(Rn===null||!Rn.has(Be)))){U.flags|=65536,v&=-v,U.lanes|=v;var rt=lu(U,de,v);Fl(U,rt);break e}}U=U.return}while(U!==null)}Gu(w)}catch(At){v=At,sr===w&&w!==null&&(sr=w=w.return);continue}break}while(!0)}function zu(){var d=Ga.current;return Ga.current=Da,d===null?Da:d}function Es(){(ur===0||ur===3||ur===2)&&(ur=4),hr===null||(Wn&268435455)===0&&(Ha&268435455)===0||Bn(hr,mr)}function Xa(d,v){var w=Ut;Ut|=2;var I=zu();(hr!==d||mr!==v)&&(dn=null,Jn(d,v));do try{mh();break}catch(D){Vu(d,D)}while(!0);if(Vo(),Ut=w,Ga.current=I,sr!==null)throw Error(r(261));return hr=null,mr=0,ur}function mh(){for(;sr!==null;)Uu(sr)}function gh(){for(;sr!==null&&!Dn();)Uu(sr)}function Uu(d){var v=ju(d.alternate,d,Fr);d.memoizedProps=d.pendingProps,v===null?Gu(d):sr=v,gs.current=null}function Gu(d){var v=d;do{var w=v.alternate;if(d=v.return,(v.flags&32768)===0){if(w=uh(w,v,Fr),w!==null){sr=w;return}}else{if(w=ch(w,v),w!==null){w.flags&=32767,sr=w;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{ur=6,sr=null;return}}if(v=v.sibling,v!==null){sr=v;return}sr=v=d}while(v!==null);ur===0&&(ur=5)}function Xn(d,v,w){var I=Ee,D=Hr.transition;try{Hr.transition=null,Ee=1,yh(d,v,w,I)}finally{Hr.transition=D,Ee=I}return null}function yh(d,v,w,I){do bi();while(In!==null);if((Ut&6)!==0)throw Error(r(327));w=d.finishedWork;var D=d.finishedLanes;if(w===null)return null;if(d.finishedWork=null,d.finishedLanes=0,w===d.current)throw Error(r(177));d.callbackNode=null,d.callbackPriority=0;var U=w.lanes|w.childLanes;if(ne(d,U),d===hr&&(sr=hr=null,mr=0),(w.subtreeFlags&2064)===0&&(w.flags&2064)===0||ja||(ja=!0,Wu(Yr,function(){return bi(),null})),U=(w.flags&15990)!==0,(w.subtreeFlags&15990)!==0||U){U=Hr.transition,Hr.transition=null;var $=Ee;Ee=1;var de=Ut;Ut|=4,gs.current=null,dh(d,w),Lu(w,d),Nc(Eo),aa=!!wo,Eo=wo=null,d.current=w,ph(w),pn(),Ut=de,Ee=$,Hr.transition=U}else d.current=w;if(ja&&(ja=!1,In=d,Wa=D),U=d.pendingLanes,U===0&&(Rn=null),Zn(w.stateNode),Pr(d,Vt()),v!==null)for(I=d.onRecoverableError,w=0;w<v.length;w++)D=v[w],I(D.value,{componentStack:D.stack,digest:D.digest});if(qa)throw qa=!1,d=bs,bs=null,d;return(Wa&1)!==0&&d.tag!==0&&bi(),U=d.pendingLanes,(U&1)!==0?d===xs?ea++:(ea=0,xs=d):ea=0,En(),null}function bi(){if(In!==null){var d=Xe(Wa),v=Hr.transition,w=Ee;try{if(Hr.transition=null,Ee=16>d?16:d,In===null)var I=!1;else{if(d=In,In=null,Wa=0,(Ut&6)!==0)throw Error(r(331));var D=Ut;for(Ut|=4,dt=d.current;dt!==null;){var U=dt,$=U.child;if((dt.flags&16)!==0){var de=U.deletions;if(de!==null){for(var ye=0;ye<de.length;ye++){var Oe=de[ye];for(dt=Oe;dt!==null;){var Ke=dt;switch(Ke.tag){case 0:case 11:case 15:Zi(8,Ke,U)}var $e=Ke.child;if($e!==null)$e.return=Ke,dt=$e;else for(;dt!==null;){Ke=dt;var Je=Ke.sibling,ct=Ke.return;if(Tu(Ke),Ke===Oe){dt=null;break}if(Je!==null){Je.return=ct,dt=Je;break}dt=ct}}}var pt=U.alternate;if(pt!==null){var mt=pt.child;if(mt!==null){pt.child=null;do{var ar=mt.sibling;mt.sibling=null,mt=ar}while(mt!==null)}}dt=U}}if((U.subtreeFlags&2064)!==0&&$!==null)$.return=U,dt=$;else e:for(;dt!==null;){if(U=dt,(U.flags&2048)!==0)switch(U.tag){case 0:case 11:case 15:Zi(9,U,U.return)}var Ce=U.sibling;if(Ce!==null){Ce.return=U.return,dt=Ce;break e}dt=U.return}}var xe=d.current;for(dt=xe;dt!==null;){$=dt;var Be=$.child;if(($.subtreeFlags&2064)!==0&&Be!==null)Be.return=$,dt=Be;else e:for($=xe;dt!==null;){if(de=dt,(de.flags&2048)!==0)try{switch(de.tag){case 0:case 11:case 15:Ua(9,de)}}catch(At){nr(de,de.return,At)}if(de===$){dt=null;break e}var rt=de.sibling;if(rt!==null){rt.return=de.return,dt=rt;break e}dt=de.return}}if(Ut=D,En(),Rr&&typeof Rr.onPostCommitFiberRoot=="function")try{Rr.onPostCommitFiberRoot(kn,d)}catch{}I=!0}return I}finally{Ee=w,Hr.transition=v}}return!1}function Hu(d,v,w){v=mi(w,v),v=su(d,v,1),d=Cn(d,v,1),v=Sr(),d!==null&&(Y(d,1,v),Pr(d,v))}function nr(d,v,w){if(d.tag===3)Hu(d,d,w);else for(;v!==null;){if(v.tag===3){Hu(v,d,w);break}else if(v.tag===1){var I=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Rn===null||!Rn.has(I))){d=mi(w,d),d=lu(v,d,1),v=Cn(v,d,1),d=Sr(),v!==null&&(Y(v,1,d),Pr(v,d));break}}v=v.return}}function Ah(d,v,w){var I=d.pingCache;I!==null&&I.delete(v),v=Sr(),d.pingedLanes|=d.suspendedLanes&w,hr===d&&(mr&w)===w&&(ur===4||ur===3&&(mr&130023424)===mr&&500>Vt()-As?Jn(d,0):ys|=w),Pr(d,v)}function qu(d,v){v===0&&((d.mode&1)===0?v=1:(v=mn,mn<<=1,(mn&130023424)===0&&(mn=4194304)));var w=Sr();d=un(d,v),d!==null&&(Y(d,v,w),Pr(d,w))}function bh(d){var v=d.memoizedState,w=0;v!==null&&(w=v.retryLane),qu(d,w)}function xh(d,v){var w=0;switch(d.tag){case 13:var I=d.stateNode,D=d.memoizedState;D!==null&&(w=D.retryLane);break;case 19:I=d.stateNode;break;default:throw Error(r(314))}I!==null&&I.delete(v),qu(d,w)}var ju;ju=function(d,v,w){if(d!==null)if(d.memoizedProps!==v.pendingProps||wr.current)Tr=!0;else{if((d.lanes&w)===0&&(v.flags&128)===0)return Tr=!1,lh(d,v,w);Tr=(d.flags&131072)!==0}else Tr=!1,Kt&&(v.flags&1048576)!==0&&Ml(v,Ma,v.index);switch(v.lanes=0,v.tag){case 2:var I=v.type;Va(d,v),d=v.pendingProps;var D=li(v,yr.current);fi(v,w),D=Ko(null,v,I,d,D,w);var U=Zo();return v.flags|=1,typeof D=="object"&&D!==null&&typeof D.render=="function"&&D.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,Er(I)?(U=!0,ba(v)):U=!1,v.memoizedState=D.state!==null&&D.state!==void 0?D.state:null,Ho(v),D.updater=ka,v.stateNode=D,D._reactInternals=v,ns(v,I,d,w),v=ss(null,v,I,!0,U,w)):(v.tag=0,Kt&&U&&Bo(v),_r(null,v,D,w),v=v.child),v;case 16:I=v.elementType;e:{switch(Va(d,v),d=v.pendingProps,D=I._init,I=D(I._payload),v.type=I,D=v.tag=Sh(I),d=Jr(I,d),D){case 0:v=os(null,v,I,d,w);break e;case 1:v=gu(null,v,I,d,w);break e;case 11:v=du(null,v,I,d,w);break e;case 14:v=pu(null,v,I,Jr(I.type,d),w);break e}throw Error(r(306,I,""))}return v;case 0:return I=v.type,D=v.pendingProps,D=v.elementType===I?D:Jr(I,D),os(d,v,I,D,w);case 1:return I=v.type,D=v.pendingProps,D=v.elementType===I?D:Jr(I,D),gu(d,v,I,D,w);case 3:e:{if(yu(v),d===null)throw Error(r(387));I=v.pendingProps,U=v.memoizedState,D=U.element,Bl(d,v),Ra(v,I,null,w);var $=v.memoizedState;if(I=$.element,U.isDehydrated)if(U={element:I,isDehydrated:!1,cache:$.cache,pendingSuspenseBoundaries:$.pendingSuspenseBoundaries,transitions:$.transitions},v.updateQueue.baseState=U,v.memoizedState=U,v.flags&256){D=mi(Error(r(423)),v),v=Au(d,v,I,w,D);break e}else if(I!==D){D=mi(Error(r(424)),v),v=Au(d,v,I,w,D);break e}else for(Br=Sn(v.stateNode.containerInfo.firstChild),Lr=v,Kt=!0,Qr=null,w=Il(v,null,I,w),v.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling;else{if(hi(),I===D){v=hn(d,v,w);break e}_r(d,v,I,w)}v=v.child}return v;case 5:return Dl(v),d===null&&Do(v),I=v.type,D=v.pendingProps,U=d!==null?d.memoizedProps:null,$=D.children,To(I,D)?$=null:U!==null&&To(I,U)&&(v.flags|=32),mu(d,v),_r(d,v,$,w),v.child;case 6:return d===null&&Do(v),null;case 13:return bu(d,v,w);case 4:return qo(v,v.stateNode.containerInfo),I=v.pendingProps,d===null?v.child=di(v,null,I,w):_r(d,v,I,w),v.child;case 11:return I=v.type,D=v.pendingProps,D=v.elementType===I?D:Jr(I,D),du(d,v,I,D,w);case 7:return _r(d,v,v.pendingProps,w),v.child;case 8:return _r(d,v,v.pendingProps.children,w),v.child;case 12:return _r(d,v,v.pendingProps.children,w),v.child;case 10:e:{if(I=v.type._context,D=v.pendingProps,U=v.memoizedProps,$=D.value,Wt(Ta,I._currentValue),I._currentValue=$,U!==null)if(Wr(U.value,$)){if(U.children===D.children&&!wr.current){v=hn(d,v,w);break e}}else for(U=v.child,U!==null&&(U.return=v);U!==null;){var de=U.dependencies;if(de!==null){$=U.child;for(var ye=de.firstContext;ye!==null;){if(ye.context===I){if(U.tag===1){ye=cn(-1,w&-w),ye.tag=2;var Oe=U.updateQueue;if(Oe!==null){Oe=Oe.shared;var Ke=Oe.pending;Ke===null?ye.next=ye:(ye.next=Ke.next,Ke.next=ye),Oe.pending=ye}}U.lanes|=w,ye=U.alternate,ye!==null&&(ye.lanes|=w),Uo(U.return,w,v),de.lanes|=w;break}ye=ye.next}}else if(U.tag===10)$=U.type===v.type?null:U.child;else if(U.tag===18){if($=U.return,$===null)throw Error(r(341));$.lanes|=w,de=$.alternate,de!==null&&(de.lanes|=w),Uo($,w,v),$=U.sibling}else $=U.child;if($!==null)$.return=U;else for($=U;$!==null;){if($===v){$=null;break}if(U=$.sibling,U!==null){U.return=$.return,$=U;break}$=$.return}U=$}_r(d,v,D.children,w),v=v.child}return v;case 9:return D=v.type,I=v.pendingProps.children,fi(v,w),D=Ur(D),I=I(D),v.flags|=1,_r(d,v,I,w),v.child;case 14:return I=v.type,D=Jr(I,v.pendingProps),D=Jr(I.type,D),pu(d,v,I,D,w);case 15:return fu(d,v,v.type,v.pendingProps,w);case 17:return I=v.type,D=v.pendingProps,D=v.elementType===I?D:Jr(I,D),Va(d,v),v.tag=1,Er(I)?(d=!0,ba(v)):d=!1,fi(v,w),au(v,I,D),ns(v,I,D,w),ss(null,v,I,!0,d,w);case 19:return _u(d,v,w);case 22:return vu(d,v,w)}throw Error(r(156,v.tag))};function Wu(d,v){return pr(d,v)}function _h(d,v,w,I){this.tag=d,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qr(d,v,w,I){return new _h(d,v,w,I)}function Ts(d){return d=d.prototype,!(!d||!d.isReactComponent)}function Sh(d){if(typeof d=="function")return Ts(d)?1:0;if(d!=null){if(d=d.$$typeof,d===H)return 11;if(d===G)return 14}return 2}function Fn(d,v){var w=d.alternate;return w===null?(w=qr(d.tag,v,d.key,d.mode),w.elementType=d.elementType,w.type=d.type,w.stateNode=d.stateNode,w.alternate=d,d.alternate=w):(w.pendingProps=v,w.type=d.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=d.flags&14680064,w.childLanes=d.childLanes,w.lanes=d.lanes,w.child=d.child,w.memoizedProps=d.memoizedProps,w.memoizedState=d.memoizedState,w.updateQueue=d.updateQueue,v=d.dependencies,w.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},w.sibling=d.sibling,w.index=d.index,w.ref=d.ref,w}function Ka(d,v,w,I,D,U){var $=2;if(I=d,typeof d=="function")Ts(d)&&($=1);else if(typeof d=="string")$=5;else e:switch(d){case N:return Kn(w.children,D,U,v);case V:$=8,D|=8;break;case q:return d=qr(12,w,v,D|2),d.elementType=q,d.lanes=U,d;case W:return d=qr(13,w,v,D),d.elementType=W,d.lanes=U,d;case J:return d=qr(19,w,v,D),d.elementType=J,d.lanes=U,d;case X:return Za(w,D,U,v);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case Q:$=10;break e;case z:$=9;break e;case H:$=11;break e;case G:$=14;break e;case te:$=16,I=null;break e}throw Error(r(130,d==null?d:typeof d,""))}return v=qr($,w,v,D),v.elementType=d,v.type=I,v.lanes=U,v}function Kn(d,v,w,I){return d=qr(7,d,I,v),d.lanes=w,d}function Za(d,v,w,I){return d=qr(22,d,I,v),d.elementType=X,d.lanes=w,d.stateNode={isHidden:!1},d}function Cs(d,v,w){return d=qr(6,d,null,v),d.lanes=w,d}function Ps(d,v,w){return v=qr(4,d.children!==null?d.children:[],d.key,v),v.lanes=w,v.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},v}function Mh(d,v,w,I,D){this.tag=v,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Mi(0),this.expirationTimes=Mi(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mi(0),this.identifierPrefix=I,this.onRecoverableError=D,this.mutableSourceEagerHydrationData=null}function Rs(d,v,w,I,D,U,$,de,ye){return d=new Mh(d,v,w,de,ye),v===1?(v=1,U===!0&&(v|=8)):v=0,U=qr(3,null,null,v),d.current=U,U.stateNode=d,U.memoizedState={element:I,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ho(U),d}function wh(d,v,w){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:O,key:I==null?null:""+I,children:d,containerInfo:v,implementation:w}}function Qu(d){if(!d)return wn;d=d._reactInternals;e:{if(St(d)!==d||d.tag!==1)throw Error(r(170));var v=d;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(Er(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(r(171))}if(d.tag===1){var w=d.type;if(Er(w))return xl(d,w,v)}return v}function Ju(d,v,w,I,D,U,$,de,ye){return d=Rs(w,I,!0,d,D,U,$,de,ye),d.context=Qu(null),w=d.current,I=Sr(),D=Ln(w),U=cn(I,D),U.callback=v??null,Cn(w,U,D),d.current.lanes=D,Y(d,D,I),Pr(d,I),d}function Ya(d,v,w,I){var D=v.current,U=Sr(),$=Ln(D);return w=Qu(w),v.context===null?v.context=w:v.pendingContext=w,v=cn(U,$),v.payload={element:d},I=I===void 0?null:I,I!==null&&(v.callback=I),d=Cn(D,v,$),d!==null&&(Zr(d,D,$,U),Pa(d,D,$)),$}function $a(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function Xu(d,v){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var w=d.retryLane;d.retryLane=w!==0&&w<v?w:v}}function Is(d,v){Xu(d,v),(d=d.alternate)&&Xu(d,v)}function Eh(){return null}var Ku=typeof reportError=="function"?reportError:function(d){console.error(d)};function Ls(d){this._internalRoot=d}eo.prototype.render=Ls.prototype.render=function(d){var v=this._internalRoot;if(v===null)throw Error(r(409));Ya(d,v,null,null)},eo.prototype.unmount=Ls.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var v=d.containerInfo;Qn(function(){Ya(null,d,null,null)}),v[an]=null}};function eo(d){this._internalRoot=d}eo.prototype.unstable_scheduleHydration=function(d){if(d){var v=ir();d={blockedOn:null,target:d,priority:v};for(var w=0;w<bn.length&&v!==0&&v<bn[w].priority;w++);bn.splice(w,0,d),w===0&&Os(d)}};function Bs(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function to(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function Zu(){}function Th(d,v,w,I,D){if(D){if(typeof I=="function"){var U=I;I=function(){var Oe=$a($);U.call(Oe)}}var $=Ju(v,I,d,0,null,!1,!1,"",Zu);return d._reactRootContainer=$,d[an]=$.current,Ni(d.nodeType===8?d.parentNode:d),Qn(),$}for(;D=d.lastChild;)d.removeChild(D);if(typeof I=="function"){var de=I;I=function(){var Oe=$a(ye);de.call(Oe)}}var ye=Rs(d,0,!1,null,null,!1,!1,"",Zu);return d._reactRootContainer=ye,d[an]=ye.current,Ni(d.nodeType===8?d.parentNode:d),Qn(function(){Ya(v,ye,w,I)}),ye}function ro(d,v,w,I,D){var U=w._reactRootContainer;if(U){var $=U;if(typeof D=="function"){var de=D;D=function(){var ye=$a($);de.call(ye)}}Ya(v,$,d,D)}else $=Th(w,v,d,D,I);return $a($)}_t=function(d){switch(d.tag){case 3:var v=d.stateNode;if(v.current.memoizedState.isDehydrated){var w=$r(v.pendingLanes);w!==0&&(me(v,w|1),Pr(v,Vt()),(Ut&6)===0&&(Ai=Vt()+500,En()))}break;case 13:Qn(function(){var I=un(d,1);if(I!==null){var D=Sr();Zr(I,d,1,D)}}),Is(d,1)}},Bt=function(d){if(d.tag===13){var v=un(d,134217728);if(v!==null){var w=Sr();Zr(v,d,134217728,w)}Is(d,134217728)}},$t=function(d){if(d.tag===13){var v=Ln(d),w=un(d,v);if(w!==null){var I=Sr();Zr(w,d,v,I)}Is(d,v)}},ir=function(){return Ee},gr=function(d,v){var w=Ee;try{return Ee=d,v()}finally{Ee=w}},Rt=function(d,v,w){switch(v){case"input":if(oe(d,w),v=w.name,w.type==="radio"&&v!=null){for(w=d;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll("input[name="+JSON.stringify(""+v)+'][type="radio"]'),v=0;v<w.length;v++){var I=w[v];if(I!==d&&I.form===d.form){var D=ya(I);if(!D)throw Error(r(90));Ve(I),oe(I,D)}}}break;case"textarea":at(d,w);break;case"select":v=w.value,v!=null&&De(d,!!w.multiple,v,!1)}},Zt=Ms,ae=Qn;var Ch={usingClientEntryPoint:!1,Events:[Ui,oi,ya,or,Xt,Ms]},ta={findFiberByHostInstance:Vn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ph={bundleType:ta.bundleType,version:ta.version,rendererPackageName:ta.rendererPackageName,rendererConfig:ta.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:P.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=jt(d),d===null?null:d.stateNode},findFiberByHostInstance:ta.findFiberByHostInstance||Eh,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var no=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!no.isDisabled&&no.supportsFiber)try{kn=no.inject(Ph),Rr=no}catch{}}return reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ch,reactDom_production_min.createPortal=function(d,v){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bs(v))throw Error(r(200));return wh(d,v,null,w)},reactDom_production_min.createRoot=function(d,v){if(!Bs(d))throw Error(r(299));var w=!1,I="",D=Ku;return v!=null&&(v.unstable_strictMode===!0&&(w=!0),v.identifierPrefix!==void 0&&(I=v.identifierPrefix),v.onRecoverableError!==void 0&&(D=v.onRecoverableError)),v=Rs(d,1,!1,null,null,w,!1,I,D),d[an]=v.current,Ni(d.nodeType===8?d.parentNode:d),new Ls(v)},reactDom_production_min.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var v=d._reactInternals;if(v===void 0)throw typeof d.render=="function"?Error(r(188)):(d=Object.keys(d).join(","),Error(r(268,d)));return d=jt(v),d=d===null?null:d.stateNode,d},reactDom_production_min.flushSync=function(d){return Qn(d)},reactDom_production_min.hydrate=function(d,v,w){if(!to(v))throw Error(r(200));return ro(null,d,v,!0,w)},reactDom_production_min.hydrateRoot=function(d,v,w){if(!Bs(d))throw Error(r(405));var I=w!=null&&w.hydratedSources||null,D=!1,U="",$=Ku;if(w!=null&&(w.unstable_strictMode===!0&&(D=!0),w.identifierPrefix!==void 0&&(U=w.identifierPrefix),w.onRecoverableError!==void 0&&($=w.onRecoverableError)),v=Ju(v,null,d,1,w??null,D,!1,U,$),d[an]=v.current,Ni(d),I)for(d=0;d<I.length;d++)w=I[d],D=w._getVersion,D=D(w._source),v.mutableSourceEagerHydrationData==null?v.mutableSourceEagerHydrationData=[w,D]:v.mutableSourceEagerHydrationData.push(w,D);return new eo(v)},reactDom_production_min.render=function(d,v,w){if(!to(v))throw Error(r(200));return ro(null,d,v,!1,w)},reactDom_production_min.unmountComponentAtNode=function(d){if(!to(d))throw Error(r(40));return d._reactRootContainer?(Qn(function(){ro(null,null,d,!1,function(){d._reactRootContainer=null,d[an]=null})}),!0):!1},reactDom_production_min.unstable_batchedUpdates=Ms,reactDom_production_min.unstable_renderSubtreeIntoContainer=function(d,v,w,I){if(!to(w))throw Error(r(200));if(d==null||d._reactInternals===void 0)throw Error(r(38));return ro(d,v,w,!1,I)},reactDom_production_min.version="18.3.1-next-f1338f8080-20240426",reactDom_production_min}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),reactDom.exports=requireReactDom_production_min(),reactDom.exports}var reactDomExports=requireReactDom();const ReactDOM=getDefaultExportFromCjs(reactDomExports);Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52));Number.isInteger===void 0&&(Number.isInteger=function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e});Math.sign===void 0&&(Math.sign=function(e){return e<0?-1:e>0?1:+e});"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});Object.assign===void 0&&(Object.assign=function(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");const t=Object(e);for(let r=1;r<arguments.length;r++){const n=arguments[r];if(n!=null)for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t});const REVISION="117",CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,Uncharted2ToneMapping=3,CineonToneMapping=4,ACESFilmicToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,SphericalReflectionMapping=305,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipmapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipmapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,RGBEFormat=RGBAFormat,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,SRGB8_ALPHA8_ASTC_4x4_Format=37840,SRGB8_ALPHA8_ASTC_5x4_Format=37841,SRGB8_ALPHA8_ASTC_5x5_Format=37842,SRGB8_ALPHA8_ASTC_6x5_Format=37843,SRGB8_ALPHA8_ASTC_6x6_Format=37844,SRGB8_ALPHA8_ASTC_8x5_Format=37845,SRGB8_ALPHA8_ASTC_8x6_Format=37846,SRGB8_ALPHA8_ASTC_8x8_Format=37847,SRGB8_ALPHA8_ASTC_10x5_Format=37848,SRGB8_ALPHA8_ASTC_10x6_Format=37849,SRGB8_ALPHA8_ASTC_10x8_Format=37850,SRGB8_ALPHA8_ASTC_10x10_Format=37851,SRGB8_ALPHA8_ASTC_12x10_Format=37852,SRGB8_ALPHA8_ASTC_12x12_Format=37853,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,LogLuvEncoding=3003,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,KeepStencilOp=7680,ReplaceStencilOp=7681,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,StaticDrawUsage=35044,DynamicDrawUsage=35048;function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function(e,t){this._listeners===void 0&&(this._listeners={});var r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)},hasEventListener:function(e,t){if(this._listeners===void 0)return!1;var r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(this._listeners!==void 0){var r=this._listeners,n=r[e];if(n!==void 0){var o=n.indexOf(t);o!==-1&&n.splice(o,1)}}},dispatchEvent:function(e){if(this._listeners!==void 0){var t=this._listeners,r=t[e.type];if(r!==void 0){e.target=this;for(var n=r.slice(0),o=0,s=n.length;o<s;o++)n[o].call(this,e)}}}});var _lut=[];for(var i$1=0;i$1<256;i$1++)_lut[i$1]=(i$1<16?"0":"")+i$1.toString(16);var MathUtils={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0,o=_lut[e&255]+_lut[e>>8&255]+_lut[e>>16&255]+_lut[e>>24&255]+"-"+_lut[t&255]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[r&63|128]+_lut[r>>8&255]+"-"+_lut[r>>16&255]+_lut[r>>24&255]+_lut[n&255]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255];return o.toUpperCase()},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,o){return n+(e-t)*(o-n)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(e*6-15)+10))},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*MathUtils.DEG2RAD},radToDeg:function(e){return e*MathUtils.RAD2DEG},isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,r,n,o){var s=Math.cos,l=Math.sin,u=s(r/2),c=l(r/2),h=s((t+n)/2),f=l((t+n)/2),m=s((t-n)/2),y=l((t-n)/2),A=s((n-t)/2),M=l((n-t)/2);switch(o){case"XYX":e.set(u*f,c*m,c*y,u*h);break;case"YZY":e.set(c*y,u*f,c*m,u*h);break;case"ZXZ":e.set(c*m,c*y,u*f,u*h);break;case"XZX":e.set(u*f,c*M,c*A,u*h);break;case"YXY":e.set(c*A,u*f,c*M,u*h);break;case"ZYZ":e.set(c*M,c*A,u*f,u*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}};function Vector2(e,t){this.x=e||0,this.y=t||0}Object.defineProperties(Vector2.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}});Object.assign(Vector2.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return r!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),n=Math.sin(t),o=this.x-e.x,s=this.y-e.y;return this.x=o*r-s*n+e.x,this.y=o*n+s*r+e.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}});function Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Matrix3.prototype,{isMatrix3:!0,set:function(e,t,r,n,o,s,l,u,c){var h=this.elements;return h[0]=e,h[1]=n,h[2]=l,h[3]=t,h[4]=o,h[5]=u,h[6]=r,h[7]=s,h[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},extractBasis:function(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,o=this.elements,s=r[0],l=r[3],u=r[6],c=r[1],h=r[4],f=r[7],m=r[2],y=r[5],A=r[8],M=n[0],b=n[3],T=n[6],_=n[1],S=n[4],C=n[7],P=n[2],F=n[5],O=n[8];return o[0]=s*M+l*_+u*P,o[3]=s*b+l*S+u*F,o[6]=s*T+l*C+u*O,o[1]=c*M+h*_+f*P,o[4]=c*b+h*S+f*F,o[7]=c*T+h*C+f*O,o[2]=m*M+y*_+A*P,o[5]=m*b+y*S+A*F,o[8]=m*T+y*C+A*O,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8];return t*s*h-t*l*c-r*o*h+r*l*u+n*o*c-n*s*u},getInverse:function(e,t){t!==void 0&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var r=e.elements,n=this.elements,o=r[0],s=r[1],l=r[2],u=r[3],c=r[4],h=r[5],f=r[6],m=r[7],y=r[8],A=y*c-h*m,M=h*f-y*u,b=m*u-c*f,T=o*A+s*M+l*b;if(T===0)return this.set(0,0,0,0,0,0,0,0,0);var _=1/T;return n[0]=A*_,n[1]=(l*m-y*s)*_,n[2]=(h*s-l*c)*_,n[3]=M*_,n[4]=(y*o-l*f)*_,n[5]=(l*u-h*o)*_,n[6]=b*_,n[7]=(s*f-m*o)*_,n[8]=(c*o-s*u)*_,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,n,o,s,l){var u=Math.cos(o),c=Math.sin(o);this.set(r*u,r*c,-r*(u*s+c*l)+s+e,-n*c,n*u,-n*(-c*s+u*l)+l+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=this.elements,o=n[0],s=n[3],l=n[6],u=n[1],c=n[4],h=n[7];return n[0]=t*o+r*u,n[3]=t*s+r*c,n[6]=t*l+r*h,n[1]=-r*o+t*u,n[4]=-r*s+t*c,n[7]=-r*l+t*h,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var _canvas,ImageUtils={getDataURL:function(e){var t;if(typeof HTMLCanvasElement>"u")return e.src;if(e instanceof HTMLCanvasElement)t=e;else{_canvas===void 0&&(_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_canvas.width=e.width,_canvas.height=e.height;var r=_canvas.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=_canvas}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},textureId=0;function Texture(e,t,r,n,o,s,l,u,c,h){Object.defineProperty(this,"id",{value:textureId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.image=e!==void 0?e:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=t!==void 0?t:Texture.DEFAULT_MAPPING,this.wrapS=r!==void 0?r:ClampToEdgeWrapping,this.wrapT=n!==void 0?n:ClampToEdgeWrapping,this.magFilter=o!==void 0?o:LinearFilter,this.minFilter=s!==void 0?s:LinearMipmapLinearFilter,this.anisotropy=c!==void 0?c:1,this.format=l!==void 0?l:RGBAFormat,this.internalFormat=null,this.type=u!==void 0?u:UnsignedByteType,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h!==void 0?h:LinearEncoding,this.version=0,this.onUpdate=null}Texture.DEFAULT_IMAGE=void 0;Texture.DEFAULT_MAPPING=UVMapping;Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var n=this.image;if(n.uuid===void 0&&(n.uuid=MathUtils.generateUUID()),!t&&e.images[n.uuid]===void 0){var o;if(Array.isArray(n)){o=[];for(var s=0,l=n.length;s<l;s++)o.push(ImageUtils.getDataURL(n[s]))}else o=ImageUtils.getDataURL(n);e.images[n.uuid]={uuid:n.uuid,url:o}}r.image=n.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}});Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});function Vector4(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=n!==void 0?n:1}Object.defineProperties(Vector4.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}});Object.assign(Vector4.prototype,{isVector4:!0,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,o=this.w,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*n+s[12]*o,this.y=s[1]*t+s[5]*r+s[9]*n+s[13]*o,this.z=s[2]*t+s[6]*r+s[10]*n+s[14]*o,this.w=s[3]*t+s[7]*r+s[11]*n+s[15]*o,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,o,s=.01,l=.1,u=e.elements,c=u[0],h=u[4],f=u[8],m=u[1],y=u[5],A=u[9],M=u[2],b=u[6],T=u[10];if(Math.abs(h-m)<s&&Math.abs(f-M)<s&&Math.abs(A-b)<s){if(Math.abs(h+m)<l&&Math.abs(f+M)<l&&Math.abs(A+b)<l&&Math.abs(c+y+T-3)<l)return this.set(1,0,0,0),this;t=Math.PI;var _=(c+1)/2,S=(y+1)/2,C=(T+1)/2,P=(h+m)/4,F=(f+M)/4,O=(A+b)/4;return _>S&&_>C?_<s?(r=0,n=.707106781,o=.707106781):(r=Math.sqrt(_),n=P/r,o=F/r):S>C?S<s?(r=.707106781,n=0,o=.707106781):(n=Math.sqrt(S),r=P/n,o=O/n):C<s?(r=.707106781,n=.707106781,o=0):(o=Math.sqrt(C),r=F/o,n=O/o),this.set(r,n,o,t),this}var N=Math.sqrt((b-A)*(b-A)+(f-M)*(f-M)+(m-h)*(m-h));return Math.abs(N)<.001&&(N=1),this.x=(b-A)/N,this.y=(f-M)/N,this.z=(m-h)/N,this.w=Math.acos((c+y+T-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return r!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}});function WebGLRenderTarget(e,t,r){this.width=e,this.height=t,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),r=r||{},this.texture=new Texture(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:LinearFilter,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!0,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null}WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function WebGLMultisampleRenderTarget(e,t,r){WebGLRenderTarget.call(this,e,t,r),this.samples=4}WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:!0,copy:function(e){return WebGLRenderTarget.prototype.copy.call(this,e),this.samples=e.samples,this}});function Quaternion(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=n!==void 0?n:1}Object.assign(Quaternion,{slerp:function(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function(e,t,r,n,o,s,l){var u=r[n+0],c=r[n+1],h=r[n+2],f=r[n+3],m=o[s+0],y=o[s+1],A=o[s+2],M=o[s+3];if(f!==M||u!==m||c!==y||h!==A){var b=1-l,T=u*m+c*y+h*A+f*M,_=T>=0?1:-1,S=1-T*T;if(S>Number.EPSILON){var C=Math.sqrt(S),P=Math.atan2(C,T*_);b=Math.sin(b*P)/C,l=Math.sin(l*P)/C}var F=l*_;if(u=u*b+m*F,c=c*b+y*F,h=h*b+A*F,f=f*b+M*F,b===1-l){var O=1/Math.sqrt(u*u+c*c+h*h+f*f);u*=O,c*=O,h*=O,f*=O}}e[t]=u,e[t+1]=c,e[t+2]=h,e[t+3]=f},multiplyQuaternionsFlat:function(e,t,r,n,o,s){var l=r[n],u=r[n+1],c=r[n+2],h=r[n+3],f=o[s],m=o[s+1],y=o[s+2],A=o[s+3];return e[t]=l*A+h*f+u*y-c*m,e[t+1]=u*A+h*m+c*f-l*y,e[t+2]=c*A+h*y+l*m-u*f,e[t+3]=h*A-l*f-u*m-c*y,e}});Object.defineProperties(Quaternion.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}});Object.assign(Quaternion.prototype,{isQuaternion:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,o=e._z,s=e.order,l=Math.cos,u=Math.sin,c=l(r/2),h=l(n/2),f=l(o/2),m=u(r/2),y=u(n/2),A=u(o/2);switch(s){case"XYZ":this._x=m*h*f+c*y*A,this._y=c*y*f-m*h*A,this._z=c*h*A+m*y*f,this._w=c*h*f-m*y*A;break;case"YXZ":this._x=m*h*f+c*y*A,this._y=c*y*f-m*h*A,this._z=c*h*A-m*y*f,this._w=c*h*f+m*y*A;break;case"ZXY":this._x=m*h*f-c*y*A,this._y=c*y*f+m*h*A,this._z=c*h*A+m*y*f,this._w=c*h*f-m*y*A;break;case"ZYX":this._x=m*h*f-c*y*A,this._y=c*y*f+m*h*A,this._z=c*h*A-m*y*f,this._w=c*h*f+m*y*A;break;case"YZX":this._x=m*h*f+c*y*A,this._y=c*y*f+m*h*A,this._z=c*h*A-m*y*f,this._w=c*h*f-m*y*A;break;case"XZY":this._x=m*h*f-c*y*A,this._y=c*y*f-m*h*A,this._z=c*h*A+m*y*f,this._w=c*h*f+m*y*A;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0],n=t[4],o=t[8],s=t[1],l=t[5],u=t[9],c=t[2],h=t[6],f=t[10],m=r+l+f,y;return m>0?(y=.5/Math.sqrt(m+1),this._w=.25/y,this._x=(h-u)*y,this._y=(o-c)*y,this._z=(s-n)*y):r>l&&r>f?(y=2*Math.sqrt(1+r-l-f),this._w=(h-u)/y,this._x=.25*y,this._y=(n+s)/y,this._z=(o+c)/y):l>f?(y=2*Math.sqrt(1+l-r-f),this._w=(o-c)/y,this._x=(n+s)/y,this._y=.25*y,this._z=(u+h)/y):(y=2*Math.sqrt(1+f-r-l),this._w=(s-n)/y,this._x=(o+c)/y,this._y=(u+h)/y,this._z=.25*y),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var r=1e-6,n=e.dot(t)+1;return n<r?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(MathUtils.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(r===0)return this;var n=Math.min(1,t/r);return this.slerp(e,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,o=e._z,s=e._w,l=t._x,u=t._y,c=t._z,h=t._w;return this._x=r*h+s*l+n*c-o*u,this._y=n*h+s*u+o*l-r*c,this._z=o*h+s*c+r*u-n*l,this._w=s*h-r*l-n*u-o*c,this._onChangeCallback(),this},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var r=this._x,n=this._y,o=this._z,s=this._w,l=s*e._w+r*e._x+n*e._y+o*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=s,this._x=r,this._y=n,this._z=o,this;var u=1-l*l;if(u<=Number.EPSILON){var c=1-t;return this._w=c*s+t*this._w,this._x=c*r+t*this._x,this._y=c*n+t*this._y,this._z=c*o+t*this._z,this.normalize(),this._onChangeCallback(),this}var h=Math.sqrt(u),f=Math.atan2(h,l),m=Math.sin((1-t)*f)/h,y=Math.sin(t*f)/h;return this._w=s*m+this._w*y,this._x=r*m+this._x*y,this._y=n*m+this._y*y,this._z=o*m+this._z*y,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return t===void 0&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},fromBufferAttribute:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var _vector$1=new Vector3,_quaternion=new Quaternion;function Vector3(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}Object.assign(Vector3.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_quaternion.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(_quaternion.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6]*n,this.y=o[1]*t+o[4]*r+o[7]*n,this.z=o[2]*t+o[5]*r+o[8]*n,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,o=e.elements,s=1/(o[3]*t+o[7]*r+o[11]*n+o[15]);return this.x=(o[0]*t+o[4]*r+o[8]*n+o[12])*s,this.y=(o[1]*t+o[5]*r+o[9]*n+o[13])*s,this.z=(o[2]*t+o[6]*r+o[10]*n+o[14])*s,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,o=e.x,s=e.y,l=e.z,u=e.w,c=u*t+s*n-l*r,h=u*r+l*t-o*n,f=u*n+o*r-s*t,m=-o*t-s*r-l*n;return this.x=c*u+m*-o+h*-l-f*-s,this.y=h*u+m*-s+f*-o-c*-l,this.z=f*u+m*-l+c*-s-h*-o,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,r=this.y,n=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*n,this.y=o[1]*t+o[5]*r+o[9]*n,this.z=o[2]*t+o[6]*r+o[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this},cross:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,n=e.y,o=e.z,s=t.x,l=t.y,u=t.z;return this.x=n*u-o*l,this.y=o*s-r*u,this.z=r*l-n*s,this},projectOnVector:function(e){var t=e.lengthSq();if(t===0)return this.set(0,0,0);var r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)},projectOnPlane:function(e){return _vector$1.copy(this).projectOnVector(e),this.sub(_vector$1)},reflect:function(e){return this.sub(_vector$1.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;var r=this.dot(e)/t;return Math.acos(MathUtils.clamp(r,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,t*4)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,t*3)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return r!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});var _v1=new Vector3,_m1=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3;function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Matrix4.prototype,{isMatrix4:!0,set:function(e,t,r,n,o,s,l,u,c,h,f,m,y,A,M,b){var T=this.elements;return T[0]=e,T[4]=t,T[8]=r,T[12]=n,T[1]=o,T[5]=s,T[9]=l,T[13]=u,T[2]=c,T[6]=h,T[10]=f,T[14]=m,T[3]=y,T[7]=A,T[11]=M,T[15]=b,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new Matrix4().fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,r=e.elements,n=1/_v1.setFromMatrixColumn(e,0).length(),o=1/_v1.setFromMatrixColumn(e,1).length(),s=1/_v1.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=0,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,o=e.z,s=Math.cos(r),l=Math.sin(r),u=Math.cos(n),c=Math.sin(n),h=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){var m=s*h,y=s*f,A=l*h,M=l*f;t[0]=u*h,t[4]=-u*f,t[8]=c,t[1]=y+A*c,t[5]=m-M*c,t[9]=-l*u,t[2]=M-m*c,t[6]=A+y*c,t[10]=s*u}else if(e.order==="YXZ"){var b=u*h,T=u*f,_=c*h,S=c*f;t[0]=b+S*l,t[4]=_*l-T,t[8]=s*c,t[1]=s*f,t[5]=s*h,t[9]=-l,t[2]=T*l-_,t[6]=S+b*l,t[10]=s*u}else if(e.order==="ZXY"){var b=u*h,T=u*f,_=c*h,S=c*f;t[0]=b-S*l,t[4]=-s*f,t[8]=_+T*l,t[1]=T+_*l,t[5]=s*h,t[9]=S-b*l,t[2]=-s*c,t[6]=l,t[10]=s*u}else if(e.order==="ZYX"){var m=s*h,y=s*f,A=l*h,M=l*f;t[0]=u*h,t[4]=A*c-y,t[8]=m*c+M,t[1]=u*f,t[5]=M*c+m,t[9]=y*c-A,t[2]=-c,t[6]=l*u,t[10]=s*u}else if(e.order==="YZX"){var C=s*u,P=s*c,F=l*u,O=l*c;t[0]=u*h,t[4]=O-C*f,t[8]=F*f+P,t[1]=f,t[5]=s*h,t[9]=-l*h,t[2]=-c*h,t[6]=P*f+F,t[10]=C-O*f}else if(e.order==="XZY"){var C=s*u,P=s*c,F=l*u,O=l*c;t[0]=u*h,t[4]=-f,t[8]=c*h,t[1]=C*f+O,t[5]=s*h,t[9]=P*f-F,t[2]=F*f-P,t[6]=l*h,t[10]=O*f+C}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(_zero,e,_one)},lookAt:function(e,t,r){var n=this.elements;return _z.subVectors(e,t),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(r,_z),_x.lengthSq()===0&&(Math.abs(r.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(r,_z)),_x.normalize(),_y.crossVectors(_z,_x),n[0]=_x.x,n[4]=_y.x,n[8]=_z.x,n[1]=_x.y,n[5]=_y.y,n[9]=_z.y,n[2]=_x.z,n[6]=_y.z,n[10]=_z.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,o=this.elements,s=r[0],l=r[4],u=r[8],c=r[12],h=r[1],f=r[5],m=r[9],y=r[13],A=r[2],M=r[6],b=r[10],T=r[14],_=r[3],S=r[7],C=r[11],P=r[15],F=n[0],O=n[4],N=n[8],V=n[12],q=n[1],Q=n[5],z=n[9],H=n[13],W=n[2],J=n[6],G=n[10],te=n[14],X=n[3],K=n[7],Z=n[11],ee=n[15];return o[0]=s*F+l*q+u*W+c*X,o[4]=s*O+l*Q+u*J+c*K,o[8]=s*N+l*z+u*G+c*Z,o[12]=s*V+l*H+u*te+c*ee,o[1]=h*F+f*q+m*W+y*X,o[5]=h*O+f*Q+m*J+y*K,o[9]=h*N+f*z+m*G+y*Z,o[13]=h*V+f*H+m*te+y*ee,o[2]=A*F+M*q+b*W+T*X,o[6]=A*O+M*Q+b*J+T*K,o[10]=A*N+M*z+b*G+T*Z,o[14]=A*V+M*H+b*te+T*ee,o[3]=_*F+S*q+C*W+P*X,o[7]=_*O+S*Q+C*J+P*K,o[11]=_*N+S*z+C*G+P*Z,o[15]=_*V+S*H+C*te+P*ee,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],o=e[12],s=e[1],l=e[5],u=e[9],c=e[13],h=e[2],f=e[6],m=e[10],y=e[14],A=e[3],M=e[7],b=e[11],T=e[15];return A*(+o*u*f-n*c*f-o*l*m+r*c*m+n*l*y-r*u*y)+M*(+t*u*y-t*c*m+o*s*m-n*s*y+n*c*h-o*u*h)+b*(+t*c*f-t*l*y-o*s*f+r*s*y+o*l*h-r*c*h)+T*(-n*l*h-t*u*f+t*l*m+n*s*f-r*s*m+r*u*h)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e,t,r){var n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this},getInverse:function(e,t){t!==void 0&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var r=this.elements,n=e.elements,o=n[0],s=n[1],l=n[2],u=n[3],c=n[4],h=n[5],f=n[6],m=n[7],y=n[8],A=n[9],M=n[10],b=n[11],T=n[12],_=n[13],S=n[14],C=n[15],P=A*S*m-_*M*m+_*f*b-h*S*b-A*f*C+h*M*C,F=T*M*m-y*S*m-T*f*b+c*S*b+y*f*C-c*M*C,O=y*_*m-T*A*m+T*h*b-c*_*b-y*h*C+c*A*C,N=T*A*f-y*_*f-T*h*M+c*_*M+y*h*S-c*A*S,V=o*P+s*F+l*O+u*N;if(V===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var q=1/V;return r[0]=P*q,r[1]=(_*M*u-A*S*u-_*l*b+s*S*b+A*l*C-s*M*C)*q,r[2]=(h*S*u-_*f*u+_*l*m-s*S*m-h*l*C+s*f*C)*q,r[3]=(A*f*u-h*M*u-A*l*m+s*M*m+h*l*b-s*f*b)*q,r[4]=F*q,r[5]=(y*S*u-T*M*u+T*l*b-o*S*b-y*l*C+o*M*C)*q,r[6]=(T*f*u-c*S*u-T*l*m+o*S*m+c*l*C-o*f*C)*q,r[7]=(c*M*u-y*f*u+y*l*m-o*M*m-c*l*b+o*f*b)*q,r[8]=O*q,r[9]=(T*A*u-y*_*u-T*s*b+o*_*b+y*s*C-o*A*C)*q,r[10]=(c*_*u-T*h*u+T*s*m-o*_*m-c*s*C+o*h*C)*q,r[11]=(y*h*u-c*A*u-y*s*m+o*A*m+c*s*b-o*h*b)*q,r[12]=N*q,r[13]=(y*_*l-T*A*l+T*s*M-o*_*M-y*s*S+o*A*S)*q,r[14]=(T*h*l-c*_*l-T*s*f+o*_*f+c*s*S-o*h*S)*q,r[15]=(c*A*l-y*h*l+y*s*f-o*A*f-c*s*M+o*h*M)*q,this},scale:function(e){var t=this.elements,r=e.x,n=e.y,o=e.z;return t[0]*=r,t[4]*=n,t[8]*=o,t[1]*=r,t[5]*=n,t[9]*=o,t[2]*=r,t[6]*=n,t[10]*=o,t[3]*=r,t[7]*=n,t[11]*=o,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),o=1-r,s=e.x,l=e.y,u=e.z,c=o*s,h=o*l;return this.set(c*s+r,c*l-n*u,c*u+n*l,0,c*l+n*u,h*l+r,h*u-n*s,0,c*u-n*l,h*u+n*s,o*u*u+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var n=this.elements,o=t._x,s=t._y,l=t._z,u=t._w,c=o+o,h=s+s,f=l+l,m=o*c,y=o*h,A=o*f,M=s*h,b=s*f,T=l*f,_=u*c,S=u*h,C=u*f,P=r.x,F=r.y,O=r.z;return n[0]=(1-(M+T))*P,n[1]=(y+C)*P,n[2]=(A-S)*P,n[3]=0,n[4]=(y-C)*F,n[5]=(1-(m+T))*F,n[6]=(b+_)*F,n[7]=0,n[8]=(A+S)*O,n[9]=(b-_)*O,n[10]=(1-(m+M))*O,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},decompose:function(e,t,r){var n=this.elements,o=_v1.set(n[0],n[1],n[2]).length(),s=_v1.set(n[4],n[5],n[6]).length(),l=_v1.set(n[8],n[9],n[10]).length(),u=this.determinant();u<0&&(o=-o),e.x=n[12],e.y=n[13],e.z=n[14],_m1.copy(this);var c=1/o,h=1/s,f=1/l;return _m1.elements[0]*=c,_m1.elements[1]*=c,_m1.elements[2]*=c,_m1.elements[4]*=h,_m1.elements[5]*=h,_m1.elements[6]*=h,_m1.elements[8]*=f,_m1.elements[9]*=f,_m1.elements[10]*=f,t.setFromRotationMatrix(_m1),r.x=o,r.y=s,r.z=l,this},makePerspective:function(e,t,r,n,o,s){s===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var l=this.elements,u=2*o/(t-e),c=2*o/(r-n),h=(t+e)/(t-e),f=(r+n)/(r-n),m=-(s+o)/(s-o),y=-2*s*o/(s-o);return l[0]=u,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=c,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=y,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this},makeOrthographic:function(e,t,r,n,o,s){var l=this.elements,u=1/(t-e),c=1/(r-n),h=1/(s-o),f=(t+e)*u,m=(r+n)*c,y=(s+o)*h;return l[0]=2*u,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*c,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=-2*h,l[14]=-y,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}});var _matrix=new Matrix4,_quaternion$1=new Quaternion;function Euler(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||Euler.DefaultOrder}Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];Euler.DefaultOrder="XYZ";Object.defineProperties(Euler.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}});Object.assign(Euler.prototype,{isEuler:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=MathUtils.clamp,o=e.elements,s=o[0],l=o[4],u=o[8],c=o[1],h=o[5],f=o[9],m=o[2],y=o[6],A=o[10];switch(t=t||this._order,t){case"XYZ":this._y=Math.asin(n(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-f,A),this._z=Math.atan2(-l,s)):(this._x=Math.atan2(y,h),this._z=0);break;case"YXZ":this._x=Math.asin(-n(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(u,A),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-m,s),this._z=0);break;case"ZXY":this._x=Math.asin(n(y,-1,1)),Math.abs(y)<.9999999?(this._y=Math.atan2(-m,A),this._z=Math.atan2(-l,h)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-n(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(y,A),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-l,h));break;case"YZX":this._z=Math.asin(n(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-f,h),this._y=Math.atan2(-m,s)):(this._x=0,this._y=Math.atan2(u,A));break;case"XZY":this._z=Math.asin(-n(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(y,h),this._y=Math.atan2(u,s)):(this._x=Math.atan2(-f,A),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r!==!1&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,r){return _matrix.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_matrix,t,r)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return _quaternion$1.setFromEuler(this),this.setFromQuaternion(_quaternion$1,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});function Layers(){this.mask=1}Object.assign(Layers.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return(this.mask&e.mask)!==0}});let _object3DId=0;const _v1$1=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position=new Vector3,_scale=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};function Object3D(){Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var e=new Vector3,t=new Euler,r=new Quaternion,n=new Vector3(1,1,1);function o(){r.setFromEuler(t,!1)}function s(){t.setFromQuaternion(r,void 0,!1)}t._onChange(o),r._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0);Object3D.DefaultMatrixAutoUpdate=!0;Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.multiply(_q1),this},rotateOnWorldAxis:function(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.premultiply(_q1),this},rotateX:function(e){return this.rotateOnAxis(_xAxis,e)},rotateY:function(e){return this.rotateOnAxis(_yAxis,e)},rotateZ:function(e){return this.rotateOnAxis(_zAxis,e)},translateOnAxis:function(e,t){return _v1$1.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$1.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(_xAxis,e)},translateY:function(e){return this.translateOnAxis(_yAxis,e)},translateZ:function(e){return this.translateOnAxis(_zAxis,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(_m1$1.getInverse(this.matrixWorld))},lookAt:function(e,t,r){e.isVector3?_target.copy(e):_target.set(e,t,r);var n=this.parent;this.updateWorldMatrix(!0,!1),_position.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position,_target,this.up):_m1$1.lookAt(_target,_position,this.up),this.quaternion.setFromRotationMatrix(_m1$1),n&&(_m1$1.extractRotation(n.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return r!==-1&&(e.parent=null,this.children.splice(r,1),e.dispatchEvent(_removedEvent)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),_m1$1.getInverse(this.matrixWorld),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(e.parent.matrixWorld)),e.applyMatrix4(_m1$1),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var o=this.children[r],s=o.getObjectByProperty(e,t);if(s!==void 0)return s}},getWorldPosition:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Quaternion),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_position,e,_scale),e},getWorldScale:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Vector3),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_position,_quaternion$2,e),e},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0)for(var n=this.children,o=0,s=n.length;o<s;o++)n[o].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON());function o(T,_){return T[_.uuid]===void 0&&(T[_.uuid]=_.toJSON(e)),_.uuid}if(this.isMesh||this.isLine||this.isPoints){n.geometry=o(e.geometries,this.geometry);var s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){var l=s.shapes;if(Array.isArray(l))for(var u=0,c=l.length;u<c;u++){var h=l[u];o(e.shapes,h)}else o(e.shapes,l)}}if(this.material!==void 0)if(Array.isArray(this.material)){for(var f=[],u=0,c=this.material.length;u<c;u++)f.push(o(e.materials,this.material[u]));n.material=f}else n.material=o(e.materials,this.material);if(this.children.length>0){n.children=[];for(var u=0;u<this.children.length;u++)n.children.push(this.children[u].toJSON(e).object)}if(t){var m=b(e.geometries),y=b(e.materials),A=b(e.textures),M=b(e.images),l=b(e.shapes);m.length>0&&(r.geometries=m),y.length>0&&(r.materials=y),A.length>0&&(r.textures=A),M.length>0&&(r.images=M),l.length>0&&(r.shapes=l)}return r.object=n,r;function b(T){var _=[];for(var S in T){var C=T[S];delete C.metadata,_.push(C)}return _}},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){if(t===void 0&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}return this}});function Scene$1(){Object3D.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Scene$1.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene$1,isScene:!0,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return this.background!==null&&(t.object.background=this.background.toJSON(e)),this.environment!==null&&(t.object.environment=this.environment.toJSON(e)),this.fog!==null&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$1$1=new Vector3,_box=new Box3,_v0=new Vector3,_v1$2=new Vector3,_v2=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function Box3(e,t){this.min=e!==void 0?e:new Vector3(1/0,1/0,1/0),this.max=t!==void 0?t:new Vector3(-1/0,-1/0,-1/0)}Object.assign(Box3.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,n=1/0,o=-1/0,s=-1/0,l=-1/0,u=0,c=e.length;u<c;u+=3){var h=e[u],f=e[u+1],m=e[u+2];h<t&&(t=h),f<r&&(r=f),m<n&&(n=m),h>o&&(o=h),f>s&&(s=f),m>l&&(l=m)}return this.min.set(t,r,n),this.max.set(o,s,l),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,n=1/0,o=-1/0,s=-1/0,l=-1/0,u=0,c=e.count;u<c;u++){var h=e.getX(u),f=e.getY(u),m=e.getZ(u);h<t&&(t=h),f<r&&(r=f),m<n&&(n=m),h>o&&(o=h),f>s&&(s=f),m>l&&(l=m)}return this.min.set(t,r,n),this.max.set(o,s,l),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=_vector$1$1.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),_box.copy(t.boundingBox),_box.applyMatrix4(e.matrixWorld),this.union(_box));for(var r=e.children,n=0,o=r.length;n<o;n++)this.expandByObject(r[n]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Vector3),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,_vector$1$1),_vector$1$1.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0.subVectors(e.a,_center),_v1$2.subVectors(e.b,_center),_v2.subVectors(e.c,_center),_f0.subVectors(_v1$2,_v0),_f1.subVectors(_v2,_v1$2),_f2.subVectors(_v0,_v2);var t=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(t,_v0,_v1$2,_v2,_extents)||(t=[1,0,0,0,1,0,0,0,1],!satForAxes(t,_v0,_v1$2,_v2,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),t=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(t,_v0,_v1$2,_v2,_extents))},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){var t=_vector$1$1.copy(e).clamp(this.min,this.max);return t.sub(e).length()},getBoundingSphere:function(e){return e===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=this.getSize(_vector$1$1).length()*.5,e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_points),this)},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});function satForAxes(e,t,r,n,o){var s,l;for(s=0,l=e.length-3;s<=l;s+=3){_testAxis.fromArray(e,s);var u=o.x*Math.abs(_testAxis.x)+o.y*Math.abs(_testAxis.y)+o.z*Math.abs(_testAxis.z),c=t.dot(_testAxis),h=r.dot(_testAxis),f=n.dot(_testAxis);if(Math.max(-Math.max(c,h,f),Math.min(c,h,f))>u)return!1}return!0}var _box$1=new Box3;function Sphere(e,t){this.center=e!==void 0?e:new Vector3,this.radius=t!==void 0?t:-1}Object.assign(Sphere.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var r=this.center;t!==void 0?r.copy(t):_box$1.setFromPoints(e).getCenter(r);for(var n=0,o=0,s=e.length;o<s;o++)n=Math.max(n,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(n),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},isEmpty:function(){return this.radius<0},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return t===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Box3),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var _vector$2=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal=new Vector3;function Ray(e,t){this.origin=e!==void 0?e:new Vector3,this.direction=t!==void 0?t:new Vector3(0,0,-1)}Object.assign(Ray.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return t===void 0&&(console.warn("THREE.Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,_vector$2)),this},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=_vector$2.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_vector$2.copy(this.direction).multiplyScalar(t).add(this.origin),_vector$2.distanceToSquared(e))},distanceSqToSegment:function(e,t,r,n){_segCenter.copy(e).add(t).multiplyScalar(.5),_segDir.copy(t).sub(e).normalize(),_diff.copy(this.origin).sub(_segCenter);var o=e.distanceTo(t)*.5,s=-this.direction.dot(_segDir),l=_diff.dot(this.direction),u=-_diff.dot(_segDir),c=_diff.lengthSq(),h=Math.abs(1-s*s),f,m,y,A;if(h>0)if(f=s*u-l,m=s*l-u,A=o*h,f>=0)if(m>=-A)if(m<=A){var M=1/h;f*=M,m*=M,y=f*(f+s*m+2*l)+m*(s*f+m+2*u)+c}else m=o,f=Math.max(0,-(s*m+l)),y=-f*f+m*(m+2*u)+c;else m=-o,f=Math.max(0,-(s*m+l)),y=-f*f+m*(m+2*u)+c;else m<=-A?(f=Math.max(0,-(-s*o+l)),m=f>0?-o:Math.min(Math.max(-o,-u),o),y=-f*f+m*(m+2*u)+c):m<=A?(f=0,m=Math.min(Math.max(-o,-u),o),y=m*(m+2*u)+c):(f=Math.max(0,-(s*o+l)),m=f>0?o:Math.min(Math.max(-o,-u),o),y=-f*f+m*(m+2*u)+c);else m=s>0?-o:o,f=Math.max(0,-(s*m+l)),y=-f*f+m*(m+2*u)+c;return r&&r.copy(this.direction).multiplyScalar(f).add(this.origin),n&&n.copy(_segDir).multiplyScalar(m).add(_segCenter),y},intersectSphere:function(e,t){_vector$2.subVectors(e.center,this.origin);var r=_vector$2.dot(this.direction),n=_vector$2.dot(_vector$2)-r*r,o=e.radius*e.radius;if(n>o)return null;var s=Math.sqrt(o-n),l=r-s,u=r+s;return l<0&&u<0?null:l<0?this.at(u,t):this.at(l,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return r===null?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0)return!0;var r=e.normal.dot(this.direction);return r*t<0},intersectBox:function(e,t){var r,n,o,s,l,u,c=1/this.direction.x,h=1/this.direction.y,f=1/this.direction.z,m=this.origin;return c>=0?(r=(e.min.x-m.x)*c,n=(e.max.x-m.x)*c):(r=(e.max.x-m.x)*c,n=(e.min.x-m.x)*c),h>=0?(o=(e.min.y-m.y)*h,s=(e.max.y-m.y)*h):(o=(e.max.y-m.y)*h,s=(e.min.y-m.y)*h),r>s||o>n||((o>r||r!==r)&&(r=o),(s<n||n!==n)&&(n=s),f>=0?(l=(e.min.z-m.z)*f,u=(e.max.z-m.z)*f):(l=(e.max.z-m.z)*f,u=(e.min.z-m.z)*f),r>u||l>n)||((l>r||r!==r)&&(r=l),(u<n||n!==n)&&(n=u),n<0)?null:this.at(r>=0?r:n,t)},intersectsBox:function(e){return this.intersectBox(e,_vector$2)!==null},intersectTriangle:function(e,t,r,n,o){_edge1.subVectors(t,e),_edge2.subVectors(r,e),_normal.crossVectors(_edge1,_edge2);var s=this.direction.dot(_normal),l;if(s>0){if(n)return null;l=1}else if(s<0)l=-1,s=-s;else return null;_diff.subVectors(this.origin,e);var u=l*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(u<0)return null;var c=l*this.direction.dot(_edge1.cross(_diff));if(c<0||u+c>s)return null;var h=-l*_diff.dot(_normal);return h<0?null:this.at(h/s,o)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;function Plane(e,t){this.normal=e!==void 0?e:new Vector3(1,0,0),this.constant=t!==void 0?t:0}Object.assign(Plane.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,r){var n=_vector1.subVectors(r,t).cross(_vector2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return t===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){t===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Vector3);var r=e.delta(_vector1),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/n;if(!(o<0||o>1))return t.copy(r).multiplyScalar(o).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Vector3),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var r=t||_normalMatrix.getNormalMatrix(e),n=this.coplanarPoint(_vector1).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(o),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var _v0$1=new Vector3,_v1$3=new Vector3,_v2$1=new Vector3,_v3=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;function Triangle(e,t,r){this.a=e!==void 0?e:new Vector3,this.b=t!==void 0?t:new Vector3,this.c=r!==void 0?r:new Vector3}Object.assign(Triangle,{getNormal:function(e,t,r,n){n===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new Vector3),n.subVectors(r,t),_v0$1.subVectors(e,t),n.cross(_v0$1);var o=n.lengthSq();return o>0?n.multiplyScalar(1/Math.sqrt(o)):n.set(0,0,0)},getBarycoord:function(e,t,r,n,o){_v0$1.subVectors(n,t),_v1$3.subVectors(r,t),_v2$1.subVectors(e,t);var s=_v0$1.dot(_v0$1),l=_v0$1.dot(_v1$3),u=_v0$1.dot(_v2$1),c=_v1$3.dot(_v1$3),h=_v1$3.dot(_v2$1),f=s*c-l*l;if(o===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),o=new Vector3),f===0)return o.set(-2,-1,-1);var m=1/f,y=(c*u-l*h)*m,A=(s*h-l*u)*m;return o.set(1-y-A,A,y)},containsPoint:function(e,t,r,n){return Triangle.getBarycoord(e,t,r,n,_v3),_v3.x>=0&&_v3.y>=0&&_v3.x+_v3.y<=1},getUV:function(e,t,r,n,o,s,l,u){return this.getBarycoord(e,t,r,n,_v3),u.set(0,0),u.addScaledVector(o,_v3.x),u.addScaledVector(s,_v3.y),u.addScaledVector(l,_v3.z),u},isFrontFacing:function(e,t,r,n){return _v0$1.subVectors(r,t),_v1$3.subVectors(e,t),_v0$1.cross(_v1$3).dot(n)<0}});Object.assign(Triangle.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5},getMidpoint:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Vector3),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Triangle.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Plane),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,r,n,o){return Triangle.getUV(e,this.a,this.b,this.c,t,r,n,o)},containsPoint:function(e){return Triangle.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Vector3);var r=this.a,n=this.b,o=this.c,s,l;_vab.subVectors(n,r),_vac.subVectors(o,r),_vap.subVectors(e,r);var u=_vab.dot(_vap),c=_vac.dot(_vap);if(u<=0&&c<=0)return t.copy(r);_vbp.subVectors(e,n);var h=_vab.dot(_vbp),f=_vac.dot(_vbp);if(h>=0&&f<=h)return t.copy(n);var m=u*f-h*c;if(m<=0&&u>=0&&h<=0)return s=u/(u-h),t.copy(r).addScaledVector(_vab,s);_vcp.subVectors(e,o);var y=_vab.dot(_vcp),A=_vac.dot(_vcp);if(A>=0&&y<=A)return t.copy(o);var M=y*c-u*A;if(M<=0&&c>=0&&A<=0)return l=c/(c-A),t.copy(r).addScaledVector(_vac,l);var b=h*A-y*f;if(b<=0&&f-h>=0&&y-A>=0)return _vbc.subVectors(o,n),l=(f-h)/(f-h+(y-A)),t.copy(n).addScaledVector(_vbc,l);var T=1/(b+M+m);return s=M*T,l=m*T,t.copy(r).addScaledVector(_vab,s).addScaledVector(_vac,l)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function Color(e,t,r){return t===void 0&&r===void 0?this.set(e):this.setRGB(e,t,r)}function hue2rgb(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*6*(2/3-r):e}function SRGBToLinear(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function LinearToSRGB(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}Object.assign(Color.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(e=MathUtils.euclideanModulo(e,1),t=MathUtils.clamp(t,0,1),r=MathUtils.clamp(r,0,1),t===0)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+t):r+t-r*t,o=2*r-n;this.r=hue2rgb(o,n,e+1/3),this.g=hue2rgb(o,n,e),this.b=hue2rgb(o,n,e-1/3)}return this},setStyle:function(e){function t(m){m!==void 0&&parseFloat(m)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,o=r[1],s=r[2];switch(o){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s)){var l=parseFloat(n[1])/360,u=parseInt(n[2],10)/100,c=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(l,u,c)}break}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var h=r[1],f=h.length;if(f===3)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,this;if(f===6)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=_colorKeywords[e];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return t===void 0&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){t===void 0&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this},copyLinearToSRGB:function(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t=this.r,r=this.g,n=this.b,o=Math.max(t,r,n),s=Math.min(t,r,n),l,u,c=(s+o)/2;if(s===o)l=0,u=0;else{var h=o-s;switch(u=c<=.5?h/(o+s):h/(2-o-s),o){case t:l=(r-n)/h+(r<n?6:0);break;case r:l=(n-t)/h+2;break;case n:l=(t-r)/h+4;break}l/=6}return e.h=l,e.s=u,e.l=c,e},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,r){return this.getHSL(_hslA),_hslA.h+=e,_hslA.s+=t,_hslA.l+=r,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(_hslA),e.getHSL(_hslB);var r=MathUtils.lerp(_hslA.h,_hslB.h,t),n=MathUtils.lerp(_hslA.s,_hslB.s,t),o=MathUtils.lerp(_hslA.l,_hslB.l,t);return this.setHSL(r,n,o),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return t===void 0&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});Color.NAMES=_colorKeywords;function Face3(e,t,r,n,o,s){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new Vector3,this.vertexNormals=Array.isArray(n)?n:[],this.color=o&&o.isColor?o:new Color,this.vertexColors=Array.isArray(o)?o:[],this.materialIndex=s!==void 0?s:0}Object.assign(Face3.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var materialId=0;function Material(){Object.defineProperty(this,"id",{value:materialId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=NormalBlending,this.side=FrontSide,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(e!==void 0)for(var t in e){var r=e[t];if(r===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===FlatShading;continue}var n=this[t];if(n===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r}},toJSON:function(e){var t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,this.combine!==void 0&&(r.combine=this.combine),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.size!==void 0&&(r.size=this.size),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(r.blending=this.blending),this.flatShading===!0&&(r.flatShading=this.flatShading),this.side!==FrontSide&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(r.morphTargets=!0),this.morphNormals===!0&&(r.morphNormals=!0),this.skinning===!0&&(r.skinning=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData);function n(l){var u=[];for(var c in l){var h=l[c];delete h.metadata,u.push(h)}return u}if(t){var o=n(e.textures),s=n(e.images);o.length>0&&(r.textures=o),s.length>0&&(r.images=s)}return r},clone:function(){return new this.constructor().copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,r=null;if(t!==null){var n=t.length;r=new Array(n);for(var o=0;o!==n;++o)r[o]=t[o].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(Material.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});function MeshBasicMaterial(e){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}MeshBasicMaterial.prototype=Object.create(Material.prototype);MeshBasicMaterial.prototype.constructor=MeshBasicMaterial;MeshBasicMaterial.prototype.isMeshBasicMaterial=!0;MeshBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var _vector$3=new Vector3;function BufferAttribute(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r===!0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,o=this.itemSize;n<o;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,n=0,o=e.length;n<o;n++){var s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),s=new Color),t[r++]=s.r,t[r++]=s.g,t[r++]=s.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,o=e.length;n<o;n++){var s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new Vector2),t[r++]=s.x,t[r++]=s.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,n=0,o=e.length;n<o;n++){var s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new Vector3),t[r++]=s.x,t[r++]=s.y,t[r++]=s.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,n=0,o=e.length;n<o;n++){var s=e[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),s=new Vector4),t[r++]=s.x,t[r++]=s.y,t[r++]=s.z,t[r++]=s.w}return this},applyMatrix3:function(e){for(var t=0,r=this.count;t<r;t++)_vector$3.x=this.getX(t),_vector$3.y=this.getY(t),_vector$3.z=this.getZ(t),_vector$3.applyMatrix3(e),this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z);return this},applyMatrix4:function(e){for(var t=0,r=this.count;t<r;t++)_vector$3.x=this.getX(t),_vector$3.y=this.getY(t),_vector$3.z=this.getZ(t),_vector$3.applyMatrix4(e),this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z);return this},applyNormalMatrix:function(e){for(var t=0,r=this.count;t<r;t++)_vector$3.x=this.getX(t),_vector$3.y=this.getY(t),_vector$3.z=this.getZ(t),_vector$3.applyNormalMatrix(e),this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z);return this},transformDirection:function(e){for(var t=0,r=this.count;t<r;t++)_vector$3.x=this.getX(t),_vector$3.y=this.getY(t),_vector$3.z=this.getZ(t),_vector$3.transformDirection(e),this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z);return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=o,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function Int8BufferAttribute(e,t,r){BufferAttribute.call(this,new Int8Array(e),t,r)}Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int8BufferAttribute.prototype.constructor=Int8BufferAttribute;function Uint8BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint8Array(e),t,r)}Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute;function Uint8ClampedBufferAttribute(e,t,r){BufferAttribute.call(this,new Uint8ClampedArray(e),t,r)}Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute;function Int16BufferAttribute(e,t,r){BufferAttribute.call(this,new Int16Array(e),t,r)}Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int16BufferAttribute.prototype.constructor=Int16BufferAttribute;function Uint16BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint16Array(e),t,r)}Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute;function Int32BufferAttribute(e,t,r){BufferAttribute.call(this,new Int32Array(e),t,r)}Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int32BufferAttribute.prototype.constructor=Int32BufferAttribute;function Uint32BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint32Array(e),t,r)}Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute;function Float32BufferAttribute(e,t,r){BufferAttribute.call(this,new Float32Array(e),t,r)}Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Float32BufferAttribute.prototype.constructor=Float32BufferAttribute;function Float64BufferAttribute(e,t,r){BufferAttribute.call(this,new Float64Array(e),t,r)}Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Float64BufferAttribute.prototype.constructor=Float64BufferAttribute;function DirectGeometry(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(DirectGeometry.prototype,{computeGroups:function(e){for(var t,r=[],n=void 0,o=e.faces,s=0;s<o.length;s++){var l=o[s];l.materialIndex!==n&&(n=l.materialIndex,t!==void 0&&(t.count=s*3-t.start,r.push(t)),t={start:s*3,materialIndex:n})}t!==void 0&&(t.count=s*3-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t=e.faces,r=e.vertices,n=e.faceVertexUvs,o=n[0]&&n[0].length>0,s=n[1]&&n[1].length>0,l=e.morphTargets,u=l.length,c;if(u>0){c=[];for(var h=0;h<u;h++)c[h]={name:l[h].name,data:[]};this.morphTargets.position=c}var f=e.morphNormals,m=f.length,y;if(m>0){y=[];for(var h=0;h<m;h++)y[h]={name:f[h].name,data:[]};this.morphTargets.normal=y}var A=e.skinIndices,M=e.skinWeights,b=A.length===r.length,T=M.length===r.length;r.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var h=0;h<t.length;h++){var _=t[h];this.vertices.push(r[_.a],r[_.b],r[_.c]);var S=_.vertexNormals;if(S.length===3)this.normals.push(S[0],S[1],S[2]);else{var C=_.normal;this.normals.push(C,C,C)}var P=_.vertexColors;if(P.length===3)this.colors.push(P[0],P[1],P[2]);else{var F=_.color;this.colors.push(F,F,F)}if(o===!0){var O=n[0][h];O!==void 0?this.uvs.push(O[0],O[1],O[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",h),this.uvs.push(new Vector2,new Vector2,new Vector2))}if(s===!0){var O=n[1][h];O!==void 0?this.uvs2.push(O[0],O[1],O[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",h),this.uvs2.push(new Vector2,new Vector2,new Vector2))}for(var N=0;N<u;N++){var V=l[N].vertices;c[N].data.push(V[_.a],V[_.b],V[_.c])}for(var N=0;N<m;N++){var q=f[N].vertexNormals[h];y[N].data.push(q.a,q.b,q.c)}b&&this.skinIndices.push(A[_.a],A[_.b],A[_.c]),T&&this.skinWeights.push(M[_.a],M[_.b],M[_.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}});function arrayMax(e){if(e.length===0)return-1/0;let t=e[0];for(let r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}var _bufferGeometryId=1,_m1$2=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$4=new Vector3;function BufferGeometry(){Object.defineProperty(this,"id",{value:_bufferGeometryId+=2}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(arrayMax(e)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:r!==void 0?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);var r=this.attributes.normal;if(r!==void 0){var n=new Matrix3().getNormalMatrix(e);r.applyNormalMatrix(n),r.needsUpdate=!0}var o=this.attributes.tangent;return o!==void 0&&(o.transformDirection(e),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(e){return _m1$2.makeRotationX(e),this.applyMatrix4(_m1$2),this},rotateY:function(e){return _m1$2.makeRotationY(e),this.applyMatrix4(_m1$2),this},rotateZ:function(e){return _m1$2.makeRotationZ(e),this.applyMatrix4(_m1$2),this},translate:function(e,t,r){return _m1$2.makeTranslation(e,t,r),this.applyMatrix4(_m1$2),this},scale:function(e,t,r){return _m1$2.makeScale(e,t,r),this.applyMatrix4(_m1$2),this},lookAt:function(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new Float32BufferAttribute(t.vertices.length*3,3),n=new Float32BufferAttribute(t.colors.length*3,3);if(this.setAttribute("position",r.copyVector3sArray(t.vertices)),this.setAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var o=new Float32BufferAttribute(t.lineDistances.length,1);this.setAttribute("lineDistance",o.copyArray(t.lineDistances))}t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var o=e[r];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Float32BufferAttribute(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var r=t.__directGeometry;if(t.elementsNeedUpdate===!0&&(r=void 0,t.elementsNeedUpdate=!1),r===void 0)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate,r.normalsNeedUpdate=t.normalsNeedUpdate,r.colorsNeedUpdate=t.colorsNeedUpdate,r.uvsNeedUpdate=t.uvsNeedUpdate,r.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=r}var n;return t.verticesNeedUpdate===!0&&(n=this.attributes.position,n!==void 0&&(n.copyVector3sArray(t.vertices),n.needsUpdate=!0),t.verticesNeedUpdate=!1),t.normalsNeedUpdate===!0&&(n=this.attributes.normal,n!==void 0&&(n.copyVector3sArray(t.normals),n.needsUpdate=!0),t.normalsNeedUpdate=!1),t.colorsNeedUpdate===!0&&(n=this.attributes.color,n!==void 0&&(n.copyColorsArray(t.colors),n.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(n=this.attributes.uv,n!==void 0&&(n.copyVector2sArray(t.uvs),n.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(n=this.attributes.lineDistance,n!==void 0&&(n.copyArray(t.lineDistances),n.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new DirectGeometry().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(e.vertices.length*3);if(this.setAttribute("position",new BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(e.normals.length*3);this.setAttribute("normal",new BufferAttribute(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(e.colors.length*3);this.setAttribute("color",new BufferAttribute(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var o=new Float32Array(e.uvs.length*2);this.setAttribute("uv",new BufferAttribute(o,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var s=new Float32Array(e.uvs2.length*2);this.setAttribute("uv2",new BufferAttribute(s,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(var l in e.morphTargets){for(var u=[],c=e.morphTargets[l],h=0,f=c.length;h<f;h++){var m=c[h],y=new Float32BufferAttribute(m.data.length*3,3);y.name=m.name,u.push(y.copyVector3sArray(m.data))}this.morphAttributes[l]=u}if(e.skinIndices.length>0){var A=new Float32BufferAttribute(e.skinIndices.length*4,4);this.setAttribute("skinIndex",A.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var M=new Float32BufferAttribute(e.skinWeights.length*4,4);this.setAttribute("skinWeight",M.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Box3);var e=this.attributes.position,t=this.morphAttributes.position;if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(var r=0,n=t.length;r<n;r++){var o=t[r];_box$2.setFromBufferAttribute(o),this.morphTargetsRelative?(_vector$4.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$4),_vector$4.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$4)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var r=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(e),t)for(var n=0,o=t.length;n<o;n++){var s=t[n];_boxMorphTargets.setFromBufferAttribute(s),this.morphTargetsRelative?(_vector$4.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$4),_vector$4.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$4)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(r);for(var l=0,n=0,o=e.count;n<o;n++)_vector$4.fromBufferAttribute(e,n),l=Math.max(l,r.distanceToSquared(_vector$4));if(t)for(var n=0,o=t.length;n<o;n++)for(var s=t[n],u=this.morphTargetsRelative,c=0,h=s.count;c<h;c++)_vector$4.fromBufferAttribute(s,c),u&&(_offset.fromBufferAttribute(e,c),_vector$4.add(_offset)),l=Math.max(l,r.distanceToSquared(_vector$4));this.boundingSphere.radius=Math.sqrt(l),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(t.normal===void 0)this.setAttribute("normal",new BufferAttribute(new Float32Array(r.length),3));else for(var n=t.normal.array,o=0,s=n.length;o<s;o++)n[o]=0;var l=t.normal.array,u,c,h,f=new Vector3,m=new Vector3,y=new Vector3,A=new Vector3,M=new Vector3;if(e)for(var b=e.array,o=0,s=e.count;o<s;o+=3)u=b[o+0]*3,c=b[o+1]*3,h=b[o+2]*3,f.fromArray(r,u),m.fromArray(r,c),y.fromArray(r,h),A.subVectors(y,m),M.subVectors(f,m),A.cross(M),l[u]+=A.x,l[u+1]+=A.y,l[u+2]+=A.z,l[c]+=A.x,l[c+1]+=A.y,l[c+2]+=A.z,l[h]+=A.x,l[h+1]+=A.y,l[h+2]+=A.z;else for(var o=0,s=r.length;o<s;o+=9)f.fromArray(r,o),m.fromArray(r,o+3),y.fromArray(r,o+6),A.subVectors(y,m),M.subVectors(f,m),A.cross(M),l[o]=A.x,l[o+1]=A.y,l[o+2]=A.z,l[o+3]=A.x,l[o+4]=A.y,l[o+5]=A.z,l[o+6]=A.x,l[o+7]=A.y,l[o+8]=A.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(e.attributes[n]!==void 0)for(var o=r[n],s=o.array,l=e.attributes[n],u=l.array,c=l.itemSize*t,h=Math.min(u.length,s.length-c),f=0,m=c;f<h;f++,m++)s[m]=u[f];return this},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,r=e.count;t<r;t++)_vector$4.x=e.getX(t),_vector$4.y=e.getY(t),_vector$4.z=e.getZ(t),_vector$4.normalize(),e.setXYZ(t,_vector$4.x,_vector$4.y,_vector$4.z)},toNonIndexed:function(){function e(b,T){for(var _=b.array,S=b.itemSize,C=b.normalized,P=new _.constructor(T.length*S),F=0,O=0,N=0,V=T.length;N<V;N++){F=T[N]*S;for(var q=0;q<S;q++)P[O++]=_[F++]}return new BufferAttribute(P,S,C)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new BufferGeometry,r=this.index.array,n=this.attributes;for(var o in n){var s=n[o],l=e(s,r);t.setAttribute(o,l)}var u=this.morphAttributes;for(o in u){for(var c=[],h=u[o],f=0,m=h.length;f<m;f++){var s=h[f],l=e(s,r);c.push(l)}t.morphAttributes[o]=c}t.morphTargetsRelative=this.morphTargetsRelative;for(var y=this.groups,f=0,A=y.length;f<A;f++){var M=y[f];t.addGroup(M.start,M.count,M.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){var t=this.parameters;for(var r in t)t[r]!==void 0&&(e[r]=t[r]);return e}e.data={attributes:{}};var n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var o=this.attributes;for(var r in o){var s=o[r],l=s.toJSON();s.name!==""&&(l.name=s.name),e.data.attributes[r]=l}var u={},c=!1;for(var r in this.morphAttributes){for(var h=this.morphAttributes[r],f=[],m=0,y=h.length;m<y;m++){var s=h[m],l=s.toJSON();s.name!==""&&(l.name=s.name),f.push(l)}f.length>0&&(u[r]=f,c=!0)}c&&(e.data.morphAttributes=u,e.data.morphTargetsRelative=this.morphTargetsRelative);var A=this.groups;A.length>0&&(e.data.groups=JSON.parse(JSON.stringify(A)));var M=this.boundingSphere;return M!==null&&(e.data.boundingSphere={center:M.center.toArray(),radius:M.radius}),e},clone:function(){return new BufferGeometry().copy(this)},copy:function(e){var t,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var o=e.index;o!==null&&this.setIndex(o.clone());var s=e.attributes;for(t in s){var l=s[t];this.setAttribute(t,l.clone())}var u=e.morphAttributes;for(t in u){var c=[],h=u[t];for(r=0,n=h.length;r<n;r++)c.push(h[r].clone());this.morphAttributes[t]=c}this.morphTargetsRelative=e.morphTargetsRelative;var f=e.groups;for(r=0,n=f.length;r<n;r++){var m=f[r];this.addGroup(m.start,m.count,m.materialIndex)}var y=e.boundingBox;y!==null&&(this.boundingBox=y.clone());var A=e.boundingSphere;return A!==null&&(this.boundingSphere=A.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_tempA=new Vector3,_tempB=new Vector3,_tempC=new Vector3,_morphA=new Vector3,_morphB=new Vector3,_morphC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;function Mesh(e,t){Object3D.call(this),this.type="Mesh",this.geometry=e!==void 0?e:new BufferGeometry,this.material=t!==void 0?t:new MeshBasicMaterial,this.updateMorphTargets()}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e=this.geometry,t,r,n;if(e.isBufferGeometry){var o=e.morphAttributes,s=Object.keys(o);if(s.length>0){var l=o[s[0]];if(l!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,r=l.length;t<r;t++)n=l[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}else{var u=e.morphTargets;u!==void 0&&u.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var r=this.geometry,n=this.material,o=this.matrixWorld;if(n!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),_sphere.copy(r.boundingSphere),_sphere.applyMatrix4(o),e.ray.intersectsSphere(_sphere)!==!1&&(_inverseMatrix.getInverse(o),_ray.copy(e.ray).applyMatrix4(_inverseMatrix),!(r.boundingBox!==null&&_ray.intersectsBox(r.boundingBox)===!1)))){var s;if(r.isBufferGeometry){var l,u,c,h=r.index,f=r.attributes.position,m=r.morphAttributes.position,y=r.morphTargetsRelative,A=r.attributes.uv,M=r.attributes.uv2,b=r.groups,T=r.drawRange,_,S,C,P,F,O,N,V;if(h!==null)if(Array.isArray(n))for(_=0,C=b.length;_<C;_++)for(F=b[_],O=n[F.materialIndex],N=Math.max(F.start,T.start),V=Math.min(F.start+F.count,T.start+T.count),S=N,P=V;S<P;S+=3)l=h.getX(S),u=h.getX(S+1),c=h.getX(S+2),s=checkBufferGeometryIntersection(this,O,e,_ray,f,m,y,A,M,l,u,c),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=F.materialIndex,t.push(s));else for(N=Math.max(0,T.start),V=Math.min(h.count,T.start+T.count),_=N,C=V;_<C;_+=3)l=h.getX(_),u=h.getX(_+1),c=h.getX(_+2),s=checkBufferGeometryIntersection(this,n,e,_ray,f,m,y,A,M,l,u,c),s&&(s.faceIndex=Math.floor(_/3),t.push(s));else if(f!==void 0)if(Array.isArray(n))for(_=0,C=b.length;_<C;_++)for(F=b[_],O=n[F.materialIndex],N=Math.max(F.start,T.start),V=Math.min(F.start+F.count,T.start+T.count),S=N,P=V;S<P;S+=3)l=S,u=S+1,c=S+2,s=checkBufferGeometryIntersection(this,O,e,_ray,f,m,y,A,M,l,u,c),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=F.materialIndex,t.push(s));else for(N=Math.max(0,T.start),V=Math.min(f.count,T.start+T.count),_=N,C=V;_<C;_+=3)l=_,u=_+1,c=_+2,s=checkBufferGeometryIntersection(this,n,e,_ray,f,m,y,A,M,l,u,c),s&&(s.faceIndex=Math.floor(_/3),t.push(s))}else if(r.isGeometry){var q,Q,z,H=Array.isArray(n),W=r.vertices,J=r.faces,G,te=r.faceVertexUvs[0];te.length>0&&(G=te);for(var X=0,K=J.length;X<K;X++){var Z=J[X],ee=H?n[Z.materialIndex]:n;if(ee!==void 0&&(q=W[Z.a],Q=W[Z.b],z=W[Z.c],s=checkIntersection(this,ee,e,_ray,q,Q,z,_intersectionPoint),s)){if(G&&G[X]){var j=G[X];_uvA.copy(j[0]),_uvB.copy(j[1]),_uvC.copy(j[2]),s.uv=Triangle.getUV(_intersectionPoint,q,Q,z,_uvA,_uvB,_uvC,new Vector2)}s.face=Z,s.faceIndex=X,t.push(s)}}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function checkIntersection(e,t,r,n,o,s,l,u){var c;if(t.side===BackSide?c=n.intersectTriangle(l,s,o,!0,u):c=n.intersectTriangle(o,s,l,t.side!==DoubleSide,u),c===null)return null;_intersectionPointWorld.copy(u),_intersectionPointWorld.applyMatrix4(e.matrixWorld);var h=r.ray.origin.distanceTo(_intersectionPointWorld);return h<r.near||h>r.far?null:{distance:h,point:_intersectionPointWorld.clone(),object:e}}function checkBufferGeometryIntersection(e,t,r,n,o,s,l,u,c,h,f,m){_vA.fromBufferAttribute(o,h),_vB.fromBufferAttribute(o,f),_vC.fromBufferAttribute(o,m);var y=e.morphTargetInfluences;if(t.morphTargets&&s&&y){_morphA.set(0,0,0),_morphB.set(0,0,0),_morphC.set(0,0,0);for(var A=0,M=s.length;A<M;A++){var b=y[A],T=s[A];b!==0&&(_tempA.fromBufferAttribute(T,h),_tempB.fromBufferAttribute(T,f),_tempC.fromBufferAttribute(T,m),l?(_morphA.addScaledVector(_tempA,b),_morphB.addScaledVector(_tempB,b),_morphC.addScaledVector(_tempC,b)):(_morphA.addScaledVector(_tempA.sub(_vA),b),_morphB.addScaledVector(_tempB.sub(_vB),b),_morphC.addScaledVector(_tempC.sub(_vC),b)))}_vA.add(_morphA),_vB.add(_morphB),_vC.add(_morphC)}e.isSkinnedMesh&&(e.boneTransform(h,_vA),e.boneTransform(f,_vB),e.boneTransform(m,_vC));var _=checkIntersection(e,t,r,n,_vA,_vB,_vC,_intersectionPoint);if(_){u&&(_uvA.fromBufferAttribute(u,h),_uvB.fromBufferAttribute(u,f),_uvC.fromBufferAttribute(u,m),_.uv=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2)),c&&(_uvA.fromBufferAttribute(c,h),_uvB.fromBufferAttribute(c,f),_uvC.fromBufferAttribute(c,m),_.uv2=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2));var S=new Face3(h,f,m);Triangle.getNormal(_vA,_vB,_vC,S.normal),_.face=S}return _}var _geometryId=0,_m1$3=new Matrix4,_obj$1=new Object3D,_offset$1=new Vector3;function Geometry(){Object.defineProperty(this,"id",{value:_geometryId+=2}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix4:function(e){for(var t=new Matrix3().getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++){var o=this.vertices[r];o.applyMatrix4(e)}for(var r=0,n=this.faces.length;r<n;r++){var s=this.faces[r];s.normal.applyMatrix3(t).normalize();for(var l=0,u=s.vertexNormals.length;l<u;l++)s.vertexNormals[l].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return _m1$3.makeRotationX(e),this.applyMatrix4(_m1$3),this},rotateY:function(e){return _m1$3.makeRotationY(e),this.applyMatrix4(_m1$3),this},rotateZ:function(e){return _m1$3.makeRotationZ(e),this.applyMatrix4(_m1$3),this},translate:function(e,t,r){return _m1$3.makeTranslation(e,t,r),this.applyMatrix4(_m1$3),this},scale:function(e,t,r){return _m1$3.makeScale(e,t,r),this.applyMatrix4(_m1$3),this},lookAt:function(e){return _obj$1.lookAt(e),_obj$1.updateMatrix(),this.applyMatrix4(_obj$1.matrix),this},fromBufferGeometry:function(e){var t=this,r=e.index!==null?e.index.array:void 0,n=e.attributes;if(n.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var o=n.position.array,s=n.normal!==void 0?n.normal.array:void 0,l=n.color!==void 0?n.color.array:void 0,u=n.uv!==void 0?n.uv.array:void 0,c=n.uv2!==void 0?n.uv2.array:void 0;c!==void 0&&(this.faceVertexUvs[1]=[]);for(var h=0;h<o.length;h+=3)t.vertices.push(new Vector3().fromArray(o,h)),l!==void 0&&t.colors.push(new Color().fromArray(l,h));function f(_,S,C,P){var F=l===void 0?[]:[t.colors[_].clone(),t.colors[S].clone(),t.colors[C].clone()],O=s===void 0?[]:[new Vector3().fromArray(s,_*3),new Vector3().fromArray(s,S*3),new Vector3().fromArray(s,C*3)],N=new Face3(_,S,C,O,F,P);t.faces.push(N),u!==void 0&&t.faceVertexUvs[0].push([new Vector2().fromArray(u,_*2),new Vector2().fromArray(u,S*2),new Vector2().fromArray(u,C*2)]),c!==void 0&&t.faceVertexUvs[1].push([new Vector2().fromArray(c,_*2),new Vector2().fromArray(c,S*2),new Vector2().fromArray(c,C*2)])}var m=e.groups;if(m.length>0)for(var h=0;h<m.length;h++)for(var y=m[h],A=y.start,M=y.count,b=A,T=A+M;b<T;b+=3)r!==void 0?f(r[b],r[b+1],r[b+2],y.materialIndex):f(b,b+1,b+2,y.materialIndex);else if(r!==void 0)for(var h=0;h<r.length;h+=3)f(r[h],r[h+1],r[h+2]);else for(var h=0;h<o.length/3;h+=3)f(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset$1).negate(),this.translate(_offset$1.x,_offset$1.y,_offset$1.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=t===0?1:1/t,n=new Matrix4;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix4(n),this},computeFaceNormals:function(){for(var e=new Vector3,t=new Vector3,r=0,n=this.faces.length;r<n;r++){var o=this.faces[r],s=this.vertices[o.a],l=this.vertices[o.b],u=this.vertices[o.c];e.subVectors(u,l),t.subVectors(s,l),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){e===void 0&&(e=!0);var t,r,n,o,s,l;for(l=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)l[t]=new Vector3;if(e){var u,c,h,f=new Vector3,m=new Vector3;for(n=0,o=this.faces.length;n<o;n++)s=this.faces[n],u=this.vertices[s.a],c=this.vertices[s.b],h=this.vertices[s.c],f.subVectors(h,c),m.subVectors(u,c),f.cross(m),l[s.a].add(f),l[s.b].add(f),l[s.c].add(f)}else for(this.computeFaceNormals(),n=0,o=this.faces.length;n<o;n++)s=this.faces[n],l[s.a].add(s.normal),l[s.b].add(s.normal),l[s.c].add(s.normal);for(t=0,r=this.vertices.length;t<r;t++)l[t].normalize();for(n=0,o=this.faces.length;n<o;n++){s=this.faces[n];var y=s.vertexNormals;y.length===3?(y[0].copy(l[s.a]),y[1].copy(l[s.b]),y[2].copy(l[s.c])):(y[0]=l[s.a].clone(),y[1]=l[s.b].clone(),y[2]=l[s.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){r=this.faces[e];var n=r.vertexNormals;n.length===3?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,n,o;for(r=0,n=this.faces.length;r<n;r++)for(o=this.faces[r],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),e=0,t=o.vertexNormals.length;e<t;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var s=new Geometry;for(s.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var l=this.morphNormals[e].faceNormals,u=this.morphNormals[e].vertexNormals,h,f;for(r=0,n=this.faces.length;r<n;r++)h=new Vector3,f={a:new Vector3,b:new Vector3,c:new Vector3},l.push(h),u.push(f)}var c=this.morphNormals[e];s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals();var h,f;for(r=0,n=this.faces.length;r<n;r++)o=this.faces[r],h=c.faceNormals[r],f=c.vertexNormals[r],h.copy(o.normal),f.a.copy(o.vertexNormals[0]),f.b.copy(o.vertexNormals[1]),f.c.copy(o.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)o=this.faces[r],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var n,o=this.vertices.length,s=this.vertices,l=e.vertices,u=this.faces,c=e.faces,h=this.colors,f=e.colors;r===void 0&&(r=0),t!==void 0&&(n=new Matrix3().getNormalMatrix(t));for(var m=0,y=l.length;m<y;m++){var A=l[m],M=A.clone();t!==void 0&&M.applyMatrix4(t),s.push(M)}for(var m=0,y=f.length;m<y;m++)h.push(f[m].clone());for(m=0,y=c.length;m<y;m++){var b=c[m],T,_,S,C=b.vertexNormals,P=b.vertexColors;T=new Face3(b.a+o,b.b+o,b.c+o),T.normal.copy(b.normal),n!==void 0&&T.normal.applyMatrix3(n).normalize();for(var F=0,O=C.length;F<O;F++)_=C[F].clone(),n!==void 0&&_.applyMatrix3(n).normalize(),T.vertexNormals.push(_);T.color.copy(b.color);for(var F=0,O=P.length;F<O;F++)S=P[F],T.vertexColors.push(S.clone());T.materialIndex=b.materialIndex+r,u.push(T)}for(var m=0,y=e.faceVertexUvs.length;m<y;m++){var N=e.faceVertexUvs[m];this.faceVertexUvs[m]===void 0&&(this.faceVertexUvs[m]=[]);for(var F=0,O=N.length;F<O;F++){for(var V=N[F],q=[],Q=0,z=V.length;Q<z;Q++)q.push(V[Q].clone());this.faceVertexUvs[m].push(q)}}},mergeMesh:function(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e={},t=[],r=[],n,o,s=4,l=Math.pow(10,s),u,c,h,f,m,y;for(u=0,c=this.vertices.length;u<c;u++)n=this.vertices[u],o=Math.round(n.x*l)+"_"+Math.round(n.y*l)+"_"+Math.round(n.z*l),e[o]===void 0?(e[o]=u,t.push(this.vertices[u]),r[u]=t.length-1):r[u]=r[e[o]];var A=[];for(u=0,c=this.faces.length;u<c;u++){h=this.faces[u],h.a=r[h.a],h.b=r[h.b],h.c=r[h.c],f=[h.a,h.b,h.c];for(var M=0;M<3;M++)if(f[M]===f[(M+1)%3]){A.push(u);break}}for(u=A.length-1;u>=0;u--){var b=A[u];for(this.faces.splice(b,1),m=0,y=this.faceVertexUvs.length;m<y;m++)this.faceVertexUvs[m].splice(b,1)}var T=this.vertices.length-t.length;return this.vertices=t,T},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new Vector3(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;function n(h,f){return h.materialIndex-f.materialIndex}e.sort(n);var o=this.faceVertexUvs[0],s=this.faceVertexUvs[1],l,u;o&&o.length===t&&(l=[]),s&&s.length===t&&(u=[]);for(var r=0;r<t;r++){var c=e[r]._id;l&&l.push(o[c]),u&&u.push(s[c])}l&&(this.faceVertexUvs[0]=l),u&&(this.faceVertexUvs[1]=u)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){var t=this.parameters;for(var r in t)t[r]!==void 0&&(e[r]=t[r]);return e}for(var n=[],o=0;o<this.vertices.length;o++){var s=this.vertices[o];n.push(s.x,s.y,s.z)}for(var l=[],u=[],c={},h=[],f={},m=[],y={},o=0;o<this.faces.length;o++){var A=this.faces[o],M=!0,b=!1,T=this.faceVertexUvs[0][o]!==void 0,_=A.normal.length()>0,S=A.vertexNormals.length>0,C=A.color.r!==1||A.color.g!==1||A.color.b!==1,P=A.vertexColors.length>0,F=0;if(F=q(F,0,0),F=q(F,1,M),F=q(F,2,b),F=q(F,3,T),F=q(F,4,_),F=q(F,5,S),F=q(F,6,C),F=q(F,7,P),l.push(F),l.push(A.a,A.b,A.c),l.push(A.materialIndex),T){var O=this.faceVertexUvs[0][o];l.push(H(O[0]),H(O[1]),H(O[2]))}if(_&&l.push(Q(A.normal)),S){var N=A.vertexNormals;l.push(Q(N[0]),Q(N[1]),Q(N[2]))}if(C&&l.push(z(A.color)),P){var V=A.vertexColors;l.push(z(V[0]),z(V[1]),z(V[2]))}}function q(W,J,G){return G?W|1<<J:W&~(1<<J)}function Q(W){var J=W.x.toString()+W.y.toString()+W.z.toString();return c[J]!==void 0||(c[J]=u.length/3,u.push(W.x,W.y,W.z)),c[J]}function z(W){var J=W.r.toString()+W.g.toString()+W.b.toString();return f[J]!==void 0||(f[J]=h.length,h.push(W.getHex())),f[J]}function H(W){var J=W.x.toString()+W.y.toString();return y[J]!==void 0||(y[J]=m.length/2,m.push(W.x,W.y)),y[J]}return e.data={},e.data.vertices=n,e.data.normals=u,h.length>0&&(e.data.colors=h),m.length>0&&(e.data.uvs=[m]),e.data.faces=l,e},clone:function(){return new Geometry().copy(this)},copy:function(e){var t,r,n,o,s,l;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var u=e.vertices;for(t=0,r=u.length;t<r;t++)this.vertices.push(u[t].clone());var c=e.colors;for(t=0,r=c.length;t<r;t++)this.colors.push(c[t].clone());var h=e.faces;for(t=0,r=h.length;t<r;t++)this.faces.push(h[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var f=e.faceVertexUvs[t];for(this.faceVertexUvs[t]===void 0&&(this.faceVertexUvs[t]=[]),n=0,o=f.length;n<o;n++){var m=f[n],y=[];for(s=0,l=m.length;s<l;s++){var A=m[s];y.push(A.clone())}this.faceVertexUvs[t].push(y)}}var M=e.morphTargets;for(t=0,r=M.length;t<r;t++){var b={};if(b.name=M[t].name,M[t].vertices!==void 0)for(b.vertices=[],n=0,o=M[t].vertices.length;n<o;n++)b.vertices.push(M[t].vertices[n].clone());if(M[t].normals!==void 0)for(b.normals=[],n=0,o=M[t].normals.length;n<o;n++)b.normals.push(M[t].normals[n].clone());this.morphTargets.push(b)}var T=e.morphNormals;for(t=0,r=T.length;t<r;t++){var _={};if(T[t].vertexNormals!==void 0)for(_.vertexNormals=[],n=0,o=T[t].vertexNormals.length;n<o;n++){var S=T[t].vertexNormals[n],C={};C.a=S.a.clone(),C.b=S.b.clone(),C.c=S.c.clone(),_.vertexNormals.push(C)}if(T[t].faceNormals!==void 0)for(_.faceNormals=[],n=0,o=T[t].faceNormals.length;n<o;n++)_.faceNormals.push(T[t].faceNormals[n].clone());this.morphNormals.push(_)}var P=e.skinWeights;for(t=0,r=P.length;t<r;t++)this.skinWeights.push(P[t].clone());var F=e.skinIndices;for(t=0,r=F.length;t<r;t++)this.skinIndices.push(F[t].clone());var O=e.lineDistances;for(t=0,r=O.length;t<r;t++)this.lineDistances.push(O[t]);var N=e.boundingBox;N!==null&&(this.boundingBox=N.clone());var V=e.boundingSphere;return V!==null&&(this.boundingSphere=V.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class BoxGeometry extends Geometry{constructor(t,r,n,o,s,l){super(),this.type="BoxGeometry",this.parameters={width:t,height:r,depth:n,widthSegments:o,heightSegments:s,depthSegments:l},this.fromBufferGeometry(new BoxBufferGeometry(t,r,n,o,s,l)),this.mergeVertices()}}class BoxBufferGeometry extends BufferGeometry{constructor(t,r,n,o,s,l){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:r,depth:n,widthSegments:o,heightSegments:s,depthSegments:l};const u=this;t=t||1,r=r||1,n=n||1,o=Math.floor(o)||1,s=Math.floor(s)||1,l=Math.floor(l)||1;const c=[],h=[],f=[],m=[];let y=0,A=0;M("z","y","x",-1,-1,n,r,t,l,s,0),M("z","y","x",1,-1,n,r,-t,l,s,1),M("x","z","y",1,1,t,n,r,o,l,2),M("x","z","y",1,-1,t,n,-r,o,l,3),M("x","y","z",1,-1,t,r,n,o,s,4),M("x","y","z",-1,-1,t,r,-n,o,s,5),this.setIndex(c),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(m,2));function M(b,T,_,S,C,P,F,O,N,V,q){const Q=P/N,z=F/V,H=P/2,W=F/2,J=O/2,G=N+1,te=V+1;let X=0,K=0;const Z=new Vector3;for(let ee=0;ee<te;ee++){const j=ee*z-W;for(let re=0;re<G;re++){const pe=re*Q-H;Z[b]=pe*S,Z[T]=j*C,Z[_]=J,h.push(Z.x,Z.y,Z.z),Z[b]=0,Z[T]=0,Z[_]=O>0?1:-1,f.push(Z.x,Z.y,Z.z),m.push(re/N),m.push(1-ee/V),X+=1}}for(let ee=0;ee<V;ee++)for(let j=0;j<N;j++){const re=y+j+G*ee,pe=y+j+G*(ee+1),ge=y+(j+1)+G*(ee+1),_e=y+(j+1)+G*ee;c.push(re,pe,_e),c.push(pe,ge,_e),K+=6}u.addGroup(A,K,q),A+=K,y+=X}}}function cloneUniforms(e){var t={};for(var r in e){t[r]={};for(var n in e[r]){var o=e[r][n];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture)?t[r][n]=o.clone():Array.isArray(o)?t[r][n]=o.slice():t[r][n]=o}}return t}function mergeUniforms(e){for(var t={},r=0;r<e.length;r++){var n=cloneUniforms(e[r]);for(var o in n)t[o]=n[o]}return t}var UniformsUtils={clone:cloneUniforms,merge:mergeUniforms},default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function ShaderMaterial(e){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}ShaderMaterial.prototype=Object.create(Material.prototype);ShaderMaterial.prototype.constructor=ShaderMaterial;ShaderMaterial.prototype.isShaderMaterial=!0;ShaderMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this};ShaderMaterial.prototype.toJSON=function(e){var t=Material.prototype.toJSON.call(this,e);t.uniforms={};for(var r in this.uniforms){var n=this.uniforms[r],o=n.value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var s={};for(var l in this.extensions)this.extensions[l]===!0&&(s[l]=!0);return Object.keys(s).length>0&&(t.extensions=s),t};function Camera$1(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}Camera$1.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera$1,isCamera:!0,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){Object3D.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}});function PerspectiveCamera(e,t,r,n){Camera$1.call(this),this.type="PerspectiveCamera",this.fov=e!==void 0?e:50,this.zoom=1,this.near=r!==void 0?r:.1,this.far=n!==void 0?n:2e3,this.focus=10,this.aspect=t!==void 0?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}PerspectiveCamera.prototype=Object.assign(Object.create(Camera$1.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(e,t){return Camera$1.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=MathUtils.RAD2DEG*2*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(MathUtils.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return MathUtils.RAD2DEG*2*Math.atan(Math.tan(MathUtils.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,o,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(MathUtils.DEG2RAD*.5*this.fov)/this.zoom,r=2*t,n=this.aspect*r,o=-.5*n,s=this.view;if(this.view!==null&&this.view.enabled){var l=s.fullWidth,u=s.fullHeight;o+=s.offsetX*n/l,t-=s.offsetY*r/u,n*=s.width/l,r*=s.height/u}var c=this.filmOffset;c!==0&&(o+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+n,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var fov=90,aspect=1;function CubeCamera(e,t,r){if(Object3D.call(this),this.type="CubeCamera",r.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=r;var n=new PerspectiveCamera(fov,aspect,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Vector3(1,0,0)),this.add(n);var o=new PerspectiveCamera(fov,aspect,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Vector3(-1,0,0)),this.add(o);var s=new PerspectiveCamera(fov,aspect,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Vector3(0,1,0)),this.add(s);var l=new PerspectiveCamera(fov,aspect,e,t);l.layers=this.layers,l.up.set(0,0,-1),l.lookAt(new Vector3(0,-1,0)),this.add(l);var u=new PerspectiveCamera(fov,aspect,e,t);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new Vector3(0,0,1)),this.add(u);var c=new PerspectiveCamera(fov,aspect,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new Vector3(0,0,-1)),this.add(c),this.update=function(h,f){this.parent===null&&this.updateMatrixWorld();var m=h.xr.enabled,y=h.getRenderTarget();h.xr.enabled=!1;var A=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,h.setRenderTarget(r,0),h.render(f,n),h.setRenderTarget(r,1),h.render(f,o),h.setRenderTarget(r,2),h.render(f,s),h.setRenderTarget(r,3),h.render(f,l),h.setRenderTarget(r,4),h.render(f,u),r.texture.generateMipmaps=A,h.setRenderTarget(r,5),h.render(f,c),h.setRenderTarget(y),h.xr.enabled=m},this.clear=function(h,f,m,y){for(var A=h.getRenderTarget(),M=0;M<6;M++)h.setRenderTarget(r,M),h.clear(f,m,y);h.setRenderTarget(A)}}CubeCamera.prototype=Object.create(Object3D.prototype);CubeCamera.prototype.constructor=CubeCamera;function WebGLCubeRenderTarget(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),WebGLRenderTarget.call(this,e,e,t)}WebGLCubeRenderTarget.prototype=Object.create(WebGLRenderTarget.prototype);WebGLCubeRenderTarget.prototype.constructor=WebGLCubeRenderTarget;WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0;WebGLCubeRenderTarget.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var r=new Scene$1,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","	vWorldDirection = transformDirection( position, modelMatrix );","	#include <begin_vertex>","	#include <project_vertex>","}"].join(`
`),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#include <common>","void main() {","	vec3 direction = normalize( vWorldDirection );","	vec2 sampleUV = equirectUv( direction );","	gl_FragColor = texture2D( tEquirect, sampleUV );","}"].join(`
`)},o=new ShaderMaterial({type:"CubemapFromEquirect",uniforms:cloneUniforms(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:BackSide,blending:NoBlending});o.uniforms.tEquirect.value=t;var s=new Mesh(new BoxBufferGeometry(5,5,5),o);r.add(s);var l=new CubeCamera(1,10,this);return l.update(e,r),s.geometry.dispose(),s.material.dispose(),this};function DataTexture(e,t,r,n,o,s,l,u,c,h,f,m){Texture.call(this,null,s,l,u,c,h,n,o,f,m),this.image={data:e||null,width:t||1,height:r||1},this.magFilter=c!==void 0?c:NearestFilter,this.minFilter=h!==void 0?h:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}DataTexture.prototype=Object.create(Texture.prototype);DataTexture.prototype.constructor=DataTexture;DataTexture.prototype.isDataTexture=!0;var _sphere$1=new Sphere,_vector$5=new Vector3;function Frustum(e,t,r,n,o,s){this.planes=[e!==void 0?e:new Plane,t!==void 0?t:new Plane,r!==void 0?r:new Plane,n!==void 0?n:new Plane,o!==void 0?o:new Plane,s!==void 0?s:new Plane]}Object.assign(Frustum.prototype,{set:function(e,t,r,n,o,s){var l=this.planes;return l[0].copy(e),l[1].copy(t),l[2].copy(r),l[3].copy(n),l[4].copy(o),l[5].copy(s),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromProjectionMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],o=r[1],s=r[2],l=r[3],u=r[4],c=r[5],h=r[6],f=r[7],m=r[8],y=r[9],A=r[10],M=r[11],b=r[12],T=r[13],_=r[14],S=r[15];return t[0].setComponents(l-n,f-u,M-m,S-b).normalize(),t[1].setComponents(l+n,f+u,M+m,S+b).normalize(),t[2].setComponents(l+o,f+c,M+y,S+T).normalize(),t[3].setComponents(l-o,f-c,M-y,S-T).normalize(),t[4].setComponents(l-s,f-h,M-A,S-_).normalize(),t[5].setComponents(l+s,f+h,M+A,S+_).normalize(),this},intersectsObject:function(e){var t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),_sphere$1.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$1)},intersectsSprite:function(e){return _sphere$1.center.set(0,0,0),_sphere$1.radius=.7071067811865476,_sphere$1.applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$1)},intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,o=0;o<6;o++){var s=t[o].distanceToPoint(r);if(s<n)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,r=0;r<6;r++){var n=t[r];if(_vector$5.x=n.normal.x>0?e.max.x:e.min.x,_vector$5.y=n.normal.y>0?e.max.y:e.min.y,_vector$5.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(_vector$5)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var UniformsLib={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}};function WebGLAnimation(){var e=null,t=!1,r=null;function n(o,s){t!==!1&&(r(o,s),e.requestAnimationFrame(n))}return{start:function(){t!==!0&&r!==null&&(e.requestAnimationFrame(n),t=!0)},stop:function(){t=!1},setAnimationLoop:function(o){r=o},setContext:function(o){e=o}}}function WebGLAttributes(e,t){var r=t.isWebGL2,n=new WeakMap;function o(h,f){var m=h.array,y=h.usage,A=e.createBuffer();e.bindBuffer(f,A),e.bufferData(f,m,y),h.onUploadCallback();var M=5126;return m instanceof Float32Array?M=5126:m instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):m instanceof Uint16Array?M=5123:m instanceof Int16Array?M=5122:m instanceof Uint32Array?M=5125:m instanceof Int32Array?M=5124:m instanceof Int8Array?M=5120:m instanceof Uint8Array&&(M=5121),{buffer:A,type:M,bytesPerElement:m.BYTES_PER_ELEMENT,version:h.version}}function s(h,f,m){var y=f.array,A=f.updateRange;e.bindBuffer(m,h),A.count===-1?e.bufferSubData(m,0,y):(r?e.bufferSubData(m,A.offset*y.BYTES_PER_ELEMENT,y,A.offset,A.count):e.bufferSubData(m,A.offset*y.BYTES_PER_ELEMENT,y.subarray(A.offset,A.offset+A.count)),A.count=-1)}function l(h){return h.isInterleavedBufferAttribute&&(h=h.data),n.get(h)}function u(h){h.isInterleavedBufferAttribute&&(h=h.data);var f=n.get(h);f&&(e.deleteBuffer(f.buffer),n.delete(h))}function c(h,f){h.isInterleavedBufferAttribute&&(h=h.data);var m=n.get(h);m===void 0?n.set(h,o(h,f)):m.version<h.version&&(s(m.buffer,h,f),m.version=h.version)}return{get:l,remove:u,update:c}}function PlaneGeometry(e,t,r,n){Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new PlaneBufferGeometry(e,t,r,n)),this.mergeVertices()}PlaneGeometry.prototype=Object.create(Geometry.prototype);PlaneGeometry.prototype.constructor=PlaneGeometry;function PlaneBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},e=e||1,t=t||1;var o=e/2,s=t/2,l=Math.floor(r)||1,u=Math.floor(n)||1,c=l+1,h=u+1,f=e/l,m=t/u,y,A,M=[],b=[],T=[],_=[];for(A=0;A<h;A++){var S=A*m-s;for(y=0;y<c;y++){var C=y*f-o;b.push(C,-S,0),T.push(0,0,1),_.push(y/l),_.push(1-A/u)}}for(A=0;A<u;A++)for(y=0;y<l;y++){var P=y+c*A,F=y+c*(A+1),O=y+1+c*(A+1),N=y+1+c*A;M.push(P,F,N),M.push(F,O,N)}this.setIndex(M),this.setAttribute("position",new Float32BufferAttribute(b,3)),this.setAttribute("normal",new Float32BufferAttribute(T,3)),this.setAttribute("uv",new Float32BufferAttribute(_,2))}PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype);PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry;var alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex="vec3 transformed = vec3( position );",beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha  = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_pars_vertex=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_vertex=`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,common=`#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
  return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_maxMipLevel 8.0
#define cubeUV_minMipLevel 4.0
#define cubeUV_maxTileSize 256.0
#define cubeUV_minTileSize 16.0
float getFace(vec3 direction) {
    vec3 absDirection = abs(direction);
    float face = -1.0;
    if (absDirection.x > absDirection.z) {
      if (absDirection.x > absDirection.y)
        face = direction.x > 0.0 ? 0.0 : 3.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    } else {
      if (absDirection.z > absDirection.y)
        face = direction.z > 0.0 ? 2.0 : 5.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    }
    return face;
}
vec2 getUV(vec3 direction, float face) {
    vec2 uv;
    if (face == 0.0) {
      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {
      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {
      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {
      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {
      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {
      uv = vec2(direction.x, direction.y) / abs(direction.z);    }
    return 0.5 * (uv + 1.0);
}
vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
  float face = getFace(direction);
  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
  mipInt = max(mipInt, cubeUV_minMipLevel);
  float faceSize = exp2(mipInt);
  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
  vec2 uv = getUV(direction, face) * (faceSize - 1.0);
  vec2 f = fract(uv);
  uv += 0.5 - f;
  if (face > 2.0) {
    uv.y += faceSize;
    face -= 3.0;
  }
  uv.x += face * faceSize;
  if(mipInt < cubeUV_maxMipLevel){
    uv.y += 2.0 * cubeUV_maxTileSize;
  }
  uv.y += filterInt * 2.0 * cubeUV_minTileSize;
  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
  uv *= texelSize;
  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x += texelSize;
  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.y += texelSize;
  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x -= texelSize;
  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  vec3 tm = mix(tl, tr, f.x);
  vec3 bm = mix(bl, br, f.x);
  return mix(tm, bm, f.y);
}
#define r0 1.0
#define v0 0.339
#define m0 -2.0
#define r1 0.8
#define v1 0.276
#define m1 -1.0
#define r4 0.4
#define v4 0.046
#define m4 2.0
#define r5 0.305
#define v5 0.016
#define m5 3.0
#define r6 0.21
#define v6 0.0038
#define m6 4.0
float roughnessToMip(float roughness) {
  float mip = 0.0;
  if (roughness >= r1) {
    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
  } else if (roughness >= r4) {
    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
  } else if (roughness >= r5) {
    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
  } else if (roughness >= r6) {
    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
  } else {
    mip = -2.0 * log2(1.16 * roughness);  }
  return mip;
}
vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {
  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);
  float mipF = fract(mip);
  float mipInt = floor(mip);
  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);
  if (mipF == 0.0) {
    return vec4(color0, 1.0);
  } else {
    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);
    return vec4(mix(color0, color1, mipF), 1.0);
  }
}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		}  else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		reflectVec = normalize( reflectVec );
		vec2 sampleUV = equirectUv( reflectVec );
		vec4 envColor = texture2D( envMap, sampleUV );
	#elif defined( ENVMAP_TYPE_SPHERE )
		reflectVec = normalize( reflectVec );
		vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );
		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) { 
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	fogDepth = -mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
		struct PointLightShadow {
			float shadowBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
		  vec3 reflectVec = reflect( -viewDir, normal );
		  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
		  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV = equirectUv( reflectVec );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_SPHERE )
			vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += morphTarget4 * morphTargetInfluences[ 4 ];
	transformed += morphTarget5 * morphTargetInfluences[ 5 ];
	transformed += morphTarget6 * morphTargetInfluences[ 6 ];
	transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );
}`,uv_pars_fragment=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,depth_vert=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,distanceRGBA_frag=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshbasic_vert=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshtoon_frag=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSPARENCY
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSPARENCY
	uniform float transparency;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSPARENCY
		diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,normal_frag=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,normal_vert=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,points_frag=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert=`#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ShaderChunk={alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,aomap_fragment,aomap_pars_fragment,begin_vertex,beginnormal_vertex,bsdfs,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,encodings_fragment,encodings_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_fragment,lightmap_pars_fragment,lights_lambert_vertex,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,uv2_pars_fragment,uv2_pars_vertex,uv2_vertex,worldpos_vertex,background_frag,background_vert,cube_frag,cube_vert,depth_frag,depth_vert,distanceRGBA_frag,distanceRGBA_vert,equirect_frag,equirect_vert,linedashed_frag,linedashed_vert,meshbasic_frag,meshbasic_vert,meshlambert_frag,meshlambert_vert,meshmatcap_frag,meshmatcap_vert,meshtoon_frag,meshtoon_vert,meshphong_frag,meshphong_vert,meshphysical_frag,meshphysical_vert,normal_frag,normal_vert,points_frag,points_vert,shadow_frag,shadow_vert,sprite_frag,sprite_vert},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:mergeUniforms([UniformsLib.envmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transparency:{value:0}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};function WebGLBackground(e,t,r,n){var o=new Color(0),s=0,l,u,c=null,h=0,f=null;function m(A,M,b,T){var _=M.background,S=e.xr,C=S.getSession&&S.getSession();if(C&&C.environmentBlendMode==="additive"&&(_=null),_===null?y(o,s):_&&_.isColor&&(y(_,1),T=!0),(e.autoClear||T)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.isWebGLCubeRenderTarget||_.mapping===CubeUVReflectionMapping)){u===void 0&&(u=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({type:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(F,O,N){this.matrixWorld.copyPosition(N.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u));var P=_.isWebGLCubeRenderTarget?_.texture:_;u.material.uniforms.envMap.value=P,u.material.uniforms.flipEnvMap.value=P.isCubeTexture?-1:1,(c!==_||h!==P.version||f!==e.toneMapping)&&(u.material.needsUpdate=!0,c=_,h=P.version,f=e.toneMapping),A.unshift(u,u.geometry,u.material,0,0,null)}else _&&_.isTexture&&(l===void 0&&(l=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({type:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=_,_.matrixAutoUpdate===!0&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),(c!==_||h!==_.version||f!==e.toneMapping)&&(l.material.needsUpdate=!0,c=_,h=_.version,f=e.toneMapping),A.unshift(l,l.geometry,l.material,0,0,null))}function y(A,M){t.buffers.color.setClear(A.r,A.g,A.b,M,n)}return{getClearColor:function(){return o},setClearColor:function(A,M){o.set(A),s=M!==void 0?M:1,y(o,s)},getClearAlpha:function(){return s},setClearAlpha:function(A){s=A,y(o,s)},render:m}}function WebGLBufferRenderer(e,t,r,n){var o=n.isWebGL2,s;function l(h){s=h}function u(h,f){e.drawArrays(s,h,f),r.update(f,s)}function c(h,f,m,y){if(y!==0){var A,M;if(o)A=e,M="drawArraysInstanced";else if(A=t.get("ANGLE_instanced_arrays"),M="drawArraysInstancedANGLE",A===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}A[M](s,f,m,y),r.update(m,s,y)}}this.setMode=l,this.render=u,this.renderInstances=c}function WebGLCapabilities(e,t,r){var n;function o(){if(n!==void 0)return n;var O=t.get("EXT_texture_filter_anisotropic");return O!==null?n=e.getParameter(O.MAX_TEXTURE_MAX_ANISOTROPY_EXT):n=0,n}function s(O){if(O==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";O="mediump"}return O==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var l=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&e instanceof WebGL2ComputeRenderingContext,u=r.precision!==void 0?r.precision:"highp",c=s(u);c!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",c,"instead."),u=c);var h=r.logarithmicDepthBuffer===!0,f=e.getParameter(34930),m=e.getParameter(35660),y=e.getParameter(3379),A=e.getParameter(34076),M=e.getParameter(34921),b=e.getParameter(36347),T=e.getParameter(36348),_=e.getParameter(36349),S=m>0,C=l||!!t.get("OES_texture_float"),P=S&&C,F=l?e.getParameter(36183):0;return{isWebGL2:l,getMaxAnisotropy:o,getMaxPrecision:s,precision:u,logarithmicDepthBuffer:h,maxTextures:f,maxVertexTextures:m,maxTextureSize:y,maxCubemapSize:A,maxAttributes:M,maxVertexUniforms:b,maxVaryings:T,maxFragmentUniforms:_,vertexTextures:S,floatFragmentTextures:C,floatVertexTextures:P,maxSamples:F}}function WebGLClipping(){var e=this,t=null,r=0,n=!1,o=!1,s=new Plane,l=new Matrix3,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(f,m,y){var A=f.length!==0||m||r!==0||n;return n=m,t=h(f,y,0),r=f.length,A},this.beginShadows=function(){o=!0,h(null)},this.endShadows=function(){o=!1,c()},this.setState=function(f,m,y,A,M,b){if(!n||f===null||f.length===0||o&&!y)o?h(null):c();else{var T=o?0:r,_=T*4,S=M.clippingState||null;u.value=S,S=h(f,A,_,b);for(var C=0;C!==_;++C)S[C]=t[C];M.clippingState=S,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=T}};function c(){u.value!==t&&(u.value=t,u.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function h(f,m,y,A){var M=f!==null?f.length:0,b=null;if(M!==0){if(b=u.value,A!==!0||b===null){var T=y+M*4,_=m.matrixWorldInverse;l.getNormalMatrix(_),(b===null||b.length<T)&&(b=new Float32Array(T));for(var S=0,C=y;S!==M;++S,C+=4)s.copy(f[S]).applyMatrix4(_,l),s.normal.toArray(b,C),b[C+3]=s.constant}u.value=b,u.needsUpdate=!0}return e.numPlanes=M,e.numIntersection=0,b}}function WebGLExtensions(e){var t={};return{get:function(r){if(t[r]!==void 0)return t[r];var n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=n,n}}}function WebGLGeometries(e,t,r){var n=new WeakMap,o=new WeakMap;function s(f){var m=f.target,y=n.get(m);y.index!==null&&t.remove(y.index);for(var A in y.attributes)t.remove(y.attributes[A]);m.removeEventListener("dispose",s),n.delete(m);var M=o.get(y);M&&(t.remove(M),o.delete(y)),r.memory.geometries--}function l(f,m){var y=n.get(m);return y||(m.addEventListener("dispose",s),m.isBufferGeometry?y=m:m.isGeometry&&(m._bufferGeometry===void 0&&(m._bufferGeometry=new BufferGeometry().setFromObject(f)),y=m._bufferGeometry),n.set(m,y),r.memory.geometries++,y)}function u(f){var m=f.index,y=f.attributes;m!==null&&t.update(m,34963);for(var A in y)t.update(y[A],34962);var M=f.morphAttributes;for(var A in M)for(var b=M[A],T=0,_=b.length;T<_;T++)t.update(b[T],34962)}function c(f){var m=[],y=f.index,A=f.attributes.position,M=0;if(y!==null){var b=y.array;M=y.version;for(var T=0,_=b.length;T<_;T+=3){var S=b[T+0],C=b[T+1],P=b[T+2];m.push(S,C,C,P,P,S)}}else{var b=A.array;M=A.version;for(var T=0,_=b.length/3-1;T<_;T+=3){var S=T+0,C=T+1,P=T+2;m.push(S,C,C,P,P,S)}}var F=new(arrayMax(m)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(m,1);F.version=M,t.update(F,34963);var O=o.get(f);O&&t.remove(O),o.set(f,F)}function h(f){var m=o.get(f);if(m){var y=f.index;y!==null&&m.version<y.version&&c(f)}else c(f);return o.get(f)}return{get:l,update:u,getWireframeAttribute:h}}function WebGLIndexedBufferRenderer(e,t,r,n){var o=n.isWebGL2,s;function l(y){s=y}var u,c;function h(y){u=y.type,c=y.bytesPerElement}function f(y,A){e.drawElements(s,A,u,y*c),r.update(A,s)}function m(y,A,M,b){if(b!==0){var T,_;if(o)T=e,_="drawElementsInstanced";else if(T=t.get("ANGLE_instanced_arrays"),_="drawElementsInstancedANGLE",T===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}T[_](s,M,u,A*c,b),r.update(M,s,b)}}this.setMode=l,this.setIndex=h,this.render=f,this.renderInstances=m}function WebGLInfo(e){var t={geometries:0,textures:0},r={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,l,u){switch(u=u||1,r.calls++,l){case 4:r.triangles+=u*(s/3);break;case 1:r.lines+=u*(s/2);break;case 3:r.lines+=u*(s-1);break;case 2:r.lines+=u*s;break;case 0:r.points+=u*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l);break}}function o(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0}return{memory:t,render:r,programs:null,autoReset:!0,reset:o,update:n}}function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}function WebGLMorphtargets(e){var t={},r=new Float32Array(8);function n(o,s,l,u){var c=o.morphTargetInfluences,h=c===void 0?0:c.length,f=t[s.id];if(f===void 0){f=[];for(var m=0;m<h;m++)f[m]=[m,0];t[s.id]=f}for(var y=l.morphTargets&&s.morphAttributes.position,A=l.morphNormals&&s.morphAttributes.normal,m=0;m<h;m++){var M=f[m];M[1]!==0&&(y&&s.deleteAttribute("morphTarget"+m),A&&s.deleteAttribute("morphNormal"+m))}for(var m=0;m<h;m++){var M=f[m];M[0]=m,M[1]=c[m]}f.sort(absNumericalSort);for(var b=0,m=0;m<8;m++){var M=f[m];if(M){var T=M[0],_=M[1];if(_){y&&s.setAttribute("morphTarget"+m,y[T]),A&&s.setAttribute("morphNormal"+m,A[T]),r[m]=_,b+=_;continue}}r[m]=0}var S=s.morphTargetsRelative?1:1-b;u.getUniforms().setValue(e,"morphTargetBaseInfluence",S),u.getUniforms().setValue(e,"morphTargetInfluences",r)}return{update:n}}function WebGLObjects(e,t,r,n){var o=new WeakMap;function s(u){var c=n.render.frame,h=u.geometry,f=t.get(u,h);return o.get(f)!==c&&(h.isGeometry&&f.updateFromObject(u),t.update(f),o.set(f,c)),u.isInstancedMesh&&r.update(u.instanceMatrix,34962),f}function l(){o=new WeakMap}return{update:s,dispose:l}}function CubeTexture(e,t,r,n,o,s,l,u,c,h){e=e!==void 0?e:[],t=t!==void 0?t:CubeReflectionMapping,l=l!==void 0?l:RGBFormat,Texture.call(this,e,t,r,n,o,s,l,u,c,h),this.flipY=!1}CubeTexture.prototype=Object.create(Texture.prototype);CubeTexture.prototype.constructor=CubeTexture;CubeTexture.prototype.isCubeTexture=!0;Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});function DataTexture2DArray(e,t,r,n){Texture.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:n||1},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}DataTexture2DArray.prototype=Object.create(Texture.prototype);DataTexture2DArray.prototype.constructor=DataTexture2DArray;DataTexture2DArray.prototype.isDataTexture2DArray=!0;function DataTexture3D(e,t,r,n){Texture.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:n||1},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}DataTexture3D.prototype=Object.create(Texture.prototype);DataTexture3D.prototype.constructor=DataTexture3D;DataTexture3D.prototype.isDataTexture3D=!0;var emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(e,t,r){var n=e[0];if(n<=0||n>0)return e;var o=t*r,s=arrayCacheF32[o];if(s===void 0&&(s=new Float32Array(o),arrayCacheF32[o]=s),t!==0){n.toArray(s,0);for(var l=1,u=0;l!==t;++l)u+=r,e[l].toArray(s,u)}return s}function arraysEqual(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function copyArray(e,t){for(var r=0,n=t.length;r<n;r++)e[r]=t[r]}function allocTexUnits(e,t){var r=arrayCacheI32[t];r===void 0&&(r=new Int32Array(t),arrayCacheI32[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocateTextureUnit();return r}function setValueV1f(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function setValueV2f(e,t){var r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(arraysEqual(r,t))return;e.uniform2fv(this.addr,t),copyArray(r,t)}}function setValueV3f(e,t){var r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(t.r!==void 0)(r[0]!==t.r||r[1]!==t.g||r[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(arraysEqual(r,t))return;e.uniform3fv(this.addr,t),copyArray(r,t)}}function setValueV4f(e,t){var r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(arraysEqual(r,t))return;e.uniform4fv(this.addr,t),copyArray(r,t)}}function setValueM2(e,t){var r=this.cache,n=t.elements;if(n===void 0){if(arraysEqual(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,n))return;mat2array.set(n),e.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(r,n)}}function setValueM3(e,t){var r=this.cache,n=t.elements;if(n===void 0){if(arraysEqual(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,n))return;mat3array.set(n),e.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(r,n)}}function setValueM4(e,t){var r=this.cache,n=t.elements;if(n===void 0){if(arraysEqual(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),copyArray(r,t)}else{if(arraysEqual(r,n))return;mat4array.set(n),e.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(r,n)}}function setValueT1(e,t,r){var n=this.cache,o=r.allocateTextureUnit();n[0]!==o&&(e.uniform1i(this.addr,o),n[0]=o),r.safeSetTexture2D(t||emptyTexture,o)}function setValueT2DArray1(e,t,r){var n=this.cache,o=r.allocateTextureUnit();n[0]!==o&&(e.uniform1i(this.addr,o),n[0]=o),r.setTexture2DArray(t||emptyTexture2dArray,o)}function setValueT3D1(e,t,r){var n=this.cache,o=r.allocateTextureUnit();n[0]!==o&&(e.uniform1i(this.addr,o),n[0]=o),r.setTexture3D(t||emptyTexture3d,o)}function setValueT6(e,t,r){var n=this.cache,o=r.allocateTextureUnit();n[0]!==o&&(e.uniform1i(this.addr,o),n[0]=o),r.safeSetTextureCube(t||emptyCubeTexture,o)}function setValueV1i(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function setValueV2i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform2iv(this.addr,t),copyArray(r,t))}function setValueV3i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform3iv(this.addr,t),copyArray(r,t))}function setValueV4i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform4iv(this.addr,t),copyArray(r,t))}function setValueV1ui(e,t){var r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function getSingularSetter(e){switch(e){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(e,t){e.uniform1fv(this.addr,t)}function setValueV1iArray(e,t){e.uniform1iv(this.addr,t)}function setValueV2iArray(e,t){e.uniform2iv(this.addr,t)}function setValueV3iArray(e,t){e.uniform3iv(this.addr,t)}function setValueV4iArray(e,t){e.uniform4iv(this.addr,t)}function setValueV2fArray(e,t){var r=flatten(t,this.size,2);e.uniform2fv(this.addr,r)}function setValueV3fArray(e,t){var r=flatten(t,this.size,3);e.uniform3fv(this.addr,r)}function setValueV4fArray(e,t){var r=flatten(t,this.size,4);e.uniform4fv(this.addr,r)}function setValueM2Array(e,t){var r=flatten(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function setValueM3Array(e,t){var r=flatten(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function setValueM4Array(e,t){var r=flatten(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function setValueT1Array(e,t,r){var n=t.length,o=allocTexUnits(r,n);e.uniform1iv(this.addr,o);for(var s=0;s!==n;++s)r.safeSetTexture2D(t[s]||emptyTexture,o[s])}function setValueT6Array(e,t,r){var n=t.length,o=allocTexUnits(r,n);e.uniform1iv(this.addr,o);for(var s=0;s!==n;++s)r.safeSetTextureCube(t[s]||emptyCubeTexture,o[s])}function getPureArraySetter(e){switch(e){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}function SingleUniform(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=getSingularSetter(t.type)}function PureArrayUniform(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=getPureArraySetter(t.type)}PureArrayUniform.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),copyArray(t,e)};function StructuredUniform(e){this.id=e,this.seq=[],this.map={}}StructuredUniform.prototype.setValue=function(e,t,r){for(var n=this.seq,o=0,s=n.length;o!==s;++o){var l=n[o];l.setValue(e,t[l.id],r)}};var RePathPart=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,t,r){var n=e.name,o=n.length;for(RePathPart.lastIndex=0;;){var s=RePathPart.exec(n),l=RePathPart.lastIndex,u=s[1],c=s[2]==="]",h=s[3];if(c&&(u=u|0),h===void 0||h==="["&&l+2===o){addUniform(r,h===void 0?new SingleUniform(u,e,t):new PureArrayUniform(u,e,t));break}else{var f=r.map,m=f[u];m===void 0&&(m=new StructuredUniform(u),addUniform(r,m)),r=m}}}function WebGLUniforms(e,t){this.seq=[],this.map={};for(var r=e.getProgramParameter(t,35718),n=0;n<r;++n){var o=e.getActiveUniform(t,n),s=e.getUniformLocation(t,o.name);parseUniform(o,s,this)}}WebGLUniforms.prototype.setValue=function(e,t,r,n){var o=this.map[t];o!==void 0&&o.setValue(e,r,n)};WebGLUniforms.prototype.setOptional=function(e,t,r){var n=t[r];n!==void 0&&this.setValue(e,r,n)};WebGLUniforms.upload=function(e,t,r,n){for(var o=0,s=t.length;o!==s;++o){var l=t[o],u=r[l.id];u.needsUpdate!==!1&&l.setValue(e,u.value,n)}};WebGLUniforms.seqWithValue=function(e,t){for(var r=[],n=0,o=e.length;n!==o;++n){var s=e[n];s.id in t&&r.push(s)}return r};function WebGLShader(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}var programIdCount=0;function addLineNumbers(e){for(var t=e.split(`
`),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join(`
`)}function getEncodingComponents(e){switch(e){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case LogLuvEncoding:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function getShaderErrors(e,t,r){var n=e.getShaderParameter(t,35713),o=e.getShaderInfoLog(t).trim();if(n&&o==="")return"";var s=e.getShaderSource(t);return"THREE.WebGLShader: gl.getShaderInfoLog() "+r+`
`+o+addLineNumbers(s)}function getTexelDecodingFunction(e,t){var r=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function getTexelEncodingFunction(e,t){var r=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function getToneMappingFunction(e,t){var r;switch(t){case LinearToneMapping:r="Linear";break;case ReinhardToneMapping:r="Reinhard";break;case Uncharted2ToneMapping:r="Uncharted2";break;case CineonToneMapping:r="OptimizedCineon";break;case ACESFilmicToneMapping:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function generateExtensions(e){var t=[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return t.filter(filterEmptyLine).join(`
`)}function generateDefines(e){var t=[];for(var r in e){var n=e[r];n!==!1&&t.push("#define "+r+" "+n)}return t.join(`
`)}function fetchAttributeLocations(e,t){for(var r={},n=e.getProgramParameter(t,35721),o=0;o<n;o++){var s=e.getActiveAttrib(t,o),l=s.name;r[l]=e.getAttribLocation(t,l)}return r}function filterEmptyLine(e){return e!==""}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(e){return e.replace(includePattern,includeReplacer)}function includeReplacer(e,t){var r=ShaderChunk[t];if(r===void 0)throw new Error("Can not resolve #include <"+t+">");return resolveIncludes(r)}var deprecatedUnrollLoopPattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,unrollLoopPattern=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function unrollLoops(e){return e.replace(unrollLoopPattern,loopReplacer).replace(deprecatedUnrollLoopPattern,deprecatedLoopReplacer)}function deprecatedLoopReplacer(e,t,r,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),loopReplacer(e,t,r,n)}function loopReplacer(e,t,r,n){for(var o="",s=parseInt(t);s<parseInt(r);s++)o+=n.replace(/\[ i \]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return o}function generatePrecision(e){var t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function generateShadowMapTypeDefine(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===PCFShadowMap?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}function generateEnvMapTypeDefine(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:t="ENVMAP_TYPE_CUBE_UV";break;case EquirectangularReflectionMapping:case EquirectangularRefractionMapping:t="ENVMAP_TYPE_EQUIREC";break;case SphericalReflectionMapping:t="ENVMAP_TYPE_SPHERE";break}return t}function generateEnvMapModeDefine(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case CubeRefractionMapping:case EquirectangularRefractionMapping:t="ENVMAP_MODE_REFRACTION";break}return t}function generateEnvMapBlendingDefine(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD";break}return t}function WebGLProgram(e,t,r){var n=e.getContext(),o=r.defines,s=r.vertexShader,l=r.fragmentShader,u=generateShadowMapTypeDefine(r),c=generateEnvMapTypeDefine(r),h=generateEnvMapModeDefine(r),f=generateEnvMapBlendingDefine(r),m=e.gammaFactor>0?e.gammaFactor:1,y=r.isWebGL2?"":generateExtensions(r),A=generateDefines(o),M=n.createProgram(),b,T;if(r.isRawShaderMaterial?(b=[A].filter(filterEmptyLine).join(`
`),b.length>0&&(b+=`
`),T=[y,A].filter(filterEmptyLine).join(`
`),T.length>0&&(T+=`
`)):(b=[generatePrecision(r),"#define SHADER_NAME "+r.shaderName,A,r.instancing?"#define USE_INSTANCING":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+h:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&r.flatShading===!1?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+u:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),T=[y,generatePrecision(r),"#define SHADER_NAME "+r.shaderName,A,r.alphaTest?"#define ALPHATEST "+r.alphaTest+(r.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+m,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+c:"",r.envMap?"#define "+h:"",r.envMap?"#define "+f:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.sheen?"#define USE_SHEEN":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+u:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",r.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",r.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.outputEncoding||r.mapEncoding||r.matcapEncoding||r.envMapEncoding||r.emissiveMapEncoding||r.lightMapEncoding?ShaderChunk.encodings_pars_fragment:"",r.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",r.mapEncoding):"",r.matcapEncoding?getTexelDecodingFunction("matcapTexelToLinear",r.matcapEncoding):"",r.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.lightMapEncoding?getTexelDecodingFunction("lightMapTexelToLinear",r.lightMapEncoding):"",r.outputEncoding?getTexelEncodingFunction("linearToOutputTexel",r.outputEncoding):"",r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),s=resolveIncludes(s),s=replaceLightNums(s,r),s=replaceClippingPlaneNums(s,r),l=resolveIncludes(l),l=replaceLightNums(l,r),l=replaceClippingPlaneNums(l,r),s=unrollLoops(s),l=unrollLoops(l),r.isWebGL2&&!r.isRawShaderMaterial){var _=!1,S=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&s.match(S)!==null&&l.match(S)!==null&&(_=!0,s=s.replace(S,""),l=l.replace(S,"")),b=[`#version 300 es
`,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,T=[`#version 300 es
`,"#define varying in",_?"":"out highp vec4 pc_fragColor;",_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+T}var C=b+s,P=T+l,F=WebGLShader(n,35633,C),O=WebGLShader(n,35632,P);if(n.attachShader(M,F),n.attachShader(M,O),r.index0AttributeName!==void 0?n.bindAttribLocation(M,0,r.index0AttributeName):r.morphTargets===!0&&n.bindAttribLocation(M,0,"position"),n.linkProgram(M),e.debug.checkShaderErrors){var N=n.getProgramInfoLog(M).trim(),V=n.getShaderInfoLog(F).trim(),q=n.getShaderInfoLog(O).trim(),Q=!0,z=!0;if(n.getProgramParameter(M,35714)===!1){Q=!1;var H=getShaderErrors(n,F,"vertex"),W=getShaderErrors(n,O,"fragment");console.error("THREE.WebGLProgram: shader error: ",n.getError(),"35715",n.getProgramParameter(M,35715),"gl.getProgramInfoLog",N,H,W)}else N!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",N):(V===""||q==="")&&(z=!1);z&&(this.diagnostics={runnable:Q,programLog:N,vertexShader:{log:V,prefix:b},fragmentShader:{log:q,prefix:T}})}n.deleteShader(F),n.deleteShader(O);var J;this.getUniforms=function(){return J===void 0&&(J=new WebGLUniforms(n,M)),J};var G;return this.getAttributes=function(){return G===void 0&&(G=fetchAttributeLocations(n,M)),G},this.destroy=function(){n.deleteProgram(M),this.program=void 0},this.name=r.shaderName,this.id=programIdCount++,this.cacheKey=t,this.usedTimes=1,this.program=M,this.vertexShader=F,this.fragmentShader=O,this}function WebGLPrograms(e,t,r){var n=[],o=r.isWebGL2,s=r.logarithmicDepthBuffer,l=r.floatVertexTextures,u=r.precision,c=r.maxVertexUniforms,h=r.vertexTextures,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},m=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function y(b,T){var _;if(T){var S=ShaderLib[T];_={name:b.type,uniforms:UniformsUtils.clone(S.uniforms),vertexShader:S.vertexShader,fragmentShader:S.fragmentShader}}else _={name:b.type,uniforms:b.uniforms,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader};return _}function A(b){var T=b.skeleton,_=T.bones;if(l)return 1024;var S=c,C=Math.floor((S-20)/4),P=Math.min(C,_.length);return P<_.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+_.length+" bones. This GPU supports "+P+"."),0):P}function M(b){var T;return b?b.isTexture?T=b.encoding:b.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),T=b.texture.encoding):T=LinearEncoding,T}this.getParameters=function(b,T,_,S,C,P,F){var O=S.fog,N=b.isMeshStandardMaterial?S.environment:null,V=b.envMap||N,q=f[b.type],Q=F.isSkinnedMesh?A(F):0;b.precision!==null&&(u=r.getMaxPrecision(b.precision),u!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",u,"instead."));var z=y(b,q);b.onBeforeCompile(z,e);var H=e.getRenderTarget(),W={isWebGL2:o,shaderID:q,shaderName:z.name,uniforms:z.uniforms,vertexShader:z.vertexShader,fragmentShader:z.fragmentShader,defines:b.defines,isRawShaderMaterial:b.isRawShaderMaterial,isShaderMaterial:b.isShaderMaterial,precision:u,instancing:F.isInstancedMesh===!0,supportsVertexTextures:h,outputEncoding:H!==null?M(H.texture):e.outputEncoding,map:!!b.map,mapEncoding:M(b.map),matcap:!!b.matcap,matcapEncoding:M(b.matcap),envMap:!!V,envMapMode:V&&V.mapping,envMapEncoding:M(V),envMapCubeUV:!!V&&(V.mapping===CubeUVReflectionMapping||V.mapping===CubeUVRefractionMapping),lightMap:!!b.lightMap,lightMapEncoding:M(b.lightMap),aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,emissiveMapEncoding:M(b.emissiveMap),bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,objectSpaceNormalMap:b.normalMapType===ObjectSpaceNormalMap,tangentSpaceNormalMap:b.normalMapType===TangentSpaceNormalMap,clearcoatMap:!!b.clearcoatMap,clearcoatRoughnessMap:!!b.clearcoatRoughnessMap,clearcoatNormalMap:!!b.clearcoatNormalMap,displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,alphaMap:!!b.alphaMap,gradientMap:!!b.gradientMap,sheen:!!b.sheen,combine:b.combine,vertexTangents:b.normalMap&&b.vertexTangents,vertexColors:b.vertexColors,vertexUvs:!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatMap||!!b.clearcoatRoughnessMap||!!b.clearcoatNormalMap||!!b.displacementMap,uvsVertexOnly:!(b.map||b.bumpMap||b.normalMap||b.specularMap||b.alphaMap||b.emissiveMap||b.roughnessMap||b.metalnessMap||b.clearcoatNormalMap)&&!!b.displacementMap,fog:!!O,useFog:b.fog,fogExp2:O&&O.isFogExp2,flatShading:b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:s,skinning:b.skinning&&Q>0,maxBones:Q,useVertexTexture:l,morphTargets:b.morphTargets,morphNormals:b.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:T.directional.length,numPointLights:T.point.length,numSpotLights:T.spot.length,numRectAreaLights:T.rectArea.length,numHemiLights:T.hemi.length,numDirLightShadows:T.directionalShadowMap.length,numPointLightShadows:T.pointShadowMap.length,numSpotLightShadows:T.spotShadowMap.length,numClippingPlanes:C,numClipIntersection:P,dithering:b.dithering,shadowMapEnabled:e.shadowMap.enabled&&_.length>0,shadowMapType:e.shadowMap.type,toneMapping:b.toneMapped?e.toneMapping:NoToneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,alphaTest:b.alphaTest,doubleSided:b.side===DoubleSide,flipSided:b.side===BackSide,depthPacking:b.depthPacking!==void 0?b.depthPacking:!1,index0AttributeName:b.index0AttributeName,extensionDerivatives:b.extensions&&b.extensions.derivatives,extensionFragDepth:b.extensions&&b.extensions.fragDepth,extensionDrawBuffers:b.extensions&&b.extensions.drawBuffers,extensionShaderTextureLOD:b.extensions&&b.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||t.get("EXT_frag_depth")!==null,rendererExtensionDrawBuffers:o||t.get("WEBGL_draw_buffers")!==null,rendererExtensionShaderTextureLod:o||t.get("EXT_shader_texture_lod")!==null,onBeforeCompile:b.onBeforeCompile};return W},this.getProgramCacheKey=function(b){var T=[];if(b.shaderID?T.push(b.shaderID):(T.push(b.fragmentShader),T.push(b.vertexShader)),b.defines!==void 0)for(var _ in b.defines)T.push(_),T.push(b.defines[_]);if(b.isRawShaderMaterial===void 0){for(var S=0;S<m.length;S++)T.push(b[m[S]]);T.push(e.outputEncoding),T.push(e.gammaFactor)}return T.push(b.onBeforeCompile.toString()),T.join()},this.acquireProgram=function(b,T){for(var _,S=0,C=n.length;S<C;S++){var P=n[S];if(P.cacheKey===T){_=P,++_.usedTimes;break}}return _===void 0&&(_=new WebGLProgram(e,T,b),n.push(_)),_},this.releaseProgram=function(b){if(--b.usedTimes===0){var T=n.indexOf(b);n[T]=n[n.length-1],n.pop(),b.destroy()}},this.programs=n}function WebGLProperties(){var e=new WeakMap;function t(s){var l=e.get(s);return l===void 0&&(l={},e.set(s,l)),l}function r(s){e.delete(s)}function n(s,l,u){e.get(s)[l]=u}function o(){e=new WeakMap}return{get:t,remove:r,update:n,dispose:o}}function painterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WebGLRenderList(){var e=[],t=0,r=[],n=[],o={id:-1};function s(){t=0,r.length=0,n.length=0}function l(m,y,A,M,b,T){var _=e[t];return _===void 0?(_={id:m.id,object:m,geometry:y,material:A,program:A.program||o,groupOrder:M,renderOrder:m.renderOrder,z:b,group:T},e[t]=_):(_.id=m.id,_.object=m,_.geometry=y,_.material=A,_.program=A.program||o,_.groupOrder=M,_.renderOrder=m.renderOrder,_.z=b,_.group=T),t++,_}function u(m,y,A,M,b,T){var _=l(m,y,A,M,b,T);(A.transparent===!0?n:r).push(_)}function c(m,y,A,M,b,T){var _=l(m,y,A,M,b,T);(A.transparent===!0?n:r).unshift(_)}function h(m,y){r.length>1&&r.sort(m||painterSortStable),n.length>1&&n.sort(y||reversePainterSortStable)}function f(){for(var m=t,y=e.length;m<y;m++){var A=e[m];if(A.id===null)break;A.id=null,A.object=null,A.geometry=null,A.material=null,A.program=null,A.group=null}}return{opaque:r,transparent:n,init:s,push:u,unshift:c,finish:f,sort:h}}function WebGLRenderLists(){var e=new WeakMap;function t(o){var s=o.target;s.removeEventListener("dispose",t),e.delete(s)}function r(o,s){var l=e.get(o),u;return l===void 0?(u=new WebGLRenderList,e.set(o,new WeakMap),e.get(o).set(s,u),o.addEventListener("dispose",t)):(u=l.get(s),u===void 0&&(u=new WebGLRenderList,l.set(s,u))),u}function n(){e=new WeakMap}return{get:r,dispose:n}}function UniformsCache(){var e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new Vector3,color:new Color};break;case"SpotLight":r={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":r={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":r={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return e[t.id]=r,r}}}function ShadowUniformsCache(){var e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];var r;switch(t.type){case"DirectionalLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=r,r}}}var nextVersion=0;function shadowCastingLightsFirst(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function WebGLLights(){for(var e=new UniformsCache,t=ShadowUniformsCache(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=0;n<9;n++)r.probe.push(new Vector3);var o=new Vector3,s=new Matrix4,l=new Matrix4;function u(c,h,f){for(var m=0,y=0,A=0,M=0;M<9;M++)r.probe[M].set(0,0,0);var b=0,T=0,_=0,S=0,C=0,P=0,F=0,O=0,N=f.matrixWorldInverse;c.sort(shadowCastingLightsFirst);for(var M=0,V=c.length;M<V;M++){var q=c[M],Q=q.color,z=q.intensity,H=q.distance,W=q.shadow&&q.shadow.map?q.shadow.map.texture:null;if(q.isAmbientLight)m+=Q.r*z,y+=Q.g*z,A+=Q.b*z;else if(q.isLightProbe)for(var J=0;J<9;J++)r.probe[J].addScaledVector(q.sh.coefficients[J],z);else if(q.isDirectionalLight){var G=e.get(q);if(G.color.copy(q.color).multiplyScalar(q.intensity),G.direction.setFromMatrixPosition(q.matrixWorld),o.setFromMatrixPosition(q.target.matrixWorld),G.direction.sub(o),G.direction.transformDirection(N),q.castShadow){var te=q.shadow,X=t.get(q);X.shadowBias=te.bias,X.shadowRadius=te.radius,X.shadowMapSize=te.mapSize,r.directionalShadow[b]=X,r.directionalShadowMap[b]=W,r.directionalShadowMatrix[b]=q.shadow.matrix,P++}r.directional[b]=G,b++}else if(q.isSpotLight){var G=e.get(q);if(G.position.setFromMatrixPosition(q.matrixWorld),G.position.applyMatrix4(N),G.color.copy(Q).multiplyScalar(z),G.distance=H,G.direction.setFromMatrixPosition(q.matrixWorld),o.setFromMatrixPosition(q.target.matrixWorld),G.direction.sub(o),G.direction.transformDirection(N),G.coneCos=Math.cos(q.angle),G.penumbraCos=Math.cos(q.angle*(1-q.penumbra)),G.decay=q.decay,q.castShadow){var te=q.shadow,X=t.get(q);X.shadowBias=te.bias,X.shadowRadius=te.radius,X.shadowMapSize=te.mapSize,r.spotShadow[_]=X,r.spotShadowMap[_]=W,r.spotShadowMatrix[_]=q.shadow.matrix,O++}r.spot[_]=G,_++}else if(q.isRectAreaLight){var G=e.get(q);G.color.copy(Q).multiplyScalar(z),G.position.setFromMatrixPosition(q.matrixWorld),G.position.applyMatrix4(N),l.identity(),s.copy(q.matrixWorld),s.premultiply(N),l.extractRotation(s),G.halfWidth.set(q.width*.5,0,0),G.halfHeight.set(0,q.height*.5,0),G.halfWidth.applyMatrix4(l),G.halfHeight.applyMatrix4(l),r.rectArea[S]=G,S++}else if(q.isPointLight){var G=e.get(q);if(G.position.setFromMatrixPosition(q.matrixWorld),G.position.applyMatrix4(N),G.color.copy(q.color).multiplyScalar(q.intensity),G.distance=q.distance,G.decay=q.decay,q.castShadow){var te=q.shadow,X=t.get(q);X.shadowBias=te.bias,X.shadowRadius=te.radius,X.shadowMapSize=te.mapSize,X.shadowCameraNear=te.camera.near,X.shadowCameraFar=te.camera.far,r.pointShadow[T]=X,r.pointShadowMap[T]=W,r.pointShadowMatrix[T]=q.shadow.matrix,F++}r.point[T]=G,T++}else if(q.isHemisphereLight){var G=e.get(q);G.direction.setFromMatrixPosition(q.matrixWorld),G.direction.transformDirection(N),G.direction.normalize(),G.skyColor.copy(q.color).multiplyScalar(z),G.groundColor.copy(q.groundColor).multiplyScalar(z),r.hemi[C]=G,C++}}r.ambient[0]=m,r.ambient[1]=y,r.ambient[2]=A;var K=r.hash;(K.directionalLength!==b||K.pointLength!==T||K.spotLength!==_||K.rectAreaLength!==S||K.hemiLength!==C||K.numDirectionalShadows!==P||K.numPointShadows!==F||K.numSpotShadows!==O)&&(r.directional.length=b,r.spot.length=_,r.rectArea.length=S,r.point.length=T,r.hemi.length=C,r.directionalShadow.length=P,r.directionalShadowMap.length=P,r.pointShadow.length=F,r.pointShadowMap.length=F,r.spotShadow.length=O,r.spotShadowMap.length=O,r.directionalShadowMatrix.length=P,r.pointShadowMatrix.length=F,r.spotShadowMatrix.length=O,K.directionalLength=b,K.pointLength=T,K.spotLength=_,K.rectAreaLength=S,K.hemiLength=C,K.numDirectionalShadows=P,K.numPointShadows=F,K.numSpotShadows=O,r.version=nextVersion++)}return{setup:u,state:r}}function WebGLRenderState(){var e=new WebGLLights,t=[],r=[];function n(){t.length=0,r.length=0}function o(c){t.push(c)}function s(c){r.push(c)}function l(c){e.setup(t,r,c)}var u={lightsArray:t,shadowsArray:r,lights:e};return{init:n,state:u,setupLights:l,pushLight:o,pushShadow:s}}function WebGLRenderStates(){var e=new WeakMap;function t(o){var s=o.target;s.removeEventListener("dispose",t),e.delete(s)}function r(o,s){var l;return e.has(o)===!1?(l=new WebGLRenderState,e.set(o,new WeakMap),e.get(o).set(s,l),o.addEventListener("dispose",t)):e.get(o).has(s)===!1?(l=new WebGLRenderState,e.get(o).set(s,l)):l=e.get(o).get(s),l}function n(){e=new WeakMap}return{get:r,dispose:n}}function MeshDepthMaterial(e){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}MeshDepthMaterial.prototype=Object.create(Material.prototype);MeshDepthMaterial.prototype.constructor=MeshDepthMaterial;MeshDepthMaterial.prototype.isMeshDepthMaterial=!0;MeshDepthMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this};function MeshDistanceMaterial(e){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}MeshDistanceMaterial.prototype=Object.create(Material.prototype);MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial;MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0;MeshDistanceMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var vsm_frag=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
  float mean = 0.0;
  float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );
  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
    #ifdef HORIZONAL_PASS
      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
      mean += distribution.x;
      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
    #else
      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );
      mean += depth;
      squared_mean += depth * depth;
    #endif
  }
  mean = mean * HALF_SAMPLE_RATE;
  squared_mean = squared_mean * HALF_SAMPLE_RATE;
  float std_dev = sqrt( squared_mean - mean * mean );
  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,vsm_vert=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function WebGLShadowMap(e,t,r){var n=new Frustum,o=new Vector2,s=new Vector2,l=new Vector4,u=[],c=[],h={},f={0:BackSide,1:FrontSide,2:DoubleSide},m=new ShaderMaterial({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vsm_vert,fragmentShader:vsm_frag}),y=m.clone();y.defines.HORIZONAL_PASS=1;var A=new BufferGeometry;A.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var M=new Mesh(A,m),b=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(F,O,N){if(b.enabled!==!1&&!(b.autoUpdate===!1&&b.needsUpdate===!1)&&F.length!==0){var V=e.getRenderTarget(),q=e.getActiveCubeFace(),Q=e.getActiveMipmapLevel(),z=e.state;z.setBlending(NoBlending),z.buffers.color.setClear(1,1,1,1),z.buffers.depth.setTest(!0),z.setScissorTest(!1);for(var H=0,W=F.length;H<W;H++){var J=F[H],G=J.shadow;if(G===void 0){console.warn("THREE.WebGLShadowMap:",J,"has no shadow.");continue}o.copy(G.mapSize);var te=G.getFrameExtents();if(o.multiply(te),s.copy(G.mapSize),(o.x>r||o.y>r)&&(o.x>r&&(s.x=Math.floor(r/te.x),o.x=s.x*te.x,G.mapSize.x=s.x),o.y>r&&(s.y=Math.floor(r/te.y),o.y=s.y*te.y,G.mapSize.y=s.y)),G.map===null&&!G.isPointLightShadow&&this.type===VSMShadowMap){var X={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};G.map=new WebGLRenderTarget(o.x,o.y,X),G.map.texture.name=J.name+".shadowMap",G.mapPass=new WebGLRenderTarget(o.x,o.y,X),G.camera.updateProjectionMatrix()}if(G.map===null){var X={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat};G.map=new WebGLRenderTarget(o.x,o.y,X),G.map.texture.name=J.name+".shadowMap",G.camera.updateProjectionMatrix()}e.setRenderTarget(G.map),e.clear();for(var K=G.getViewportCount(),Z=0;Z<K;Z++){var ee=G.getViewport(Z);l.set(s.x*ee.x,s.y*ee.y,s.x*ee.z,s.y*ee.w),z.viewport(l),G.updateMatrices(J,Z),n=G.getFrustum(),P(O,N,G.camera,J,this.type)}!G.isPointLightShadow&&this.type===VSMShadowMap&&T(G,N)}b.needsUpdate=!1,e.setRenderTarget(V,q,Q)}};function T(F,O){var N=t.update(M);m.uniforms.shadow_pass.value=F.map.texture,m.uniforms.resolution.value=F.mapSize,m.uniforms.radius.value=F.radius,e.setRenderTarget(F.mapPass),e.clear(),e.renderBufferDirect(O,null,N,m,M,null),y.uniforms.shadow_pass.value=F.mapPass.texture,y.uniforms.resolution.value=F.mapSize,y.uniforms.radius.value=F.radius,e.setRenderTarget(F.map),e.clear(),e.renderBufferDirect(O,null,N,y,M,null)}function _(F,O,N){var V=F<<0|O<<1|N<<2,q=u[V];return q===void 0&&(q=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:F,skinning:O}),u[V]=q),q}function S(F,O,N){var V=F<<0|O<<1|N<<2,q=c[V];return q===void 0&&(q=new MeshDistanceMaterial({morphTargets:F,skinning:O}),c[V]=q),q}function C(F,O,N,V,q,Q,z){var H=null,W=_,J=F.customDepthMaterial;if(V.isPointLight===!0&&(W=S,J=F.customDistanceMaterial),J===void 0){var G=!1;N.morphTargets===!0&&(G=O.morphAttributes&&O.morphAttributes.position&&O.morphAttributes.position.length>0);var te=!1;F.isSkinnedMesh===!0&&(N.skinning===!0?te=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",F));var X=F.isInstancedMesh===!0;H=W(G,te,X)}else H=J;if(e.localClippingEnabled&&N.clipShadows===!0&&N.clippingPlanes.length!==0){var K=H.uuid,Z=N.uuid,ee=h[K];ee===void 0&&(ee={},h[K]=ee);var j=ee[Z];j===void 0&&(j=H.clone(),ee[Z]=j),H=j}return H.visible=N.visible,H.wireframe=N.wireframe,z===VSMShadowMap?H.side=N.shadowSide!==null?N.shadowSide:N.side:H.side=N.shadowSide!==null?N.shadowSide:f[N.side],H.clipShadows=N.clipShadows,H.clippingPlanes=N.clippingPlanes,H.clipIntersection=N.clipIntersection,H.wireframeLinewidth=N.wireframeLinewidth,H.linewidth=N.linewidth,V.isPointLight===!0&&H.isMeshDistanceMaterial===!0&&(H.referencePosition.setFromMatrixPosition(V.matrixWorld),H.nearDistance=q,H.farDistance=Q),H}function P(F,O,N,V,q){if(F.visible!==!1){var Q=F.layers.test(O.layers);if(Q&&(F.isMesh||F.isLine||F.isPoints)&&(F.castShadow||F.receiveShadow&&q===VSMShadowMap)&&(!F.frustumCulled||n.intersectsObject(F))){F.modelViewMatrix.multiplyMatrices(N.matrixWorldInverse,F.matrixWorld);var z=t.update(F),H=F.material;if(Array.isArray(H))for(var W=z.groups,J=0,G=W.length;J<G;J++){var te=W[J],X=H[te.materialIndex];if(X&&X.visible){var K=C(F,z,X,V,N.near,N.far,q);e.renderBufferDirect(N,null,z,K,F,te)}}else if(H.visible){var K=C(F,z,H,V,N.near,N.far,q);e.renderBufferDirect(N,null,z,K,F,null)}}for(var Z=F.children,ee=0,j=Z.length;ee<j;ee++)P(Z[ee],O,N,V,q)}}}function WebGLState(e,t,r){var n=r.isWebGL2;function o(){var ve=!1,Ye=new Vector4,tt=null,xt=new Vector4(0,0,0,0);return{setMask:function(Ze){tt!==Ze&&!ve&&(e.colorMask(Ze,Ze,Ze,Ze),tt=Ze)},setLocked:function(Ze){ve=Ze},setClear:function(Ze,lt,Pt,Lt,Gt){Gt===!0&&(Ze*=Lt,lt*=Lt,Pt*=Lt),Ye.set(Ze,lt,Pt,Lt),xt.equals(Ye)===!1&&(e.clearColor(Ze,lt,Pt,Lt),xt.copy(Ye))},reset:function(){ve=!1,tt=null,xt.set(-1,0,0,0)}}}function s(){var ve=!1,Ye=null,tt=null,xt=null;return{setTest:function(Ze){Ze?Le(2929):Se(2929)},setMask:function(Ze){Ye!==Ze&&!ve&&(e.depthMask(Ze),Ye=Ze)},setFunc:function(Ze){if(tt!==Ze){if(Ze)switch(Ze){case NeverDepth:e.depthFunc(512);break;case AlwaysDepth:e.depthFunc(519);break;case LessDepth:e.depthFunc(513);break;case LessEqualDepth:e.depthFunc(515);break;case EqualDepth:e.depthFunc(514);break;case GreaterEqualDepth:e.depthFunc(518);break;case GreaterDepth:e.depthFunc(516);break;case NotEqualDepth:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);tt=Ze}},setLocked:function(Ze){ve=Ze},setClear:function(Ze){xt!==Ze&&(e.clearDepth(Ze),xt=Ze)},reset:function(){ve=!1,Ye=null,tt=null,xt=null}}}function l(){var ve=!1,Ye=null,tt=null,xt=null,Ze=null,lt=null,Pt=null,Lt=null,Gt=null;return{setTest:function(Rt){ve||(Rt?Le(2960):Se(2960))},setMask:function(Rt){Ye!==Rt&&!ve&&(e.stencilMask(Rt),Ye=Rt)},setFunc:function(Rt,Ft,Nt){(tt!==Rt||xt!==Ft||Ze!==Nt)&&(e.stencilFunc(Rt,Ft,Nt),tt=Rt,xt=Ft,Ze=Nt)},setOp:function(Rt,Ft,Nt){(lt!==Rt||Pt!==Ft||Lt!==Nt)&&(e.stencilOp(Rt,Ft,Nt),lt=Rt,Pt=Ft,Lt=Nt)},setLocked:function(Rt){ve=Rt},setClear:function(Rt){Gt!==Rt&&(e.clearStencil(Rt),Gt=Rt)},reset:function(){ve=!1,Ye=null,tt=null,xt=null,Ze=null,lt=null,Pt=null,Lt=null,Gt=null}}}var u=new o,c=new s,h=new l,f=e.getParameter(34921),m=new Uint8Array(f),y=new Uint8Array(f),A=new Uint8Array(f),M={},b=null,T=null,_=null,S=null,C=null,P=null,F=null,O=null,N=null,V=!1,q=null,Q=null,z=null,H=null,W=null,J=e.getParameter(35661),G=!1,te=0,X=e.getParameter(7938);X.indexOf("WebGL")!==-1?(te=parseFloat(/^WebGL\ ([0-9])/.exec(X)[1]),G=te>=1):X.indexOf("OpenGL ES")!==-1&&(te=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(X)[1]),G=te>=2);var K=null,Z={},ee=new Vector4,j=new Vector4;function re(ve,Ye,tt){var xt=new Uint8Array(4),Ze=e.createTexture();e.bindTexture(ve,Ze),e.texParameteri(ve,10241,9728),e.texParameteri(ve,10240,9728);for(var lt=0;lt<tt;lt++)e.texImage2D(Ye+lt,0,6408,1,1,0,6408,5121,xt);return Ze}var pe={};pe[3553]=re(3553,3553,1),pe[34067]=re(34067,34069,6),u.setClear(0,0,0,1),c.setClear(1),h.setClear(0),Le(2929),c.setFunc(LessEqualDepth),oe(!1),ue(CullFaceBack),Le(2884),We(NoBlending);function ge(){for(var ve=0,Ye=m.length;ve<Ye;ve++)m[ve]=0}function _e(ve){he(ve,0)}function he(ve,Ye){if(m[ve]=1,y[ve]===0&&(e.enableVertexAttribArray(ve),y[ve]=1),A[ve]!==Ye){var tt=n?e:t.get("ANGLE_instanced_arrays");tt[n?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ve,Ye),A[ve]=Ye}}function Fe(){for(var ve=0,Ye=y.length;ve!==Ye;++ve)y[ve]!==m[ve]&&(e.disableVertexAttribArray(ve),y[ve]=0)}function Re(ve,Ye,tt,xt,Ze,lt){n===!0&&(tt===5124||tt===5125)?e.vertexAttribIPointer(ve,Ye,tt,xt,Ze,lt):e.vertexAttribPointer(ve,Ye,tt,xt,Ze,lt)}function Le(ve){M[ve]!==!0&&(e.enable(ve),M[ve]=!0)}function Se(ve){M[ve]!==!1&&(e.disable(ve),M[ve]=!1)}function we(ve){return b!==ve?(e.useProgram(ve),b=ve,!0):!1}var Ve={[AddEquation]:32774,[SubtractEquation]:32778,[ReverseSubtractEquation]:32779};if(n)Ve[MinEquation]=32775,Ve[MaxEquation]=32776;else{var je=t.get("EXT_blend_minmax");je!==null&&(Ve[MinEquation]=je.MIN_EXT,Ve[MaxEquation]=je.MAX_EXT)}var st={[ZeroFactor]:0,[OneFactor]:1,[SrcColorFactor]:768,[SrcAlphaFactor]:770,[SrcAlphaSaturateFactor]:776,[DstColorFactor]:774,[DstAlphaFactor]:772,[OneMinusSrcColorFactor]:769,[OneMinusSrcAlphaFactor]:771,[OneMinusDstColorFactor]:775,[OneMinusDstAlphaFactor]:773};function We(ve,Ye,tt,xt,Ze,lt,Pt,Lt){if(ve===NoBlending){T&&(Se(3042),T=!1);return}if(T||(Le(3042),T=!0),ve!==CustomBlending){if(ve!==_||Lt!==V){if((S!==AddEquation||F!==AddEquation)&&(e.blendEquation(32774),S=AddEquation,F=AddEquation),Lt)switch(ve){case NormalBlending:e.blendFuncSeparate(1,771,1,771);break;case AdditiveBlending:e.blendFunc(1,1);break;case SubtractiveBlending:e.blendFuncSeparate(0,0,769,771);break;case MultiplyBlending:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ve);break}else switch(ve){case NormalBlending:e.blendFuncSeparate(770,771,1,771);break;case AdditiveBlending:e.blendFunc(770,1);break;case SubtractiveBlending:e.blendFunc(0,769);break;case MultiplyBlending:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ve);break}C=null,P=null,O=null,N=null,_=ve,V=Lt}return}Ze=Ze||Ye,lt=lt||tt,Pt=Pt||xt,(Ye!==S||Ze!==F)&&(e.blendEquationSeparate(Ve[Ye],Ve[Ze]),S=Ye,F=Ze),(tt!==C||xt!==P||lt!==O||Pt!==N)&&(e.blendFuncSeparate(st[tt],st[xt],st[lt],st[Pt]),C=tt,P=xt,O=lt,N=Pt),_=ve,V=null}function bt(ve,Ye){ve.side===DoubleSide?Se(2884):Le(2884);var tt=ve.side===BackSide;Ye&&(tt=!tt),oe(tt),ve.blending===NormalBlending&&ve.transparent===!1?We(NoBlending):We(ve.blending,ve.blendEquation,ve.blendSrc,ve.blendDst,ve.blendEquationAlpha,ve.blendSrcAlpha,ve.blendDstAlpha,ve.premultipliedAlpha),c.setFunc(ve.depthFunc),c.setTest(ve.depthTest),c.setMask(ve.depthWrite),u.setMask(ve.colorWrite);var xt=ve.stencilWrite;h.setTest(xt),xt&&(h.setMask(ve.stencilWriteMask),h.setFunc(ve.stencilFunc,ve.stencilRef,ve.stencilFuncMask),h.setOp(ve.stencilFail,ve.stencilZFail,ve.stencilZPass)),Me(ve.polygonOffset,ve.polygonOffsetFactor,ve.polygonOffsetUnits)}function oe(ve){q!==ve&&(ve?e.frontFace(2304):e.frontFace(2305),q=ve)}function ue(ve){ve!==CullFaceNone?(Le(2884),ve!==Q&&(ve===CullFaceBack?e.cullFace(1029):ve===CullFaceFront?e.cullFace(1028):e.cullFace(1032))):Se(2884),Q=ve}function Qe(ve){ve!==z&&(G&&e.lineWidth(ve),z=ve)}function Me(ve,Ye,tt){ve?(Le(32823),(H!==Ye||W!==tt)&&(e.polygonOffset(Ye,tt),H=Ye,W=tt)):Se(32823)}function De(ve){ve?Le(3089):Se(3089)}function be(ve){ve===void 0&&(ve=33984+J-1),K!==ve&&(e.activeTexture(ve),K=ve)}function ze(ve,Ye){K===null&&be();var tt=Z[K];tt===void 0&&(tt={type:void 0,texture:void 0},Z[K]=tt),(tt.type!==ve||tt.texture!==Ye)&&(e.bindTexture(ve,Ye||pe[ve]),tt.type=ve,tt.texture=Ye)}function at(){var ve=Z[K];ve!==void 0&&ve.type!==void 0&&(e.bindTexture(ve.type,null),ve.type=void 0,ve.texture=void 0)}function ot(){try{e.compressedTexImage2D.apply(e,arguments)}catch(ve){console.error("THREE.WebGLState:",ve)}}function nt(){try{e.texImage2D.apply(e,arguments)}catch(ve){console.error("THREE.WebGLState:",ve)}}function Ue(){try{e.texImage3D.apply(e,arguments)}catch(ve){console.error("THREE.WebGLState:",ve)}}function He(ve){ee.equals(ve)===!1&&(e.scissor(ve.x,ve.y,ve.z,ve.w),ee.copy(ve))}function qe(ve){j.equals(ve)===!1&&(e.viewport(ve.x,ve.y,ve.z,ve.w),j.copy(ve))}function ke(){for(var ve=0;ve<y.length;ve++)y[ve]===1&&(e.disableVertexAttribArray(ve),y[ve]=0);M={},K=null,Z={},b=null,_=null,q=null,Q=null,u.reset(),c.reset(),h.reset()}return{buffers:{color:u,depth:c,stencil:h},initAttributes:ge,enableAttribute:_e,enableAttributeAndDivisor:he,disableUnusedAttributes:Fe,vertexAttribPointer:Re,enable:Le,disable:Se,useProgram:we,setBlending:We,setMaterial:bt,setFlipSided:oe,setCullFace:ue,setLineWidth:Qe,setPolygonOffset:Me,setScissorTest:De,activeTexture:be,bindTexture:ze,unbindTexture:at,compressedTexImage2D:ot,texImage2D:nt,texImage3D:Ue,scissor:He,viewport:qe,reset:ke}}function WebGLTextures(e,t,r,n,o,s,l){var u=o.isWebGL2,c=o.maxTextures,h=o.maxCubemapSize,f=o.maxTextureSize,m=o.maxSamples,y=new WeakMap,A,M=!1;try{M=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(oe,ue){return M?new OffscreenCanvas(oe,ue):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function T(oe,ue,Qe,Me){var De=1;if((oe.width>Me||oe.height>Me)&&(De=Me/Math.max(oe.width,oe.height)),De<1||ue===!0)if(typeof HTMLImageElement<"u"&&oe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&oe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&oe instanceof ImageBitmap){var be=ue?MathUtils.floorPowerOfTwo:Math.floor,ze=be(De*oe.width),at=be(De*oe.height);A===void 0&&(A=b(ze,at));var ot=Qe?b(ze,at):A;ot.width=ze,ot.height=at;var nt=ot.getContext("2d");return nt.drawImage(oe,0,0,ze,at),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+oe.width+"x"+oe.height+") to ("+ze+"x"+at+")."),ot}else return"data"in oe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+oe.width+"x"+oe.height+")."),oe;return oe}function _(oe){return MathUtils.isPowerOfTwo(oe.width)&&MathUtils.isPowerOfTwo(oe.height)}function S(oe){return u?!1:oe.wrapS!==ClampToEdgeWrapping||oe.wrapT!==ClampToEdgeWrapping||oe.minFilter!==NearestFilter&&oe.minFilter!==LinearFilter}function C(oe,ue){return oe.generateMipmaps&&ue&&oe.minFilter!==NearestFilter&&oe.minFilter!==LinearFilter}function P(oe,ue,Qe,Me){e.generateMipmap(oe);var De=n.get(ue);De.__maxMipLevel=Math.log(Math.max(Qe,Me))*Math.LOG2E}function F(oe,ue,Qe){if(u===!1)return ue;if(oe!==null){if(e[oe]!==void 0)return e[oe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+oe+"'")}var Me=ue;return ue===6403&&(Qe===5126&&(Me=33326),Qe===5131&&(Me=33325),Qe===5121&&(Me=33321)),ue===6407&&(Qe===5126&&(Me=34837),Qe===5131&&(Me=34843),Qe===5121&&(Me=32849)),ue===6408&&(Qe===5126&&(Me=34836),Qe===5131&&(Me=34842),Qe===5121&&(Me=32856)),(Me===33325||Me===33326||Me===34842||Me===34836)&&t.get("EXT_color_buffer_float"),Me}function O(oe){return oe===NearestFilter||oe===NearestMipmapNearestFilter||oe===NearestMipmapLinearFilter?9728:9729}function N(oe){var ue=oe.target;ue.removeEventListener("dispose",N),q(ue),ue.isVideoTexture&&y.delete(ue),l.memory.textures--}function V(oe){var ue=oe.target;ue.removeEventListener("dispose",V),Q(ue),l.memory.textures--}function q(oe){var ue=n.get(oe);ue.__webglInit!==void 0&&(e.deleteTexture(ue.__webglTexture),n.remove(oe))}function Q(oe){var ue=n.get(oe),Qe=n.get(oe.texture);if(oe){if(Qe.__webglTexture!==void 0&&e.deleteTexture(Qe.__webglTexture),oe.depthTexture&&oe.depthTexture.dispose(),oe.isWebGLCubeRenderTarget)for(var Me=0;Me<6;Me++)e.deleteFramebuffer(ue.__webglFramebuffer[Me]),ue.__webglDepthbuffer&&e.deleteRenderbuffer(ue.__webglDepthbuffer[Me]);else e.deleteFramebuffer(ue.__webglFramebuffer),ue.__webglDepthbuffer&&e.deleteRenderbuffer(ue.__webglDepthbuffer),ue.__webglMultisampledFramebuffer&&e.deleteFramebuffer(ue.__webglMultisampledFramebuffer),ue.__webglColorRenderbuffer&&e.deleteRenderbuffer(ue.__webglColorRenderbuffer),ue.__webglDepthRenderbuffer&&e.deleteRenderbuffer(ue.__webglDepthRenderbuffer);n.remove(oe.texture),n.remove(oe)}}var z=0;function H(){z=0}function W(){var oe=z;return oe>=c&&console.warn("THREE.WebGLTextures: Trying to use "+oe+" texture units while this GPU supports only "+c),z+=1,oe}function J(oe,ue){var Qe=n.get(oe);if(oe.isVideoTexture&&Ve(oe),oe.version>0&&Qe.__version!==oe.version){var Me=oe.image;if(Me===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(Me.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{pe(Qe,oe,ue);return}}r.activeTexture(33984+ue),r.bindTexture(3553,Qe.__webglTexture)}function G(oe,ue){var Qe=n.get(oe);if(oe.version>0&&Qe.__version!==oe.version){pe(Qe,oe,ue);return}r.activeTexture(33984+ue),r.bindTexture(35866,Qe.__webglTexture)}function te(oe,ue){var Qe=n.get(oe);if(oe.version>0&&Qe.__version!==oe.version){pe(Qe,oe,ue);return}r.activeTexture(33984+ue),r.bindTexture(32879,Qe.__webglTexture)}function X(oe,ue){if(oe.image.length===6){var Qe=n.get(oe);if(oe.version>0&&Qe.__version!==oe.version){re(Qe,oe),r.activeTexture(33984+ue),r.bindTexture(34067,Qe.__webglTexture),e.pixelStorei(37440,oe.flipY);for(var Me=oe&&(oe.isCompressedTexture||oe.image[0].isCompressedTexture),De=oe.image[0]&&oe.image[0].isDataTexture,be=[],ze=0;ze<6;ze++)!Me&&!De?be[ze]=T(oe.image[ze],!1,!0,h):be[ze]=De?oe.image[ze].image:oe.image[ze];var at=be[0],ot=_(at)||u,nt=s.convert(oe.format),Ue=s.convert(oe.type),He=F(oe.internalFormat,nt,Ue);j(34067,oe,ot);var qe;if(Me){for(var ze=0;ze<6;ze++){qe=be[ze].mipmaps;for(var ke=0;ke<qe.length;ke++){var ve=qe[ke];oe.format!==RGBAFormat&&oe.format!==RGBFormat?nt!==null?r.compressedTexImage2D(34069+ze,ke,He,ve.width,ve.height,0,ve.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+ze,ke,He,ve.width,ve.height,0,nt,Ue,ve.data)}}Qe.__maxMipLevel=qe.length-1}else{qe=oe.mipmaps;for(var ze=0;ze<6;ze++)if(De){r.texImage2D(34069+ze,0,He,be[ze].width,be[ze].height,0,nt,Ue,be[ze].data);for(var ke=0;ke<qe.length;ke++){var ve=qe[ke],Ye=ve.image[ze].image;r.texImage2D(34069+ze,ke+1,He,Ye.width,Ye.height,0,nt,Ue,Ye.data)}}else{r.texImage2D(34069+ze,0,He,nt,Ue,be[ze]);for(var ke=0;ke<qe.length;ke++){var ve=qe[ke];r.texImage2D(34069+ze,ke+1,He,nt,Ue,ve.image[ze])}}Qe.__maxMipLevel=qe.length}C(oe,ot)&&P(34067,oe,at.width,at.height),Qe.__version=oe.version,oe.onUpdate&&oe.onUpdate(oe)}else r.activeTexture(33984+ue),r.bindTexture(34067,Qe.__webglTexture)}}function K(oe,ue){r.activeTexture(33984+ue),r.bindTexture(34067,n.get(oe).__webglTexture)}var Z={[RepeatWrapping]:10497,[ClampToEdgeWrapping]:33071,[MirroredRepeatWrapping]:33648},ee={[NearestFilter]:9728,[NearestMipmapNearestFilter]:9984,[NearestMipmapLinearFilter]:9986,[LinearFilter]:9729,[LinearMipmapNearestFilter]:9985,[LinearMipmapLinearFilter]:9987};function j(oe,ue,Qe){Qe?(e.texParameteri(oe,10242,Z[ue.wrapS]),e.texParameteri(oe,10243,Z[ue.wrapT]),(oe===32879||oe===35866)&&e.texParameteri(oe,32882,Z[ue.wrapR]),e.texParameteri(oe,10240,ee[ue.magFilter]),e.texParameteri(oe,10241,ee[ue.minFilter])):(e.texParameteri(oe,10242,33071),e.texParameteri(oe,10243,33071),(oe===32879||oe===35866)&&e.texParameteri(oe,32882,33071),(ue.wrapS!==ClampToEdgeWrapping||ue.wrapT!==ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(oe,10240,O(ue.magFilter)),e.texParameteri(oe,10241,O(ue.minFilter)),ue.minFilter!==NearestFilter&&ue.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var Me=t.get("EXT_texture_filter_anisotropic");if(Me){if(ue.type===FloatType&&t.get("OES_texture_float_linear")===null||ue.type===HalfFloatType&&(u||t.get("OES_texture_half_float_linear"))===null)return;(ue.anisotropy>1||n.get(ue).__currentAnisotropy)&&(e.texParameterf(oe,Me.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ue.anisotropy,o.getMaxAnisotropy())),n.get(ue).__currentAnisotropy=ue.anisotropy)}}function re(oe,ue){oe.__webglInit===void 0&&(oe.__webglInit=!0,ue.addEventListener("dispose",N),oe.__webglTexture=e.createTexture(),l.memory.textures++)}function pe(oe,ue,Qe){var Me=3553;ue.isDataTexture2DArray&&(Me=35866),ue.isDataTexture3D&&(Me=32879),re(oe,ue),r.activeTexture(33984+Qe),r.bindTexture(Me,oe.__webglTexture),e.pixelStorei(37440,ue.flipY),e.pixelStorei(37441,ue.premultiplyAlpha),e.pixelStorei(3317,ue.unpackAlignment);var De=S(ue)&&_(ue.image)===!1,be=T(ue.image,De,!1,f),ze=_(be)||u,at=s.convert(ue.format),ot=s.convert(ue.type),nt=F(ue.internalFormat,at,ot);j(Me,ue,ze);var Ue,He=ue.mipmaps;if(ue.isDepthTexture)nt=6402,u?ue.type===FloatType?nt=36012:ue.type===UnsignedIntType?nt=33190:ue.type===UnsignedInt248Type?nt=35056:nt=33189:ue.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),ue.format===DepthFormat&&nt===6402&&ue.type!==UnsignedShortType&&ue.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ue.type=UnsignedShortType,ot=s.convert(ue.type)),ue.format===DepthStencilFormat&&nt===6402&&(nt=34041,ue.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ue.type=UnsignedInt248Type,ot=s.convert(ue.type))),r.texImage2D(3553,0,nt,be.width,be.height,0,at,ot,null);else if(ue.isDataTexture)if(He.length>0&&ze){for(var qe=0,ke=He.length;qe<ke;qe++)Ue=He[qe],r.texImage2D(3553,qe,nt,Ue.width,Ue.height,0,at,ot,Ue.data);ue.generateMipmaps=!1,oe.__maxMipLevel=He.length-1}else r.texImage2D(3553,0,nt,be.width,be.height,0,at,ot,be.data),oe.__maxMipLevel=0;else if(ue.isCompressedTexture){for(var qe=0,ke=He.length;qe<ke;qe++)Ue=He[qe],ue.format!==RGBAFormat&&ue.format!==RGBFormat?at!==null?r.compressedTexImage2D(3553,qe,nt,Ue.width,Ue.height,0,Ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,qe,nt,Ue.width,Ue.height,0,at,ot,Ue.data);oe.__maxMipLevel=He.length-1}else if(ue.isDataTexture2DArray)r.texImage3D(35866,0,nt,be.width,be.height,be.depth,0,at,ot,be.data),oe.__maxMipLevel=0;else if(ue.isDataTexture3D)r.texImage3D(32879,0,nt,be.width,be.height,be.depth,0,at,ot,be.data),oe.__maxMipLevel=0;else if(He.length>0&&ze){for(var qe=0,ke=He.length;qe<ke;qe++)Ue=He[qe],r.texImage2D(3553,qe,nt,at,ot,Ue);ue.generateMipmaps=!1,oe.__maxMipLevel=He.length-1}else r.texImage2D(3553,0,nt,at,ot,be),oe.__maxMipLevel=0;C(ue,ze)&&P(Me,ue,be.width,be.height),oe.__version=ue.version,ue.onUpdate&&ue.onUpdate(ue)}function ge(oe,ue,Qe,Me){var De=s.convert(ue.texture.format),be=s.convert(ue.texture.type),ze=F(ue.texture.internalFormat,De,be);r.texImage2D(Me,0,ze,ue.width,ue.height,0,De,be,null),e.bindFramebuffer(36160,oe),e.framebufferTexture2D(36160,Qe,Me,n.get(ue.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function _e(oe,ue,Qe){if(e.bindRenderbuffer(36161,oe),ue.depthBuffer&&!ue.stencilBuffer){var Me=33189;if(Qe){var De=ue.depthTexture;De&&De.isDepthTexture&&(De.type===FloatType?Me=36012:De.type===UnsignedIntType&&(Me=33190));var be=we(ue);e.renderbufferStorageMultisample(36161,be,Me,ue.width,ue.height)}else e.renderbufferStorage(36161,Me,ue.width,ue.height);e.framebufferRenderbuffer(36160,36096,36161,oe)}else if(ue.depthBuffer&&ue.stencilBuffer){if(Qe){var be=we(ue);e.renderbufferStorageMultisample(36161,be,35056,ue.width,ue.height)}else e.renderbufferStorage(36161,34041,ue.width,ue.height);e.framebufferRenderbuffer(36160,33306,36161,oe)}else{var ze=s.convert(ue.texture.format),at=s.convert(ue.texture.type),Me=F(ue.texture.internalFormat,ze,at);if(Qe){var be=we(ue);e.renderbufferStorageMultisample(36161,be,Me,ue.width,ue.height)}else e.renderbufferStorage(36161,Me,ue.width,ue.height)}e.bindRenderbuffer(36161,null)}function he(oe,ue){var Qe=ue&&ue.isWebGLCubeRenderTarget;if(Qe)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,oe),!(ue.depthTexture&&ue.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(ue.depthTexture).__webglTexture||ue.depthTexture.image.width!==ue.width||ue.depthTexture.image.height!==ue.height)&&(ue.depthTexture.image.width=ue.width,ue.depthTexture.image.height=ue.height,ue.depthTexture.needsUpdate=!0),J(ue.depthTexture,0);var Me=n.get(ue.depthTexture).__webglTexture;if(ue.depthTexture.format===DepthFormat)e.framebufferTexture2D(36160,36096,3553,Me,0);else if(ue.depthTexture.format===DepthStencilFormat)e.framebufferTexture2D(36160,33306,3553,Me,0);else throw new Error("Unknown depthTexture format")}function Fe(oe){var ue=n.get(oe),Qe=oe.isWebGLCubeRenderTarget===!0;if(oe.depthTexture){if(Qe)throw new Error("target.depthTexture not supported in Cube render targets");he(ue.__webglFramebuffer,oe)}else if(Qe){ue.__webglDepthbuffer=[];for(var Me=0;Me<6;Me++)e.bindFramebuffer(36160,ue.__webglFramebuffer[Me]),ue.__webglDepthbuffer[Me]=e.createRenderbuffer(),_e(ue.__webglDepthbuffer[Me],oe,!1)}else e.bindFramebuffer(36160,ue.__webglFramebuffer),ue.__webglDepthbuffer=e.createRenderbuffer(),_e(ue.__webglDepthbuffer,oe,!1);e.bindFramebuffer(36160,null)}function Re(oe){var ue=n.get(oe),Qe=n.get(oe.texture);oe.addEventListener("dispose",V),Qe.__webglTexture=e.createTexture(),l.memory.textures++;var Me=oe.isWebGLCubeRenderTarget===!0,De=oe.isWebGLMultisampleRenderTarget===!0,be=_(oe)||u;if(u&&oe.texture.format===RGBFormat&&(oe.texture.type===FloatType||oe.texture.type===HalfFloatType)&&(oe.texture.format=RGBAFormat,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Me){ue.__webglFramebuffer=[];for(var ze=0;ze<6;ze++)ue.__webglFramebuffer[ze]=e.createFramebuffer()}else if(ue.__webglFramebuffer=e.createFramebuffer(),De)if(u){ue.__webglMultisampledFramebuffer=e.createFramebuffer(),ue.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,ue.__webglColorRenderbuffer);var at=s.convert(oe.texture.format),ot=s.convert(oe.texture.type),nt=F(oe.texture.internalFormat,at,ot),Ue=we(oe);e.renderbufferStorageMultisample(36161,Ue,nt,oe.width,oe.height),e.bindFramebuffer(36160,ue.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,ue.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),oe.depthBuffer&&(ue.__webglDepthRenderbuffer=e.createRenderbuffer(),_e(ue.__webglDepthRenderbuffer,oe,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Me){r.bindTexture(34067,Qe.__webglTexture),j(34067,oe.texture,be);for(var ze=0;ze<6;ze++)ge(ue.__webglFramebuffer[ze],oe,36064,34069+ze);C(oe.texture,be)&&P(34067,oe.texture,oe.width,oe.height),r.bindTexture(34067,null)}else r.bindTexture(3553,Qe.__webglTexture),j(3553,oe.texture,be),ge(ue.__webglFramebuffer,oe,36064,3553),C(oe.texture,be)&&P(3553,oe.texture,oe.width,oe.height),r.bindTexture(3553,null);oe.depthBuffer&&Fe(oe)}function Le(oe){var ue=oe.texture,Qe=_(oe)||u;if(C(ue,Qe)){var Me=oe.isWebGLCubeRenderTarget?34067:3553,De=n.get(ue).__webglTexture;r.bindTexture(Me,De),P(Me,ue,oe.width,oe.height),r.bindTexture(Me,null)}}function Se(oe){if(oe.isWebGLMultisampleRenderTarget)if(u){var ue=n.get(oe);e.bindFramebuffer(36008,ue.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,ue.__webglFramebuffer);var Qe=oe.width,Me=oe.height,De=16384;oe.depthBuffer&&(De|=256),oe.stencilBuffer&&(De|=1024),e.blitFramebuffer(0,0,Qe,Me,0,0,Qe,Me,De,9728),e.bindFramebuffer(36160,ue.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function we(oe){return u&&oe.isWebGLMultisampleRenderTarget?Math.min(m,oe.samples):0}function Ve(oe){var ue=l.render.frame;y.get(oe)!==ue&&(y.set(oe,ue),oe.update())}var je=!1,st=!1;function We(oe,ue){oe&&oe.isWebGLRenderTarget&&(je===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),je=!0),oe=oe.texture),J(oe,ue)}function bt(oe,ue){oe&&oe.isWebGLCubeRenderTarget&&(st===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),st=!0),oe=oe.texture),oe&&oe.isCubeTexture||Array.isArray(oe.image)&&oe.image.length===6?X(oe,ue):K(oe,ue)}this.allocateTextureUnit=W,this.resetTextureUnits=H,this.setTexture2D=J,this.setTexture2DArray=G,this.setTexture3D=te,this.setTextureCube=X,this.setTextureCubeDynamic=K,this.setupRenderTarget=Re,this.updateRenderTargetMipmap=Le,this.updateMultisampleRenderTarget=Se,this.safeSetTexture2D=We,this.safeSetTextureCube=bt}function WebGLUtils(e,t,r){var n=r.isWebGL2;function o(s){var l;if(s===UnsignedByteType)return 5121;if(s===UnsignedShort4444Type)return 32819;if(s===UnsignedShort5551Type)return 32820;if(s===UnsignedShort565Type)return 33635;if(s===ByteType)return 5120;if(s===ShortType)return 5122;if(s===UnsignedShortType)return 5123;if(s===IntType)return 5124;if(s===UnsignedIntType)return 5125;if(s===FloatType)return 5126;if(s===HalfFloatType)return n?5131:(l=t.get("OES_texture_half_float"),l!==null?l.HALF_FLOAT_OES:null);if(s===AlphaFormat)return 6406;if(s===RGBFormat)return 6407;if(s===RGBAFormat)return 6408;if(s===LuminanceFormat)return 6409;if(s===LuminanceAlphaFormat)return 6410;if(s===DepthFormat)return 6402;if(s===DepthStencilFormat)return 34041;if(s===RedFormat)return 6403;if(s===RedIntegerFormat)return 36244;if(s===RGFormat)return 33319;if(s===RGIntegerFormat)return 33320;if(s===RGBIntegerFormat)return 36248;if(s===RGBAIntegerFormat)return 36249;if(s===RGB_S3TC_DXT1_Format||s===RGBA_S3TC_DXT1_Format||s===RGBA_S3TC_DXT3_Format||s===RGBA_S3TC_DXT5_Format)if(l=t.get("WEBGL_compressed_texture_s3tc"),l!==null){if(s===RGB_S3TC_DXT1_Format)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT1_Format)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT3_Format)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===RGBA_S3TC_DXT5_Format)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===RGB_PVRTC_4BPPV1_Format||s===RGB_PVRTC_2BPPV1_Format||s===RGBA_PVRTC_4BPPV1_Format||s===RGBA_PVRTC_2BPPV1_Format)if(l=t.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(s===RGB_PVRTC_4BPPV1_Format)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===RGB_PVRTC_2BPPV1_Format)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===RGBA_PVRTC_4BPPV1_Format)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===RGBA_PVRTC_2BPPV1_Format)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===RGB_ETC1_Format)return l=t.get("WEBGL_compressed_texture_etc1"),l!==null?l.COMPRESSED_RGB_ETC1_WEBGL:null;if((s===RGB_ETC2_Format||s===RGBA_ETC2_EAC_Format)&&(l=t.get("WEBGL_compressed_texture_etc"),l!==null)){if(s===RGB_ETC2_Format)return l.COMPRESSED_RGB8_ETC2;if(s===RGBA_ETC2_EAC_Format)return l.COMPRESSED_RGBA8_ETC2_EAC}if(s===RGBA_ASTC_4x4_Format||s===RGBA_ASTC_5x4_Format||s===RGBA_ASTC_5x5_Format||s===RGBA_ASTC_6x5_Format||s===RGBA_ASTC_6x6_Format||s===RGBA_ASTC_8x5_Format||s===RGBA_ASTC_8x6_Format||s===RGBA_ASTC_8x8_Format||s===RGBA_ASTC_10x5_Format||s===RGBA_ASTC_10x6_Format||s===RGBA_ASTC_10x8_Format||s===RGBA_ASTC_10x10_Format||s===RGBA_ASTC_12x10_Format||s===RGBA_ASTC_12x12_Format||s===SRGB8_ALPHA8_ASTC_4x4_Format||s===SRGB8_ALPHA8_ASTC_5x4_Format||s===SRGB8_ALPHA8_ASTC_5x5_Format||s===SRGB8_ALPHA8_ASTC_6x5_Format||s===SRGB8_ALPHA8_ASTC_6x6_Format||s===SRGB8_ALPHA8_ASTC_8x5_Format||s===SRGB8_ALPHA8_ASTC_8x6_Format||s===SRGB8_ALPHA8_ASTC_8x8_Format||s===SRGB8_ALPHA8_ASTC_10x5_Format||s===SRGB8_ALPHA8_ASTC_10x6_Format||s===SRGB8_ALPHA8_ASTC_10x8_Format||s===SRGB8_ALPHA8_ASTC_10x10_Format||s===SRGB8_ALPHA8_ASTC_12x10_Format||s===SRGB8_ALPHA8_ASTC_12x12_Format)return l=t.get("WEBGL_compressed_texture_astc"),l!==null?s:null;if(s===RGBA_BPTC_Format)return l=t.get("EXT_texture_compression_bptc"),l!==null?s:null;if(s===UnsignedInt248Type)return n?34042:(l=t.get("WEBGL_depth_texture"),l!==null?l.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:o}}function ArrayCamera(e){PerspectiveCamera.call(this),this.cameras=e||[]}ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0});function Group(){Object3D.call(this),this.type="Group"}Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0});function WebXRController(){this._targetRay=null,this._grip=null}Object.assign(WebXRController.prototype,{constructor:WebXRController,getTargetRaySpace:function(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this},update:function(e,t,r){var n=null,o=null,s=this._targetRay,l=this._grip;return e&&(s!==null&&(n=t.getPose(e.targetRaySpace,r),n!==null&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale))),l!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,r),o!==null&&(l.matrix.fromArray(o.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale)))),s!==null&&(s.visible=n!==null),l!==null&&(l.visible=o!==null),this}});function WebXRManager(e,t){var r=this,n=null,o=1,s=null,l="local-floor",u=null,c=[],h=new Map,f=new PerspectiveCamera;f.layers.enable(1),f.viewport=new Vector4;var m=new PerspectiveCamera;m.layers.enable(2),m.viewport=new Vector4;var y=[f,m],A=new ArrayCamera;A.layers.enable(1),A.layers.enable(2);var M=null,b=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(z){var H=c[z];return H===void 0&&(H=new WebXRController,c[z]=H),H.getTargetRaySpace()},this.getControllerGrip=function(z){var H=c[z];return H===void 0&&(H=new WebXRController,c[z]=H),H.getGripSpace()};function T(z){var H=h.get(z.inputSource);H&&H.dispatchEvent({type:z.type})}function _(){h.forEach(function(z,H){z.disconnect(H)}),h.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),Q.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function S(z){s=z,Q.setContext(n),Q.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}this.setFramebufferScaleFactor=function(z){o=z,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(z){l=z,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getSession=function(){return n},this.setSession=function(z){if(n=z,n!==null){n.addEventListener("select",T),n.addEventListener("selectstart",T),n.addEventListener("selectend",T),n.addEventListener("squeeze",T),n.addEventListener("squeezestart",T),n.addEventListener("squeezeend",T),n.addEventListener("end",_);var H=t.getContextAttributes();H.xrCompatible!==!0&&t.makeXRCompatible();var W={antialias:H.antialias,alpha:H.alpha,depth:H.depth,stencil:H.stencil,framebufferScaleFactor:o},J=new XRWebGLLayer(n,t,W);n.updateRenderState({baseLayer:J}),n.requestReferenceSpace(l).then(S),n.addEventListener("inputsourceschange",C)}};function C(z){for(var H=n.inputSources,W=0;W<c.length;W++)h.set(H[W],c[W]);for(var W=0;W<z.removed.length;W++){var J=z.removed[W],G=h.get(J);G&&(G.dispatchEvent({type:"disconnected",data:J}),h.delete(J))}for(var W=0;W<z.added.length;W++){var J=z.added[W],G=h.get(J);G&&G.dispatchEvent({type:"connected",data:J})}}var P=new Vector3,F=new Vector3;function O(z,H,W){P.setFromMatrixPosition(H.matrixWorld),F.setFromMatrixPosition(W.matrixWorld);var J=P.distanceTo(F),G=H.projectionMatrix.elements,te=W.projectionMatrix.elements,X=G[14]/(G[10]-1),K=G[14]/(G[10]+1),Z=(G[9]+1)/G[5],ee=(G[9]-1)/G[5],j=(G[8]-1)/G[0],re=(te[8]+1)/te[0],pe=X*j,ge=X*re,_e=J/(-j+re),he=_e*-j;H.matrixWorld.decompose(z.position,z.quaternion,z.scale),z.translateX(he),z.translateZ(_e),z.matrixWorld.compose(z.position,z.quaternion,z.scale),z.matrixWorldInverse.getInverse(z.matrixWorld);var Fe=X+_e,Re=K+_e,Le=pe-he,Se=ge+(J-he),we=Z*K/Re*Fe,Ve=ee*K/Re*Fe;z.projectionMatrix.makePerspective(Le,Se,we,Ve,Fe,Re)}function N(z,H){H===null?z.matrixWorld.copy(z.matrix):z.matrixWorld.multiplyMatrices(H.matrixWorld,z.matrix),z.matrixWorldInverse.getInverse(z.matrixWorld)}this.getCamera=function(z){A.near=m.near=f.near=z.near,A.far=m.far=f.far=z.far,(M!==A.near||b!==A.far)&&(n.updateRenderState({depthNear:A.near,depthFar:A.far}),M=A.near,b=A.far);var H=z.parent,W=A.cameras;N(A,H);for(var J=0;J<W.length;J++)N(W[J],H);z.matrixWorld.copy(A.matrixWorld);for(var G=z.children,J=0,te=G.length;J<te;J++)G[J].updateMatrixWorld(!0);return W.length===2?O(A,f,m):A.projectionMatrix.copy(f.projectionMatrix),A};var V=null;function q(z,H){if(u=H.getViewerPose(s),u!==null){var W=u.views,J=n.renderState.baseLayer;e.setFramebuffer(J.framebuffer);var G=!1;W.length!==A.cameras.length&&(A.cameras.length=0,G=!0);for(var te=0;te<W.length;te++){var X=W[te],K=J.getViewport(X),Z=y[te];Z.matrix.fromArray(X.transform.matrix),Z.projectionMatrix.fromArray(X.projectionMatrix),Z.viewport.set(K.x,K.y,K.width,K.height),te===0&&A.matrix.copy(Z.matrix),G===!0&&A.cameras.push(Z)}}for(var ee=n.inputSources,te=0;te<c.length;te++){var j=c[te],re=ee[te];j.update(re,H,s)}V&&V(z,H)}var Q=new WebGLAnimation;Q.setAnimationLoop(q),this.setAnimationLoop=function(z){V=z},this.dispose=function(){}}Object.assign(WebXRManager.prototype,EventDispatcher.prototype);function WebGLMaterials(e){function t(_,S){_.fogColor.value.copy(S.color),S.isFog?(_.fogNear.value=S.near,_.fogFar.value=S.far):S.isFogExp2&&(_.fogDensity.value=S.density)}function r(_,S,C,P,F){S.isMeshBasicMaterial?n(_,S):S.isMeshLambertMaterial?(n(_,S),c(_,S)):S.isMeshToonMaterial?(n(_,S),f(_,S)):S.isMeshPhongMaterial?(n(_,S),h(_,S)):S.isMeshStandardMaterial?(n(_,S,C),S.isMeshPhysicalMaterial?y(_,S,C):m(_,S,C)):S.isMeshMatcapMaterial?(n(_,S),A(_,S)):S.isMeshDepthMaterial?(n(_,S),M(_,S)):S.isMeshDistanceMaterial?(n(_,S),b(_,S)):S.isMeshNormalMaterial?(n(_,S),T(_,S)):S.isLineBasicMaterial?(o(_,S),S.isLineDashedMaterial&&s(_,S)):S.isPointsMaterial?l(_,S,P,F):S.isSpriteMaterial?u(_,S):S.isShadowMaterial?(_.color.value.copy(S.color),_.opacity.value=S.opacity):S.isShaderMaterial&&(S.uniformsNeedUpdate=!1)}function n(_,S,C){_.opacity.value=S.opacity,S.color&&_.diffuse.value.copy(S.color),S.emissive&&_.emissive.value.copy(S.emissive).multiplyScalar(S.emissiveIntensity),S.map&&(_.map.value=S.map),S.alphaMap&&(_.alphaMap.value=S.alphaMap),S.specularMap&&(_.specularMap.value=S.specularMap);var P=S.envMap||C;P&&(_.envMap.value=P,_.flipEnvMap.value=P.isCubeTexture?-1:1,_.reflectivity.value=S.reflectivity,_.refractionRatio.value=S.refractionRatio,_.maxMipLevel.value=e.get(P).__maxMipLevel),S.lightMap&&(_.lightMap.value=S.lightMap,_.lightMapIntensity.value=S.lightMapIntensity),S.aoMap&&(_.aoMap.value=S.aoMap,_.aoMapIntensity.value=S.aoMapIntensity);var F;S.map?F=S.map:S.specularMap?F=S.specularMap:S.displacementMap?F=S.displacementMap:S.normalMap?F=S.normalMap:S.bumpMap?F=S.bumpMap:S.roughnessMap?F=S.roughnessMap:S.metalnessMap?F=S.metalnessMap:S.alphaMap?F=S.alphaMap:S.emissiveMap&&(F=S.emissiveMap),F!==void 0&&(F.isWebGLRenderTarget&&(F=F.texture),F.matrixAutoUpdate===!0&&F.updateMatrix(),_.uvTransform.value.copy(F.matrix));var O;S.aoMap?O=S.aoMap:S.lightMap&&(O=S.lightMap),O!==void 0&&(O.isWebGLRenderTarget&&(O=O.texture),O.matrixAutoUpdate===!0&&O.updateMatrix(),_.uv2Transform.value.copy(O.matrix))}function o(_,S){_.diffuse.value.copy(S.color),_.opacity.value=S.opacity}function s(_,S){_.dashSize.value=S.dashSize,_.totalSize.value=S.dashSize+S.gapSize,_.scale.value=S.scale}function l(_,S,C,P){_.diffuse.value.copy(S.color),_.opacity.value=S.opacity,_.size.value=S.size*C,_.scale.value=P*.5,S.map&&(_.map.value=S.map),S.alphaMap&&(_.alphaMap.value=S.alphaMap);var F;S.map?F=S.map:S.alphaMap&&(F=S.alphaMap),F!==void 0&&(F.matrixAutoUpdate===!0&&F.updateMatrix(),_.uvTransform.value.copy(F.matrix))}function u(_,S){_.diffuse.value.copy(S.color),_.opacity.value=S.opacity,_.rotation.value=S.rotation,S.map&&(_.map.value=S.map),S.alphaMap&&(_.alphaMap.value=S.alphaMap);var C;S.map?C=S.map:S.alphaMap&&(C=S.alphaMap),C!==void 0&&(C.matrixAutoUpdate===!0&&C.updateMatrix(),_.uvTransform.value.copy(C.matrix))}function c(_,S){S.emissiveMap&&(_.emissiveMap.value=S.emissiveMap)}function h(_,S){_.specular.value.copy(S.specular),_.shininess.value=Math.max(S.shininess,1e-4),S.emissiveMap&&(_.emissiveMap.value=S.emissiveMap),S.bumpMap&&(_.bumpMap.value=S.bumpMap,_.bumpScale.value=S.bumpScale,S.side===BackSide&&(_.bumpScale.value*=-1)),S.normalMap&&(_.normalMap.value=S.normalMap,_.normalScale.value.copy(S.normalScale),S.side===BackSide&&_.normalScale.value.negate()),S.displacementMap&&(_.displacementMap.value=S.displacementMap,_.displacementScale.value=S.displacementScale,_.displacementBias.value=S.displacementBias)}function f(_,S){_.specular.value.copy(S.specular),_.shininess.value=Math.max(S.shininess,1e-4),S.gradientMap&&(_.gradientMap.value=S.gradientMap),S.emissiveMap&&(_.emissiveMap.value=S.emissiveMap),S.bumpMap&&(_.bumpMap.value=S.bumpMap,_.bumpScale.value=S.bumpScale,S.side===BackSide&&(_.bumpScale.value*=-1)),S.normalMap&&(_.normalMap.value=S.normalMap,_.normalScale.value.copy(S.normalScale),S.side===BackSide&&_.normalScale.value.negate()),S.displacementMap&&(_.displacementMap.value=S.displacementMap,_.displacementScale.value=S.displacementScale,_.displacementBias.value=S.displacementBias)}function m(_,S,C){_.roughness.value=S.roughness,_.metalness.value=S.metalness,S.roughnessMap&&(_.roughnessMap.value=S.roughnessMap),S.metalnessMap&&(_.metalnessMap.value=S.metalnessMap),S.emissiveMap&&(_.emissiveMap.value=S.emissiveMap),S.bumpMap&&(_.bumpMap.value=S.bumpMap,_.bumpScale.value=S.bumpScale,S.side===BackSide&&(_.bumpScale.value*=-1)),S.normalMap&&(_.normalMap.value=S.normalMap,_.normalScale.value.copy(S.normalScale),S.side===BackSide&&_.normalScale.value.negate()),S.displacementMap&&(_.displacementMap.value=S.displacementMap,_.displacementScale.value=S.displacementScale,_.displacementBias.value=S.displacementBias),(S.envMap||C)&&(_.envMapIntensity.value=S.envMapIntensity)}function y(_,S,C){m(_,S,C),_.reflectivity.value=S.reflectivity,_.clearcoat.value=S.clearcoat,_.clearcoatRoughness.value=S.clearcoatRoughness,S.sheen&&_.sheen.value.copy(S.sheen),S.clearcoatMap&&(_.clearcoatMap.value=S.clearcoatMap),S.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=S.clearcoatRoughnessMap),S.clearcoatNormalMap&&(_.clearcoatNormalScale.value.copy(S.clearcoatNormalScale),_.clearcoatNormalMap.value=S.clearcoatNormalMap,S.side===BackSide&&_.clearcoatNormalScale.value.negate()),_.transparency.value=S.transparency}function A(_,S){S.matcap&&(_.matcap.value=S.matcap),S.bumpMap&&(_.bumpMap.value=S.bumpMap,_.bumpScale.value=S.bumpScale,S.side===BackSide&&(_.bumpScale.value*=-1)),S.normalMap&&(_.normalMap.value=S.normalMap,_.normalScale.value.copy(S.normalScale),S.side===BackSide&&_.normalScale.value.negate()),S.displacementMap&&(_.displacementMap.value=S.displacementMap,_.displacementScale.value=S.displacementScale,_.displacementBias.value=S.displacementBias)}function M(_,S){S.displacementMap&&(_.displacementMap.value=S.displacementMap,_.displacementScale.value=S.displacementScale,_.displacementBias.value=S.displacementBias)}function b(_,S){S.displacementMap&&(_.displacementMap.value=S.displacementMap,_.displacementScale.value=S.displacementScale,_.displacementBias.value=S.displacementBias),_.referencePosition.value.copy(S.referencePosition),_.nearDistance.value=S.nearDistance,_.farDistance.value=S.farDistance}function T(_,S){S.bumpMap&&(_.bumpMap.value=S.bumpMap,_.bumpScale.value=S.bumpScale,S.side===BackSide&&(_.bumpScale.value*=-1)),S.normalMap&&(_.normalMap.value=S.normalMap,_.normalScale.value.copy(S.normalScale),S.side===BackSide&&_.normalScale.value.negate()),S.displacementMap&&(_.displacementMap.value=S.displacementMap,_.displacementScale.value=S.displacementScale,_.displacementBias.value=S.displacementBias)}return{refreshFogUniforms:t,refreshMaterialUniforms:r}}function WebGLRenderer(e){e=e||{};var t=e.canvas!==void 0?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=e.context!==void 0?e.context:null,n=e.alpha!==void 0?e.alpha:!1,o=e.depth!==void 0?e.depth:!0,s=e.stencil!==void 0?e.stencil:!0,l=e.antialias!==void 0?e.antialias:!1,u=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,c=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,h=e.powerPreference!==void 0?e.powerPreference:"default",f=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,m=null,y=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=LinearEncoding,this.physicallyCorrectLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var A=this,M=!1,b=null,T=0,_=0,S=null,C=null,P=-1,F={geometry:null,program:null,wireframe:!1},O=null,N=null,V=new Vector4,q=new Vector4,Q=null,z=t.width,H=t.height,W=1,J=null,G=null,te=new Vector4(0,0,z,H),X=new Vector4(0,0,z,H),K=!1,Z=new Frustum,ee=new WebGLClipping,j=!1,re=!1,pe=new Matrix4,ge=new Vector3;function _e(){return S===null?W:1}var he;try{var Fe={alpha:n,depth:o,stencil:s,antialias:l,premultipliedAlpha:u,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:f};if(t.addEventListener("webglcontextlost",qe,!1),t.addEventListener("webglcontextrestored",ke,!1),he=r||t.getContext("webgl",Fe)||t.getContext("experimental-webgl",Fe),he===null)throw t.getContext("webgl")!==null?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");he.getShaderPrecisionFormat===void 0&&(he.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ae){throw console.error("THREE.WebGLRenderer: "+ae.message),ae}var Re,Le,Se,we,Ve,je,st,We,bt,oe,ue,Qe,Me,De,be,ze,at,ot;function nt(){Re=new WebGLExtensions(he),Le=new WebGLCapabilities(he,Re,e),Le.isWebGL2===!1&&(Re.get("WEBGL_depth_texture"),Re.get("OES_texture_float"),Re.get("OES_texture_half_float"),Re.get("OES_texture_half_float_linear"),Re.get("OES_standard_derivatives"),Re.get("OES_element_index_uint"),Re.get("ANGLE_instanced_arrays")),Re.get("OES_texture_float_linear"),ot=new WebGLUtils(he,Re,Le),Se=new WebGLState(he,Re,Le),Se.scissor(q.copy(X).multiplyScalar(W).floor()),Se.viewport(V.copy(te).multiplyScalar(W).floor()),we=new WebGLInfo,Ve=new WebGLProperties,je=new WebGLTextures(he,Re,Se,Ve,Le,ot,we),st=new WebGLAttributes(he,Le),We=new WebGLGeometries(he,st,we),bt=new WebGLObjects(he,We,st,we),be=new WebGLMorphtargets(he),oe=new WebGLPrograms(A,Re,Le),ue=new WebGLMaterials(Ve),Qe=new WebGLRenderLists,Me=new WebGLRenderStates,De=new WebGLBackground(A,Se,bt,u),ze=new WebGLBufferRenderer(he,Re,we,Le),at=new WebGLIndexedBufferRenderer(he,Re,we,Le),we.programs=oe.programs,A.capabilities=Le,A.extensions=Re,A.properties=Ve,A.renderLists=Qe,A.state=Se,A.info=we}nt();var Ue=new WebXRManager(A,he);this.xr=Ue;var He=new WebGLShadowMap(A,bt,Le.maxTextureSize);this.shadowMap=He,this.getContext=function(){return he},this.getContextAttributes=function(){return he.getContextAttributes()},this.forceContextLoss=function(){var ae=Re.get("WEBGL_lose_context");ae&&ae.loseContext()},this.forceContextRestore=function(){var ae=Re.get("WEBGL_lose_context");ae&&ae.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(ae){ae!==void 0&&(W=ae,this.setSize(z,H,!1))},this.getSize=function(ae){return ae===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),ae=new Vector2),ae.set(z,H)},this.setSize=function(ae,Pe,Te){if(Ue.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}z=ae,H=Pe,t.width=Math.floor(ae*W),t.height=Math.floor(Pe*W),Te!==!1&&(t.style.width=ae+"px",t.style.height=Pe+"px"),this.setViewport(0,0,ae,Pe)},this.getDrawingBufferSize=function(ae){return ae===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),ae=new Vector2),ae.set(z*W,H*W).floor()},this.setDrawingBufferSize=function(ae,Pe,Te){z=ae,H=Pe,W=Te,t.width=Math.floor(ae*Te),t.height=Math.floor(Pe*Te),this.setViewport(0,0,ae,Pe)},this.getCurrentViewport=function(ae){return ae===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),ae=new Vector4),ae.copy(V)},this.getViewport=function(ae){return ae.copy(te)},this.setViewport=function(ae,Pe,Te,Ne){ae.isVector4?te.set(ae.x,ae.y,ae.z,ae.w):te.set(ae,Pe,Te,Ne),Se.viewport(V.copy(te).multiplyScalar(W).floor())},this.getScissor=function(ae){return ae.copy(X)},this.setScissor=function(ae,Pe,Te,Ne){ae.isVector4?X.set(ae.x,ae.y,ae.z,ae.w):X.set(ae,Pe,Te,Ne),Se.scissor(q.copy(X).multiplyScalar(W).floor())},this.getScissorTest=function(){return K},this.setScissorTest=function(ae){Se.setScissorTest(K=ae)},this.setOpaqueSort=function(ae){J=ae},this.setTransparentSort=function(ae){G=ae},this.getClearColor=function(){return De.getClearColor()},this.setClearColor=function(){De.setClearColor.apply(De,arguments)},this.getClearAlpha=function(){return De.getClearAlpha()},this.setClearAlpha=function(){De.setClearAlpha.apply(De,arguments)},this.clear=function(ae,Pe,Te){var Ne=0;(ae===void 0||ae)&&(Ne|=16384),(Pe===void 0||Pe)&&(Ne|=256),(Te===void 0||Te)&&(Ne|=1024),he.clear(Ne)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",qe,!1),t.removeEventListener("webglcontextrestored",ke,!1),Qe.dispose(),Me.dispose(),Ve.dispose(),bt.dispose(),Ue.dispose(),Gt.stop()};function qe(ae){ae.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function ke(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1,nt()}function ve(ae){var Pe=ae.target;Pe.removeEventListener("dispose",ve),Ye(Pe)}function Ye(ae){tt(ae),Ve.remove(ae)}function tt(ae){var Pe=Ve.get(ae).program;ae.program=void 0,Pe!==void 0&&oe.releaseProgram(Pe)}function xt(ae,Pe){ae.render(function(Te){A.renderBufferImmediate(Te,Pe)})}this.renderBufferImmediate=function(ae,Pe){Se.initAttributes();var Te=Ve.get(ae);ae.hasPositions&&!Te.position&&(Te.position=he.createBuffer()),ae.hasNormals&&!Te.normal&&(Te.normal=he.createBuffer()),ae.hasUvs&&!Te.uv&&(Te.uv=he.createBuffer()),ae.hasColors&&!Te.color&&(Te.color=he.createBuffer());var Ne=Pe.getAttributes();ae.hasPositions&&(he.bindBuffer(34962,Te.position),he.bufferData(34962,ae.positionArray,35048),Se.enableAttribute(Ne.position),he.vertexAttribPointer(Ne.position,3,5126,!1,0,0)),ae.hasNormals&&(he.bindBuffer(34962,Te.normal),he.bufferData(34962,ae.normalArray,35048),Se.enableAttribute(Ne.normal),he.vertexAttribPointer(Ne.normal,3,5126,!1,0,0)),ae.hasUvs&&(he.bindBuffer(34962,Te.uv),he.bufferData(34962,ae.uvArray,35048),Se.enableAttribute(Ne.uv),he.vertexAttribPointer(Ne.uv,2,5126,!1,0,0)),ae.hasColors&&(he.bindBuffer(34962,Te.color),he.bufferData(34962,ae.colorArray,35048),Se.enableAttribute(Ne.color),he.vertexAttribPointer(Ne.color,3,5126,!1,0,0)),Se.disableUnusedAttributes(),he.drawArrays(4,0,ae.count),ae.count=0};var Ze=new Scene$1;this.renderBufferDirect=function(ae,Pe,Te,Ne,it,ft){Pe===null&&(Pe=Ze);var gt=it.isMesh&&it.matrixWorld.determinant()<0,ut=or(ae,Pe,Ne,it);Se.setMaterial(Ne,gt);var vt=!1;(F.geometry!==Te.id||F.program!==ut.id||F.wireframe!==(Ne.wireframe===!0))&&(F.geometry=Te.id,F.program=ut.id,F.wireframe=Ne.wireframe===!0,vt=!0),(Ne.morphTargets||Ne.morphNormals)&&(be.update(it,Te,Ne,ut),vt=!0),it.isInstancedMesh===!0&&(vt=!0);var yt=Te.index,Ot=Te.attributes.position;if(yt===null){if(Ot===void 0||Ot.count===0)return}else if(yt.count===0)return;var It=1;Ne.wireframe===!0&&(yt=We.getWireframeAttribute(Te),It=2);var Tt,ht=ze;yt!==null&&(Tt=st.get(yt),ht=at,ht.setIndex(Tt)),vt&&(lt(it,Te,Ne,ut),yt!==null&&he.bindBuffer(34963,Tt.buffer));var St=yt!==null?yt.count:Ot.count,zt=Te.drawRange.start*It,Dt=Te.drawRange.count*It,Et=ft!==null?ft.start*It:0,jt=ft!==null?ft.count*It:1/0,kt=Math.max(zt,Et),pr=Math.min(St,zt+Dt,Et+jt)-1,fr=Math.max(0,pr-kt+1);if(fr!==0){if(it.isMesh)Ne.wireframe===!0?(Se.setLineWidth(Ne.wireframeLinewidth*_e()),ht.setMode(1)):ht.setMode(4);else if(it.isLine){var Dn=Ne.linewidth;Dn===void 0&&(Dn=1),Se.setLineWidth(Dn*_e()),it.isLineSegments?ht.setMode(1):it.isLineLoop?ht.setMode(2):ht.setMode(3)}else it.isPoints?ht.setMode(0):it.isSprite&&ht.setMode(4);if(it.isInstancedMesh)ht.renderInstances(Te,kt,fr,it.count);else if(Te.isInstancedBufferGeometry){var pn=Math.min(Te.instanceCount,Te._maxInstanceCount);ht.renderInstances(Te,kt,fr,pn)}else ht.render(kt,fr)}};function lt(ae,Pe,Te,Ne){if(!(Le.isWebGL2===!1&&(ae.isInstancedMesh||Pe.isInstancedBufferGeometry)&&Re.get("ANGLE_instanced_arrays")===null)){Se.initAttributes();var it=Pe.attributes,ft=Ne.getAttributes(),gt=Te.defaultAttributeValues;for(var ut in ft){var vt=ft[ut];if(vt>=0){var yt=it[ut];if(yt!==void 0){var Ot=yt.normalized,It=yt.itemSize,Tt=st.get(yt);if(Tt===void 0)continue;var ht=Tt.buffer,St=Tt.type,zt=Tt.bytesPerElement;if(yt.isInterleavedBufferAttribute){var Dt=yt.data,Et=Dt.stride,jt=yt.offset;Dt&&Dt.isInstancedInterleavedBuffer?(Se.enableAttributeAndDivisor(vt,Dt.meshPerAttribute),Pe._maxInstanceCount===void 0&&(Pe._maxInstanceCount=Dt.meshPerAttribute*Dt.count)):Se.enableAttribute(vt),he.bindBuffer(34962,ht),Se.vertexAttribPointer(vt,It,St,Ot,Et*zt,jt*zt)}else yt.isInstancedBufferAttribute?(Se.enableAttributeAndDivisor(vt,yt.meshPerAttribute),Pe._maxInstanceCount===void 0&&(Pe._maxInstanceCount=yt.meshPerAttribute*yt.count)):Se.enableAttribute(vt),he.bindBuffer(34962,ht),Se.vertexAttribPointer(vt,It,St,Ot,0,0)}else if(ut==="instanceMatrix"){var Tt=st.get(ae.instanceMatrix);if(Tt===void 0)continue;var ht=Tt.buffer,St=Tt.type;Se.enableAttributeAndDivisor(vt+0,1),Se.enableAttributeAndDivisor(vt+1,1),Se.enableAttributeAndDivisor(vt+2,1),Se.enableAttributeAndDivisor(vt+3,1),he.bindBuffer(34962,ht),he.vertexAttribPointer(vt+0,4,St,!1,64,0),he.vertexAttribPointer(vt+1,4,St,!1,64,16),he.vertexAttribPointer(vt+2,4,St,!1,64,32),he.vertexAttribPointer(vt+3,4,St,!1,64,48)}else if(gt!==void 0){var kt=gt[ut];if(kt!==void 0)switch(kt.length){case 2:he.vertexAttrib2fv(vt,kt);break;case 3:he.vertexAttrib3fv(vt,kt);break;case 4:he.vertexAttrib4fv(vt,kt);break;default:he.vertexAttrib1fv(vt,kt)}}}}Se.disableUnusedAttributes()}}this.compile=function(ae,Pe){y=Me.get(ae,Pe),y.init(),ae.traverse(function(Ne){Ne.isLight&&(y.pushLight(Ne),Ne.castShadow&&y.pushShadow(Ne))}),y.setupLights(Pe);const Te={};ae.traverse(function(Ne){let it=Ne.material;if(it)if(Array.isArray(it))for(let ft=0;ft<it.length;ft++){let gt=it[ft];gt.uuid in Te||(Ht(gt,ae,Ne),Te[gt.uuid]=!0)}else it.uuid in Te||(Ht(it,ae,Ne),Te[it.uuid]=!0)})};var Pt=null;function Lt(ae){Ue.isPresenting||Pt&&Pt(ae)}var Gt=new WebGLAnimation;Gt.setAnimationLoop(Lt),typeof window<"u"&&Gt.setContext(window),this.setAnimationLoop=function(ae){Pt=ae,Ue.setAnimationLoop(ae),Gt.start()},this.render=function(ae,Pe){var Te,Ne;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Te=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),Ne=arguments[3]),!(Pe&&Pe.isCamera)){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!M){F.geometry=null,F.program=null,F.wireframe=!1,P=-1,O=null,ae.autoUpdate===!0&&ae.updateMatrixWorld(),Pe.parent===null&&Pe.updateMatrixWorld(),Ue.enabled&&Ue.isPresenting&&(Pe=Ue.getCamera(Pe)),ae.onBeforeRender(A,ae,Pe,Te||S),y=Me.get(ae,Pe),y.init(),pe.multiplyMatrices(Pe.projectionMatrix,Pe.matrixWorldInverse),Z.setFromProjectionMatrix(pe),re=this.localClippingEnabled,j=ee.init(this.clippingPlanes,re,Pe),m=Qe.get(ae,Pe),m.init(),Rt(ae,Pe,0,A.sortObjects),m.finish(),A.sortObjects===!0&&m.sort(J,G),j&&ee.beginShadows();var it=y.state.shadowsArray;He.render(it,ae,Pe),y.setupLights(Pe),j&&ee.endShadows(),this.info.autoReset&&this.info.reset(),Te!==void 0&&this.setRenderTarget(Te),De.render(m,ae,Pe,Ne);var ft=m.opaque,gt=m.transparent;if(ae.overrideMaterial){var ut=ae.overrideMaterial;ft.length&&Ft(ft,ae,Pe,ut),gt.length&&Ft(gt,ae,Pe,ut)}else ft.length&&Ft(ft,ae,Pe),gt.length&&Ft(gt,ae,Pe);ae.onAfterRender(A,ae,Pe),S!==null&&(je.updateRenderTargetMipmap(S),je.updateMultisampleRenderTarget(S)),Se.buffers.depth.setTest(!0),Se.buffers.depth.setMask(!0),Se.buffers.color.setMask(!0),Se.setPolygonOffset(!1),m=null,y=null}};function Rt(ae,Pe,Te,Ne){if(ae.visible!==!1){var it=ae.layers.test(Pe.layers);if(it){if(ae.isGroup)Te=ae.renderOrder;else if(ae.isLOD)ae.autoUpdate===!0&&ae.update(Pe);else if(ae.isLight)y.pushLight(ae),ae.castShadow&&y.pushShadow(ae);else if(ae.isSprite){if(!ae.frustumCulled||Z.intersectsSprite(ae)){Ne&&ge.setFromMatrixPosition(ae.matrixWorld).applyMatrix4(pe);var ft=bt.update(ae),gt=ae.material;gt.visible&&m.push(ae,ft,gt,Te,ge.z,null)}}else if(ae.isImmediateRenderObject)Ne&&ge.setFromMatrixPosition(ae.matrixWorld).applyMatrix4(pe),m.push(ae,null,ae.material,Te,ge.z,null);else if((ae.isMesh||ae.isLine||ae.isPoints)&&(ae.isSkinnedMesh&&ae.skeleton.frame!==we.render.frame&&(ae.skeleton.update(),ae.skeleton.frame=we.render.frame),!ae.frustumCulled||Z.intersectsObject(ae))){Ne&&ge.setFromMatrixPosition(ae.matrixWorld).applyMatrix4(pe);var ft=bt.update(ae),gt=ae.material;if(Array.isArray(gt))for(var ut=ft.groups,vt=0,yt=ut.length;vt<yt;vt++){var Ot=ut[vt],It=gt[Ot.materialIndex];It&&It.visible&&m.push(ae,ft,It,Te,ge.z,Ot)}else gt.visible&&m.push(ae,ft,gt,Te,ge.z,null)}}for(var Tt=ae.children,vt=0,yt=Tt.length;vt<yt;vt++)Rt(Tt[vt],Pe,Te,Ne)}}function Ft(ae,Pe,Te,Ne){for(var it=0,ft=ae.length;it<ft;it++){var gt=ae[it],ut=gt.object,vt=gt.geometry,yt=Ne===void 0?gt.material:Ne,Ot=gt.group;if(Te.isArrayCamera){N=Te;for(var It=Te.cameras,Tt=0,ht=It.length;Tt<ht;Tt++){var St=It[Tt];ut.layers.test(St.layers)&&(Se.viewport(V.copy(St.viewport)),y.setupLights(St),Nt(ut,Pe,St,vt,yt,Ot))}}else N=null,Nt(ut,Pe,Te,vt,yt,Ot)}}function Nt(ae,Pe,Te,Ne,it,ft){if(ae.onBeforeRender(A,Pe,Te,Ne,it,ft),y=Me.get(Pe,N||Te),ae.modelViewMatrix.multiplyMatrices(Te.matrixWorldInverse,ae.matrixWorld),ae.normalMatrix.getNormalMatrix(ae.modelViewMatrix),ae.isImmediateRenderObject){var gt=or(Te,Pe,it,ae);Se.setMaterial(it),F.geometry=null,F.program=null,F.wireframe=!1,xt(ae,gt)}else A.renderBufferDirect(Te,Pe,Ne,it,ae,ft);ae.onAfterRender(A,Pe,Te,Ne,it,ft),y=Me.get(Pe,N||Te)}function Ht(ae,Pe,Te){var Ne=Ve.get(ae),it=y.state.lights,ft=y.state.shadowsArray,gt=it.state.version,ut=oe.getParameters(ae,it.state,ft,Pe,ee.numPlanes,ee.numIntersection,Te),vt=oe.getProgramCacheKey(ut),yt=Ne.program,Ot=!0;if(yt===void 0)ae.addEventListener("dispose",ve);else if(yt.cacheKey!==vt)tt(ae);else if(Ne.lightsStateVersion!==gt)Ne.lightsStateVersion=gt,Ot=!1;else{if(ut.shaderID!==void 0)return;Ot=!1}Ot&&(yt=oe.acquireProgram(ut,vt),Ne.program=yt,Ne.uniforms=ut.uniforms,Ne.outputEncoding=ut.outputEncoding,ae.program=yt);var It=yt.getAttributes();if(ae.morphTargets){ae.numSupportedMorphTargets=0;for(var Tt=0;Tt<A.maxMorphTargets;Tt++)It["morphTarget"+Tt]>=0&&ae.numSupportedMorphTargets++}if(ae.morphNormals){ae.numSupportedMorphNormals=0;for(var Tt=0;Tt<A.maxMorphNormals;Tt++)It["morphNormal"+Tt]>=0&&ae.numSupportedMorphNormals++}var ht=Ne.uniforms;(!ae.isShaderMaterial&&!ae.isRawShaderMaterial||ae.clipping===!0)&&(Ne.numClippingPlanes=ee.numPlanes,Ne.numIntersection=ee.numIntersection,ht.clippingPlanes=ee.uniform),Ne.environment=ae.isMeshStandardMaterial?Pe.environment:null,Ne.fog=Pe.fog,Ne.needsLights=Zt(ae),Ne.lightsStateVersion=gt,Ne.needsLights&&(ht.ambientLightColor.value=it.state.ambient,ht.lightProbe.value=it.state.probe,ht.directionalLights.value=it.state.directional,ht.directionalLightShadows.value=it.state.directionalShadow,ht.spotLights.value=it.state.spot,ht.spotLightShadows.value=it.state.spotShadow,ht.rectAreaLights.value=it.state.rectArea,ht.pointLights.value=it.state.point,ht.pointLightShadows.value=it.state.pointShadow,ht.hemisphereLights.value=it.state.hemi,ht.directionalShadowMap.value=it.state.directionalShadowMap,ht.directionalShadowMatrix.value=it.state.directionalShadowMatrix,ht.spotShadowMap.value=it.state.spotShadowMap,ht.spotShadowMatrix.value=it.state.spotShadowMatrix,ht.pointShadowMap.value=it.state.pointShadowMap,ht.pointShadowMatrix.value=it.state.pointShadowMatrix);var St=Ne.program.getUniforms(),zt=WebGLUniforms.seqWithValue(St.seq,ht);Ne.uniformsList=zt}function or(ae,Pe,Te,Ne){je.resetTextureUnits();var it=Pe.fog,ft=Te.isMeshStandardMaterial?Pe.environment:null,gt=S===null?A.outputEncoding:S.texture.encoding,ut=Ve.get(Te),vt=y.state.lights;if(j&&(re||ae!==O)){var yt=ae===O&&Te.id===P;ee.setState(Te.clippingPlanes,Te.clipIntersection,Te.clipShadows,ae,ut,yt)}Te.version===ut.__version?(ut.program===void 0||Te.fog&&ut.fog!==it||ut.environment!==ft||ut.needsLights&&ut.lightsStateVersion!==vt.state.version||ut.numClippingPlanes!==void 0&&(ut.numClippingPlanes!==ee.numPlanes||ut.numIntersection!==ee.numIntersection)||ut.outputEncoding!==gt)&&Ht(Te,Pe,Ne):(Ht(Te,Pe,Ne),ut.__version=Te.version);var Ot=!1,It=!1,Tt=!1,ht=ut.program,St=ht.getUniforms(),zt=ut.uniforms;if(Se.useProgram(ht.program)&&(Ot=!0,It=!0,Tt=!0),Te.id!==P&&(P=Te.id,It=!0),Ot||O!==ae){if(St.setValue(he,"projectionMatrix",ae.projectionMatrix),Le.logarithmicDepthBuffer&&St.setValue(he,"logDepthBufFC",2/(Math.log(ae.far+1)/Math.LN2)),O!==ae&&(O=ae,It=!0,Tt=!0),Te.isShaderMaterial||Te.isMeshPhongMaterial||Te.isMeshToonMaterial||Te.isMeshStandardMaterial||Te.envMap){var Dt=St.map.cameraPosition;Dt!==void 0&&Dt.setValue(he,ge.setFromMatrixPosition(ae.matrixWorld))}(Te.isMeshPhongMaterial||Te.isMeshToonMaterial||Te.isMeshLambertMaterial||Te.isMeshBasicMaterial||Te.isMeshStandardMaterial||Te.isShaderMaterial)&&St.setValue(he,"isOrthographic",ae.isOrthographicCamera===!0),(Te.isMeshPhongMaterial||Te.isMeshToonMaterial||Te.isMeshLambertMaterial||Te.isMeshBasicMaterial||Te.isMeshStandardMaterial||Te.isShaderMaterial||Te.skinning)&&St.setValue(he,"viewMatrix",ae.matrixWorldInverse)}if(Te.skinning){St.setOptional(he,Ne,"bindMatrix"),St.setOptional(he,Ne,"bindMatrixInverse");var Et=Ne.skeleton;if(Et){var jt=Et.bones;if(Le.floatVertexTextures){if(Et.boneTexture===void 0){var kt=Math.sqrt(jt.length*4);kt=MathUtils.ceilPowerOfTwo(kt),kt=Math.max(kt,4);var pr=new Float32Array(kt*kt*4);pr.set(Et.boneMatrices);var fr=new DataTexture(pr,kt,kt,RGBAFormat,FloatType);Et.boneMatrices=pr,Et.boneTexture=fr,Et.boneTextureSize=kt}St.setValue(he,"boneTexture",Et.boneTexture,je),St.setValue(he,"boneTextureSize",Et.boneTextureSize)}else St.setOptional(he,Et,"boneMatrices")}}return(It||ut.receiveShadow!==Ne.receiveShadow)&&(ut.receiveShadow=Ne.receiveShadow,St.setValue(he,"receiveShadow",Ne.receiveShadow)),It&&(St.setValue(he,"toneMappingExposure",A.toneMappingExposure),St.setValue(he,"toneMappingWhitePoint",A.toneMappingWhitePoint),ut.needsLights&&Xt(zt,Tt),it&&Te.fog&&ue.refreshFogUniforms(zt,it),ue.refreshMaterialUniforms(zt,Te,ft,W,H),zt.ltc_1!==void 0&&(zt.ltc_1.value=UniformsLib.LTC_1),zt.ltc_2!==void 0&&(zt.ltc_2.value=UniformsLib.LTC_2),WebGLUniforms.upload(he,ut.uniformsList,zt,je)),Te.isShaderMaterial&&Te.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(he,ut.uniformsList,zt,je),Te.uniformsNeedUpdate=!1),Te.isSpriteMaterial&&St.setValue(he,"center",Ne.center),St.setValue(he,"modelViewMatrix",Ne.modelViewMatrix),St.setValue(he,"normalMatrix",Ne.normalMatrix),St.setValue(he,"modelMatrix",Ne.matrixWorld),ht}function Xt(ae,Pe){ae.ambientLightColor.needsUpdate=Pe,ae.lightProbe.needsUpdate=Pe,ae.directionalLights.needsUpdate=Pe,ae.directionalLightShadows.needsUpdate=Pe,ae.pointLights.needsUpdate=Pe,ae.pointLightShadows.needsUpdate=Pe,ae.spotLights.needsUpdate=Pe,ae.spotLightShadows.needsUpdate=Pe,ae.rectAreaLights.needsUpdate=Pe,ae.hemisphereLights.needsUpdate=Pe}function Zt(ae){return ae.isMeshLambertMaterial||ae.isMeshToonMaterial||ae.isMeshPhongMaterial||ae.isMeshStandardMaterial||ae.isShadowMaterial||ae.isShaderMaterial&&ae.lights===!0}this.setFramebuffer=function(ae){b!==ae&&S===null&&he.bindFramebuffer(36160,ae),b=ae},this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return S},this.setRenderTarget=function(ae,Pe,Te){S=ae,T=Pe,_=Te,ae&&Ve.get(ae).__webglFramebuffer===void 0&&je.setupRenderTarget(ae);var Ne=b,it=!1;if(ae){var ft=Ve.get(ae).__webglFramebuffer;ae.isWebGLCubeRenderTarget?(Ne=ft[Pe||0],it=!0):ae.isWebGLMultisampleRenderTarget?Ne=Ve.get(ae).__webglMultisampledFramebuffer:Ne=ft,V.copy(ae.viewport),q.copy(ae.scissor),Q=ae.scissorTest}else V.copy(te).multiplyScalar(W).floor(),q.copy(X).multiplyScalar(W).floor(),Q=K;if(C!==Ne&&(he.bindFramebuffer(36160,Ne),C=Ne),Se.viewport(V),Se.scissor(q),Se.setScissorTest(Q),it){var gt=Ve.get(ae.texture);he.framebufferTexture2D(36160,36064,34069+(Pe||0),gt.__webglTexture,Te||0)}},this.readRenderTargetPixels=function(ae,Pe,Te,Ne,it,ft,gt){if(!(ae&&ae.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var ut=Ve.get(ae).__webglFramebuffer;if(ae.isWebGLCubeRenderTarget&&gt!==void 0&&(ut=ut[gt]),ut){var vt=!1;ut!==C&&(he.bindFramebuffer(36160,ut),vt=!0);try{var yt=ae.texture,Ot=yt.format,It=yt.type;if(Ot!==RGBAFormat&&ot.convert(Ot)!==he.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(It!==UnsignedByteType&&ot.convert(It)!==he.getParameter(35738)&&!(It===FloatType&&(Le.isWebGL2||Re.get("OES_texture_float")||Re.get("WEBGL_color_buffer_float")))&&!(It===HalfFloatType&&(Le.isWebGL2?Re.get("EXT_color_buffer_float"):Re.get("EXT_color_buffer_half_float")))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}he.checkFramebufferStatus(36160)===36053?Pe>=0&&Pe<=ae.width-Ne&&Te>=0&&Te<=ae.height-it&&he.readPixels(Pe,Te,Ne,it,ot.convert(Ot),ot.convert(It),ft):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{vt&&he.bindFramebuffer(36160,C)}}},this.copyFramebufferToTexture=function(ae,Pe,Te){Te===void 0&&(Te=0);var Ne=Math.pow(2,-Te),it=Math.floor(Pe.image.width*Ne),ft=Math.floor(Pe.image.height*Ne),gt=ot.convert(Pe.format);je.setTexture2D(Pe,0),he.copyTexImage2D(3553,Te,gt,ae.x,ae.y,it,ft,0),Se.unbindTexture()},this.copyTextureToTexture=function(ae,Pe,Te,Ne){Ne===void 0&&(Ne=0);var it=Pe.image.width,ft=Pe.image.height,gt=ot.convert(Te.format),ut=ot.convert(Te.type);je.setTexture2D(Te,0),Pe.isDataTexture?he.texSubImage2D(3553,Ne,ae.x,ae.y,it,ft,gt,ut,Pe.image.data):Pe.isCompressedTexture?he.compressedTexSubImage2D(3553,Ne,ae.x,ae.y,Pe.mipmaps[0].width,Pe.mipmaps[0].height,gt,Pe.mipmaps[0].data):he.texSubImage2D(3553,Ne,ae.x,ae.y,gt,ut,Pe.image),Ne===0&&Te.generateMipmaps&&he.generateMipmap(3553),Se.unbindTexture()},this.initTexture=function(ae){je.setTexture2D(ae,0),Se.unbindTexture()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function FogExp2(e,t){this.name="",this.color=new Color(e),this.density=t!==void 0?t:25e-5}Object.assign(FogExp2.prototype,{isFogExp2:!0,clone:function(){return new FogExp2(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}});function Fog(e,t,r){this.name="",this.color=new Color(e),this.near=t!==void 0?t:1,this.far=r!==void 0?r:1e3}Object.assign(Fog.prototype,{isFog:!0,clone:function(){return new Fog(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}});function InterleavedBuffer(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var n=0,o=this.stride;n<o;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var _vector$6=new Vector3;function InterleavedBufferAttribute(e,t,r,n){this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=n===!0}Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}});Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,r=this.data.count;t<r;t++)_vector$6.x=this.getX(t),_vector$6.y=this.getY(t),_vector$6.z=this.getZ(t),_vector$6.applyMatrix4(e),this.setXYZ(t,_vector$6.x,_vector$6.y,_vector$6.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=o,this},clone:function(){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var e=[],t=0;t<this.count;t++)for(var r=t*this.data.stride+this.offset,n=0;n<this.itemSize;n++)e.push(this.data.array[r+n]);return new BufferAttribute(new this.array.constructor(e),this.itemSize,this.normalized)},toJSON:function(){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var e=[],t=0;t<this.count;t++)for(var r=t*this.data.stride+this.offset,n=0;n<this.itemSize;n++)e.push(this.data.array[r+n]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}});function SpriteMaterial(e){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}SpriteMaterial.prototype=Object.create(Material.prototype);SpriteMaterial.prototype.constructor=SpriteMaterial;SpriteMaterial.prototype.isSpriteMaterial=!0;SpriteMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var _geometry,_intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2;function Sprite(e){if(Object3D.call(this),this.type="Sprite",_geometry===void 0){_geometry=new BufferGeometry;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new InterleavedBuffer(t,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(r,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(r,2,3,!1))}this.geometry=_geometry,this.material=e!==void 0?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);var r=this.material.rotation,n,o;r!==0&&(o=Math.cos(r),n=Math.sin(r));var s=this.center;transformVertex(_vA$1.set(-.5,-.5,0),_mvPosition,s,_worldScale,n,o),transformVertex(_vB$1.set(.5,-.5,0),_mvPosition,s,_worldScale,n,o),transformVertex(_vC$1.set(.5,.5,0),_mvPosition,s,_worldScale,n,o),_uvA$1.set(0,0),_uvB$1.set(1,0),_uvC$1.set(1,1);var l=e.ray.intersectTriangle(_vA$1,_vB$1,_vC$1,!1,_intersectPoint);if(!(l===null&&(transformVertex(_vB$1.set(-.5,.5,0),_mvPosition,s,_worldScale,n,o),_uvB$1.set(0,1),l=e.ray.intersectTriangle(_vA$1,_vC$1,_vB$1,!1,_intersectPoint),l===null))){var u=e.ray.origin.distanceTo(_intersectPoint);u<e.near||u>e.far||t.push({distance:u,point:_intersectPoint.clone(),uv:Triangle.getUV(_intersectPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return Object3D.prototype.copy.call(this,e),e.center!==void 0&&this.center.copy(e.center),this}});function transformVertex(e,t,r,n,o,s){_alignedPosition.subVectors(e,r).addScalar(.5).multiply(n),o!==void 0?(_rotatedPosition.x=s*_alignedPosition.x-o*_alignedPosition.y,_rotatedPosition.y=o*_alignedPosition.x+s*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),e.copy(t),e.x+=_rotatedPosition.x,e.y+=_rotatedPosition.y,e.applyMatrix4(_viewWorldMatrix)}var _v1$4=new Vector3,_v2$2=new Vector3;function LOD(){Object3D.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,isLOD:!0,copy:function(e){Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,n=t.length;r<n;r++){var o=t[r];this.addLevel(o.object.clone(),o.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){t===void 0&&(t=0),t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var r=1,n=t.length;r<n&&!(e<t[r].distance);r++);return t[r-1].object}return null},raycast:function(e,t){var r=this.levels;if(r.length>0){_v1$4.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(_v1$4);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){_v1$4.setFromMatrixPosition(e.matrixWorld),_v2$2.setFromMatrixPosition(this.matrixWorld);var r=_v1$4.distanceTo(_v2$2)/e.zoom;t[0].object.visible=!0;for(var n=1,o=t.length;n<o&&r>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<o;n++)t[n].object.visible=!1}},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];for(var r=this.levels,n=0,o=r.length;n<o;n++){var s=r[n];t.object.levels.push({object:s.object.uuid,distance:s.distance})}return t}});function SkinnedMesh(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Vector4,t=this.geometry.attributes.skinWeight,r=0,n=t.count;r<n;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);var o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Mesh.prototype.updateMatrixWorld.call(this,e),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)},boneTransform:function(){var e=new Vector3,t=new Vector4,r=new Vector4,n=new Vector3,o=new Matrix4;return function(s,l){var u=this.skeleton,c=this.geometry;t.fromBufferAttribute(c.attributes.skinIndex,s),r.fromBufferAttribute(c.attributes.skinWeight,s),e.fromBufferAttribute(c.attributes.position,s).applyMatrix4(this.bindMatrix),l.set(0,0,0);for(var h=0;h<4;h++){var f=r.getComponent(h);if(f!==0){var m=t.getComponent(h);o.multiplyMatrices(u.bones[m].matrixWorld,u.boneInverses[m]),l.addScaledVector(n.copy(e).applyMatrix4(o),f)}}return l.applyMatrix4(this.bindMatrixInverse)}}()});var _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;function Skeleton(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(this.bones.length*16),this.frame=-1,t===void 0)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Matrix4)}}Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new Matrix4;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)e=this.bones[t],e&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,o=0,s=e.length;o<s;o++){var l=e[o]?e[o].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(l,t[o]),_offsetMatrix.toArray(r,o*16)}n!==void 0&&(n.needsUpdate=!0)},clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t];if(n.name===e)return n}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}});function Bone(){Object3D.call(this),this.type="Bone"}Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0});var _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_mesh=new Mesh;function InstancedMesh(e,t,r){Mesh.call(this,e,t),this.instanceMatrix=new BufferAttribute(new Float32Array(r*16),16),this.count=r,this.frustumCulled=!1}InstancedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:InstancedMesh,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,e*16)},raycast:function(e,t){var r=this.matrixWorld,n=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,_mesh.material!==void 0)for(var o=0;o<n;o++){this.getMatrixAt(o,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(r,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(e,_instanceIntersects);for(var s=0,l=_instanceIntersects.length;s<l;s++){var u=_instanceIntersects[s];u.instanceId=o,u.object=this,t.push(u)}_instanceIntersects.length=0}},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,e*16)},updateMorphTargets:function(){}});function LineBasicMaterial(e){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}LineBasicMaterial.prototype=Object.create(Material.prototype);LineBasicMaterial.prototype.constructor=LineBasicMaterial;LineBasicMaterial.prototype.isLineBasicMaterial=!0;LineBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};var _start=new Vector3,_end=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$2=new Sphere;function Line(e,t,r){r===1&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Object3D.call(this),this.type="Line",this.geometry=e!==void 0?e:new BufferGeometry,this.material=t!==void 0?t:new LineBasicMaterial,this.updateMorphTargets()}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(e.index===null){for(var t=e.attributes.position,r=[0],n=1,o=t.count;n<o;n++)_start.fromBufferAttribute(t,n-1),_end.fromBufferAttribute(t,n),r[n]=r[n-1],r[n]+=_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var s=e.vertices,r=e.lineDistances;r[0]=0;for(var n=1,o=s.length;n<o;n++)r[n]=r[n-1],r[n]+=s[n-1].distanceTo(s[n])}return this},raycast:function(e,t){var r=this.geometry,n=this.matrixWorld,o=e.params.Line.threshold;if(r.boundingSphere===null&&r.computeBoundingSphere(),_sphere$2.copy(r.boundingSphere),_sphere$2.applyMatrix4(n),_sphere$2.radius+=o,e.ray.intersectsSphere(_sphere$2)!==!1){_inverseMatrix$1.getInverse(n),_ray$1.copy(e.ray).applyMatrix4(_inverseMatrix$1);var s=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=s*s,u=new Vector3,c=new Vector3,h=new Vector3,f=new Vector3,m=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var y=r.index,A=r.attributes,M=A.position.array;if(y!==null)for(var b=y.array,T=0,_=b.length-1;T<_;T+=m){var S=b[T],C=b[T+1];u.fromArray(M,S*3),c.fromArray(M,C*3);var P=_ray$1.distanceSqToSegment(u,c,f,h);if(!(P>l)){f.applyMatrix4(this.matrixWorld);var F=e.ray.origin.distanceTo(f);F<e.near||F>e.far||t.push({distance:F,point:h.clone().applyMatrix4(this.matrixWorld),index:T,face:null,faceIndex:null,object:this})}}else for(var T=0,_=M.length/3-1;T<_;T+=m){u.fromArray(M,3*T),c.fromArray(M,3*T+3);var P=_ray$1.distanceSqToSegment(u,c,f,h);if(!(P>l)){f.applyMatrix4(this.matrixWorld);var F=e.ray.origin.distanceTo(f);F<e.near||F>e.far||t.push({distance:F,point:h.clone().applyMatrix4(this.matrixWorld),index:T,face:null,faceIndex:null,object:this})}}}else if(r.isGeometry)for(var O=r.vertices,N=O.length,T=0;T<N-1;T+=m){var P=_ray$1.distanceSqToSegment(O[T],O[T+1],f,h);if(!(P>l)){f.applyMatrix4(this.matrixWorld);var F=e.ray.origin.distanceTo(f);F<e.near||F>e.far||t.push({distance:F,point:h.clone().applyMatrix4(this.matrixWorld),index:T,face:null,faceIndex:null,object:this})}}}},updateMorphTargets:function(){var e=this.geometry,t,r,n;if(e.isBufferGeometry){var o=e.morphAttributes,s=Object.keys(o);if(s.length>0){var l=o[s[0]];if(l!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,r=l.length;t<r;t++)n=l[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}else{var u=e.morphTargets;u!==void 0&&u.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var _start$1=new Vector3,_end$1=new Vector3;function LineSegments(e,t){Line.call(this,e,t),this.type="LineSegments"}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(e.index===null){for(var t=e.attributes.position,r=[],n=0,o=t.count;n<o;n+=2)_start$1.fromBufferAttribute(t,n),_end$1.fromBufferAttribute(t,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+_start$1.distanceTo(_end$1);e.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry)for(var s=e.vertices,r=e.lineDistances,n=0,o=s.length;n<o;n+=2)_start$1.copy(s[n]),_end$1.copy(s[n+1]),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+_start$1.distanceTo(_end$1);return this}});function LineLoop(e,t){Line.call(this,e,t),this.type="LineLoop"}LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0});function PointsMaterial(e){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}PointsMaterial.prototype=Object.create(Material.prototype);PointsMaterial.prototype.constructor=PointsMaterial;PointsMaterial.prototype.isPointsMaterial=!0;PointsMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var _inverseMatrix$2=new Matrix4,_ray$2=new Ray,_sphere$3=new Sphere,_position$1=new Vector3;function Points(e,t){Object3D.call(this),this.type="Points",this.geometry=e!==void 0?e:new BufferGeometry,this.material=t!==void 0?t:new PointsMaterial,this.updateMorphTargets()}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(e,t){var r=this.geometry,n=this.matrixWorld,o=e.params.Points.threshold;if(r.boundingSphere===null&&r.computeBoundingSphere(),_sphere$3.copy(r.boundingSphere),_sphere$3.applyMatrix4(n),_sphere$3.radius+=o,e.ray.intersectsSphere(_sphere$3)!==!1){_inverseMatrix$2.getInverse(n),_ray$2.copy(e.ray).applyMatrix4(_inverseMatrix$2);var s=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=s*s;if(r.isBufferGeometry){var u=r.index,c=r.attributes,h=c.position.array;if(u!==null)for(var f=u.array,m=0,y=f.length;m<y;m++){var A=f[m];_position$1.fromArray(h,A*3),testPoint(_position$1,A,l,n,e,t,this)}else for(var m=0,M=h.length/3;m<M;m++)_position$1.fromArray(h,m*3),testPoint(_position$1,m,l,n,e,t,this)}else for(var b=r.vertices,m=0,M=b.length;m<M;m++)testPoint(b[m],m,l,n,e,t,this)}},updateMorphTargets:function(){var e=this.geometry,t,r,n;if(e.isBufferGeometry){var o=e.morphAttributes,s=Object.keys(o);if(s.length>0){var l=o[s[0]];if(l!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,r=l.length;t<r;t++)n=l[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}else{var u=e.morphTargets;u!==void 0&&u.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function testPoint(e,t,r,n,o,s,l){var u=_ray$2.distanceSqToPoint(e);if(u<r){var c=new Vector3;_ray$2.closestPointToPoint(e,c),c.applyMatrix4(n);var h=o.ray.origin.distanceTo(c);if(h<o.near||h>o.far)return;s.push({distance:h,distanceToRay:Math.sqrt(u),point:c,index:t,face:null,object:l})}}function VideoTexture(e,t,r,n,o,s,l,u,c){Texture.call(this,e,t,r,n,o,s,l,u,c),this.format=l!==void 0?l:RGBFormat,this.minFilter=s!==void 0?s:LinearFilter,this.magFilter=o!==void 0?o:LinearFilter,this.generateMipmaps=!1}VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});function CompressedTexture(e,t,r,n,o,s,l,u,c,h,f,m){Texture.call(this,null,s,l,u,c,h,n,o,f,m),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}CompressedTexture.prototype=Object.create(Texture.prototype);CompressedTexture.prototype.constructor=CompressedTexture;CompressedTexture.prototype.isCompressedTexture=!0;function CanvasTexture(e,t,r,n,o,s,l,u,c){Texture.call(this,e,t,r,n,o,s,l,u,c),this.needsUpdate=!0}CanvasTexture.prototype=Object.create(Texture.prototype);CanvasTexture.prototype.constructor=CanvasTexture;CanvasTexture.prototype.isCanvasTexture=!0;function DepthTexture(e,t,r,n,o,s,l,u,c,h){if(h=h!==void 0?h:DepthFormat,h!==DepthFormat&&h!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&h===DepthFormat&&(r=UnsignedShortType),r===void 0&&h===DepthStencilFormat&&(r=UnsignedInt248Type),Texture.call(this,null,n,o,s,l,u,h,r,c),this.image={width:e,height:t},this.magFilter=l!==void 0?l:NearestFilter,this.minFilter=u!==void 0?u:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}DepthTexture.prototype=Object.create(Texture.prototype);DepthTexture.prototype.constructor=DepthTexture;DepthTexture.prototype.isDepthTexture=!0;function WireframeGeometry(e){BufferGeometry.call(this),this.type="WireframeGeometry";var t=[],r,n,o,s,l,u=[0,0],c={},h,f,m,y,A=["a","b","c"],M;if(e&&e.isGeometry){var b=e.faces;for(r=0,o=b.length;r<o;r++){var T=b[r];for(n=0;n<3;n++)f=T[A[n]],m=T[A[(n+1)%3]],u[0]=Math.min(f,m),u[1]=Math.max(f,m),y=u[0]+","+u[1],c[y]===void 0&&(c[y]={index1:u[0],index2:u[1]})}for(y in c)h=c[y],M=e.vertices[h.index1],t.push(M.x,M.y,M.z),M=e.vertices[h.index2],t.push(M.x,M.y,M.z)}else if(e&&e.isBufferGeometry){var _,S,C,P,F,O,N,V;if(M=new Vector3,e.index!==null){for(_=e.attributes.position,S=e.index,C=e.groups,C.length===0&&(C=[{start:0,count:S.count,materialIndex:0}]),s=0,l=C.length;s<l;++s)for(P=C[s],F=P.start,O=P.count,r=F,o=F+O;r<o;r+=3)for(n=0;n<3;n++)f=S.getX(r+n),m=S.getX(r+(n+1)%3),u[0]=Math.min(f,m),u[1]=Math.max(f,m),y=u[0]+","+u[1],c[y]===void 0&&(c[y]={index1:u[0],index2:u[1]});for(y in c)h=c[y],M.fromBufferAttribute(_,h.index1),t.push(M.x,M.y,M.z),M.fromBufferAttribute(_,h.index2),t.push(M.x,M.y,M.z)}else for(_=e.attributes.position,r=0,o=_.count/3;r<o;r++)for(n=0;n<3;n++)N=3*r+n,M.fromBufferAttribute(_,N),t.push(M.x,M.y,M.z),V=3*r+(n+1)%3,M.fromBufferAttribute(_,V),t.push(M.x,M.y,M.z)}this.setAttribute("position",new Float32BufferAttribute(t,3))}WireframeGeometry.prototype=Object.create(BufferGeometry.prototype);WireframeGeometry.prototype.constructor=WireframeGeometry;function ParametricGeometry(e,t,r){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new ParametricBufferGeometry(e,t,r)),this.mergeVertices()}ParametricGeometry.prototype=Object.create(Geometry.prototype);ParametricGeometry.prototype.constructor=ParametricGeometry;function ParametricBufferGeometry(e,t,r){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var n=[],o=[],s=[],l=[],u=1e-5,c=new Vector3,h=new Vector3,f=new Vector3,m=new Vector3,y=new Vector3,A,M;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var b=t+1;for(A=0;A<=r;A++){var T=A/r;for(M=0;M<=t;M++){var _=M/t;e(_,T,h),o.push(h.x,h.y,h.z),_-u>=0?(e(_-u,T,f),m.subVectors(h,f)):(e(_+u,T,f),m.subVectors(f,h)),T-u>=0?(e(_,T-u,f),y.subVectors(h,f)):(e(_,T+u,f),y.subVectors(f,h)),c.crossVectors(m,y).normalize(),s.push(c.x,c.y,c.z),l.push(_,T)}}for(A=0;A<r;A++)for(M=0;M<t;M++){var S=A*b+M,C=A*b+M+1,P=(A+1)*b+M+1,F=(A+1)*b+M;n.push(S,C,F),n.push(C,P,F)}this.setIndex(n),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry;function PolyhedronGeometry(e,t,r,n){Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},this.fromBufferGeometry(new PolyhedronBufferGeometry(e,t,r,n)),this.mergeVertices()}PolyhedronGeometry.prototype=Object.create(Geometry.prototype);PolyhedronGeometry.prototype.constructor=PolyhedronGeometry;function PolyhedronBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1,n=n||0;var o=[],s=[];l(n),c(r),h(),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(o.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(s,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function l(_){for(var S=new Vector3,C=new Vector3,P=new Vector3,F=0;F<t.length;F+=3)y(t[F+0],S),y(t[F+1],C),y(t[F+2],P),u(S,C,P,_)}function u(_,S,C,P){var F=Math.pow(2,P),O=[],N,V;for(N=0;N<=F;N++){O[N]=[];var q=_.clone().lerp(C,N/F),Q=S.clone().lerp(C,N/F),z=F-N;for(V=0;V<=z;V++)V===0&&N===F?O[N][V]=q:O[N][V]=q.clone().lerp(Q,V/z)}for(N=0;N<F;N++)for(V=0;V<2*(F-N)-1;V++){var H=Math.floor(V/2);V%2===0?(m(O[N][H+1]),m(O[N+1][H]),m(O[N][H])):(m(O[N][H+1]),m(O[N+1][H+1]),m(O[N+1][H]))}}function c(_){for(var S=new Vector3,C=0;C<o.length;C+=3)S.x=o[C+0],S.y=o[C+1],S.z=o[C+2],S.normalize().multiplyScalar(_),o[C+0]=S.x,o[C+1]=S.y,o[C+2]=S.z}function h(){for(var _=new Vector3,S=0;S<o.length;S+=3){_.x=o[S+0],_.y=o[S+1],_.z=o[S+2];var C=b(_)/2/Math.PI+.5,P=T(_)/Math.PI+.5;s.push(C,1-P)}A(),f()}function f(){for(var _=0;_<s.length;_+=6){var S=s[_+0],C=s[_+2],P=s[_+4],F=Math.max(S,C,P),O=Math.min(S,C,P);F>.9&&O<.1&&(S<.2&&(s[_+0]+=1),C<.2&&(s[_+2]+=1),P<.2&&(s[_+4]+=1))}}function m(_){o.push(_.x,_.y,_.z)}function y(_,S){var C=_*3;S.x=e[C+0],S.y=e[C+1],S.z=e[C+2]}function A(){for(var _=new Vector3,S=new Vector3,C=new Vector3,P=new Vector3,F=new Vector2,O=new Vector2,N=new Vector2,V=0,q=0;V<o.length;V+=9,q+=6){_.set(o[V+0],o[V+1],o[V+2]),S.set(o[V+3],o[V+4],o[V+5]),C.set(o[V+6],o[V+7],o[V+8]),F.set(s[q+0],s[q+1]),O.set(s[q+2],s[q+3]),N.set(s[q+4],s[q+5]),P.copy(_).add(S).add(C).divideScalar(3);var Q=b(P);M(F,q+0,_,Q),M(O,q+2,S,Q),M(N,q+4,C,Q)}}function M(_,S,C,P){P<0&&_.x===1&&(s[S]=_.x-1),C.x===0&&C.z===0&&(s[S]=P/2/Math.PI+.5)}function b(_){return Math.atan2(_.z,-_.x)}function T(_){return Math.atan2(-_.y,Math.sqrt(_.x*_.x+_.z*_.z))}}PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype);PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry;function TetrahedronGeometry(e,t){Geometry.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new TetrahedronBufferGeometry(e,t)),this.mergeVertices()}TetrahedronGeometry.prototype=Object.create(Geometry.prototype);TetrahedronGeometry.prototype.constructor=TetrahedronGeometry;function TetrahedronBufferGeometry(e,t){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];PolyhedronBufferGeometry.call(this,r,n,e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);TetrahedronBufferGeometry.prototype.constructor=TetrahedronBufferGeometry;function OctahedronGeometry(e,t){Geometry.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new OctahedronBufferGeometry(e,t)),this.mergeVertices()}OctahedronGeometry.prototype=Object.create(Geometry.prototype);OctahedronGeometry.prototype.constructor=OctahedronGeometry;function OctahedronBufferGeometry(e,t){var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];PolyhedronBufferGeometry.call(this,r,n,e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);OctahedronBufferGeometry.prototype.constructor=OctahedronBufferGeometry;function IcosahedronGeometry(e,t){Geometry.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new IcosahedronBufferGeometry(e,t)),this.mergeVertices()}IcosahedronGeometry.prototype=Object.create(Geometry.prototype);IcosahedronGeometry.prototype.constructor=IcosahedronGeometry;function IcosahedronBufferGeometry(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];PolyhedronBufferGeometry.call(this,n,o,e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);IcosahedronBufferGeometry.prototype.constructor=IcosahedronBufferGeometry;function DodecahedronGeometry(e,t){Geometry.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new DodecahedronBufferGeometry(e,t)),this.mergeVertices()}DodecahedronGeometry.prototype=Object.create(Geometry.prototype);DodecahedronGeometry.prototype.constructor=DodecahedronGeometry;function DodecahedronBufferGeometry(e,t){var r=(1+Math.sqrt(5))/2,n=1/r,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];PolyhedronBufferGeometry.call(this,o,s,e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);DodecahedronBufferGeometry.prototype.constructor=DodecahedronBufferGeometry;function TubeGeometry(e,t,r,n,o,s){Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:o},s!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");var l=new TubeBufferGeometry(e,t,r,n,o);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals,this.fromBufferGeometry(l),this.mergeVertices()}TubeGeometry.prototype=Object.create(Geometry.prototype);TubeGeometry.prototype.constructor=TubeGeometry;function TubeBufferGeometry(e,t,r,n,o){BufferGeometry.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:o},t=t||64,r=r||1,n=n||8,o=o||!1;var s=e.computeFrenetFrames(t,o);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;var l=new Vector3,u=new Vector3,c=new Vector2,h=new Vector3,f,m,y=[],A=[],M=[],b=[];T(),this.setIndex(b),this.setAttribute("position",new Float32BufferAttribute(y,3)),this.setAttribute("normal",new Float32BufferAttribute(A,3)),this.setAttribute("uv",new Float32BufferAttribute(M,2));function T(){for(f=0;f<t;f++)_(f);_(o===!1?t:0),C(),S()}function _(P){h=e.getPointAt(P/t,h);var F=s.normals[P],O=s.binormals[P];for(m=0;m<=n;m++){var N=m/n*Math.PI*2,V=Math.sin(N),q=-Math.cos(N);u.x=q*F.x+V*O.x,u.y=q*F.y+V*O.y,u.z=q*F.z+V*O.z,u.normalize(),A.push(u.x,u.y,u.z),l.x=h.x+r*u.x,l.y=h.y+r*u.y,l.z=h.z+r*u.z,y.push(l.x,l.y,l.z)}}function S(){for(m=1;m<=t;m++)for(f=1;f<=n;f++){var P=(n+1)*(m-1)+(f-1),F=(n+1)*m+(f-1),O=(n+1)*m+f,N=(n+1)*(m-1)+f;b.push(P,F,N),b.push(F,O,N)}}function C(){for(f=0;f<=t;f++)for(m=0;m<=n;m++)c.x=f/t,c.y=m/n,M.push(c.x,c.y)}}TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TubeBufferGeometry.prototype.constructor=TubeBufferGeometry;TubeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e};function TorusKnotGeometry(e,t,r,n,o,s,l){Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:o,q:s},l!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(e,t,r,n,o,s)),this.mergeVertices()}TorusKnotGeometry.prototype=Object.create(Geometry.prototype);TorusKnotGeometry.prototype.constructor=TorusKnotGeometry;function TorusKnotBufferGeometry(e,t,r,n,o,s){BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:o,q:s},e=e||1,t=t||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,o=o||2,s=s||3;var l=[],u=[],c=[],h=[],f,m,y=new Vector3,A=new Vector3,M=new Vector3,b=new Vector3,T=new Vector3,_=new Vector3,S=new Vector3;for(f=0;f<=r;++f){var C=f/r*o*Math.PI*2;for(z(C,o,s,e,M),z(C+.01,o,s,e,b),_.subVectors(b,M),S.addVectors(b,M),T.crossVectors(_,S),S.crossVectors(T,_),T.normalize(),S.normalize(),m=0;m<=n;++m){var P=m/n*Math.PI*2,F=-t*Math.cos(P),O=t*Math.sin(P);y.x=M.x+(F*S.x+O*T.x),y.y=M.y+(F*S.y+O*T.y),y.z=M.z+(F*S.z+O*T.z),u.push(y.x,y.y,y.z),A.subVectors(y,M).normalize(),c.push(A.x,A.y,A.z),h.push(f/r),h.push(m/n)}}for(m=1;m<=r;m++)for(f=1;f<=n;f++){var N=(n+1)*(m-1)+(f-1),V=(n+1)*m+(f-1),q=(n+1)*m+f,Q=(n+1)*(m-1)+f;l.push(N,V,Q),l.push(V,q,Q)}this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(u,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2));function z(H,W,J,G,te){var X=Math.cos(H),K=Math.sin(H),Z=J/W*H,ee=Math.cos(Z);te.x=G*(2+ee)*.5*X,te.y=G*(2+ee)*K*.5,te.z=G*Math.sin(Z)*.5}}TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TorusKnotBufferGeometry.prototype.constructor=TorusKnotBufferGeometry;function TorusGeometry(e,t,r,n,o){Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:o},this.fromBufferGeometry(new TorusBufferGeometry(e,t,r,n,o)),this.mergeVertices()}TorusGeometry.prototype=Object.create(Geometry.prototype);TorusGeometry.prototype.constructor=TorusGeometry;function TorusBufferGeometry(e,t,r,n,o){BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:o},e=e||1,t=t||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,o=o||Math.PI*2;var s=[],l=[],u=[],c=[],h=new Vector3,f=new Vector3,m=new Vector3,y,A;for(y=0;y<=r;y++)for(A=0;A<=n;A++){var M=A/n*o,b=y/r*Math.PI*2;f.x=(e+t*Math.cos(b))*Math.cos(M),f.y=(e+t*Math.cos(b))*Math.sin(M),f.z=t*Math.sin(b),l.push(f.x,f.y,f.z),h.x=e*Math.cos(M),h.y=e*Math.sin(M),m.subVectors(f,h).normalize(),u.push(m.x,m.y,m.z),c.push(A/n),c.push(y/r)}for(y=1;y<=r;y++)for(A=1;A<=n;A++){var T=(n+1)*y+A-1,_=(n+1)*(y-1)+A-1,S=(n+1)*(y-1)+A,C=(n+1)*y+A;s.push(T,_,C),s.push(_,S,C)}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TorusBufferGeometry.prototype.constructor=TorusBufferGeometry;var Earcut={triangulate:function(e,t,r){r=r||2;var n=t&&t.length,o=n?t[0]*r:e.length,s=linkedList(e,0,o,r,!0),l=[];if(!s||s.next===s.prev)return l;var u,c,h,f,m,y,A;if(n&&(s=eliminateHoles(e,t,s,r)),e.length>80*r){u=h=e[0],c=f=e[1];for(var M=r;M<o;M+=r)m=e[M],y=e[M+1],m<u&&(u=m),y<c&&(c=y),m>h&&(h=m),y>f&&(f=y);A=Math.max(h-u,f-c),A=A!==0?1/A:0}return earcutLinked(s,l,r,u,c,A),l}};function linkedList(e,t,r,n,o){var s,l;if(o===signedArea(e,t,r,n)>0)for(s=t;s<r;s+=n)l=insertNode(s,e[s],e[s+1],l);else for(s=r-n;s>=t;s-=n)l=insertNode(s,e[s],e[s+1],l);return l&&equals(l,l.next)&&(removeNode(l),l=l.next),l}function filterPoints(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&(equals(r,r.next)||area(r.prev,r,r.next)===0)){if(removeNode(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function earcutLinked(e,t,r,n,o,s,l){if(e){!l&&s&&indexCurve(e,n,o,s);for(var u=e,c,h;e.prev!==e.next;){if(c=e.prev,h=e.next,s?isEarHashed(e,n,o,s):isEar(e)){t.push(c.i/r),t.push(e.i/r),t.push(h.i/r),removeNode(e),e=h.next,u=h.next;continue}if(e=h,e===u){l?l===1?(e=cureLocalIntersections(filterPoints(e),t,r),earcutLinked(e,t,r,n,o,s,2)):l===2&&splitEarcut(e,t,r,n,o,s):earcutLinked(filterPoints(e),t,r,n,o,s,1);break}}}}function isEar(e){var t=e.prev,r=e,n=e.next;if(area(t,r,n)>=0)return!1;for(var o=e.next.next;o!==e.prev;){if(pointInTriangle(t.x,t.y,r.x,r.y,n.x,n.y,o.x,o.y)&&area(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function isEarHashed(e,t,r,n){var o=e.prev,s=e,l=e.next;if(area(o,s,l)>=0)return!1;for(var u=o.x<s.x?o.x<l.x?o.x:l.x:s.x<l.x?s.x:l.x,c=o.y<s.y?o.y<l.y?o.y:l.y:s.y<l.y?s.y:l.y,h=o.x>s.x?o.x>l.x?o.x:l.x:s.x>l.x?s.x:l.x,f=o.y>s.y?o.y>l.y?o.y:l.y:s.y>l.y?s.y:l.y,m=zOrder(u,c,t,r,n),y=zOrder(h,f,t,r,n),A=e.prevZ,M=e.nextZ;A&&A.z>=m&&M&&M.z<=y;){if(A!==e.prev&&A!==e.next&&pointInTriangle(o.x,o.y,s.x,s.y,l.x,l.y,A.x,A.y)&&area(A.prev,A,A.next)>=0||(A=A.prevZ,M!==e.prev&&M!==e.next&&pointInTriangle(o.x,o.y,s.x,s.y,l.x,l.y,M.x,M.y)&&area(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;A&&A.z>=m;){if(A!==e.prev&&A!==e.next&&pointInTriangle(o.x,o.y,s.x,s.y,l.x,l.y,A.x,A.y)&&area(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;M&&M.z<=y;){if(M!==e.prev&&M!==e.next&&pointInTriangle(o.x,o.y,s.x,s.y,l.x,l.y,M.x,M.y)&&area(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function cureLocalIntersections(e,t,r){var n=e;do{var o=n.prev,s=n.next.next;!equals(o,s)&&intersects(o,n,n.next,s)&&locallyInside(o,s)&&locallyInside(s,o)&&(t.push(o.i/r),t.push(n.i/r),t.push(s.i/r),removeNode(n),removeNode(n.next),n=e=s),n=n.next}while(n!==e);return filterPoints(n)}function splitEarcut(e,t,r,n,o,s){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&isValidDiagonal(l,u)){var c=splitPolygon(l,u);l=filterPoints(l,l.next),c=filterPoints(c,c.next),earcutLinked(l,t,r,n,o,s),earcutLinked(c,t,r,n,o,s);return}u=u.next}l=l.next}while(l!==e)}function eliminateHoles(e,t,r,n){var o=[],s,l,u,c,h;for(s=0,l=t.length;s<l;s++)u=t[s]*n,c=s<l-1?t[s+1]*n:e.length,h=linkedList(e,u,c,n,!1),h===h.next&&(h.steiner=!0),o.push(getLeftmost(h));for(o.sort(compareX),s=0;s<o.length;s++)eliminateHole(o[s],r),r=filterPoints(r,r.next);return r}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){if(t=findHoleBridge(e,t),t){var r=splitPolygon(t,e);filterPoints(t,t.next),filterPoints(r,r.next)}}function findHoleBridge(e,t){var r=t,n=e.x,o=e.y,s=-1/0,l;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var u=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(u<=n&&u>s){if(s=u,u===n){if(o===r.y)return r;if(o===r.next.y)return r.next}l=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!l)return null;if(n===s)return l;var c=l,h=l.x,f=l.y,m=1/0,y;r=l;do n>=r.x&&r.x>=h&&n!==r.x&&pointInTriangle(o<f?n:s,o,h,f,o<f?s:n,o,r.x,r.y)&&(y=Math.abs(o-r.y)/(n-r.x),locallyInside(r,e)&&(y<m||y===m&&(r.x>l.x||r.x===l.x&&sectorContainsSector(l,r)))&&(l=r,m=y)),r=r.next;while(r!==c);return l}function sectorContainsSector(e,t){return area(e.prev,e,t.prev)<0&&area(t.next,e,e.next)<0}function indexCurve(e,t,r,n){var o=e;do o.z===null&&(o.z=zOrder(o.x,o.y,t,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,sortLinked(o)}function sortLinked(e){var t,r,n,o,s,l,u,c,h=1;do{for(r=e,e=null,s=null,l=0;r;){for(l++,n=r,u=0,t=0;t<h&&(u++,n=n.nextZ,!!n);t++);for(c=h;u>0||c>0&&n;)u!==0&&(c===0||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,c--),s?s.nextZ=o:e=o,o.prevZ=s,s=o;r=n}s.nextZ=null,h*=2}while(l>1);return e}function zOrder(e,t,r,n,o){return e=32767*(e-r)*o,t=32767*(t-n)*o,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function getLeftmost(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function pointInTriangle(e,t,r,n,o,s,l,u){return(o-l)*(t-u)-(e-l)*(s-u)>=0&&(e-l)*(n-u)-(r-l)*(t-u)>=0&&(r-l)*(s-u)-(o-l)*(n-u)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&(locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)&&(area(e.prev,e,t.prev)||area(e,t.prev,t))||equals(e,t)&&area(e.prev,e,e.next)>0&&area(t.prev,t,t.next)>0)}function area(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,r,n){var o=sign(area(e,t,r)),s=sign(area(e,t,n)),l=sign(area(r,n,e)),u=sign(area(r,n,t));return!!(o!==s&&l!==u||o===0&&onSegment(e,r,t)||s===0&&onSegment(e,n,t)||l===0&&onSegment(r,e,n)||u===0&&onSegment(r,t,n))}function onSegment(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function sign(e){return e>0?1:e<0?-1:0}function intersectsPolygon(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){var r=e,n=!1,o=(e.x+t.x)/2,s=(e.y+t.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&o<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function splitPolygon(e,t){var r=new Node(e.i,e.x,e.y),n=new Node(t.i,t.x,t.y),o=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=o,o.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function insertNode(e,t,r,n){var o=new Node(e,t,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,r,n){for(var o=0,s=t,l=r-n;s<r;s+=n)o+=(e[l]-e[s])*(e[s+1]+e[l+1]),l=s;return o}var ShapeUtils={area:function(e){for(var t=e.length,r=0,n=t-1,o=0;o<t;n=o++)r+=e[n].x*e[o].y-e[o].x*e[n].y;return r*.5},isClockWise:function(e){return ShapeUtils.area(e)<0},triangulateShape:function(e,t){var r=[],n=[],o=[];removeDupEndPts(e),addContour(r,e);var s=e.length;t.forEach(removeDupEndPts);for(var l=0;l<t.length;l++)n.push(s),s+=t[l].length,addContour(r,t[l]);for(var u=Earcut.triangulate(r,n),l=0;l<u.length;l+=3)o.push(u.slice(l,l+3));return o}};function removeDupEndPts(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function addContour(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function ExtrudeGeometry(e,t){Geometry.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ExtrudeBufferGeometry(e,t)),this.mergeVertices()}ExtrudeGeometry.prototype=Object.create(Geometry.prototype);ExtrudeGeometry.prototype.constructor=ExtrudeGeometry;ExtrudeGeometry.prototype.toJSON=function(){var e=Geometry.prototype.toJSON.call(this),t=this.parameters.shapes,r=this.parameters.options;return toJSON(t,r,e)};function ExtrudeBufferGeometry(e,t){BufferGeometry.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var r=this,n=[],o=[],s=0,l=e.length;s<l;s++){var u=e[s];c(u)}this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("uv",new Float32BufferAttribute(o,2)),this.computeVertexNormals();function c(h){var f=[],m=t.curveSegments!==void 0?t.curveSegments:12,y=t.steps!==void 0?t.steps:1,A=t.depth!==void 0?t.depth:100,M=t.bevelEnabled!==void 0?t.bevelEnabled:!0,b=t.bevelThickness!==void 0?t.bevelThickness:6,T=t.bevelSize!==void 0?t.bevelSize:b-2,_=t.bevelOffset!==void 0?t.bevelOffset:0,S=t.bevelSegments!==void 0?t.bevelSegments:3,C=t.extrudePath,P=t.UVGenerator!==void 0?t.UVGenerator:WorldUVGenerator;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),A=t.amount);var F,O=!1,N,V,q,Q;C&&(F=C.getSpacedPoints(y),O=!0,M=!1,N=C.computeFrenetFrames(y,!1),V=new Vector3,q=new Vector3,Q=new Vector3),M||(S=0,b=0,T=0,_=0);var z,H,W,J=h.extractPoints(m),G=J.shape,te=J.holes,X=!ShapeUtils.isClockWise(G);if(X)for(G=G.reverse(),H=0,W=te.length;H<W;H++)z=te[H],ShapeUtils.isClockWise(z)&&(te[H]=z.reverse());var K=ShapeUtils.triangulateShape(G,te),Z=G;for(H=0,W=te.length;H<W;H++)z=te[H],G=G.concat(z);function ee(Ue,He,qe){return He||console.error("THREE.ExtrudeGeometry: vec does not exist"),He.clone().multiplyScalar(qe).add(Ue)}var j,re,pe,ge,_e,he=G.length,Fe,Re=K.length;function Le(Ue,He,qe){var ke,ve,Ye,tt=Ue.x-He.x,xt=Ue.y-He.y,Ze=qe.x-Ue.x,lt=qe.y-Ue.y,Pt=tt*tt+xt*xt,Lt=tt*lt-xt*Ze;if(Math.abs(Lt)>Number.EPSILON){var Gt=Math.sqrt(Pt),Rt=Math.sqrt(Ze*Ze+lt*lt),Ft=He.x-xt/Gt,Nt=He.y+tt/Gt,Ht=qe.x-lt/Rt,or=qe.y+Ze/Rt,Xt=((Ht-Ft)*lt-(or-Nt)*Ze)/(tt*lt-xt*Ze);ke=Ft+tt*Xt-Ue.x,ve=Nt+xt*Xt-Ue.y;var Zt=ke*ke+ve*ve;if(Zt<=2)return new Vector2(ke,ve);Ye=Math.sqrt(Zt/2)}else{var ae=!1;tt>Number.EPSILON?Ze>Number.EPSILON&&(ae=!0):tt<-Number.EPSILON?Ze<-Number.EPSILON&&(ae=!0):Math.sign(xt)===Math.sign(lt)&&(ae=!0),ae?(ke=-xt,ve=tt,Ye=Math.sqrt(Pt)):(ke=tt,ve=xt,Ye=Math.sqrt(Pt/2))}return new Vector2(ke/Ye,ve/Ye)}for(var Se=[],we=0,Ve=Z.length,je=Ve-1,st=we+1;we<Ve;we++,je++,st++)je===Ve&&(je=0),st===Ve&&(st=0),Se[we]=Le(Z[we],Z[je],Z[st]);var We=[],bt,oe=Se.concat();for(H=0,W=te.length;H<W;H++){for(z=te[H],bt=[],we=0,Ve=z.length,je=Ve-1,st=we+1;we<Ve;we++,je++,st++)je===Ve&&(je=0),st===Ve&&(st=0),bt[we]=Le(z[we],z[je],z[st]);We.push(bt),oe=oe.concat(bt)}for(j=0;j<S;j++){for(pe=j/S,ge=b*Math.cos(pe*Math.PI/2),re=T*Math.sin(pe*Math.PI/2)+_,we=0,Ve=Z.length;we<Ve;we++)_e=ee(Z[we],Se[we],re),be(_e.x,_e.y,-ge);for(H=0,W=te.length;H<W;H++)for(z=te[H],bt=We[H],we=0,Ve=z.length;we<Ve;we++)_e=ee(z[we],bt[we],re),be(_e.x,_e.y,-ge)}for(re=T+_,we=0;we<he;we++)_e=M?ee(G[we],oe[we],re):G[we],O?(q.copy(N.normals[0]).multiplyScalar(_e.x),V.copy(N.binormals[0]).multiplyScalar(_e.y),Q.copy(F[0]).add(q).add(V),be(Q.x,Q.y,Q.z)):be(_e.x,_e.y,0);var ue;for(ue=1;ue<=y;ue++)for(we=0;we<he;we++)_e=M?ee(G[we],oe[we],re):G[we],O?(q.copy(N.normals[ue]).multiplyScalar(_e.x),V.copy(N.binormals[ue]).multiplyScalar(_e.y),Q.copy(F[ue]).add(q).add(V),be(Q.x,Q.y,Q.z)):be(_e.x,_e.y,A/y*ue);for(j=S-1;j>=0;j--){for(pe=j/S,ge=b*Math.cos(pe*Math.PI/2),re=T*Math.sin(pe*Math.PI/2)+_,we=0,Ve=Z.length;we<Ve;we++)_e=ee(Z[we],Se[we],re),be(_e.x,_e.y,A+ge);for(H=0,W=te.length;H<W;H++)for(z=te[H],bt=We[H],we=0,Ve=z.length;we<Ve;we++)_e=ee(z[we],bt[we],re),O?be(_e.x,_e.y+F[y-1].y,F[y-1].x+ge):be(_e.x,_e.y,A+ge)}Qe(),Me();function Qe(){var Ue=n.length/3;if(M){var He=0,qe=he*He;for(we=0;we<Re;we++)Fe=K[we],ze(Fe[2]+qe,Fe[1]+qe,Fe[0]+qe);for(He=y+S*2,qe=he*He,we=0;we<Re;we++)Fe=K[we],ze(Fe[0]+qe,Fe[1]+qe,Fe[2]+qe)}else{for(we=0;we<Re;we++)Fe=K[we],ze(Fe[2],Fe[1],Fe[0]);for(we=0;we<Re;we++)Fe=K[we],ze(Fe[0]+he*y,Fe[1]+he*y,Fe[2]+he*y)}r.addGroup(Ue,n.length/3-Ue,0)}function Me(){var Ue=n.length/3,He=0;for(De(Z,He),He+=Z.length,H=0,W=te.length;H<W;H++)z=te[H],De(z,He),He+=z.length;r.addGroup(Ue,n.length/3-Ue,1)}function De(Ue,He){var qe,ke;for(we=Ue.length;--we>=0;){qe=we,ke=we-1,ke<0&&(ke=Ue.length-1);var ve=0,Ye=y+S*2;for(ve=0;ve<Ye;ve++){var tt=he*ve,xt=he*(ve+1),Ze=He+qe+tt,lt=He+ke+tt,Pt=He+ke+xt,Lt=He+qe+xt;at(Ze,lt,Pt,Lt)}}}function be(Ue,He,qe){f.push(Ue),f.push(He),f.push(qe)}function ze(Ue,He,qe){ot(Ue),ot(He),ot(qe);var ke=n.length/3,ve=P.generateTopUV(r,n,ke-3,ke-2,ke-1);nt(ve[0]),nt(ve[1]),nt(ve[2])}function at(Ue,He,qe,ke){ot(Ue),ot(He),ot(ke),ot(He),ot(qe),ot(ke);var ve=n.length/3,Ye=P.generateSideWallUV(r,n,ve-6,ve-3,ve-2,ve-1);nt(Ye[0]),nt(Ye[1]),nt(Ye[3]),nt(Ye[1]),nt(Ye[2]),nt(Ye[3])}function ot(Ue){n.push(f[Ue*3+0]),n.push(f[Ue*3+1]),n.push(f[Ue*3+2])}function nt(Ue){o.push(Ue.x),o.push(Ue.y)}}}ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ExtrudeBufferGeometry.prototype.constructor=ExtrudeBufferGeometry;ExtrudeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this),t=this.parameters.shapes,r=this.parameters.options;return toJSON(t,r,e)};var WorldUVGenerator={generateTopUV:function(e,t,r,n,o){var s=t[r*3],l=t[r*3+1],u=t[n*3],c=t[n*3+1],h=t[o*3],f=t[o*3+1];return[new Vector2(s,l),new Vector2(u,c),new Vector2(h,f)]},generateSideWallUV:function(e,t,r,n,o,s){var l=t[r*3],u=t[r*3+1],c=t[r*3+2],h=t[n*3],f=t[n*3+1],m=t[n*3+2],y=t[o*3],A=t[o*3+1],M=t[o*3+2],b=t[s*3],T=t[s*3+1],_=t[s*3+2];return Math.abs(u-f)<.01?[new Vector2(l,1-c),new Vector2(h,1-m),new Vector2(y,1-M),new Vector2(b,1-_)]:[new Vector2(u,1-c),new Vector2(f,1-m),new Vector2(A,1-M),new Vector2(T,1-_)]}};function toJSON(e,t,r){if(r.shapes=[],Array.isArray(e))for(var n=0,o=e.length;n<o;n++){var s=e[n];r.shapes.push(s.uuid)}else r.shapes.push(e.uuid);return t.extrudePath!==void 0&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function TextGeometry(e,t){Geometry.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new TextBufferGeometry(e,t)),this.mergeVertices()}TextGeometry.prototype=Object.create(Geometry.prototype);TextGeometry.prototype.constructor=TextGeometry;function TextBufferGeometry(e,t){t=t||{};var r=t.font;if(!(r&&r.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Geometry;var n=r.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),ExtrudeBufferGeometry.call(this,n,t),this.type="TextBufferGeometry"}TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype);TextBufferGeometry.prototype.constructor=TextBufferGeometry;function SphereGeometry(e,t,r,n,o,s,l){Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:o,thetaStart:s,thetaLength:l},this.fromBufferGeometry(new SphereBufferGeometry(e,t,r,n,o,s,l)),this.mergeVertices()}SphereGeometry.prototype=Object.create(Geometry.prototype);SphereGeometry.prototype.constructor=SphereGeometry;function SphereBufferGeometry(e,t,r,n,o,s,l){BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:o,thetaStart:s,thetaLength:l},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=n!==void 0?n:0,o=o!==void 0?o:Math.PI*2,s=s!==void 0?s:0,l=l!==void 0?l:Math.PI;var u=Math.min(s+l,Math.PI),c,h,f=0,m=[],y=new Vector3,A=new Vector3,M=[],b=[],T=[],_=[];for(h=0;h<=r;h++){var S=[],C=h/r,P=0;for(h==0&&s==0?P=.5/t:h==r&&u==Math.PI&&(P=-.5/t),c=0;c<=t;c++){var F=c/t;y.x=-e*Math.cos(n+F*o)*Math.sin(s+C*l),y.y=e*Math.cos(s+C*l),y.z=e*Math.sin(n+F*o)*Math.sin(s+C*l),b.push(y.x,y.y,y.z),A.copy(y).normalize(),T.push(A.x,A.y,A.z),_.push(F+P,1-C),S.push(f++)}m.push(S)}for(h=0;h<r;h++)for(c=0;c<t;c++){var O=m[h][c+1],N=m[h][c],V=m[h+1][c],q=m[h+1][c+1];(h!==0||s>0)&&M.push(O,N,q),(h!==r-1||u<Math.PI)&&M.push(N,V,q)}this.setIndex(M),this.setAttribute("position",new Float32BufferAttribute(b,3)),this.setAttribute("normal",new Float32BufferAttribute(T,3)),this.setAttribute("uv",new Float32BufferAttribute(_,2))}SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype);SphereBufferGeometry.prototype.constructor=SphereBufferGeometry;function RingGeometry(e,t,r,n,o,s){Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new RingBufferGeometry(e,t,r,n,o,s)),this.mergeVertices()}RingGeometry.prototype=Object.create(Geometry.prototype);RingGeometry.prototype.constructor=RingGeometry;function RingBufferGeometry(e,t,r,n,o,s){BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:o,thetaLength:s},e=e||.5,t=t||1,o=o!==void 0?o:0,s=s!==void 0?s:Math.PI*2,r=r!==void 0?Math.max(3,r):8,n=n!==void 0?Math.max(1,n):1;var l=[],u=[],c=[],h=[],f,m=e,y=(t-e)/n,A=new Vector3,M=new Vector2,b,T;for(b=0;b<=n;b++){for(T=0;T<=r;T++)f=o+T/r*s,A.x=m*Math.cos(f),A.y=m*Math.sin(f),u.push(A.x,A.y,A.z),c.push(0,0,1),M.x=(A.x/t+1)/2,M.y=(A.y/t+1)/2,h.push(M.x,M.y);m+=y}for(b=0;b<n;b++){var _=b*(r+1);for(T=0;T<r;T++){f=T+_;var S=f,C=f+r+1,P=f+r+2,F=f+1;l.push(S,C,F),l.push(C,P,F)}}this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(u,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype);RingBufferGeometry.prototype.constructor=RingBufferGeometry;function LatheGeometry(e,t,r,n){Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},this.fromBufferGeometry(new LatheBufferGeometry(e,t,r,n)),this.mergeVertices()}LatheGeometry.prototype=Object.create(Geometry.prototype);LatheGeometry.prototype.constructor=LatheGeometry;function LatheBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||Math.PI*2,n=MathUtils.clamp(n,0,Math.PI*2);var o=[],s=[],l=[],u,c=1/t,h=new Vector3,f=new Vector2,m,y;for(m=0;m<=t;m++){var A=r+m*c*n,M=Math.sin(A),b=Math.cos(A);for(y=0;y<=e.length-1;y++)h.x=e[y].x*M,h.y=e[y].y,h.z=e[y].x*b,s.push(h.x,h.y,h.z),f.x=m/t,f.y=y/(e.length-1),l.push(f.x,f.y)}for(m=0;m<t;m++)for(y=0;y<e.length-1;y++){u=y+m*e.length;var T=u,_=u+e.length,S=u+e.length+1,C=u+1;o.push(T,_,C),o.push(_,S,C)}if(this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2)),this.computeVertexNormals(),n===Math.PI*2){var P=this.attributes.normal.array,F=new Vector3,O=new Vector3,N=new Vector3;for(u=t*e.length*3,m=0,y=0;m<e.length;m++,y+=3)F.x=P[y+0],F.y=P[y+1],F.z=P[y+2],O.x=P[u+y+0],O.y=P[u+y+1],O.z=P[u+y+2],N.addVectors(F,O).normalize(),P[y+0]=P[u+y+0]=N.x,P[y+1]=P[u+y+1]=N.y,P[y+2]=P[u+y+2]=N.z}}LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype);LatheBufferGeometry.prototype.constructor=LatheBufferGeometry;function ShapeGeometry(e,t){Geometry.call(this),this.type="ShapeGeometry",typeof t=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ShapeBufferGeometry(e,t)),this.mergeVertices()}ShapeGeometry.prototype=Object.create(Geometry.prototype);ShapeGeometry.prototype.constructor=ShapeGeometry;ShapeGeometry.prototype.toJSON=function(){var e=Geometry.prototype.toJSON.call(this),t=this.parameters.shapes;return toJSON$1(t,e)};function ShapeBufferGeometry(e,t){BufferGeometry.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],n=[],o=[],s=[],l=0,u=0;if(Array.isArray(e)===!1)h(e);else for(var c=0;c<e.length;c++)h(e[c]),this.addGroup(l,u,c),l+=u,u=0;this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("normal",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2));function h(f){var m,y,A,M=n.length/3,b=f.extractPoints(t),T=b.shape,_=b.holes;for(ShapeUtils.isClockWise(T)===!1&&(T=T.reverse()),m=0,y=_.length;m<y;m++)A=_[m],ShapeUtils.isClockWise(A)===!0&&(_[m]=A.reverse());var S=ShapeUtils.triangulateShape(T,_);for(m=0,y=_.length;m<y;m++)A=_[m],T=T.concat(A);for(m=0,y=T.length;m<y;m++){var C=T[m];n.push(C.x,C.y,0),o.push(0,0,1),s.push(C.x,C.y)}for(m=0,y=S.length;m<y;m++){var P=S[m],F=P[0]+M,O=P[1]+M,N=P[2]+M;r.push(F,O,N),u+=3}}}ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ShapeBufferGeometry.prototype.constructor=ShapeBufferGeometry;ShapeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this),t=this.parameters.shapes;return toJSON$1(t,e)};function toJSON$1(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var o=e[r];t.shapes.push(o.uuid)}else t.shapes.push(e.uuid);return t}function EdgesGeometry(e,t){BufferGeometry.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=t!==void 0?t:1;var r=[],n=Math.cos(MathUtils.DEG2RAD*t),o=[0,0],s={},l,u,c,h=["a","b","c"],f;e.isBufferGeometry?(f=new Geometry,f.fromBufferGeometry(e)):f=e.clone(),f.mergeVertices(),f.computeFaceNormals();for(var m=f.vertices,y=f.faces,A=0,M=y.length;A<M;A++)for(var b=y[A],T=0;T<3;T++)l=b[h[T]],u=b[h[(T+1)%3]],o[0]=Math.min(l,u),o[1]=Math.max(l,u),c=o[0]+","+o[1],s[c]===void 0?s[c]={index1:o[0],index2:o[1],face1:A,face2:void 0}:s[c].face2=A;for(c in s){var _=s[c];if(_.face2===void 0||y[_.face1].normal.dot(y[_.face2].normal)<=n){var S=m[_.index1];r.push(S.x,S.y,S.z),S=m[_.index2],r.push(S.x,S.y,S.z)}}this.setAttribute("position",new Float32BufferAttribute(r,3))}EdgesGeometry.prototype=Object.create(BufferGeometry.prototype);EdgesGeometry.prototype.constructor=EdgesGeometry;function CylinderGeometry(e,t,r,n,o,s,l,u){Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:o,openEnded:s,thetaStart:l,thetaLength:u},this.fromBufferGeometry(new CylinderBufferGeometry(e,t,r,n,o,s,l,u)),this.mergeVertices()}CylinderGeometry.prototype=Object.create(Geometry.prototype);CylinderGeometry.prototype.constructor=CylinderGeometry;function CylinderBufferGeometry(e,t,r,n,o,s,l,u){BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:o,openEnded:s,thetaStart:l,thetaLength:u};var c=this;e=e!==void 0?e:1,t=t!==void 0?t:1,r=r||1,n=Math.floor(n)||8,o=Math.floor(o)||1,s=s!==void 0?s:!1,l=l!==void 0?l:0,u=u!==void 0?u:Math.PI*2;var h=[],f=[],m=[],y=[],A=0,M=[],b=r/2,T=0;_(),s===!1&&(e>0&&S(!0),t>0&&S(!1)),this.setIndex(h),this.setAttribute("position",new Float32BufferAttribute(f,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(y,2));function _(){var C,P,F=new Vector3,O=new Vector3,N=0,V=(t-e)/r;for(P=0;P<=o;P++){var q=[],Q=P/o,z=Q*(t-e)+e;for(C=0;C<=n;C++){var H=C/n,W=H*u+l,J=Math.sin(W),G=Math.cos(W);O.x=z*J,O.y=-Q*r+b,O.z=z*G,f.push(O.x,O.y,O.z),F.set(J,V,G).normalize(),m.push(F.x,F.y,F.z),y.push(H,1-Q),q.push(A++)}M.push(q)}for(C=0;C<n;C++)for(P=0;P<o;P++){var te=M[P][C],X=M[P+1][C],K=M[P+1][C+1],Z=M[P][C+1];h.push(te,X,Z),h.push(X,K,Z),N+=6}c.addGroup(T,N,0),T+=N}function S(C){var P,F,O,N=new Vector2,V=new Vector3,q=0,Q=C===!0?e:t,z=C===!0?1:-1;for(F=A,P=1;P<=n;P++)f.push(0,b*z,0),m.push(0,z,0),y.push(.5,.5),A++;for(O=A,P=0;P<=n;P++){var H=P/n,W=H*u+l,J=Math.cos(W),G=Math.sin(W);V.x=Q*G,V.y=b*z,V.z=Q*J,f.push(V.x,V.y,V.z),m.push(0,z,0),N.x=J*.5+.5,N.y=G*.5*z+.5,y.push(N.x,N.y),A++}for(P=0;P<n;P++){var te=F+P,X=O+P;C===!0?h.push(X,X+1,te):h.push(X+1,X,te),q+=3}c.addGroup(T,q,C===!0?1:2),T+=q}}CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype);CylinderBufferGeometry.prototype.constructor=CylinderBufferGeometry;function ConeGeometry(e,t,r,n,o,s,l){CylinderGeometry.call(this,0,e,t,r,n,o,s,l),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:s,thetaLength:l}}ConeGeometry.prototype=Object.create(CylinderGeometry.prototype);ConeGeometry.prototype.constructor=ConeGeometry;function ConeBufferGeometry(e,t,r,n,o,s,l){CylinderBufferGeometry.call(this,0,e,t,r,n,o,s,l),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:s,thetaLength:l}}ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype);ConeBufferGeometry.prototype.constructor=ConeBufferGeometry;function CircleGeometry(e,t,r,n){Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new CircleBufferGeometry(e,t,r,n)),this.mergeVertices()}CircleGeometry.prototype=Object.create(Geometry.prototype);CircleGeometry.prototype.constructor=CircleGeometry;function CircleBufferGeometry(e,t,r,n){BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=t!==void 0?Math.max(3,t):8,r=r!==void 0?r:0,n=n!==void 0?n:Math.PI*2;var o=[],s=[],l=[],u=[],c,h,f=new Vector3,m=new Vector2;for(s.push(0,0,0),l.push(0,0,1),u.push(.5,.5),h=0,c=3;h<=t;h++,c+=3){var y=r+h/t*n;f.x=e*Math.cos(y),f.y=e*Math.sin(y),s.push(f.x,f.y,f.z),l.push(0,0,1),m.x=(s[c]/e+1)/2,m.y=(s[c+1]/e+1)/2,u.push(m.x,m.y)}for(c=1;c<=t;c++)o.push(c,c+1,0);this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(u,2))}CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype);CircleBufferGeometry.prototype.constructor=CircleBufferGeometry;var Geometries=Object.freeze({__proto__:null,WireframeGeometry,ParametricGeometry,ParametricBufferGeometry,TetrahedronGeometry,TetrahedronBufferGeometry,OctahedronGeometry,OctahedronBufferGeometry,IcosahedronGeometry,IcosahedronBufferGeometry,DodecahedronGeometry,DodecahedronBufferGeometry,PolyhedronGeometry,PolyhedronBufferGeometry,TubeGeometry,TubeBufferGeometry,TorusKnotGeometry,TorusKnotBufferGeometry,TorusGeometry,TorusBufferGeometry,TextGeometry,TextBufferGeometry,SphereGeometry,SphereBufferGeometry,RingGeometry,RingBufferGeometry,PlaneGeometry,PlaneBufferGeometry,LatheGeometry,LatheBufferGeometry,ShapeGeometry,ShapeBufferGeometry,ExtrudeGeometry,ExtrudeBufferGeometry,EdgesGeometry,ConeGeometry,ConeBufferGeometry,CylinderGeometry,CylinderBufferGeometry,CircleGeometry,CircleBufferGeometry,BoxGeometry,BoxBufferGeometry});function ShadowMaterial(e){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}ShadowMaterial.prototype=Object.create(Material.prototype);ShadowMaterial.prototype.constructor=ShadowMaterial;ShadowMaterial.prototype.isShadowMaterial=!0;ShadowMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this};function RawShaderMaterial(e){ShaderMaterial.call(this,e),this.type="RawShaderMaterial"}RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype);RawShaderMaterial.prototype.constructor=RawShaderMaterial;RawShaderMaterial.prototype.isRawShaderMaterial=!0;function MeshStandardMaterial(e){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}MeshStandardMaterial.prototype=Object.create(Material.prototype);MeshStandardMaterial.prototype.constructor=MeshStandardMaterial;MeshStandardMaterial.prototype.isMeshStandardMaterial=!0;MeshStandardMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this};function MeshPhysicalMaterial(e){MeshStandardMaterial.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(e)}MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype);MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial;MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0;MeshPhysicalMaterial.prototype.copy=function(e){return MeshStandardMaterial.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Color).copy(e.sheen):this.sheen=null,this.transparency=e.transparency,this};function MeshPhongMaterial(e){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshPhongMaterial.prototype=Object.create(Material.prototype);MeshPhongMaterial.prototype.constructor=MeshPhongMaterial;MeshPhongMaterial.prototype.isMeshPhongMaterial=!0;MeshPhongMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function MeshToonMaterial(e){Material.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshToonMaterial.prototype=Object.create(Material.prototype);MeshToonMaterial.prototype.constructor=MeshToonMaterial;MeshToonMaterial.prototype.isMeshToonMaterial=!0;MeshToonMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function MeshNormalMaterial(e){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshNormalMaterial.prototype=Object.create(Material.prototype);MeshNormalMaterial.prototype.constructor=MeshNormalMaterial;MeshNormalMaterial.prototype.isMeshNormalMaterial=!0;MeshNormalMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function MeshLambertMaterial(e){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshLambertMaterial.prototype=Object.create(Material.prototype);MeshLambertMaterial.prototype.constructor=MeshLambertMaterial;MeshLambertMaterial.prototype.isMeshLambertMaterial=!0;MeshLambertMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function MeshMatcapMaterial(e){Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshMatcapMaterial.prototype=Object.create(Material.prototype);MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial;MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0;MeshMatcapMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function LineDashedMaterial(e){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype);LineDashedMaterial.prototype.constructor=LineDashedMaterial;LineDashedMaterial.prototype.isLineDashedMaterial=!0;LineDashedMaterial.prototype.copy=function(e){return LineBasicMaterial.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Materials=Object.freeze({__proto__:null,ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material}),AnimationUtils={arraySlice:function(e,t,r){return AnimationUtils.isTypedArray(e)?new e.constructor(e.subarray(t,r!==void 0?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(s,l){return e[s]-e[l]}for(var r=e.length,n=new Array(r),o=0;o!==r;++o)n[o]=o;return n.sort(t),n},sortedArray:function(e,t,r){for(var n=e.length,o=new e.constructor(n),s=0,l=0;l!==n;++s)for(var u=r[s]*t,c=0;c!==t;++c)o[l++]=e[u+c];return o},flattenJSON:function(e,t,r,n){for(var o=1,s=e[0];s!==void 0&&s[n]===void 0;)s=e[o++];if(s!==void 0){var l=s[n];if(l!==void 0)if(Array.isArray(l))do l=s[n],l!==void 0&&(t.push(s.time),r.push.apply(r,l)),s=e[o++];while(s!==void 0);else if(l.toArray!==void 0)do l=s[n],l!==void 0&&(t.push(s.time),l.toArray(r,r.length)),s=e[o++];while(s!==void 0);else do l=s[n],l!==void 0&&(t.push(s.time),r.push(l)),s=e[o++];while(s!==void 0)}},subclip:function(e,t,r,n,o){o=o||30;var s=e.clone();s.name=t;for(var l=[],u=0;u<s.tracks.length;++u){for(var c=s.tracks[u],h=c.getValueSize(),f=[],m=[],y=0;y<c.times.length;++y){var A=c.times[y]*o;if(!(A<r||A>=n)){f.push(c.times[y]);for(var M=0;M<h;++M)m.push(c.values[y*h+M])}}f.length!==0&&(c.times=AnimationUtils.convertArray(f,c.times.constructor),c.values=AnimationUtils.convertArray(m,c.values.constructor),l.push(c))}s.tracks=l;for(var b=1/0,u=0;u<s.tracks.length;++u)b>s.tracks[u].times[0]&&(b=s.tracks[u].times[0]);for(var u=0;u<s.tracks.length;++u)s.tracks[u].shift(-1*b);return s.resetDuration(),s},makeClipAdditive:function(e,t,r,n){t===void 0&&(t=0),r===void 0&&(r=e),(n===void 0||n<=0)&&(n=30);for(var o=e.tracks.length,s=t/n,l=0;l<o;++l){var u=r.tracks[l],c=u.ValueTypeName;if(!(c==="bool"||c==="string")){var h=e.tracks.find(function(P){return P.name===u.name&&P.ValueTypeName===c});if(h!==void 0){var f=u.getValueSize(),m=u.times.length-1,y;if(s<=u.times[0])y=AnimationUtils.arraySlice(u.values,0,u.valueSize);else if(s>=u.times[m]){var A=m*f;y=AnimationUtils.arraySlice(u.values,A)}else{var M=u.createInterpolant();M.evaluate(s),y=M.resultBuffer}if(c==="quaternion"){var b=new Quaternion(y[0],y[1],y[2],y[3]).normalize().conjugate();b.toArray(y)}for(var T=h.times.length,_=0;_<T;++_){var S=_*f;if(c==="quaternion")Quaternion.multiplyQuaternionsFlat(h.values,S,y,0,h.values,S);else for(var C=0;C<f;++C)h.values[S+C]-=y[C]}}}}return e.blendMode=AdditiveAnimationBlendMode,e}};function Interpolant(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}Object.assign(Interpolant.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],o=t[r-1];e:{t:{var s;r:{n:if(!(e<n)){for(var l=r+2;;){if(n===void 0){if(e<o)break n;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,o)}if(r===l)break;if(o=n,n=t[++r],e<n)break t}s=t.length;break r}if(!(e>=o)){var u=t[1];e<u&&(r=2,o=u);for(var l=r-2;;){if(o===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===l)break;if(n=o,o=t[--r-1],e>=o)break t}s=r,r=0;break r}break e}for(;r<s;){var c=r+s>>>1;e<t[c]?s=c:r=c+1}if(n=t[r],o=t[r-1],o===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(n===void 0)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,o,e)}this._cachedIndex=r,this.intervalChanged_(r,o,n)}return this.interpolate_(r,o,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,o=e*n,s=0;s!==n;++s)t[s]=r[o+s];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_});function CubicInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},intervalChanged_:function(e,t,r){var n=this.parameterPositions,o=e-2,s=e+1,l=n[o],u=n[s];if(l===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:o=e,l=2*t-r;break;case WrapAroundEnding:o=n.length-2,l=t+n[o]-n[o+1];break;default:o=e,l=r}if(u===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:s=e,u=2*r-t;break;case WrapAroundEnding:s=1,u=r+n[1]-n[0];break;default:s=e-1,u=t}var c=(r-t)*.5,h=this.valueSize;this._weightPrev=c/(t-l),this._weightNext=c/(u-r),this._offsetPrev=o*h,this._offsetNext=s*h},interpolate_:function(e,t,r,n){for(var o=this.resultBuffer,s=this.sampleValues,l=this.valueSize,u=e*l,c=u-l,h=this._offsetPrev,f=this._offsetNext,m=this._weightPrev,y=this._weightNext,A=(r-t)/(n-t),M=A*A,b=M*A,T=-m*b+2*m*M-m*A,_=(1+m)*b+(-1.5-2*m)*M+(-.5+m)*A+1,S=(-1-y)*b+(1.5+y)*M+.5*A,C=y*b-y*M,P=0;P!==l;++P)o[P]=T*s[h+P]+_*s[c+P]+S*s[u+P]+C*s[f+P];return o}});function LinearInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(e,t,r,n){for(var o=this.resultBuffer,s=this.sampleValues,l=this.valueSize,u=e*l,c=u-l,h=(r-t)/(n-t),f=1-h,m=0;m!==l;++m)o[m]=s[c+m]*f+s[u+m]*h;return o}});function DiscreteInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(e){return this.copySampleValue_(e-1)}});function KeyframeTrack(e,t,r,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=AnimationUtils.convertArray(t,this.TimeBufferType),this.values=AnimationUtils.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}Object.assign(KeyframeTrack,{toJSON:function(e){var t=e.constructor,r;if(t.toJSON!==void 0)r=t.toJSON(e);else{r={name:e.name,times:AnimationUtils.convertArray(e.times,Array),values:AnimationUtils.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(r.interpolation=n)}return r.type=e.ValueTypeName,r}});Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodDiscrete:function(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(e!==0)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]+=e;return this},scale:function(e){if(e!==1)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,n=r.length,o=0,s=n-1;o!==n&&r[o]<e;)++o;for(;s!==-1&&r[s]>t;)--s;if(++s,o!==0||s!==n){o>=s&&(s=Math.max(s,1),o=s-1);var l=this.getValueSize();this.times=AnimationUtils.arraySlice(r,o,s),this.values=AnimationUtils.arraySlice(this.values,o*l,s*l)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,n=this.values,o=r.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var s=null,l=0;l!==o;l++){var u=r[l];if(typeof u=="number"&&isNaN(u)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,u),e=!1;break}if(s!==null&&s>u){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,u,s),e=!1;break}s=u}if(n!==void 0&&AnimationUtils.isTypedArray(n))for(var l=0,c=n.length;l!==c;++l){var h=n[l];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,h),e=!1;break}}return e},optimize:function(){for(var e=AnimationUtils.arraySlice(this.times),t=AnimationUtils.arraySlice(this.values),r=this.getValueSize(),n=this.getInterpolation()===InterpolateSmooth,o=1,s=e.length-1,l=1;l<s;++l){var u=!1,c=e[l],h=e[l+1];if(c!==h&&(l!==1||c!==c[0]))if(n)u=!0;else for(var f=l*r,m=f-r,y=f+r,A=0;A!==r;++A){var M=t[f+A];if(M!==t[m+A]||M!==t[y+A]){u=!0;break}}if(u){if(l!==o){e[o]=e[l];for(var b=l*r,T=o*r,A=0;A!==r;++A)t[T+A]=t[b+A]}++o}}if(s>0){e[o]=e[s];for(var b=s*r,T=o*r,A=0;A!==r;++A)t[T+A]=t[b+A];++o}return o!==e.length?(this.times=AnimationUtils.arraySlice(e,0,o),this.values=AnimationUtils.arraySlice(t,0,o*r)):(this.times=e,this.values=t),this},clone:function(){var e=AnimationUtils.arraySlice(this.times,0),t=AnimationUtils.arraySlice(this.values,0),r=this.constructor,n=new r(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}});function BooleanKeyframeTrack(e,t,r){KeyframeTrack.call(this,e,t,r)}BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function ColorKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"});function NumberKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"});function QuaternionLinearInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(e,t,r,n){for(var o=this.resultBuffer,s=this.sampleValues,l=this.valueSize,u=e*l,c=(r-t)/(n-t),h=u+l;u!==h;u+=4)Quaternion.slerpFlat(o,0,s,u-l,s,u,c);return o}});function QuaternionKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodLinear:function(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0});function StringKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function VectorKeyframeTrack(e,t,r,n){KeyframeTrack.call(this,e,t,r,n)}VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"});function AnimationClip(e,t,r,n){this.name=e,this.tracks=r,this.duration=t!==void 0?t:-1,this.blendMode=n!==void 0?n:NormalAnimationBlendMode,this.uuid=MathUtils.generateUUID(),this.duration<0&&this.resetDuration()}function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function parseKeyframeTrack(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=getTrackTypeForValueTypeName(e.type);if(e.times===void 0){var r=[],n=[];AnimationUtils.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(AnimationClip,{parse:function(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),o=0,s=r.length;o!==s;++o)t.push(parseKeyframeTrack(r[o]).scale(n));return new AnimationClip(e.name,e.duration,t,e.blendMode)},toJSON:function(e){for(var t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},o=0,s=r.length;o!==s;++o)t.push(KeyframeTrack.toJSON(r[o]));return n},CreateFromMorphTargetSequence:function(e,t,r,n){for(var o=t.length,s=[],l=0;l<o;l++){var u=[],c=[];u.push((l+o-1)%o,l,(l+1)%o),c.push(0,1,0);var h=AnimationUtils.getKeyframeOrder(u);u=AnimationUtils.sortedArray(u,1,h),c=AnimationUtils.sortedArray(c,1,h),!n&&u[0]===0&&(u.push(o),c.push(c[0])),s.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[l].name+"]",u,c).scale(1/r))}return new AnimationClip(e,-1,s)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var n=e;r=n.geometry&&n.geometry.animations||n.animations}for(var o=0;o<r.length;o++)if(r[o].name===t)return r[o];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var n={},o=/^([\w-]*?)([\d]+)$/,s=0,l=e.length;s<l;s++){var u=e[s],c=u.name.match(o);if(c&&c.length>1){var h=c[1],f=n[h];f||(n[h]=f=[]),f.push(u)}}var m=[];for(var h in n)m.push(AnimationClip.CreateFromMorphTargetSequence(h,n[h],t,r));return m},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(P,F,O,N,V){if(O.length!==0){var q=[],Q=[];AnimationUtils.flattenJSON(O,q,Q,N),q.length!==0&&V.push(new P(F,q,Q))}},n=[],o=e.name||"default",s=e.length||-1,l=e.fps||30,u=e.blendMode,c=e.hierarchy||[],h=0;h<c.length;h++){var f=c[h].keys;if(!(!f||f.length===0))if(f[0].morphTargets){for(var m={},y=0;y<f.length;y++)if(f[y].morphTargets)for(var A=0;A<f[y].morphTargets.length;A++)m[f[y].morphTargets[A]]=-1;for(var M in m){for(var b=[],T=[],A=0;A!==f[y].morphTargets.length;++A){var _=f[y];b.push(_.time),T.push(_.morphTarget===M?1:0)}n.push(new NumberKeyframeTrack(".morphTargetInfluence["+M+"]",b,T))}s=m.length*l}else{var S=".bones["+t[h].name+"]";r(VectorKeyframeTrack,S+".position",f,"pos",n),r(QuaternionKeyframeTrack,S+".quaternion",f,"rot",n),r(VectorKeyframeTrack,S+".scale",f,"scl",n)}}if(n.length===0)return null;var C=new AnimationClip(o,s,n,u);return C}});Object.assign(AnimationClip.prototype,{resetDuration:function(){for(var e=this.tracks,t=0,r=0,n=e.length;r!==n;++r){var o=this.tracks[r];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new AnimationClip(this.name,this.duration,e,this.blendMode)}});var Cache={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function LoadingManager(e,t,r){var n=this,o=!1,s=0,l=0,u=void 0,c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(h){l++,o===!1&&n.onStart!==void 0&&n.onStart(h,s,l),o=!0},this.itemEnd=function(h){s++,n.onProgress!==void 0&&n.onProgress(h,s,l),s===l&&(o=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(h){n.onError!==void 0&&n.onError(h)},this.resolveURL=function(h){return u?u(h):h},this.setURLModifier=function(h){return u=h,this},this.addHandler=function(h,f){return c.push(h,f),this},this.removeHandler=function(h){var f=c.indexOf(h);return f!==-1&&c.splice(f,2),this},this.getHandler=function(h){for(var f=0,m=c.length;f<m;f+=2){var y=c[f],A=c[f+1];if(y.global&&(y.lastIndex=0),y.test(h))return A}return null}}var DefaultLoadingManager=new LoadingManager;function Loader(e){this.manager=e!==void 0?e:DefaultLoadingManager,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Loader.prototype,{load:function(){},loadAsync:function(e,t){var r=this;return new Promise(function(n,o){r.load(e,n,t,o)})},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});var loading={};function FileLoader(e){Loader.call(this,e)}FileLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FileLoader,load:function(e,t,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,s=Cache.get(e);if(s!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(s),o.manager.itemEnd(e)},0),s;if(loading[e]!==void 0){loading[e].push({onLoad:t,onProgress:r,onError:n});return}var l=/^data:(.*?)(;base64)?,(.*)$/,u=e.match(l);if(u){var c=u[1],h=!!u[2],f=u[3];f=decodeURIComponent(f),h&&(f=atob(f));try{var m,y=(this.responseType||"").toLowerCase();switch(y){case"arraybuffer":case"blob":for(var A=new Uint8Array(f.length),M=0;M<f.length;M++)A[M]=f.charCodeAt(M);y==="blob"?m=new Blob([A.buffer],{type:c}):m=A.buffer;break;case"document":var b=new DOMParser;m=b.parseFromString(f,c);break;case"json":m=JSON.parse(f);break;default:m=f;break}setTimeout(function(){t&&t(m),o.manager.itemEnd(e)},0)}catch(S){setTimeout(function(){n&&n(S),o.manager.itemError(e),o.manager.itemEnd(e)},0)}}else{loading[e]=[],loading[e].push({onLoad:t,onProgress:r,onError:n});var T=new XMLHttpRequest;T.open("GET",e,!0),T.addEventListener("load",function(S){var C=this.response,P=loading[e];if(delete loading[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Cache.add(e,C);for(var F=0,O=P.length;F<O;F++){var N=P[F];N.onLoad&&N.onLoad(C)}o.manager.itemEnd(e)}else{for(var F=0,O=P.length;F<O;F++){var N=P[F];N.onError&&N.onError(S)}o.manager.itemError(e),o.manager.itemEnd(e)}},!1),T.addEventListener("progress",function(S){for(var C=loading[e],P=0,F=C.length;P<F;P++){var O=C[P];O.onProgress&&O.onProgress(S)}},!1),T.addEventListener("error",function(S){var C=loading[e];delete loading[e];for(var P=0,F=C.length;P<F;P++){var O=C[P];O.onError&&O.onError(S)}o.manager.itemError(e),o.manager.itemEnd(e)},!1),T.addEventListener("abort",function(S){var C=loading[e];delete loading[e];for(var P=0,F=C.length;P<F;P++){var O=C[P];O.onError&&O.onError(S)}o.manager.itemError(e),o.manager.itemEnd(e)},!1),this.responseType!==void 0&&(T.responseType=this.responseType),this.withCredentials!==void 0&&(T.withCredentials=this.withCredentials),T.overrideMimeType&&T.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(var _ in this.requestHeader)T.setRequestHeader(_,this.requestHeader[_]);T.send(null)}return o.manager.itemStart(e),T},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this}});function AnimationLoader(e){Loader.call(this,e)}AnimationLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AnimationLoader,load:function(e,t,r,n){var o=this,s=new FileLoader(o.manager);s.setPath(o.path),s.load(e,function(l){try{t(o.parse(JSON.parse(l)))}catch(u){n?n(u):console.error(u),o.manager.itemError(e)}},r,n)},parse:function(e){for(var t=[],r=0;r<e.length;r++){var n=AnimationClip.parse(e[r]);t.push(n)}return t}});function CompressedTextureLoader(e){Loader.call(this,e)}CompressedTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CompressedTextureLoader,load:function(e,t,r,n){var o=this,s=[],l=new CompressedTexture;l.image=s;var u=new FileLoader(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer");function c(y){u.load(e[y],function(A){var M=o.parse(A,!0);s[y]={width:M.width,height:M.height,format:M.format,mipmaps:M.mipmaps},h+=1,h===6&&(M.mipmapCount===1&&(l.minFilter=LinearFilter),l.format=M.format,l.needsUpdate=!0,t&&t(l))},r,n)}if(Array.isArray(e))for(var h=0,f=0,m=e.length;f<m;++f)c(f);else u.load(e,function(y){var A=o.parse(y,!0);if(A.isCubemap)for(var M=A.mipmaps.length/A.mipmapCount,b=0;b<M;b++){s[b]={mipmaps:[]};for(var T=0;T<A.mipmapCount;T++)s[b].mipmaps.push(A.mipmaps[b*A.mipmapCount+T]),s[b].format=A.format,s[b].width=A.width,s[b].height=A.height}else l.image.width=A.width,l.image.height=A.height,l.mipmaps=A.mipmaps;A.mipmapCount===1&&(l.minFilter=LinearFilter),l.format=A.format,l.needsUpdate=!0,t&&t(l)},r,n);return l}});function DataTextureLoader(e){Loader.call(this,e)}DataTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DataTextureLoader,load:function(e,t,r,n){var o=this,s=new DataTexture,l=new FileLoader(this.manager);return l.setResponseType("arraybuffer"),l.setPath(this.path),l.load(e,function(u){var c=o.parse(u);c&&(c.image!==void 0?s.image=c.image:c.data!==void 0&&(s.image.width=c.width,s.image.height=c.height,s.image.data=c.data),s.wrapS=c.wrapS!==void 0?c.wrapS:ClampToEdgeWrapping,s.wrapT=c.wrapT!==void 0?c.wrapT:ClampToEdgeWrapping,s.magFilter=c.magFilter!==void 0?c.magFilter:LinearFilter,s.minFilter=c.minFilter!==void 0?c.minFilter:LinearFilter,s.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.format!==void 0&&(s.format=c.format),c.type!==void 0&&(s.type=c.type),c.mipmaps!==void 0&&(s.mipmaps=c.mipmaps,s.minFilter=LinearMipmapLinearFilter),c.mipmapCount===1&&(s.minFilter=LinearFilter),s.needsUpdate=!0,t&&t(s,c))},r,n),s}});function ImageLoader(e){Loader.call(this,e)}ImageLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageLoader,load:function(e,t,r,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,s=Cache.get(e);if(s!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(s),o.manager.itemEnd(e)},0),s;var l=document.createElementNS("http://www.w3.org/1999/xhtml","img");function u(){l.removeEventListener("load",u,!1),l.removeEventListener("error",c,!1),Cache.add(e,this),t&&t(this),o.manager.itemEnd(e)}function c(h){l.removeEventListener("load",u,!1),l.removeEventListener("error",c,!1),n&&n(h),o.manager.itemError(e),o.manager.itemEnd(e)}return l.addEventListener("load",u,!1),l.addEventListener("error",c,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),o.manager.itemStart(e),l.src=e,l}});function CubeTextureLoader(e){Loader.call(this,e)}CubeTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CubeTextureLoader,load:function(e,t,r,n){var o=new CubeTexture,s=new ImageLoader(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);var l=0;function u(h){s.load(e[h],function(f){o.images[h]=f,l++,l===6&&(o.needsUpdate=!0,t&&t(o))},void 0,n)}for(var c=0;c<e.length;++c)u(c);return o}});function TextureLoader$1(e){Loader.call(this,e)}TextureLoader$1.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TextureLoader$1,load:function(e,t,r,n){var o=new Texture,s=new ImageLoader(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(l){o.image=l;var u=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;o.format=u?RGBFormat:RGBAFormat,o.needsUpdate=!0,t!==void 0&&t(o)},r,n),o}});function Curve(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(Curve.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){e===void 0&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){e===void 0&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e===void 0&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],r,n=this.getPoint(0),o,s=0;for(t.push(0),o=1;o<=e;o++)r=this.getPoint(o/e),s+=r.distanceTo(n),t.push(s),n=r;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r=this.getLengths(),n=0,o=r.length,s;t?s=t:s=e*r[o-1];for(var l=0,u=o-1,c;l<=u;)if(n=Math.floor(l+(u-l)/2),c=r[n]-s,c<0)l=n+1;else if(c>0)u=n-1;else{u=n;break}if(n=u,r[n]===s)return n/(o-1);var h=r[n],f=r[n+1],m=f-h,y=(s-h)/m,A=(n+y)/(o-1);return A},getTangent:function(e,t){var r=1e-4,n=e-r,o=e+r;n<0&&(n=0),o>1&&(o=1);var s=this.getPoint(n),l=this.getPoint(o),u=t||(s.isVector2?new Vector2:new Vector3);return u.copy(l).sub(s).normalize(),u},getTangentAt:function(e,t){var r=this.getUtoTmapping(e);return this.getTangent(r,t)},computeFrenetFrames:function(e,t){var r=new Vector3,n=[],o=[],s=[],l=new Vector3,u=new Matrix4,c,h,f;for(c=0;c<=e;c++)h=c/e,n[c]=this.getTangentAt(h,new Vector3),n[c].normalize();o[0]=new Vector3,s[0]=new Vector3;var m=Number.MAX_VALUE,y=Math.abs(n[0].x),A=Math.abs(n[0].y),M=Math.abs(n[0].z);for(y<=m&&(m=y,r.set(1,0,0)),A<=m&&(m=A,r.set(0,1,0)),M<=m&&r.set(0,0,1),l.crossVectors(n[0],r).normalize(),o[0].crossVectors(n[0],l),s[0].crossVectors(n[0],o[0]),c=1;c<=e;c++)o[c]=o[c-1].clone(),s[c]=s[c-1].clone(),l.crossVectors(n[c-1],n[c]),l.length()>Number.EPSILON&&(l.normalize(),f=Math.acos(MathUtils.clamp(n[c-1].dot(n[c]),-1,1)),o[c].applyMatrix4(u.makeRotationAxis(l,f))),s[c].crossVectors(n[c],o[c]);if(t===!0)for(f=Math.acos(MathUtils.clamp(o[0].dot(o[e]),-1,1)),f/=e,n[0].dot(l.crossVectors(o[0],o[e]))>0&&(f=-f),c=1;c<=e;c++)o[c].applyMatrix4(u.makeRotationAxis(n[c],f*c)),s[c].crossVectors(n[c],o[c]);return{tangents:n,normals:o,binormals:s}},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}});function EllipseCurve(e,t,r,n,o,s,l,u){Curve.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=o||0,this.aEndAngle=s||2*Math.PI,this.aClockwise=l||!1,this.aRotation=u||0}EllipseCurve.prototype=Object.create(Curve.prototype);EllipseCurve.prototype.constructor=EllipseCurve;EllipseCurve.prototype.isEllipseCurve=!0;EllipseCurve.prototype.getPoint=function(e,t){for(var r=t||new Vector2,n=Math.PI*2,o=this.aEndAngle-this.aStartAngle,s=Math.abs(o)<Number.EPSILON;o<0;)o+=n;for(;o>n;)o-=n;o<Number.EPSILON&&(s?o=0:o=n),this.aClockwise===!0&&!s&&(o===n?o=-n:o=o-n);var l=this.aStartAngle+e*o,u=this.aX+this.xRadius*Math.cos(l),c=this.aY+this.yRadius*Math.sin(l);if(this.aRotation!==0){var h=Math.cos(this.aRotation),f=Math.sin(this.aRotation),m=u-this.aX,y=c-this.aY;u=m*h-y*f+this.aX,c=m*f+y*h+this.aY}return r.set(u,c)};EllipseCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this};EllipseCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e};EllipseCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this};function ArcCurve(e,t,r,n,o,s){EllipseCurve.call(this,e,t,r,r,n,o,s),this.type="ArcCurve"}ArcCurve.prototype=Object.create(EllipseCurve.prototype);ArcCurve.prototype.constructor=ArcCurve;ArcCurve.prototype.isArcCurve=!0;function CubicPoly(){var e=0,t=0,r=0,n=0;function o(s,l,u,c){e=s,t=u,r=-3*s+3*l-2*u-c,n=2*s-2*l+u+c}return{initCatmullRom:function(s,l,u,c,h){o(l,u,h*(u-s),h*(c-l))},initNonuniformCatmullRom:function(s,l,u,c,h,f,m){var y=(l-s)/h-(u-s)/(h+f)+(u-l)/f,A=(u-l)/f-(c-l)/(f+m)+(c-u)/m;y*=f,A*=f,o(l,u,y,A)},calc:function(s){var l=s*s,u=l*s;return e+t*s+r*l+n*u}}}var tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;function CatmullRomCurve3(e,t,r,n){Curve.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=n||.5}CatmullRomCurve3.prototype=Object.create(Curve.prototype);CatmullRomCurve3.prototype.constructor=CatmullRomCurve3;CatmullRomCurve3.prototype.isCatmullRomCurve3=!0;CatmullRomCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3,n=this.points,o=n.length,s=(o-(this.closed?0:1))*e,l=Math.floor(s),u=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/o)+1)*o:u===0&&l===o-1&&(l=o-2,u=1);var c,h,f,m;if(this.closed||l>0?c=n[(l-1)%o]:(tmp.subVectors(n[0],n[1]).add(n[0]),c=tmp),h=n[l%o],f=n[(l+1)%o],this.closed||l+2<o?m=n[(l+2)%o]:(tmp.subVectors(n[o-1],n[o-2]).add(n[o-1]),m=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){var y=this.curveType==="chordal"?.5:.25,A=Math.pow(c.distanceToSquared(h),y),M=Math.pow(h.distanceToSquared(f),y),b=Math.pow(f.distanceToSquared(m),y);M<1e-4&&(M=1),A<1e-4&&(A=M),b<1e-4&&(b=M),px.initNonuniformCatmullRom(c.x,h.x,f.x,m.x,A,M,b),py.initNonuniformCatmullRom(c.y,h.y,f.y,m.y,A,M,b),pz.initNonuniformCatmullRom(c.z,h.z,f.z,m.z,A,M,b)}else this.curveType==="catmullrom"&&(px.initCatmullRom(c.x,h.x,f.x,m.x,this.tension),py.initCatmullRom(c.y,h.y,f.y,m.y,this.tension),pz.initCatmullRom(c.z,h.z,f.z,m.z,this.tension));return r.set(px.calc(u),py.calc(u),pz.calc(u)),r};CatmullRomCurve3.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this};CatmullRomCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e};CatmullRomCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(new Vector3().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this};function CatmullRom(e,t,r,n,o){var s=(n-t)*.5,l=(o-r)*.5,u=e*e,c=e*u;return(2*r-2*n+s+l)*c+(-3*r+3*n-2*s-l)*u+s*e+r}function QuadraticBezierP0(e,t){var r=1-e;return r*r*t}function QuadraticBezierP1(e,t){return 2*(1-e)*e*t}function QuadraticBezierP2(e,t){return e*e*t}function QuadraticBezier(e,t,r,n){return QuadraticBezierP0(e,t)+QuadraticBezierP1(e,r)+QuadraticBezierP2(e,n)}function CubicBezierP0(e,t){var r=1-e;return r*r*r*t}function CubicBezierP1(e,t){var r=1-e;return 3*r*r*e*t}function CubicBezierP2(e,t){return 3*(1-e)*e*e*t}function CubicBezierP3(e,t){return e*e*e*t}function CubicBezier(e,t,r,n,o){return CubicBezierP0(e,t)+CubicBezierP1(e,r)+CubicBezierP2(e,n)+CubicBezierP3(e,o)}function CubicBezierCurve(e,t,r,n){Curve.call(this),this.type="CubicBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=r||new Vector2,this.v3=n||new Vector2}CubicBezierCurve.prototype=Object.create(Curve.prototype);CubicBezierCurve.prototype.constructor=CubicBezierCurve;CubicBezierCurve.prototype.isCubicBezierCurve=!0;CubicBezierCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,n=this.v0,o=this.v1,s=this.v2,l=this.v3;return r.set(CubicBezier(e,n.x,o.x,s.x,l.x),CubicBezier(e,n.y,o.y,s.y,l.y)),r};CubicBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this};CubicBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e};CubicBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this};function CubicBezierCurve3(e,t,r,n){Curve.call(this),this.type="CubicBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=r||new Vector3,this.v3=n||new Vector3}CubicBezierCurve3.prototype=Object.create(Curve.prototype);CubicBezierCurve3.prototype.constructor=CubicBezierCurve3;CubicBezierCurve3.prototype.isCubicBezierCurve3=!0;CubicBezierCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3,n=this.v0,o=this.v1,s=this.v2,l=this.v3;return r.set(CubicBezier(e,n.x,o.x,s.x,l.x),CubicBezier(e,n.y,o.y,s.y,l.y),CubicBezier(e,n.z,o.z,s.z,l.z)),r};CubicBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this};CubicBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e};CubicBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this};function LineCurve(e,t){Curve.call(this),this.type="LineCurve",this.v1=e||new Vector2,this.v2=t||new Vector2}LineCurve.prototype=Object.create(Curve.prototype);LineCurve.prototype.constructor=LineCurve;LineCurve.prototype.isLineCurve=!0;LineCurve.prototype.getPoint=function(e,t){var r=t||new Vector2;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r};LineCurve.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};LineCurve.prototype.getTangent=function(e,t){var r=t||new Vector2,r=r.copy(this.v2).sub(this.v1).normalize();return r};LineCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this};LineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};LineCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function LineCurve3(e,t){Curve.call(this),this.type="LineCurve3",this.v1=e||new Vector3,this.v2=t||new Vector3}LineCurve3.prototype=Object.create(Curve.prototype);LineCurve3.prototype.constructor=LineCurve3;LineCurve3.prototype.isLineCurve3=!0;LineCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r};LineCurve3.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};LineCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this};LineCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};LineCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function QuadraticBezierCurve(e,t,r){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=r||new Vector2}QuadraticBezierCurve.prototype=Object.create(Curve.prototype);QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve;QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0;QuadraticBezierCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,n=this.v0,o=this.v1,s=this.v2;return r.set(QuadraticBezier(e,n.x,o.x,s.x),QuadraticBezier(e,n.y,o.y,s.y)),r};QuadraticBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this};QuadraticBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};QuadraticBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function QuadraticBezierCurve3(e,t,r){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=r||new Vector3}QuadraticBezierCurve3.prototype=Object.create(Curve.prototype);QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3;QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0;QuadraticBezierCurve3.prototype.getPoint=function(e,t){var r=t||new Vector3,n=this.v0,o=this.v1,s=this.v2;return r.set(QuadraticBezier(e,n.x,o.x,s.x),QuadraticBezier(e,n.y,o.y,s.y),QuadraticBezier(e,n.z,o.z,s.z)),r};QuadraticBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this};QuadraticBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};QuadraticBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function SplineCurve(e){Curve.call(this),this.type="SplineCurve",this.points=e||[]}SplineCurve.prototype=Object.create(Curve.prototype);SplineCurve.prototype.constructor=SplineCurve;SplineCurve.prototype.isSplineCurve=!0;SplineCurve.prototype.getPoint=function(e,t){var r=t||new Vector2,n=this.points,o=(n.length-1)*e,s=Math.floor(o),l=o-s,u=n[s===0?s:s-1],c=n[s],h=n[s>n.length-2?n.length-1:s+1],f=n[s>n.length-3?n.length-1:s+2];return r.set(CatmullRom(l,u.x,c.x,h.x,f.x),CatmullRom(l,u.y,c.y,h.y,f.y)),r};SplineCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this};SplineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e};SplineCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(new Vector2().fromArray(n))}return this};var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=t){var o=r[n]-t,s=this.curves[n],l=s.getLength(),u=l===0?0:1-o/l;return s.getPointAt(u)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){e===void 0&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t=[],r,n=0,o=this.curves;n<o.length;n++)for(var s=o[n],l=s&&s.isEllipseCurve?e*2:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,u=s.getPoints(l),c=0;c<u.length;c++){var h=u[c];r&&r.equals(h)||(t.push(h),r=h)}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){Curve.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Curve.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){Curve.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push(new Curves[n.type]().fromJSON(n))}return this}});function Path(e){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var r=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,r,n){var o=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,n));return this.curves.push(o),this.currentPoint.set(r,n),this},bezierCurveTo:function(e,t,r,n,o,s){var l=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,n),new Vector2(o,s));return this.curves.push(l),this.currentPoint.set(o,s),this},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e),r=new SplineCurve(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,r,n,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absarc(e+l,t+u,r,n,o,s),this},absarc:function(e,t,r,n,o,s){return this.absellipse(e,t,r,r,n,o,s),this},ellipse:function(e,t,r,n,o,s,l,u){var c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,r,n,o,s,l,u),this},absellipse:function(e,t,r,n,o,s,l,u){var c=new EllipseCurve(e,t,r,n,o,s,l,u);if(this.curves.length>0){var h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);var f=c.getPoint(1);return this.currentPoint.copy(f),this},copy:function(e){return CurvePath.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=CurvePath.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return CurvePath.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}});function Shape(e){Path.call(this,e),this.uuid=MathUtils.generateUUID(),this.type="Shape",this.holes=[]}Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(e){for(var t=[],r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Path.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){var e=Path.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){Path.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push(new Path().fromJSON(n))}return this}});function Light(e,t){Object3D.call(this),this.type="Light",this.color=new Color(e),this.intensity=t!==void 0?t:1,this.receiveShadow=void 0}Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}});function HemisphereLight(e,t,r){Light.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}});function LightShadow(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}Object.assign(LightShadow.prototype,{_projScreenMatrix:new Matrix4,_lightPositionWorld:new Vector3,_lookTarget:new Vector3,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,r=this.matrix,n=this._projScreenMatrix,o=this._lookTarget,s=this._lightPositionWorld;s.setFromMatrixPosition(e.matrixWorld),t.position.copy(s),o.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(o),t.updateMatrixWorld(),n.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e={};return this.bias!==0&&(e.bias=this.bias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}});function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,r=MathUtils.RAD2DEG*2*e.angle,n=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(r!==t.fov||n!==t.aspect||o!==t.far)&&(t.fov=r,t.aspect=n,t.far=o,t.updateProjectionMatrix()),LightShadow.prototype.updateMatrices.call(this,e)}});function SpotLight(e,t,r,n,o,s){Light.call(this,e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(l){this.intensity=l/Math.PI}}),this.distance=r!==void 0?r:0,this.angle=n!==void 0?n:Math.PI/3,this.penumbra=o!==void 0?o:0,this.decay=s!==void 0?s:1,this.shadow=new SpotLightShadow}SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}});function PointLightShadow(){LightShadow.call(this,new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}PointLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:PointLightShadow,isPointLightShadow:!0,updateMatrices:function(e,t){t===void 0&&(t=0);var r=this.camera,n=this.matrix,o=this._lightPositionWorld,s=this._lookTarget,l=this._projScreenMatrix;o.setFromMatrixPosition(e.matrixWorld),r.position.copy(o),s.copy(r.position),s.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(s),r.updateMatrixWorld(),n.makeTranslation(-o.x,-o.y,-o.z),l.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(l)}});function PointLight(e,t,r,n){Light.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(o){this.intensity=o/(4*Math.PI)}}),this.distance=r!==void 0?r:0,this.decay=n!==void 0?n:1,this.shadow=new PointLightShadow}PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}});function OrthographicCamera(e,t,r,n,o,s){Camera$1.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e!==void 0?e:-1,this.right=t!==void 0?t:1,this.top=r!==void 0?r:1,this.bottom=n!==void 0?n:-1,this.near=o!==void 0?o:.1,this.far=s!==void 0?s:2e3,this.updateProjectionMatrix()}OrthographicCamera.prototype=Object.assign(Object.create(Camera$1.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(e,t){return Camera$1.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,n,o,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,o=r-e,s=r+e,l=n+t,u=n-t;if(this.view!==null&&this.view.enabled){var c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=c*this.view.offsetX,s=o+c*this.view.width,l-=h*this.view.offsetY,u=l-h*this.view.height}this.projectionMatrix.makeOrthographic(o,s,l,u,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}});function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow,isDirectionalLightShadow:!0,updateMatrices:function(e){LightShadow.prototype.updateMatrices.call(this,e)}});function DirectionalLight(e,t){Light.call(this,e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}});function AmbientLight(e,t){Light.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0});function RectAreaLight(e,t,r,n){Light.call(this,e,t),this.type="RectAreaLight",this.width=r!==void 0?r:10,this.height=n!==void 0?n:10}RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Light.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});function SphericalHarmonics3(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new Vector3)}Object.assign(SphericalHarmonics3.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var r=e.x,n=e.y,o=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*n),t.addScaledVector(s[2],.488603*o),t.addScaledVector(s[3],.488603*r),t.addScaledVector(s[4],1.092548*(r*n)),t.addScaledVector(s[5],1.092548*(n*o)),t.addScaledVector(s[6],.315392*(3*o*o-1)),t.addScaledVector(s[7],1.092548*(r*o)),t.addScaledVector(s[8],.546274*(r*r-n*n)),t},getIrradianceAt:function(e,t){var r=e.x,n=e.y,o=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],2*.511664*n),t.addScaledVector(s[2],2*.511664*o),t.addScaledVector(s[3],2*.511664*r),t.addScaledVector(s[4],2*.429043*r*n),t.addScaledVector(s[5],2*.429043*n*o),t.addScaledVector(s[6],.743125*o*o-.247708),t.addScaledVector(s[7],2*.429043*r*o),t.addScaledVector(s[8],.429043*(r*r-n*n)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},addScaledSH:function(e,t){for(var r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(e,t){t===void 0&&(t=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].fromArray(e,t+n*3);return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].toArray(e,t+n*3);return e}});Object.assign(SphericalHarmonics3,{getBasisAt:function(e,t){var r=e.x,n=e.y,o=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*o,t[3]=.488603*r,t[4]=1.092548*r*n,t[5]=1.092548*n*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*r*o,t[8]=.546274*(r*r-n*n)}});function LightProbe(e,t){Light.call(this,void 0,t),this.type="LightProbe",this.sh=e!==void 0?e:new SphericalHarmonics3}LightProbe.prototype=Object.assign(Object.create(Light.prototype),{constructor:LightProbe,isLightProbe:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){var t=Light.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}});function MaterialLoader(e){Loader.call(this,e),this.textures={}}MaterialLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MaterialLoader,load:function(e,t,r,n){var o=this,s=new FileLoader(o.manager);s.setPath(o.path),s.load(e,function(l){try{t(o.parse(JSON.parse(l)))}catch(u){n?n(u):console.error(u),o.manager.itemError(e)}},r,n)},parse:function(e){var t=this.textures;function r(c){return t[c]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",c),t[c]}var n=new Materials[e.type];if(e.uuid!==void 0&&(n.uuid=e.uuid),e.name!==void 0&&(n.name=e.name),e.color!==void 0&&n.color.setHex(e.color),e.roughness!==void 0&&(n.roughness=e.roughness),e.metalness!==void 0&&(n.metalness=e.metalness),e.sheen!==void 0&&(n.sheen=new Color().setHex(e.sheen)),e.emissive!==void 0&&n.emissive.setHex(e.emissive),e.specular!==void 0&&n.specular.setHex(e.specular),e.shininess!==void 0&&(n.shininess=e.shininess),e.clearcoat!==void 0&&(n.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=e.clearcoatRoughness),e.fog!==void 0&&(n.fog=e.fog),e.flatShading!==void 0&&(n.flatShading=e.flatShading),e.blending!==void 0&&(n.blending=e.blending),e.combine!==void 0&&(n.combine=e.combine),e.side!==void 0&&(n.side=e.side),e.opacity!==void 0&&(n.opacity=e.opacity),e.transparent!==void 0&&(n.transparent=e.transparent),e.alphaTest!==void 0&&(n.alphaTest=e.alphaTest),e.depthTest!==void 0&&(n.depthTest=e.depthTest),e.depthWrite!==void 0&&(n.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(n.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(n.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(n.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(n.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(n.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(n.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(n.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(n.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(n.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(n.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(n.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(n.rotation=e.rotation),e.linewidth!==1&&(n.linewidth=e.linewidth),e.dashSize!==void 0&&(n.dashSize=e.dashSize),e.gapSize!==void 0&&(n.gapSize=e.gapSize),e.scale!==void 0&&(n.scale=e.scale),e.polygonOffset!==void 0&&(n.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=e.polygonOffsetUnits),e.skinning!==void 0&&(n.skinning=e.skinning),e.morphTargets!==void 0&&(n.morphTargets=e.morphTargets),e.morphNormals!==void 0&&(n.morphNormals=e.morphNormals),e.dithering!==void 0&&(n.dithering=e.dithering),e.vertexTangents!==void 0&&(n.vertexTangents=e.vertexTangents),e.visible!==void 0&&(n.visible=e.visible),e.toneMapped!==void 0&&(n.toneMapped=e.toneMapped),e.userData!==void 0&&(n.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),e.uniforms!==void 0)for(var o in e.uniforms){var s=e.uniforms[o];switch(n.uniforms[o]={},s.type){case"t":n.uniforms[o].value=r(s.value);break;case"c":n.uniforms[o].value=new Color().setHex(s.value);break;case"v2":n.uniforms[o].value=new Vector2().fromArray(s.value);break;case"v3":n.uniforms[o].value=new Vector3().fromArray(s.value);break;case"v4":n.uniforms[o].value=new Vector4().fromArray(s.value);break;case"m3":n.uniforms[o].value=new Matrix3().fromArray(s.value);case"m4":n.uniforms[o].value=new Matrix4().fromArray(s.value);break;default:n.uniforms[o].value=s.value}}if(e.defines!==void 0&&(n.defines=e.defines),e.vertexShader!==void 0&&(n.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(n.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(var l in e.extensions)n.extensions[l]=e.extensions[l];if(e.shading!==void 0&&(n.flatShading=e.shading===1),e.size!==void 0&&(n.size=e.size),e.sizeAttenuation!==void 0&&(n.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(n.map=r(e.map)),e.matcap!==void 0&&(n.matcap=r(e.matcap)),e.alphaMap!==void 0&&(n.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(n.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(n.bumpScale=e.bumpScale),e.normalMap!==void 0&&(n.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(n.normalMapType=e.normalMapType),e.normalScale!==void 0){var u=e.normalScale;Array.isArray(u)===!1&&(u=[u,u]),n.normalScale=new Vector2().fromArray(u)}return e.displacementMap!==void 0&&(n.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(n.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(n.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(n.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(n.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(n.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(n.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(n.specularMap=r(e.specularMap)),e.envMap!==void 0&&(n.envMap=r(e.envMap)),e.envMapIntensity!==void 0&&(n.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(n.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(n.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(n.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(n.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(n.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(n.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(n.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(n.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new Vector2().fromArray(e.clearcoatNormalScale)),n},setTextures:function(e){return this.textures=e,this}});var LoaderUtils={decodeText:function(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}};function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(e){return BufferGeometry.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e=BufferGeometry.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}});function InstancedBufferAttribute(e,t,r,n){typeof r=="number"&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,e,t,r),this.meshPerAttribute=n||1}InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(e){return BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=BufferAttribute.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}});function BufferGeometryLoader(e){Loader.call(this,e)}BufferGeometryLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BufferGeometryLoader,load:function(e,t,r,n){var o=this,s=new FileLoader(o.manager);s.setPath(o.path),s.load(e,function(l){try{t(o.parse(JSON.parse(l)))}catch(u){n?n(u):console.error(u),o.manager.itemError(e)}},r,n)},parse:function(e){var t=e.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,r=e.data.index;if(r!==void 0){var n=new TYPED_ARRAYS[r.type](r.array);t.setIndex(new BufferAttribute(n,1))}var o=e.data.attributes;for(var s in o){var l=o[s],n=new TYPED_ARRAYS[l.type](l.array),u=l.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute,c=new u(n,l.itemSize,l.normalized);l.name!==void 0&&(c.name=l.name),t.setAttribute(s,c)}var h=e.data.morphAttributes;if(h)for(var s in h){for(var f=h[s],m=[],y=0,A=f.length;y<A;y++){var l=f[y],n=new TYPED_ARRAYS[l.type](l.array),c=new BufferAttribute(n,l.itemSize,l.normalized);l.name!==void 0&&(c.name=l.name),m.push(c)}t.morphAttributes[s]=m}var M=e.data.morphTargetsRelative;M&&(t.morphTargetsRelative=!0);var b=e.data.groups||e.data.drawcalls||e.data.offsets;if(b!==void 0)for(var y=0,T=b.length;y!==T;++y){var _=b[y];t.addGroup(_.start,_.count,_.materialIndex)}var S=e.data.boundingSphere;if(S!==void 0){var C=new Vector3;S.center!==void 0&&C.fromArray(S.center),t.boundingSphere=new Sphere(C,S.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ObjectLoader(e){Loader.call(this,e)}ObjectLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ObjectLoader,load:function(e,t,r,n){var o=this,s=this.path===""?LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;var l=new FileLoader(o.manager);l.setPath(this.path),l.load(e,function(u){var c=null;try{c=JSON.parse(u)}catch(f){n!==void 0&&n(f),console.error("THREE:ObjectLoader: Can't parse "+e+".",f.message);return}var h=c.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}o.parse(c,t)},r,n)},parse:function(e,t){var r=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){t!==void 0&&t(u)}),s=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,s),u=this.parseObject(e.object,n,l);return e.animations&&(u.animations=this.parseAnimations(e.animations)),(e.images===void 0||e.images.length===0)&&t!==void 0&&t(u),u},parseShape:function(e){var t={};if(e!==void 0)for(var r=0,n=e.length;r<n;r++){var o=new Shape().fromJSON(e[r]);t[o.uuid]=o}return t},parseGeometries:function(e,t){var r={};if(e!==void 0)for(var n=new BufferGeometryLoader,o=0,s=e.length;o<s;o++){var l,u=e[o];switch(u.type){case"PlaneGeometry":case"PlaneBufferGeometry":l=new Geometries[u.type](u.width,u.height,u.widthSegments,u.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":l=new Geometries[u.type](u.width,u.height,u.depth,u.widthSegments,u.heightSegments,u.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":l=new Geometries[u.type](u.radius,u.segments,u.thetaStart,u.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":l=new Geometries[u.type](u.radiusTop,u.radiusBottom,u.height,u.radialSegments,u.heightSegments,u.openEnded,u.thetaStart,u.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":l=new Geometries[u.type](u.radius,u.height,u.radialSegments,u.heightSegments,u.openEnded,u.thetaStart,u.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":l=new Geometries[u.type](u.radius,u.widthSegments,u.heightSegments,u.phiStart,u.phiLength,u.thetaStart,u.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":l=new Geometries[u.type](u.radius,u.detail);break;case"RingGeometry":case"RingBufferGeometry":l=new Geometries[u.type](u.innerRadius,u.outerRadius,u.thetaSegments,u.phiSegments,u.thetaStart,u.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":l=new Geometries[u.type](u.radius,u.tube,u.radialSegments,u.tubularSegments,u.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":l=new Geometries[u.type](u.radius,u.tube,u.tubularSegments,u.radialSegments,u.p,u.q);break;case"TubeGeometry":case"TubeBufferGeometry":l=new Geometries[u.type](new Curves[u.path.type]().fromJSON(u.path),u.tubularSegments,u.radius,u.radialSegments,u.closed);break;case"LatheGeometry":case"LatheBufferGeometry":l=new Geometries[u.type](u.points,u.segments,u.phiStart,u.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":l=new Geometries[u.type](u.vertices,u.indices,u.radius,u.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var m=[],c=0,h=u.shapes.length;c<h;c++){var f=t[u.shapes[c]];m.push(f)}l=new Geometries[u.type](m,u.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(var m=[],c=0,h=u.shapes.length;c<h;c++){var f=t[u.shapes[c]];m.push(f)}var y=u.options.extrudePath;y!==void 0&&(u.options.extrudePath=new Curves[y.type]().fromJSON(y)),l=new Geometries[u.type](m,u.options);break;case"BufferGeometry":case"InstancedBufferGeometry":l=n.parse(u);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+u.type+'"');continue}l.uuid=u.uuid,u.name!==void 0&&(l.name=u.name),l.isBufferGeometry===!0&&u.userData!==void 0&&(l.userData=u.userData),r[u.uuid]=l}return r},parseMaterials:function(e,t){var r={},n={};if(e!==void 0){var o=new MaterialLoader;o.setTextures(t);for(var s=0,l=e.length;s<l;s++){var u=e[s];if(u.type==="MultiMaterial"){for(var c=[],h=0;h<u.materials.length;h++){var f=u.materials[h];r[f.uuid]===void 0&&(r[f.uuid]=o.parse(f)),c.push(r[f.uuid])}n[u.uuid]=c}else r[u.uuid]===void 0&&(r[u.uuid]=o.parse(u)),n[u.uuid]=r[u.uuid]}}return n},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],o=AnimationClip.parse(n);n.uuid!==void 0&&(o.uuid=n.uuid),t.push(o)}return t},parseImages:function(e,t){var r=this,n={};function o(b){return r.manager.itemStart(b),l.load(b,function(){r.manager.itemEnd(b)},void 0,function(){r.manager.itemError(b),r.manager.itemEnd(b)})}if(e!==void 0&&e.length>0){var s=new LoadingManager(t),l=new ImageLoader(s);l.setCrossOrigin(this.crossOrigin);for(var u=0,c=e.length;u<c;u++){var h=e[u],f=h.url;if(Array.isArray(f)){n[h.uuid]=[];for(var m=0,y=f.length;m<y;m++){var A=f[m],M=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(A)?A:r.resourcePath+A;n[h.uuid].push(o(M))}}else{var M=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h.url)?h.url:r.resourcePath+h.url;n[h.uuid]=o(M)}}}return n},parseTextures:function(e,t){function r(c,h){return typeof c=="number"?c:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",c),h[c])}var n={};if(e!==void 0)for(var o=0,s=e.length;o<s;o++){var l=e[o];l.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',l.uuid),t[l.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",l.image);var u;Array.isArray(t[l.image])?u=new CubeTexture(t[l.image]):u=new Texture(t[l.image]),u.needsUpdate=!0,u.uuid=l.uuid,l.name!==void 0&&(u.name=l.name),l.mapping!==void 0&&(u.mapping=r(l.mapping,TEXTURE_MAPPING)),l.offset!==void 0&&u.offset.fromArray(l.offset),l.repeat!==void 0&&u.repeat.fromArray(l.repeat),l.center!==void 0&&u.center.fromArray(l.center),l.rotation!==void 0&&(u.rotation=l.rotation),l.wrap!==void 0&&(u.wrapS=r(l.wrap[0],TEXTURE_WRAPPING),u.wrapT=r(l.wrap[1],TEXTURE_WRAPPING)),l.format!==void 0&&(u.format=l.format),l.type!==void 0&&(u.type=l.type),l.encoding!==void 0&&(u.encoding=l.encoding),l.minFilter!==void 0&&(u.minFilter=r(l.minFilter,TEXTURE_FILTER)),l.magFilter!==void 0&&(u.magFilter=r(l.magFilter,TEXTURE_FILTER)),l.anisotropy!==void 0&&(u.anisotropy=l.anisotropy),l.flipY!==void 0&&(u.flipY=l.flipY),l.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=l.premultiplyAlpha),l.unpackAlignment!==void 0&&(u.unpackAlignment=l.unpackAlignment),n[l.uuid]=u}return n},parseObject:function(e,t,r){var n;function o(T){return t[T]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",T),t[T]}function s(T){if(T!==void 0){if(Array.isArray(T)){for(var _=[],S=0,C=T.length;S<C;S++){var P=T[S];r[P]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",P),_.push(r[P])}return _}return r[T]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",T),r[T]}}switch(e.type){case"Scene":n=new Scene$1,e.background!==void 0&&Number.isInteger(e.background)&&(n.background=new Color(e.background)),e.fog!==void 0&&(e.fog.type==="Fog"?n.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(n.fog=new FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(n.focus=e.focus),e.zoom!==void 0&&(n.zoom=e.zoom),e.filmGauge!==void 0&&(n.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(n.filmOffset=e.filmOffset),e.view!==void 0&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(n.zoom=e.zoom),e.view!==void 0&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":n=new DirectionalLight(e.color,e.intensity);break;case"PointLight":n=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":n=new LightProbe().fromJSON(e);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var l=o(e.geometry),u=s(e.material);n=new Mesh(l,u);break;case"InstancedMesh":var l=o(e.geometry),u=s(e.material),c=e.count,h=e.instanceMatrix;n=new InstancedMesh(l,u,c),n.instanceMatrix=new BufferAttribute(new Float32Array(h.array),16);break;case"LOD":n=new LOD;break;case"Line":n=new Line(o(e.geometry),s(e.material),e.mode);break;case"LineLoop":n=new LineLoop(o(e.geometry),s(e.material));break;case"LineSegments":n=new LineSegments(o(e.geometry),s(e.material));break;case"PointCloud":case"Points":n=new Points(o(e.geometry),s(e.material));break;case"Sprite":n=new Sprite(s(e.material));break;case"Group":n=new Group;break;default:n=new Object3D}if(n.uuid=e.uuid,e.name!==void 0&&(n.name=e.name),e.matrix!==void 0?(n.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(n.matrixAutoUpdate=e.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(e.position!==void 0&&n.position.fromArray(e.position),e.rotation!==void 0&&n.rotation.fromArray(e.rotation),e.quaternion!==void 0&&n.quaternion.fromArray(e.quaternion),e.scale!==void 0&&n.scale.fromArray(e.scale)),e.castShadow!==void 0&&(n.castShadow=e.castShadow),e.receiveShadow!==void 0&&(n.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(n.shadow.bias=e.shadow.bias),e.shadow.radius!==void 0&&(n.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&n.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(n.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(n.visible=e.visible),e.frustumCulled!==void 0&&(n.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(n.renderOrder=e.renderOrder),e.userData!==void 0&&(n.userData=e.userData),e.layers!==void 0&&(n.layers.mask=e.layers),e.children!==void 0)for(var f=e.children,m=0;m<f.length;m++)n.add(this.parseObject(f[m],t,r));if(e.type==="LOD"){e.autoUpdate!==void 0&&(n.autoUpdate=e.autoUpdate);for(var y=e.levels,A=0;A<y.length;A++){var M=y[A],b=n.getObjectByProperty("uuid",M.object);b!==void 0&&n.addLevel(b,M.distance)}}return n}});var TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,SphericalReflectionMapping,CubeUVReflectionMapping,CubeUVRefractionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter};function ImageBitmapLoader(e){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Loader.call(this,e),this.options=void 0}ImageBitmapLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageBitmapLoader,setOptions:function(t){return this.options=t,this},load:function(e,t,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,s=Cache.get(e);if(s!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(s),o.manager.itemEnd(e)},0),s;fetch(e).then(function(l){return l.blob()}).then(function(l){return o.options===void 0?createImageBitmap(l):createImageBitmap(l,o.options)}).then(function(l){Cache.add(e,l),t&&t(l),o.manager.itemEnd(e)}).catch(function(l){n&&n(l),o.manager.itemError(e),o.manager.itemEnd(e)}),o.manager.itemStart(e)}});function ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}Object.assign(ShapePath.prototype,{moveTo:function(e,t){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,r,n){return this.currentPath.quadraticCurveTo(e,t,r,n),this},bezierCurveTo:function(e,t,r,n,o,s){return this.currentPath.bezierCurveTo(e,t,r,n,o,s),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function r(G){for(var te=[],X=0,K=G.length;X<K;X++){var Z=G[X],ee=new Shape;ee.curves=Z.curves,te.push(ee)}return te}function n(G,te){for(var X=te.length,K=!1,Z=X-1,ee=0;ee<X;Z=ee++){var j=te[Z],re=te[ee],pe=re.x-j.x,ge=re.y-j.y;if(Math.abs(ge)>Number.EPSILON){if(ge<0&&(j=te[ee],pe=-pe,re=te[Z],ge=-ge),G.y<j.y||G.y>re.y)continue;if(G.y===j.y){if(G.x===j.x)return!0}else{var _e=ge*(G.x-j.x)-pe*(G.y-j.y);if(_e===0)return!0;if(_e<0)continue;K=!K}}else{if(G.y!==j.y)continue;if(re.x<=G.x&&G.x<=j.x||j.x<=G.x&&G.x<=re.x)return!0}}return K}var o=ShapeUtils.isClockWise,s=this.subPaths;if(s.length===0)return[];if(t===!0)return r(s);var l,u,c,h=[];if(s.length===1)return u=s[0],c=new Shape,c.curves=u.curves,h.push(c),h;var f=!o(s[0].getPoints());f=e?!f:f;var m=[],y=[],A=[],M=0,b;y[M]=void 0,A[M]=[];for(var T=0,_=s.length;T<_;T++)u=s[T],b=u.getPoints(),l=o(b),l=e?!l:l,l?(!f&&y[M]&&M++,y[M]={s:new Shape,p:b},y[M].s.curves=u.curves,f&&M++,A[M]=[]):A[M].push({h:u,p:b[0]});if(!y[0])return r(s);if(y.length>1){for(var S=!1,C=[],P=0,F=y.length;P<F;P++)m[P]=[];for(var P=0,F=y.length;P<F;P++)for(var O=A[P],N=0;N<O.length;N++){for(var V=O[N],q=!0,Q=0;Q<y.length;Q++)n(V.p,y[Q].p)&&(P!==Q&&C.push({froms:P,tos:Q,hole:N}),q?(q=!1,m[Q].push(V)):S=!0);q&&m[P].push(V)}C.length>0&&(S||(A=m))}for(var z,T=0,H=y.length;T<H;T++){c=y[T].s,h.push(c),z=A[T];for(var W=0,J=z.length;W<J;W++)c.holes.push(z[W].h)}return h}});function Font(e){this.type="Font",this.data=e}Object.assign(Font.prototype,{isFont:!0,generateShapes:function(e,t){t===void 0&&(t=100);for(var r=[],n=createPaths(e,t,this.data),o=0,s=n.length;o<s;o++)Array.prototype.push.apply(r,n[o].toShapes());return r}});function createPaths(e,t,r){for(var n=Array.from?Array.from(e):String(e).split(""),o=t/r.resolution,s=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*o,l=[],u=0,c=0,h=0;h<n.length;h++){var f=n[h];if(f===`
`)u=0,c-=s;else{var m=createPath(f,o,u,c,r);u+=m.offsetX,l.push(m.path)}}return l}function createPath(e,t,r,n,o){var s=o.glyphs[e]||o.glyphs["?"];if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+o.familyName+".");return}var l=new ShapePath,u,c,h,f,m,y,A,M;if(s.o)for(var b=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),T=0,_=b.length;T<_;){var S=b[T++];switch(S){case"m":u=b[T++]*t+r,c=b[T++]*t+n,l.moveTo(u,c);break;case"l":u=b[T++]*t+r,c=b[T++]*t+n,l.lineTo(u,c);break;case"q":h=b[T++]*t+r,f=b[T++]*t+n,m=b[T++]*t+r,y=b[T++]*t+n,l.quadraticCurveTo(m,y,h,f);break;case"b":h=b[T++]*t+r,f=b[T++]*t+n,m=b[T++]*t+r,y=b[T++]*t+n,A=b[T++]*t+r,M=b[T++]*t+n,l.bezierCurveTo(m,y,A,M,h,f);break}}return{offsetX:s.ha*t,path:l}}function FontLoader(e){Loader.call(this,e)}FontLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FontLoader,load:function(e,t,r,n){var o=this,s=new FileLoader(this.manager);s.setPath(this.path),s.load(e,function(l){var u;try{u=JSON.parse(l)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),u=JSON.parse(l.substring(65,l.length-2))}var c=o.parse(u);t&&t(c)},r,n)},parse:function(e){return new Font(e)}});var _context,AudioContext={getContext:function(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context},setContext:function(e){_context=e}};function AudioLoader(e){Loader.call(this,e)}AudioLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AudioLoader,load:function(e,t,r,n){var o=this,s=new FileLoader(o.manager);s.setResponseType("arraybuffer"),s.setPath(o.path),s.load(e,function(l){try{var u=l.slice(0),c=AudioContext.getContext();c.decodeAudioData(u,function(h){t(h)})}catch(h){n?n(h):console.error(h),o.manager.itemError(e)}},r,n)}});function HemisphereLightProbe(e,t,r){LightProbe.call(this,void 0,r);var n=new Color().set(e),o=new Color().set(t),s=new Vector3(n.r,n.g,n.b),l=new Vector3(o.r,o.g,o.b),u=Math.sqrt(Math.PI),c=u*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(l).multiplyScalar(u),this.sh.coefficients[1].copy(s).sub(l).multiplyScalar(c)}HemisphereLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:HemisphereLightProbe,isHemisphereLightProbe:!0,copy:function(e){return LightProbe.prototype.copy.call(this,e),this},toJSON:function(e){var t=LightProbe.prototype.toJSON.call(this,e);return t}});function AmbientLightProbe(e,t){LightProbe.call(this,void 0,t);var r=new Color().set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}AmbientLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:AmbientLightProbe,isAmbientLightProbe:!0,copy:function(e){return LightProbe.prototype.copy.call(this,e),this},toJSON:function(e){var t=LightProbe.prototype.toJSON.call(this,e);return t}});var _eyeRight=new Matrix4,_eyeLeft=new Matrix4;function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(StereoCamera.prototype,{update:function(e){var t=this._cache,r=t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep;if(r){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n=e.projectionMatrix.clone(),o=t.eyeSep/2,s=o*t.near/t.focus,l=t.near*Math.tan(MathUtils.DEG2RAD*t.fov*.5)/t.zoom,u,c;_eyeLeft.elements[12]=-o,_eyeRight.elements[12]=o,u=-l*t.aspect+s,c=l*t.aspect+s,n.elements[0]=2*t.near/(c-u),n.elements[8]=(c+u)/(c-u),this.cameraL.projectionMatrix.copy(n),u=-l*t.aspect-s,c=l*t.aspect-s,n.elements[0]=2*t.near/(c-u),n.elements[8]=(c+u)/(c-u),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_eyeRight)}});function Clock(e){this.autoStart=e!==void 0?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Clock.prototype,{start:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=(typeof performance>"u"?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var _position$2=new Vector3,_quaternion$3=new Quaternion,_scale$1=new Vector3,_orientation=new Vector3;function AudioListener(){Object3D.call(this),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function(){return this.gain},removeFilter:function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$2,_quaternion$3,_scale$1),_orientation.set(0,0,-1).applyQuaternion(_quaternion$3),t.positionX){var n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(_position$2.x,n),t.positionY.linearRampToValueAtTime(_position$2.y,n),t.positionZ.linearRampToValueAtTime(_position$2.z,n),t.forwardX.linearRampToValueAtTime(_orientation.x,n),t.forwardY.linearRampToValueAtTime(_orientation.y,n),t.forwardZ.linearRampToValueAtTime(_orientation.z,n),t.upX.linearRampToValueAtTime(r.x,n),t.upY.linearRampToValueAtTime(r.y,n),t.upZ.linearRampToValueAtTime(r.z,n)}else t.setPosition(_position$2.x,_position$2.y,_position$2.z),t.setOrientation(_orientation.x,_orientation.y,_orientation.z,r.x,r.y,r.z)}});function Audio(e){Object3D.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._progress=0,this.filters=[]}Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(e===void 0&&(e=0),this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this},stop:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),this.isPlaying===!0?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var _position$3=new Vector3,_quaternion$4=new Quaternion,_scale$2=new Vector3,_orientation$1=new Vector3;function PositionalAudio(e){Audio.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(e){if(Object3D.prototype.updateMatrixWorld.call(this,e),!(this.hasPlaybackControl===!0&&this.isPlaying===!1)){this.matrixWorld.decompose(_position$3,_quaternion$4,_scale$2),_orientation$1.set(0,0,1).applyQuaternion(_quaternion$4);var t=this.panner;if(t.positionX){var r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(_position$3.x,r),t.positionY.linearRampToValueAtTime(_position$3.y,r),t.positionZ.linearRampToValueAtTime(_position$3.z,r),t.orientationX.linearRampToValueAtTime(_orientation$1.x,r),t.orientationY.linearRampToValueAtTime(_orientation$1.y,r),t.orientationZ.linearRampToValueAtTime(_orientation$1.z,r)}else t.setPosition(_position$3.x,_position$3.y,_position$3.z),t.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z)}}});function AudioAnalyser(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t!==void 0?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}Object.assign(AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}});function PropertyMixer(e,t,r){this.binding=e,this.valueSize=r;var n,o,s;switch(t){case"quaternion":n=this._slerp,o=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":n=this._select,o=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:n=this._lerp,o=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=o,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(PropertyMixer.prototype,{accumulate:function(e,t){var r=this.buffer,n=this.valueSize,o=e*n+n,s=this.cumulativeWeight;if(s===0){for(var l=0;l!==n;++l)r[o+l]=r[l];s=t}else{s+=t;var u=t/s;this._mixBufferRegion(r,o,0,u,n)}this.cumulativeWeight=s},accumulateAdditive:function(e){var t=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,r),this.cumulativeWeightAdditive+=e},apply:function(e){var t=this.valueSize,r=this.buffer,n=e*t+t,o=this.cumulativeWeight,s=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){var u=t*this._origIndex;this._mixBufferRegion(r,n,u,1-o,t)}s>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*t,1,t);for(var c=t,h=t+t;c!==h;++c)if(r[c]!==r[c+t]){l.setValue(r,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,n=r*this._origIndex;e.getValue(t,n);for(var o=r,s=n;o!==s;++o)t[o]=t[n+o%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var e=this.valueSize*3;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,r=e;r<t;r++)this.buffer[r]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*4+3]=1},_setAdditiveIdentityOther:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]},_select:function(e,t,r,n,o){if(n>=.5)for(var s=0;s!==o;++s)e[t+s]=e[r+s]},_slerp:function(e,t,r,n){Quaternion.slerpFlat(e,t,e,t,e,r,n)},_slerpAdditive:function(e,t,r,n,o){var s=this._workIndex*o;Quaternion.multiplyQuaternionsFlat(e,s,e,t,e,r),Quaternion.slerpFlat(e,t,e,t,e,s,n)},_lerp:function(e,t,r,n,o){for(var s=1-n,l=0;l!==o;++l){var u=t+l;e[u]=e[u]*s+e[r+l]*n}},_lerpAdditive:function(e,t,r,n,o){for(var s=0;s!==o;++s){var l=t+s;e[l]=e[l]+e[r+s]*n}}});var _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones"];function Composite(e,t,r){var n=r||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}Object.assign(Composite.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,o=r.length;n!==o;++n)r[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}});function PropertyBinding(e,t,r){this.path=t,this.parsedPath=r||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(PropertyBinding,{Composite,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,r):new PropertyBinding(e,t,r)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(_reservedRe,"")},parseTrackName:function(e){var t=_trackRe.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){var o=r.nodeName.substring(n+1);_supportedObjectNames.indexOf(o)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=o)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r},findNode:function(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){var n=function(s){for(var l=0;l<s.length;l++){var u=s[l];if(u.name===t||u.uuid===t)return u;var c=n(u.children);if(c)return c}return null},o=n(e.children);if(o)return o}return null}});Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,r){t[r]=this.node[this.propertyName]},function(t,r){for(var n=this.resolvedProperty,o=0,s=n.length;o!==s;++o)t[r++]=n[o]},function(t,r){t[r]=this.resolvedProperty[this.propertyIndex]},function(t,r){this.resolvedProperty.toArray(t,r)}],SetterByBindingTypeAndVersioning:[[function(t,r){this.targetObject[this.propertyName]=t[r]},function(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.needsUpdate=!0},function(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,r){for(var n=this.resolvedProperty,o=0,s=n.length;o!==s;++o)n[o]=t[r++]},function(t,r){for(var n=this.resolvedProperty,o=0,s=n.length;o!==s;++o)n[o]=t[r++];this.targetObject.needsUpdate=!0},function(t,r){for(var n=this.resolvedProperty,o=0,s=n.length;o!==s;++o)n[o]=t[r++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,r){this.resolvedProperty[this.propertyIndex]=t[r]},function(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.needsUpdate=!0},function(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,r){this.resolvedProperty.fromArray(t,r)},function(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.needsUpdate=!0},function(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,r){this.bind(),this.getValue(t,r)},setValue:function(t,r){this.bind(),this.setValue(t,r)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,o=t.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){var s=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(var l=0;l<e.length;l++)if(e[l].name===s){s=l;break}break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(s!==void 0){if(e[s]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[s]}}var u=e[n];if(u===void 0){var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}var h=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?h=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(h=this.Versioning.MatrixWorldNeedsUpdate);var f=this.BindingType.Direct;if(o!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}f=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=o}else u.fromArray!==void 0&&u.toArray!==void 0?(f=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(f=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=n;this.getValue=this.GetterByBindingType[f],this.setValue=this.SetterByBindingTypeAndVersioning[f][h]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}});Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue});function AnimationObjectGroup(){this.uuid=MathUtils.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,o=this._paths,s=this._parsedPaths,l=this._bindings,u=l.length,c=void 0,h=0,f=arguments.length;h!==f;++h){var m=arguments[h],y=m.uuid,A=n[y];if(A===void 0){A=t++,n[y]=A,e.push(m);for(var M=0,b=u;M!==b;++M)l[M].push(new PropertyBinding(m,o[M],s[M]))}else if(A<r){c=e[A];var T=--r,_=e[T];n[_.uuid]=A,e[A]=_,n[y]=T,e[T]=m;for(var M=0,b=u;M!==b;++M){var S=l[M],C=S[T],P=S[A];S[A]=C,P===void 0&&(P=new PropertyBinding(m,o[M],s[M])),S[T]=P}}else e[A]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,o=n.length,s=0,l=arguments.length;s!==l;++s){var u=arguments[s],c=u.uuid,h=r[c];if(h!==void 0&&h>=t){var f=t++,m=e[f];r[m.uuid]=h,e[h]=m,r[c]=f,e[f]=u;for(var y=0,A=o;y!==A;++y){var M=n[y],b=M[f],T=M[h];M[h]=b,M[f]=T}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,o=this._bindings,s=o.length,l=0,u=arguments.length;l!==u;++l){var c=arguments[l],h=c.uuid,f=n[h];if(f!==void 0)if(delete n[h],f<r){var m=--r,y=e[m],A=--t,M=e[A];n[y.uuid]=f,e[f]=y,n[M.uuid]=m,e[m]=M,e.pop();for(var b=0,T=s;b!==T;++b){var _=o[b],S=_[m],C=_[A];_[f]=S,_[m]=C,_.pop()}}else{var A=--t,M=e[A];n[M.uuid]=f,e[f]=M,e.pop();for(var b=0,T=s;b!==T;++b){var _=o[b];_[f]=_[A],_.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,n=r[e],o=this._bindings;if(n!==void 0)return o[n];var s=this._paths,l=this._parsedPaths,u=this._objects,c=u.length,h=this.nCachedObjects_,f=new Array(c);n=o.length,r[e]=n,s.push(e),l.push(t),o.push(f);for(var m=h,y=u.length;m!==y;++m){var A=u[m];f[m]=new PropertyBinding(A,e,t)}return f},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(r!==void 0){var n=this._paths,o=this._parsedPaths,s=this._bindings,l=s.length-1,u=s[l],c=e[l];t[c]=r,s[r]=u,s.pop(),o[r]=o[l],o.pop(),n[r]=n[l],n.pop()}}});function AnimationAction(e,t,r,n){this._mixer=e,this._clip=t,this._localRoot=r||null,this.blendMode=n||t.blendMode;for(var o=t.tracks,s=o.length,l=new Array(s),u={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},c=0;c!==s;++c){var h=o[c].createInterpolant(null);l[c]=h,h.settings=u}this._interpolantSettings=u,this._interpolants=l,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(AnimationAction.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var n=this._clip.duration,o=e._clip.duration,s=o/n,l=n/o;e.warp(1,s,t),this.warp(l,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var n=this._mixer,o=n.time,s=this._timeScaleInterpolant,l=this.timeScale;s===null&&(s=n._lendControlInterpolant(),this._timeScaleInterpolant=s);var u=s.parameterPositions,c=s.sampleValues;return u[0]=o,u[1]=o+r,c[0]=e/l,c[1]=t/l,this},stopWarping:function(){var e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,n){if(!this.enabled){this._updateWeight(e);return}var o=this._startTime;if(o!==null){var s=(e-o)*r;if(s<0||r===0)return;this._startTime=null,t=r*s}t*=this._updateTimeScale(e);var l=this._updateTime(t),u=this._updateWeight(e);if(u>0){var c=this._interpolants,h=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(var f=0,m=c.length;f!==m;++f)c[f].evaluate(l),h[f].accumulateAdditive(u);break;case NormalAnimationBlendMode:default:for(var f=0,m=c.length;f!==m;++f)c[f].evaluate(l),h[f].accumulate(n,u)}}},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(r!==null){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(r!==null){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,n=this.loop,o=this._loopCount,s=n===LoopPingPong;if(e===0)return o===-1?t:s&&(o&1)===1?r-t:t;if(n===LoopOnce){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else if(t<0)t=0;else{this.time=t;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),t>=r||t<0){var l=Math.floor(t/r);t-=r*l,o+=Math.abs(l);var u=this.repetitions-o;if(u<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(u===1){var c=e<0;this._setEndings(c,!c,s)}else this._setEndings(!1,!1,s);this._loopCount=o,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=t;if(s&&(o&1)===1)return r-t}return t},_setEndings:function(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=ZeroSlopeEnding,n.endingEnd=ZeroSlopeEnding):(e?n.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:n.endingStart=WrapAroundEnding,t?n.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:n.endingEnd=WrapAroundEnding)},_scheduleFading:function(e,t,r){var n=this._mixer,o=n.time,s=this._weightInterpolant;s===null&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);var l=s.parameterPositions,u=s.sampleValues;return l[0]=o,u[0]=t,l[1]=o+e,u[1]=r,this}});function AnimationMixer(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,o=n.length,s=e._propertyBindings,l=e._interpolants,u=r.uuid,c=this._bindingsByRootAndName,h=c[u];h===void 0&&(h={},c[u]=h);for(var f=0;f!==o;++f){var m=n[f],y=m.name,A=h[y];if(A!==void 0)s[f]=A;else{if(A=s[f],A!==void 0){A._cacheIndex===null&&(++A.referenceCount,this._addInactiveBinding(A,u,y));continue}var M=t&&t._propertyBindings[f].binding.parsedPath;A=new PropertyMixer(PropertyBinding.create(r,y,M),m.ValueTypeName,m.getValueSize()),++A.referenceCount,this._addInactiveBinding(A,u,y),s[f]=A}l[f].resultBuffer=A.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}for(var o=e._propertyBindings,s=0,l=o.length;s!==l;++s){var u=o[s];u.useCount++===0&&(this._lendBinding(u),u.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var o=t[r];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return t!==null&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var n=this._actions,o=this._actionsByClip,s=o[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=s;else{var l=s.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=n.length,n.push(e),s.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;var o=e._clip.uuid,s=this._actionsByClip,l=s[o],u=l.knownActions,c=u[u.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,u[h]=c,u.pop(),e._byClipCacheIndex=null;var f=l.actionByRoot,m=(e._localRoot||this._root).uuid;delete f[m],u.length===0&&delete s[o],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var o=t[r];--o.referenceCount===0&&this._removeInactiveBinding(o)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=r,t[r]=o},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=r,t[r]=o},_addInactiveBinding:function(e,t,r){var n=this._bindingsByRootAndName,o=n[t],s=this._bindings;o===void 0&&(o={},n[t]=o),o[r]=e,e._cacheIndex=s.length,s.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid,o=r.path,s=this._bindingsByRootAndName,l=s[n],u=t[t.length-1],c=e._cacheIndex;u._cacheIndex=c,t[c]=u,t.pop(),delete l[o],Object.keys(l).length===0&&delete s[n]},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=r,t[r]=o},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,o=t[n];e._cacheIndex=n,t[n]=e,o._cacheIndex=r,t[r]=o},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return r===void 0&&(r=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,o=t[n];e.__cacheIndex=n,t[n]=e,o.__cacheIndex=r,t[r]=o},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,r){var n=t||this._root,o=n.uuid,s=typeof e=="string"?AnimationClip.findByName(n,e):e,l=s!==null?s.uuid:e,u=this._actionsByClip[l],c=null;if(r===void 0&&(s!==null?r=s.blendMode:r=NormalAnimationBlendMode),u!==void 0){var h=u.actionByRoot[o];if(h!==void 0&&h.blendMode===r)return h;c=u.knownActions[0],s===null&&(s=c._clip)}if(s===null)return null;var f=new AnimationAction(this,s,t,r);return this._bindAction(f,c),this._addInactiveAction(f,l,o),f},existingAction:function(e,t){var r=t||this._root,n=r.uuid,o=typeof e=="string"?AnimationClip.findByName(r,e):e,s=o?o.uuid:e,l=this._actionsByClip[s];return l!==void 0&&l.actionByRoot[n]||null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions,r=t-1;r>=0;--r)e[r].stop();return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,n=this.time+=e,o=Math.sign(e),s=this._accuIndex^=1,l=0;l!==r;++l){var u=t[l];u._update(n,e,o,s)}for(var c=this._bindings,h=this._nActiveBindings,l=0;l!==h;++l)c[l].apply(s);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,n=this._actionsByClip,o=n[r];if(o!==void 0){for(var s=o.knownActions,l=0,u=s.length;l!==u;++l){var c=s[l];this._deactivateAction(c);var h=c._cacheIndex,f=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,f._cacheIndex=h,t[h]=f,t.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var n in r){var o=r[n].actionByRoot,s=o[t];s!==void 0&&(this._deactivateAction(s),this._removeInactiveAction(s))}var l=this._bindingsByRootAndName,u=l[t];if(u!==void 0)for(var c in u){var h=u[c];h.restoreOriginalState(),this._removeInactiveBinding(h)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}});function Uniform(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}Uniform.prototype.clone=function(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())};function InstancedInterleavedBuffer(e,t,r){InterleavedBuffer.call(this,e,t),this.meshPerAttribute=r||1}InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(e){return InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}});function Raycaster(e,t,r,n){this.ray=new Ray(e,t),this.near=r||0,this.far=n||1/0,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(e,t){return e.distance-t.distance}function intersectObject(e,t,r,n){if(e.layers.test(t.layers)&&e.raycast(t,r),n===!0)for(var o=e.children,s=0,l=o.length;s<l;s++)intersectObject(o[s],t,r,!0)}Object.assign(Raycaster.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var n=r||[];return intersectObject(e,this,n,t),n.sort(ascSort),n},intersectObjects:function(e,t,r){var n=r||[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var o=0,s=e.length;o<s;o++)intersectObject(e[o],this,n,t);return n.sort(ascSort),n}});function Spherical(e,t,r){return this.radius=e!==void 0?e:1,this.phi=t!==void 0?t:0,this.theta=r!==void 0?r:0,this}Object.assign(Spherical.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(MathUtils.clamp(t/this.radius,-1,1))),this}});function Cylindrical(e,t,r){return this.radius=e!==void 0?e:1,this.theta=t!==void 0?t:0,this.y=r!==void 0?r:0,this}Object.assign(Cylindrical.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}});var _vector$7=new Vector2;function Box2(e,t){this.min=e!==void 0?e:new Vector2(1/0,1/0),this.max=t!==void 0?t:new Vector2(-1/0,-1/0)}Object.assign(Box2.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=_vector$7.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Vector2),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Vector2),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){var t=_vector$7.copy(e).clamp(this.min,this.max);return t.sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var _startP=new Vector3,_startEnd=new Vector3;function Line3(e,t){this.start=e!==void 0?e:new Vector3,this.end=t!==void 0?t:new Vector3}Object.assign(Line3.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return e===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Vector3),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return e===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Vector3),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return t===void 0&&(console.warn("THREE.Line3: .at() target is now required"),t=new Vector3),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){_startP.subVectors(e,this.start),_startEnd.subVectors(this.end,this.start);var r=_startEnd.dot(_startEnd),n=_startEnd.dot(_startP),o=n/r;return t&&(o=MathUtils.clamp(o,0,1)),o},closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);return r===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Vector3),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}});function ImmediateRenderObject(e){Object3D.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}ImmediateRenderObject.prototype=Object.create(Object3D.prototype);ImmediateRenderObject.prototype.constructor=ImmediateRenderObject;ImmediateRenderObject.prototype.isImmediateRenderObject=!0;var _vector$8=new Vector3;function SpotLightHelper(e,t){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new BufferGeometry,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],o=0,s=1,l=32;o<l;o++,s++){var u=o/l*Math.PI*2,c=s/l*Math.PI*2;n.push(Math.cos(u),Math.sin(u),1,Math.cos(c),Math.sin(c),1)}r.setAttribute("position",new Float32BufferAttribute(n,3));var h=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(r,h),this.add(this.cone),this.update()}SpotLightHelper.prototype=Object.create(Object3D.prototype);SpotLightHelper.prototype.constructor=SpotLightHelper;SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()};SpotLightHelper.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),_vector$8.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$8),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var _vector$9=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;function getBoneList(e){var t=[];e&&e.isBone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,getBoneList(e.children[r]));return t}function SkeletonHelper(e){for(var t=getBoneList(e),r=new BufferGeometry,n=[],o=[],s=new Color(0,0,1),l=new Color(0,1,0),u=0;u<t.length;u++){var c=t[u];c.parent&&c.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),o.push(s.r,s.g,s.b),o.push(l.r,l.g,l.b))}r.setAttribute("position",new Float32BufferAttribute(n,3)),r.setAttribute("color",new Float32BufferAttribute(o,3));var h=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});LineSegments.call(this,r,h),this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}SkeletonHelper.prototype=Object.create(LineSegments.prototype);SkeletonHelper.prototype.constructor=SkeletonHelper;SkeletonHelper.prototype.isSkeletonHelper=!0;SkeletonHelper.prototype.updateMatrixWorld=function(e){var t=this.bones,r=this.geometry,n=r.getAttribute("position");_matrixWorldInv.getInverse(this.root.matrixWorld);for(var o=0,s=0;o<t.length;o++){var l=t[o];l.parent&&l.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,l.matrixWorld),_vector$9.setFromMatrixPosition(_boneMatrix),n.setXYZ(s,_vector$9.x,_vector$9.y,_vector$9.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,l.parent.matrixWorld),_vector$9.setFromMatrixPosition(_boneMatrix),n.setXYZ(s+1,_vector$9.x,_vector$9.y,_vector$9.z),s+=2)}r.getAttribute("position").needsUpdate=!0,Object3D.prototype.updateMatrixWorld.call(this,e)};function PointLightHelper(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var n=new SphereBufferGeometry(t,4,2),o=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1});Mesh.call(this,n,o),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}PointLightHelper.prototype=Object.create(Mesh.prototype);PointLightHelper.prototype.constructor=PointLightHelper;PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()};PointLightHelper.prototype.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var _vector$a=new Vector3,_color1=new Color,_color2=new Color;function HemisphereLightHelper(e,t,r){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new OctahedronBufferGeometry(t);n.rotateY(Math.PI*.5),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);var o=n.getAttribute("position"),s=new Float32Array(o.count*3);n.setAttribute("color",new BufferAttribute(s,3)),this.add(new Mesh(n,this.material)),this.update()}HemisphereLightHelper.prototype=Object.create(Object3D.prototype);HemisphereLightHelper.prototype.constructor=HemisphereLightHelper;HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()};HemisphereLightHelper.prototype.update=function(){var e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(var r=0,n=t.count;r<n;r++){var o=r<n/2?_color1:_color2;t.setXYZ(r,o.r,o.g,o.b)}t.needsUpdate=!0}e.lookAt(_vector$a.setFromMatrixPosition(this.light.matrixWorld).negate())};function GridHelper(e,t,r,n){e=e||10,t=t||10,r=new Color(r!==void 0?r:4473924),n=new Color(n!==void 0?n:8947848);for(var o=t/2,s=e/t,l=e/2,u=[],c=[],h=0,f=0,m=-l;h<=t;h++,m+=s){u.push(-l,0,m,l,0,m),u.push(m,0,-l,m,0,l);var y=h===o?r:n;y.toArray(c,f),f+=3,y.toArray(c,f),f+=3,y.toArray(c,f),f+=3,y.toArray(c,f),f+=3}var A=new BufferGeometry;A.setAttribute("position",new Float32BufferAttribute(u,3)),A.setAttribute("color",new Float32BufferAttribute(c,3));var M=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});LineSegments.call(this,A,M),this.type="GridHelper"}GridHelper.prototype=Object.assign(Object.create(LineSegments.prototype),{constructor:GridHelper,copy:function(e){return LineSegments.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return new this.constructor().copy(this)}});function PolarGridHelper(e,t,r,n,o,s){e=e||10,t=t||16,r=r||8,n=n||64,o=new Color(o!==void 0?o:4473924),s=new Color(s!==void 0?s:8947848);var l=[],u=[],c,h,f,m,y,A,M;for(m=0;m<=t;m++)f=m/t*(Math.PI*2),c=Math.sin(f)*e,h=Math.cos(f)*e,l.push(0,0,0),l.push(c,0,h),M=m&1?o:s,u.push(M.r,M.g,M.b),u.push(M.r,M.g,M.b);for(m=0;m<=r;m++)for(M=m&1?o:s,A=e-e/r*m,y=0;y<n;y++)f=y/n*(Math.PI*2),c=Math.sin(f)*A,h=Math.cos(f)*A,l.push(c,0,h),u.push(M.r,M.g,M.b),f=(y+1)/n*(Math.PI*2),c=Math.sin(f)*A,h=Math.cos(f)*A,l.push(c,0,h),u.push(M.r,M.g,M.b);var b=new BufferGeometry;b.setAttribute("position",new Float32BufferAttribute(l,3)),b.setAttribute("color",new Float32BufferAttribute(u,3));var T=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});LineSegments.call(this,b,T),this.type="PolarGridHelper"}PolarGridHelper.prototype=Object.create(LineSegments.prototype);PolarGridHelper.prototype.constructor=PolarGridHelper;var _v1$5=new Vector3,_v2$3=new Vector3,_v3$1=new Vector3;function DirectionalLightHelper(e,t,r){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,t===void 0&&(t=1);var n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var o=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(n,o),this.add(this.lightPlane),n=new BufferGeometry,n.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(n,o),this.add(this.targetLine),this.update()}DirectionalLightHelper.prototype=Object.create(Object3D.prototype);DirectionalLightHelper.prototype.constructor=DirectionalLightHelper;DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()};DirectionalLightHelper.prototype.update=function(){_v1$5.setFromMatrixPosition(this.light.matrixWorld),_v2$3.setFromMatrixPosition(this.light.target.matrixWorld),_v3$1.subVectors(_v2$3,_v1$5),this.lightPlane.lookAt(_v2$3),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2$3),this.targetLine.scale.z=_v3$1.length()};var _vector$b=new Vector3,_camera=new Camera$1;function CameraHelper(e){var t=new BufferGeometry,r=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],o=[],s={},l=new Color(16755200),u=new Color(16711680),c=new Color(43775),h=new Color(16777215),f=new Color(3355443);m("n1","n2",l),m("n2","n4",l),m("n4","n3",l),m("n3","n1",l),m("f1","f2",l),m("f2","f4",l),m("f4","f3",l),m("f3","f1",l),m("n1","f1",l),m("n2","f2",l),m("n3","f3",l),m("n4","f4",l),m("p","n1",u),m("p","n2",u),m("p","n3",u),m("p","n4",u),m("u1","u2",c),m("u2","u3",c),m("u3","u1",c),m("c","t",h),m("p","c",f),m("cn1","cn2",f),m("cn3","cn4",f),m("cf1","cf2",f),m("cf3","cf4",f);function m(A,M,b){y(A,b),y(M,b)}function y(A,M){n.push(0,0,0),o.push(M.r,M.g,M.b),s[A]===void 0&&(s[A]=[]),s[A].push(n.length/3-1)}t.setAttribute("position",new Float32BufferAttribute(n,3)),t.setAttribute("color",new Float32BufferAttribute(o,3)),LineSegments.call(this,t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}CameraHelper.prototype=Object.create(LineSegments.prototype);CameraHelper.prototype.constructor=CameraHelper;CameraHelper.prototype.update=function(){var e=this.geometry,t=this.pointMap,r=1,n=1;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",t,e,_camera,0,0,-1),setPoint("t",t,e,_camera,0,0,1),setPoint("n1",t,e,_camera,-1,-1,-1),setPoint("n2",t,e,_camera,r,-1,-1),setPoint("n3",t,e,_camera,-1,n,-1),setPoint("n4",t,e,_camera,r,n,-1),setPoint("f1",t,e,_camera,-1,-1,1),setPoint("f2",t,e,_camera,r,-1,1),setPoint("f3",t,e,_camera,-1,n,1),setPoint("f4",t,e,_camera,r,n,1),setPoint("u1",t,e,_camera,r*.7,n*1.1,-1),setPoint("u2",t,e,_camera,-1*.7,n*1.1,-1),setPoint("u3",t,e,_camera,0,n*2,-1),setPoint("cf1",t,e,_camera,-1,0,1),setPoint("cf2",t,e,_camera,r,0,1),setPoint("cf3",t,e,_camera,0,-1,1),setPoint("cf4",t,e,_camera,0,n,1),setPoint("cn1",t,e,_camera,-1,0,-1),setPoint("cn2",t,e,_camera,r,0,-1),setPoint("cn3",t,e,_camera,0,-1,-1),setPoint("cn4",t,e,_camera,0,n,-1),e.getAttribute("position").needsUpdate=!0};function setPoint(e,t,r,n,o,s,l){_vector$b.set(o,s,l).unproject(n);var u=t[e];if(u!==void 0)for(var c=r.getAttribute("position"),h=0,f=u.length;h<f;h++)c.setXYZ(u[h],_vector$b.x,_vector$b.y,_vector$b.z)}var _box$3=new Box3;function BoxHelper(e,t){this.object=e,t===void 0&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),o=new BufferGeometry;o.setIndex(new BufferAttribute(r,1)),o.setAttribute("position",new BufferAttribute(n,3)),LineSegments.call(this,o,new LineBasicMaterial({color:t,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}BoxHelper.prototype=Object.create(LineSegments.prototype);BoxHelper.prototype.constructor=BoxHelper;BoxHelper.prototype.update=function(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&_box$3.setFromObject(this.object),!_box$3.isEmpty()){var t=_box$3.min,r=_box$3.max,n=this.geometry.attributes.position,o=n.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=t.x,o[4]=r.y,o[5]=r.z,o[6]=t.x,o[7]=t.y,o[8]=r.z,o[9]=r.x,o[10]=t.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=t.z,o[15]=t.x,o[16]=r.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=r.x,o[22]=t.y,o[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}};BoxHelper.prototype.setFromObject=function(e){return this.object=e,this.update(),this};BoxHelper.prototype.copy=function(e){return LineSegments.prototype.copy.call(this,e),this.object=e.object,this};BoxHelper.prototype.clone=function(){return new this.constructor().copy(this)};function Box3Helper(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new BufferGeometry;o.setIndex(new BufferAttribute(r,1)),o.setAttribute("position",new Float32BufferAttribute(n,3)),LineSegments.call(this,o,new LineBasicMaterial({color:t,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}Box3Helper.prototype=Object.create(LineSegments.prototype);Box3Helper.prototype.constructor=Box3Helper;Box3Helper.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Object3D.prototype.updateMatrixWorld.call(this,e))};function PlaneHelper(e,t,r){this.plane=e,this.size=t===void 0?1:t;var n=r!==void 0?r:16776960,o=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],s=new BufferGeometry;s.setAttribute("position",new Float32BufferAttribute(o,3)),s.computeBoundingSphere(),Line.call(this,s,new LineBasicMaterial({color:n,toneMapped:!1})),this.type="PlaneHelper";var l=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],u=new BufferGeometry;u.setAttribute("position",new Float32BufferAttribute(l,3)),u.computeBoundingSphere(),this.add(new Mesh(u,new MeshBasicMaterial({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}PlaneHelper.prototype=Object.create(Line.prototype);PlaneHelper.prototype.constructor=PlaneHelper;PlaneHelper.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?BackSide:FrontSide,this.lookAt(this.plane.normal),Object3D.prototype.updateMatrixWorld.call(this,e)};var _axis=new Vector3,_lineGeometry,_coneGeometry;function ArrowHelper(e,t,r,n,o,s){Object3D.call(this),this.type="ArrowHelper",e===void 0&&(e=new Vector3(0,0,1)),t===void 0&&(t=new Vector3(0,0,0)),r===void 0&&(r=1),n===void 0&&(n=16776960),o===void 0&&(o=.2*r),s===void 0&&(s=.2*o),_lineGeometry===void 0&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderBufferGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(t),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,o,s)}ArrowHelper.prototype=Object.create(Object3D.prototype);ArrowHelper.prototype.constructor=ArrowHelper;ArrowHelper.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(_axis,t)}};ArrowHelper.prototype.setLength=function(e,t,r){t===void 0&&(t=.2*e),r===void 0&&(r=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()};ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)};ArrowHelper.prototype.copy=function(e){return Object3D.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this};ArrowHelper.prototype.clone=function(){return new this.constructor().copy(this)};function AxesHelper(e){e=e||1;var t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute(t,3)),n.setAttribute("color",new Float32BufferAttribute(r,3));var o=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});LineSegments.call(this,n,o),this.type="AxesHelper"}AxesHelper.prototype=Object.create(LineSegments.prototype);AxesHelper.prototype.constructor=AxesHelper;var LOD_MIN=4,LOD_MAX=8,SIZE_MAX=Math.pow(2,LOD_MAX),EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],TOTAL_LODS=LOD_MAX-LOD_MIN+1+EXTRA_LOD_SIGMA.length,MAX_SAMPLES=20,ENCODINGS={[LinearEncoding]:0,[sRGBEncoding]:1,[RGBEEncoding]:2,[RGBM7Encoding]:3,[RGBM16Encoding]:4,[RGBDEncoding]:5,[GammaEncoding]:6},_flatCamera=new OrthographicCamera,{_lodPlanes,_sizeLods,_sigmas}=_createPlanes(),_oldTarget=null,PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];function PMREMGenerator(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=_getBlurShader(MAX_SAMPLES),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}PMREMGenerator.prototype={constructor:PMREMGenerator,fromScene:function(e,t=0,r=.1,n=100){_oldTarget=this._renderer.getRenderTarget();var o=this._allocateTargets();return this._sceneToCubeUV(e,r,n,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o},fromEquirectangular:function(e){return e.magFilter=NearestFilter,e.minFilter=NearestFilter,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){_oldTarget=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t},compileCubemapShader:function(){this._cubemapShader===null&&(this._cubemapShader=_getCubemapShader(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){this._equirectShader===null&&(this._equirectShader=_getEquirectShader(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(var e=0;e<_lodPlanes.length;e++)_lodPlanes[e].dispose()},_cleanup:function(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(_oldTarget),e.scissorTest=!1,e.setSize(e.width,e.height)},_allocateTargets:function(e){var t={magFilter:NearestFilter,minFilter:NearestFilter,generateMipmaps:!1,type:UnsignedByteType,format:RGBEFormat,encoding:_isLDR(e)?e.encoding:RGBEEncoding,depthBuffer:!1,stencilBuffer:!1},r=_createRenderTarget(t);return r.depthBuffer=!e,this._pingPongRenderTarget=_createRenderTarget(t),r},_compileMaterial:function(e){var t=new Mesh(_lodPlanes[0],e);this._renderer.compile(t,_flatCamera)},_sceneToCubeUV:function(e,t,r,n){var o=90,s=1,l=new PerspectiveCamera(o,s,t,r),u=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,f=h.outputEncoding,m=h.toneMapping,y=h.toneMappingExposure,A=h.getClearColor(),M=h.getClearAlpha();h.toneMapping=LinearToneMapping,h.toneMappingExposure=1,h.outputEncoding=LinearEncoding;var b=e.background;if(b&&b.isColor){b.convertSRGBToLinear();var T=Math.max(b.r,b.g,b.b),_=Math.min(Math.max(Math.ceil(Math.log2(T)),-128),127);b=b.multiplyScalar(Math.pow(2,-_));var S=(_+128)/255;h.setClearColor(b,S),e.background=null}for(var C=0;C<6;C++){var P=C%3;P==0?(l.up.set(0,u[C],0),l.lookAt(c[C],0,0)):P==1?(l.up.set(0,0,u[C]),l.lookAt(0,c[C],0)):(l.up.set(0,u[C],0),l.lookAt(0,0,c[C])),_setViewport(n,P*SIZE_MAX,C>2?SIZE_MAX:0,SIZE_MAX,SIZE_MAX),h.setRenderTarget(n),h.render(e,l)}h.toneMapping=m,h.toneMappingExposure=y,h.outputEncoding=f,h.setClearColor(A,M)},_textureToCubeUV:function(e,t){var r=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=_getCubemapShader()):this._equirectShader==null&&(this._equirectShader=_getEquirectShader());var n=e.isCubeTexture?this._cubemapShader:this._equirectShader,o=new Mesh(_lodPlanes[0],n),s=n.uniforms;s.envMap.value=e,e.isCubeTexture||s.texelSize.value.set(1/e.image.width,1/e.image.height),s.inputEncoding.value=ENCODINGS[e.encoding],s.outputEncoding.value=ENCODINGS[t.texture.encoding],_setViewport(t,0,0,3*SIZE_MAX,2*SIZE_MAX),r.setRenderTarget(t),r.render(o,_flatCamera)},_applyPMREM:function(e){var t=this._renderer,r=t.autoClear;t.autoClear=!1;for(var n=1;n<TOTAL_LODS;n++){var o=Math.sqrt(_sigmas[n]*_sigmas[n]-_sigmas[n-1]*_sigmas[n-1]),s=_axisDirections[(n-1)%_axisDirections.length];this._blur(e,n-1,n,o,s)}t.autoClear=r},_blur:function(e,t,r,n,o){var s=this._pingPongRenderTarget;this._halfBlur(e,s,t,r,n,"latitudinal",o),this._halfBlur(s,e,r,r,n,"longitudinal",o)},_halfBlur:function(e,t,r,n,o,s,l){var u=this._renderer,c=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");var h=3,f=new Mesh(_lodPlanes[n],c),m=c.uniforms,y=_sizeLods[r]-1,A=isFinite(o)?Math.PI/(2*y):2*Math.PI/(2*MAX_SAMPLES-1),M=o/A,b=isFinite(o)?1+Math.floor(h*M):MAX_SAMPLES;b>MAX_SAMPLES&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${MAX_SAMPLES}`);for(var T=[],_=0,S=0;S<MAX_SAMPLES;++S){var F=S/M,C=Math.exp(-F*F/2);T.push(C),S==0?_+=C:S<b&&(_+=2*C)}for(var S=0;S<T.length;S++)T[S]=T[S]/_;m.envMap.value=e.texture,m.samples.value=b,m.weights.value=T,m.latitudinal.value=s==="latitudinal",l&&(m.poleAxis.value=l),m.dTheta.value=A,m.mipInt.value=LOD_MAX-r,m.inputEncoding.value=ENCODINGS[e.texture.encoding],m.outputEncoding.value=ENCODINGS[e.texture.encoding];var P=_sizeLods[n],F=3*Math.max(0,SIZE_MAX-2*P),O=(n===0?0:2*SIZE_MAX)+2*P*(n>LOD_MAX-LOD_MIN?n-LOD_MAX+LOD_MIN:0);_setViewport(t,F,O,3*P,2*P),u.setRenderTarget(t),u.render(f,_flatCamera)}};function _isLDR(e){return e===void 0||e.type!==UnsignedByteType?!1:e.encoding===LinearEncoding||e.encoding===sRGBEncoding||e.encoding===GammaEncoding}function _createPlanes(){for(var e=[],t=[],r=[],n=LOD_MAX,o=0;o<TOTAL_LODS;o++){var s=Math.pow(2,n);t.push(s);var l=1/s;o>LOD_MAX-LOD_MIN?l=EXTRA_LOD_SIGMA[o-LOD_MAX+LOD_MIN-1]:o==0&&(l=0),r.push(l);for(var u=1/(s-1),c=-u/2,h=1+u/2,f=[c,c,h,c,h,h,c,c,h,h,c,h],m=6,y=6,A=3,M=2,b=1,T=new Float32Array(A*y*m),_=new Float32Array(M*y*m),S=new Float32Array(b*y*m),C=0;C<m;C++){var P=C%3*2/3-1,F=C>2?0:-1,O=[P,F,0,P+2/3,F,0,P+2/3,F+1,0,P,F,0,P+2/3,F+1,0,P,F+1,0];T.set(O,A*y*C),_.set(f,M*y*C);var N=[C,C,C,C,C,C];S.set(N,b*y*C)}var V=new BufferGeometry;V.setAttribute("position",new BufferAttribute(T,A)),V.setAttribute("uv",new BufferAttribute(_,M)),V.setAttribute("faceIndex",new BufferAttribute(S,b)),e.push(V),n>LOD_MIN&&n--}return{_lodPlanes:e,_sizeLods:t,_sigmas:r}}function _createRenderTarget(e){var t=new WebGLRenderTarget(3*SIZE_MAX,3*SIZE_MAX,e);return t.texture.mapping=CubeUVReflectionMapping,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function _setViewport(e,t,r,n,o){e.viewport.set(t,r,n,o),e.scissor.set(t,r,n,o)}function _getBlurShader(e){var t=new Float32Array(e),r=new Vector3(0,1,0),n=new RawShaderMaterial({defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform int samples;
uniform float weights[n];
uniform bool latitudinal;
uniform float dTheta;
uniform float mipInt;
uniform vec3 poleAxis;

${_getEncodings()}

#define ENVMAP_TYPE_CUBE_UV
#include <cube_uv_reflection_fragment>

vec3 getSample(float theta, vec3 axis) {
	float cosTheta = cos(theta);
	// Rodrigues' axis-angle rotation
	vec3 sampleDirection = vOutputDirection * cosTheta
		+ cross(axis, vOutputDirection) * sin(theta)
		+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);
	return bilinearCubeUV(envMap, sampleDirection, mipInt);
}

void main() {
	vec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);
	if (all(equal(axis, vec3(0.0))))
		axis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);
	axis = normalize(axis);
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb += weights[0] * getSample(0.0, axis);
	for (int i = 1; i < n; i++) {
		if (i >= samples)
			break;
		float theta = dTheta * float(i);
		gl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);
		gl_FragColor.rgb += weights[i] * getSample(theta, axis);
	}
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1});return n.type="SphericalGaussianBlur",n}function _getEquirectShader(){var e=new Vector2(1,1),t=new RawShaderMaterial({uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform vec2 texelSize;

${_getEncodings()}

#include <common>

void main() {
	gl_FragColor = vec4(0.0);
	vec3 outputDirection = normalize(vOutputDirection);
	vec2 uv = equirectUv( outputDirection );
	vec2 f = fract(uv / texelSize - 0.5);
	uv -= f * texelSize;
	vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x += texelSize.x;
	vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.y += texelSize.y;
	vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x -= texelSize.x;
	vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	vec3 tm = mix(tl, tr, f.x);
	vec3 bm = mix(bl, br, f.x);
	gl_FragColor.rgb = mix(tm, bm, f.y);
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1});return t.type="EquirectangularToCubeUV",t}function _getCubemapShader(){var e=new RawShaderMaterial({uniforms:{envMap:{value:null},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform samplerCube envMap;

${_getEncodings()}

void main() {
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function _getCommonVertexShader(){return`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;

// RH coordinate system; PMREM face-indexing convention
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx; // ( 1, v, u ) pos x
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.xz *= -1.0; // ( -u, 1, -v ) pos y
	} else if (face == 2.0) {
		direction.x *= -1.0; // ( -u, v, 1 ) pos z
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.xz *= -1.0; // ( -1, v, -u ) neg x
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.xy *= -1.0; // ( -u, -1, v ) neg y
	} else if (face == 5.0) {
		direction.z *= -1.0; // ( u, v, -1 ) neg z
	}
	return direction;
}

void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`}function _getEncodings(){return`
uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	`}Curve.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e};Object.assign(CurvePath.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Geometry,r=0,n=e.length;r<n;r++){var o=e[r];t.vertices.push(new Vector3(o.x,o.y,o.z||0))}return t}});Object.assign(Path.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}});Object.create(CatmullRomCurve3.prototype);Object.create(CatmullRomCurve3.prototype);function Spline(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,e),this.type="catmullrom"}Spline.prototype=Object.create(CatmullRomCurve3.prototype);Object.assign(Spline.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Object.assign(Loader.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(e)}});Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Object.assign(ObjectLoader.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}});Object.assign(Box2.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}});Object.assign(Box3.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}});Object.assign(Sphere.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}});Frustum.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)};Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)};Object.assign(MathUtils,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),MathUtils.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),MathUtils.ceilPowerOfTwo(e)}});Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(Matrix4.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new Vector3().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,n,o,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,r,o,s)}});Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)};Quaternion.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)};Object.assign(Ray.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}});Object.assign(Triangle.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}});Object.assign(Triangle,{barycoordFromPoint:function(e,t,r,n,o){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(e,t,r,n,o)},normal:function(e,t,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(e,t,r,n)}});Object.assign(Shape.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)}});Object.assign(Vector2.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(Vector4.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(Geometry.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}});Object.assign(Object3D.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}});Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.assign(Mesh.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}});Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),TrianglesDrawMode},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}});Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}});PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(e)};Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}});Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(DynamicDrawUsage)}}});Object.assign(BufferAttribute.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?DynamicDrawUsage:StaticDrawUsage),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(BufferGeometry.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new BufferAttribute(arguments[1],arguments[2]))):e==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t)},addDrawCall:function(e,t,r){r!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}});Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Object.defineProperties(InstancedBufferGeometry.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}});Object.defineProperties(Raycaster.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}});Object.defineProperties(InterleavedBuffer.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}});Object.assign(InterleavedBuffer.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?DynamicDrawUsage:StaticDrawUsage),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}});Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}});Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===FlatShading}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}});Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}});Object.assign(WebGLRenderer.prototype,{clearTarget:function(e,t,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,n)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}});Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=e===!0?sRGBEncoding:LinearEncoding}}});Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}});Object.defineProperties(Audio.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,r=new AudioLoader;return r.load(e,function(n){t.setBuffer(n)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}});AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};CubeCamera.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};ImageUtils.crossOrigin=void 0;ImageUtils.loadTexture=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var o=new TextureLoader$1;o.setCrossOrigin(this.crossOrigin);var s=o.load(e,r,void 0,n);return t&&(s.mapping=t),s};ImageUtils.loadTextureCube=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var o=new CubeTextureLoader;o.setCrossOrigin(this.crossOrigin);var s=o.load(e,r,void 0,n);return t&&(s.mapping=t),s};ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));var version=Number(REVISION);if(version<115||version>117)throw new Error('"Five" needs "THREE.js" version between 125 - 117.');/**
 * @license
 * The 'jsrsasign'(RSA-Sign JavaScript Library) License
 *
 * Copyright (c) 2010-2021 Kenji Urushima
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * LICENSE: MIT License
 *//**
 * @license
 * RSA and ECC in JavaScript
 *
 * Copyright (c) 2003-2005  Tom Wu All Rights Reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS-IS" AND WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS, IMPLIED OR OTHERWISE, INCLUDING WITHOUT LIMITATION, ANY
 * WARRANTY OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
 *
 * IN NO EVENT SHALL TOM WU BE LIABLE FOR ANY SPECIAL, INCIDENTAL,
 * INDIRECT OR CONSEQUENTIAL DAMAGES OF ANY KIND, OR ANY DAMAGES WHATSOEVER
 * RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER OR NOT ADVISED OF
 * THE POSSIBILITY OF DAMAGE, AND ON ANY THEORY OF LIABILITY, ARISING OUT
 * OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * In addition, the following condition applies:
 *
 * All redistributions must retain an intact copy of this copyright notice
 * and disclaimer.
 *
 * http://www-cs-students.stanford.edu/~tjw/jsbn/
 * LICENSE: BSD License
 * PART: ext/{base64,jsbn,jsbn2,prgn4,rng,rsa,rsa2}
 *//**
 * @license
 * CryptoJS
 *
 * Copyright (c) 2009-2013 Jeff Mott
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * https://code.google.com/p/crypto-js/wiki/License
 * PART: ext/cryptojs
 */var KJUR={},CryptoJS=CryptoJS||function(e,t){var r={},n=r.lib={},o=n.Base=function(){function y(){}return{extend:function(A){y.prototype=this;var M=new y;return A&&M.mixIn(A),M.hasOwnProperty("init")||(M.init=function(){M.$super.init.apply(this,arguments)}),M.init.prototype=M,M.$super=this,M},create:function(){var A=this.extend();return A.init.apply(A,arguments),A},init:function(){},mixIn:function(A){for(var M in A)A.hasOwnProperty(M)&&(this[M]=A[M]);A.hasOwnProperty("toString")&&(this.toString=A.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=n.WordArray=o.extend({init:function(y,A){y=this.words=y||[],A!=t?this.sigBytes=A:this.sigBytes=y.length*4},toString:function(y){return(y||u).stringify(this)},concat:function(y){var A=this.words,M=y.words,b=this.sigBytes,T=y.sigBytes;if(this.clamp(),b%4)for(var _=0;_<T;_++){var S=M[_>>>2]>>>24-_%4*8&255;A[b+_>>>2]|=S<<24-(b+_)%4*8}else for(var _=0;_<T;_+=4)A[b+_>>>2]=M[_>>>2];return this.sigBytes+=T,this},clamp:function(){var y=this.words,A=this.sigBytes;y[A>>>2]&=4294967295<<32-A%4*8,y.length=e.ceil(A/4)},clone:function(){var y=o.clone.call(this);return y.words=this.words.slice(0),y},random:function(y){for(var A=[],M=0;M<y;M+=4)A.push(e.random()*4294967296|0);return new s.init(A,y)}}),l=r.enc={},u=l.Hex={stringify:function(y){for(var A=y.words,M=y.sigBytes,b=[],T=0;T<M;T++){var _=A[T>>>2]>>>24-T%4*8&255;b.push((_>>>4).toString(16)),b.push((_&15).toString(16))}return b.join("")},parse:function(y){for(var A=y.length,M=[],b=0;b<A;b+=2)M[b>>>3]|=parseInt(y.substr(b,2),16)<<24-b%8*4;return new s.init(M,A/2)}},c=l.Latin1={stringify:function(y){for(var A=y.words,M=y.sigBytes,b=[],T=0;T<M;T++){var _=A[T>>>2]>>>24-T%4*8&255;b.push(String.fromCharCode(_))}return b.join("")},parse:function(y){for(var A=y.length,M=[],b=0;b<A;b++)M[b>>>2]|=(y.charCodeAt(b)&255)<<24-b%4*8;return new s.init(M,A)}},h=l.Utf8={stringify:function(y){try{return decodeURIComponent(escape(c.stringify(y)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(y){return c.parse(unescape(encodeURIComponent(y)))}},f=n.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(y){typeof y=="string"&&(y=h.parse(y)),this._data.concat(y),this._nDataBytes+=y.sigBytes},_process:function(y){var A=this._data,M=A.words,b=A.sigBytes,T=this.blockSize,_=T*4,S=b/_;y?S=e.ceil(S):S=e.max((S|0)-this._minBufferSize,0);var C=S*T,P=e.min(C*4,b);if(C){for(var F=0;F<C;F+=T)this._doProcessBlock(M,F);var O=M.splice(0,C);A.sigBytes-=P}return new s.init(O,P)},clone:function(){var y=o.clone.call(this);return y._data=this._data.clone(),y},_minBufferSize:0});n.Hasher=f.extend({cfg:o.extend(),init:function(y){this.cfg=this.cfg.extend(y),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(y){return this._append(y),this._process(),this},finalize:function(y){y&&this._append(y);var A=this._doFinalize();return A},blockSize:512/32,_createHelper:function(y){return function(A,M){return new y.init(M).finalize(A)}},_createHmacHelper:function(y){return function(A,M){return new m.HMAC.init(y,M).finalize(A)}}});var m=r.algo={};return r}(Math);(function(e){for(var t=CryptoJS,A=t.lib,r=A.WordArray,n=A.Hasher,A=t.algo,o=[],s=[],l=function(b){return 4294967296*(b-(b|0))|0},u=2,c=0;64>c;){var h;e:{h=u;for(var f=e.sqrt(h),m=2;m<=f;m++)if(!(h%m)){h=!1;break e}h=!0}h&&(8>c&&(o[c]=l(e.pow(u,.5))),s[c]=l(e.pow(u,1/3)),c++),u++}var y=[],A=A.SHA256=n.extend({_doReset:function(){this._hash=new r.init(o.slice(0))},_doProcessBlock:function(M,b){for(var T=this._hash.words,_=T[0],S=T[1],C=T[2],P=T[3],F=T[4],O=T[5],N=T[6],V=T[7],q=0;64>q;q++){if(16>q)y[q]=M[b+q]|0;else{var Q=y[q-15],z=y[q-2];y[q]=((Q<<25|Q>>>7)^(Q<<14|Q>>>18)^Q>>>3)+y[q-7]+((z<<15|z>>>17)^(z<<13|z>>>19)^z>>>10)+y[q-16]}Q=V+((F<<26|F>>>6)^(F<<21|F>>>11)^(F<<7|F>>>25))+(F&O^~F&N)+s[q]+y[q],z=((_<<30|_>>>2)^(_<<19|_>>>13)^(_<<10|_>>>22))+(_&S^_&C^S&C),V=N,N=O,O=F,F=P+Q|0,P=C,C=S,S=_,_=Q+z|0}T[0]=T[0]+_|0,T[1]=T[1]+S|0,T[2]=T[2]+C|0,T[3]=T[3]+P|0,T[4]=T[4]+F|0,T[5]=T[5]+O|0,T[6]=T[6]+N|0,T[7]=T[7]+V|0},_doFinalize:function(){var M=this._data,b=M.words,T=8*this._nDataBytes,_=8*M.sigBytes;return b[_>>>5]|=128<<24-_%32,b[(_+64>>>9<<4)+14]=e.floor(T/4294967296),b[(_+64>>>9<<4)+15]=T,M.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var M=n.clone.call(this);return M._hash=this._hash.clone(),M}});t.SHA256=n._createHelper(A),t.HmacSHA256=n._createHmacHelper(A)})(Math);CryptoJS.lib.Cipher||function(e){var A=CryptoJS,t=A.lib,r=t.Base,n=t.WordArray,o=t.BufferedBlockAlgorithm,s=A.enc.Base64,l=A.algo.EvpKDF,u=t.Cipher=o.extend({cfg:r.extend(),createEncryptor:function(b,T){return this.create(this._ENC_XFORM_MODE,b,T)},createDecryptor:function(b,T){return this.create(this._DEC_XFORM_MODE,b,T)},init:function(b,T,_){this.cfg=this.cfg.extend(_),this._xformMode=b,this._key=T,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(b){return this._append(b),this._process()},finalize:function(b){return b&&this._append(b),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(b){return{encrypt:function(T,_,S){return(typeof _=="string"?M:y).encrypt(b,T,_,S)},decrypt:function(T,_,S){return(typeof _=="string"?M:y).decrypt(b,T,_,S)}}}});t.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var m=A.mode={},c=function(b,T,_){var S=this._iv;S?this._iv=e:S=this._prevBlock;for(var C=0;C<_;C++)b[T+C]^=S[C]},h=(t.BlockCipherMode=r.extend({createEncryptor:function(b,T){return this.Encryptor.create(b,T)},createDecryptor:function(b,T){return this.Decryptor.create(b,T)},init:function(b,T){this._cipher=b,this._iv=T}})).extend();h.Encryptor=h.extend({processBlock:function(b,T){var _=this._cipher,S=_.blockSize;c.call(this,b,T,S),_.encryptBlock(b,T),this._prevBlock=b.slice(T,T+S)}}),h.Decryptor=h.extend({processBlock:function(b,T){var _=this._cipher,S=_.blockSize,C=b.slice(T,T+S);_.decryptBlock(b,T),c.call(this,b,T,S),this._prevBlock=C}}),m=m.CBC=h,h=(A.pad={}).Pkcs7={pad:function(b,T){for(var _=4*T,_=_-b.sigBytes%_,S=_<<24|_<<16|_<<8|_,C=[],P=0;P<_;P+=4)C.push(S);_=n.create(C,_),b.concat(_)},unpad:function(b){b.sigBytes-=b.words[b.sigBytes-1>>>2]&255}},t.BlockCipher=u.extend({cfg:u.cfg.extend({mode:m,padding:h}),reset:function(){u.reset.call(this);var T=this.cfg,b=T.iv,T=T.mode;if(this._xformMode==this._ENC_XFORM_MODE)var _=T.createEncryptor;else _=T.createDecryptor,this._minBufferSize=1;this._mode=_.call(T,this,b&&b.words)},_doProcessBlock:function(b,T){this._mode.processBlock(b,T)},_doFinalize:function(){var b=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){b.pad(this._data,this.blockSize);var T=this._process(!0)}else T=this._process(!0),b.unpad(T);return T},blockSize:4});var f=t.CipherParams=r.extend({init:function(b){this.mixIn(b)},toString:function(b){return(b||this.formatter).stringify(this)}}),m=(A.format={}).OpenSSL={stringify:function(b){var T=b.ciphertext;return b=b.salt,(b?n.create([1398893684,1701076831]).concat(b).concat(T):T).toString(s)},parse:function(b){b=s.parse(b);var T=b.words;if(T[0]==1398893684&&T[1]==1701076831){var _=n.create(T.slice(2,4));T.splice(0,4),b.sigBytes-=16}return f.create({ciphertext:b,salt:_})}},y=t.SerializableCipher=r.extend({cfg:r.extend({format:m}),encrypt:function(b,T,_,S){S=this.cfg.extend(S);var C=b.createEncryptor(_,S);return T=C.finalize(T),C=C.cfg,f.create({ciphertext:T,key:_,iv:C.iv,algorithm:b,mode:C.mode,padding:C.padding,blockSize:b.blockSize,formatter:S.format})},decrypt:function(b,T,_,S){return S=this.cfg.extend(S),T=this._parse(T,S.format),b.createDecryptor(_,S).finalize(T.ciphertext)},_parse:function(b,T){return typeof b=="string"?T.parse(b,this):b}}),A=(A.kdf={}).OpenSSL={execute:function(b,T,_,S){return S||(S=n.random(8)),b=l.create({keySize:T+_}).compute(b,S),_=n.create(b.words.slice(T),4*_),b.sigBytes=4*T,f.create({key:b,iv:_,salt:S})}},M=t.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:A}),encrypt:function(b,T,_,S){return S=this.cfg.extend(S),_=S.kdf.execute(_,b.keySize,b.ivSize),S.iv=_.iv,b=y.encrypt.call(this,b,T,_.key,S),b.mixIn(_),b},decrypt:function(b,T,_,S){return S=this.cfg.extend(S),T=this._parse(T,S.format),_=S.kdf.execute(_,b.keySize,b.ivSize,T.salt),S.iv=_.iv,y.decrypt.call(this,b,T,_.key,S)}})}();(function(){for(var e=CryptoJS,t=e.lib.BlockCipher,O=e.algo,r=[],n=[],o=[],s=[],l=[],u=[],c=[],h=[],f=[],m=[],y=[],A=0;256>A;A++)y[A]=128>A?A<<1:A<<1^283;for(var M=0,b=0,A=0;256>A;A++){var T=b^b<<1^b<<2^b<<3^b<<4,T=T>>>8^T&255^99;r[M]=T,n[T]=M;var _=y[M],S=y[_],C=y[S],P=257*y[T]^16843008*T;o[M]=P<<24|P>>>8,s[M]=P<<16|P>>>16,l[M]=P<<8|P>>>24,u[M]=P,P=16843009*C^65537*S^257*_^16843008*M,c[T]=P<<24|P>>>8,h[T]=P<<16|P>>>16,f[T]=P<<8|P>>>24,m[T]=P,M?(M=_^y[y[y[C^_]]],b^=y[y[b]]):M=b=1}var F=[0,1,2,4,8,16,32,64,128,27,54],O=O.AES=t.extend({_doReset:function(){for(var q=this._key,N=q.words,V=q.sigBytes/4,q=4*((this._nRounds=V+6)+1),Q=this._keySchedule=[],z=0;z<q;z++)if(z<V)Q[z]=N[z];else{var H=Q[z-1];z%V?6<V&&z%V==4&&(H=r[H>>>24]<<24|r[H>>>16&255]<<16|r[H>>>8&255]<<8|r[H&255]):(H=H<<8|H>>>24,H=r[H>>>24]<<24|r[H>>>16&255]<<16|r[H>>>8&255]<<8|r[H&255],H^=F[z/V|0]<<24),Q[z]=Q[z-V]^H}for(N=this._invKeySchedule=[],V=0;V<q;V++)z=q-V,H=V%4?Q[z]:Q[z-4],N[V]=4>V||4>=z?H:c[r[H>>>24]]^h[r[H>>>16&255]]^f[r[H>>>8&255]]^m[r[H&255]]},encryptBlock:function(N,V){this._doCryptBlock(N,V,this._keySchedule,o,s,l,u,r)},decryptBlock:function(N,V){var q=N[V+1];N[V+1]=N[V+3],N[V+3]=q,this._doCryptBlock(N,V,this._invKeySchedule,c,h,f,m,n),q=N[V+1],N[V+1]=N[V+3],N[V+3]=q},_doCryptBlock:function(N,V,q,Q,z,H,W,J){for(var G=this._nRounds,re=N[V]^q[0],pe=N[V+1]^q[1],ge=N[V+2]^q[2],j=N[V+3]^q[3],te=4,X=1;X<G;X++)var K=Q[re>>>24]^z[pe>>>16&255]^H[ge>>>8&255]^W[j&255]^q[te++],Z=Q[pe>>>24]^z[ge>>>16&255]^H[j>>>8&255]^W[re&255]^q[te++],ee=Q[ge>>>24]^z[j>>>16&255]^H[re>>>8&255]^W[pe&255]^q[te++],j=Q[j>>>24]^z[re>>>16&255]^H[pe>>>8&255]^W[ge&255]^q[te++],re=K,pe=Z,ge=ee;K=(J[re>>>24]<<24|J[pe>>>16&255]<<16|J[ge>>>8&255]<<8|J[j&255])^q[te++],Z=(J[pe>>>24]<<24|J[ge>>>16&255]<<16|J[j>>>8&255]<<8|J[re&255])^q[te++],ee=(J[ge>>>24]<<24|J[j>>>16&255]<<16|J[re>>>8&255]<<8|J[pe&255])^q[te++],j=(J[j>>>24]<<24|J[re>>>16&255]<<16|J[pe>>>8&255]<<8|J[ge&255])^q[te++],N[V]=K,N[V+1]=Z,N[V+2]=ee,N[V+3]=j},keySize:8});e.AES=t._createHelper(O)})();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var dbits;function BigInteger(e,t,r){e!=null&&(typeof e=="number"?this.fromNumber(e,t,r):t==null&&typeof e!="string"?this.fromString(e,256):this.fromString(e,t))}function nbi(){return new BigInteger(null)}function am1(e,t,r,n,o,s){for(;--s>=0;){var l=t*this[e++]+r[n]+o;o=Math.floor(l/67108864),r[n++]=l&67108863}return o}function am2(e,t,r,n,o,s){for(var l=t&32767,u=t>>15;--s>=0;){var c=this[e]&32767,h=this[e++]>>15,f=u*c+h*l;c=l*c+((f&32767)<<15)+r[n]+(o&1073741823),o=(c>>>30)+(f>>>15)+u*h+(o>>>30),r[n++]=c&1073741823}return o}function am3(e,t,r,n,o,s){for(var l=t&16383,u=t>>14;--s>=0;){var c=this[e]&16383,h=this[e++]>>14,f=u*c+h*l;c=l*c+((f&16383)<<14)+r[n]+o,o=(c>>28)+(f>>14)+u*h,r[n++]=c&268435455}return o}typeof navigator<"u"&&navigator.appName=="Microsoft Internet Explorer"?(BigInteger.prototype.am=am2,dbits=30):typeof navigator<"u"&&navigator.appName!="Netscape"?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28);BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=(1<<dbits)-1;BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;rr=48;for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr=97;for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr=65;for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(e){return BI_RM.charAt(e)}function intAt(e,t){var r=BI_RC[e.charCodeAt(t)];return r??-1}function bnpCopyTo(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function bnpFromInt(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function nbv(e){var t=nbi();return t.fromInt(e),t}function bnpFromString(e,t){var r;if(t==16)r=4;else if(t==8)r=3;else if(t==256)r=8;else if(t==2)r=1;else if(t==32)r=5;else if(t==4)r=2;else{this.fromRadix(e,t);return}this.t=0,this.s=0;for(var n=e.length,o=!1,s=0;--n>=0;){var l=r==8?e[n]&255:intAt(e,n);if(l<0){e.charAt(n)=="-"&&(o=!0);continue}o=!1,s==0?this[this.t++]=l:s+r>this.DB?(this[this.t-1]|=(l&(1<<this.DB-s)-1)<<s,this[this.t++]=l>>this.DB-s):this[this.t-1]|=l<<s,s+=r,s>=this.DB&&(s-=this.DB)}r==8&&e[0]&128&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),o&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function bnToString(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e==8)t=3;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else return this.toRadix(e);var r=(1<<t)-1,n,o=!1,s="",l=this.t,u=this.DB-l*this.DB%t;if(l-- >0)for(u<this.DB&&(n=this[l]>>u)>0&&(o=!0,s=int2char(n));l>=0;)u<t?(n=(this[l]&(1<<u)-1)<<t-u,n|=this[--l]>>(u+=this.DB-t)):(n=this[l]>>(u-=t)&r,u<=0&&(u+=this.DB,--l)),n>0&&(o=!0),o&&(s+=int2char(n));return o?s:"0"}function bnNegate(){var e=nbi();return BigInteger.ZERO.subTo(this,e),e}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(e){var t=this.s-e.s;if(t!=0)return t;var r=this.t;if(t=r-e.t,t!=0)return this.s<0?-t:t;for(;--r>=0;)if((t=this[r]-e[r])!=0)return t;return 0}function nbits(e){var t=1,r;return(r=e>>>16)!=0&&(e=r,t+=16),(r=e>>8)!=0&&(e=r,t+=8),(r=e>>4)!=0&&(e=r,t+=4),(r=e>>2)!=0&&(e=r,t+=2),(r=e>>1)!=0&&(e=r,t+=1),t}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e,t.s=this.s}function bnpDRShiftTo(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s}function bnpLShiftTo(e,t){var r=e%this.DB,n=this.DB-r,o=(1<<n)-1,s=Math.floor(e/this.DB),l=this.s<<r&this.DM,u;for(u=this.t-1;u>=0;--u)t[u+s+1]=this[u]>>n|l,l=(this[u]&o)<<r;for(u=s-1;u>=0;--u)t[u]=0;t[s]=l,t.t=this.t+s+1,t.s=this.s,t.clamp()}function bnpRShiftTo(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t){t.t=0;return}var n=e%this.DB,o=this.DB-n,s=(1<<n)-1;t[0]=this[r]>>n;for(var l=r+1;l<this.t;++l)t[l-r-1]|=(this[l]&s)<<o,t[l-r]=this[l]>>n;n>0&&(t[this.t-r-1]|=(this.s&s)<<o),t.t=this.t-r,t.clamp()}function bnpSubTo(e,t){for(var r=0,n=0,o=Math.min(e.t,this.t);r<o;)n+=this[r]-e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e[r],t[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t[r++]=this.DV+n:n>0&&(t[r++]=n),t.t=r,t.clamp()}function bnpMultiplyTo(e,t){var r=this.abs(),n=e.abs(),o=r.t;for(t.t=o+n.t;--o>=0;)t[o]=0;for(o=0;o<n.t;++o)t[o+r.t]=r.am(0,n[o],t,o,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&BigInteger.ZERO.subTo(t,t)}function bnpSquareTo(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()}function bnpDivRemTo(e,t,r){var n=e.abs();if(!(n.t<=0)){var o=this.abs();if(o.t<n.t){t!=null&&t.fromInt(0),r!=null&&this.copyTo(r);return}r==null&&(r=nbi());var s=nbi(),l=this.s,u=e.s,c=this.DB-nbits(n[n.t-1]);c>0?(n.lShiftTo(c,s),o.lShiftTo(c,r)):(n.copyTo(s),o.copyTo(r));var h=s.t,f=s[h-1];if(f!=0){var m=f*(1<<this.F1)+(h>1?s[h-2]>>this.F2:0),y=this.FV/m,A=(1<<this.F1)/m,M=1<<this.F2,b=r.t,T=b-h,_=t??nbi();for(s.dlShiftTo(T,_),r.compareTo(_)>=0&&(r[r.t++]=1,r.subTo(_,r)),BigInteger.ONE.dlShiftTo(h,_),_.subTo(s,s);s.t<h;)s[s.t++]=0;for(;--T>=0;){var S=r[--b]==f?this.DM:Math.floor(r[b]*y+(r[b-1]+M)*A);if((r[b]+=s.am(0,S,r,T,0,h))<S)for(s.dlShiftTo(T,_),r.subTo(_,r);r[b]<--S;)r.subTo(_,r)}t!=null&&(r.drShiftTo(h,t),l!=u&&BigInteger.ZERO.subTo(t,t)),r.t=h,r.clamp(),c>0&&r.rShiftTo(c,r),l<0&&BigInteger.ZERO.subTo(r,r)}}}function bnMod(e){var t=nbi();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(BigInteger.ZERO)>0&&e.subTo(t,t),t}function Classic(e){this.m=e}function cConvert(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function cRevert(e){return e}function cReduce(e){e.divRemTo(this.m,null,e)}function cMulTo(e,t,r){e.multiplyTo(t,r),this.reduce(r)}function cSqrTo(e,t){e.squareTo(t),this.reduce(t)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1)return 0;var e=this[0];if(!(e&1))return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function Montgomery(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function montConvert(e){var t=nbi();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(BigInteger.ZERO)>0&&this.m.subTo(t,t),t}function montRevert(e){var t=nbi();return e.copyTo(t),this.reduce(t),t}function montReduce(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=e[t]&32767,n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(r=t+this.m.t,e[r]+=this.m.am(0,n,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function montSqrTo(e,t){e.squareTo(t),this.reduce(t)}function montMulTo(e,t,r){e.multiplyTo(t,r),this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,t){if(e>4294967295||e<1)return BigInteger.ONE;var r=nbi(),n=nbi(),o=t.convert(this),s=nbits(e)-1;for(o.copyTo(r);--s>=0;)if(t.sqrTo(r,n),(e&1<<s)>0)t.mulTo(n,o,r);else{var l=r;r=n,n=l}return t.revert(r)}function bnModPowInt(e,t){var r;return e<256||t.isEven()?r=new Classic(t):r=new Montgomery(t),this.exp(e,r)}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/ */function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnpChunkSize(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function bnSigNum(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function bnpToRadix(e){if(e==null&&(e=10),this.signum()==0||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),n=nbv(r),o=nbi(),s=nbi(),l="";for(this.divRemTo(n,o,s);o.signum()>0;)l=(r+s.intValue()).toString(e).substr(1)+l,o.divRemTo(n,o,s);return s.intValue().toString(e)+l}BigInteger.prototype.chunkSize=bnpChunkSize;BigInteger.prototype.toRadix=bnpToRadix;BigInteger.prototype.intValue=bnIntValue;BigInteger.prototype.signum=bnSigNum;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/ */var b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64pad="=";function hex2b64(e){var t,r,n="";for(t=0;t+3<=e.length;t+=3)r=parseInt(e.substring(t,t+3),16),n+=b64map.charAt(r>>6)+b64map.charAt(r&63);for(t+1==e.length?(r=parseInt(e.substring(t,t+1),16),n+=b64map.charAt(r<<2)):t+2==e.length&&(r=parseInt(e.substring(t,t+2),16),n+=b64map.charAt(r>>2)+b64map.charAt((r&3)<<4));(n.length&3)>0;)n+=b64pad;return n}function b64tohex(e){var t="",r,n=0,o,s;for(r=0;r<e.length&&e.charAt(r)!=b64pad;++r)s=b64map.indexOf(e.charAt(r)),!(s<0)&&(n==0?(t+=int2char(s>>2),o=s&3,n=1):n==1?(t+=int2char(o<<2|s>>4),o=s&15,n=2):n==2?(t+=int2char(o),t+=int2char(s>>2),o=s&3,n=3):(t+=int2char(o<<2|s>>4),t+=int2char(s&15),n=0));return n==1&&(t+=int2char(o<<2)),t}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/ */function parseBigInt(e,t){return new BigInteger(e,t)}function pkcs1pad2(e,t){if(t<e.length+11)throw"Message too long for RSA";for(var r=new Array,n=e.length-1;n>=0&&t>0;){var o=e.charCodeAt(n--);o<128?r[--t]=o:o>127&&o<2048?(r[--t]=o&63|128,r[--t]=o>>6|192):(r[--t]=o&63|128,r[--t]=o>>6&63|128,r[--t]=o>>12|224)}r[--t]=0;for(var s=new SecureRandom,l=new Array;t>2;){for(l[0]=0;l[0]==0;)s.nextBytes(l);r[--t]=l[0]}return r[--t]=2,r[--t]=0,new BigInteger(r)}function oaep_mgf1_arr(e,t,r){for(var n="",o=0;n.length<t;)n+=r(String.fromCharCode.apply(String,e.concat([(o&4278190080)>>24,(o&16711680)>>16,(o&65280)>>8,o&255]))),o+=1;return n}function oaep_pad(e,t,r,n){var o=KJUR.crypto.MessageDigest,s=KJUR.crypto.Util,l=null;if(r||(r="sha1"),typeof r=="string"&&(l=o.getCanonicalAlgName(r),n=o.getHashLength(l),r=function(b){return hextorstr(s.hashHex(rstrtohex(b),l))}),e.length+2*n+2>t)throw"Message too long for RSA";var u="",c;for(c=0;c<t-e.length-2*n-2;c+=1)u+="\0";var h=r("")+u+""+e,f=new Array(n);new SecureRandom().nextBytes(f);var m=oaep_mgf1_arr(f,h.length,r),y=[];for(c=0;c<h.length;c+=1)y[c]=h.charCodeAt(c)^m.charCodeAt(c);var A=oaep_mgf1_arr(y,f.length,r),M=[0];for(c=0;c<f.length;c+=1)M[c+1]=f[c]^A.charCodeAt(c);return new BigInteger(M.concat(y))}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function RSASetPublic(e,t){if(this.isPublic=!0,this.isPrivate=!1,typeof e!="string")this.n=e,this.e=t;else if(e!=null&&t!=null&&e.length>0&&t.length>0)this.n=parseBigInt(e,16),this.e=parseInt(t,16);else throw"Invalid RSA public key"}function RSADoPublic(e){return e.modPowInt(this.e,this.n)}function RSAEncrypt(e){var t=pkcs1pad2(e,this.n.bitLength()+7>>3);if(t==null)return null;var r=this.doPublic(t);if(r==null)return null;var n=r.toString(16);return n.length&1?"0"+n:n}function RSAEncryptOAEP(e,t,r){var n=oaep_pad(e,this.n.bitLength()+7>>3,t,r);if(n==null)return null;var o=this.doPublic(n);if(o==null)return null;var s=o.toString(16);return s.length&1?"0"+s:s}RSAKey.prototype.doPublic=RSADoPublic;RSAKey.prototype.setPublic=RSASetPublic;RSAKey.prototype.encrypt=RSAEncrypt;RSAKey.prototype.encryptOAEP=RSAEncryptOAEP;RSAKey.prototype.type="RSA";/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/ */function pkcs1unpad2(e,t){for(var r=e.toByteArray(),n=0;n<r.length&&r[n]==0;)++n;if(r.length-n!=t-1||r[n]!=2)return null;for(++n;r[n]!=0;)if(++n>=r.length)return null;for(var o="";++n<r.length;){var s=r[n]&255;s<128?o+=String.fromCharCode(s):s>191&&s<224?(o+=String.fromCharCode((s&31)<<6|r[n+1]&63),++n):(o+=String.fromCharCode((s&15)<<12|(r[n+1]&63)<<6|r[n+2]&63),n+=2)}return o}function oaep_mgf1_str(e,t,r){for(var n="",o=0;n.length<t;)n+=r(e+String.fromCharCode.apply(String,[(o&4278190080)>>24,(o&16711680)>>16,(o&65280)>>8,o&255])),o+=1;return n}function oaep_unpad(e,t,r,n){var o=KJUR.crypto.MessageDigest,s=KJUR.crypto.Util,l=null;r||(r="sha1"),typeof r=="string"&&(l=o.getCanonicalAlgName(r),n=o.getHashLength(l),r=function(T){return hextorstr(s.hashHex(rstrtohex(T),l))}),e=e.toByteArray();var m;for(m=0;m<e.length;m+=1)e[m]&=255;for(;e.length<t;)e.unshift(0);if(e=String.fromCharCode.apply(String,e),e.length<2*n+2)throw"Cipher too short";var u=e.substr(1,n),c=e.substr(n+1),h=oaep_mgf1_str(c,n,r),f=[],m;for(m=0;m<u.length;m+=1)f[m]=u.charCodeAt(m)^h.charCodeAt(m);var y=oaep_mgf1_str(String.fromCharCode.apply(String,f),e.length-n,r),A=[];for(m=0;m<c.length;m+=1)A[m]=c.charCodeAt(m)^y.charCodeAt(m);if(A=String.fromCharCode.apply(String,A),A.substr(0,n)!==r(""))throw"Hash mismatch";A=A.substr(n);var M=A.indexOf(""),b=M!=-1?A.substr(0,M).lastIndexOf("\0"):-1;if(b+1!=M)throw"Malformed data";return A.substr(M+1)}function RSASetPrivate(e,t,r){if(this.isPrivate=!0,typeof e!="string")this.n=e,this.e=t,this.d=r;else if(e!=null&&t!=null&&e.length>0&&t.length>0)this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(r,16);else throw"Invalid RSA private key"}function RSASetPrivateEx(e,t,r,n,o,s,l,u){if(this.isPrivate=!0,this.isPublic=!1,e==null)throw"RSASetPrivateEx N == null";if(t==null)throw"RSASetPrivateEx E == null";if(e.length==0)throw"RSASetPrivateEx N.length == 0";if(t.length==0)throw"RSASetPrivateEx E.length == 0";if(e!=null&&t!=null&&e.length>0&&t.length>0)this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(r,16),this.p=parseBigInt(n,16),this.q=parseBigInt(o,16),this.dmp1=parseBigInt(s,16),this.dmq1=parseBigInt(l,16),this.coeff=parseBigInt(u,16);else throw"Invalid RSA private key in RSASetPrivateEx"}function RSADoPrivate(e){if(this.p==null||this.q==null)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),r=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(r)<0;)t=t.add(this.p);return t.subtract(r).multiply(this.coeff).mod(this.p).multiply(this.q).add(r)}function RSADecrypt(e){if(e.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var t=parseBigInt(e,16),r=this.doPrivate(t);return r==null?null:pkcs1unpad2(r,this.n.bitLength()+7>>3)}function RSADecryptOAEP(e,t,r){if(e.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var n=parseBigInt(e,16),o=this.doPrivate(n);return o==null?null:oaep_unpad(o,this.n.bitLength()+7>>3,t,r)}RSAKey.prototype.doPrivate=RSADoPrivate;RSAKey.prototype.setPrivate=RSASetPrivate;RSAKey.prototype.setPrivateEx=RSASetPrivateEx;RSAKey.prototype.decrypt=RSADecrypt;RSAKey.prototype.decryptOAEP=RSADecryptOAEP;(typeof KJUR.lang>"u"||!KJUR.lang)&&(KJUR.lang={});KJUR.lang.String=function(){};function b64utob64(e){return e.length%4==2?e=e+"==":e.length%4==3&&(e=e+"="),e=e.replace(/-/g,"+"),e=e.replace(/_/g,"/"),e}function b64utohex(e){return b64tohex(b64utob64(e))}function hextoutf8(e){return decodeURIComponent(hextouricmp(e))}function hextorstr(e){for(var t="",r=0;r<e.length-1;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t}function rstrtohex(e){for(var t="",r=0;r<e.length;r++)t+=("0"+e.charCodeAt(r).toString(16)).slice(-2);return t}function hextob64(e){return hex2b64(e)}function hextob64nl(e){var t=hextob64(e),r=t.replace(/(.{64})/g,`$1\r
`);return r=r.replace(/\r\n$/,""),r}function b64nltohex(e){var t=e.replace(/[^0-9A-Za-z\/+=]*/g,""),r=b64tohex(t);return r}function hextopem(e,t){var r=hextob64nl(e);return"-----BEGIN "+t+`-----\r
`+r+`\r
-----END `+t+`-----\r
`}function pemtohex(e,t){if(e.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+t;return t!==void 0?(e=e.replace(new RegExp("^[^]*-----BEGIN "+t+"-----"),""),e=e.replace(new RegExp("-----END "+t+"-----[^]*$"),"")):(e=e.replace(/^[^]*-----BEGIN [^-]+-----/,""),e=e.replace(/-----END [^-]+-----[^]*$/,"")),b64nltohex(e)}function hextouricmp(e){return e.replace(/(..)/g,"%$1")}function hextoipv6(e){if(!e.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";e=e.toLowerCase();for(var t=e.match(/.{1,4}/g),r=0;r<8;r++)t[r]=t[r].replace(/^0+/,""),t[r]==""&&(t[r]="0");e=":"+t.join(":")+":";var n=e.match(/:(0:){2,}/g);if(n===null)return e.slice(1,-1);for(var o="",r=0;r<n.length;r++)n[r].length>o.length&&(o=n[r]);return e=e.replace(o,"::"),e.slice(1,-1)}function hextoip(e){var t="malformed hex value";if(!e.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw t;if(e.length==8){var r;try{return r=parseInt(e.substr(0,2),16)+"."+parseInt(e.substr(2,2),16)+"."+parseInt(e.substr(4,2),16)+"."+parseInt(e.substr(6,2),16),r}catch{throw t}}else return e.length==32?hextoipv6(e):e}function ucs2hextoutf8(e){function t(o){var s=parseInt(o.substr(0,2),16),l=parseInt(o.substr(2),16);if(s==0&l<128)return String.fromCharCode(l);if(s<8){var u=192|(s&7)<<3|(l&192)>>6,c=128|l&63;return hextoutf8(u.toString(16)+c.toString(16))}var u=224|(s&240)>>4,c=128|(s&15)<<2|(l&192)>>6,h=128|l&63;return hextoutf8(u.toString(16)+c.toString(16)+h.toString(16))}var r=e.match(/.{4}/g),n=r.map(t);return n.join("")}KJUR.lang.String.isHex=function(e){return ishex(e)};function ishex(e){return!!(e.length%2==0&&(e.match(/^[0-9a-f]+$/)||e.match(/^[0-9A-F]+$/)))}KJUR.lang.String.isMail=function(e){return e.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};function hextoposhex(e){return e.length%2==1?"0"+e:e.substr(0,1)>"7"?"00"+e:e}function hextooid(e){if(!ishex(e))return null;try{var t=[],r=e.substr(0,2),n=parseInt(r,16);t[0]=new String(Math.floor(n/40)),t[1]=new String(n%40);for(var o=e.substr(2),s=[],l=0;l<o.length/2;l++)s.push(parseInt(o.substr(l*2,2),16));for(var u=[],c="",l=0;l<s.length;l++)s[l]&128?c=c+strpad((s[l]&127).toString(2),7):(c=c+strpad((s[l]&127).toString(2),7),u.push(new String(parseInt(c,2))),c="");var h=t.join(".");return u.length>0&&(h=h+"."+u.join(".")),h}catch{return null}}var strpad=function(e,t,r){return r==null&&(r="0"),e.length>=t?e:new Array(t-e.length+1).join(r)+e};function bitstrtoint(e){try{var t=e.substr(0,2);if(t=="00")return parseInt(e.substr(2),16);var r=parseInt(t,16),n=e.substr(2),o=parseInt(n,16).toString(2);return o=="0"&&(o="00000000"),o=o.slice(0,0-r),parseInt(o,2)}catch{return-1}}(typeof KJUR.crypto>"u"||!KJUR.crypto)&&(KJUR.crypto={});KJUR.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:CryptoJS.algo.MD5,sha1:CryptoJS.algo.SHA1,sha224:CryptoJS.algo.SHA224,sha256:CryptoJS.algo.SHA256,sha384:CryptoJS.algo.SHA384,sha512:CryptoJS.algo.SHA512,ripemd160:CryptoJS.algo.RIPEMD160},this.hashString=function(e,t){var r=new KJUR.crypto.MessageDigest({alg:t});return r.digestString(e)},this.hashHex=function(e,t){var r=new KJUR.crypto.MessageDigest({alg:t});return r.digestHex(e)},this.sha1=function(e){return this.hashString(e,"sha1")},this.sha256=function(e){return this.hashString(e,"sha256")},this.sha256Hex=function(e){return this.hashHex(e,"sha256")},this.sha512=function(e){return this.hashString(e,"sha512")},this.sha512Hex=function(e){return this.hashHex(e,"sha512")}};KJUR.crypto.MessageDigest=function(e){this.setAlgAndProvider=function(t,r){if(t=KJUR.crypto.MessageDigest.getCanonicalAlgName(t),t!==null&&r===void 0&&(r=KJUR.crypto.Util.DEFAULTPROVIDER[t]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(t)!=-1&&r=="cryptojs"){try{this.md=KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[t].create()}catch(n){throw"setAlgAndProvider hash alg set fail alg="+t+"/"+n}this.updateString=function(n){this.md.update(n)},this.updateHex=function(n){var o=CryptoJS.enc.Hex.parse(n);this.md.update(o)},this.digest=function(){var n=this.md.finalize();return n.toString(CryptoJS.enc.Hex)},this.digestString=function(n){return this.updateString(n),this.digest()},this.digestHex=function(n){return this.updateHex(n),this.digest()}}if(":sha256:".indexOf(t)!=-1&&r=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(n){throw"setAlgAndProvider hash alg set fail alg="+t+"/"+n}this.updateString=function(n){this.md.update(n)},this.updateHex=function(n){var o=sjcl.codec.hex.toBits(n);this.md.update(o)},this.digest=function(){var n=this.md.finalize();return sjcl.codec.hex.fromBits(n)},this.digestString=function(n){return this.updateString(n),this.digest()},this.digestHex=function(n){return this.updateHex(n),this.digest()}}},this.updateString=function(t){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(t){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(t){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},e!==void 0&&e.alg!==void 0&&(this.algName=e.alg,e.prov===void 0&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))};KJUR.crypto.MessageDigest.getCanonicalAlgName=function(e){return typeof e=="string"&&(e=e.toLowerCase(),e=e.replace(/-/,"")),e};KJUR.crypto.MessageDigest.getHashLength=function(e){var t=KJUR.crypto.MessageDigest,r=t.getCanonicalAlgName(e);if(t.HASHLENGTH[r]===void 0)throw"not supported algorithm: "+e;return t.HASHLENGTH[r]};KJUR.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20};KJUR.crypto.Signature=function(e){var t=null;if(this._setAlgNames=function(){var r=this.algName.match(/^(.+)with(.+)$/);r&&(this.mdAlgName=r[1].toLowerCase(),this.pubkeyAlgName=r[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(r,n){for(var o="",s=n/4-r.length,l=0;l<s;l++)o=o+"0";return o+r},this.setAlgAndProvider=function(r,n){if(this._setAlgNames(),n!="cryptojs/jsrsa")throw new Error("provider not supported: "+n);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new KJUR.crypto.MessageDigest({alg:this.mdAlgName})}catch(o){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+o)}this.init=function(o,s){var l=null;try{s===void 0?l=KEYUTIL.getKey(o):l=KEYUTIL.getKey(o,s)}catch(u){throw"init failed:"+u}if(l.isPrivate===!0)this.prvKey=l,this.state="SIGN";else if(l.isPublic===!0)this.pubKey=l,this.state="VERIFY";else throw"init failed.:"+l},this.updateString=function(o){this.md.updateString(o)},this.updateHex=function(o){this.md.updateHex(o)},this.verify=function(o){if(this.sHashHex=this.md.digest(),this.pubKey instanceof RSAKey&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,o,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof RSAKey&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,o);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(r,n){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(r){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(r){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(r){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=e,e!==void 0&&(e.alg!==void 0&&(this.algName=e.alg,e.prov===void 0?this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=e.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),e.psssaltlen!==void 0&&(this.pssSaltLen=e.psssaltlen),e.prvkeypem!==void 0)){if(e.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{var t=KEYUTIL.getKey(e.prvkeypem);this.init(t)}catch(r){throw"fatal error to load pem private key: "+r}}};KJUR.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}};var KEYUTIL=function(){var e=function(M,b,T){return n(CryptoJS.AES,M,b,T)},t=function(M,b,T){return n(CryptoJS.TripleDES,M,b,T)},r=function(M,b,T){return n(CryptoJS.DES,M,b,T)},n=function(M,b,T,_){var S=CryptoJS.enc.Hex.parse(b),C=CryptoJS.enc.Hex.parse(T),P=CryptoJS.enc.Hex.parse(_),F={};F.key=C,F.iv=P,F.ciphertext=S;var O=M.decrypt(F,C,{iv:P});return CryptoJS.enc.Hex.stringify(O)},o=function(M,b,T){return u(CryptoJS.AES,M,b,T)},s=function(M,b,T){return u(CryptoJS.TripleDES,M,b,T)},l=function(M,b,T){return u(CryptoJS.DES,M,b,T)},u=function(M,b,T,_){var S=CryptoJS.enc.Hex.parse(b),C=CryptoJS.enc.Hex.parse(T),P=CryptoJS.enc.Hex.parse(_),F=M.encrypt(S,C,{iv:P}),O=CryptoJS.enc.Hex.parse(F.toString()),N=CryptoJS.enc.Base64.stringify(O);return N},c={"AES-256-CBC":{proc:e,eproc:o,keylen:32,ivlen:16},"AES-192-CBC":{proc:e,eproc:o,keylen:24,ivlen:16},"AES-128-CBC":{proc:e,eproc:o,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:t,eproc:s,keylen:24,ivlen:8},"DES-CBC":{proc:r,eproc:l,keylen:8,ivlen:8}},h=function(M){var b=CryptoJS.lib.WordArray.random(M),T=CryptoJS.enc.Hex.stringify(b);return T},f=function(M){var b={},T=M.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));T&&(b.cipher=T[1],b.ivsalt=T[2]);var _=M.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));_&&(b.type=_[1]);var S=-1,C=0;M.indexOf(`\r
\r
`)!=-1&&(S=M.indexOf(`\r
\r
`),C=2),M.indexOf(`

`)!=-1&&(S=M.indexOf(`

`),C=1);var P=M.indexOf("-----END");if(S!=-1&&P!=-1){var F=M.substring(S+C*2,P-C);F=F.replace(/\s+/g,""),b.data=F}return b},m=function(M,b,T){for(var _=T.substring(0,16),S=CryptoJS.enc.Hex.parse(_),C=CryptoJS.enc.Utf8.parse(b),P=c[M].keylen+c[M].ivlen,F="",O=null;;){var N=CryptoJS.algo.MD5.create();if(O!=null&&N.update(O),N.update(C),N.update(S),O=N.finalize(),F=F+CryptoJS.enc.Hex.stringify(O),F.length>=P*2)break}var V={};return V.keyhex=F.substr(0,c[M].keylen*2),V.ivhex=F.substr(c[M].keylen*2,c[M].ivlen*2),V},y=function(M,b,T,_){var S=CryptoJS.enc.Base64.parse(M),C=CryptoJS.enc.Hex.stringify(S),P=c[b].proc,F=P(C,T,_);return F},A=function(M,b,T,_){var S=c[b].eproc,C=S(M,T,_);return C};return{version:"1.0.0",parsePKCS5PEM:function(M){return f(M)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(M,b,T){return m(M,b,T)},decryptKeyB64:function(M,b,T,_){return y(M,b,T,_)},getDecryptedKeyHex:function(M,b){var T=f(M),_=T.cipher,S=T.ivsalt,C=T.data,P=m(_,b,S),F=P.keyhex,O=y(C,_,F,S);return O},getEncryptedPKCS5PEMFromPrvKeyHex:function(M,b,T,_,S){var q="";if((typeof _>"u"||_==null)&&(_="AES-256-CBC"),typeof c[_]>"u")throw"KEYUTIL unsupported algorithm: "+_;if(typeof S>"u"||S==null){var C=c[_].ivlen,P=h(C);S=P.toUpperCase()}var F=m(_,T,S),O=F.keyhex,N=A(b,_,O,S),V=N.replace(/(.{64})/g,`$1\r
`),q="-----BEGIN "+M+` PRIVATE KEY-----\r
`;return q+=`Proc-Type: 4,ENCRYPTED\r
`,q+="DEK-Info: "+_+","+S+`\r
`,q+=`\r
`,q+=V,q+=`\r
-----END `+M+` PRIVATE KEY-----\r
`,q},parseHexOfEncryptedPKCS8:function(M){var b=ASN1HEX,T=b.getChildIdx,_=b.getV,S={},C=T(M,0);if(C.length!=2)throw"malformed format: SEQUENCE(0).items != 2: "+C.length;S.ciphertext=_(M,C[1]);var P=T(M,C[0]);if(P.length!=2)throw"malformed format: SEQUENCE(0.0).items != 2: "+P.length;if(_(M,P[0])!="2a864886f70d01050d")throw"this only supports pkcs5PBES2";var F=T(M,P[1]);if(P.length!=2)throw"malformed format: SEQUENCE(0.0.1).items != 2: "+F.length;var O=T(M,F[1]);if(O.length!=2)throw"malformed format: SEQUENCE(0.0.1.1).items != 2: "+O.length;if(_(M,O[0])!="2a864886f70d0307")throw"this only supports TripleDES";S.encryptionSchemeAlg="TripleDES",S.encryptionSchemeIV=_(M,O[1]);var N=T(M,F[0]);if(N.length!=2)throw"malformed format: SEQUENCE(0.0.1.0).items != 2: "+N.length;if(_(M,N[0])!="2a864886f70d01050c")throw"this only supports pkcs5PBKDF2";var V=T(M,N[1]);if(V.length<2)throw"malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+V.length;S.pbkdf2Salt=_(M,V[0]);var q=_(M,V[1]);try{S.pbkdf2Iter=parseInt(q,16)}catch{throw"malformed format pbkdf2Iter: "+q}return S},getPBKDF2KeyHexFromParam:function(M,b){var T=CryptoJS.enc.Hex.parse(M.pbkdf2Salt),_=M.pbkdf2Iter,S=CryptoJS.PBKDF2(b,T,{keySize:192/32,iterations:_}),C=CryptoJS.enc.Hex.stringify(S);return C},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(M,b){var T=pemtohex(M,"ENCRYPTED PRIVATE KEY"),_=this.parseHexOfEncryptedPKCS8(T),S=KEYUTIL.getPBKDF2KeyHexFromParam(_,b),C={};C.ciphertext=CryptoJS.enc.Hex.parse(_.ciphertext);var P=CryptoJS.enc.Hex.parse(S),F=CryptoJS.enc.Hex.parse(_.encryptionSchemeIV),O=CryptoJS.TripleDES.decrypt(C,P,{iv:F}),N=CryptoJS.enc.Hex.stringify(O);return N},getKeyFromEncryptedPKCS8PEM:function(M,b){var T=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(M,b),_=this.getKeyFromPlainPrivatePKCS8Hex(T);return _},parsePlainPrivatePKCS8Hex:function(M){var b=ASN1HEX,T=b.getChildIdx,_=b.getV,S={};if(S.algparam=null,M.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var C=T(M,0);if(C.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(M.substr(C[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var P=T(M,C[1]);if(P.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(M.substr(P[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(S.algoid=_(M,P[0]),M.substr(P[1],2)=="06"&&(S.algparam=_(M,P[1])),M.substr(C[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return S.keyidx=b.getVidx(M,C[2]),S},getKeyFromPlainPrivatePKCS8PEM:function(M){var b=pemtohex(M,"PRIVATE KEY"),T=this.getKeyFromPlainPrivatePKCS8Hex(b);return T},getKeyFromPlainPrivatePKCS8Hex:function(M){var b=this.parsePlainPrivatePKCS8Hex(M),T;if(b.algoid=="2a864886f70d010101")T=new RSAKey;else if(KJUR.crypto.DSA&&b.algoid=="2a8648ce380401")T=new KJUR.crypto.DSA;else if(KJUR.crypto.ECDSA&&b.algoid=="2a8648ce3d0201")T=new KJUR.crypto.ECDSA;else throw"unsupported private key algorithm";return T.readPKCS8PrvKeyHex(M),T},_getKeyFromPublicPKCS8Hex:function(M){var b,T=ASN1HEX.getVbyList(M,0,[0,0],"06");if(T==="2a864886f70d010101")b=new RSAKey;else if(KJUR.crypto.DSA&&T==="2a8648ce380401")b=new KJUR.crypto.DSA;else if(KJUR.crypto.ECDSA&&T==="2a8648ce3d0201")b=new KJUR.crypto.ECDSA;else throw"unsupported PKCS#8 public key hex";return b.readPKCS8PubKeyHex(M),b},parsePublicRawRSAKeyHex:function(M){var b=ASN1HEX,T=b.getChildIdx,_=b.getV,S={};if(M.substr(0,2)!="30")throw"malformed RSA key(code:001)";var C=T(M,0);if(C.length!=2)throw"malformed RSA key(code:002)";if(M.substr(C[0],2)!="02")throw"malformed RSA key(code:003)";if(S.n=_(M,C[0]),M.substr(C[1],2)!="02")throw"malformed RSA key(code:004)";return S.e=_(M,C[1]),S},parsePublicPKCS8Hex:function(M){var b=ASN1HEX,T=b.getChildIdx,_=b.getV,S={};S.algparam=null;var C=T(M,0);if(C.length!=2)throw"outer DERSequence shall have 2 elements: "+C.length;var P=C[0];if(M.substr(P,2)!="30")throw"malformed PKCS8 public key(code:001)";var F=T(M,P);if(F.length!=2)throw"malformed PKCS8 public key(code:002)";if(M.substr(F[0],2)!="06")throw"malformed PKCS8 public key(code:003)";if(S.algoid=_(M,F[0]),M.substr(F[1],2)=="06"?S.algparam=_(M,F[1]):M.substr(F[1],2)=="30"&&(S.algparam={},S.algparam.p=b.getVbyList(M,F[1],[0],"02"),S.algparam.q=b.getVbyList(M,F[1],[1],"02"),S.algparam.g=b.getVbyList(M,F[1],[2],"02")),M.substr(C[1],2)!="03")throw"malformed PKCS8 public key(code:004)";return S.key=_(M,C[1]).substr(2),S}}}();KEYUTIL.getKey=function(e,t,r){var n=ASN1HEX,o=n.getChildIdx;n.getV;var s=n.getVbyList,l=KJUR.crypto,u=l.ECDSA,c=l.DSA,h=RSAKey,f=pemtohex,m=KEYUTIL;if(typeof h<"u"&&e instanceof h||typeof u<"u"&&e instanceof u||typeof c<"u"&&e instanceof c)return e;if(e.curve!==void 0&&e.xy!==void 0&&e.d===void 0)return new u({pub:e.xy,curve:e.curve});if(e.curve!==void 0&&e.d!==void 0)return new u({prv:e.d,curve:e.curve});if(e.kty===void 0&&e.n!==void 0&&e.e!==void 0&&e.d===void 0){var y=new h;return y.setPublic(e.n,e.e),y}if(e.kty===void 0&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0&&e.p!==void 0&&e.q!==void 0&&e.dp!==void 0&&e.dq!==void 0&&e.co!==void 0&&e.qi===void 0){var y=new h;return y.setPrivateEx(e.n,e.e,e.d,e.p,e.q,e.dp,e.dq,e.co),y}if(e.kty===void 0&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0&&e.p===void 0){var y=new h;return y.setPrivate(e.n,e.e,e.d),y}if(e.p!==void 0&&e.q!==void 0&&e.g!==void 0&&e.y!==void 0&&e.x===void 0){var y=new c;return y.setPublic(e.p,e.q,e.g,e.y),y}if(e.p!==void 0&&e.q!==void 0&&e.g!==void 0&&e.y!==void 0&&e.x!==void 0){var y=new c;return y.setPrivate(e.p,e.q,e.g,e.y,e.x),y}if(e.kty==="RSA"&&e.n!==void 0&&e.e!==void 0&&e.d===void 0){var y=new h;return y.setPublic(b64utohex(e.n),b64utohex(e.e)),y}if(e.kty==="RSA"&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0&&e.p!==void 0&&e.q!==void 0&&e.dp!==void 0&&e.dq!==void 0&&e.qi!==void 0){var y=new h;return y.setPrivateEx(b64utohex(e.n),b64utohex(e.e),b64utohex(e.d),b64utohex(e.p),b64utohex(e.q),b64utohex(e.dp),b64utohex(e.dq),b64utohex(e.qi)),y}if(e.kty==="RSA"&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0){var y=new h;return y.setPrivate(b64utohex(e.n),b64utohex(e.e),b64utohex(e.d)),y}if(e.kty==="EC"&&e.crv!==void 0&&e.x!==void 0&&e.y!==void 0&&e.d===void 0){var A=new u({curve:e.crv}),M=A.ecparams.keylen/4,b=("0000000000"+b64utohex(e.x)).slice(-M),T=("0000000000"+b64utohex(e.y)).slice(-M),_="04"+b+T;return A.setPublicKeyHex(_),A}if(e.kty==="EC"&&e.crv!==void 0&&e.x!==void 0&&e.y!==void 0&&e.d!==void 0){var A=new u({curve:e.crv}),M=A.ecparams.keylen/4,b=("0000000000"+b64utohex(e.x)).slice(-M),T=("0000000000"+b64utohex(e.y)).slice(-M),_="04"+b+T,S=("0000000000"+b64utohex(e.d)).slice(-M);return A.setPublicKeyHex(_),A.setPrivateKeyHex(S),A}if(r==="pkcs5prv"){var C=e,n=ASN1HEX,P,y;if(P=o(C,0),P.length===9)y=new h,y.readPKCS5PrvKeyHex(C);else if(P.length===6)y=new c,y.readPKCS5PrvKeyHex(C);else if(P.length>2&&C.substr(P[1],2)==="04")y=new u,y.readPKCS5PrvKeyHex(C);else throw"unsupported PKCS#1/5 hexadecimal key";return y}if(r==="pkcs8prv"){var y=m.getKeyFromPlainPrivatePKCS8Hex(e);return y}if(r==="pkcs8pub")return m._getKeyFromPublicPKCS8Hex(e);if(r==="x509pub")return X509.getPublicKeyFromCertHex(e);if(e.indexOf("-END CERTIFICATE-",0)!=-1||e.indexOf("-END X509 CERTIFICATE-",0)!=-1||e.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return X509.getPublicKeyFromCertPEM(e);if(e.indexOf("-END PUBLIC KEY-")!=-1){var F=pemtohex(e,"PUBLIC KEY");return m._getKeyFromPublicPKCS8Hex(F)}if(e.indexOf("-END RSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")==-1){var O=f(e,"RSA PRIVATE KEY");return m.getKey(O,null,"pkcs5prv")}if(e.indexOf("-END DSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")==-1){var N=f(e,"DSA PRIVATE KEY"),V=s(N,0,[1],"02"),q=s(N,0,[2],"02"),Q=s(N,0,[3],"02"),z=s(N,0,[4],"02"),H=s(N,0,[5],"02"),y=new c;return y.setPrivate(new BigInteger(V,16),new BigInteger(q,16),new BigInteger(Q,16),new BigInteger(z,16),new BigInteger(H,16)),y}if(e.indexOf("-END EC PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")==-1){var O=f(e,"EC PRIVATE KEY");return m.getKey(O,null,"pkcs5prv")}if(e.indexOf("-END PRIVATE KEY-")!=-1)return m.getKeyFromPlainPrivatePKCS8PEM(e);if(e.indexOf("-END RSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")!=-1){var W=m.getDecryptedKeyHex(e,t),J=new RSAKey;return J.readPKCS5PrvKeyHex(W),J}if(e.indexOf("-END EC PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")!=-1){var N=m.getDecryptedKeyHex(e,t),y=s(N,0,[1],"04"),G=s(N,0,[2,0],"06"),te=s(N,0,[3,0],"03").substr(2),X="";if(KJUR.crypto.OID.oidhex2name[G]!==void 0)X=KJUR.crypto.OID.oidhex2name[G];else throw"undefined OID(hex) in KJUR.crypto.OID: "+G;var A=new u({curve:X});return A.setPublicKeyHex(te),A.setPrivateKeyHex(y),A.isPublic=!1,A}if(e.indexOf("-END DSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")!=-1){var N=m.getDecryptedKeyHex(e,t),V=s(N,0,[1],"02"),q=s(N,0,[2],"02"),Q=s(N,0,[3],"02"),z=s(N,0,[4],"02"),H=s(N,0,[5],"02"),y=new c;return y.setPrivate(new BigInteger(V,16),new BigInteger(q,16),new BigInteger(Q,16),new BigInteger(z,16),new BigInteger(H,16)),y}if(e.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return m.getKeyFromEncryptedPKCS8PEM(e,t);throw new Error("not supported argument")};(typeof KJUR.asn1>"u"||!KJUR.asn1)&&(KJUR.asn1={});KJUR.asn1.ASN1Util={};KJUR.asn1.ASN1Util.oidHexToInt=function(e){for(var o="",t=parseInt(e.substr(0,2),16),r=Math.floor(t/40),n=t%40,o=r+"."+n,s="",l=2;l<e.length;l+=2){var u=parseInt(e.substr(l,2),16),c=("00000000"+u.toString(2)).slice(-8);if(s=s+c.substr(1,7),c.substr(0,1)=="0"){var h=new BigInteger(s,2);o=o+"."+h.toString(10),s=""}}return o};var ASN1HEX=new function(){};ASN1HEX.getLblen=function(e,t){if(e.substr(t+2,1)!="8")return 1;var r=parseInt(e.substr(t+3,1));return r==0?-1:0<r&&r<10?r+1:-2};ASN1HEX.getL=function(e,t){var r=ASN1HEX.getLblen(e,t);return r<1?"":e.substr(t+2,r*2)};ASN1HEX.getVblen=function(e,t){var r,n;return r=ASN1HEX.getL(e,t),r==""?-1:(r.substr(0,1)==="8"?n=new BigInteger(r.substr(2),16):n=new BigInteger(r,16),n.intValue())};ASN1HEX.getVidx=function(e,t){var r=ASN1HEX.getLblen(e,t);return r<0?r:t+(r+1)*2};ASN1HEX.getV=function(e,t){var r=ASN1HEX.getVidx(e,t),n=ASN1HEX.getVblen(e,t);return e.substr(r,n*2)};ASN1HEX.getTLV=function(e,t){return e.substr(t,2)+ASN1HEX.getL(e,t)+ASN1HEX.getV(e,t)};ASN1HEX.getTLVblen=function(e,t){return 2+ASN1HEX.getLblen(e,t)*2+ASN1HEX.getVblen(e,t)*2};ASN1HEX.getNextSiblingIdx=function(e,t){var r=ASN1HEX.getVidx(e,t),n=ASN1HEX.getVblen(e,t);return r+n*2};ASN1HEX.getChildIdx=function(e,t){var r=ASN1HEX,n=[],o,s,l;o=r.getVidx(e,t),s=r.getVblen(e,t)*2,e.substr(t,2)=="03"&&(o+=2,s-=2),l=0;for(var u=o;l<=s;){var c=r.getTLVblen(e,u);if(l+=c,l<=s&&n.push(u),u+=c,l>=s)break}return n};ASN1HEX.getNthChildIdx=function(e,t,r){var n=ASN1HEX.getChildIdx(e,t);return n[r]};ASN1HEX.getIdxbyList=function(e,t,r,n){var o=ASN1HEX,s,l;return r.length==0?n!==void 0&&e.substr(t,2)!==n?-1:t:(s=r.shift(),l=o.getChildIdx(e,t),s>=l.length?-1:o.getIdxbyList(e,l[s],r,n))};ASN1HEX.getIdxbyListEx=function(e,t,r,n){var o=ASN1HEX,s,l;if(r.length==0)return n!==void 0&&e.substr(t,2)!==n?-1:t;s=r.shift(),l=o.getChildIdx(e,t);for(var u=0,c=0;c<l.length;c++){var h=e.substr(l[c],2);if(typeof s=="number"&&!o.isContextTag(h)&&u==s||typeof s=="string"&&o.isContextTag(h,s))return o.getIdxbyListEx(e,l[c],r,n);o.isContextTag(h)||u++}return-1};ASN1HEX.getTLVbyList=function(e,t,r,n){var o=ASN1HEX,s=o.getIdxbyList(e,t,r,n);return s==-1||s>=e.length?null:o.getTLV(e,s)};ASN1HEX.getTLVbyListEx=function(e,t,r,n){var o=ASN1HEX,s=o.getIdxbyListEx(e,t,r,n);return s==-1?null:o.getTLV(e,s)};ASN1HEX.getVbyList=function(e,t,r,n,o){var s=ASN1HEX,l,u;return l=s.getIdxbyList(e,t,r,n),l==-1||l>=e.length?null:(u=s.getV(e,l),o===!0&&(u=u.substr(2)),u)};ASN1HEX.getVbyListEx=function(e,t,r,n,o){var s=ASN1HEX,l,u;return l=s.getIdxbyListEx(e,t,r,n),l==-1?null:(u=s.getV(e,l),e.substr(l,2)=="03"&&o!==!1&&(u=u.substr(2)),u)};ASN1HEX.getInt=function(e,t,r){r==null&&(r=-1);try{var n=e.substr(t,2);if(n!="02"&&n!="03")return r;var o=ASN1HEX.getV(e,t);return n=="02"?parseInt(o,16):bitstrtoint(o)}catch{return r}};ASN1HEX.getOID=function(e,t,r){r==null&&(r=null);try{if(e.substr(t,2)!="06")return r;var n=ASN1HEX.getV(e,t);return hextooid(n)}catch{return r}};ASN1HEX.getOIDName=function(e,t,r){r==null&&(r=null);try{var n=ASN1HEX.getOID(e,t,r);if(n==r)return r;var o=KJUR.asn1.x509.OID.oid2name(n);return o==""?n:o}catch{return r}};ASN1HEX.getString=function(e,t,r){r==null&&(r=null);try{var n=ASN1HEX.getV(e,t);return hextorstr(n)}catch{return r}};ASN1HEX.hextooidstr=function(e){var t=function(m,y){return m.length>=y?m:new Array(y-m.length+1).join("0")+m},r=[],n=e.substr(0,2),o=parseInt(n,16);r[0]=new String(Math.floor(o/40)),r[1]=new String(o%40);for(var s=e.substr(2),l=[],u=0;u<s.length/2;u++)l.push(parseInt(s.substr(u*2,2),16));for(var c=[],h="",u=0;u<l.length;u++)l[u]&128?h=h+t((l[u]&127).toString(2),7):(h=h+t((l[u]&127).toString(2),7),c.push(new String(parseInt(h,2))),h="");var f=r.join(".");return c.length>0&&(f=f+"."+c.join(".")),f};ASN1HEX.isContextTag=function(e,t){e=e.toLowerCase();var r,n;try{r=parseInt(e,16)}catch{return-1}if(t===void 0)return(r&192)==128;try{var o=t.match(/^\[[0-9]+\]$/);return o==null||(n=parseInt(t.substr(1,t.length-1),10),n>31)?!1:(r&192)==128&&(r&31)==n}catch{return!1}};ASN1HEX.isASN1HEX=function(e){var t=ASN1HEX;if(e.length%2==1)return!1;var r=t.getVblen(e,0),n=e.substr(0,2),o=t.getL(e,0),s=e.length-n.length-o.length;return s==r*2};ASN1HEX.checkStrictDER=function(e,t,r,n,o){var s=ASN1HEX;if(r===void 0){if(typeof e!="string")throw new Error("not hex string");if(e=e.toLowerCase(),!KJUR.lang.String.isHex(e))throw new Error("not hex string");r=e.length,n=e.length/2,n<128?o=1:o=Math.ceil(n.toString(16))+1}var l=s.getL(e,t);if(l.length>o*2)throw new Error("L of TLV too long: idx="+t);var u=s.getVblen(e,t);if(u>n)throw new Error("value of L too long than hex: idx="+t);var c=s.getTLV(e,t),h=c.length-2-s.getL(e,t).length;if(h!==u*2)throw new Error("V string length and L's value not the same:"+h+"/"+u*2);if(t===0&&e.length!=c.length)throw new Error("total length and TLV length unmatch:"+e.length+"!="+c.length);var f=e.substr(t,2);if(f==="02"){var m=s.getVidx(e,t);if(e.substr(m,2)=="00"&&e.charCodeAt(m+2)<56)throw new Error("not least zeros for DER INTEGER")}if(parseInt(f,16)&32){for(var y=s.getVblen(e,t),A=0,M=s.getChildIdx(e,t),b=0;b<M.length;b++){var T=s.getTLV(e,M[b]);A+=T.length,s.checkStrictDER(e,M[b],r,n,o)}if(y*2!=A)throw new Error("sum of children's TLV length and L unmatch: "+y*2+"!="+A)}};ASN1HEX.oidname=function(e){var t=KJUR.asn1;KJUR.lang.String.isHex(e)&&(e=t.ASN1Util.oidHexToInt(e));var r=t.x509.OID.oid2name(e);return r===""&&(r=e),r};(typeof KJUR.asn1>"u"||!KJUR.asn1)&&(KJUR.asn1={});(typeof KJUR.asn1.x509>"u"||!KJUR.asn1.x509)&&(KJUR.asn1.x509={});KJUR.asn1.x509.AlgorithmIdentifier={};KJUR.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"};KJUR.asn1.x509.OID=new function(e){this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.name2oidList={sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1"},this.objCache={},this.name2obj=function(t){if(typeof this.objCache[t]<"u")return this.objCache[t];if(typeof this.name2oidList[t]>"u")throw"Name of ObjectIdentifier not defined: "+t;var r=this.name2oidList[t],n=new KJUR.asn1.DERObjectIdentifier({oid:r});return this.objCache[t]=n,n},this.atype2obj=function(t){if(this.objCache[t]!==void 0)return this.objCache[t];var r;if(t.match(/^\d+\.\d+\.[0-9.]+$/))r=t;else if(this.atype2oidList[t]!==void 0)r=this.atype2oidList[t];else if(this.name2oidList[t]!==void 0)r=this.name2oidList[t];else throw"AttributeType name undefined: "+t;var n=new KJUR.asn1.DERObjectIdentifier({oid:r});return this.objCache[t]=n,n}};KJUR.asn1.x509.OID.oid2name=function(e){var t=KJUR.asn1.x509.OID.name2oidList;for(var r in t)if(t[r]==e)return r;return""};KJUR.asn1.x509.OID.oid2atype=function(e){var t=KJUR.asn1.x509.OID.atype2oidList;for(var r in t)if(t[r]==e)return r;return e};KJUR.asn1.x509.OID.name2oid=function(e){if(e.match(/^[0-9.]+$/))return e;var t=KJUR.asn1.x509.OID.name2oidList;return t[e]===void 0?"":t[e]};RSAKey.getPosArrayOfChildrenFromHex=function(e){return ASN1HEX.getChildIdx(e,0)};RSAKey.getHexValueArrayOfChildrenFromHex=function(e){var t=ASN1HEX,r=t.getV,y=RSAKey.getPosArrayOfChildrenFromHex(e),n=r(e,y[0]),o=r(e,y[1]),s=r(e,y[2]),l=r(e,y[3]),u=r(e,y[4]),c=r(e,y[5]),h=r(e,y[6]),f=r(e,y[7]),m=r(e,y[8]),y=new Array;return y.push(n,o,s,l,u,c,h,f,m),y};RSAKey.prototype.readPrivateKeyFromPEMString=function(e){var t=pemtohex(e),r=RSAKey.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])};RSAKey.prototype.readPKCS5PrvKeyHex=function(e){var t=RSAKey.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])};RSAKey.prototype.readPKCS8PrvKeyHex=function(e){var t,r,n,o,s,l,u,c,h=ASN1HEX,f=h.getVbyListEx;if(h.isASN1HEX(e)===!1)throw new Error("not ASN.1 hex string");try{t=f(e,0,[2,0,1],"02"),r=f(e,0,[2,0,2],"02"),n=f(e,0,[2,0,3],"02"),o=f(e,0,[2,0,4],"02"),s=f(e,0,[2,0,5],"02"),l=f(e,0,[2,0,6],"02"),u=f(e,0,[2,0,7],"02"),c=f(e,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(t,r,n,o,s,l,u,c)};RSAKey.prototype.readPKCS5PubKeyHex=function(e){var t=ASN1HEX,r=t.getV;if(t.isASN1HEX(e)===!1)throw new Error("keyHex is not ASN.1 hex string");var n=t.getChildIdx(e,0);if(n.length!==2||e.substr(n[0],2)!=="02"||e.substr(n[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var o=r(e,n[0]),s=r(e,n[1]);this.setPublic(o,s)};RSAKey.prototype.readPKCS8PubKeyHex=function(e){var t=ASN1HEX;if(t.isASN1HEX(e)===!1)throw new Error("not ASN.1 hex string");if(t.getTLVbyListEx(e,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var r=t.getTLVbyListEx(e,0,[1,0]);this.readPKCS5PubKeyHex(r)};RSAKey.prototype.readCertPubKeyHex=function(e,t){var r,n;r=new X509,r.readCertHex(e),n=r.getPublicKeyHex(),this.readPKCS8PubKeyHex(n)};function _rsasign_getAlgNameAndHashFromHexDisgestInfo(e){for(var t in KJUR.crypto.Util.DIGESTINFOHEAD){var r=KJUR.crypto.Util.DIGESTINFOHEAD[t],n=r.length;if(e.substring(0,n)==r){var o=[t,e.substring(n)];return o}}return[]}RSAKey.prototype.verify=function(e,t){if(t=t.toLowerCase(),t.match(/^[0-9a-f]+$/)==null)return!1;var r=parseBigInt(t,16),n=this.n.bitLength();if(r.bitLength()>n)return!1;var o=this.doPublic(r),s=o.toString(16);if(s.length+3!=n/4)return!1;var l=s.replace(/^1f+00/,""),u=_rsasign_getAlgNameAndHashFromHexDisgestInfo(l);if(u.length==0)return!1;var c=u[0],h=u[1],f=function(y){return KJUR.crypto.Util.hashString(y,c)},m=f(e);return h==m};RSAKey.prototype.verifyWithMessageHash=function(e,t){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var r=parseBigInt(t,16);if(r.bitLength()>this.n.bitLength())return 0;var n=this.doPublic(r),o=n.toString(16).replace(/^1f+00/,""),s=_rsasign_getAlgNameAndHashFromHexDisgestInfo(o);if(s.length==0)return!1;s[0];var l=s[1];return l==e};RSAKey.prototype.verifyPSS=function(e,t,r,n){var o=function(l){return KJUR.crypto.Util.hashHex(l,r)},s=o(rstrtohex(e));return n===void 0&&(n=-1),this.verifyWithMessageHashPSS(s,t,r,n)};RSAKey.prototype.verifyWithMessageHashPSS=function(e,t,r,n){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var o=new BigInteger(t,16),s=function(S){return KJUR.crypto.Util.hashHex(S,r)},l=hextorstr(e),u=l.length,c=this.n.bitLength()-1,h=Math.ceil(c/8),f;if(n===-1||n===void 0)n=u;else if(n===-2)n=h-u-2;else if(n<-2)throw new Error("invalid salt length");if(h<u+n+2)throw new Error("data too long");var m=this.doPublic(o).toByteArray();for(f=0;f<m.length;f+=1)m[f]&=255;for(;m.length<h;)m.unshift(0);if(m[h-1]!==188)throw new Error("encoded message does not end in 0xbc");m=String.fromCharCode.apply(String,m);var y=m.substr(0,h-u-1),A=m.substr(y.length,u),M=65280>>8*h-c&255;if(y.charCodeAt(0)&M)throw new Error("bits beyond keysize not zero");var b=pss_mgf1_str(A,y.length,s),T=[];for(f=0;f<y.length;f+=1)T[f]=y.charCodeAt(f)^b.charCodeAt(f);T[0]&=~M;var _=h-u-n-2;for(f=0;f<_;f+=1)if(T[f]!==0)throw new Error("leftmost octets not zero");if(T[_]!==1)throw new Error("0x01 marker not found");return A===hextorstr(s(rstrtohex("\0\0\0\0\0\0\0\0"+l+String.fromCharCode.apply(String,T.slice(-n)))))};RSAKey.SALT_LEN_HLEN=-1;RSAKey.SALT_LEN_MAX=-2;RSAKey.SALT_LEN_RECOVER=-2;function X509(e){var t=ASN1HEX,r=t.getChildIdx,n=t.getV,o=t.getTLV,s=t.getVbyList,l=t.getVbyListEx,u=t.getTLVbyList,c=t.getTLVbyListEx,h=t.getIdxbyList,f=t.getIdxbyListEx,m=t.getVidx,y=t.getInt,A=t.oidname,M=t.hextooidstr,b=pemtohex,T;try{T=KJUR.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var _=u(this.hex,0,[0,0]);if(_.substr(0,2)=="a0"){var S=u(_,0,[0]),C=y(S,0);if(C<0||2<C)throw new Error("malformed version field");return this.version=C+1,this.version}else return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return l(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var _=c(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(_)},this.getAlgorithmIdentifierName=function(_){for(var S in T)if(_===T[S])return S;return A(l(_,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return u(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){var _=this.getIssuer();return _.str},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return u(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){var _=this.getSubject();return _.str},this.getNotBefore=function(){var _=s(this.hex,0,[0,4+this.foffset,0]);return _=_.replace(/(..)/g,"%$1"),_=decodeURIComponent(_),_},this.getNotAfter=function(){var _=s(this.hex,0,[0,4+this.foffset,1]);return _=_.replace(/(..)/g,"%$1"),_=decodeURIComponent(_),_},this.getPublicKeyHex=function(){return t.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return h(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var _=this.getPublicKeyIdx();return h(this.hex,_,[1,0],"30")},this.getPublicKey=function(){return KEYUTIL.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var _=u(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(_)},this.getSignatureValueHex=function(){return s(this.hex,0,[2],"03",!0)},this.verifySignature=function(_){var S=this.getSignatureAlgorithmField(),C=this.getSignatureValueHex(),P=u(this.hex,0,[0],"30"),F=new KJUR.crypto.Signature({alg:S});return F.init(_),F.updateHex(P),F.verify(C)},this.parseExt=function(_){var S,C,P;if(_===void 0){if(P=this.hex,this.version!==3)return-1;S=h(P,0,[0,7,0],"30"),C=r(P,S)}else{P=pemtohex(_);var F=h(P,0,[0,3,0,0],"06");if(n(P,F)!="2a864886f70d01090e"){this.aExtInfo=new Array;return}S=h(P,0,[0,3,0,1,0],"30"),C=r(P,S),this.hex=P}this.aExtInfo=new Array;for(var O=0;O<C.length;O++){var N={};N.critical=!1;var V=r(P,C[O]),q=0;V.length===3&&(N.critical=!0,q=1),N.oid=t.hextooidstr(s(P,C[O],[0],"06"));var Q=h(P,C[O],[1+q]);N.vidx=m(P,Q),this.aExtInfo.push(N)}},this.getExtInfo=function(_){var S=this.aExtInfo,C=_;if(_.match(/^[0-9.]+$/)||(C=KJUR.asn1.x509.OID.name2oid(_)),C!==""){for(var P=0;P<S.length;P++)if(S[P].oid===C)return S[P]}},this.getExtBasicConstraints=function(_,S){if(_===void 0&&S===void 0){var C=this.getExtInfo("basicConstraints");if(C===void 0)return;_=o(this.hex,C.vidx),S=C.critical}var P={extname:"basicConstraints"};if(S&&(P.critical=!0),_==="3000")return P;if(_==="30030101ff")return P.cA=!0,P;if(_.substr(0,12)==="30060101ff02"){var F=n(_,10),O=parseInt(F,16);return P.cA=!0,P.pathLen=O,P}throw new Error("hExtV parse error: "+_)},this.getExtKeyUsage=function(_,S){if(_===void 0&&S===void 0){var C=this.getExtInfo("keyUsage");if(C===void 0)return;_=o(this.hex,C.vidx),S=C.critical}var P={extname:"keyUsage"};return S&&(P.critical=!0),P.names=this.getExtKeyUsageString(_).split(","),P},this.getExtKeyUsageBin=function(_){if(_===void 0){var S=this.getExtInfo("keyUsage");if(S===void 0)return"";_=o(this.hex,S.vidx)}if(_.length!=8&&_.length!=10)throw new Error("malformed key usage value: "+_);var C="000000000000000"+parseInt(_.substr(6),16).toString(2);return _.length==8&&(C=C.slice(-8)),_.length==10&&(C=C.slice(-16)),C=C.replace(/0+$/,""),C==""&&(C="0"),C},this.getExtKeyUsageString=function(_){for(var S=this.getExtKeyUsageBin(_),C=new Array,P=0;P<S.length;P++)S.substr(P,1)=="1"&&C.push(X509.KEYUSAGE_NAME[P]);return C.join(",")},this.getExtSubjectKeyIdentifier=function(_,S){if(_===void 0&&S===void 0){var C=this.getExtInfo("subjectKeyIdentifier");if(C===void 0)return;_=o(this.hex,C.vidx),S=C.critical}var P={extname:"subjectKeyIdentifier"};S&&(P.critical=!0);var F=n(_,0);return P.kid={hex:F},P},this.getExtAuthorityKeyIdentifier=function(_,S){if(_===void 0&&S===void 0){var C=this.getExtInfo("authorityKeyIdentifier");if(C===void 0)return;_=o(this.hex,C.vidx),S=C.critical}var P={extname:"authorityKeyIdentifier"};S&&(P.critical=!0);for(var F=r(_,0),O=0;O<F.length;O++){var N=_.substr(F[O],2);if(N==="80"&&(P.kid={hex:n(_,F[O])}),N==="a1"){var V=o(_,F[O]),q=this.getGeneralNames(V);P.issuer=q[0].dn}N==="82"&&(P.sn={hex:n(_,F[O])})}return P},this.getExtExtKeyUsage=function(_,S){if(_===void 0&&S===void 0){var C=this.getExtInfo("extKeyUsage");if(C===void 0)return;_=o(this.hex,C.vidx),S=C.critical}var P={extname:"extKeyUsage",array:[]};S&&(P.critical=!0);for(var F=r(_,0),O=0;O<F.length;O++)P.array.push(A(n(_,F[O])));return P},this.getExtExtKeyUsageName=function(){var _=this.getExtInfo("extKeyUsage");if(_===void 0)return _;var S=new Array,C=o(this.hex,_.vidx);if(C==="")return S;for(var P=r(C,0),F=0;F<P.length;F++)S.push(A(n(C,P[F])));return S},this.getExtSubjectAltName=function(_,S){if(_===void 0&&S===void 0){var C=this.getExtInfo("subjectAltName");if(C===void 0)return;_=o(this.hex,C.vidx),S=C.critical}var P={extname:"subjectAltName",array:[]};return S&&(P.critical=!0),P.array=this.getGeneralNames(_),P},this.getExtIssuerAltName=function(_,S){if(_===void 0&&S===void 0){var C=this.getExtInfo("issuerAltName");if(C===void 0)return;_=o(this.hex,C.vidx),S=C.critical}var P={extname:"issuerAltName",array:[]};return S&&(P.critical=!0),P.array=this.getGeneralNames(_),P},this.getGeneralNames=function(_){for(var S=r(_,0),C=[],P=0;P<S.length;P++){var F=this.getGeneralName(o(_,S[P]));F!==void 0&&C.push(F)}return C},this.getGeneralName=function(_){var S=_.substr(0,2),C=n(_,0),P=hextorstr(C);if(S=="81")return{rfc822:P};if(S=="82")return{dns:P};if(S=="86")return{uri:P};if(S=="87")return{ip:hextoip(C)};if(S=="a4")return{dn:this.getX500Name(C)}},this.getExtSubjectAltName2=function(){var _,S,C,P=this.getExtInfo("subjectAltName");if(P===void 0)return P;for(var F=new Array,O=o(this.hex,P.vidx),N=r(O,0),V=0;V<N.length;V++)C=O.substr(N[V],2),_=n(O,N[V]),C==="81"&&(S=hextoutf8(_),F.push(["MAIL",S])),C==="82"&&(S=hextoutf8(_),F.push(["DNS",S])),C==="84"&&(S=X509.hex2dn(_,0),F.push(["DN",S])),C==="86"&&(S=hextoutf8(_),F.push(["URI",S])),C==="87"&&(S=hextoip(_),F.push(["IP",S]));return F},this.getExtCRLDistributionPoints=function(_,S){if(_===void 0&&S===void 0){var C=this.getExtInfo("cRLDistributionPoints");if(C===void 0)return;_=o(this.hex,C.vidx),S=C.critical}var P={extname:"cRLDistributionPoints",array:[]};S&&(P.critical=!0);for(var F=r(_,0),O=0;O<F.length;O++){var N=o(_,F[O]);P.array.push(this.getDistributionPoint(N))}return P},this.getDistributionPoint=function(_){for(var S={},C=r(_,0),P=0;P<C.length;P++){var F=_.substr(C[P],2),O=o(_,C[P]);F=="a0"&&(S.dpname=this.getDistributionPointName(O))}return S},this.getDistributionPointName=function(_){for(var S={},C=r(_,0),P=0;P<C.length;P++){var F=_.substr(C[P],2),O=o(_,C[P]);F=="a0"&&(S.full=this.getGeneralNames(O))}return S},this.getExtCRLDistributionPointsURI=function(){var _=this.getExtInfo("cRLDistributionPoints");if(_===void 0)return _;for(var S=new Array,C=r(this.hex,_.vidx),P=0;P<C.length;P++)try{var F=s(this.hex,C[P],[0,0,0],"86"),O=hextoutf8(F);S.push(O)}catch{}return S},this.getExtAIAInfo=function(){var _=this.getExtInfo("authorityInfoAccess");if(_===void 0)return _;for(var S={ocsp:[],caissuer:[]},C=r(this.hex,_.vidx),P=0;P<C.length;P++){var F=s(this.hex,C[P],[0],"06"),O=s(this.hex,C[P],[1],"86");F==="2b06010505073001"&&S.ocsp.push(hextoutf8(O)),F==="2b06010505073002"&&S.caissuer.push(hextoutf8(O))}return S},this.getExtAuthorityInfoAccess=function(_,S){if(_===void 0&&S===void 0){var C=this.getExtInfo("authorityInfoAccess");if(C===void 0)return;_=o(this.hex,C.vidx),S=C.critical}var P={extname:"authorityInfoAccess",array:[]};S&&(P.critical=!0);for(var F=r(_,0),O=0;O<F.length;O++){var N=l(_,F[O],[0],"06"),V=s(_,F[O],[1],"86"),q=hextoutf8(V);if(N=="2b06010505073001")P.array.push({ocsp:q});else if(N=="2b06010505073002")P.array.push({caissuer:q});else throw new Error("unknown method: "+N)}return P},this.getExtCertificatePolicies=function(_,S){if(_===void 0&&S===void 0){var C=this.getExtInfo("certificatePolicies");if(C===void 0)return;_=o(this.hex,C.vidx),S=C.critical}var P={extname:"certificatePolicies",array:[]};S&&(P.critical=!0);for(var F=r(_,0),O=0;O<F.length;O++){var N=o(_,F[O]),V=this.getPolicyInformation(N);P.array.push(V)}return P},this.getPolicyInformation=function(_){var S={},C=s(_,0,[0],"06");S.policyoid=A(C);var P=f(_,0,[1],"30");if(P!=-1){S.array=[];for(var F=r(_,P),O=0;O<F.length;O++){var N=o(_,F[O]),V=this.getPolicyQualifierInfo(N);S.array.push(V)}}return S},this.getPolicyQualifierInfo=function(_){var S={},C=s(_,0,[0],"06");if(C==="2b06010505070201"){var P=l(_,0,[1],"16");S.cps=hextorstr(P)}else if(C==="2b06010505070202"){var F=u(_,0,[1],"30");S.unotice=this.getUserNotice(F)}return S},this.getUserNotice=function(_){for(var S={},C=r(_,0),P=0;P<C.length;P++){var F=o(_,C[P]);F.substr(0,2)!="30"&&(S.exptext=this.getDisplayText(F))}return S},this.getDisplayText=function(_){var S={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"},C={};return C.type=S[_.substr(0,2)],C.str=hextorstr(n(_,0)),C},this.getExtCRLNumber=function(_,S){var C={extname:"cRLNumber"};if(S&&(C.critical=!0),_.substr(0,2)=="02")return C.num={hex:n(_,0)},C;throw new Error("hExtV parse error: "+_)},this.getExtCRLReason=function(_,S){var C={extname:"cRLReason"};if(S&&(C.critical=!0),_.substr(0,2)=="0a")return C.code=parseInt(n(_,0),16),C;throw new Error("hExtV parse error: "+_)},this.getExtOcspNonce=function(_,S){var C={extname:"ocspNonce"};S&&(C.critical=!0);var P=n(_,0);return C.hex=P,C},this.getExtOcspNoCheck=function(_,S){var C={extname:"ocspNoCheck"};return S&&(C.critical=!0),C},this.getExtAdobeTimeStamp=function(_,S){if(_===void 0&&S===void 0){var C=this.getExtInfo("adobeTimeStamp");if(C===void 0)return;_=o(this.hex,C.vidx),S=C.critical}var P={extname:"adobeTimeStamp"};S&&(P.critical=!0);var F=r(_,0);if(F.length>1){var O=o(_,F[1]),N=this.getGeneralName(O);N.uri!=null&&(P.uri=N.uri)}if(F.length>2){var V=o(_,F[2]);V=="0101ff"&&(P.reqauth=!0),V=="010100"&&(P.reqauth=!1)}return P},this.getX500NameRule=function(_){for(var S=null,C=[],P=0;P<_.length;P++)for(var F=_[P],O=0;O<F.length;O++)C.push(F[O]);for(var P=0;P<C.length;P++){var N=C[P],V=N.ds,q=N.value,Q=N.type;if(V!="prn"&&V!="utf8"&&V!="ia5")return"mixed";if(V=="ia5"){if(Q!="CN")return"mixed";if(KJUR.lang.String.isMail(q))continue;return"mixed"}if(Q=="C"){if(V=="prn")continue;return"mixed"}if(S==null)S=V;else if(S!==V)return"mixed"}return S??"prn"},this.getX500Name=function(_){var S=this.getX500NameArray(_),C=this.dnarraytostr(S);return{array:S,str:C}},this.getX500NameArray=function(_){for(var S=[],C=r(_,0),P=0;P<C.length;P++)S.push(this.getRDN(o(_,C[P])));return S},this.getRDN=function(_){for(var S=[],C=r(_,0),P=0;P<C.length;P++)S.push(this.getAttrTypeAndValue(o(_,C[P])));return S},this.getAttrTypeAndValue=function(_){var S={type:null,value:null,ds:null},C=r(_,0),P=s(_,C[0],[],"06"),F=s(_,C[1],[]),O=KJUR.asn1.ASN1Util.oidHexToInt(P);return S.type=KJUR.asn1.x509.OID.oid2atype(O),S.ds=this.HEX2STAG[_.substr(C[1],2)],S.ds!="bmp"?S.value=hextoutf8(F):S.value=ucs2hextoutf8(F),S},this.readCertPEM=function(_){this.readCertHex(b(_))},this.readCertHex=function(_){this.hex=_,this.getVersion();try{h(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var _={};return _.version=this.getVersion(),_.serial={hex:this.getSerialNumberHex()},_.sigalg=this.getSignatureAlgorithmField(),_.issuer=this.getIssuer(),_.notbefore=this.getNotBefore(),_.notafter=this.getNotAfter(),_.subject=this.getSubject(),_.sbjpubkey=hextopem(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(_.ext=this.getExtParamArray()),_.sighex=this.getSignatureValueHex(),_},this.getExtParamArray=function(_){if(_==null){var S=f(this.hex,0,[0,"[3]"]);S!=-1&&(_=c(this.hex,0,[0,"[3]",0],"30"))}for(var C=[],P=r(_,0),F=0;F<P.length;F++){var O=o(_,P[F]),N=this.getExtParam(O);N!=null&&C.push(N)}return C},this.getExtParam=function(_){var S=r(_,0),C=S.length;if(C!=2&&C!=3)throw new Error("wrong number elements in Extension: "+C+" "+_);var P=M(s(_,0,[0],"06")),F=!1;C==3&&u(_,0,[1])=="0101ff"&&(F=!0);var O=u(_,0,[C-1,0]),N=void 0;if(P=="2.5.29.14"?N=this.getExtSubjectKeyIdentifier(O,F):P=="2.5.29.15"?N=this.getExtKeyUsage(O,F):P=="2.5.29.17"?N=this.getExtSubjectAltName(O,F):P=="2.5.29.18"?N=this.getExtIssuerAltName(O,F):P=="2.5.29.19"?N=this.getExtBasicConstraints(O,F):P=="2.5.29.31"?N=this.getExtCRLDistributionPoints(O,F):P=="2.5.29.32"?N=this.getExtCertificatePolicies(O,F):P=="2.5.29.35"?N=this.getExtAuthorityKeyIdentifier(O,F):P=="2.5.29.37"?N=this.getExtExtKeyUsage(O,F):P=="1.3.6.1.5.5.7.1.1"?N=this.getExtAuthorityInfoAccess(O,F):P=="2.5.29.20"?N=this.getExtCRLNumber(O,F):P=="2.5.29.21"?N=this.getExtCRLReason(O,F):P=="1.3.6.1.5.5.7.48.1.2"?N=this.getExtOcspNonce(O,F):P=="1.3.6.1.5.5.7.48.1.5"?N=this.getExtOcspNoCheck(O,F):P=="1.2.840.113583.1.1.9.1"&&(N=this.getExtAdobeTimeStamp(O,F)),N!=null)return N;var V={extname:P,extn:O};return F&&(V.critical=!0),V},this.findExt=function(_,S){for(var C=0;C<_.length;C++)if(_[C].extname==S)return _[C];return null},this.dnarraytostr=function(_){function S(P){return P.map(function(F){return C(F).replace(/\+/,"\\+")}).join("+")}function C(P){return P.type+"="+P.value}return"/"+_.map(function(P){return S(P).replace(/\//,"\\/")}).join("/")},this.getInfo=function(){var _=function(K){var Z=JSON.stringify(K.array).replace(/[\[\]\{\}\"]/g,"");return Z},S=function(K){for(var Z="",ee=K.array,j=0;j<ee.length;j++){var re=ee[j];if(Z+="    policy oid: "+re.policyoid+`
`,re.array!==void 0)for(var pe=0;pe<re.array.length;pe++){var ge=re.array[pe];ge.cps!==void 0&&(Z+="    cps: "+ge.cps+`
`)}}return Z},C=function(K){for(var Z="",ee=K.array,j=0;j<ee.length;j++){var re=ee[j];try{re.dpname.full[0].uri!==void 0&&(Z+="    "+re.dpname.full[0].uri+`
`)}catch{}try{re.dname.full[0].dn.hex!==void 0&&(Z+="    "+X509.hex2dn(re.dpname.full[0].dn.hex)+`
`)}catch{}}return Z},P=function(K){for(var Z="",ee=K.array,j=0;j<ee.length;j++){var re=ee[j];re.caissuer!==void 0&&(Z+="    caissuer: "+re.caissuer+`
`),re.ocsp!==void 0&&(Z+="    ocsp: "+re.ocsp+`
`)}return Z},F,O,N;if(F=`Basic Fields
`,F+="  serial number: "+this.getSerialNumberHex()+`
`,F+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,F+="  issuer: "+this.getIssuerString()+`
`,F+="  notBefore: "+this.getNotBefore()+`
`,F+="  notAfter: "+this.getNotAfter()+`
`,F+="  subject: "+this.getSubjectString()+`
`,F+=`  subject public key info: 
`,O=this.getPublicKey(),F+="    key algorithm: "+O.type+`
`,O.type==="RSA"&&(F+="    n="+hextoposhex(O.n.toString(16)).substr(0,16)+`...
`,F+="    e="+hextoposhex(O.e.toString(16))+`
`),N=this.aExtInfo,N!=null){F+=`X509v3 Extensions:
`;for(var V=0;V<N.length;V++){var q=N[V],Q=KJUR.asn1.x509.OID.oid2name(q.oid);Q===""&&(Q=q.oid);var z="";if(q.critical===!0&&(z="CRITICAL"),F+="  "+Q+" "+z+`:
`,Q==="basicConstraints"){var H=this.getExtBasicConstraints();H.cA===void 0?F+=`    {}
`:(F+="    cA=true",H.pathLen!==void 0&&(F+=", pathLen="+H.pathLen),F+=`
`)}else if(Q==="keyUsage")F+="    "+this.getExtKeyUsageString()+`
`;else if(Q==="subjectKeyIdentifier")F+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(Q==="authorityKeyIdentifier"){var W=this.getExtAuthorityKeyIdentifier();W.kid!==void 0&&(F+="    kid="+W.kid.hex+`
`)}else if(Q==="extKeyUsage"){var J=this.getExtExtKeyUsage().array;F+="    "+J.join(", ")+`
`}else if(Q==="subjectAltName"){var G=_(this.getExtSubjectAltName());F+="    "+G+`
`}else if(Q==="cRLDistributionPoints"){var te=this.getExtCRLDistributionPoints();F+=C(te)}else if(Q==="authorityInfoAccess"){var X=this.getExtAuthorityInfoAccess();F+=P(X)}else Q==="certificatePolicies"&&(F+=S(this.getExtCertificatePolicies()))}}return F+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,F+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`,F},typeof e=="string"&&(e.indexOf("-----BEGIN")!=-1?this.readCertPEM(e):KJUR.lang.String.isHex(e)&&this.readCertHex(e))}X509.hex2dn=function(e,t){t===void 0&&(t=0);var r=new X509;ASN1HEX.getTLV(e,t);var n=r.getX500Name(e);return n.str};X509.hex2rdn=function(e,t){if(t===void 0&&(t=0),e.substr(t,2)!=="31")throw new Error("malformed RDN");for(var r=new Array,n=ASN1HEX.getChildIdx(e,t),o=0;o<n.length;o++)r.push(X509.hex2attrTypeValue(e,n[o]));return r=r.map(function(s){return s.replace("+","\\+")}),r.join("+")};X509.hex2attrTypeValue=function(e,t){var r=ASN1HEX,n=r.getV;if(t===void 0&&(t=0),e.substr(t,2)!=="30")throw new Error("malformed attribute type and value");var o=r.getChildIdx(e,t);o.length!==2||e.substr(o[0],2);var s=n(e,o[0]),l=KJUR.asn1.ASN1Util.oidHexToInt(s),u=KJUR.asn1.x509.OID.oid2atype(l),c=n(e,o[1]),h=hextorstr(c);return u+"="+h};X509.getPublicKeyFromCertHex=function(e){var t=new X509;return t.readCertHex(e),t.getPublicKey()};X509.getPublicKeyFromCertPEM=function(e){var t=new X509;return t.readCertPEM(e),t.getPublicKey()};X509.getPublicKeyInfoPropOfCertPEM=function(e){var t=ASN1HEX,r=t.getVbyList,n={},o,s;return n.algparam=null,o=new X509,o.readCertPEM(e),s=o.getPublicKeyHex(),n.keyhex=r(s,0,[1],"03").substr(2),n.algoid=r(s,0,[0,0],"06"),n.algoid==="2a8648ce3d0201"&&(n.algparam=r(s,0,[0,1],"06")),n};X509.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];function sha256(e){return CryptoJS.SHA256(e).toString()}var certificates=[function(){var e=new X509;return e.readCertPEM(function(){var t=113,r=126,n=0,o="";return arguments[n].split(o).map(function(s){return s.charCodeAt(n)>r?s:String.fromCharCode((s.charCodeAt(n)+t)%r)}).join(o)}(":::::ORTV[-PR_aVSVPNaR:::::ZVVS@	PPNErtNVONtVWNZR}@]nU\0ZaZN=TP`\0T`Vo@Q^ROPbNZVTSZ^P^fQc^^TRWQawR^ZNATN>bRPNU^zc}nzyg	R^ZNATN>bROU^zc}nzyg	R]ZN=TN>bRPtTn?bf?FZ_NQtfQc^^YQNq`gdSp?cyZ^P^fQc^^QQNWQ^aRvZPNTP`\0T`Vo@Q^RWN_fapzFqSFwfbOndSnzyuYz[oaNrS=\x07\\QN>Z	N\\Q^B[QqnS=\b\\QN>Zwp\\Q^B[QqnZVTSZ^P^fQc^^TRWQawR^ZNATN>bRPNU^zc}nzyg	R^ZNATN>bROU^zc}nzyg	R]ZN=TN>bRPtTn?bf?FZ_NQtfQc^^YQNq`gdSp?cyZ^P^fQc^^QQNWQ^aRvZPNTP`\0T`Vo@Q^RWN_fapzFqSFwfbOndSnzyuYz[oaPPNvVQ^fWX|gVup[N^ROO^NQttV]NQPPNt|PttVONZU|C\b\\@@e^Xv{[vTtd8`nyO@\x07ebN[bqx=ng?	S^w@|XAz|qUTwfzn]Bu<qs_ae\\y<}u`eRAoE`_\\s\0r|b{rp_o<oC@o=x\bw_cUUZPApQevD\\FxFo\x07FgE=<sq[p<coqyn>TEpP@aSC_YDU8\0|8TB?c>r\\=rp`pcwP}c\0PP_\\RS\\EPVSy8x`\0?R|NP	P>}A^VP}Ex\bU\x07Za=syDw}>Ya\x078wPp[pRnn\brU^dE8U?a\bcW|<FEbbupn^`ZNr	sof[wA}e{\\z}w[YDQ|dt=wC	Nv\x07bR\x07Z@@U|ZAYpFsabCBB\\`wrqxsYW8uFyWdaWezeUeA_8VoVupvY[TD[OYdpO\bC[wX\\O]=[QRpV\0d`\x07N\0RXt^Z}vEpdC=\bY?\x07=V}?^W\bad|qN@Ww>@PycaqANE]asPcE^OB_VA?>wzeftac	Z	guf\bF]\x07DCP?znNYf	uaYu[`\x07=b|v]Bp=RAS``\\PRDW]_`UXdUg=SuqwVFDeB	D8{B>\\sPY\x07bEU	FQXz\0@\x07`zsqgfD\0[WY\bPeZc}	\0bx?Rfed\x07}BUe\x07|Uo\0y?\bsSXZOSBCgbFqf\0Bs?b?d<VE\\Zzns\\d@?dPvf\\{}_\0Sd[<q_YB\x07Y`Ffg=sY>{t<fu]x\x07rFNtZONNTwbQO\\ZO=TN>bqQt^dOOaAFXw=	PCVxsv?{`a\bvS8YQ[aNsOt[cU`ZRTQNdtOaAFXw=	PCVxsv?{`a\bvS8YQ[aNZOt[cU_ZROaNQN^U<ZN=TP`\0T`Vo@Q^ROPbNNAVPN^P\0{y\0Bs\\8\0R[z]w??qZP?NpgdenSuvv?>|f_?UpYPcQ\\gCb8zxtSvsOQNg>[\\\0\bx\b_o@8\0g`Z<PyUE`8yu}\\g{@`s`zUgErRtve{YdCvoO@>WFDtABNp\0feUWszpQaEYNAc]^xB[@]BDAN8\b}XA=E\x07nO}Pud8TA	?yPrVv{\\>E]o`BO^RE^X[W[rEU?x\bf>V	OUwY=>X[\\E`tW[8}VwpF\x07BQcnrPF}yUtd8<Doe_\b[oOVU\x07ep@pYY\0cegY{r	?\bAbq?ff8}UaXoN_D]_X_8yozYFT`N{`\\{zvu?\bDWT}=_<\x07StX	Nx\x07\0\b	\0aT=c@ucnWfR[vf>RFxAFV}{N`dN^\\<eawBPxx}quT=|{T_R@Fp^Y<ZevRsWaZ]V	CVrRVtAAc[	Qp|d|tqoQ=T|XX	=u\\N8XNCx\\aU>wz	X<e@Vc?dy\\|^FEq|=p`pBdF@bs^d<]vp\\^TZ	P\bZ\b\\YNNSZ_\\w^|TsD8db	_	Y\\o^Cw>Z\0x\\^aN]wWf\bA}	C^d_{\x07ZC@\by]gY@E	BFY?OsaqbDcVgQbZeFc	ovtucxnq|<TnuyXRveYFOegCpAs{YTe|>bE<OXsSqCBWD_SVepfvCCUg]z	ZvQ[\0s|U>pFz\b=OwT``fNJJ:::::R[Q-PR_aVSVPNaR:::::")),e}()];function getCertificateBySubjectHex(e,t){for(var r=0,n=t;r<n.length;r++){var o=n[r];if(o.getSubjectHex()===e)return o}}function verifyCertificate_(e,t){var r=e.getIssuerHex();if(r===e.getSubjectHex())return e.verifySignature(e.getPublicKey());var n=getCertificateBySubjectHex(r,t);return!n||e.verifySignature(n.getPublicKey())===!1?!1:verifyCertificate_(n,t)}function verifyCertificate(e){var t=e.getIssuerHex();return t===e.getSubjectHex()?!1:verifyCertificate_(e,certificates)}function addCertificate(e){var t=new X509;typeof e=="string"?t.readCertPEM(e):t.readCertHex(e.hex);var r=verifyCertificate(t);return certificates.push(t),r}function verifyMessage(e,t,r){var n=new X509;if(typeof r=="string"?n.readCertPEM(r):n.readCertHex(r.hex),verifyCertificate(n)===!1)return!1;var o=new RSAKey;return o.readCertPubKeyHex(n.hex,6),!!o.verify(e,b64tohex(t))}addCertificate(function(){var e=113,t=126,r=0,n="";return arguments[r].split(n).map(function(o){return o.charCodeAt(r)>t?o:String.fromCharCode((o.charCodeAt(r)+e)%t)}).join(n)}(":::::ORTV[-PR_aVSVPNaR:::::ZVVTU	PPONrtNVONtVWNW=_SVw	VE=ZN=TP`\0T`Vo@Q^ROPbNZVTSZ^P^fQc^^TRWQawR^ZNATN>bRPNU^zc}nzyg	R^ZNATN>bROU^zc}nzyg	R]ZN=TN>bRPtTn?bf?FZ_NQtfQc^^YQNq`gdSp?cyZ^P^fQc^^QQNWQ^aRvZPNTP`\0T`Vo@Q^RWN_fapzFqSFwfbOndSnzyuYz[oaNrS=\bZQNAZaN\\aZ	[QSnS=\b[aNBZQZ\\aZ	[QSnZVTaZ^P^fQc^^TRWQawR^ZNATN>bRPNU^zc}nzyg	R^ZNATN>bROU^zc}nzyg	RbZOVTN>bRPtYoTyuoz}}f`Bwo?=\x07RQN\\Ot[cONZO>Wyfd\x07	gdb\x07RaN]Ot[cONZZPRuupz_@feWyZ`bVfWX|gVup[N^xOSugnec|fdy\x07ndB{^T\x07}fdB\0ndRf?FZVVPVwN[Otx\0uxvTF=ON^RSNN\\PNtENZVVPPtXPNtRN?=?]q[VD|{\\oyo`oOu}F	SA\x07e`tn[t	u\b8^a]qx\bE_^\x07ZN?[QC\0yuOpybY8r\\RPAS=8rUq\0E8>xean^e\bf]Y`XO}{C[Ur^?\0x[SRXvVQ\\CFr}QnAPRQ\x07FO=Yw\0_TePCOFV@|\x07N>ROXcDrT<>bW<ssO?NOT{^s]uU\0gS\bBffsfE\0AfDyQEZR`]XBo|Qw}yYdwwTvOFcBndUz^\\{]	b=^yQYSTQ`]\0?tR{WRUun\\\0bVe_E|VWWV|r	Ao\0	F`fdzCnRtq\br	\b8eBp=Z\\TRaadc}@Eub`\x07quuNqAdF\0aUay{}x>tgVz`	_YBFwu_q?egt8v[o\x008	wTQcrA	<z{DZoEE^rZTrpaZQzqpBY]^zt8[bQv}yEWw	XDYQB\0QB\bx_^X]|uEDtPf[n[r_bpB[bE}?ung|bnU|NYOoedY_tvXySZfYP\x07\x07dWV]OE^\bOFwA}<uXoO}_NDz8aon\x07zWOfcv@?>snfqu@FeEx^\\\bVfuO`\\\0tSg]zDU}QrAT|	OZV|OvpVD<sN@z`<_cSrNCW>?=Au?g_8v{|}}WF>Sr>QBxO	d_D}eBb?Uq^b	[y}x]}{?P|BQtecTB[pQBW>|p|nfv\0zU\x07xOO}WqwE=<PURZy@X8r\\]u=<pPNRNNn\\OtaO<ZOETPdPT`NTT8RVOQ^^`SuO`gdSp?cyVRg\bo?B=VR[OZO=TN>bqQt^dOO`Fy\x07WadZcAD	peXybcW@}Qf\\QNsOt[cU`ZRTQNdtOaAFXw=	PCVxsv?{`a\bvS8YQ[aN]Ot[cU_ZONsEROaNQN^U<ZNTN>bqQ^RNVOOwN[Otx\0uxvTF=ON^SNN\\PNtRNrx	a[}tP_g8FbD\0^\0qt<f88ufuN]^}]gp\bqYudF88Fas_Ef`	?^x>X}esa{>\\r?eE]CC_cZ[vQs		>gX[szONg=^pn=<e]nbSz\bZvac\b[w^nA_`vP|@8w[}nQobe=??oRYf{vpRxcC}yCd>8[NDx{Ne\\t8oou=guC\x07>>g\x07vb}ACd	``Ntq\0yC[Q{|ynpNQqSqzxF<_PFDw<]Bnnu>F<XgU_Zf\\\\A=gu\\codOwQ]oQ<f>gv_pwozwC}xX>C`c]suEdfW?cbeo\b`BbyR@eFTUwSud=t]sS\\onc	XSq	{\0\x07DvAVBbnTqEE[QzDyqF`bF}R=Q?VeDo<Vzb\0w}D}NZ\0t}^?OyFP\bVaVNrTNYqe?[NRYTSQby@yzWvT`wQo}y]c_WgxBYCy	RNRg@\x07NZCaaq8?`	^`?ryD	=obzw?E]Ou\x07]n@>bVzqAQT?@_zo@}CxWVTUsAYdNd?{APQr8{P]]AZ>aR\0[D<z?Tr@`u@X|YDwd_<p<>zWE>]\0=X`\b@uucp|^_Qb@uZouTX^o\0\\{PCq{ug\x078^f[YQAWad8FNqxFQE?ZOo	}RnO\bsQc	xyccn=nxvs>bDBf\b\bW\\TuTnvAO^U\0QXC>xx8FxRFf<tJ:::::R[Q-PR_aVSVPNaR:::::"));var extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},extendStatics(e,t)};function __extends(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");extendStatics(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var __assign=function(){return __assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},__assign.apply(this,arguments)};function __decorate(e,t,r,n){var o=arguments.length,s=o<3?t:n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(l=e[u])&&(s=(o<3?l(s):o>3?l(t,r,s):l(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}function __metadata(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function __awaiter(e,t,r,n){function o(s){return s instanceof r?s:new r(function(l){l(s)})}return new(r||(r=Promise))(function(s,l){function u(f){try{h(n.next(f))}catch(m){l(m)}}function c(f){try{h(n.throw(f))}catch(m){l(m)}}function h(f){f.done?s(f.value):o(f.value).then(u,c)}h((n=n.apply(e,t||[])).next())})}function __generator(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,l=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return l.next=u(0),l.throw=u(1),l.return=u(2),typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function u(h){return function(f){return c([h,f])}}function c(h){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,h[0]&&(r=0)),r;)try{if(n=1,o&&(s=h[0]&2?o.return:h[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,h[1])).done)return s;switch(o=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return r.label++,{value:h[1],done:!1};case 5:r.label++,o=h[1],h=[0];continue;case 7:h=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){r=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){r.label=h[1];break}if(h[0]===6&&r.label<s[1]){r.label=s[1],s=h;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(h);break}s[2]&&r.ops.pop(),r.trys.pop();continue}h=t.call(e,r)}catch(f){h=[6,f],o=0}finally{n=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function __spreadArray(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,s;n<o;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}function createSymbol(e){return typeof Symbol>"u"?"$Symbol<".concat(e,">$"):Symbol(e)}var EVENT_SYMBOL=createSymbol("$$FIVE_EVENT$$");function __generateEventIfNotExisted(e){return e[EVENT_SYMBOL]||(e[EVENT_SYMBOL]={}),e[EVENT_SYMBOL]}function __removeEvents(e){e[EVENT_SYMBOL]&&delete e[EVENT_SYMBOL]}var Subscribe=function(){function e(){}return e.prototype.hasListener=function(t){var r=__generateEventIfNotExisted(this);return r&&r[t]&&r[t].callbacks.length>0},e.prototype.on=function(t,r,n){var o=this,s=__generateEventIfNotExisted(this);return s[t]||(s[t]={callbacks:[]}),s[t].callbacks.push([r,n||!1]),function(){return o.off(t,r)}},e.prototype.once=function(t,r){return this.on(t,r,!0)},e.prototype.off=function(t,r){if(t===void 0){__removeEvents(this);return}var n=__generateEventIfNotExisted(this);if(n[t]||(n[t]={callbacks:[]}),r===void 0){n[t].callbacks.length=0;return}for(var o=0;o<n[t].callbacks.length&&n[t].callbacks[o][0]!==r;o++);o<n[t].callbacks.length&&n[t].callbacks.splice(o,1)},e.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=!1,s=__generateEventIfNotExisted(this);s[t]||(s[t]={callbacks:[]});for(var l=s[t].callbacks.slice(),u=0,c=l;u<c.length;u++){var h=c[u],f=h[0],m=h[1],y=m===void 0?!1:m,A=f.apply(void 0,r);y&&this.off(t,f),A===!1&&(o=!0)}return o},e.prototype.waitUntil=function(t,r){var n=this;return new Promise(function(o){var s=n.on(t,function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];(!r||r.apply(void 0,l)!==!1)&&(o(l),s())})})},e}();function noop$1(){}var start=typeof performance<"u"&&typeof performance.timing<"u"?performance.timing.navigationStart:Date.now(),now=typeof performance<"u"?function(){return start+performance.now()}:function(){return Date.now()};function deepFreeze(e){Object.freeze(e);var t=typeof e=="function",r=Object.prototype.hasOwnProperty;return Object.getOwnPropertyNames(e).forEach(function(n){r.call(e,n)&&(!t||n!=="caller"&&n!=="callee"&&n!=="arguments")&&e[n]!==null&&(typeof e[n]=="object"||typeof e[n]=="function")&&!Object.isFrozen(e[n])&&deepFreeze(e[n])}),e}var domainRegex=/^([^.]+)(\.([^.]+))*$/;function match(e,t){if(e==="*")return!0;var r=e.split(".").reverse(),n=t.split(".").reverse();if(r.length<=1)return e===t;for(var o=0;o<r.length;o++)if(r[o]!==n[o])return!1;return!0}function isIPDomain(e){return/^(([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])(\.(?!$)|$)){4}$/.test(e)}function matchDomain(e,t){return domainRegex.test(e)&&domainRegex.test(t)&&match(e,t)}var JSONP_REGEXPS=[/\.([0-9a-z]+)\.jsonp([\?\#].*)?$/i,/jsonp_([0-9a-z]+)([\?\#].*)?$/i],BUILDIN_ALLOW_HOST=deepFreeze(JSON.parse(function(){var e=113,t=126,r=0,n="";return arguments[r].split(n).map(function(o){return o.charCodeAt(r)>t?o:String.fromCharCode((o.charCodeAt(r)+e)%t)}).join(n)}("h/y|pnyu|/9/xr;p|z/9/yvn{wvn;p|z/9/rnyrr;p|z/9/rnyrr;p{/9/rnyrr;w}/9/uv;p|z/9/uv;p{/9/rnyrr;p{/9/rnyrr;p|z/9/ywpq{;p|z/9/rnyrr:pq{;p|z/9/rnyrr:pq{;p{/9/rnyrr;nv/9/;p{/9/pq{;p{/9/pnyp{|qr;vr/j"))),NetworkProxyError=function(e){__extends(t,e);function t(r,n,o){return e.call(this,"[NETWORK]: request proxy error(type: ".concat(n,", reason: ").concat(o,"): ").concat(r))||this}return t}(Error),NetworkResponseError=function(e){__extends(t,e);function t(r,n,o){var s=e.call(this,"[NETWORK]: response error(type: ".concat(n,", status: ").concat(o,"): ").concat(r))||this;return s.httpStatus=o,s}return t}(Error);(function(e){__extends(t,e);function t(r,n){return e.call(this,"[NETWORK]: request abort(type: ".concat(n,"): ").concat(r))||this}return t})(Error);var NetworkTimeoutError=function(e){__extends(t,e);function t(r,n,o){return e.call(this,"[NETWORK]: request timeout(type: ".concat(n,", timeout: ").concat(o,"ms): ").concat(r))||this}return t}(Error),NetworkFirbiddenError=function(e){__extends(t,e);function t(r,n,o){return e.call(this,"[NETWORK]: request forbidden(type: ".concat(n,", reason: ").concat(o,"): ").concat(r))||this}return t}(Error);function parseHeaders(e){if(!e)return{};for(var t={},r=e.trim().split(`
`),n=0;n<r.length;n++){var o=r[n],s=o.indexOf(":"),l=o.slice(0,s).trim().toLowerCase(),u=o.slice(s+1).trim();u&&(t[l]?t[l]+=", "+u:t[l]=u)}return t}function matchJsonpFunctionName(e){for(var t=0,r=JSONP_REGEXPS;t<r.length;t++){var n=r[t],o=e.match(n);if(o)return"jsonp_"+o[1]}return null}function isJsonpSource(e){return matchJsonpFunctionName(e)!==null}function getProtocol(e){var t=e.match(/^([0-9a-z]+\:)\/\/(([^:/?#]*)(?::[0-9]+)?)/);return t?t[1]:location.protocol}function hostnameFromURL(e){if(/^blob\:/i.test(e))return"blob:";if(/^data\:/i.test(e))return"data:";var t=e.match(/^[0-9a-z]+\:\/\/(([^:/?#]*)(?::[0-9]+)?)/i);return t?t[2]:location.hostname}var NetworkSubscribe=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(Subscribe);function ajax(e,t,r,n,o){t===void 0&&(t={}),r===void 0&&(r=noop$1),n===void 0&&(n=noop$1),o===void 0&&(o=noop$1);var s=now(),l=e;return Promise.resolve().then(function(){return t.requestProxy?t.requestProxy(e):e}).then(function(u){return/^https\:/.test(location.href)&&/^http\:/.test(u)?(console.warn("The page at '".concat(location.href,"' was loaded over HTTPS, but requested an insecure element '").concat(u,"'. This request was automatically upgraded to HTTPS")),u.replace(/^http\:/,"https:")):u}).catch(function(u){var c,h=matchJsonpFunctionName(e),f=h?"Script":"XMLHttpRequest",m=new NetworkProxyError(l,f,u&&u.message?String(u.message):String(u));return(c=t.networkSubscribe)===null||c===void 0||c.emit("network",e,f,"proxy-error",m.message),Promise.reject(m)}).then(function(u){return new Promise(function(c,h){var f,m=t.allowHosts?BUILDIN_ALLOW_HOST.concat(t.allowHosts):BUILDIN_ALLOW_HOST.slice(),y=hostnameFromURL(u),A=matchJsonpFunctionName(u);if(location.hostname.length!==0&&!isIPDomain(location.hostname)&&BUILDIN_ALLOW_HOST.filter(function(W){return matchDomain(W,location.hostname)}).length===0&&!isIPDomain(y)&&m.filter(function(W){return matchDomain(W,y)}).length===0){var M=A?"Script":"XMLHttpRequest",b=new NetworkFirbiddenError(u,M,"request host(".concat(y,") is not allowed"));n(b),h(b),(f=t.networkSubscribe)===null||f===void 0||f.emit("network",u,M,"forbidden",b.message);return}if(A){var T=window,_=null,S=!1,C=document.createElement("script"),P=function(){var W;if(_=null,S!==!0){S=!0;var J=new NetworkTimeoutError(u,"Script",t.timeout||NaN);n(J),h(J),(W=t.networkSubscribe)===null||W===void 0||W.emit("network",u,"Script","timeout",J.message)}},F=function(W){var J,G,te=now(),X=te-s;if(delete T[A],C.parentNode&&C.parentNode.removeChild(C),_!==null&&(window.clearTimeout(_),_=null),S!==!0){if(W.indexOf("data:")!==0){var K=new NetworkResponseError(u,"Script",500);n(K),h(K),(J=t.networkSubscribe)===null||J===void 0||J.emit("network",u,"Script","error",K.message);return}var Z=W.split(","),ee=(Z[0].match(/:(.*?);/)||[])[1],j=Z[1];if(t.responseType==="arraybuffer"||t.responseType==="blob"){for(var re=atob(Z[1]),pe=re.length,ge=new Uint8Array(pe),_e=0;_e<pe;_e++)ge[_e]=re.charCodeAt(_e);t.responseType==="arraybuffer"?j=ge.buffer:j=new Blob([ge],{type:ee})}var he={},Fe={body:j,meta:{origin:l,source:u,requestTime:s,responseTime:te,costs:X,headers:he}};r(Fe),c(Fe),(G=t.networkSubscribe)===null||G===void 0||G.emit("network",u,"Script","ok",JSON.stringify(Fe.meta)),S=!0}};T[A]=F,C.src=u,document.body.appendChild(C),typeof t.timeout=="number"&&(_=window.setTimeout(P,t.timeout))}else{var O=!1,N=new XMLHttpRequest,V=function(){N&&(N.removeEventListener("timeout",q,!1),N.removeEventListener("progress",Q,!1),N.removeEventListener("load",z,!1),N.removeEventListener("error",H,!1)),N=null,V=noop$1},q=function(){var W;if(O!==!0){O=!0,V();var J=new NetworkTimeoutError(u,"XMLHttpRequest",t.timeout||NaN);n(J),h(J),(W=t.networkSubscribe)===null||W===void 0||W.emit("network",u,"XMLHttpRequest","timeout",J.message)}},Q=function(W){O!==!0&&W.lengthComputable&&(W.total<=0||o(W.loaded/W.total))},z=function(W){var J;if(O!==!0){var G=this.status;if(G===0||G>=200&&G<400){O=!0,V();var te=now(),X=te-s,K=parseHeaders(this.getAllResponseHeaders()),Z=W.total,ee={body:this.response,meta:{origin:l,source:u,requestTime:s,responseTime:te,costs:X,headers:K,size:Z}};r(ee),c(ee),(J=t.networkSubscribe)===null||J===void 0||J.emit("network",u,"XMLHttpRequest","ok",JSON.stringify(ee.meta))}else H.call(this)}},H=function(){var W;if(O!==!0){O=!0,V();var J=new NetworkResponseError(u,"XMLHttpRequest",this.status);n(J),h(J),(W=t.networkSubscribe)===null||W===void 0||W.emit("network",u,"XMLHttpRequest","error",J.message)}};N.addEventListener("timeout",q,!1),N.addEventListener("progress",Q,!1),N.addEventListener("load",z,!1),N.addEventListener("error",H,!1),t.responseType&&(N.responseType=t.responseType),typeof t.timeout=="number"&&(N.timeout=t.timeout),N.open("GET",u,!0),N.send(null)}})})}var preloadCache={};function preload(e,t){t===void 0&&(t={});var r=now(),n=e;return Promise.resolve().then(function(){return t.requestProxy?t.requestProxy(e):e}).then(function(o){return/^https\:/.test(location.href)&&/^http\:/.test(o)?(console.warn("The page at '".concat(location.href,"' was loaded over HTTPS, but requested an insecure element '").concat(o,"'. This request was automatically upgraded to HTTPS")),o.replace(/^http\:/,"https:")):o}).catch(function(o){var s,l=new NetworkProxyError(n,"Link",o&&o.message?String(o.message):String(o));return(s=t.networkSubscribe)===null||s===void 0||s.emit("network",e,"Link","proxy-error",l.message),Promise.reject(l)}).then(function(o){return o in preloadCache?preloadCache[o]:preloadCache[o]=new Promise(function(s,l){var u,c=t.allowHosts?BUILDIN_ALLOW_HOST.concat(t.allowHosts):BUILDIN_ALLOW_HOST.slice(),h=hostnameFromURL(o);if(location.hostname.length!==0&&!isIPDomain(location.hostname)&&BUILDIN_ALLOW_HOST.filter(function(b){return matchDomain(b,location.hostname)}).length===0&&!isIPDomain(h)&&c.filter(function(b){return matchDomain(b,h)}).length===0){var f=new NetworkFirbiddenError(o,"Link","request host(".concat(h,") is not allowed"));l(f),(u=t.networkSubscribe)===null||u===void 0||u.emit("network",o,"Link","forbidden",f.message);return}var m=document.createElement("link"),y=!1,A=null;m.onload=function(b){var T;if(A!==null&&(clearTimeout(A),A=null),y!==!0){y=!0,s();var _=now(),S=_-r,C={},P={origin:n,source:o,requestTime:r,responseTime:_,costs:S,headers:C};(T=t.networkSubscribe)===null||T===void 0||T.emit("network",o,"Link","preload",JSON.stringify(P))}},m.onerror=function(b){var T;if(A!==null&&(clearTimeout(A),A=null),y!==!0){y=!0;var _=new NetworkResponseError(o,"Link",0);l(_),(T=t.networkSubscribe)===null||T===void 0||T.emit("network",o,"Link","error",_.message)}},typeof t.timeout=="number"&&(A=window.setTimeout(function(){var b;if(A=null,y!==!0){y=!0,s();var T=now(),_=T-r,S={},C={origin:n,source:o,requestTime:r,responseTime:T,costs:_,headers:S};(b=t.networkSubscribe)===null||b===void 0||b.emit("network",o,"Link","timeout",JSON.stringify(C))}},t.timeout)),m.rel=m.relList&&m.relList.supports("prefetch")?"prefetch":"preload",m.as="fetch",m.crossOrigin="",m.fetchPriority="high",m.href=o;var M=document.head||document.getElementsByTagName("head")[0];M&&M.appendChild(m)})})}function loadImage(e,t,r,n,o,s){t===void 0&&(t={}),r===void 0&&(r=noop$1),n===void 0&&(n=noop$1),o===void 0&&(o=noop$1);var l=now(),u=e;return Promise.resolve().then(function(){return t.requestProxy?t.requestProxy(e):e}).then(function(c){return/^https\:/.test(location.href)&&/^http\:/.test(c)?(console.warn("The page at '".concat(location.href,"' was loaded over HTTPS, but requested an insecure element '").concat(c,"'. This request was automatically upgraded to HTTPS")),c.replace(/^http\:/,"https:")):c}).catch(function(c){var h,f=new NetworkProxyError(u,"Image",c&&c.message?String(c.message):String(c));return(h=t.networkSubscribe)===null||h===void 0||h.emit("network",e,"Image","proxy-error",f.message),Promise.reject(f)}).then(function(c){return new Promise(function(h,f){var m,y=t.allowHosts?BUILDIN_ALLOW_HOST.concat(t.allowHosts):BUILDIN_ALLOW_HOST.slice(),A=hostnameFromURL(c);if(location.hostname.length!==0&&!isIPDomain(location.hostname)&&BUILDIN_ALLOW_HOST.filter(function(P){return matchDomain(P,location.hostname)}).length===0&&!isIPDomain(A)&&y.filter(function(P){return matchDomain(P,A)}).length===0){var M=new NetworkFirbiddenError(c,"Image","request host(".concat(A,") is not allowed"));n(M),f(M),(m=t.networkSubscribe)===null||m===void 0||m.emit("network",c,"Image","forbidden",M.message);return}var b=s??new Image,T=!1,_=null,S=function(){var P;if(b.onload=noop$1,b.onerror=noop$1,_!==null&&(clearTimeout(_),_=null),T!==!0){var F=now(),O={headers:{},origin:u,source:c,requestTime:l,responseTime:F,costs:F-l};T=!0;var N={body:b,meta:O};o(1),r(N),h(N),(P=t.networkSubscribe)===null||P===void 0||P.emit("network",c,"Image","ok",JSON.stringify(N.meta))}},C=function(){var P;if(b.onload=noop$1,b.onerror=noop$1,_!==null&&(clearTimeout(_),_=null),T!==!0){T=!0;var F=new NetworkResponseError(c,"Image",0);n(F),f(F),(P=t.networkSubscribe)===null||P===void 0||P.emit("network",c,"Image","ok",F.message)}};typeof t.timeout=="number"&&(_=window.setTimeout(function(){var P;if(b.onload=noop$1,b.onerror=noop$1,_=null,T!==!0){T=!0;var F=new NetworkTimeoutError(c,"Image",t.timeout);n(F),f(F),(P=t.networkSubscribe)===null||P===void 0||P.emit("network",c,"Image","timeout",F.message)}},t.timeout)),b.onload=S,b.onerror=C,o(0),b.src=c})})}var Fetcher=function(){function e(t){t===void 0&&(t={}),this.options=Object.freeze(t),this.options.allowHosts&&Object.freeze(this.options.allowHosts)}return e.prototype.ajax=function(t,r,n,o,s){var l;r===void 0&&(r={}),n===void 0&&(n=noop$1),o===void 0&&(o=noop$1),s===void 0&&(s=noop$1);var u=this.options,c={responseType:r.responseType,timeout:(l=r.timeout)!==null&&l!==void 0?l:u.timeout,get allowHosts(){var h;return(h=r.allowHosts)!==null&&h!==void 0?h:u.allowHosts},get requestProxy(){var h;return(h=r.requestProxy)!==null&&h!==void 0?h:u.requestProxy},get networkSubscribe(){var h;return(h=r.networkSubscribe)!==null&&h!==void 0?h:u.networkSubscribe}};return ajax(t,c,n,o,s)},e.prototype.loadImage=function(t,r,n,o,s,l){var u;r===void 0&&(r={}),n===void 0&&(n=noop$1),o===void 0&&(o=noop$1),s===void 0&&(s=noop$1);var c=this.options,h={timeout:(u=r.timeout)!==null&&u!==void 0?u:c.timeout,get allowHosts(){var f;return(f=r.allowHosts)!==null&&f!==void 0?f:c.allowHosts},get requestProxy(){var f;return(f=r.requestProxy)!==null&&f!==void 0?f:c.requestProxy},get networkSubscribe(){var f;return(f=r.networkSubscribe)!==null&&f!==void 0?f:c.networkSubscribe}};return loadImage(t,h,n,o,s,l)},e.prototype.preload=function(t,r){var n;r===void 0&&(r={});var o=this.options,s={timeout:(n=r.timeout)!==null&&n!==void 0?n:o.timeout,get allowHosts(){var l;return(l=r.allowHosts)!==null&&l!==void 0?l:o.allowHosts},get requestProxy(){var l;return(l=r.requestProxy)!==null&&l!==void 0?l:o.requestProxy},get networkSubscribe(){var l;return(l=r.networkSubscribe)!==null&&l!==void 0?l:o.networkSubscribe}};return preload(t,s)},e}(),internalFetcher=new Fetcher;function clamp$1(e,t,r){return e<t?t:e>r?r:e}var windowSTOContext=function(){var e=now();return{requestAnimationFrame:function(t){var r=now(),n=clamp$1(16+(r-e),16,33),o=setTimeout(function(){t(r+n)},n);return e=r+n,o},cancelAnimationFrame:function(t){return clearTimeout(t)}}}(),windowRAFContext=function(){if(typeof window<"u"){var e=window;if(e.requestAnimationFrame)return{requestAnimationFrame:e.requestAnimationFrame.bind(e),cancelAnimationFrame:e.cancelAnimationFrame.bind(e)};if(e.mozRequestAnimationFrame)return{requestAnimationFrame:e.mozRequestAnimationFrame.bind(e),cancelAnimationFrame:e.mozCancelAnimationFrame.bind(e)};if(e.webkitRequestAnimationFrame)return{requestAnimationFrame:e.webkitRequestAnimationFrame.bind(e),cancelAnimationFrame:e.webkitCancelAnimationFrame.bind(e)};if(e.msRequestAnimationFrame)return{requestAnimationFrame:e.msRequestAnimationFrame.bind(e),cancelAnimationFrame:e.msCancelAnimationFrame.bind(e)}}return windowSTOContext}(),DEFAULT_ORDER=5,deviceFrameTime=16,AnimationFrameLoop=function(){function e(){this.loopType="raf",this.frames=[],this.isAnimating=!1,this.context=null;var t=now();this.loop=(function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(this.isAnimating!==!1){var o=now(),s=o-t;t=o,deviceFrameTime=s;for(var l=0;l<this.frames.length;l++){var u=this.frames[l];if(u.delay>0){u.delay=u.delay-1;continue}try{u.callback.apply(u,__spreadArray([o,s],r,!1))}catch(c){console.error(c)}u.once&&(this.frames.splice(l,1),l--)}this.requestId=this.requestAnimationFrame(this.loop)}}).bind(this),this.start()}return Object.defineProperty(e,"shared",{get:function(){return this.sharedInstance||(this.sharedInstance=new e),this.sharedInstance},enumerable:!1,configurable:!0}),e.getFrameTime=function(){return deviceFrameTime},e.prototype.start=function(){this.isAnimating!==!0&&(this.isAnimating=!0,this.requestId=this.requestAnimationFrame(this.loop))},e.prototype.stop=function(){this.isAnimating=!1,this.cancelAnimationFrame(this.requestId)},e.prototype.setContext=function(t){t!==this.context&&(this.stop(),this.context=t,this.start())},e.prototype.getContext=function(){return this.context},e.prototype.setLoopType=function(t){t!==this.loopType&&(this.stop(),this.loopType=t,this.start())},e.prototype.getLoopType=function(){return this.loopType},e.prototype.requestAnimationFrame=function(t){if(this.context)return this.context.requestAnimationFrame(t);if(this.loopType==="raf")return windowRAFContext.requestAnimationFrame(t);if(this.loopType==="sto")return windowSTOContext.requestAnimationFrame(t)},e.prototype.cancelAnimationFrame=function(t){if(this.context)this.context.cancelAnimationFrame(t);else if(this.loopType==="raf")windowRAFContext.cancelAnimationFrame(t);else if(this.loopType==="sto")return windowSTOContext.cancelAnimationFrame(t)},e.prototype.remove=function(t){var r=this.frames.indexOf(t);r>=0&&this.frames.splice(r,1)},e.prototype.add=function(t,r,n,o){var s=this;r===void 0&&(r=!1),n===void 0&&(n=0),o===void 0&&(o=DEFAULT_ORDER);for(var l={callback:t,once:r,delay:n,order:o},u=this.frames.length;--u>=0;)if(this.frames[u].order<=o){this.frames.splice(u+1,0,l);break}return u<0&&this.frames.unshift(l),function(){return s.remove(l)}},e.prototype.clear=function(){this.frames.length=0},e}(),webp="data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoCAAIAAUAmJaQAA3AA/vz0AAA=",avif="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAAGhbWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAsaWxvYwAAAABEAAACAAEAAAABAAAB3gAAABkAAgAAAAEAAAHJAAAAFQAAAEJpaW5mAAAAAAACAAAAGmluZmUCAAAAAAEAAGF2MDFDb2xvcgAAAAAaaW5mZQIAAAAAAgAAYXYwMUFscGhhAAAAABppcmVmAAAAAAAAAA5hdXhsAAIAAQABAAAA12lwcnAAAACxaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIAAoAAAAAUaXNwZQAAAAAAAAACAAAAAgAAAA5waXhpAAAAAAEIAAAADGF2MUOBABwAAAAAOGF1eEMAAAAAdXJuOm1wZWc6bXBlZ0I6Y2ljcDpzeXN0ZW1zOmF1eGlsaWFyeTphbHBoYQAAAAAeaXBtYQAAAAAAAAACAAEEAQKDBAACBAUGhwgAAAA2bWRhdBIACgQYADLVMgsWQBhhIAQqrNj/+BIACgUYADLEoDIOFkADDDDCQAACDaqCCb4=",heif="data:image/heif;base64,AAAAGGZ0eXBoZWljAAAAAG1pZjFoZWljAAABL21ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAAAAAAAAAAAAAAAAAAAAADnBpdG0AAAAAAAEAAAAjaWluZgAAAAAAAQAAABVpbmZlAgAAAAABAABodmMxAAAAAK9pcHJwAAAAkmlwY28AAAB2aHZjQwEBYAAAAAAAAAAAAADwAPz9+PgAACcDoAABAB5AAQwG//8BYAAAAwAAAwAAAwAAAwAAAwAAreTLgSChAAEAI0IBBwFgAAADAAADAAADAAADAAADAAChInJJlreTLySZNdggogABAAdEAcA98DMkAAAAFGlzcGUAAAAAAAAAAgAAAAIAAAAVaXBtYQAAAAAAAAABAAECgQIAAAAiaWxvYwAAAABEQAABAAEAAAAAAU8AAQAAAAAAAAAOAAAAFm1kYXQAAAAKJgGvLvkQwuWM4A==";function checkImage(e){return new Promise(function(t){if(typeof Image>"u"){t(!1);return}var r=new Image,n=setTimeout(function(){r.onload=r.onerror=function(){},clearTimeout(n),t(!1)},100);r.onload=r.onerror=function(){r.onload=r.onerror=function(){},clearTimeout(n),t(r.height===2)},r.src=e})}var imageSupportCache=null;function imageSupport(){return imageSupportCache||(imageSupportCache=Promise.all([checkImage(webp),checkImage(avif),checkImage(heif)]).then(function(e){return{webp:e[0],avif:e[1],heif:e[2]}}))}var supportAvif=!1,supportWebp=!1,supportHeif=!1;imageSupport().then(function(e){supportAvif=e.avif,supportWebp=e.webp,supportHeif=e.heif});var IMAGE_FORMATS=["jpg","jpeg","png","heif","heic","webp","avif"];function isImageExt(e){return IMAGE_FORMATS.indexOf(e)>=0}var DEFAULT_IMAGE_URL_MAPPINGS={"vrlab-public.ljcdn.com":{type:"tencentCloud",pano:["vrlab-image1.ljcdn.com","vrlab-image2.ljcdn.com"],texture:["vrlab-image3.ljcdn.com"],tile:["vr-tile-1.realsee-cdn.cn","vr-tile-2.realsee-cdn.cn"],model:["vr-model-1.realsee-cdn.cn","vr-model-2.realsee-cdn.cn"],default:["vrlab-image4.ljcdn.com"]},"vr-public.realsee-cdn.cn":{type:"tencentCloud",pano:["vr-image-1.realsee-cdn.cn","vr-image-2.realsee-cdn.cn"],texture:["vr-image-3.realsee-cdn.cn"],tile:["vr-tile-1.realsee-cdn.cn","vr-tile-2.realsee-cdn.cn"],model:["vr-model-1.realsee-cdn.cn","vr-model-2.realsee-cdn.cn"],default:["vr-image-4.realsee-cdn.cn"]},"vr-public.rscdn.cn":{type:"tencentCloud",pano:["vr-image-1.rscdn.cn","vr-image-2.rscdn.cn"],texture:["vr-image-3.rscdn.cn"],tile:["vr-tile-1.rscdn.cn","vr-tile-2.rscdn.cn"],model:["vr-model-1.rscdn.cn","vr-model-2.rscdn.cn"],default:["vr-image-4.rscdn.cn"]},"mars-public.realsee-cdn.cn":{type:"aliyun",pano:["mars-image-1.realsee-cdn.cn","mars-image-2.realsee-cdn.cn"],texture:["mars-image-3.realsee-cdn.cn"],tile:["mars-tile-1.realsee-cdn.cn","mars-tile-2.realsee-cdn.cn"],model:["mars-model-1.realsee-cdn.cn","mars-model-2.realsee-cdn.cn"],default:["mars-image-4.realsee-cdn.cn"]},"global-public.realsee-cdn.com":{type:"tencentCloud",pano:["global-image-1.realsee-cdn.com","global-image-2.realsee-cdn.com"],texture:["global-image-3.realsee-cdn.com"],tile:["global-tile-1.realsee-cdn.com","global-tile-2.realsee-cdn.com"],model:["global-model-1.realsee-cdn.com","global-model-2.realsee-cdn.com"],default:["global-image-4.realsee-cdn.com"]},"earth-ga-public.realsee-cdn.cn":{type:"tencentCloud",pano:["earth-ga-image-1.realsee-cdn.cn","earth-ga-image-2.realsee-cdn.cn"],texture:["earth-ga-image-3.realsee-cdn.cn"],tile:["earth-ga-tile-1.realsee-cdn.cn","earth-ga-tile-2.realsee-cdn.cn"],model:["earth-ga-model-1.realsee-cdn.cn","earth-ga-model-2.realsee-cdn.cn"],default:["earth-ga-image-4.realsee-cdn.cn"]},"test-vr-public.realsee-cdn.com":{type:"tencentCloud",pano:["test-vr-image.realsee-cdn.com","test-vr-image.realsee-cdn.com"],texture:["test-vr-image.realsee-cdn.com"],tile:["test-vr-image.realsee-cdn.com","test-vr-image.realsee-cdn.com"],model:["test-vr-image.realsee-cdn.com","test-vr-image.realsee-cdn.com"],default:["test-vr-image.realsee-cdn.com"]},"test-vr-public.realsee-cdn.cn":{type:"tencentCloud",pano:["test-vr-image.realsee-cdn.cn","test-vr-image.realsee-cdn.cn"],texture:["test-vr-image.realsee-cdn.cn"],tile:["test-vr-image.realsee-cdn.cn","test-vr-image.realsee-cdn.cn"],model:["test-vr-image.realsee-cdn.cn","test-vr-image.realsee-cdn.cn"],default:["test-vr-image.realsee-cdn.cn"]}},URL_DOMAIN_REGEX=/^https?\:\/\/?([^\/]+)/;function getDomain(e){var t=e.match(URL_DOMAIN_REGEX);return t===null?null:t[1]}function replaceDomain(e,t){return e.replace(URL_DOMAIN_REGEX,function(r,n){return r.slice(0,r.length-n.length)+t})}function route(e,t,r){var n=t.split("."),o=n[0],s=n.slice(1);if(o==="texture")return replaceDomain(e,r.texture[0]);if(o==="pano"||o==="pano_luminance"){s[0];var l=s[1];switch(l){case"front":case"left":case"up":return replaceDomain(e,r.pano[0]);case"down":case"right":case"back":return replaceDomain(e,r.pano[1])}}else if(o==="pano_tile"||o==="pano_tile_luminance"){s[0],s[1];var u=s[2],c=s[3],h=s[4],f=Math.pow(2,Number(u))*Number(c)+Number(h);if(!isNaN(f))return replaceDomain(e,r.tile[f%2])}else if(o==="model"){var m=s[0],f=Number(m);if(!isNaN(f))return replaceDomain(e,r.model[f%2])}return replaceDomain(e,r.default[0])}var tencentCloudImageProcesser=function(e,t){var r=e.split("?")[0],n=r.split(".").pop();if(n==="jpeg"&&(n="jpg"),n==="heif"&&(n="heic"),n&&!isImageExt(n))return e;var o=[],s=t.format,l=t.cut,u=t.quality,c=t.size,h=t.sharpen;if(s==="jpeg"&&(s="jpg"),s==="heif"&&(s="heic"),(!supportAvif&&(s??n)==="avif"||!supportWebp&&(s??n)==="webp"||!supportHeif&&(s??n)==="heic")&&(s="jpg"),s!==void 0&&s!==n&&o.push("format/".concat(s)),l!==void 0&&o.push("cut/".concat(l[2],"x").concat(l[3],"x").concat(l[0],"x").concat(l[1])),u!==void 0){var f=s??n;f&&["jpg","webp","heic","avif"].indexOf(f)>=0&&o.push("quality/".concat(u))}if(c!==void 0){var m=e.match(/\/cube_(\d+)\//),y=m?Number(m[1]):NaN;y!==Number(c)&&o.push("thumbnail/".concat(c,"x"))}h!==void 0&&o.push("sharpen/".concat(h));var A="";return o.length&&(A="?imageMogr2/"+o.join("/")),r+A},aliyunOOSImageProcesser=function(e,t){var r=e.split("?")[0],n=r.split(".").pop();if(n==="jpeg"&&(n="jpg"),n==="heif"&&(n="heic"),n&&!isImageExt(n))return e;var o=[],s=t.format,l=t.cut,u=t.quality,c=t.size,h=t.sharpen;if(s==="jpeg"&&(s="jpg"),s==="heif"&&(s="heic"),(!supportAvif&&(s??n)==="avif"||!supportWebp&&(s??n)==="webp"||!supportHeif&&(s??n)==="heic")&&(s="jpg"),s!==void 0&&s!==n&&o.push("format,".concat(s)),l!==void 0){var f=l[0],m=l[1],y=l[2],A=l[3];o.push("crop,x_".concat(f,",y_").concat(m,",w_").concat(y,",h_").concat(A,",g_nw"))}if(u!==void 0&&u!==100){var M=s??n;M&&["jpg","webp","heic","avif"].indexOf(M)>=0&&o.push("quality,Q_".concat(u))}c&&c!==2048&&o.push("resize,w_".concat(c)),h!==void 0&&o.push("sharpen,".concat(h));var b="";return o.length&&(b="?x-oss-process=image/"+o.join("/")),r+b},MAX_SAFE_INTEGER=9007199254740991;function formatNumber(e){var t=Math.round(e);return Math.abs(t-e)<.001?t:Math.floor(e)}function formatOptions(e){return e=Object.assign({},e),e.size!==void 0&&(e.size=formatNumber(clamp$1(e.size,0,MAX_SAFE_INTEGER))),e.quality!==void 0&&(e.quality=formatNumber(clamp$1(e.quality,0,100))),e.cut!==void 0&&(e.cut=[formatNumber(clamp$1(e.cut[0],0,MAX_SAFE_INTEGER)),formatNumber(clamp$1(e.cut[1],0,MAX_SAFE_INTEGER)),formatNumber(clamp$1(e.cut[2],0,MAX_SAFE_INTEGER)),formatNumber(clamp$1(e.cut[3],0,MAX_SAFE_INTEGER))]),e.sharpen!==void 0&&(e.sharpen=formatNumber(clamp$1(e.sharpen,0,MAX_SAFE_INTEGER))),e}function imageURL(e,t){var r=__assign(__assign({},DEFAULT_IMAGE_URL_MAPPINGS),t.mappings),n=getDomain(e);if(n===null)return e;t=formatOptions(t);var o=r[n];return o?(e=route(e,t.key,o),/\.basis(\?|$)/.test(e)&&(e=e.replace(/\.basis(\?|$)/,".jpg$1")),o.type==="tencentCloud"?tencentCloudImageProcesser(e,t):o.type==="aliyun"?aliyunOOSImageProcesser(e,t):e):e}function applyImageURLOptions(e,t,r){t===void 0&&(t=imageURL);var n=t(e,r);if(n===e&&r.cut)throw new Error("ImageURL: cut option not applied.");return n}var IMAGE_SIZE_REG=/\/cube_(\d+)\//;function getImageSizeFromURL(e){var t=e.match(IMAGE_SIZE_REG);return t?Number(t[1]):null}function replaceImageSize(e,t){return e.replace(IMAGE_SIZE_REG,"/cube_".concat(t,"/"))}var PANO_ID_REG=/^(.*)\[(\d+)\]$/;function panoStringify(e){if(!isNaN(e.panoIndex)&&isFinite(e.panoIndex))return"".concat(e.workCode,"[").concat(e.panoIndex,"]");throw new Error("Invalid Pano")}function panoParse(e){var t=e.match(PANO_ID_REG);if(t){t[0];var r=t[1],n=t[2],o=Math.floor(Number(n));if(!isNaN(o)&&isFinite(o))return{workCode:r,panoIndex:o}}throw new Error("Invalid PanoId")}function panoEqual(e,t){return panoStringify(e)===panoStringify(t)}function isPanoId(e){return typeof e=="string"&&PANO_ID_REG.test(e)}(function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(Group);var PBMMesh=function(e){__extends(t,e);function t(r,n){var o=e.call(this,r,n)||this;return o.castShadow=!0,o.receiveShadow=!0,o}return t.prototype.update=function(r,n,o,s){for(var l=0,u=this.material;l<u.length;l++){var c=u[l];c.update(r,n,o)}},t}(Mesh),PBMSkinnedMesh=function(e){__extends(t,e);function t(r,n,o){var s=e.call(this,r,n,o)||this;return s.castShadow=!0,s.receiveShadow=!0,s}return t.prototype.update=function(r,n,o,s){for(var l=0,u=this.material;l<u.length;l++){var c=u[l];c.update(r,n,o)}},t}(SkinnedMesh);function jsonStableStrinfiy_(e,t){t===void 0&&(t=!1);var r=typeof e;if(r==="string")return JSON.stringify(e);if(e===!0)return"true";if(e===!1)return"false";if(e===null)return"null";if(e instanceof Array){for(var n="[",o=e.length-1,s=0;s<o;s++)n+=jsonStableStrinfiy_(e[s],!1)+",";return o>-1&&(n+=jsonStableStrinfiy_(e[s],!1)),n+"]"}if(e instanceof Object){if(typeof e.toJSON=="function")return jsonStableStrinfiy_(e.toJSON(),t);for(var l=Object.keys(e).sort(),u=l.length,n="",s=0;s<u;){var c=l[s],h=jsonStableStrinfiy_(e[c],!0);h!==void 0&&(s&&n!==""&&(n+=","),n+=JSON.stringify(c)+":"+h),s++}return"{"+n+"}"}switch(r){case"function":return JSON.stringify(e.toString());case"undefined":return t?void 0:null;case"number":return e;default:return isFinite(e)?e:null}}function jsonHash(e){return"hash::".concat(jsonStableStrinfiy_(e,!1))}var gradientTexture=function(){return typeof document<"u"?new TextureLoader$1().load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAABCAYAAACouxZ2AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAACAKADAAQAAAABAAAAAQAAAAB7UD0+AAACA0lEQVRIDXWUW3YjIQxEwdnV/GT/q8kO3FO3pAJst3PSAaR6Cbszf//9XeMxxpjXmI+pVXudp2s6PC4dqHff9e6D7/PZLy46xQvG+sZvrfK8xgXUeq85yINe9bdmtOK1+kun5vjgq58a+eZPna9jvmjiserqG/+Whathvo3L3WhV89L9sXI/m18z2uene9ap/ftsuT9WZxoHXzW56/fpj8l7+tTw7P011NdpqnY19sRsfuHMA9u8oZWfDz4+fra/dfG1V60ydZ7qba1g7UNAeK0JP7ydD7/OqH6wO2f7HTq+B/lbL9qsB3/N1/UzR81XfPzw4tp5OPvRneacteq8Xo0xR3vuv/kPz0KtX0Nhg0eHuaNXdWI3X/ld427h++vzyp99V6VPrzWFhbv4ayay4oFecm198MmUXN/mL+x7npq/uJXBGb/MTw4+t+SvbLoTZnUW5uHhz7nWcTxT73OwXV7cxT9wbBf/0LnDBgcnHmtPLYba32Hp808sMy1u88yhr58n70/v4xX92GSN19l/2UsqGmiH94Hpxjcs+DO/ccpIVNVp62PUWXu//ur1GQy1Cf+GZ13rtNYN1po3/NI79fGXibHkq4z25xvV2pW3szpneXsW8SsreTe/NIPrtXMnH7wPf+LEN6tqhUVHj3XKD/72p9eafCeYB3zuonnbv7yqP8d/o4K6gRb1wbYAAAAASUVORK5CYII="):new Texture}();gradientTexture.minFilter=NearestFilter;gradientTexture.magFilter=NearestFilter;gradientTexture.wrapS=RepeatWrapping;gradientTexture.wrapT=RepeatWrapping;var defaultPbmParameters={customShaders:[],pano0:null,pano1:null,floorStyle:"OPACITY",colorStyle:"RGB",constantColor:new Vector3(.6,.6,.6),shownFloorIndex:-1,modelAlpha:1,opacity:1,progress:0,transition:"FADE",clippers:null,brightness:1,useEDL:!1,useHQWeight:!1,useHQDepth:!1,pointSize:"ATTENUATION",pointBack:"DARK",pointShape:"CIRCLE",pointScale:.03,pointMaxPixel:40,pointMinPixel:1,gradientTexture,colorSaturation:0,colorBrightness:0,outlineGain:0,distanceGain:0,useAddBlend:!1};function isEqualClipperParameters(e,t){var r=e??[],n=t??[];if(n.length!==r.length)return!1;for(var o=0;o<n.length;o++)if(!r[o].clippingBoxMatrix.equals(n[o].clippingBoxMatrix)||r[o].floorIndex!==n[o].floorIndex)return!1;return!0}function isEqualPBMPanoPicture(e,t){return e&&t?e.luminanceMap===t.luminanceMap&&e.map===t.map&&e.zoom===t.zoom&&e.matrix.equals(t.matrix):!e&&!t}function updatePBMParameters(e,t){var r=!1;for(var n in t)if(t[n]!==void 0)switch(n){case"clippers":isEqualClipperParameters(e[n],t[n])||(e[n]=t[n],r=!0);break;case"pano0":case"pano1":isEqualPBMPanoPicture(e[n],t[n])||(e[n]=t[n],r=!0);break;default:e[n]!==t[n]&&(e[n]=t[n],r=!0);break}return r}function mixNumber(e,t,r){return e+(t-e)*r}function value(e,t,r,n){var o=(t*r+2*e)/Math.pow(r,3),s=-(2*t*r+3*e)/Math.pow(r,2),l=t,u=e;return o*Math.pow(n,3)+s*Math.pow(n,2)+l*n+u}function velocity(e,t,r,n){var o=(t*r+2*e)/Math.pow(r,3),s=-(2*t*r+3*e)/Math.pow(r,2),l=t;return 3*o*Math.pow(n,2)+2*s*n+l}function mixCircle(e,t,r,n){var o=n[1]-n[0];return e=circleValue(e,n),t=circleValue(t,n),t-e>o/2?mixNumber(e+o,t,r):e-t>o/2?mixNumber(e-o,t,r):mixNumber(e,t,r)}function circleValue(e,t){var r=t[1]-t[0];return e<t[0]?circleValue(e+r,t):e>=t[1]?circleValue(e-r,t):e}function mixValue(e,t,r,n){return n?mixCircle(e,t,r,n):mixNumber(e,t,r)}function toNumber(e){var t=Number(e);return isNaN(t)||!isFinite(t)?0:t}var Motion=function(){function e(t){this.config={},this.progress=1,this.ended=!0,this.value={},this.startTime=now(),this.startVelocity=0,this.duration=0,this.keyframes=[];for(var r in t){var n=t[r];typeof n=="object"?(this.value[r]=toNumber(n.value),this.config[r]={circle:n.circle}):(this.value[r]=toNumber(n),this.config[r]={circle:!1})}this.keyframes=[{progress:0,value:__assign({},this.value)},{progress:1,value:__assign({},this.value)}]}return e.prototype.getProgress=function(t){var r=t-this.startTime;return r<0?0:r>=this.duration?1:1-value(1,this.startVelocity,this.duration,r)},e.prototype.getValue=function(t){for(var r=1;r<this.keyframes.length;r++)if(this.keyframes[r].progress>t){var n=this.keyframes[r-1],o=this.keyframes[r],s={};for(var l in this.config){var u=(t-n.progress)/(o.progress-n.progress);s[l]=mixValue(n.value[l],o.value[l],u,this.config[l].circle)}return s}return __assign({},this.keyframes[this.keyframes.length-1].value)},e.prototype.getProgressVelocity=function(t){var r=t-this.startTime;return r>=this.duration?0:velocity(1,this.startVelocity,this.duration,r)},e.prototype.update=function(t){return this.ended?!0:(this.progress=Math.min(1,Math.max(0,this.progress,this.getProgress(t))),this.value=this.getValue(this.progress),this.ended=this.progress>=1,this.ended&&this.callbacks&&(this.callbacks[0](),this.callbacks=void 0),this.ended)},e.prototype.getKeyFrameSegment=function(t){for(var r=this.getProgress(t),n=1;n<this.keyframes.length;n++)if(this.keyframes[n].progress>r)return[this.keyframes[n-1],this.keyframes[n]];return[this.keyframes[this.keyframes.length-2],this.keyframes[this.keyframes.length-1]]},e.prototype.getTargetKeyframe=function(){return this.keyframes[this.keyframes.length-1]},e.prototype.set=function(t,r,n,o){var s;n===void 0&&(n=0),isNaN(r)&&(r=0),isNaN(n)&&(n=0),o=o??now();var l=this.getProgress(o),u=this.getValue(l),c={};for(var h in this.config)c[h]=(s=t[h])!==null&&s!==void 0?s:u[h];var f=[{progress:0,value:u},{progress:1,value:c}];return this.setKeyframes(f,r,n,o)},e.prototype.setKeyframes=function(t,r,n,o){var s=this;if(n===void 0&&(n=0),t.length<2)throw new Error("keyframes invalid.");return isNaN(r)&&(r=0),isNaN(n)&&(n=0),this.callbacks&&(this.callbacks[1](new Error("motion aborted.")),this.callbacks=void 0),new Promise(function(l,u){o=o??now(),s.progress=0,s.ended=!1,s.startTime=o,s.startVelocity=n,s.keyframes=t,s.duration=r,r===0?(s.progress=1,s.value=__assign({},t[t.length-1].value)):s.value=__assign({},t[0].value),s.callbacks=[l,u]})},e.prototype.dispose=function(){this.callbacks&&(this.callbacks[1](new Error("motion dispose.")),this.callbacks=void 0)},e}(),APPEAR_ANIMATION_DURATION=500;function easeInCubic(e){return e*e*e}var PBMPointCloud=function(e){__extends(t,e);function t(r,n){var o=e.call(this,r,n)||this;return o.appearMotion=new Motion({appear:0}),o}return t.prototype.update=function(r,n,o,s){var l,u;if(this.material.update(r,n,o),s&&s.refine==="ADD"&&s.tileset.rootMeta.pntsOrder==="RANDOM"){var c=this.geometry,h=this.appearMotion,f=o.visible&&s.state.selectedFrameNumber===s.tileset.frameNumber,m=s.tileset.currentMaxScreenSpaceError,y=s.state.screenSpaceError,A=(u=(l=s.parent)===null||l===void 0?void 0:l.state.screenSpaceError)!==null&&u!==void 0?u:y,M=1;if(A!==y&&(M=(A-m)/(A-y)),M=clamp$1(M,0,1),M=easeInCubic(M),f){var b=1;h.getTargetKeyframe().value.appear!==b&&h.set({appear:b},APPEAR_ANIMATION_DURATION).catch(noop$1)}else{var b=0;h.getTargetKeyframe().value.appear!==b&&h.set({appear:b},0).catch(noop$1)}h.ended!==!0&&h.update(n.time);var T=c.index?c.index.count:c.attributes.position?c.attributes.position.count:1/0,_=Math.floor(T*M*h.value.appear);c.drawRange.count!==_&&(this.geometry.setDrawRange(0,_),o.needsRender=!0)}},t}(Points),scratchMaterialSet=new Set;(function(e){__extends(t,e);function t(){var r=e.call(this)||this;return r.needsRender=!0,r.pbmMaterialParametersVersion=0,r.materialParameters=__assign({},defaultPbmParameters),r}return t.prototype.getMaterial=function(){return __assign({},this.materialParameters)},t.prototype.setMaterial=function(r){var n=this;Object.assign(this.materialParameters,r),scratchMaterialSet.clear(),this.traverse(function(o){if(o instanceof PBMMesh||o instanceof PBMSkinnedMesh)for(var s=0,l=o.material;s<l.length;s++){var u=l[s];scratchMaterialSet.has(u)||(Object.assign(u,n.materialParameters),scratchMaterialSet.add(u))}o instanceof PBMPointCloud&&(scratchMaterialSet.has(o.material)||(Object.assign(o.material,n.materialParameters),scratchMaterialSet.add(o.material)))}),scratchMaterialSet.clear(),this.needsRender=!0},t})(Group);var FACE_ORDER$1=["right","left","up","down","front","back"];function getBox(e,t,r,n){var o=new Box3;switch(e){case"up":o.min.y=.5,o.max.y=.5,o.min.x=+t-.5,o.max.x=+t-.5+n,o.min.z=-r+.5-n,o.max.z=-r+.5;break;case"down":o.min.y=-.5,o.max.y=-.5,o.min.x=+t-.5,o.max.x=+t-.5+n,o.min.z=+r-.5,o.max.z=+r-.5+n;break;case"left":o.min.x=-.5,o.max.x=-.5,o.min.z=-t+.5-n,o.max.z=-t+.5,o.min.y=-r+.5-n,o.max.y=-r+.5;break;case"right":o.min.x=.5,o.max.x=.5,o.min.z=+t-.5,o.max.z=+t-.5+n,o.min.y=-r+.5-n,o.max.y=-r+.5;break;case"front":o.min.z=-.5,o.max.z=-.5,o.min.x=+t-.5,o.max.x=+t-.5+n,o.min.y=-r+.5-n,o.max.y=-r+.5;break;case"back":o.min.z=.5,o.max.z=.5,o.min.x=-t+.5-n,o.max.x=-t+.5,o.min.y=-r+.5-n,o.max.y=-r+.5;break}return o.applyMatrix4(new Matrix4().makeRotationY(Math.PI))}var createChildren=function(e,t){if(!(e.level>=t))for(var r=e.level+1,n=e.size/2,o=[new Vector2(e.position.x,e.position.y),new Vector2(e.position.x+n,e.position.y),new Vector2(e.position.x,e.position.y+n),new Vector2(e.position.x+n,e.position.y+n)],s=0,l=o;s<l.length;s++){var u=l[s],c={face:e.face,level:r,size:n,position:u,box:getBox(e.face,u.x,u.y,n),parent:e,children:[]};e.children.push(c),createChildren(c,t)}};function createTileCubeNode(e,t){var r={level:0,face:e,position:new Vector2(0,0),size:1,box:getBox(e,0,0,1),parent:null,children:[]};return createChildren(r,t),r}function createTileCubeTree(e){var t=FACE_ORDER$1.map(function(r){return createTileCubeNode(r,e)});return{children:t}}function traverseTileCubeNode(e,t){for(var r=0,n=e.children;r<n.length;r++){var o=n[r],s=t(o);s!==!1&&traverseTileCubeNode(o,t)}}function pick(e,t){for(var r={},n=0,o=t;n<o.length;n++){var s=o[n];s in e&&(r[s]=e[s])}return r}function omit(e,t){for(var r=__assign({},e),n=0,o=t;n<o.length;n++){var s=o[n];s in r&&delete r[s]}return r}var CUBE_GEOMETRY=new BoxBufferGeometry(1,1,1,1,1);CUBE_GEOMETRY.deleteAttribute("uv");CUBE_GEOMETRY.deleteAttribute("normal");CUBE_GEOMETRY.groups=[];CUBE_GEOMETRY.scale(-1,1,1);var CUBE_VERTEX_SHADER=`
varying vec3 worldPosition;
void main() {
  vec4 transform = vec4(position, 1.0);
  worldPosition = (modelMatrix * transform).xyz;
  gl_Position = projectionMatrix * modelViewMatrix * transform;
}
`,CUBE_RAGMENT_SHADER=`
uniform samplerCube map;
varying vec3 worldPosition;
void main() {
  gl_FragColor = textureCube(map, worldPosition);
}
`,CUBE_MATERIAL=new ShaderMaterial({uniforms:{map:{value:null}},vertexShader:CUBE_VERTEX_SHADER,fragmentShader:CUBE_RAGMENT_SHADER,depthTest:!1,depthWrite:!1,stencilWrite:!1,blending:NoBlending,lights:!1,toneMapped:!1,fog:!1}),scene$3=new Scene$1;scene$3.matrixAutoUpdate=!1;var mesh$5=new Mesh(CUBE_GEOMETRY,CUBE_MATERIAL);mesh$5.matrixAutoUpdate=!1;scene$3.add(mesh$5);function renderCubeTextureToCubeRenderTarget(e,t,r){CUBE_MATERIAL.uniforms.map.value=e;var n=r.autoClear;r.autoClear=!1;var o=new CubeCamera(.1,2,t);o.matrixAutoUpdate=!1,o.update(r,scene$3),r.autoClear=n,CUBE_MATERIAL.uniforms.map.value=null}var _a$5,SQRT1_2$1=(_a$5=Math.SQRT1_2)!==null&&_a$5!==void 0?_a$5:Math.sqrt(2),QUATERNION={up:new Quaternion(SQRT1_2$1,0,0,SQRT1_2$1),down:new Quaternion(-SQRT1_2$1,0,0,SQRT1_2$1),left:new Quaternion(0,SQRT1_2$1,0,SQRT1_2$1),right:new Quaternion(0,-SQRT1_2$1,0,SQRT1_2$1),front:new Quaternion(0,0,0,1),back:new Quaternion(0,1,0,0)},PLAME_GEOMETRY=function(){var e=new Float32Array([-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0]),t=new Float32Array([0,0,1,0,0,1,1,1]),r=new Uint8Array([0,1,2,1,3,2]),n=new BufferGeometry;return n.setAttribute("position",new BufferAttribute(e,3)),n.setAttribute("uv",new BufferAttribute(t,2)),n.setIndex(new BufferAttribute(r,1)),n}(),PLANE_VERTEX_SHADER=`
varying vec2 vUv;
uniform float flipY;
void main() {
  vUv = vec2(uv.x, mix(uv.y, (1.0 - uv.y), flipY));
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,PLANE_FRAGMENT_SHADER=`
uniform sampler2D map;
varying vec2 vUv;
void main() {
  gl_FragColor = texture2D(map, vUv);
}
`,cacheMaterials=[],cameraPX=new PerspectiveCamera(90,1,.1,2);cameraPX.up.set(0,-1,0);cameraPX.lookAt(new Vector3(1,0,0));cameraPX.updateMatrix();cameraPX.matrixAutoUpdate=!1;var cameraNX=new PerspectiveCamera(90,1,.1,2);cameraNX.up.set(0,-1,0);cameraNX.lookAt(new Vector3(-1,0,0));cameraNX.updateMatrix();cameraNX.matrixAutoUpdate=!1;var cameraPY=new PerspectiveCamera(90,1,.1,2);cameraPY.up.set(0,0,1);cameraPY.lookAt(new Vector3(0,1,0));cameraPY.updateMatrix();cameraPY.matrixAutoUpdate=!1;var cameraNY=new PerspectiveCamera(90,1,.1,2);cameraNY.up.set(0,0,-1);cameraNY.lookAt(new Vector3(0,-1,0));cameraNY.updateMatrix();cameraNY.matrixAutoUpdate=!1;var cameraPZ=new PerspectiveCamera(90,1,.1,2);cameraPZ.up.set(0,-1,0);cameraPZ.lookAt(new Vector3(0,0,1));cameraPZ.updateMatrix();cameraPZ.matrixAutoUpdate=!1;var cameraNZ=new PerspectiveCamera(90,1,.1,2);cameraNZ.up.set(0,-1,0);cameraNZ.lookAt(new Vector3(0,0,-1));cameraNZ.updateMatrix();cameraNZ.matrixAutoUpdate=!1;var FACES={front:{camera:cameraPZ,index:4},back:{camera:cameraNZ,index:5},up:{camera:cameraPY,index:2},down:{camera:cameraNY,index:3},left:{camera:cameraNX,index:1},right:{camera:cameraPX,index:0}};function getMaterial(){var e=cacheMaterials.pop();return e||new ShaderMaterial({uniforms:{map:{value:null},flipY:{value:0}},vertexShader:PLANE_VERTEX_SHADER,fragmentShader:PLANE_FRAGMENT_SHADER,depthTest:!1,depthWrite:!1,stencilWrite:!1,blending:NoBlending,lights:!1,toneMapped:!1,fog:!1})}function releaseMaterial(e){e.uniforms.map.value=null,cacheMaterials.push(e)}function renderTexturesToCubeRenderTarget(e,t,r){var n=new Scene$1;n.matrixAutoUpdate=!1;var o=new Group;o.scale.set(1,1,-1),n.add(o);for(var s=[],l=new Set,u=0,c=e;u<c.length;u++){var h=c[u];l.add(h.face);var f=getMaterial();s.push(f),f.uniforms.map.value=h.texture,f.uniforms.flipY.value=h.flipY?1:0;var m=new Group,y=new Mesh(PLAME_GEOMETRY,f);y.position.set(h.position.x+h.size.x/2-.5,1-(h.position.y+h.size.y/2)-.5,-.5),y.scale.set(h.size.x,h.size.y,1),m.quaternion.copy(QUATERNION[h.face]),m.add(y),o.add(m)}var A=r.autoClear,M=r.sortObjects,b=r.xr.enabled,T=t.texture.generateMipmaps;r.autoClear=!1,r.sortObjects=!1,r.xr.enabled=!1,t.texture.generateMipmaps=!1;var _=r.getRenderTarget(),S=0;l.forEach(function(F){++S===l.size&&(t.texture.generateMipmaps=T),r.setRenderTarget(t,FACES[F].index),r.render(n,FACES[F].camera)}),r.setRenderTarget(_),r.autoClear=A,r.sortObjects=M,r.xr.enabled=b;for(var C=0,P=s;C<P.length;C++){var f=P[C];releaseMaterial(f)}}var canUseNativeImageBitmap=function(){return!1}();function createImageBitmapLikeImage(e){e===void 0&&(e={});var t=Object.assign(document.createElementNS("http://www.w3.org/1999/xhtml","img"),{crossOrigin:"",close:function(){e.onClose&&e.onClose.call(this),this.onerror=this.onload=this.close=noop$1,this.removeAttribute("src")}});return t}function createImageBitmapLike(e){return new Promise(function(t,r){var n=URL.createObjectURL(e),o=createImageBitmapLikeImage({onClose:function(){this.src===n&&URL.revokeObjectURL(n)}});o.onload=function(){o.src===n&&URL.revokeObjectURL(n),o.onload=o.onerror=noop$1,setTimeout(function(){t(o)},10)},o.onerror=function(){var s=o.src;o.onload=o.onerror=noop$1,o.close(),r(new Error("image load error: ".concat(s)))},o.decoding="async",o.src=n})}var canvasPool=[];function createCanvas(e,t){var r=canvasPool.shift();if(r)return r.width=e,r.height=t,r;var n=Object.assign(document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),{close:function(){n.close=noop$1,canvasPool.push(n)}});return n}function poolImageToTexture(e,t){if(t&&(e.width>t.width||e.height>t.height)){var r=createCanvas(Math.min(e.width,t.width),Math.min(e.height,t.height)),n=r.getContext("2d");n.clearRect(0,0,r.width,r.height),n.drawImage(e,0,0,r.width,r.height),e.close();var o=new Texture(r);o.needsUpdate=!0,o.flipY=!0;var s=o.dispose;return o.dispose=function(){r.close(),s.call(o),o.dispose=s},o}else{var l=new Texture(e);l.needsUpdate=!0,typeof ImageBitmap<"u"&&e instanceof ImageBitmap?l.flipY=!1:l.flipY=!0;var u=l.dispose;return l.dispose=function(){e.close(),u.call(l),l.dispose=u},l}}function poolImagesToCubeTexture(e){var t=new CubeTexture(e);t.needsUpdate=!0,t.flipY=!1;var r=t.dispose;return t.dispose=function(){for(var n=0,o=e;n<o.length;n++){var s=o[n];s.close()}r.call(t),t.dispose=r},t}var sharedSortVector3$1=new Vector3,FACE_ORDER=["right","left","up","down","front","back"],TileCubeTextureTarget=function(){function e(t,r,n,o,s){var l,u,c;this.tileTree=r,this.tileSources=n,this.options=o,this.renderer=s,this.name="",this.needsRender=!1,this.baseLevel=0,this.maxRequest=e.DEFAULT_MAX_REQUEST,this.disposed=!1,this.loadedCubeNodes=new Set,this.loadingCubeNodes=new Set,this.drawedCubeNodes=new Set,this.baseCubeTexture=null,this._cubeRenderTarget=null,this.prepareToRender=[],this.baseCubeTexture=t;var h=(l=this.baseCubeTexture.images)!==null&&l!==void 0?l:[],f=Array.isArray(h)&&h[0]&&h[0].width||((c=(u=o.imageURL)===null||u===void 0?void 0:u.options)===null||c===void 0?void 0:c.size);typeof f!="number"&&(f=2048),this.baseLevel=Math.floor(f/512)-1}return Object.defineProperty(e.prototype,"cubeRenderTarget",{get:function(){return this._cubeRenderTarget},set:function(t){var r,n,o,s,l,u;if(t===null)throw new Error("cannot set cubeRenderTarget to null.");t.width!==this.options.textureSize&&t.setSize(this.options.textureSize,this.options.textureSize),t.texture.format=(r=this.options.format)!==null&&r!==void 0?r:RGBAFormat,t.texture.minFilter=(n=this.options.minFilter)!==null&&n!==void 0?n:LinearFilter,t.texture.magFilter=(o=this.options.magFilter)!==null&&o!==void 0?o:LinearFilter,t.texture.wrapS=(s=this.options.wrapS)!==null&&s!==void 0?s:ClampToEdgeWrapping,t.texture.wrapT=(l=this.options.wrapT)!==null&&l!==void 0?l:ClampToEdgeWrapping,t.texture.generateMipmaps=(u=this.options.generateMipmaps)!==null&&u!==void 0?u:!0,this.baseCubeTexture&&(renderCubeTextureToCubeRenderTarget(this.baseCubeTexture,t,this.renderer),this.baseCubeTexture.dispose(),this.baseCubeTexture=null),this._cubeRenderTarget&&renderCubeTextureToCubeRenderTarget(this._cubeRenderTarget.texture,t,this.renderer),this._cubeRenderTarget=t},enumerable:!1,configurable:!0}),e.prototype.requestTile=function(t){var r=this,n,o,s,l,u,c,h=this.tileSources.filter(function(b){return b.level===t.level})[0];if(this.baseLevel>=t.level||!h)return this.loadedCubeNodes.add(t),this.prepareToRender.push({node:t,texture:null}),!1;var f=h.size,m=Math.pow(2,t.level)*t.position.y,y=Math.pow(2,t.level)*t.position.x,A="".concat(((s=(o=(n=this.options.imageURL)===null||n===void 0?void 0:n.options)===null||o===void 0?void 0:o.key)!==null&&s!==void 0?s:"pano.0").replace(/^pano/,"pano_tile"),".").concat(t.face,".").concat(t.level,".").concat(m,".").concat(y),M=__assign(__assign({},pick((u=(l=this.options.imageURL)===null||l===void 0?void 0:l.options)!==null&&u!==void 0?u:{key:"unknown"},["format","sharpen","mappings"])),{key:A,size:h.scale>=1?void 0:f*t.size*h.scale,cut:t.size===1?void 0:[f*t.position.x,f*t.position.y,f*t.size,f*t.size]});return t.size===1&&console.warn("tile: ".concat(M.key," should not appear.")),t.level===1&&h.scale>=.5&&(M.format==="jpg"||/\.jpg$/.test(h[t.face]))&&(M.size=void 0,M.quality||(M.quality=70)),this.loadingCubeNodes.add(t),this.options.textureLoader.loadTexture(h[t.face],{imageURL:{transform:(c=this.options.imageURL)===null||c===void 0?void 0:c.transform,options:__assign({},M)},format:RGBAFormat,timeout:this.options.timeout,magFilter:this.options.magFilter,minFilter:this.options.minFilter,fetcher:this.options.fetcher}).then(function(b){if(r.disposed){b.body.dispose();return}r.prepareToRender.push({node:t,texture:b.body}),r.loadedCubeNodes.add(t)}).catch(noop$1).then(function(){r.disposed||r.loadingCubeNodes.delete(t)}),!0},e.prototype.update=function(t,r){var n=this;if(!this.disposed){var o=t.planes[5].normal,s=Math.max(this.maxRequest-this.loadingCubeNodes.size,0),l=[];traverseTileCubeNode(this.tileTree,function(_){if(_.level>r||!t.intersectsBox(_.box))return!1;!n.loadedCubeNodes.has(_)&&!n.loadingCubeNodes.has(_)&&l.push(_)}),l.sort(function(_,S){return _.level!==S.level?_.level-S.level:_.box.getCenter(sharedSortVector3$1).angleTo(o)-S.box.getCenter(sharedSortVector3$1).angleTo(o)});for(var u=0,c=l;u<c.length;u++){var h=c[u];if(s<=0)break;var f=this.requestTile(h);f&&s--}if(this.cubeRenderTarget&&this.prepareToRender.length){this.prepareToRender.sort(function(_,S){return _.node.level-S.node.level});for(var m=[],y=0;y<this.prepareToRender.length;y++){var A=this.prepareToRender[y],h=A.node,M=A.texture;(h.parent===null||this.drawedCubeNodes.has(h.parent))&&(this.drawedCubeNodes.add(h),M&&m.push({face:h.face,position:h.position,size:new Vector2(h.size,h.size),texture:M,flipY:!M.flipY}),this.prepareToRender.splice(y,1),y--)}if(m.length){renderTexturesToCubeRenderTarget(m,this.cubeRenderTarget,this.renderer);for(var b=0,T=m;b<T.length;b++){var M=T[b];M.texture.dispose()}this.needsRender=!0}}}},Object.defineProperty(e.prototype,"tilePending",{get:function(){return this.loadingCubeNodes.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){if(!this._cubeRenderTarget)throw new Error("cubeRenderTarget never set.");return this._cubeRenderTarget.texture},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(!this.disposed){this.disposed=!0,this.baseCubeTexture&&(this.baseCubeTexture.dispose(),this.baseCubeTexture=null),this.loadingCubeNodes.clear(),this.loadedCubeNodes.clear();for(var t=0,r=this.prepareToRender;t<r.length;t++){var n=r[t];n.texture&&n.texture.dispose()}this.prepareToRender.length=0}},e.DEFAULT_MAX_REQUEST=3,e}(),TextureLoader=function(){function e(){}return e.prototype.loadTexture=function(t,r,n,o,s,l){var u,c,h,f,m,y,A;n===void 0&&(n=noop$1),o===void 0&&(o=noop$1),s===void 0&&(s=noop$1);var M={};typeof r.flipY<"u"&&(M.flipY=r.flipY),typeof r.format<"u"&&(M.format=r.format),typeof r.encoding<"u"&&(M.encoding=r.encoding),M.generateMipmaps=(u=r.generateMipmaps)!==null&&u!==void 0?u:!1,M.minFilter=(c=r.minFilter)!==null&&c!==void 0?c:LinearFilter,M.magFilter=(h=r.magFilter)!==null&&h!==void 0?h:LinearFilter;var b=(m=(f=r.imageURL)===null||f===void 0?void 0:f.options)!==null&&m!==void 0?m:{key:"unknown"};t=applyImageURLOptions(t,(y=r.imageURL)===null||y===void 0?void 0:y.transform,b);var T=getProtocol(t),_=(A=r.viaAjax)!==null&&A!==void 0?A:canUseNativeImageBitmap,S=isJsonpSource(t),C=/^https?:/.test(T);if(S?_=!0:C||(_=!1),_){var P=null,F="blob";return r.fetcher.ajax(t,{timeout:r.timeout,responseType:F},void 0,void 0,s).then(function(V){return createImageBitmapLike(V.body)}).then(function(V){return poolImageToTexture(V,r.maxSize)}).then(function(V){return Object.assign(V,M),V}).then(function(V){var q={meta:P,body:V};return n(q),q}).catch(function(V){return o(V),Promise.reject(V)})}else{var O=null,N;return Promise.resolve().then(function(){return createImageBitmapLikeImage()}).then(function(V){return N=V,r.fetcher.loadImage(t,{timeout:r.timeout},void 0,void 0,s,V)}).then(function(V){return O=V.meta,poolImageToTexture(V.body,r.maxSize)}).then(function(V){return Object.assign(V,M),V}).then(function(V){var q={meta:O,body:V};return n(q),q}).catch(function(V){return N&&N.close(),o(V),Promise.reject(V)})}},e.prototype.loadCubeTexture=function(t,r,n,o,s,l){var u,c,h,f,m,y,A;n===void 0&&(n=noop$1),o===void 0&&(o=noop$1),s===void 0&&(s=noop$1);var M={};typeof r.format<"u"&&(M.format=r.format),M.generateMipmaps=(u=r.generateMipmaps)!==null&&u!==void 0?u:!1,M.minFilter=(c=r.minFilter)!==null&&c!==void 0?c:LinearFilter,M.magFilter=(h=r.magFilter)!==null&&h!==void 0?h:LinearFilter;for(var b=[t[FACE_ORDER[0]],t[FACE_ORDER[1]],t[FACE_ORDER[2]],t[FACE_ORDER[3]],t[FACE_ORDER[4]],t[FACE_ORDER[5]]],T=[],_=[0,0,0,0,0,0],S=[],C=function(F){var O=(m=(f=r.imageURL)===null||f===void 0?void 0:f.options)!==null&&m!==void 0?m:{key:"unknown"},N=applyImageURLOptions(b[F],(y=r.imageURL)===null||y===void 0?void 0:y.transform,__assign(__assign({},O),{key:O.key+"."+FACE_ORDER[F]})),V=getProtocol(N),q=function(te){_[F]=te,s(_.reduce(function(X,K){return X+K},0)/6)},Q=(A=r.viaAjax)!==null&&A!==void 0?A:!1,z=/^https?:$/.test(V),H=isJsonpSource(N);if(H?Q=!0:z||(Q=!1),Q){var W="blob",J=r.fetcher.ajax(N,{timeout:r.timeout,responseType:W},void 0,void 0,q).then(function(te){return S[F]=te.meta,createImageBitmapLike(te.body)});T.push(J)}else{var G,J=Promise.resolve().then(function(){return createImageBitmapLikeImage()}).then(function(X){return G=X,r.fetcher.loadImage(N,{timeout:r.timeout},void 0,void 0,q,X)}).then(function(X){return S[F]=X.meta,X.body}).catch(function(X){return G&&G.close(),Promise.reject(X)});T.push(J)}},P=0;P<6;P++)C(P);return Promise.all(T).then(function(F){return poolImagesToCubeTexture(F)}).then(function(F){return Object.assign(F,__assign({encoding:sRGBEncoding},M)),F}).then(function(F){var O={body:F,meta:S};return n(O),O}).catch(function(F){for(var O=0,N=T;O<N.length;O++){var V=N[O];V.then(function(q){return q.close()}).catch(noop$1)}return o(F),Promise.reject(F)})},e.prototype.loadTiledCubeTexture=function(t,r,n,o,s,l,u){var c=this;return o===void 0&&(o=noop$1),s===void 0&&(s=noop$1),l===void 0&&(l=noop$1),new Promise(function(h,f){var m,y;c.loadCubeTexture(t,{imageURL:{transform:(m=n.imageURL)===null||m===void 0?void 0:m.transform,options:(y=n.imageURL)===null||y===void 0?void 0:y.options},format:RGBAFormat,viaAjax:n.viaAjax,timeout:n.timeout,fetcher:n.fetcher,magFilter:n.magFilter,minFilter:n.minFilter,generateMipmaps:n.generateMipmaps},function(A){var M,b=A.meta,T=A.body,_=(M=n.tileMaxLevel)!==null&&M!==void 0?M:2,S=Math.max(1024*_,512),C=createTileCubeTree(_),P=new TileCubeTextureTarget(T,C,r,{textureSize:S,textureLoader:c,imageURL:n.imageURL,magFilter:n.magFilter,minFilter:n.minFilter,generateMipmaps:n.generateMipmaps,timeout:n.timeout,fetcher:n.fetcher},u),F={meta:b,body:P};o(F),h(F)},function(A){s(A),f(A)},l,u).catch(noop$1)})},e}();const meshNoneVertexShader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=113,n=126,o=0,s="";return e[o].split(s).map(function(l){return l.charCodeAt(o)>n?l:String.fromCharCode((l.charCodeAt(o)+r)%n)}).join(s)}("n\bv{t-rpA-Sv{ny]|vv|{Hn\bv{t-rp@-PnzrnQvrpv|{H0v{pyqr-Ip|zz|{K0v{pyqr-Iz|}untrl}nlrr\x07K0v{pyqr-Ixv{{v{tl}nlrr\x07K0v{pyqr-Iy|tqr}uosl}nlrr\x07K0v{pyqr-Ipyv}}v{tl}yn{rl}nlrr\x07KZNV[lORS\\_R|vq-znv{56-\n--ZNV[l`aN_a--0v{pyqr-Ixv{onrlrr\x07K--0v{pyqr-Iortv{lrr\x07K--0v{pyqr-Iz|}untrlrr\x07K--0v{pyqr-Ixv{{v{tlrr\x07K--0v{pyqr-I}|wrplrr\x07K--0v{pyqr-Iy|tqr}uoslrr\x07K--0v{pyqr-Ipyv}}v{tl}yn{rlrr\x07K--Sv{ny]|vv|{-J-rpA5n{s|zrq9->;=6H--0vsqrs-b`RlV[`aN[PV[T----Sv{ny]|vv|{-J-v{n{prZnv\x07-7-Sv{ny]|vv|{H--0r{qvs--Sv{ny]|vv|{-J-z|qryZnv\x07-7-Sv{ny]|vv|{H--zn@-pnzrn_|nv|{Znv\x07-J-zn@5vrZnv\x07h=jh=j9-vrZnv\x07h>jh=j9-vrZnv\x07h?jh=j9-vrZnv\x07h=jh>j9-vrZnv\x07h>jh>j9-vrZnv\x07h?jh>j9-vrZnv\x07h=jh?j9-vrZnv\x07h>jh?j9-vrZnv\x07h?jh?j6H--PnzrnQvrpv|{-J-{|znyv	r5pnzrn_|nv|{Znv\x07-7-rp@5=;=9-=;=9-:>;=66H--0v{pyqr-I|yq}|lrr\x07K--0v{pyqr-Is|tlrr\x07K--ZNV[lR[Q\f"),meshNoneFragmentShader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=113,n=126,o=0,s="";return e[o].split(s).map(function(l){return l.charCodeAt(o)>n?l:String.fromCharCode((l.charCodeAt(o)+r)%n)}).join(s)}("0qrsv{r-OYNPXlP\\Y\\_-rpA5=;=EC9-=;>=C9-=;>AF9->;=6{vs|z-nz}yrPor-}n{|=lzn}H{vs|z-znA-}n{|=lznv\x07H{vs|z-sy|n-}n{|=l	||zH0vs-qrsv{rq5b`RlYbZV[N[PR6--{vs|z-nz}yrPor-}n{|=lyzv{n{prZn}H0r{qvs{vs|z-nz}yrPor-}n{|>lzn}H{vs|z-znA-}n{|>lznv\x07H{vs|z-sy|n-}n{|>l	||zH0vs-qrsv{rq5b`RlYbZV[N[PR6--{vs|z-nz}yrPor-}n{|>lyzv{n{prZn}H0r{qvs{vs|z-sy|n-z|qryNy}unH{vs|z-sy|n-}|trHn\bv{t-rpA-Sv{ny]|vv|{Hn\bv{t-rp@-PnzrnQvrpv|{H{vs|z-sy|n-u|{Sy||V{qr\x07H{vs|z-rp?-r|yv|{H{vs|z-sy|n-}v\x07ry_nv|H0vs{qrs-SYNal`UNQRQ--n\bv{t-rp@-[|znyH0r{qvs0v{pyqr-Ip|zz|{K0v{pyqr-Iqvurv{tl}nlsntzr{K0v{pyqr-Is|tl}nlsntzr{K0v{pyqr-I}rpynzn}l}nlsntzr{K0v{pyqr-Iy|tqr}uosl}nlsntzr{K0v{pyqr-Ipyv}}v{tl}yn{rl}nlsntzr{Krp@-	||zcrp|5rp@-qvrpv|{9-rp@-rp|9-sy|n-	||z6-\n--sy|n-urn-J-q|5qvrpv|{9-rp|6H--rp@-q-J-qvrpv|{-7-urnH--rp@-}-J-rp|-:-qH--rp@-\0-J-}-7-	||zH--r{-{|znyv	r5q-8-\x006H\fZNV[lORS\\_R|vq-znv{56-\n--ZNV[l`aN_a--0v{pyqr-Ipyv}}v{tl}yn{rlsntzr{K--<<-JJJ-全景图-JJJ--rp@-}n{|=a|crr\x07-J-{|znyv	r5Sv{ny]|vv|{;\x07\b	-:-}n{|=lznv\x07h@j;\x07\b	6H--}n{|=a|crr\x07-J-	||zcrp|5PnzrnQvrpv|{9-}n{|=a|crr\x079-}n{|=l	||z6H--}n{|=a|crr\x07-J-}n{|=a|crr\x07-7-zn@5}n{|=lznv\x076H--rp@-}n{|>a|crr\x07-J-{|znyv	r5Sv{ny]|vv|{;\x07\b	-:-}n{|>lznv\x07h@j;\x07\b	6H--}n{|>a|crr\x07-J-	||zcrp|5PnzrnQvrpv|{9-}n{|>a|crr\x079-}n{|>l	||z6H--}n{|>a|crr\x07-J-}n{|>a|crr\x07-7-zn@5}n{|>lznv\x076H--rpA-}n{|P|y|H--rpA-}n{|=P|y|-J-r\x07rPor5}n{|=lzn}9-}n{|=a|crr\x076H--rpA-}n{|>P|y|-J-r\x07rPor5}n{|>lzn}9-}n{|>a|crr\x076H--0vs-qrsv{rq5b`RlYbZV[N[PR6----}n{|=P|y|;n-J->;=-:-r\x07rPor5}n{|=lyzv{n{prZn}9-}n{|=a|crr\x076;H----}n{|>P|y|;n-J->;=-:-r\x07rPor5}n{|>lyzv{n{prZn}9-}n{|>a|crr\x076;H--0r{qvs--0vs-qrsv{rq5b`RlOYNPXla_N[`VaV\\[6----sy|n-oynpx]|tr-J-np|5:?;=-7-}|tr-8->;=6H----}n{|P|y|-J-zv\x075}n{|=P|y|9-OYNPXlP\\Y\\_9-zv{5>;=9-oynpx]|tr66H----}n{|P|y|-J-zv\x075}n{|P|y|9-}n{|>P|y|9-zn\x075=;=9-oynpx]|tr-:-]V-8->;=66H--0ryvs-qrsv{rq5b`Rl`]_RNQla_N[`VaV\\[6----rp?-prr{Pr{rP||q-J-r|yv|{-7-}v\x07ry_nv|-<-?;=H----sy|n-n{vv|{_nqv-J-qvn{pr5rp?5=;=9-=;=69-prr{Pr{rP||q6-7->;?H----sy|n-n{vv|{]|tr-J--qvn{pr5tylSntP||q;\x07\b9-prr{Pr{rP||q6-<-n{vv|{_nqvH----}n{|P|y|-J-zv\x075}n{|=P|y|9-}n{|>P|y|9-z||ur}5=;=9-=;?9-}|tr-:-n{vv|{]|tr66H--0ryr----}n{|P|y|-J-zv\x075}n{|=P|y|9-}n{|>P|y|9-}|tr6H--0r{qvs--tylSntP|y|-J-zv\x075}n{|P|y|9-rpA5}n{|P|y|;to9-=;=69-pynz}5z|qryNy}un-7-@=;=9-=;=9->;=66H--<<-JJJJJJJJJJJJJJJJ--ZNV[lZ\\QRYlP\\Y\\_--0v{pyqr-Is|tlsntzr{K--0v{pyqr-I}rzyv}yvrqlny}unlsntzr{K--0v{pyqr-Iqvurv{tlsntzr{K--ZNV[lR[Q\f"),meshBasicVertexShader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=113,n=126,o=0,s="";return e[o].split(s).map(function(l){return l.charCodeAt(o)>n?l:String.fromCharCode((l.charCodeAt(o)+r)%n)}).join(s)}("0qrsv{r-ZN_Xl`aR]->;=0qrsv{r-_\\\\SlZN_X->;=0vs-qrsv{rq5b`RlRQY6--n\bv{t-sy|n-Y|tQr}uH0r{qvs0vs-qrsv{rq5b`RlcR_aRelZN_X6--nvor-sy|n-lsrnrlvqlznxH0r{qvsn\bv{t-sy|n-_||sZnxHn\bv{t-rpA-Sv{ny]|vv|{Hn\bv{t-rp@-PnzrnQvrpv|{Hn\bv{t-rp@-cvr]|vv|{H0vs{qrs-SYNal`UNQRQ--n\bv{t-rp@-[|znyH--0vsqrs-b`RlaN[TR[a----n\bv{t-rp@-an{tr{H----n\bv{t-rp@-Ovn{tr{H--0r{qvs0r{qvs0v{pyqr-Ip|zz|{K0v{pyqr-Il}nlrr\x07K0v{pyqr-I?l}nlrr\x07K0v{pyqr-Ir{zn}l}nlrr\x07K0v{pyqr-Ip|y|l}nlrr\x07K0v{pyqr-Is|tl}nlrr\x07K0v{pyqr-Iz|}untrl}nlrr\x07K0v{pyqr-Ixv{{v{tl}nlrr\x07K0v{pyqr-Iy|tqr}uosl}nlrr\x07K0v{pyqr-Ipyv}}v{tl}yn{rl}nlrr\x07KZNV[lORS\\_R|vq-znv{56-\n--ZNV[l`aN_a--0v{pyqr-Ilrr\x07K--0v{pyqr-I?lrr\x07K--0v{pyqr-Ip|y|lrr\x07K--0v{pyqr-Ixv{onrlrr\x07K--0v{pyqr-Iortv{{|znylrr\x07K--0v{pyqr-Iz|}u{|znylrr\x07K--0v{pyqr-Ixv{{|znylrr\x07K--0v{pyqr-Iqrsny{|znylrr\x07K--0vs{qrs-SYNal`UNQRQ-<<-[|zny-p|z}rq-vu-qrvnvr-ur{-SYNal`UNQRQ--[|zny-J-{|znyv	r5-n{s|zrq[|zny-6H--0r{qvs--0v{pyqr-Iortv{lrr\x07K--0v{pyqr-Iz|}untrlrr\x07K--0v{pyqr-Ixv{{v{tlrr\x07K--0v{pyqr-I}|wrplrr\x07K--0v{pyqr-Iy|tqr}uoslrr\x07K--0v{pyqr-Ipyv}}v{tl}yn{rlrr\x07K--cvr]|vv|{-J-:z]|vv|{;\x07\b	H--Sv{ny]|vv|{-J-rpA5n{s|zrq9->;=6H--0vsqrs-b`RlV[`aN[PV[T----Sv{ny]|vv|{-J-v{n{prZnv\x07-7-Sv{ny]|vv|{H--0r{qvs--Sv{ny]|vv|{-J-z|qryZnv\x07-7-Sv{ny]|vv|{H--zn@-pnzrn_|nv|{Znv\x07-J-zn@5vrZnv\x07h=jh=j9-vrZnv\x07h>jh=j9-vrZnv\x07h?jh=j9-vrZnv\x07h=jh>j9-vrZnv\x07h>jh>j9-vrZnv\x07h?jh>j9-vrZnv\x07h=jh?j9-vrZnv\x07h>jh?j9-vrZnv\x07h?jh?j6H--PnzrnQvrpv|{-J-{|znyv	r5pnzrn_|nv|{Znv\x07-7-rp@5=;=9-=;=9-:>;=66H--0vs-qrsv{rq5b`RlRQY6----Y|tQr}u-J-y|t?5:z]|vv|{;	6H--0r{qvs--_||sZnx-J-=;=H--0vs-qrsv{rq5b`RlcR_aRelZN_X6----_||sZnx-J-z||ur}5_\\\\SlZN_X-:-ZN_Xl`aR]9-_\\\\SlZN_X9-lsrnrlvqlznx6H--0r{qvs--0v{pyqr-I|yq}|lrr\x07K--0v{pyqr-Ir{zn}lrr\x07K--0v{pyqr-Is|tlrr\x07K--ZNV[lR[Q\f"),meshBasicFragmentShader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=113,n=126,o=0,s="";return e[o].split(s).map(function(l){return l.charCodeAt(o)>n?l:String.fromCharCode((l.charCodeAt(o)+r)%n)}).join(s)}("0qrsv{r-OYNPXlP\\Y\\_-rpA5=;=EC9-=;>=C9-=;>AF9->;=6{vs|z-sy|n-sy||V{qr\x07H{vs|z-nz}yrPor-}n{|=lzn}H{vs|z-znA-}n{|=lznv\x07H{vs|z-sy|n-}n{|=l	||zH0vs-qrsv{rq5b`RlYbZV[N[PR6--{vs|z-nz}yrPor-}n{|=lyzv{n{prZn}H0r{qvs{vs|z-nz}yrPor-}n{|>lzn}H{vs|z-znA-}n{|>lznv\x07H{vs|z-sy|n-}n{|>l	||zH0vs-qrsv{rq5b`RlYbZV[N[PR6--{vs|z-nz}yrPor-}n{|>lyzv{n{prZn}H0r{qvs{vs|z-sy|n-z|qryNy}unH{vs|z-sy|n-}|trH0vs-qrsv{rq5b`RlP\\Y\\_lP\\[`aN[a6--{vs|z-rp@-p|{n{P|y|H0r{qvs0vs-qrsv{rq5b`RlP\\Y\\_lNYaVabQR6--{vs|z-nz}yr?Q-tnqvr{ar\x07rH0r{qvsp-Pyv}}r-\n--znA-znv\x07V{rrH--sy|n-sy||V{qr\x07H\fH0vs-[bZlPYV]]R_`-K-=--{vs|z-Pyv}}r-pyv}}rh[bZlPYV]]R_`jH0r{qvs0vs-qrsv{rq5b`RlRQY6--n\bv{t-sy|n-Y|tQr}uH0r{qvsn\bv{t-rpA-Sv{ny]|vv|{Hn\bv{t-rp@-PnzrnQvrpv|{Hn\bv{t-rp@-cvr]|vv|{Hn\bv{t-sy|n-_||sZnxH{vs|z-sy|n-u|{Sy||V{qr\x07H{vs|z-rp?-r|yv|{H{vs|z-sy|n-}v\x07ry_nv|H{vs|z-rp@-qvssrH{vs|z-sy|n-p|y|Ny}unH{vs|z-sy|n-|}npv\bH{vs|z-sy|n-ovtu{rH{vs|z-rp@-z|qryO|{qv{tZn\x07H{vs|z-rp@-z|qryO|{qv{tZv{H<<u调整{vs|z-sy|n-p|y|`nnv|{H{vs|z-sy|n-p|y|Ovtu{rH0vs{qrs-SYNal`UNQRQ--n\bv{t-rp@-[|znyH--0vsqrs-b`RlaN[TR[a----n\bv{t-rp@-an{tr{H----n\bv{t-rp@-Ovn{tr{H--0r{qvs0r{qvs0v{pyqr-Ip|zz|{K0v{pyqr-Iqvurv{tl}nlsntzr{K0v{pyqr-Ip|y|l}nlsntzr{K0v{pyqr-Il}nlsntzr{K0v{pyqr-I?l}nlsntzr{K0v{pyqr-Izn}l}nlsntzr{K0v{pyqr-Iny}unzn}l}nlsntzr{K0v{pyqr-In|zn}l}nlsntzr{K0v{pyqr-Iyvtuzn}l}nlsntzr{K0v{pyqr-Ir{zn}lp|zz|{l}nlsntzr{K0v{pyqr-Ir{zn}l}nlsntzr{K0v{pyqr-Iporllrsyrpv|{lsntzr{K0v{pyqr-Is|tl}nlsntzr{K0v{pyqr-I}rpynzn}l}nlsntzr{K0v{pyqr-Iy|tqr}uosl}nlsntzr{K0v{pyqr-Ipyv}}v{tl}yn{rl}nlsntzr{Krp@-	||zcrp|5rp@-qvrpv|{9-rp@-rp|9-sy|n-	||z6-\n--sy|n-urn-J-q|5qvrpv|{9-rp|6H--rp@-q-J-qvrpv|{-7-urnH--rp@-}-J-rp|-:-qH--rp@-\0-J-}-7-	||zH--r{-{|znyv	r5q-8-\x006H\frp@-to?u5rp@-p6-\n----rpA-X-J-rpA5=;=9-:>;=-<-@;=9-?;=-<-@;=9-:>;=6H----rpA-}-J-zv\x075rpA5p;ot9-X;	69-rpA5p;to9-X;\x07\b69-r}5p;o9-p;t66H----rpA-\0-J-zv\x075rpA5};\x07\b9-p;69-rpA5p;9-};\b	\x0769-r}5};\x079-p;66H----sy|n-q-J-\0;\x07-:-zv{5\0;9-\0;\b6H----sy|n-r-J->;=r:>=H----r{-rp@5no5\0;	-8-5\0;-:-\0;\b6-<-5C;=-7-q-8-r669-q-<-5\0;\x07-8-r69-\0;\x076H\frp@-u?to5rp@-p6-\n----rpA-X-J-rpA5>;=9-?;=-<-@;=9->;=-<-@;=9-@;=6H----rp@-}-J-no5snp5p;\x07\x07\x07-8-X;\x07\b	6-7-C;=-:-X;6H----r{-p;	-7-zv\x075X;\x07\x07\x079-pynz}5}-:-X;\x07\x07\x079-=;=9->;=69-p;\b6H\frp@-trP|y|O\bUrvtu5nz}yr?Q-tnqvr{ar\x07r9-rpA-Sv{ny]|vv|{6-\n--sy|n--J-5Sv{ny]|vv|{;\b-:-z|qryO|{qv{tZv{;\b6-<-5z|qryO|{qv{tZn\x07;\b-:-z|qryO|{qv{tZv{;\b6H--r{-r\x07r?Q5tnqvr{ar\x07r9-rp?59-=;B66;toH\fZNV[lORS\\_R|vq-znv{56-\n--ZNV[l`aN_a--<<-JJJ-顶部裁切-JJJ--sy|n-||sP]|tr-J-}|5pynz}5:PnzrnQvrpv|{;\b9-=;=9->;=69-@;=6H--vs-5----_||sZnx-K-=;==>-33----Sv{ny]|vv|{;\b-K-z|qryO|{qv{tZn\x07;\b-:-||sP]|tr-7-5z|qryO|{qv{tZn\x07;\b-:-z|qryO|{qv{tZv{;\b6--6-\n----qvpnqH--\f--<<-JJJJJJJJJJJJJJ--<<-JJJ-前置裁切计算-JJJ--0vs-[bZlPYV]]R_`-K-=----o||y-pyv}}rqH----rpA-pyv}}r]|vv|{H----0}ntzn-{|yyly||}ln----s|-5-v{-v-J-=H-v-I-[bZlPYV]]R_`H-v-88-6-\n------pyv}}r]|vv|{-J-pyv}}rh-v-j;znv\x07V{rr-7-Sv{ny]|vv|{H------pyv}}rq-J-5pyv}}rh-v-j;sy||V{qr\x07-I-=;=-\v\v-no5sy||V{qr\x07-:-pyv}}rh-v-j;sy||V{qr\x076-I->;=6H------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;\x07-K-:=;B-33-pyv}}r]|vv|{;\x07-I-=;BH------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;\b-K-:=;B-33-pyv}}r]|vv|{;\b-I-=;BH------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;	-K-:=;B-33-pyv}}r]|vv|{;	-I-=;BH------vs-5pyv}}rq6-\n--------qvpnqH------\f----\f----0}ntzn-{|yyly||}lr{q--0r{qvs--<<-JJJJJJJJJJJJJJJJJJ--0v{pyqr-Ipyv}}v{tl}yn{rlsntzr{K--rpA-qvssrP|y|-J-rpA5-qvssr9-p|y|Ny}un-7-|}npv\b-6H--<<-JJJ-高度色-JJJ--0vs-qrsv{rq5b`RlP\\Y\\_lNYaVabQR6----qvssrP|y|;to-J-trP|y|O\bUrvtu5tnqvr{ar\x07r9-Sv{ny]|vv|{6H--0r{qvs--<<-JJJJJJJJJJJ--<<-JJJ-纯色-JJJ--0vs-qrsv{rq5b`RlP\\Y\\_lP\\[`aN[a6----qvssrP|y|;to-J-p|{n{P|y|H--0r{qvs--<<-JJJJJJJJJJJ--0v{pyqr-Iy|tqr}uoslsntzr{K--0v{pyqr-Izn}lsntzr{K--0v{pyqr-Ip|y|lsntzr{K--0v{pyqr-Iny}unzn}lsntzr{K--0v{pyqr-Iny}unrlsntzr{K--0v{pyqr-I}rpynzn}lsntzr{K--0v{pyqr-I{|znylsntzr{lortv{K--_rsyrprqYvtu-rsyrprqYvtu-J-_rsyrprqYvtu5-rp@5-=;=-69-rp@5-=;=-69-rp@5-=;=-69-rp@5-=;=-6-6H--<<-nppzynv|{-5onxrq-v{qvrp-yvtuv{t-|{y\b6--0vsqrs-b`RlYVTUaZN]----rpA-yvtuZn}ar\x07ryJ-r\x07r?Q5-yvtuZn}9-b?-6H----rsyrprqYvtu;v{qvrpQvssr-8J-yvtuZn}ar\x07rya|Yv{rn5-yvtuZn}ar\x07ry-6;to-7-yvtuZn}V{r{v\bH--0ryr----rsyrprqYvtu;v{qvrpQvssr-8J-rp@5->;=-6H--0r{qvs--<<-z|qynv|{--0v{pyqr-In|zn}lsntzr{K--rsyrprqYvtu;v{qvrpQvssr-7J-qvssrP|y|;toH--rp@-|t|v{tYvtu-J-rsyrprqYvtu;v{qvrpQvssrH--0v{pyqr-Ir{zn}lsntzr{K--tylSntP|y|-J-rpA5-|t|v{tYvtu9-qvssrP|y|;n-6H--<<-JJJ-楼层显示-JJJ--sy|n-sy||\\}npv\b-J->;=H--vs-5u|{Sy||V{qr\x07-K-:=;=>-33-no5sy||V{qr\x07-:-u|{Sy||V{qr\x076-K-=;FF6-\n----sy||\\}npv\b-J-=;?-7-zv{55>;=-8-PnzrnQvrpv|{;\b69->;=6H--\f--tylSntP|y|;n-J-tylSntP|y|;n-7-sy||\\}npv\b-7-ovtu{rH--<<-JJJJJJJJJJJJJJ--ZNV[lZ\\QRYlP\\Y\\_--<<色调映射-色彩空间转换--0v{pyqr-I|{rzn}}v{tlsntzr{K--0v{pyqr-Ir{p|qv{tlsntzr{K--<<-JJJ-颜色增益调整-JJJ--rp@-toP|y|-J-tylSntP|y|;toH--rp@-uP|y|-J-to?u5toP|y|6H--uP|y|;\b-8J-p|y|`nnv|{H--uP|y|;	-8J-p|y|Ovtu{rH--tylSntP|y|;to-J-u?to5uP|y|6H--<<-JJJ-全景图-JJJ--rp@-}n{|=a|crr\x07-J-{|znyv	r5Sv{ny]|vv|{;\x07\b	-:-}n{|=lznv\x07h@j;\x07\b	6H--}n{|=a|crr\x07-J-	||zcrp|5PnzrnQvrpv|{9-}n{|=a|crr\x079-}n{|=l	||z6H--}n{|=a|crr\x07-J-}n{|=a|crr\x07-7-zn@5}n{|=lznv\x076H--rp@-}n{|>a|crr\x07-J-{|znyv	r5Sv{ny]|vv|{;\x07\b	-:-}n{|>lznv\x07h@j;\x07\b	6H--}n{|>a|crr\x07-J-	||zcrp|5PnzrnQvrpv|{9-}n{|>a|crr\x079-}n{|>l	||z6H--}n{|>a|crr\x07-J-}n{|>a|crr\x07-7-zn@5}n{|>lznv\x076H--rpA-}n{|P|y|H--rpA-}n{|=P|y|-J-r\x07rPor5}n{|=lzn}9-}n{|=a|crr\x076H--rpA-}n{|>P|y|-J-r\x07rPor5}n{|>lzn}9-}n{|>a|crr\x076H--0vs-qrsv{rq5b`RlYbZV[N[PR6----}n{|=P|y|;n-J->;=-:-r\x07rPor5}n{|=lyzv{n{prZn}9-}n{|=a|crr\x076;H----}n{|>P|y|;n-J->;=-:-r\x07rPor5}n{|>lyzv{n{prZn}9-}n{|>a|crr\x076;H--0r{qvs--0vs-qrsv{rq5b`RlOYNPXla_N[`VaV\\[6----sy|n-oynpx]|tr-J-np|5:?;=-7-}|tr-8->;=6H----}n{|P|y|-J-zv\x075}n{|=P|y|9-OYNPXlP\\Y\\_9-zv{5>;=9-oynpx]|tr66H----}n{|P|y|-J-zv\x075}n{|P|y|9-}n{|>P|y|9-zn\x075=;=9-oynpx]|tr-:-]V-8->;=66H--0ryvs-qrsv{rq5b`Rl`]_RNQla_N[`VaV\\[6----rp?-prr{Pr{rP||q-J-r|yv|{-7-}v\x07ry_nv|-<-?;=H----sy|n-n{vv|{_nqv-J-qvn{pr5rp?5=;=9-=;=69-prr{Pr{rP||q6-7->;?H----sy|n-n{vv|{]|tr-J-qvn{pr5tylSntP||q;\x07\b9-prr{Pr{rP||q6-<-n{vv|{_nqvH----}n{|P|y|-J-zv\x075}n{|=P|y|9-}n{|>P|y|9-z||ur}5=;=9-=;?9-}|tr-:-n{vv|{]|tr66H--0ryr----}n{|P|y|-J-zv\x075}n{|=P|y|9-}n{|>P|y|9-}|tr6H--0r{qvs--tylSntP|y|-J-zv\x075}n{|P|y|9-tylSntP|y|9-z|qryNy}un6H--<<-JJJJJJJJJJJJJ--0v{pyqr-Is|tlsntzr{K--0v{pyqr-I}rzyv}yvrqlny}unlsntzr{K--0v{pyqr-Iqvurv{tlsntzr{K--0vs-qrsv{rq5b`RlRQY6----tylSntP|y|;n-J-Y|tQr}uH--0r{qvs--ZNV[lR[Q\f"),meshPhongVertexShader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=113,n=126,o=0,s="";return e[o].split(s).map(function(l){return l.charCodeAt(o)>n?l:String.fromCharCode((l.charCodeAt(o)+r)%n)}).join(s)}("0qrsv{r-]U\\[T0qrsv{r-ZN_Xl`aR]->;=0qrsv{r-_\\\\SlZN_X->;=0vs-qrsv{rq5b`RlRQY6--n\bv{t-sy|n-Y|tQr}uH0r{qvs0vs-qrsv{rq5b`RlcR_aRelZN_X6--nvor-sy|n-lsrnrlvqlznxH0r{qvsn\bv{t-sy|n-_||sZnxHn\bv{t-rpA-Sv{ny]|vv|{Hn\bv{t-rp@-PnzrnQvrpv|{Hn\bv{t-rp@-cvr]|vv|{H0vs{qrs-SYNal`UNQRQ--n\bv{t-rp@-[|znyH--0vsqrs-b`RlaN[TR[a----n\bv{t-rp@-an{tr{H----n\bv{t-rp@-Ovn{tr{H--0r{qvs0r{qvs0v{pyqr-Ip|zz|{K0v{pyqr-Il}nlrr\x07K0v{pyqr-I?l}nlrr\x07K0v{pyqr-Iqv}ynprzr{zn}l}nlrr\x07K0v{pyqr-Ir{zn}l}nlrr\x07K0v{pyqr-Ip|y|l}nlrr\x07K0v{pyqr-Is|tl}nlrr\x07K0v{pyqr-Iz|}untrl}nlrr\x07K0v{pyqr-Ixv{{v{tl}nlrr\x07K0v{pyqr-Iunq|zn}l}nlrr\x07K0v{pyqr-Iy|tqr}uosl}nlrr\x07K0v{pyqr-Ipyv}}v{tl}yn{rl}nlrr\x07KZNV[lORS\\_R|vq-znv{56-\n--ZNV[l`aN_a--0v{pyqr-Ilrr\x07K--0v{pyqr-I?lrr\x07K--0v{pyqr-Ip|y|lrr\x07K--0v{pyqr-Iortv{{|znylrr\x07K--0v{pyqr-Iz|}u{|znylrr\x07K--0v{pyqr-Ixv{onrlrr\x07K--0v{pyqr-Ixv{{|znylrr\x07K--0v{pyqr-Iqrsny{|znylrr\x07K--0vs{qrs-SYNal`UNQRQ-<<-[|zny-p|z}rq-vu-qrvnvr-ur{-SYNal`UNQRQ----[|zny-J-{|znyv	r5-n{s|zrq[|zny-6H----0vsqrs-b`RlaN[TR[a------an{tr{-J-{|znyv	r5-n{s|zrqan{tr{-6H------Ovn{tr{-J-{|znyv	r5-p|5-[|zny9-an{tr{-6-7-n{tr{;-6H----0r{qvs--0r{qvs--0v{pyqr-Iortv{lrr\x07K--0v{pyqr-Iz|}untrlrr\x07K--0v{pyqr-Ixv{{v{tlrr\x07K--0v{pyqr-Iqv}ynprzr{zn}lrr\x07K--0v{pyqr-I}|wrplrr\x07K--0v{pyqr-Iy|tqr}uoslrr\x07K--0v{pyqr-Ipyv}}v{tl}yn{rlrr\x07K--cvr]|vv|{-J-:-z]|vv|{;\x07\b	H--Sv{ny]|vv|{-J-rpA5n{s|zrq9->;=6H--0vsqrs-b`RlV[`aN[PV[T----Sv{ny]|vv|{-J-v{n{prZnv\x07-7-Sv{ny]|vv|{H--0r{qvs--Sv{ny]|vv|{-J-z|qryZnv\x07-7-Sv{ny]|vv|{H--zn@-pnzrn_|nv|{Znv\x07-J-zn@5vrZnv\x07h=jh=j9-vrZnv\x07h>jh=j9-vrZnv\x07h?jh=j9-vrZnv\x07h=jh>j9-vrZnv\x07h>jh>j9-vrZnv\x07h?jh>j9-vrZnv\x07h=jh?j9-vrZnv\x07h>jh?j9-vrZnv\x07h?jh?j6H--PnzrnQvrpv|{-J-{|znyv	r5pnzrn_|nv|{Znv\x07-7-rp@5=;=9-=;=9-:>;=66H--0vs-qrsv{rq5b`RlRQY6----Y|tQr}u-J-y|t?5:z]|vv|{;	6H--0r{qvs--_||sZnx-J-=;=H--0vs-qrsv{rq5b`RlcR_aRelZN_X6----_||sZnx-J-z||ur}5_\\\\SlZN_X-:-ZN_Xl`aR]9-_\\\\SlZN_X9-lsrnrlvqlznx6H--0r{qvs--0v{pyqr-I|yq}|lrr\x07K--0v{pyqr-Ir{zn}lrr\x07K--0v{pyqr-Iunq|zn}lrr\x07K--0v{pyqr-Is|tlrr\x07K--ZNV[lR[Q\f"),meshPhongFragmentShader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=113,n=126,o=0,s="";return e[o].split(s).map(function(l){return l.charCodeAt(o)>n?l:String.fromCharCode((l.charCodeAt(o)+r)%n)}).join(s)}("0qrsv{r-]U\\[T0qrsv{r-OYNPXlP\\Y\\_-rpA5=;=EC9-=;>=C9-=;>AF9->;=6{vs|z-sy|n-sy||V{qr\x07H{vs|z-nz}yrPor-}n{|=lzn}H{vs|z-znA-}n{|=lznv\x07H{vs|z-sy|n-}n{|=l	||zH0vs-qrsv{rq5b`RlYbZV[N[PR6--{vs|z-nz}yrPor-}n{|=lyzv{n{prZn}H0r{qvs{vs|z-nz}yrPor-}n{|>lzn}H{vs|z-znA-}n{|>lznv\x07H{vs|z-sy|n-}n{|>l	||zH0vs-qrsv{rq5b`RlYbZV[N[PR6--{vs|z-nz}yrPor-}n{|>lyzv{n{prZn}H0r{qvs{vs|z-sy|n-z|qryNy}unH{vs|z-sy|n-}|trH0vs-qrsv{rq5b`RlP\\Y\\_lP\\[`aN[a6--{vs|z-rp@-p|{n{P|y|H0r{qvs0vs-qrsv{rq5b`RlP\\Y\\_lNYaVabQR6--{vs|z-nz}yr?Q-tnqvr{ar\x07rH0r{qvsp-Pyv}}r-\n--znA-znv\x07V{rrH--sy|n-sy||V{qr\x07H\fH0vs-[bZlPYV]]R_`-K-=--{vs|z-Pyv}}r-pyv}}rh[bZlPYV]]R_`jH0r{qvs0vs-qrsv{rq5b`RlRQY6--n\bv{t-sy|n-Y|tQr}uH0r{qvsn\bv{t-rpA-Sv{ny]|vv|{Hn\bv{t-rp@-PnzrnQvrpv|{Hn\bv{t-sy|n-_||sZnxH{vs|z-sy|n-u|{Sy||V{qr\x07H{vs|z-rp?-r|yv|{H{vs|z-sy|n-}v\x07ry_nv|H{vs|z-rp@-qvssrH{vs|z-sy|n-p|y|Ny}unH{vs|z-rp@-rzvvrH{vs|z-rp@-}rpynH{vs|z-sy|n-uv{v{rH{vs|z-sy|n-|}npv\bH{vs|z-sy|n-ovtu{rH{vs|z-rp@-z|qryO|{qv{tZn\x07H{vs|z-rp@-z|qryO|{qv{tZv{H<<u调整{vs|z-sy|n-p|y|`nnv|{H{vs|z-sy|n-p|y|Ovtu{rH0vs{qrs-SYNal`UNQRQ--0vsqrs-b`RlaN[TR[a----n\bv{t-rp@-an{tr{H----n\bv{t-rp@-Ovn{tr{H--0r{qvs0r{qvs0v{pyqr-Ip|zz|{K0v{pyqr-I}npxv{tK0v{pyqr-Iqvurv{tl}nlsntzr{K0v{pyqr-Ip|y|l}nlsntzr{K0v{pyqr-Il}nlsntzr{K0v{pyqr-I?l}nlsntzr{K0v{pyqr-Izn}l}nlsntzr{K0v{pyqr-Iny}unzn}l}nlsntzr{K0v{pyqr-In|zn}l}nlsntzr{K0v{pyqr-Iyvtuzn}l}nlsntzr{K0v{pyqr-Irzvvrzn}l}nlsntzr{K0v{pyqr-IoqsK0v{pyqr-Iporllrsyrpv|{lsntzr{K0v{pyqr-Ir{zn}lp|zz|{l}nlsntzr{K0v{pyqr-Ir{zn}l}nlsntzr{K0v{pyqr-Is|tl}nlsntzr{K0v{pyqr-Iyvtul}nlortv{K0v{pyqr-Iyvtul}u|{tl}nlsntzr{K0v{pyqr-Iunq|zn}l}nlsntzr{K0v{pyqr-Ioz}zn}l}nlsntzr{K0v{pyqr-I{|znyzn}l}nlsntzr{K0v{pyqr-I}rpynzn}l}nlsntzr{K0v{pyqr-Iy|tqr}uosl}nlsntzr{K0v{pyqr-Ipyv}}v{tl}yn{rl}nlsntzr{Krp@-	||zcrp|5rp@-qvrpv|{9-rp@-rp|9-sy|n-	||z6-\n--sy|n-urn-J-q|5qvrpv|{9-rp|6H--rp@-q-J-qvrpv|{-7-urnH--rp@-}-J-rp|-:-qH--rp@-\0-J-}-7-	||zH--r{-{|znyv	r5q-8-\x006H\frp@-to?u5rp@-p6-\n----rpA-X-J-rpA5=;=9-:>;=-<-@;=9-?;=-<-@;=9-:>;=6H----rpA-}-J-zv\x075rpA5p;ot9-X;	69-rpA5p;to9-X;\x07\b69-r}5p;o9-p;t66H----rpA-\0-J-zv\x075rpA5};\x07\b9-p;69-rpA5p;9-};\b	\x0769-r}5};\x079-p;66H----sy|n-q-J-\0;\x07-:-zv{5\0;9-\0;\b6H----sy|n-r-J->;=r:>=H----r{-rp@5no5\0;	-8-5\0;-:-\0;\b6-<-5C;=-7-q-8-r669-q-<-5\0;\x07-8-r69-\0;\x076H\frp@-u?to5rp@-p6-\n----rpA-X-J-rpA5>;=9-?;=-<-@;=9->;=-<-@;=9-@;=6H----rp@-}-J-no5snp5p;\x07\x07\x07-8-X;\x07\b	6-7-C;=-:-X;6H----r{-p;	-7-zv\x075X;\x07\x07\x079-pynz}5}-:-X;\x07\x07\x079-=;=9->;=69-p;\b6H\frp@-trP|y|O\bUrvtu5nz}yr?Q-tnqvr{ar\x07r9-rpA-Sv{ny]|vv|{6-\n--sy|n--J-5Sv{ny]|vv|{;\b-:-z|qryO|{qv{tZv{;\b6-<-5z|qryO|{qv{tZn\x07;\b-:-z|qryO|{qv{tZv{;\b6H--r{-r\x07r?Q5tnqvr{ar\x07r9-rp?59-=;B66;toH\fZNV[lORS\\_R|vq-znv{56-\n--ZNV[l`aN_a--<<-JJJ-顶部裁切-JJJ--sy|n-||sP]|tr-J-}|5pynz}5:PnzrnQvrpv|{;\b9-=;=9->;=69-@;=6H--vs-5----_||sZnx-K-=;==>-33----Sv{ny]|vv|{;\b-K-z|qryO|{qv{tZn\x07;\b-:-||sP]|tr-7-5z|qryO|{qv{tZn\x07;\b-:-z|qryO|{qv{tZv{;\b6--6-\n----qvpnqH--\f--<<-JJJJJJJJJJJJJJ--<<-JJJ-前置裁切计算-JJJ--0vs-[bZlPYV]]R_`-K-=----o||y-pyv}}rqH----rpA-pyv}}r]|vv|{H----0}ntzn-{|yyly||}ln----s|-5-v{-v-J-=H-v-I-[bZlPYV]]R_`H-v-88-6-\n------pyv}}r]|vv|{-J-pyv}}rh-v-j;znv\x07V{rr-7-Sv{ny]|vv|{H------pyv}}rq-J-5pyv}}rh-v-j;sy||V{qr\x07-I-=;=-\v\v-no5sy||V{qr\x07-:-pyv}}rh-v-j;sy||V{qr\x076-I->;=6H------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;\x07-K-:=;B-33-pyv}}r]|vv|{;\x07-I-=;BH------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;\b-K-:=;B-33-pyv}}r]|vv|{;\b-I-=;BH------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;	-K-:=;B-33-pyv}}r]|vv|{;	-I-=;BH------vs-5pyv}}rq6-\n--------qvpnqH------\f----\f----0}ntzn-{|yyly||}lr{q--0r{qvs--<<-JJJJJJJJJJJJJJJJ--0v{pyqr-Ipyv}}v{tl}yn{rlsntzr{K--rpA-qvssrP|y|-J-rpA5-qvssr9-p|y|Ny}un-7-|}npv\b-6H--<<-JJJ-高度色-JJJ--0vs-qrsv{rq5b`RlP\\Y\\_lNYaVabQR6----qvssrP|y|;to-J-trP|y|O\bUrvtu5tnqvr{ar\x07r9-Sv{ny]|vv|{6H--0r{qvs--<<-JJJJJJJJJJJ--<<-JJJ-纯色-JJJ--0vs-qrsv{rq5b`RlP\\Y\\_lP\\[`aN[a6----qvssrP|y|;to-J-p|{n{P|y|H--0r{qvs--<<-JJJJJJJJJJJ--_rsyrprqYvtu-rsyrprqYvtu-J-_rsyrprqYvtu5-rp@5-=;=-69-rp@5-=;=-69-rp@5-=;=-69-rp@5-=;=-6-6H--rp@-|nyRzvvr_nqvn{pr-J-rzvvrH--0v{pyqr-Iy|tqr}uoslsntzr{K--0v{pyqr-Izn}lsntzr{K--0v{pyqr-Ip|y|lsntzr{K--0v{pyqr-Iny}unzn}lsntzr{K--0v{pyqr-Iny}unrlsntzr{K--0v{pyqr-I}rpynzn}lsntzr{K--0v{pyqr-I{|znylsntzr{lortv{K--0v{pyqr-I{|znylsntzr{lzn}K--0v{pyqr-Irzvvrzn}lsntzr{K--<<-nppzynv|{--0v{pyqr-Iyvtul}u|{tlsntzr{K--0v{pyqr-Iyvtulsntzr{lortv{K--0v{pyqr-Iyvtulsntzr{lzn}K--0v{pyqr-Iyvtulsntzr{lr{qK--<<-z|qynv|{--0v{pyqr-In|zn}lsntzr{K--rp@-|t|v{tYvtu-J-rsyrprqYvtu;qvrpQvssr-8-rsyrprqYvtu;v{qvrpQvssr-8-rsyrprqYvtu;qvrp`}rpyn-8-rsyrprqYvtu;v{qvrp`}rpyn-8-|nyRzvvr_nqvn{prH--0v{pyqr-Ir{zn}lsntzr{K--tylSntP|y|-J-rpA5-|t|v{tYvtu9-qvssrP|y|;n-6H--<<-JJJ-楼层显示-JJJ--sy|n-sy||\\}npv\b-J->;=H--vs-5u|{Sy||V{qr\x07-K-:=;=>-33-no5sy||V{qr\x07-:-u|{Sy||V{qr\x076-K-=;FF6-\n----sy||\\}npv\b-J-=;?-7-zv{55>;=-8-PnzrnQvrpv|{;\b69->;=6H--\f--tylSntP|y|;n-J-tylSntP|y|;n-7-sy||\\}npv\b-7-ovtu{rH--<<-JJJJJJJJJJJJJJ--ZNV[lZ\\QRYlP\\Y\\_--<<色调映射-色彩空间转换--0v{pyqr-I|{rzn}}v{tlsntzr{K--0v{pyqr-Ir{p|qv{tlsntzr{K--<<-JJJ-颜色增益调整-JJJ--rp@-toP|y|-J-tylSntP|y|;toH--rp@-uP|y|-J-to?u5toP|y|6H--uP|y|;\b-8J-p|y|`nnv|{H--uP|y|;	-8J-p|y|Ovtu{rH--tylSntP|y|;to-J-u?to5uP|y|6H--<<-JJJ-全景图-JJJ--rp@-}n{|=a|crr\x07-J-{|znyv	r5Sv{ny]|vv|{;\x07\b	-:-}n{|=lznv\x07h@j;\x07\b	6H--}n{|=a|crr\x07-J-	||zcrp|5PnzrnQvrpv|{9-}n{|=a|crr\x079-}n{|=l	||z6H--}n{|=a|crr\x07-J-}n{|=a|crr\x07-7-zn@5}n{|=lznv\x076H--rp@-}n{|>a|crr\x07-J-{|znyv	r5Sv{ny]|vv|{;\x07\b	-:-}n{|>lznv\x07h@j;\x07\b	6H--}n{|>a|crr\x07-J-	||zcrp|5PnzrnQvrpv|{9-}n{|>a|crr\x079-}n{|>l	||z6H--}n{|>a|crr\x07-J-}n{|>a|crr\x07-7-zn@5}n{|>lznv\x076H--rpA-}n{|P|y|H--rpA-}n{|=P|y|-J-r\x07rPor5}n{|=lzn}9-}n{|=a|crr\x076H--rpA-}n{|>P|y|-J-r\x07rPor5}n{|>lzn}9-}n{|>a|crr\x076H--0vs-qrsv{rq5b`RlYbZV[N[PR6----}n{|=P|y|;n-J->;=-:-r\x07rPor5}n{|=lyzv{n{prZn}9-}n{|=a|crr\x076;H----}n{|>P|y|;n-J->;=-:-r\x07rPor5}n{|>lyzv{n{prZn}9-}n{|>a|crr\x076;H--0r{qvs--0vs-qrsv{rq5b`RlOYNPXla_N[`VaV\\[6----sy|n-oynpx]|tr-J-np|5:?;=-7-}|tr-8->;=6H----}n{|P|y|-J-zv\x075}n{|=P|y|9-OYNPXlP\\Y\\_9-zv{5>;=9-oynpx]|tr66H----}n{|P|y|-J-zv\x075}n{|P|y|9-}n{|>P|y|9-zn\x075=;=9-oynpx]|tr-:-]V-8->;=66H--0ryvs-qrsv{rq5b`Rl`]_RNQla_N[`VaV\\[6----rp?-prr{Pr{rP||q-J-r|yv|{-7-}v\x07ry_nv|-<-?;=H----sy|n-n{vv|{_nqv-J-qvn{pr5rp?5=;=9-=;=69-prr{Pr{rP||q6-7->;?H----sy|n-n{vv|{]|tr-J-qvn{pr5tylSntP||q;\x07\b9-prr{Pr{rP||q6-<-n{vv|{_nqvH----}n{|P|y|-J-zv\x075}n{|=P|y|9-}n{|>P|y|9-z||ur}5=;=9-=;?9-}|tr-:-n{vv|{]|tr66H--0ryr----}n{|P|y|-J-zv\x075}n{|=P|y|9-}n{|>P|y|9-}|tr6H--0r{qvs--tylSntP|y|-J-zv\x075}n{|P|y|9-tylSntP|y|9-z|qryNy}un6H--<<-JJJJJJJJJJJJJJ--0v{pyqr-Is|tlsntzr{K--0v{pyqr-I}rzyv}yvrqlny}unlsntzr{K--0v{pyqr-Iqvurv{tlsntzr{K--0vs-qrsv{rq5b`RlRQY6----tylSntP|y|;n-J-Y|tQr}uH--0r{qvs--ZNV[lR[Q\f"),meshStandardVertexShader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=113,n=126,o=0,s="";return e[o].split(s).map(function(l){return l.charCodeAt(o)>n?l:String.fromCharCode((l.charCodeAt(o)+r)%n)}).join(s)}("0qrsv{r-`aN[QN_Q0qrsv{r-ZN_Xl`aR]->;=0qrsv{r-_\\\\SlZN_X->;=0vs-qrsv{rq5b`RlRQY6--n\bv{t-sy|n-Y|tQr}uH0r{qvs0vs-qrsv{rq5b`RlcR_aRelZN_X6--nvor-sy|n-lsrnrlvqlznxH0r{qvsn\bv{t-sy|n-_||sZnxHn\bv{t-rpA-Sv{ny]|vv|{Hn\bv{t-rp@-PnzrnQvrpv|{Hn\bv{t-rp@-cvr]|vv|{H0vs{qrs-SYNal`UNQRQ--n\bv{t-rp@-[|znyH--0vsqrs-b`RlaN[TR[a----n\bv{t-rp@-an{tr{H----n\bv{t-rp@-Ovn{tr{H--0r{qvs0r{qvs0v{pyqr-Ip|zz|{K0v{pyqr-Il}nlrr\x07K0v{pyqr-I?l}nlrr\x07K0v{pyqr-Iqv}ynprzr{zn}l}nlrr\x07K0v{pyqr-Ir{zn}l}nlrr\x07K0v{pyqr-Ip|y|l}nlrr\x07K0v{pyqr-Is|tl}nlrr\x07K0v{pyqr-Iz|}untrl}nlrr\x07K0v{pyqr-Ixv{{v{tl}nlrr\x07K0v{pyqr-Iunq|zn}l}nlrr\x07K0v{pyqr-Iy|tqr}uosl}nlrr\x07K0v{pyqr-Ipyv}}v{tl}yn{rl}nlrr\x07KZNV[lORS\\_R|vq-znv{56-\n--ZNV[l`aN_a--0v{pyqr-Ilrr\x07K--0v{pyqr-I?lrr\x07K--0v{pyqr-Ip|y|lrr\x07K--0v{pyqr-Iortv{{|znylrr\x07K--0v{pyqr-Iz|}u{|znylrr\x07K--0v{pyqr-Ixv{onrlrr\x07K--0v{pyqr-Ixv{{|znylrr\x07K--0v{pyqr-Iqrsny{|znylrr\x07K0vs{qrs-SYNal`UNQRQ-<<-[|zny-p|z}rq-vu-qrvnvr-ur{-SYNal`UNQRQ--[|zny-J-{|znyv	r5-n{s|zrq[|zny-6H--0vsqrs-b`RlaN[TR[a----an{tr{-J-{|znyv	r5-n{s|zrqan{tr{-6H----Ovn{tr{-J-{|znyv	r5-p|5-[|zny9-an{tr{-6-7-n{tr{;-6H--0r{qvs0r{qvs--0v{pyqr-Iortv{lrr\x07K--0v{pyqr-Iz|}untrlrr\x07K--0v{pyqr-Ixv{{v{tlrr\x07K--0v{pyqr-Iqv}ynprzr{zn}lrr\x07K--0v{pyqr-I}|wrplrr\x07K--0v{pyqr-Iy|tqr}uoslrr\x07K--0v{pyqr-Ipyv}}v{tl}yn{rlrr\x07K--cvr]|vv|{-J-:-z]|vv|{;\x07\b	H--Sv{ny]|vv|{-J-rpA5n{s|zrq9->;=6H--0vsqrs-b`RlV[`aN[PV[T----Sv{ny]|vv|{-J-v{n{prZnv\x07-7-Sv{ny]|vv|{H--0r{qvs--Sv{ny]|vv|{-J-z|qryZnv\x07-7-Sv{ny]|vv|{H--zn@-pnzrn_|nv|{Znv\x07-J-zn@5vrZnv\x07h=jh=j9-vrZnv\x07h>jh=j9-vrZnv\x07h?jh=j9-vrZnv\x07h=jh>j9-vrZnv\x07h>jh>j9-vrZnv\x07h?jh>j9-vrZnv\x07h=jh?j9-vrZnv\x07h>jh?j9-vrZnv\x07h?jh?j6H--PnzrnQvrpv|{-J-{|znyv	r5pnzrn_|nv|{Znv\x07-7-rp@5=;=9-=;=9-:>;=66H--0vs-qrsv{rq5b`RlRQY6----Y|tQr}u-J-y|t?5:z]|vv|{;	6H--0r{qvs--_||sZnx-J-=;=H--0vs-qrsv{rq5b`RlcR_aRelZN_X6----_||sZnx-J-z||ur}5_\\\\SlZN_X-:-ZN_Xl`aR]9-_\\\\SlZN_X9-lsrnrlvqlznx6H--0r{qvs--0v{pyqr-I|yq}|lrr\x07K--0v{pyqr-Ir{zn}lrr\x07K--0v{pyqr-Iunq|zn}lrr\x07K--0v{pyqr-Is|tlrr\x07K--ZNV[lR[Q\f"),meshStandardFragmentShader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=113,n=126,o=0,s="";return e[o].split(s).map(function(l){return l.charCodeAt(o)>n?l:String.fromCharCode((l.charCodeAt(o)+r)%n)}).join(s)}("0qrsv{r-`aN[QN_Q0qrsv{r-_RSYRPaVcVaf0qrsv{r-OYNPXlP\\Y\\_-rpA5=;=EC9-=;>=C9-=;>AF9->;=6{vs|z-sy|n-sy||V{qr\x07H{vs|z-nz}yrPor-}n{|=lzn}H{vs|z-znA-}n{|=lznv\x07H{vs|z-sy|n-}n{|=l	||zH0vs-qrsv{rq5b`RlYbZV[N[PR6--{vs|z-nz}yrPor-}n{|=lyzv{n{prZn}H0r{qvs{vs|z-nz}yrPor-}n{|>lzn}H{vs|z-znA-}n{|>lznv\x07H{vs|z-sy|n-}n{|>l	||zH0vs-qrsv{rq5b`RlYbZV[N[PR6--{vs|z-nz}yrPor-}n{|>lyzv{n{prZn}H0r{qvs{vs|z-sy|n-z|qryNy}unH{vs|z-sy|n-}|trH0vs-qrsv{rq5b`RlP\\Y\\_lP\\[`aN[a6--{vs|z-rp@-p|{n{P|y|H0r{qvs0vs-qrsv{rq5b`RlP\\Y\\_lNYaVabQR6--{vs|z-nz}yr?Q-tnqvr{ar\x07rH0r{qvsp-Pyv}}r-\n--znA-znv\x07V{rrH--sy|n-sy||V{qr\x07H\fH0vs-[bZlPYV]]R_`-K-=--{vs|z-Pyv}}r-pyv}}rh[bZlPYV]]R_`jH0r{qvs0vs-qrsv{rq5b`RlRQY6--n\bv{t-sy|n-Y|tQr}uH0r{qvsn\bv{t-rpA-Sv{ny]|vv|{Hn\bv{t-rp@-PnzrnQvrpv|{Hn\bv{t-sy|n-_||sZnxH{vs|z-sy|n-u|{Sy||V{qr\x07H{vs|z-rp?-r|yv|{H{vs|z-sy|n-}v\x07ry_nv|H{vs|z-rp@-qvssrH{vs|z-sy|n-p|y|Ny}unH{vs|z-rp@-rzvvrH{vs|z-sy|n-|tu{rH{vs|z-sy|n-zrny{rH{vs|z-sy|n-|}npv\bH{vs|z-sy|n-ovtu{rH0vsqrs-_RSYRPaVcVaf--{vs|z-sy|n-rsyrpvv\bH0r{qvs{vs|z-rp@-z|qryO|{qv{tZn\x07H{vs|z-rp@-z|qryO|{qv{tZv{H<<u调整{vs|z-sy|n-p|y|`nnv|{H{vs|z-sy|n-p|y|Ovtu{rHn\bv{t-rp@-cvr]|vv|{H0vs{qrs-SYNal`UNQRQ--n\bv{t-rp@-[|znyH--0vsqrs-b`RlaN[TR[a----n\bv{t-rp@-an{tr{H----n\bv{t-rp@-Ovn{tr{H--0r{qvs0r{qvs0v{pyqr-Ip|zz|{K0v{pyqr-I}npxv{tK0v{pyqr-Iqvurv{tl}nlsntzr{K0v{pyqr-Ip|y|l}nlsntzr{K0v{pyqr-Il}nlsntzr{K0v{pyqr-I?l}nlsntzr{K0v{pyqr-Izn}l}nlsntzr{K0v{pyqr-Iny}unzn}l}nlsntzr{K0v{pyqr-In|zn}l}nlsntzr{K0v{pyqr-Iyvtuzn}l}nlsntzr{K0v{pyqr-Irzvvrzn}l}nlsntzr{K0v{pyqr-IoqsK0v{pyqr-Iporllrsyrpv|{lsntzr{K0v{pyqr-Ir{zn}lp|zz|{l}nlsntzr{K0v{pyqr-Ir{zn}l}u\bvpnyl}nlsntzr{K0v{pyqr-Is|tl}nlsntzr{K0v{pyqr-Iyvtul}nlortv{K0v{pyqr-Iyvtul}u\bvpnyl}nlsntzr{K0v{pyqr-Iunq|zn}l}nlsntzr{K0v{pyqr-Ioz}zn}l}nlsntzr{K0v{pyqr-I{|znyzn}l}nlsntzr{K0v{pyqr-I|tu{rzn}l}nlsntzr{K0v{pyqr-Izrny{rzn}l}nlsntzr{K0v{pyqr-Iy|tqr}uosl}nlsntzr{K0v{pyqr-Ipyv}}v{tl}yn{rl}nlsntzr{Krp@-	||zcrp|5rp@-qvrpv|{9-rp@-rp|9-sy|n-	||z6-\n--sy|n-urn-J-q|5qvrpv|{9-rp|6H--rp@-q-J-qvrpv|{-7-urnH--rp@-}-J-rp|-:-qH--rp@-\0-J-}-7-	||zH--r{-{|znyv	r5q-8-\x006H\frp@-to?u5rp@-p6-\n----rpA-X-J-rpA5=;=9-:>;=-<-@;=9-?;=-<-@;=9-:>;=6H----rpA-}-J-zv\x075rpA5p;ot9-X;	69-rpA5p;to9-X;\x07\b69-r}5p;o9-p;t66H----rpA-\0-J-zv\x075rpA5};\x07\b9-p;69-rpA5p;9-};\b	\x0769-r}5};\x079-p;66H----sy|n-q-J-\0;\x07-:-zv{5\0;9-\0;\b6H----sy|n-r-J->;=r:>=H----r{-rp@5no5\0;	-8-5\0;-:-\0;\b6-<-5C;=-7-q-8-r669-q-<-5\0;\x07-8-r69-\0;\x076H\frp@-u?to5rp@-p6-\n----rpA-X-J-rpA5>;=9-?;=-<-@;=9->;=-<-@;=9-@;=6H----rp@-}-J-no5snp5p;\x07\x07\x07-8-X;\x07\b	6-7-C;=-:-X;6H----r{-p;	-7-zv\x075X;\x07\x07\x079-pynz}5}-:-X;\x07\x07\x079-=;=9->;=69-p;\b6H\frp@-trP|y|O\bUrvtu5nz}yr?Q-tnqvr{ar\x07r9-rpA-Sv{ny]|vv|{6-\n--sy|n--J-5Sv{ny]|vv|{;\b-:-z|qryO|{qv{tZv{;\b6-<-5z|qryO|{qv{tZn\x07;\b-:-z|qryO|{qv{tZv{;\b6H--r{-r\x07r?Q5tnqvr{ar\x07r9-rp?59-=;B66;toH\fZNV[lORS\\_R|vq-znv{56-\n--ZNV[l`aN_a--<<-JJJ-顶部裁切-JJJ--sy|n-||sP]|tr-J-}|5pynz}5:PnzrnQvrpv|{;\b9-=;=9->;=69-@;=6H--vs-5----_||sZnx-K-=;==>-33----Sv{ny]|vv|{;\b-K-z|qryO|{qv{tZn\x07;\b-:-||sP]|tr-7-5z|qryO|{qv{tZn\x07;\b-:-z|qryO|{qv{tZv{;\b6--6-\n----qvpnqH--\f--<<-JJJJJJJJJJJJJJ--<<-JJJ-前置裁切计算-JJJ--0vs-[bZlPYV]]R_`-K-=----o||y-pyv}}rqH----rpA-pyv}}r]|vv|{H----0}ntzn-{|yyly||}ln----s|-5-v{-v-J-=H-v-I-[bZlPYV]]R_`H-v-88-6-\n------pyv}}r]|vv|{-J-pyv}}rh-v-j;znv\x07V{rr-7-Sv{ny]|vv|{H------pyv}}rq-J-5pyv}}rh-v-j;sy||V{qr\x07-I-=;=-\v\v-no5sy||V{qr\x07-:-pyv}}rh-v-j;sy||V{qr\x076-I->;=6H------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;\x07-K-:=;B-33-pyv}}r]|vv|{;\x07-I-=;BH------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;\b-K-:=;B-33-pyv}}r]|vv|{;\b-I-=;BH------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;	-K-:=;B-33-pyv}}r]|vv|{;	-I-=;BH------vs-5pyv}}rq6-\n--------qvpnqH------\f----\f----0}ntzn-{|yyly||}lr{q--0r{qvs--<<-JJJJJJJJJJJJJJJJ--0v{pyqr-Ipyv}}v{tl}yn{rlsntzr{K--rpA-qvssrP|y|-J-rpA5-qvssr9-p|y|Ny}un-7-|}npv\b-6H--<<-JJJ-高度色-JJJ--0vs-qrsv{rq5b`RlP\\Y\\_lNYaVabQR6----qvssrP|y|;to-J-trP|y|O\bUrvtu5tnqvr{ar\x07r9-Sv{ny]|vv|{6H--0r{qvs--<<-JJJJJJJJJJJ--<<-JJJ-纯色-JJJ--0vs-qrsv{rq5b`RlP\\Y\\_lP\\[`aN[a6----qvssrP|y|;to-J-p|{n{P|y|H--0r{qvs--<<-JJJJJJJJJJJ--_rsyrprqYvtu-rsyrprqYvtu-J-_rsyrprqYvtu5-rp@5-=;=-69-rp@5-=;=-69-rp@5-=;=-69-rp@5-=;=-6-6H--rp@-|nyRzvvr_nqvn{pr-J-rzvvrH--0v{pyqr-Iy|tqr}uoslsntzr{K--0v{pyqr-Izn}lsntzr{K--0v{pyqr-Ip|y|lsntzr{K--0v{pyqr-Iny}unzn}lsntzr{K--0v{pyqr-Iny}unrlsntzr{K--0v{pyqr-I|tu{rzn}lsntzr{K0v{pyqr-Izrny{rzn}lsntzr{K--0v{pyqr-I{|znylsntzr{lortv{K--0v{pyqr-I{|znylsntzr{lzn}K--0v{pyqr-Irzvvrzn}lsntzr{K--<<-nppzynv|{--0v{pyqr-Iyvtul}u\bvpnylsntzr{K--0v{pyqr-Iyvtulsntzr{lortv{K--0v{pyqr-Iyvtulsntzr{lzn}K--0v{pyqr-Iyvtulsntzr{lr{qK--<<-z|qynv|{--0v{pyqr-In|zn}lsntzr{K--rp@-|t|v{tYvtu-J-rsyrprqYvtu;qvrpQvssr-8-rsyrprqYvtu;v{qvrpQvssr-8-rsyrprqYvtu;qvrp`}rpyn-8-rsyrprqYvtu;v{qvrp`}rpyn-8-|nyRzvvr_nqvn{prH--tylSntP|y|-J-rpA5-|t|v{tYvtu9-qvssrP|y|;n-6H--<<-JJJ-楼层显示-JJJ--sy|n-sy||\\}npv\b-J->;=H--vs-5u|{Sy||V{qr\x07-K-:=;=>-33-no5sy||V{qr\x07-:-u|{Sy||V{qr\x076-K-=;FF6-\n----sy||\\}npv\b-J-=;?-7-zv{55>;=-8-PnzrnQvrpv|{;\b69->;=6H--\f--tylSntP|y|;n-J-tylSntP|y|;n-7-sy||\\}npv\b-7-ovtu{rH--<<-JJJJJJJJJJJJJJ--ZNV[lZ\\QRYlP\\Y\\_--<<色调映射-色彩空间转换--0v{pyqr-I|{rzn}}v{tlsntzr{K--0v{pyqr-Ir{p|qv{tlsntzr{K--<<-JJJ-颜色增益调整-JJJ--rp@-toP|y|-J-tylSntP|y|;toH--rp@-uP|y|-J-to?u5toP|y|6H--uP|y|;\b-8J-p|y|`nnv|{H--uP|y|;	-8J-p|y|Ovtu{rH--tylSntP|y|;to-J-u?to5uP|y|6H--<<-JJJ-全景图-JJJ--rp@-}n{|=a|crr\x07-J-{|znyv	r5Sv{ny]|vv|{;\x07\b	-:-}n{|=lznv\x07h@j;\x07\b	6H--}n{|=a|crr\x07-J-	||zcrp|5PnzrnQvrpv|{9-}n{|=a|crr\x079-}n{|=l	||z6H--}n{|=a|crr\x07-J-}n{|=a|crr\x07-7-zn@5}n{|=lznv\x076H--rp@-}n{|>a|crr\x07-J-{|znyv	r5Sv{ny]|vv|{;\x07\b	-:-}n{|>lznv\x07h@j;\x07\b	6H--}n{|>a|crr\x07-J-	||zcrp|5PnzrnQvrpv|{9-}n{|>a|crr\x079-}n{|>l	||z6H--}n{|>a|crr\x07-J-}n{|>a|crr\x07-7-zn@5}n{|>lznv\x076H--rpA-}n{|P|y|H--rpA-}n{|=P|y|-J-r\x07rPor5}n{|=lzn}9-}n{|=a|crr\x076H--rpA-}n{|>P|y|-J-r\x07rPor5}n{|>lzn}9-}n{|>a|crr\x076H--0vs-qrsv{rq5b`RlYbZV[N[PR6----}n{|=P|y|;n-J->;=-:-r\x07rPor5}n{|=lyzv{n{prZn}9-}n{|=a|crr\x076;H----}n{|>P|y|;n-J->;=-:-r\x07rPor5}n{|>lyzv{n{prZn}9-}n{|>a|crr\x076;H--0r{qvs--0vs-qrsv{rq5b`RlOYNPXla_N[`VaV\\[6----sy|n-oynpx]|tr-J-np|5:?;=-7-}|tr-8->;=6H----}n{|P|y|-J-zv\x075}n{|=P|y|9-OYNPXlP\\Y\\_9-zv{5>;=9-oynpx]|tr66H----}n{|P|y|-J-zv\x075}n{|P|y|9-}n{|>P|y|9-zn\x075=;=9-oynpx]|tr-:-]V-8->;=66H--0ryvs-qrsv{rq5b`Rl`]_RNQla_N[`VaV\\[6----rp?-prr{Pr{rP||q-J-r|yv|{-7-}v\x07ry_nv|-<-?;=H----sy|n-n{vv|{_nqv-J-qvn{pr5rp?5=;=9-=;=69-prr{Pr{rP||q6-7->;?H----sy|n-n{vv|{]|tr-J-qvn{pr5tylSntP||q;\x07\b9-prr{Pr{rP||q6-<-n{vv|{_nqvH----}n{|P|y|-J-zv\x075}n{|=P|y|9-}n{|>P|y|9-z||ur}5=;=9-=;?9-}|tr-:-n{vv|{]|tr66H--0ryr----}n{|P|y|-J-zv\x075}n{|=P|y|9-}n{|>P|y|9-}|tr6H--0r{qvs--tylSntP|y|-J-zv\x075}n{|P|y|9-tylSntP|y|9-z|qryNy}un6H--<<-JJJJJJJJJJJJJJ--0v{pyqr-Is|tlsntzr{K--0v{pyqr-I}rzyv}yvrqlny}unlsntzr{K--0v{pyqr-Iqvurv{tlsntzr{K--0vs-qrsv{rq5b`RlRQY6----tylSntP|y|;n-J-Y|tQr}uH--0r{qvs--ZNV[lR[Q\f");var pbmUniforms$1={colorAlpha:new Uniform(0),modelAlpha:new Uniform(0),progress:new Uniform(0),pano0_map:new Uniform(null),pano0_luminanceMap:new Uniform(null),pano0_matrix:new Uniform(new Matrix4),pano0_zoom:new Uniform(1),pano1_map:new Uniform(null),pano1_luminanceMap:new Uniform(null),pano1_matrix:new Uniform(new Matrix4),pano1_zoom:new Uniform(1),gradientTexture:new Uniform(null),clippers:new Uniform([]),shownFloorIndex:new Uniform(-1),constantColor:new Uniform(new Vector3),geometricError:new Uniform(0),pixelRatio:new Uniform(1),resolution:new Uniform(new Vector2(512,512)),floorIndex:new Uniform(0),brightness:new Uniform(1),modelBoundingMin:new Uniform(new Vector3),modelBoundingMax:new Uniform(new Vector3),colorSaturation:new Uniform(0),colorBrightness:new Uniform(0),outlineGain:new Uniform(0),distanceGain:new Uniform(0)},shaderLib={none:{vertexShader:meshNoneVertexShader,fragmentShader:meshNoneFragmentShader,uniforms:UniformsUtils.merge([pbmUniforms$1,{opacity:{value:1}},UniformsLib.fog]),lights:!1,clipping:!1},basic:{vertexShader:meshBasicVertexShader,fragmentShader:meshBasicFragmentShader,uniforms:UniformsUtils.merge([pbmUniforms$1,ShaderLib.basic.uniforms]),lights:!1,clipping:!0},phong:{vertexShader:meshPhongVertexShader,fragmentShader:meshPhongFragmentShader,uniforms:UniformsUtils.merge([pbmUniforms$1,ShaderLib.phong.uniforms]),lights:!0,clipping:!0},standard:{vertexShader:meshStandardVertexShader,fragmentShader:meshStandardFragmentShader,uniforms:UniformsUtils.merge([pbmUniforms$1,ShaderLib.standard.uniforms]),lights:!0,clipping:!0}},PBMMeshMaterial=function(e){__extends(t,e);function t(r,n){r===void 0&&(r="basic"),n===void 0&&(n={});var o=this,s,l,u,c,h,f,m,y,A,M,b,T,_,S,C,P,F,O,N,V,q,Q,z,H,W,J,G,te,X=shaderLib[r];o=e.call(this,{vertexShader:X.vertexShader,fragmentShader:X.fragmentShader,uniforms:UniformsUtils.clone(X.uniforms),lights:X.lights,clipping:X.clipping,defines:{USE_COLOR_CONSTANT:!1,USE_COLOR_ALTITUDE:!1,USE_EDL:!1,USE_HQ_WEIGHT:!1,USE_HQ_DEPTH:!1,NUM_CLIPPING_BOX:!1,USE_CLIPFLOOR:!1,USE_VERTEX_MARK:!1,USE_LUMINANCE:!1,USE_BLACK_TRANSITION:!1,USE_SPREAD_TRANSITION:!1,USE_POINT_NORMAL:!1,USE_POINT_CIRCLE:!1,USE_POINT_ADAPTIVE_SIZE:!1,USE_POINT_COLOR_ALTITUDE:!1}})||this,o.shaderType=r,o.vertexTangents=!1,o.color=new Color(16777215),o.colorAlpha=1,o.map=null,o.lightMap=null,o.lightMapIntensity=1,o.aoMap=null,o.aoMapIntensity=1,o.specularMap=null,o.specular=new Color(1118481),o.roughnessMap=null,o.roughness=1,o.metalnessMap=null,o.metalness=0,o.alphaMap=null,o.alphaMode="OPAQUE",o.combine=null,o.envMap=null,o.envMapIntensity=1,o.reflectivity=.4,o.refractionRatio=.98,o.emissiveMap=null,o.emissive=new Color(0),o.emissiveIntensity=1,o.bumpMap=null,o.bumpScale=1,o.normalMap=null,o.normalMapType=TangentSpaceNormalMap,o.normalScale=new Vector2(1,1),o.displacementMap=null,o.displacementScale=1,o.displacementBias=0,o.shininess=30;var K,Z=null,ee=null;return o.shaderType==="phong"&&(o.combine=MultiplyOperation),Object.defineProperties(o,{pano0:{get:function(){return Z},set:function(j){if(Z!==j){Z=j,j===null?(this.uniforms.pano0_map.value=null,this.uniforms.pano0_luminanceMap.value=null,this.uniforms.pano0_matrix.value.identity(),this.uniforms.pano0_zoom.value=1):(this.uniforms.pano0_map.value=j.map instanceof TileCubeTextureTarget?j.map.texture:j.map,this.uniforms.pano0_luminanceMap.value=j.luminanceMap instanceof TileCubeTextureTarget?j.luminanceMap.texture:j.luminanceMap,this.uniforms.pano0_matrix.value.copy(j.matrix),this.uniforms.pano0_zoom.value=j.zoom);var re=this.uniforms.pano0_luminanceMap.value!==null&&this.uniforms.pano1_luminanceMap.value!==null,pe=this.defines.USE_LUMINANCE;pe!==re&&(this.defines.USE_LUMINANCE=re,this.needsUpdate=!0)}}},pano1:{get:function(){return ee},set:function(j){if(ee!==j){ee=j,j===null?(this.uniforms.pano1_map.value=null,this.uniforms.pano1_luminanceMap.value=null,this.uniforms.pano1_matrix.value.identity(),this.uniforms.pano1_zoom.value=1):(this.uniforms.pano1_map.value=j.map instanceof TileCubeTextureTarget?j.map.texture:j.map,this.uniforms.pano1_luminanceMap.value=j.luminanceMap instanceof TileCubeTextureTarget?j.luminanceMap.texture:j.luminanceMap,this.uniforms.pano1_matrix.value.copy(j.matrix),this.uniforms.pano1_zoom.value=j.zoom);var re=this.uniforms.pano0_luminanceMap.value!==null&&this.uniforms.pano1_luminanceMap.value!==null,pe=this.defines.USE_LUMINANCE;pe!==re&&(this.defines.USE_LUMINANCE=re,this.needsUpdate=!0)}}},modelAlpha:{get:function(){return this.uniforms.modelAlpha.value},set:function(j){this.uniforms.modelAlpha.value=j}},progress:{get:function(){return this.uniforms.progress.value},set:function(j){this.uniforms.progress.value=j}},transition:{get:function(){return this.defines.USE_BLACK_TRANSITION?"BLACK":this.defines.USE_SPREAD_TRANSITION?"SPREAD":"FADE"},set:function(j){var re=this.defines.USE_BLACK_TRANSITION,pe=this.defines.USE_SPREAD_TRANSITION;this.defines.USE_BLACK_TRANSITION=!1,this.defines.USE_SPREAD_TRANSITION=!1,this.defines["USE_".concat(j,"_TRANSITION")]=!0;var ge=!1;re!==this.defines.USE_BLACK_TRANSITION&&(ge=!0),pe!==this.defines.USE_SPREAD_TRANSITION&&(ge=!0),ge&&(this.needsUpdate=!0)}},colorStyle:{get:function(){return this.defines.USE_COLOR_CONSTANT?"CONSTANT":this.defines.USE_COLOR_ALTITUDE?"ALTITUDE":"RGB"},set:function(j){var re=j==="CONSTANT",pe=j==="ALTITUDE";this.defines.USE_COLOR_CONSTANT!==re&&(this.defines.USE_COLOR_CONSTANT=re,this.needsUpdate=!0),this.defines.USE_COLOR_ALTITUDE!==pe&&(this.defines.USE_COLOR_ALTITUDE=pe,this.needsUpdate=!0)}},constantColor:{get:function(){return this.uniforms.constantColor.value},set:function(j){this.uniforms.constantColor.value=j}},opacity:{get:function(){return this.uniforms.opacity.value},set:function(j){this.uniforms.opacity.value=j}},shownFloorIndex:{get:function(){return this.uniforms.shownFloorIndex.value},set:function(j){this.uniforms.shownFloorIndex.value=j}},gradientTexture:{get:function(){return this.uniforms.gradientTexture.value},set:function(j){this.uniforms.gradientTexture.value=j}},brightness:{get:function(){return this.uniforms.brightness.value},set:function(j){this.uniforms.brightness.value=j}},clippers:{get:function(){return K},set:function(j){K!==j&&(K=j,this.uniforms.clippers.value=(K||[]).map(function(re){var pe=typeof re.floorIndex=="number"?re.floorIndex:-1,ge=new Matrix4().getInverse(re.clippingBoxMatrix);return{matrixInverse:ge,floorIndex:pe}}),this.needsUpdate=!0)}},useEDL:{get:function(){return this.defines.USE_EDL},set:function(j){j!==this.defines.USE_EDL&&(this.defines.USE_EDL=j,this.needsUpdate=!0)}},useHQWeight:{get:function(){return this.defines.USE_HQ_WEIGHT},set:function(j){j!==this.defines.USE_HQ_WEIGHT&&(this.defines.USE_HQ_WEIGHT=j,this.needsUpdate=!0)}},useHQDepth:{get:function(){return this.defines.USE_HQ_DEPTH},set:function(j){j!==this.defines.USE_HQ_DEPTH&&(this.defines.USE_HQ_DEPTH=j,this.needsUpdate=!0)}},floorIndex:{get:function(){return this.uniforms.floorIndex.value},set:function(j){this.uniforms.floorIndex.value=j}},colorSaturation:{get:function(){return this.uniforms.colorSaturation.value},set:function(j){this.uniforms.colorSaturation.value=j}},colorBrightness:{get:function(){return this.uniforms.colorBrightness.value},set:function(j){this.uniforms.colorBrightness.value=j}},outlineGain:{get:function(){return this.uniforms.outlineGain.value},set:function(j){this.uniforms.outlineGain.value=j}},distanceGain:{get:function(){return this.uniforms.distanceGain.value},set:function(j){this.uniforms.distanceGain.value=j}}}),o.pano0=(s=n.pano0)!==null&&s!==void 0?s:defaultPbmParameters.pano0,o.pano1=(l=n.pano1)!==null&&l!==void 0?l:defaultPbmParameters.pano1,o.modelAlpha=(u=n.modelAlpha)!==null&&u!==void 0?u:defaultPbmParameters.modelAlpha,o.progress=(c=n.progress)!==null&&c!==void 0?c:defaultPbmParameters.progress,o.transition=(h=n.transition)!==null&&h!==void 0?h:defaultPbmParameters.transition,o.constantColor=(f=n.constantColor)!==null&&f!==void 0?f:defaultPbmParameters.constantColor,o.opacity=(m=n.opacity)!==null&&m!==void 0?m:defaultPbmParameters.opacity,o.floorStyle=(y=n.floorStyle)!==null&&y!==void 0?y:defaultPbmParameters.floorStyle,o.shownFloorIndex=(A=n.shownFloorIndex)!==null&&A!==void 0?A:defaultPbmParameters.shownFloorIndex,o.clippers=(M=n.clippers)!==null&&M!==void 0?M:defaultPbmParameters.clippers,o.useEDL=(b=n.useEDL)!==null&&b!==void 0?b:defaultPbmParameters.useEDL,o.useHQWeight=(T=n.useHQWeight)!==null&&T!==void 0?T:defaultPbmParameters.useHQWeight,o.useHQDepth=(_=n.useHQDepth)!==null&&_!==void 0?_:defaultPbmParameters.useHQDepth,o.pointSize=(S=n.pointSize)!==null&&S!==void 0?S:defaultPbmParameters.pointSize,o.colorStyle=(C=n.colorStyle)!==null&&C!==void 0?C:defaultPbmParameters.colorStyle,o.pointShape=(P=n.pointShape)!==null&&P!==void 0?P:defaultPbmParameters.pointShape,o.pointScale=(F=n.pointScale)!==null&&F!==void 0?F:defaultPbmParameters.pointScale,o.pointBack=(O=n.pointBack)!==null&&O!==void 0?O:defaultPbmParameters.pointBack,o.pointMinPixel=(N=n.pointMinPixel)!==null&&N!==void 0?N:defaultPbmParameters.pointMinPixel,o.pointMaxPixel=(V=n.pointMaxPixel)!==null&&V!==void 0?V:defaultPbmParameters.pointMaxPixel,o.gradientTexture=(q=n.gradientTexture)!==null&&q!==void 0?q:defaultPbmParameters.gradientTexture,o.brightness=(Q=n.brightness)!==null&&Q!==void 0?Q:defaultPbmParameters.brightness,o.colorSaturation=(z=n.colorSaturation)!==null&&z!==void 0?z:defaultPbmParameters.colorSaturation,o.colorBrightness=(H=n.colorBrightness)!==null&&H!==void 0?H:defaultPbmParameters.colorBrightness,o.customShaders=(W=n.customShaders)!==null&&W!==void 0?W:defaultPbmParameters.customShaders,o.outlineGain=(J=n.outlineGain)!==null&&J!==void 0?J:defaultPbmParameters.outlineGain,o.distanceGain=(G=n.distanceGain)!==null&&G!==void 0?G:defaultPbmParameters.distanceGain,o.useAddBlend=(te=n.useAddBlend)!==null&&te!==void 0?te:defaultPbmParameters.useAddBlend,o.customShaderHash="",o.customShaderUniforms={},o.customShaderDefines={},o.floorIndex=0,o.transparent=!1,o}return t.prototype.onBeforeCompile=function(r,n){var o=this,s,l,u=this.customShaders.filter(function(T){return T.type.includes(o.shaderType)}),c=u.reduce(function(T,_){return T+_.vertex.mainBefore},""),h=u.reduce(function(T,_){return T+_.vertex.mainStart},""),f=u.reduce(function(T,_){return T+_.vertex.mainEnd},""),m=u.reduce(function(T,_){return T+_.fragment.mainBefore},""),y=u.reduce(function(T,_){return T+_.fragment.mainStart},""),A=u.reduce(function(T,_){return T+_.fragment.mainModelColor},""),M=u.reduce(function(T,_){return T+_.fragment.mainEnd},"");r.vertexShader=r.vertexShader.replace(/MAIN_BEFORE/g,c),r.fragmentShader=r.fragmentShader.replace(/MAIN_BEFORE/g,m),r.vertexShader=r.vertexShader.replace(/MAIN_START/g,h),r.fragmentShader=r.fragmentShader.replace(/MAIN_START/g,y),r.vertexShader=r.vertexShader.replace(/MAIN_END/g,f),r.fragmentShader=r.fragmentShader.replace(/MAIN_END/g,M),r.fragmentShader=r.fragmentShader.replace(/MAIN_MODEL_COLOR/g,A);var b=String((l=(s=this.clippers)===null||s===void 0?void 0:s.length)!==null&&l!==void 0?l:0);r.vertexShader=r.vertexShader.replace(/NUM_CLIPPERS/g,b),r.fragmentShader=r.fragmentShader.replace(/NUM_CLIPPERS/g,b),u.forEach(function(T){T.onBeforeCompile(r,n)})},t.prototype.refreshUniforms=function(r){var n,o,s=this.uniforms;s.diffuse&&s.diffuse.value.copy(this.color),s.opacity&&(s.opacity.value=this.opacity),s.color&&s.diffuse.value.copy(this.color),s.colorAlpha&&(s.colorAlpha.value=this.colorAlpha),s.emissive&&s.emissive.value.copy(this.emissive).multiplyScalar(this.emissiveIntensity),s.roughness&&(s.roughness.value=this.roughness),s.metalness&&(s.metalness.value=this.metalness),s.map&&(s.map.value=this.map),s.alphaMap&&(s.alphaMap.value=this.alphaMap),s.specularMap&&(s.specularMap.value=this.specularMap),s.roughnessMap&&(s.roughnessMap.value=this.roughnessMap),s.metalnessMap&&(s.metalnessMap.value=this.metalnessMap),s.envMap&&(s.envMap.value=this.envMap,s.flipEnvMap.value=!((n=this.envMap)===null||n===void 0)&&n.isCubeTexture?-1:1,s.reflectivity.value=this.reflectivity,s.refractionRatio.value=this.refractionRatio,s.maxMipLevel.value=this.envMap&&(o=r==null?void 0:r.properties.get(this.envMap).__maxMipLevel)!==null&&o!==void 0?o:0,s.envMapIntensity&&(s.envMapIntensity.value=this.envMapIntensity)),s.lightMap&&(s.lightMap.value=this.lightMap,s.lightMapIntensity.value=this.lightMapIntensity),s.aoMap&&(s.aoMap.value=this.aoMap,s.aoMapIntensity.value=this.aoMapIntensity),s.specular&&s.specular.value.copy(this.specular),s.shininess&&(s.shininess.value=Math.max(this.shininess,1e-4)),s.emissiveMap&&(s.emissiveMap.value=this.emissiveMap),s.bumpMap&&(s.bumpMap.value=this.bumpMap,s.bumpScale.value=this.bumpScale,this.side===BackSide&&(s.bumpScale.value*=-1)),s.normalMap&&(s.normalMap.value=this.normalMap,s.normalScale.value.copy(this.normalScale),this.side===BackSide&&s.normalScale.value.negate()),s.displacementMap&&(s.displacementMap.value=this.displacementMap,s.displacementScale.value=this.displacementScale,s.displacementBias.value=this.displacementBias);var l;this.map?l=this.map:this.specularMap?l=this.specularMap:this.displacementMap?l=this.displacementMap:this.normalMap?l=this.normalMap:this.bumpMap?l=this.bumpMap:this.alphaMap?l=this.alphaMap:this.emissiveMap&&(l=this.emissiveMap),l!==void 0&&(l.matrixAutoUpdate===!0&&l.updateMatrix(),s.uvTransform.value.copy(l.matrix));var u;this.aoMap?u=this.aoMap:this.lightMap&&(u=this.lightMap),u!==void 0&&(u.matrixAutoUpdate===!0&&u.updateMatrix(),s.uv2Transform.value.copy(u.matrix))},t.prototype.update=function(r,n,o){var s="".concat(o.id,":").concat(o.materialVersion);s!==this.syncModelVersion&&(Object.assign(this,o.getMaterial()),this.syncModelVersion=s);var l=this.customShaders.map(function(_){return _.getHash()}).join("");this.customShaderHash!==l&&(this.customShaderHash=l,this.needsUpdate=!0);for(var u=this.customShaders.reduce(function(_,S){return Object.assign(_,S.defines)},{}),c=Object.keys(this.customShaderDefines),h=0,f=c;h<f.length;h++){var m=f[h];delete this.defines[m]}this.customShaderDefines=u,Object.assign(this.defines,this.customShaderDefines);for(var y=this.customShaders.reduce(function(_,S){return Object.assign(_,S.uniforms)},{}),A=Object.keys(this.customShaderUniforms),M=0,b=A;M<b.length;M++){var T=b[M];delete this.uniforms[T]}this.customShaderUniforms=y,Object.assign(this.uniforms,this.customShaderUniforms),this.visible=!0,this.envMap||(this.envMap=n.environment),this.refreshUniforms(r),this.useAddBlend?(this.depthWrite=!1,this.depthTest=!1,this.blending=AdditiveBlending):(this.depthWrite=!0,this.depthTest=!0,this.blending=NormalBlending),this.shaderType==="none"?(this.depthWrite=!1,this.transparent=!0):(this.transparent=this.alphaMode==="BLEND",this.depthWrite=!0,this.shownFloorIndex>-1&&this.shownFloorIndex!==this.floorIndex&&(this.transparent=!0),this.opacity*this.colorAlpha<1&&(this.transparent=!0),this.alphaMap&&(this.transparent=!0),this.brightness<1&&(this.transparent=!0),this.transparent&&(this.depthWrite=!1),this.floorStyle==="VISIBILITY"&&this.shownFloorIndex!==-1&&this.floorIndex!==this.shownFloorIndex&&(this.visible=!1)),this.uniforms.pixelRatio.value=n.pixelRatio,this.uniforms.resolution.value.copy(n.resolution),this.uniforms.modelBoundingMax.value.copy(o.bounding.max),this.uniforms.modelBoundingMin.value.copy(o.bounding.min)},t.prototype.copy=function(r){return e.prototype.copy.call(this,r),this.color.copy(r.color),this.colorAlpha=r.colorAlpha,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.specular.copy(r.specular),this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.emissiveMap=r.emissiveMap,this.emissive.copy(r.emissive),this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.shininess=r.shininess,this.customShaders=r.customShaders,this.pano0=r.pano0,this.pano1=r.pano1,this.modelAlpha=r.modelAlpha,this.progress=r.progress,this.transition=r.transition,this.opacity=r.opacity,this.floorStyle=r.floorStyle,this.colorStyle=r.colorStyle,this.constantColor=r.constantColor,this.shownFloorIndex=r.shownFloorIndex,this.brightness=r.brightness,this.clippers=r.clippers,this.useEDL=r.useEDL,this.useHQWeight=r.useHQWeight,this.useHQDepth=r.useHQDepth,this.pointSize=r.pointSize,this.pointShape=r.pointShape,this.pointScale=r.pointScale,this.pointBack=r.pointBack,this.pointMinPixel=r.pointMinPixel,this.pointMaxPixel=r.pointMaxPixel,this.gradientTexture=r.gradientTexture,this.floorIndex=r.floorIndex,this.colorSaturation=r.colorSaturation,this.colorBrightness=r.colorBrightness,this.outlineGain=r.outlineGain,this.distanceGain=r.distanceGain,this.useAddBlend=r.useAddBlend,this.refreshUniforms(),this},t.prototype.clone=function(){return new this.constructor(this.shaderType).copy(this)},t}(ShaderMaterial);const pointCloudFragmentShader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=113,n=126,o=0,s="";return e[o].split(s).map(function(l){return l.charCodeAt(o)>n?l:String.fromCharCode((l.charCodeAt(o)+r)%n)}).join(s)}("{vs|z-sy|n-sy||V{qr\x07H0vs-qrsv{rq5b`Rl]\\V[al[\\_ZNY6--n\bv{t-rp@-[|znyH0r{qvs0vs-qrsv{rq5b`RlRQY6--n\bv{t-sy|n-Y|tQr}uH0r{qvsp-Pyv}}r-\n--znA-znv\x07V{rrH--sy|n-sy||V{qr\x07H\fH0vs-[bZlPYV]]R_`-K-=--{vs|z-Pyv}}r-pyv}}rh[bZlPYV]]R_`jH0r{qvsn\bv{t-rpA-d|yq]|vv|{Hn\bv{t-rp@-PnzrnQvrpv|{Hn\bv{t-rp@-P|y|Hn\bv{t-sy|n-]|v{`v	rH{vs|z-sy|n-|}npv\bH{vs|z-sy|n-z|qryNy}unH{vs|z-sy|n-u|{Sy||V{qr\x07H<<u调整{vs|z-sy|n-p|y|`nnv|{H{vs|z-sy|n-p|y|Ovtu{rH{vs|z-rp@-z|qryO|{qv{tZn\x07H{vs|z-rp@-z|qryO|{qv{tZv{H<<-边缘增益{vs|z-sy|n-|yv{rTnv{H{vs|z-sy|n-qvn{prTnv{H0v{pyqr-Ip|zz|{K0v{pyqr-Is|tl}nlsntzr{K0v{pyqr-Iy|tqr}uosl}nlsntzr{K0v{pyqr-Ipyv}}v{tl}yn{rl}nlsntzr{Krp@-nqwP|y|arz}rnr5rp@-p|y|9-sy|n-rz}rnr6\n----<<-将色温范围从-:>;=-到->;=-映射到实际的色温范围----sy|n-rz}-J-5rz}rnr-8->;=6-7-B===;=H-<<-范围从-=-到->====----<<-计算色温系数----sy|n-lsnp|9-tlsnp|9-olsnp|H----vs-5rz}-IJ-CC==;=6-\n--------lsnp|-J->;=H--------tlsnp|-J-=;@F==E>BDEDCF=>FC=DEA-7-y|t5rz}-<->==;=6-:-=;C@>EA>AA@DEEC?DAB=FEH--------olsnp|-J-rz}-IJ->F==;=-L-=;=-G-=;BA@?=CDEF>>=>FC=DEA@-7-y|t5rz}-<->==;=-:->=;=6-:->;>FC?BA=EF>AH----\f-ryr-\n--------lsnp|-J->;?F?F@C>EC=C?DAB=FE=A-7-}|5rz}-<->==;=-:-C=;=9-:=;>@@?=ADBF?6H--------tlsnp|-J->;>?FEF=EC=EFB?FA>>DCB-7-}|5rz}-<->==;=-:-C=;=9-:=;=DBB>AEAF?6H--------olsnp|-J->;=H----\f----<<-调整颜色----rp@-nqwrqP|y|H----nqwrqP|y|;-J-pynz}5p|y|;-7-lsnp|9-=;=9->;=6H----nqwrqP|y|;t-J-pynz}5p|y|;t-7-tlsnp|9-=;=9->;=6H----nqwrqP|y|;o-J-pynz}5p|y|;o-7-olsnp|9-=;=9->;=6H----r{-nqwrqP|y|H\frp@-to?u5rp@-p6-\n----rpA-X-J-rpA5=;=9-:>;=-<-@;=9-?;=-<-@;=9-:>;=6H----rpA-}-J-zv\x075rpA5p;ot9-X;	69-rpA5p;to9-X;\x07\b69-r}5p;o9-p;t66H----rpA-\0-J-zv\x075rpA5};\x07\b9-p;69-rpA5p;9-};\b	\x0769-r}5};\x079-p;66H----sy|n-q-J-\0;\x07-:-zv{5\0;9-\0;\b6H----sy|n-r-J->;=r:>=H----r{-rp@5no5\0;	-8-5\0;-:-\0;\b6-<-5C;=-7-q-8-r669-q-<-5\0;\x07-8-r69-\0;\x076H\frp@-u?to5rp@-p6-\n----rpA-X-J-rpA5>;=9-?;=-<-@;=9->;=-<-@;=9-@;=6H----rp@-}-J-no5snp5p;\x07\x07\x07-8-X;\x07\b	6-7-C;=-:-X;6H----r{-p;	-7-zv\x075X;\x07\x07\x079-pynz}5}-:-X;\x07\x07\x079-=;=9->;=69-p;\b6H\fZNV[lORS\\_R|vq-znv{56-\n--ZNV[l`aN_a--<<-JJJ-点大小剔除-JJJ--vs-5]|v{`v	r-I-=;==>6-\n----qvpnqH--\f--<<-JJJ-前置裁切计算-JJJ--0vs-[bZlPYV]]R_`-K-=----o||y-pyv}}rqH----rpA-pyv}}r]|vv|{H----0}ntzn-{|yyly||}ln----s|-5-v{-v-J-=H-v-I-[bZlPYV]]R_`H-v-88-6-\n------pyv}}r]|vv|{-J-pyv}}rh-v-j;znv\x07V{rr-7-d|yq]|vv|{H------pyv}}rq-J-5pyv}}rh-v-j;sy||V{qr\x07-I-=;=-\v\v-no5sy||V{qr\x07-:-pyv}}rh-v-j;sy||V{qr\x076-I->;=6H------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;\x07-K-:=;B-33-pyv}}r]|vv|{;\x07-I-=;BH------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;\b-K-:=;B-33-pyv}}r]|vv|{;\b-I-=;BH------pyv}}rq-J-pyv}}rq-33-pyv}}r]|vv|{;	-K-:=;B-33-pyv}}r]|vv|{;	-I-=;BH------vs-5pyv}}rq6-\n--------qvpnqH------\f----\f----0}ntzn-{|yyly||}lr{q--0r{qvs--<<-JJJJJJJJJJJJJJJJ--sy|n-}-J-?;=-7-tyl]|v{P||q;\x07-:->;=H--sy|n-}-J-?;=-7-tyl]|v{P||q;\b-:->;=H--sy|n-}-J-}-7-}-8-}-7-}H--<<-JJJ-形状裁切-JJJ--0vs-qrsv{rq5b`Rl]\\V[al`UN]RlPV_PYR6----vs-5]|v{`v	r-K-@;=-33-}-K->;=6-\n------qvpnqH----\f--0r{qvs--<<-JJJJJJJJJJJJJ--0v{pyqr-Ipyv}}v{tl}yn{rlsntzr{K--0v{pyqr-Iy|tqr}uoslsntzr{K--<<-JJJ-颜色-JJJ--rpA-sv{nyP|y|-J-_TOa|Yv{rn5rpA5P|y|9-|}npv\b66H--0vs-qrsv{rq5b`Rl]\\V[al[\\_ZNY6----0vs-qrsv{rq5b`Rl]\\V[alONPXlUVQQR[6------rp@-pnzrnQvrpv|{-J-{|znyv	r5pnzrn]|vv|{-:-d|yq]|vv|{;\x07\b	6H------vs-5q|5pnzrnQvrpv|{9-[|zny6-I-=;=6-\n--------qvpnqH------\f----0ryvs-qrsv{rq5b`Rl]\\V[alONPXlQN_X6------rp@-pnzrnQvrpv|{-J-{|znyv	r5pnzrn]|vv|{-:-d|yq]|vv|{;\x07\b	6H------vs-5q|5pnzrnQvrpv|{9-[|zny6-I-=;=6-\n--------sv{nyP|y|;\x07\b	-J-sv{nyP|y|;\x07\b	-7-=;EH------\f----0r{qvs--0r{qvs--tylSntP|y|-J-sv{nyP|y|H--<<-JJJJJJJJJJJ--<<-JJJ-楼层显示-JJJ--sy|n-sy||\\}npv\b-J->;=H--vs-5u|{Sy||V{qr\x07-K-:=;=>-33-no5sy||V{qr\x07-:-u|{Sy||V{qr\x076-K-=;FF6-\n----sy||\\}npv\b-J-=;>-7-zv{55>;=-8-PnzrnQvrpv|{;\b69->;=6H--\f--tylSntP|y|;n-J-tylSntP|y|;n-7-sy||\\}npv\bH--<<-JJJJJJJJJJJJJJ--tylSntP|y|;n-J-tylSntP|y|;n-7-z|qryNy}unH--ZNV[lZ\\QRYlP\\Y\\_--0v{pyqr-I|{rzn}}v{tlsntzr{K--0v{pyqr-Ir{p|qv{tlsntzr{K--<<-JJJ-颜色增益调整-JJJ--rp@-toP|y|-J-tylSntP|y|;toH--rp@-uP|y|-J-to?u5toP|y|6H--uP|y|;\b-8J-p|y|`nnv|{H--uP|y|;	-8J-p|y|Ovtu{rH--tylSntP|y|;to-J-u?to5uP|y|6H--0v{pyqr-Is|tlsntzr{K--0v{pyqr-I}rzyv}yvrqlny}unlsntzr{K--<<-边缘增强--0vs-qrsv{rq5b`Rl]\\V[al[\\_ZNY6----rp@-toP|y|?-J-tylSntP|y|;toH----rp@-uP|y|?-J-to?u5toP|y|?6H----rp@-vrQv-J-{|znyv	r5v\\u|tn}uvp-L-PnzrnQvrpv|{-G-d|yq]|vv|{;\x07\b	-:-pnzrn]|vv|{6H----<<-计算边缘增益----sy|n-p|aurn-J-q|5{|znyv	r5[|zny69-vrQv6H----sy|n-n{tyr-J-np|5p|aurn6H----sy|n-|yv{rSnp|-J-}|5>;=-:-no5n{tyr-:-]VlUNYS6-<-]VlUNYS9-B;=6H----uP|y|?;	-8J-|yv{rTnv{-7-|yv{rSnp|H-<<-增加亮度----uP|y|?;	-J-pynz}5uP|y|?;	9-=;=9->;=6H------<<-距离增益----rp@-o|{qv{tPr{r-J-5z|qryO|{qv{tZn\x07-8-z|qryO|{qv{tZv{6-<-?;=H----sy|n-o|{qv{tYr{tu-J-yr{tu5z|qryO|{qv{tZn\x07;\b-:-z|qryO|{qv{tZv{;\b6-7->;BH----sy|n-nrntrQvn{pr-J->=;=H-<<-设定一个平均距离----rp@-pnzrna|]|v{-J-d|yq]|vv|{;\x07\b	-:-pnzrn]|vv|{H----sy|n-pnzrnO|{qv{tQvn{pr-J-zn\x075=;=9-yr{tu5pnzrn]|vv|{-:-o|{qv{tPr{r6-:-o|{qv{tYr{tu-<-?;=6H----sy|n-pnzrnQvn{pr-J-yr{tu5v\\u|tn}uvp-L-vrQv-7-q|5vrQv9-pnzrna|]|v{6-G-pnzrna|]|v{6-:-pnzrnO|{qv{tQvn{prH----sy|n-qvn{prSnp|-J-pynz}5zn\x075pnzrnQvn{pr-:-nrntrQvn{pr9-=;=6-<-o|{qv{tYr{tu9-=;=9->;=6H----qvn{prSnp|-J-5=;E-:-pynz}5>;=-:-}|5>;=-:-qvn{prSnp|9-@;=69-=;=9->;=66-7->?;=H----tylSntP|y|;n-8J-zv\x075tylSntP|y|;n-7-qvn{prTnv{-7-qvn{prSnp|9-=;=9-|yv{rSnp|6H-<<-增加透明度----tylSntP|y|;n-J-pynz}5tylSntP|y|;n9-=;=9->;=6H----tylSntP|y|;to-J-u?to5uP|y|?6H--0r{qvs--0vs-qrsv{rq5b`RlRQY6----tylSntP|y|;n-J-Y|tQr}uH--0r{qvs--0vs-qrsv{rq5b`RlU^ldRVTUa6----sy|n-qvn{pr-J-?;=-7-yr{tu5tyl]|v{P||q;\x07\b-:-=;B6H----sy|n-rvtu-J-zn\x075=;=9->;=-:-qvn{pr6H----rvtu-J-}|5rvtu9->;B6H----tylSntP|y|;n-J-rvtuH----tylSntP|y|;\x07\b	-J-tylSntP|y|;\x07\b	-7-rvtuH--0r{qvs--ZNV[lR[Q\f"),pointCloudVertexShader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=113,n=126,o=0,s="";return e[o].split(s).map(function(l){return l.charCodeAt(o)>n?l:String.fromCharCode((l.charCodeAt(o)+r)%n)}).join(s)}("nvor-rp@-p|y|H0vs-qrsv{rq5b`RlP\\Y\\_lP\\[`aN[a6--{vs|z-rp@-p|{n{P|y|H0r{qvs0vs-qrsv{rq5b`RlP\\Y\\_lNYaVabQR6--{vs|z-nz}yr?Q-tnqvr{ar\x07rH0r{qvs0vs-qrsv{rq5b`RlRQY6--n\bv{t-sy|n-Y|tQr}uH0r{qvs{vs|z-rp?-r|yv|{H{vs|z-sy|n-}v\x07ry_nv|H{vs|z-sy|n-}|v{`pnyrH{vs|z-sy|n-}|v{Zv{]v\x07ryH{vs|z-sy|n-}|v{Zn\x07]v\x07ryH{vs|z-sy|n-|}npv\bH{vs|z-sy|n-tr|zrvpR|H{vs|z-rp@-z|qryO|{qv{tZn\x07H{vs|z-rp@-z|qryO|{qv{tZv{Hn\bv{t-rpA-d|yq]|vv|{Hn\bv{t-rp@-PnzrnQvrpv|{Hn\bv{t-rp@-P|y|Hn\bv{t-sy|n-]|v{`v	rH0vs-qrsv{rq5b`Rl]\\V[al[\\_ZNY6--n\bv{t-rp@-[|znyH0r{qvs0v{pyqr-Ip|zz|{K0v{pyqr-Is|tl}nlrr\x07K0v{pyqr-Iz|}untrl}nlrr\x07K0v{pyqr-Iy|tqr}uosl}nlrr\x07K0v{pyqr-Ipyv}}v{tl}yn{rl}nlrr\x07Krp@-trP|y|O\bUrvtu5nz}yr?Q-tnqvr{ar\x07r9-rpA-d|yq]|vv|{6-\n--sy|n--J-5d|yq]|vv|{;\b-:-z|qryO|{qv{tZv{;\b6-<-5z|qryO|{qv{tZn\x07;\b-:-z|qryO|{qv{tZv{;\b6H--r{-r\x07r?Q5tnqvr{ar\x07r9-rp?59-=;B66;toH\fZNV[lORS\\_R|vq-znv{56-\n--ZNV[l`aN_a--0v{pyqr-Iortv{lrr\x07K--d|yq]|vv|{-J-rpA5n{s|zrq9->;=6H--0vsqrs-b`RlV[`aN[PV[T----d|yq]|vv|{-J-v{n{prZnv\x07-7-d|yq]|vv|{H--0r{qvs--d|yq]|vv|{-J-z|qryZnv\x07-7-d|yq]|vv|{H--rpA-z]|vv|{-J-vrZnv\x07-7-d|yq]|vv|{H--tyl]|vv|{-J-}|wrpv|{Znv\x07-7-z]|vv|{H--0v{pyqr-Iy|tqr}uoslrr\x07K--0v{pyqr-Ipyv}}v{tl}yn{rlrr\x07K--zn@-pnzrn_|nv|{Znv\x07-J-zn@5vrZnv\x07h=jh=j9-vrZnv\x07h>jh=j9-vrZnv\x07h?jh=j9-vrZnv\x07h=jh>j9-vrZnv\x07h>jh>j9-vrZnv\x07h?jh>j9-vrZnv\x07h=jh?j9-vrZnv\x07h>jh?j9-vrZnv\x07h?jh?j6H--PnzrnQvrpv|{-J-{|znyv	r5pnzrn_|nv|{Znv\x07-7-rp@5=;=9-=;=9-:>;=66H--<<传递nvor的p|y|到s里使用--<<动态调整}|v{`v	r--sy|n-rny]|v{`v	r-J-}|v{`pnyr-7-}v\x07ry_nv|H--0vs-qrsv{rq5b`Rl]\\V[al`VgRlTR\\ZRa_VP6----rny]|v{`v	r-7J-tr|zrvpR|H----sy|n-urvtu-J->;=-<-}|wrpv|{Znv\x07h>jh>j-7-zv\x075>;=9-:z]|vv|{;	9-:}|wrpv|{Znv\x07h?jh@j6-7-?;=H----rny]|v{`v	r-J-r|yv|{;\b-7-rny]|v{`v	r-<-urvtuH--0ryvs-qrsv{rq5b`Rl]\\V[al`VgRlNaaR[bNaV\\[6----sy|n-urvtu-J->;=-<-}|wrpv|{Znv\x07h>jh>j-7-zv\x075>;=9-:z]|vv|{;	9-:}|wrpv|{Znv\x07h?jh@j6-7-?;=H----rny]|v{`v	r-J-r|yv|{;\b-7-rny]|v{`v	r-<-urvtuH--0r{qvs--tyl]|v{`v	r-J-pynz}5rny]|v{`v	r9-}|v{Zv{]v\x07ry-7-}v\x07ry_nv|9-}|v{Zn\x07]v\x07ry-7-}v\x07ry_nv|6H--]|v{`v	r-J-tyl]|v{`v	rH--P|y|-J-p|y|H--<<-JJJ-高度色-JJJ--0vs-qrsv{rq5b`RlP\\Y\\_lNYaVabQR6----P|y|-J-trP|y|O\bUrvtu5tnqvr{ar\x07r9-d|yq]|vv|{6H--0r{qvs--<<-JJJJJJJJJJJ--<<-JJJ-纯色-JJJ--0vs-qrsv{rq5b`RlP\\Y\\_lP\\[`aN[a6----P|y|-J-p|{n{P|y|H--0r{qvs--<<-JJJJJJJJJJJ--0vs-qrsv{rq5b`Rl]\\V[al[\\_ZNY6----[|zny-J-{|znyv	r5zn@5z|qryZnv\x076-7-{|zny6H--0r{qvs--0vs-qrsv{rq5b`RlRQY6----Y|tQr}u-J-y|t?5:z]|vv|{;	6H--0r{qvs--0vs-qrsv{rq5b`RlU^lQR]aU6----<<-sy|n-}|wSnp|-J-:=;B-7-r|yv|{;\b-<-5n{5s|-<-?;=6-7-z]|vv|{;	6H----<<-sy|n-_nqv-J-rny]|v{`v	r-<-}|wSnp|H----sy|n-|vtv{nyQr}u-J-tyl]|vv|{;H----sy|n-nqwrqQr}u-J-|vtv{nyQr}u-8-=;>H----sy|n-nqw-J-nqwrqQr}u-<-|vtv{nyQr}uH----z]|vv|{;\x07\b	-J-z]|vv|{;\x07\b	-7-nqwH----tyl]|vv|{-J-}|wrpv|{Znv\x07-7-z]|vv|{H--0r{qvs--0v{pyqr-I|yq}|lrr\x07K--0v{pyqr-Is|tlrr\x07K--ZNV[lR[Q\f");var pbmUniforms=Object.assign({pointScale:new Uniform(1),pointMinPixel:new Uniform(1),pointMaxPixel:new Uniform(1),opacity:new Uniform(1),gradientTexture:new Uniform(null),modelAlpha:new Uniform(0),clippers:new Uniform([]),shownFloorIndex:new Uniform(-1),constantColor:new Uniform(new Vector3),geometricError:new Uniform(0),pixelRatio:new Uniform(1),resolution:new Uniform(new Vector2(512,512)),floorIndex:new Uniform(0),brightness:new Uniform(1),modelBoundingMin:new Uniform(new Vector3),modelBoundingMax:new Uniform(new Vector3),colorSaturation:new Uniform(0),colorBrightness:new Uniform(0),outlineGain:new Uniform(0),distanceGain:new Uniform(0)},UniformsUtils.clone(UniformsLib.fog)),PBMPointCloudMaterial=function(e){__extends(t,e);function t(r){r===void 0&&(r={});var n,o,s,l,u,c,h,f,m,y,A,M,b,T,_,S,C,P,F,O,N,V,q,Q,z,H,W,J,G=e.call(this,{vertexShader:pointCloudVertexShader,fragmentShader:pointCloudFragmentShader,uniforms:UniformsUtils.clone(pbmUniforms),lights:!1,clipping:!0,defines:{USE_COLOR_CONSTANT:!1,USE_COLOR_ALTITUDE:!1,USE_EDL:!1,USE_HQ_WEIGHT:!1,USE_HQ_DEPTH:!1,NUM_CLIPPING_BOX:!1,USE_CLIPFLOOR:!1,USE_VERTEX_MARK:!1,USE_MAP:!0,USE_UV:!0,USE_LUMINANCE:!1,USE_BLACK_TRANSITION:!1,USE_POINT_NORMAL:!1,USE_POINT_SHAPE_CIRCLE:!1,USE_POINT_SIZE_ATTENUATION:!1,USE_POINT_SIZE_GEOMETRIC:!1,USE_POINT_BACK_HIDDEN:!1,USE_POINT_BACK_DARK:!1}})||this,te;return G.customShaderHash="",G.customShaderUniforms={},G.customShaderDefines={},Object.defineProperties(G,{constantColor:{get:function(){return this.uniforms.constantColor.value},set:function(X){this.uniforms.constantColor.value=X}},opacity:{get:function(){return this.uniforms.opacity.value},set:function(X){this.uniforms.opacity.value=X}},modelAlpha:{get:function(){return this.uniforms.modelAlpha.value},set:function(X){this.uniforms.modelAlpha.value=X}},shownFloorIndex:{get:function(){return this.uniforms.shownFloorIndex.value},set:function(X){this.uniforms.shownFloorIndex.value=X}},clippers:{get:function(){return te},set:function(X){te!==X&&(te=X,this.uniforms.clippers.value=(te||[]).map(function(K){var Z=typeof K.floorIndex=="number"?K.floorIndex:-1,ee=new Matrix4().getInverse(K.clippingBoxMatrix);return{matrixInverse:ee,floorIndex:Z}}),this.needsUpdate=!0)}},colorStyle:{get:function(){return this.defines.USE_COLOR_CONSTANT?"CONSTANT":this.defines.USE_COLOR_ALTITUDE?"ALTITUDE":"RGB"},set:function(X){var K=X==="CONSTANT",Z=X==="ALTITUDE";this.defines.USE_COLOR_CONSTANT!==K&&(this.defines.USE_COLOR_CONSTANT=K,this.needsUpdate=!0),this.defines.USE_COLOR_ALTITUDE!==Z&&(this.defines.USE_COLOR_ALTITUDE=Z,this.needsUpdate=!0)}},pointSize:{get:function(){return this.defines.USE_POINT_SIZE_GEOMETRIC===!0?"GEOMETRIC":this.defines.USE_POINT_SIZE_ATTENUATION===!0?"ATTENUATION":"FIXED"},set:function(X){var K=X==="ATTENUATION",Z=X==="GEOMETRIC";this.defines.USE_POINT_SIZE_GEOMETRIC!==Z&&(this.defines.USE_POINT_SIZE_GEOMETRIC=Z,this.needsUpdate=!0),this.defines.USE_POINT_SIZE_ATTENUATION!==K&&(this.defines.USE_POINT_SIZE_ATTENUATION=K,this.needsUpdate=!0)}},pointShape:{get:function(){return this.defines.USE_POINT_SHAPE_CIRCLE===!0?"CIRCLE":"SQUARE"},set:function(X){var K=X==="CIRCLE";this.defines.USE_POINT_SHAPE_CIRCLE!==K&&(this.defines.USE_POINT_SHAPE_CIRCLE=K,this.needsUpdate=!0)}},pointScale:{get:function(){return this.uniforms.pointScale.value},set:function(X){this.uniforms.pointScale.value=X}},pointBack:{get:function(){return this.defines.USE_POINT_BACK_HIDDEN===!0?"HIDDEN":this.defines.USE_POINT_BACK_DARK===!0?"DARK":"VISIBLE"},set:function(X){var K=X==="HIDDEN",Z=X==="DARK";this.defines.USE_POINT_BACK_HIDDEN!==K&&(this.defines.USE_POINT_BACK_HIDDEN=K,this.needsUpdate=!0),this.defines.USE_POINT_BACK_DARK!==Z&&(this.defines.USE_POINT_BACK_DARK=Z,this.needsUpdate=!0)}},pointMinPixel:{get:function(){return this.uniforms.pointMinPixel.value},set:function(X){this.uniforms.pointMinPixel.value=X}},pointMaxPixel:{get:function(){return this.uniforms.pointMaxPixel.value},set:function(X){this.uniforms.pointMaxPixel.value=X}},useEDL:{get:function(){return this.defines.USE_EDL},set:function(X){X!==this.defines.USE_EDL&&(this.defines.USE_EDL=X,this.needsUpdate=!0)}},useHQWeight:{get:function(){return this.defines.USE_HQ_WEIGHT},set:function(X){X!==this.defines.USE_HQ_WEIGHT&&(this.defines.USE_HQ_WEIGHT=X,this.needsUpdate=!0)}},useHQDepth:{get:function(){return this.defines.USE_HQ_DEPTH},set:function(X){X!==this.defines.USE_HQ_DEPTH&&(this.defines.USE_HQ_DEPTH=X,this.needsUpdate=!0)}},gradientTexture:{get:function(){return this.uniforms.gradientTexture.value},set:function(X){this.uniforms.gradientTexture.value=X}},floorIndex:{get:function(){return this.uniforms.floorIndex.value},set:function(X){this.uniforms.floorIndex.value=X}},brightness:{get:function(){return this.uniforms.brightness.value},set:function(X){this.uniforms.brightness.value=X}},colorSaturation:{get:function(){return this.uniforms.colorSaturation.value},set:function(X){this.uniforms.colorSaturation.value=X}},colorBrightness:{get:function(){return this.uniforms.colorBrightness.value},set:function(X){this.uniforms.colorBrightness.value=X}},outlineGain:{get:function(){return this.uniforms.outlineGain.value},set:function(X){this.uniforms.outlineGain.value=X}},distanceGain:{get:function(){return this.uniforms.distanceGain.value},set:function(X){this.uniforms.distanceGain.value=X}}}),G.pano0=(n=r.pano0)!==null&&n!==void 0?n:defaultPbmParameters.pano0,G.pano1=(o=r.pano1)!==null&&o!==void 0?o:defaultPbmParameters.pano1,G.modelAlpha=(s=r.modelAlpha)!==null&&s!==void 0?s:defaultPbmParameters.modelAlpha,G.progress=(l=r.progress)!==null&&l!==void 0?l:defaultPbmParameters.progress,G.transition=(u=r.transition)!==null&&u!==void 0?u:defaultPbmParameters.transition,G.colorStyle=(c=r.colorStyle)!==null&&c!==void 0?c:defaultPbmParameters.colorStyle,G.constantColor=(h=r.constantColor)!==null&&h!==void 0?h:defaultPbmParameters.constantColor,G.opacity=(f=r.opacity)!==null&&f!==void 0?f:defaultPbmParameters.opacity,G.floorStyle=(m=r.floorStyle)!==null&&m!==void 0?m:defaultPbmParameters.floorStyle,G.shownFloorIndex=(y=r.shownFloorIndex)!==null&&y!==void 0?y:defaultPbmParameters.shownFloorIndex,G.clippers=(A=r.clippers)!==null&&A!==void 0?A:defaultPbmParameters.clippers,G.useEDL=(M=r.useEDL)!==null&&M!==void 0?M:defaultPbmParameters.useEDL,G.useHQWeight=(b=r.useHQWeight)!==null&&b!==void 0?b:defaultPbmParameters.useHQWeight,G.useHQDepth=(T=r.useHQDepth)!==null&&T!==void 0?T:defaultPbmParameters.useHQDepth,G.pointShape=(_=r.pointShape)!==null&&_!==void 0?_:defaultPbmParameters.pointShape,G.pointSize=(S=r.pointSize)!==null&&S!==void 0?S:defaultPbmParameters.pointSize,G.pointScale=(C=r.pointScale)!==null&&C!==void 0?C:defaultPbmParameters.pointScale,G.pointBack=(P=r.pointBack)!==null&&P!==void 0?P:defaultPbmParameters.pointBack,G.pointMinPixel=(F=r.pointMinPixel)!==null&&F!==void 0?F:defaultPbmParameters.pointMinPixel,G.pointMaxPixel=(O=r.pointMaxPixel)!==null&&O!==void 0?O:defaultPbmParameters.pointMaxPixel,G.gradientTexture=(N=r.gradientTexture)!==null&&N!==void 0?N:defaultPbmParameters.gradientTexture,G.brightness=(V=r.brightness)!==null&&V!==void 0?V:defaultPbmParameters.brightness,G.colorSaturation=(q=r.colorSaturation)!==null&&q!==void 0?q:defaultPbmParameters.colorSaturation,G.colorBrightness=(Q=r.colorBrightness)!==null&&Q!==void 0?Q:defaultPbmParameters.colorBrightness,G.outlineGain=(z=r.outlineGain)!==null&&z!==void 0?z:defaultPbmParameters.outlineGain,G.distanceGain=(H=r.distanceGain)!==null&&H!==void 0?H:defaultPbmParameters.distanceGain,G.customShaders=(W=r.customShaders)!==null&&W!==void 0?W:defaultPbmParameters.customShaders,G.useAddBlend=(J=r.useAddBlend)!==null&&J!==void 0?J:defaultPbmParameters.useAddBlend,G.customShaderHash="",G.floorIndex=0,G.transparent=!0,G}return t.prototype.onBeforeCompile=function(r,n){var o,s,l=this.customShaders.filter(function(b){return b.type.includes("pointcloud")}),u=l.reduce(function(b,T){return b+T.vertex.mainBefore},""),c=l.reduce(function(b,T){return b+T.vertex.mainStart},""),h=l.reduce(function(b,T){return b+T.vertex.mainEnd},""),f=l.reduce(function(b,T){return b+T.fragment.mainBefore},""),m=l.reduce(function(b,T){return b+T.fragment.mainStart},""),y=l.reduce(function(b,T){return b+T.fragment.mainModelColor},""),A=l.reduce(function(b,T){return b+T.fragment.mainEnd},"");r.vertexShader=r.vertexShader.replace(/MAIN_BEFORE/g,u),r.fragmentShader=r.fragmentShader.replace(/MAIN_BEFORE/g,f),r.vertexShader=r.vertexShader.replace(/MAIN_START/g,c),r.fragmentShader=r.fragmentShader.replace(/MAIN_START/g,m),r.vertexShader=r.vertexShader.replace(/MAIN_END/g,h),r.fragmentShader=r.fragmentShader.replace(/MAIN_END/g,A),r.fragmentShader=r.fragmentShader.replace(/MAIN_MODEL_COLOR/g,y);var M=String((s=(o=this.clippers)===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0);r.vertexShader=r.vertexShader.replace(/NUM_CLIPPERS/g,M),r.fragmentShader=r.fragmentShader.replace(/NUM_CLIPPERS/g,M),l.forEach(function(b){b.onBeforeCompile(r,n)})},t.prototype.update=function(r,n,o){var s="".concat(o.id,":").concat(o.materialVersion);s!==this.syncModelVersion&&(Object.assign(this,o.getMaterial()),this.syncModelVersion=s);var l=this.customShaders.map(function(_){return _.getHash()}).join("");this.customShaderHash!==l&&(this.customShaderHash=l,this.needsUpdate=!0);for(var u=this.customShaders.reduce(function(_,S){return Object.assign(_,S.defines)},{}),c=Object.keys(this.customShaderDefines),h=0,f=c;h<f.length;h++){var m=f[h];delete this.defines[m]}this.customShaderDefines=u,Object.assign(this.defines,this.customShaderDefines);for(var y=this.customShaders.reduce(function(_,S){return Object.assign(_,S.uniforms)},{}),A=Object.keys(this.customShaderUniforms),M=0,b=A;M<b.length;M++){var T=b[M];delete this.uniforms[T]}this.customShaderUniforms=y,Object.assign(this.uniforms,this.customShaderUniforms),this.visible=!0,this.transparent=!1,this.shownFloorIndex>-1&&(this.transparent=this.shownFloorIndex!==this.floorIndex),this.modelAlpha<1&&(this.transparent=!0),this.opacity<1&&(this.transparent=!0),this.brightness<1&&(this.transparent=!0),this.useAddBlend?(this.depthWrite=!1,this.depthTest=!1,this.blending=AdditiveBlending):(this.depthWrite=!0,this.depthTest=!0,this.blending=NormalBlending),this.useEDL&&(this.transparent=!1),this.useHQWeight?(this.depthWrite=!1,this.blending=CustomBlending,this.blendSrc=SrcAlphaFactor,this.blendSrcAlpha=SrcAlphaFactor,this.blendDst=OneFactor,this.blendDstAlpha=OneFactor):(this.blending=NormalBlending,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null),this.floorStyle==="VISIBILITY"&&this.shownFloorIndex!==-1&&this.floorIndex!==this.shownFloorIndex&&(this.visible=!1),this.uniforms.pixelRatio.value=n.pixelRatio,this.uniforms.resolution.value.copy(n.resolution),this.uniforms.modelBoundingMax.value.copy(o.bounding.max),this.uniforms.modelBoundingMin.value.copy(o.bounding.min)},t.prototype.copy=function(r){return e.prototype.copy.call(this,this),this.customShaders=r.customShaders,this.pano0=r.pano0,this.pano1=r.pano1,this.progress=r.progress,this.transition=r.transition,this.floorStyle=r.floorStyle,this.shownFloorIndex=r.shownFloorIndex,this.brightness=r.brightness,this.clippers=r.clippers,this.constantColor=r.constantColor,this.modelAlpha=r.modelAlpha,this.useEDL=r.useEDL,this.useHQWeight=r.useHQWeight,this.useHQDepth=r.useHQDepth,this.colorStyle=r.colorStyle,this.pointSize=r.pointSize,this.pointShape=r.pointShape,this.pointScale=r.pointScale,this.pointBack=r.pointBack,this.pointMinPixel=r.pointMinPixel,this.pointMaxPixel=r.pointMaxPixel,this.gradientTexture=r.gradientTexture,this.colorSaturation=r.colorSaturation,this.colorBrightness=r.colorBrightness,this.outlineGain=r.outlineGain,this.distanceGain=r.distanceGain,this.useAddBlend=r.useAddBlend,this},t}(ShaderMaterial),InternalWebGLRenderer=function(e){__extends(t,e);function t(r){var n=r.preserveDrawingBuffer,o=n===void 0?!0:n,s=r.premultipliedAlpha,l=s===void 0?!0:s,u=r.stencil,c=u===void 0?!0:u,h=r.backgroundColor,f=h===void 0?1579548:h,m=r.backgroundAlpha,y=m===void 0?1:m,A=r.pixelRatio,M=A===void 0?1:A,b=r.antialias,T=b===void 0?!1:b,_=r.webgl2,S=r.logarithmicDepthBuffer,C=r.precision,P=r.powerPreference,F=this,O={antialias:T,alpha:!0,depth:!0,preserveDrawingBuffer:o,stencil:c,premultipliedAlpha:l,powerPreference:P},N={logarithmicDepthBuffer:S,precision:C};if(_){var V=document.createElement("canvas"),q=V.getContext("webgl2",O);q?F=e.call(this,__assign(__assign(__assign({},O),N),{antialias:!0,canvas:V,context:q}))||this:(console.error("error occurred when getting webgl2 canvas context, mybe webgl2 not support, fallback to webgl."),F=e.call(this,__assign(__assign({},O),N))||this)}else F=e.call(this,__assign(__assign({},O),N))||this;return F.setPixelRatio(M),F.setClearColor(f,y),F.outputEncoding=sRGBEncoding,F.autoClear=!0,F}return t}(WebGLRenderer),Scene=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.add=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.prototype.add.apply(this,r)},t.prototype.remove=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.prototype.remove.apply(this,r)},t}(Scene$1);function coordinatesToVector(e,t){var r=Math.abs(Math.cos(e.latitude)),n=-Math.sin(e.longitude)*r,o=-Math.sin(e.latitude),s=-Math.cos(e.longitude)*r;return t?t.set(n,o,s):new Vector3(n,o,s)}var DEFAULT_ASPECT=1,DEFAULT_NEAR=.1,DEFAULT_FAR=2e3,TAU$2=Math.PI*2,PI_2=Math.PI/2;function formatRad$1(e){return e>0&&e<=TAU$2?e:(e%TAU$2+TAU$2)%TAU$2}function matrixLerp(e,t,r,n){r=Math.pow(r,4);for(var o=0;o<16;o++)n.elements[o]=e.elements[o]+(t.elements[o]-e.elements[o])*r;return n}var Camera=function(e){__extends(t,e);function t(r,n,o,s,l,u,c){n===void 0&&(n=DEFAULT_ASPECT),o===void 0&&(o=DEFAULT_NEAR),s===void 0&&(s=DEFAULT_FAR),l===void 0&&(l=new Vector2),u===void 0&&(u=new Vector2(512,512)),c===void 0&&(c=1);var h=e.call(this)||this;h.fov=r,h.aspect=n,h.near=o,h.far=s,h.perspToOrtho=l,h.resolution=u,h.pixelRatio=c,h.time=0,h.needsRender=!0,h.refineModel=!0,h.pose={longitude:0,latitude:0,fov:r,distance:0,offset:new Vector3},h.computePose(),h.perspectiveCamera=new PerspectiveCamera(h.fov,h.aspect,.001,h.far);var f=Math.max(h.orthoDistance,.01)*Math.tan(.5*h.fov/180*Math.PI),m=-.5*h.aspect*2*f;return h.orthographicCamera=new OrthographicCamera(m,-m,f,-f,.001,h.far),h.computeProjectionMatrix(),h.lastValues={position:h.position.clone(),quaternion:h.quaternion.clone(),scale:h.scale.clone(),fov:h.fov,aspect:h.aspect,near:h.near,far:h.far,orthoDistance:h.orthoDistance,perspToOrtho:h.perspToOrtho.clone()},h.type=h.perspToOrtho.x<1?"PerspectiveCamera":"OrthographicCamera",h.autoNearFar=!0,h.environment=null,h}return Object.defineProperty(t.prototype,"orthoDistance",{get:function(){return this.pose.distance>1?this.pose.distance:1+(this.pose.distance-1)*this.perspToOrtho.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zoom",{get:function(){return this.type==="OrthographicCamera"?this.orthographicCamera.zoom:this.type==="PerspectiveCamera"?this.perspectiveCamera.zoom:1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.type==="OrthographicCamera"?this.orthographicCamera.top:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.type==="OrthographicCamera"?this.orthographicCamera.bottom:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.type==="OrthographicCamera"?this.orthographicCamera.left:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.type==="OrthographicCamera"?this.orthographicCamera.right:0},enumerable:!1,configurable:!0}),t.prototype.getDirection=function(r){return coordinatesToVector(this.pose,r)},t.prototype.computePose=function(r){r===void 0&&(r=0),this.updateMatrix();var n=this.matrix.elements;return this.pose.latitude=Math.asin(clamp$1(n[9],-1,1)),Math.abs(n[9])<.9999999?this.pose.longitude=formatRad$1(Math.atan2(n[8],n[10])):this.pose.longitude=formatRad$1(Math.atan2(-n[2],n[0])),this.pose.fov=this.fov,this.pose.distance=r,this.pose.offset=new Vector3(-n[8],-n[9],-n[10]).setLength(this.pose.distance).add(this.position),this},t.prototype.setFromPose=function(r){var n,o,s,l,u,c=formatRad$1((n=r.longitude)!==null&&n!==void 0?n:this.pose.longitude),h=Math.max(-PI_2+1e-4,Math.min(PI_2-1e-4,(o=r.latitude)!==null&&o!==void 0?o:this.pose.latitude)),f=(s=r.fov)!==null&&s!==void 0?s:this.pose.fov,m=(l=r.distance)!==null&&l!==void 0?l:this.pose.distance,y=(u=r.offset)!==null&&u!==void 0?u:this.pose.offset,A=coordinatesToVector({longitude:c,latitude:h}).normalize();return this.position.set(0,0,0),this.lookAt(A),this.position.add(y).sub(A.clone().setLength(m)),this.fov!==f&&(this.fov=f,this.updateProjectionMatrix()),this.updateMatrixWorld(!0),this.pose.longitude=c,this.pose.latitude=h,this.pose.fov=f,this.pose.distance=m,this.pose.offset.copy(y),this.needsRender=!0,this},t.prototype.copyPose=function(){return{longitude:this.pose.longitude,latitude:this.pose.latitude,fov:this.pose.fov,distance:this.pose.distance,offset:this.pose.offset.clone()}},t.prototype.computeProjectionMatrix=function(){matrixLerp(this.orthographicCamera.projectionMatrix,this.perspectiveCamera.projectionMatrix,1-this.perspToOrtho.x,this.projectionMatrix),this.projectionMatrixInverse.getInverse(this.projectionMatrix),this.needsRender=!0},t.prototype.setViewOffset=function(r,n,o,s,l,u){this.perspectiveCamera.setViewOffset(r,n,o,s,l,u),this.orthographicCamera.setViewOffset(r,n,o,s,l,u),this.computeProjectionMatrix()},t.prototype.clearViewOffset=function(){this.perspectiveCamera.clearViewOffset(),this.orthographicCamera.clearViewOffset(),this.computeProjectionMatrix()},t.prototype.updateProjectionMatrix=function(){this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.updateProjectionMatrix(),this.computeProjectionMatrix()},Object.defineProperty(t.prototype,"perspectiveProjectionMatrix",{get:function(){return this.perspectiveCamera.projectionMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"perspectiveProjectionMatrixInverse",{get:function(){return this.perspectiveCamera.projectionMatrixInverse},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orthographicProjectionMatrix",{get:function(){return this.orthographicCamera.projectionMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orthographicProjectionMatrixInverse",{get:function(){return this.orthographicCamera.projectionMatrixInverse},enumerable:!1,configurable:!0}),t.prototype.updateTime=function(r){this.time=r;var n=!1;if((this.lastValues.fov!==this.fov||this.lastValues.near!==this.near||this.lastValues.far!==this.far||this.lastValues.aspect!==this.aspect)&&(this.perspectiveCamera.fov=this.fov,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.updateProjectionMatrix(),n=!0),!this.lastValues.position.equals(this.position)||!this.lastValues.quaternion.equals(this.quaternion)||!this.lastValues.scale.equals(this.scale)||!this.lastValues.perspToOrtho.equals(this.perspToOrtho)||this.lastValues.fov!==this.fov||this.lastValues.near!==this.near||this.lastValues.far!==this.far||this.lastValues.orthoDistance!==this.orthoDistance||this.lastValues.aspect!==this.aspect){var o=Math.max(this.orthoDistance,.01)*Math.tan(.5*this.fov/180*Math.PI),s=-.5*this.aspect*2*o;this.orthographicCamera.left=s,this.orthographicCamera.right=-s,this.orthographicCamera.top=o,this.orthographicCamera.bottom=-o,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),n=!0}n&&this.computeProjectionMatrix(),this.lastValues.position.copy(this.position),this.lastValues.quaternion.copy(this.quaternion),this.lastValues.scale.copy(this.scale),this.lastValues.fov=this.fov,this.lastValues.aspect=this.aspect,this.lastValues.near=this.near,this.lastValues.far=this.far,this.lastValues.orthoDistance=this.orthoDistance,this.lastValues.perspToOrtho.copy(this.perspToOrtho),this.type=this.perspToOrtho.x<1?"PerspectiveCamera":"OrthographicCamera"},Object.defineProperty(t.prototype,"isPerspectiveCamera",{get:function(){return this.perspToOrtho.x<1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOrthographicCamera",{get:function(){return this.perspToOrtho.x>=1},enumerable:!1,configurable:!0}),t.prototype.copy=function(r,n){return e.prototype.copy.call(this,r,n),this.fov=r.fov,this.aspect=r.aspect,this.near=r.near,this.far=r.far,this.perspToOrtho.copy(r.perspToOrtho),this.updateTime(now()),this},t}(Camera$1),VolumePlaneIntersect;(function(e){e[e.Outside=-1]="Outside",e[e.Intersecting=0]="Intersecting",e[e.Inside=1]="Inside"})(VolumePlaneIntersect||(VolumePlaneIntersect={}));var EPSILON$2=1e-6,scratchVector=new Vector3,scratchMatrix4$4=new Matrix4,scratchXAxis=new Vector3,scratchYAxis=new Vector3,scratchZAxis=new Vector3,scratchSize=new Vector3,scratchBox3=new Box3,scratchSphere$1=new Sphere,scratchMatrix4Inverse$1=new Matrix4,scratchRay$1=new Ray,scratchObject3D=new Object3D,scratchFrustum=new Frustum;function quaternionFromMatrix3(e,t){var r=e.elements;return t.setFromRotationMatrix(scratchMatrix4$4.set(r[0],r[3],r[6],0,r[1],r[4],r[7],0,r[2],r[5],r[8],0,0,0,0,1)),t}var CullingVolume=function(){function e(t){t===void 0&&(t=[]),this.planes=t}return Object.defineProperty(e,"MASK_OUTSIDE",{get:function(){return 4294967295},enumerable:!1,configurable:!0}),Object.defineProperty(e,"MASK_INSIDE",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e,"MASK_INDETERMINATE",{get:function(){return 2147483647},enumerable:!1,configurable:!0}),e.prototype.setFromFrustum=function(t){return this.planes=t.planes.map(function(r){return r.clone()}),this},e.prototype.setFromCamera=function(t){return scratchMatrix4$4.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),scratchFrustum.setFromProjectionMatrix(scratchMatrix4$4),this.setFromFrustum(scratchFrustum),this},e.prototype.applyMatrix4=function(t){for(var r=0,n=this.planes;r<n.length;r++){var o=n[r];o.applyMatrix4(t)}},e.prototype.copy=function(t){return this.planes=t.planes.map(function(r){return r.clone()}),this},e.prototype.clone=function(){return new e().copy(this)},e.prototype.computeVisibility=function(t){for(var r=VolumePlaneIntersect.Inside,n=0,o=this.planes;n<o.length;n++){var s=o[n],l=t.intersectPlane(s);switch(l){case VolumePlaneIntersect.Outside:return VolumePlaneIntersect.Outside;case VolumePlaneIntersect.Intersecting:r=VolumePlaneIntersect.Intersecting;break}}return r},e.prototype.computeVisibilityWithPlaneMask=function(t,r){if(r===e.MASK_OUTSIDE||r===e.MASK_INSIDE)return r;for(var n=e.MASK_INSIDE,o=Math.min(32,this.planes.length),s=0;s<o;++s){var l=1<<s;if(r&l){var u=this.planes[s],c=t.intersectPlane(u);if(c===VolumePlaneIntersect.Outside)return e.MASK_OUTSIDE;c===VolumePlaneIntersect.Intersecting&&(n|=l)}}return n},e}(),BoxBoundingVolume=function(){function e(){this.type="box",this.center=new Vector3,this.halfSize=new Vector3,this.rotation=new Matrix3}return e.prototype.fromJson=function(t){var r=t.box;this.center.set(r[0],r[1],r[2]);var n=r[3],o=r[4],s=r[5],l=r[6],u=r[7],c=r[8],h=r[9],f=r[10],m=r[11],y=Math.max(Math.sqrt(n*n+o*o+s*s),.001),A=Math.max(Math.sqrt(l*l+u*u+c*c),.001),M=Math.max(Math.sqrt(h*h+f*f+m*m),.001);this.halfSize.set(y,A,M);var b=this.halfSize.toArray().reduce(function(T,_){return T+_},0);return(isNaN(b)||b<=0)&&this.halfSize.setScalar(EPSILON$2),this.rotation.fromArray([n/y,o/y,s/y,l/A,u/A,c/A,h/M,f/M,m/M]),isNaN(this.rotation.toArray().reduce(function(T,_){return T+_},0))&&this.rotation.identity(),this},e.prototype.toJson=function(){return this.rotation.extractBasis(scratchXAxis,scratchYAxis,scratchZAxis),{box:__spreadArray(__spreadArray(__spreadArray(__spreadArray([],this.center.toArray(),!0),scratchXAxis.multiplyScalar(this.halfSize.x).toArray(),!0),scratchYAxis.multiplyScalar(this.halfSize.y).toArray(),!0),scratchZAxis.multiplyScalar(this.halfSize.z).toArray(),!0)}},e.prototype.copy=function(t){return this.center.copy(t.center),this.halfSize.copy(t.halfSize),this.rotation.copy(t.rotation),this},e.prototype.clone=function(){return new e().copy(this)},e.prototype.applyMatrix4=function(t){return scratchObject3D.position.copy(this.center),quaternionFromMatrix3(this.rotation,scratchObject3D.quaternion),scratchObject3D.scale.copy(this.halfSize),scratchObject3D.matrix.compose(scratchObject3D.position,scratchObject3D.quaternion,scratchObject3D.scale),scratchObject3D.matrix.premultiply(t),scratchObject3D.matrix.decompose(scratchObject3D.position,scratchObject3D.quaternion,scratchObject3D.scale),this.center.copy(scratchObject3D.position),this.rotation.setFromMatrix4(scratchMatrix4$4.makeRotationFromQuaternion(scratchObject3D.quaternion)),this.halfSize.copy(scratchObject3D.scale),this},e.prototype.getCenter=function(t){return t.copy(this.center)},e.prototype.distanceSquaredToPoint=function(t){var r=this.rotation.elements,n=t.x-this.center.x,o=t.y-this.center.y,s=t.z-this.center.z,l=0,u;return u=n*r[0]+o*r[1]+s*r[2],u<0&&(u=-u),u-=this.halfSize.x,u>0&&(l+=u*u),u=n*r[3]+o*r[4]+s*r[5],u<0&&(u=-u),u-=this.halfSize.y,u>0&&(l+=u*u),u=n*r[6]+o*r[7]+s*r[8],u<0&&(u=-u),u-=this.halfSize.z,u>0&&(l+=u*u),l},e.prototype.distanceToPoint=function(t){return Math.sqrt(this.distanceSquaredToPoint(t))},e.prototype.distanceToPlane=function(t){var r=t.projectPoint(this.center,new Vector3);return this.distanceToPoint(r)},e.prototype.getBoundingBox=function(t){return t.makeEmpty(),this.rotation.extractBasis(scratchXAxis,scratchYAxis,scratchZAxis),scratchXAxis.setLength(this.halfSize.x),scratchYAxis.setLength(this.halfSize.y),scratchZAxis.setLength(this.halfSize.z),t.expandByPoint(scratchVector.copy(this.center).add(scratchXAxis)),t.expandByPoint(scratchVector.copy(this.center).sub(scratchXAxis)),t.expandByPoint(scratchVector.copy(this.center).add(scratchYAxis)),t.expandByPoint(scratchVector.copy(this.center).sub(scratchYAxis)),t.expandByPoint(scratchVector.copy(this.center).add(scratchZAxis)),t.expandByPoint(scratchVector.copy(this.center).sub(scratchZAxis)),t},e.prototype.toGeometry=function(){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3);scratchVector.set(this.halfSize.x,this.halfSize.y,this.halfSize.z).applyMatrix3(this.rotation).add(this.center).toArray(r,0),scratchVector.set(-this.halfSize.x,this.halfSize.y,this.halfSize.z).applyMatrix3(this.rotation).add(this.center).toArray(r,3),scratchVector.set(-this.halfSize.x,-this.halfSize.y,this.halfSize.z).applyMatrix3(this.rotation).add(this.center).toArray(r,6),scratchVector.set(this.halfSize.x,-this.halfSize.y,this.halfSize.z).applyMatrix3(this.rotation).add(this.center).toArray(r,9),scratchVector.set(this.halfSize.x,this.halfSize.y,-this.halfSize.z).applyMatrix3(this.rotation).add(this.center).toArray(r,12),scratchVector.set(-this.halfSize.x,this.halfSize.y,-this.halfSize.z).applyMatrix3(this.rotation).add(this.center).toArray(r,15),scratchVector.set(-this.halfSize.x,-this.halfSize.y,-this.halfSize.z).applyMatrix3(this.rotation).add(this.center).toArray(r,18),scratchVector.set(this.halfSize.x,-this.halfSize.y,-this.halfSize.z).applyMatrix3(this.rotation).add(this.center).toArray(r,21);var n=new BufferGeometry;return n.setIndex(new BufferAttribute(t,1)),n.setAttribute("position",new BufferAttribute(r,3)),n.computeBoundingBox(),n.computeBoundingSphere(),n},e.prototype.intersectPlane=function(t){var r=this.center,n=t.normal,o=this.rotation.elements,s=this.halfSize,l=n.x,u=n.y,c=n.z,h=Math.abs(l*o[0]*s.x+u*o[1]*s.x+c*o[2]*s.x)+Math.abs(l*o[3]*s.y+u*o[4]*s.y+c*o[5]*s.y)+Math.abs(l*o[6]*s.z+u*o[7]*s.z+c*o[8]*s.z),f=n.dot(r)+t.constant;return f<=-h?VolumePlaneIntersect.Outside:f>=h?VolumePlaneIntersect.Inside:VolumePlaneIntersect.Intersecting},e.prototype.intersectRay=function(t,r){if(scratchSize.copy(this.halfSize).multiplyScalar(2),scratchBox3.setFromCenterAndSize(scratchVector.set(0,0,0),scratchSize),this.rotation.extractBasis(scratchXAxis,scratchYAxis,scratchZAxis),scratchMatrix4$4.makeBasis(scratchXAxis,scratchYAxis,scratchZAxis),scratchMatrix4$4.setPosition(this.center),scratchMatrix4Inverse$1.getInverse(scratchMatrix4$4),scratchRay$1.copy(t).applyMatrix4(scratchMatrix4Inverse$1),scratchBox3.containsPoint(scratchRay$1.origin))return!0;var n=scratchRay$1.intersectBox(scratchBox3,scratchVector);return n?r!==void 0?n.applyMatrix4(scratchMatrix4$4).distanceTo(t.origin)<r:!0:!1},e}(),SphereBoundingVolume=function(){function e(){this.type="sphere",this.center=new Vector3,this.radius=-1}return e.prototype.fromJson=function(t){var r=t.sphere;return this.center.set(r[0],r[1],r[2]),this.radius=Math.max(r[3],EPSILON$2),this},e.prototype.toJson=function(){return{sphere:__spreadArray(__spreadArray([],this.center.toArray(),!0),[this.radius],!1)}},e.prototype.copy=function(t){return this.center.copy(t.center),this.radius=t.radius,this},e.prototype.clone=function(){return new e().copy(this)},e.prototype.getBoundingBox=function(t){return t.setFromCenterAndSize(this.center,scratchSize.set(1,1,1).multiplyScalar(this.radius*2)),t},e.prototype.toGeometry=function(){for(var t=32,r=new Float32Array(t*3*2*2),n=0;n<=t;n++){var o=0;o=n/t*Math.PI*2,r[n*6+0]=this.center.x+Math.cos(o)*this.radius,r[n*6+1]=this.center.y+Math.sin(o)*this.radius,r[n*6+2]=this.center.z+0,o=(n+1)/t*Math.PI*2,r[n*6+3]=this.center.x+Math.cos(o)*this.radius,r[n*6+4]=this.center.y+Math.sin(o)*this.radius,r[n*6+5]=this.center.z+0}for(var n=t;n<=t*2;n++){var o=0;o=n/t*Math.PI*2,r[n*6+0]=this.center.x+Math.cos(o)*this.radius,r[n*6+1]=this.center.y+0,r[n*6+2]=this.center.z+Math.sin(o)*this.radius,o=(n+1)/t*Math.PI*2,r[n*6+3]=this.center.x+Math.cos(o)*this.radius,r[n*6+4]=this.center.y+0,r[n*6+5]=this.center.z+Math.sin(o)*this.radius}var s=new BufferGeometry;return s.setAttribute("position",new BufferAttribute(r,3)),s.computeBoundingBox(),s.computeBoundingSphere(),s},e.prototype.applyMatrix4=function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},e.prototype.getCenter=function(t){return t.copy(this.center)},e.prototype.distanceSquaredToPoint=function(t){var r=this.distanceToPoint(t);return r*r},e.prototype.distanceToPoint=function(t){var r=this.center.distanceTo(t)-this.radius;return r<=0?0:r},e.prototype.distanceToPlane=function(t){var r=Math.abs(t.distanceToPoint(this.center));return Math.max(0,r-this.radius)},e.prototype.intersectPlane=function(t){var r=this.center,n=this.radius,o=t.normal,s=o.dot(r)+t.constant;return s<-n?VolumePlaneIntersect.Outside:s<n?VolumePlaneIntersect.Intersecting:VolumePlaneIntersect.Inside},e.prototype.intersectRay=function(t,r){if(scratchSphere$1.set(this.center,this.radius),scratchSphere$1.containsPoint(t.origin))return!0;var n=t.intersectSphere(scratchSphere$1,scratchVector);return n?r!==void 0?t.origin.distanceTo(n)<r:!0:!1},e}(),RegionBoundingVolume=function(){function e(){throw this.type="regin",this.west=0,this.south=0,this.east=0,this.north=0,this.minHeight=0,this.maxHeight=0,new Error("Region bounding volume not supported.")}return e.prototype.fromJson=function(t){var r=t.region;return this.west=r[0],this.south=r[1],this.east=r[2],this.north=r[3],this.minHeight=r[4],this.maxHeight=r[5],this},e.prototype.toJson=function(){return{region:[this.west,this.south,this.east,this.north,this.minHeight,this.maxHeight]}},e.prototype.copy=function(t){return this.west=t.west,this.south=t.south,this.east=t.east,this.north=t.north,this.minHeight=t.minHeight,this.maxHeight=t.maxHeight,this},e.prototype.clone=function(){return new e().copy(this)},e.prototype.getBoundingBox=function(t){throw new Error("not implemented")},e.prototype.toGeometry=function(){throw new Error("not implemented")},e.prototype.applyMatrix4=function(t){throw new Error("not implemented")},e.prototype.getCenter=function(t){throw new Error("not implemented")},e.prototype.distanceToPoint=function(t){throw new Error("not implemented")},e.prototype.distanceSquaredToPoint=function(t){throw new Error("not implemented")},e.prototype.distanceToPlane=function(t){throw new Error("not implemented")},e.prototype.intersectPlane=function(t){throw new Error("not implemented")},e.prototype.intersectRay=function(t){throw new Error("not implemented")},e}();function isBoundingVolume(e){return e instanceof BoxBoundingVolume||e instanceof SphereBoundingVolume||e instanceof RegionBoundingVolume}function makeBoundingVolume(e){if("box"in e)return new BoxBoundingVolume().fromJson(e);if("sphere"in e)return new SphereBoundingVolume().fromJson(e);if("region"in e)return new RegionBoundingVolume().fromJson(e);throw new Error("BoundingVolume ".concat(JSON.stringify(e)," never suppored."))}var debugMaterials=[4821759,8191922,16637280,16739958,5822969,376977,16747077,9259235,14514687].map(function(e){return new LineBasicMaterial({color:e,depthWrite:!1,depthTest:!1,transparent:!0})}),debugBoxGeometry=function(){var e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),t=new Float32Array(8*3);scratchVector.set(1,1,1).toArray(t,0),scratchVector.set(-1,1,1).toArray(t,3),scratchVector.set(-1,-1,1).toArray(t,6),scratchVector.set(1,-1,1).toArray(t,9),scratchVector.set(1,1,-1).toArray(t,12),scratchVector.set(-1,1,-1).toArray(t,15),scratchVector.set(-1,-1,-1).toArray(t,18),scratchVector.set(1,-1,-1).toArray(t,21);var r=new BufferGeometry;return r.setIndex(new BufferAttribute(e,1)),r.setAttribute("position",new BufferAttribute(t,3)),r.computeBoundingBox(),r.computeBoundingSphere(),r}(),debugSphereGeometry=function(){for(var e=32,t=new Float32Array(e*3*2*2),r=0;r<=e;r++){var n=0;n=r/e*Math.PI*2,t[r*6+0]=Math.cos(n),t[r*6+1]=Math.sin(n),t[r*6+2]=0,n=(r+1)/e*Math.PI*2,t[r*6+3]=Math.cos(n),t[r*6+4]=Math.sin(n),t[r*6+5]=0}for(var r=e;r<=e*2;r++){var n=0;n=r/e*Math.PI*2,t[r*6+0]=Math.cos(n),t[r*6+1]=0,t[r*6+2]=Math.sin(n),n=(r+1)/e*Math.PI*2,t[r*6+3]=Math.cos(n),t[r*6+4]=0,t[r*6+5]=Math.sin(n)}var o=new BufferGeometry;return o.setAttribute("position",new BufferAttribute(t,3)),o.computeBoundingBox(),o.computeBoundingSphere(),o}();function createDebugBoundingMesh(e,t){if(e instanceof BoxBoundingVolume){var r=new LineSegments(debugBoxGeometry,debugMaterials[Math.min(t,debugMaterials.length-1)]);return r.position.copy(e.center),quaternionFromMatrix3(e.rotation,r.quaternion),r.scale.set(e.halfSize.x,e.halfSize.y,e.halfSize.z),r.matrix.compose(r.position,r.quaternion,r.scale),r}else if(e instanceof SphereBoundingVolume){var r=new LineSegments(debugSphereGeometry,debugMaterials[Math.min(t,debugMaterials.length-1)]);return r.position.copy(e.center),r.scale.set(e.radius,e.radius,e.radius),r.matrix.compose(r.position,r.quaternion,r.scale),r}throw new Error("never")}var scratchVector3$4=new Vector3,Tile=function(){function e(t,r,n,o){var s=this,l,u,c,h;this.parent=null,this.contentParent=null,this.floor=0,this.id=t,this.state={visible:!1,frameNumber:0,selectedFrameNumber:0,requestedFrameNumber:0,touchedFrameNumber:0,distanceToCamera:0,centerZDepth:0,centerScreenY:0,screenSpaceError:0,visibilityPlaneMask:0,inRequestVolume:!1,shouldRefine:!1,stackLength:0,finalResolution:!0,selectionDepth:0,shouldSelect:!1,lastSelect:!1,ancestorWithContent:null,ancestorWithContentAvailable:null},this.parent=o??null,this.contentParent=o?o.hasRenderContent?o:o.contentParent:null,this.level=this.parent?this.parent.level+1:0,this.tileset=n,this.refine=(l=r.refine)!==null&&l!==void 0?l:this.parent?this.parent.refine:"REPLACE",this.transform=new Matrix4,r.transform&&this.transform.fromArray(r.transform),this.parent&&this.transform.premultiply(this.parent.transform),typeof r.geometricError=="number"?this.geometricError=r.geometricError*this.transform.getMaxScaleOnAxis():this.geometricError=(c=(u=this.parent)===null||u===void 0?void 0:u.geometricError)!==null&&c!==void 0?c:0,r.content&&r.content.uri?(this.content={uri:r.content.uri,loadState:"UNLOADED",loadStateUpdateTime:now(),loadfailRetryDelay:0,byteLength:0,memoryUsage:0},r.content.group!==void 0&&(this.content.group=r.content.group),r.content.boundingVolume&&(this.content.boundingVolume=makeBoundingVolume(r.content.boundingVolume).applyMatrix4(this.transform)),/\.json$/.test(this.content.uri)?this.type="TILESET":this.type="SCENEGRAPH"):(this.content=null,this.type="EMPTY"),this.levelOfContent=this.parent?this.parent.levelOfContent:-1,this.type==="SCENEGRAPH"&&(this.levelOfContent=this.levelOfContent+1),r.boundingVolume&&(this.boundingVolume=makeBoundingVolume(r.boundingVolume).applyMatrix4(this.transform)),r.viewerRequestVolume&&(this.viewerRequestVolume=makeBoundingVolume(r.viewerRequestVolume).applyMatrix4(this.transform)),this.extras=(h=r.extras)!==null&&h!==void 0?h:{},typeof this.extras.floor!="number"&&o&&typeof o.extras.floor=="number"&&(this.extras.floor=o.extras.floor),typeof this.extras.floor=="number"&&(this.floor=this.extras.floor,this.tileset.floorLength=Math.max(this.tileset.floorLength,this.floor+1)),this.boundingVolume&&(this.boundingVolumeDebugObject=createDebugBoundingMesh(this.boundingVolume,this.levelOfContent)),r.children?this.children=r.children.map(function(f,m){return new e("".concat(s.id,".").concat(m),f,n,s)}):this.children=[]}return e.prototype.traverse=function(t){t(this);for(var r=0,n=this.children;r<n.length;r++){var o=n[r];o.traverse(t)}},e.prototype.updateState=function(t){this.state.frameNumber=t.frameNumber;var r=this.tileset.transformIsIdentity?null:this.tileset.transform;if(this.boundingVolume){var n=r?this.boundingVolume.clone().applyMatrix4(r):this.boundingVolume;if(t.camera.type==="OrthographicCamera"){var o=new Plane().setFromNormalAndCoplanarPoint(t.camera.direction,t.camera.position);this.state.distanceToCamera=n.distanceToPlane(o)}else this.state.distanceToCamera=n.distanceToPoint(t.camera.position);var s=n.getCenter(scratchVector3$4).sub(t.camera.position);this.state.centerZDepth=t.camera.direction.dot(s),this.state.centerScreenY=t.camera.up.dot(s);var l=this.parent?this.parent.state.visibilityPlaneMask:CullingVolume.MASK_INDETERMINATE;this.state.visibilityPlaneMask=t.cullingVolume.computeVisibilityWithPlaneMask(n,l),this.state.visible=this.state.visibilityPlaneMask!==CullingVolume.MASK_OUTSIDE}else this.state.distanceToCamera=0,this.state.centerZDepth=0,this.state.visibilityPlaneMask=CullingVolume.MASK_INDETERMINATE,this.state.visible=!0;if((this.levelOfContent<=t.minLevelOfDetail||this.geometricError>=t.maxGeometricError)&&(this.state.visible=!0),this.viewerRequestVolume){var u=r?this.viewerRequestVolume.clone().applyMatrix4(r):this.viewerRequestVolume;this.state.inRequestVolume=u.distanceSquaredToPoint(t.camera.position)<=0}else this.state.inRequestVolume=!0;this.state.screenSpaceError=this.getScreenSpaceError(t,this.state.distanceToCamera,!1)},Object.defineProperty(e.prototype,"selected",{get:function(){return this.state.selectedFrameNumber===this.tileset.frameNumber},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasChildren",{get:function(){return this.children.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"siblingIndex",{get:function(){var t,r;return(r=(t=this.parent)===null||t===void 0?void 0:t.children.indexOf(this))!==null&&r!==void 0?r:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasTilesetContent",{get:function(){return this.children.length>0&&this.type==="TILESET"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRenderContent",{get:function(){return this.type==="SCENEGRAPH"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentAvailable",{get:function(){var t;return this.hasRenderContent&&((t=this.content)===null||t===void 0?void 0:t.loadState)==="READY"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasUnloadedContent",{get:function(){var t;return((t=this.content)===null||t===void 0?void 0:t.loadState)==="UNLOADED"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasEmptyContent",{get:function(){return this.type==="EMPTY"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentReady",{get:function(){var t;return((t=this.content)===null||t===void 0?void 0:t.loadState)==="READY"||this.hasEmptyContent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentByteLength",{get:function(){return this.content?this.content.byteLength:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentMemoryUsage",{get:function(){return this.content?this.content.memoryUsage:0},enumerable:!1,configurable:!0}),e.prototype.getScreenSpaceError=function(t,r,n){var o=this.tileset.transformIsIdentity?1:this.tileset.transform.getMaxScaleOnAxis(),s=this.parent?this.parent.geometricError:this.tileset.geometricError,l=o*(n?s:this.geometricError);if(l===0)return 0;var u=t.height,c=t.sseDenominator;if(t.camera.type==="OrthographicCamera"){var h=t.camera.projectionMatrix.elements,f=1/(h[5]/2),m=.9,y=f/u*m,A=l/y;return A}else{var M=Math.max(r,.001),y=M*c/u,A=l/y;return A}},e.prototype.getPriority=function(){var t=this.refine==="ADD"||this.tileset.skipLevelOfDetail;if(t&&!this.state.visible||this.tileset.frameNumber-this.state.touchedFrameNumber>=1)return-1;var r=this.parent,n=r&&(!t||this.state.screenSpaceError===0),o=n?r.state.screenSpaceError:this.state.screenSpaceError,s=this.tileset.root?this.tileset.root.state.screenSpaceError:0,l=Math.max(s-o,0);return l},e}(),priorityCache=new Map;function getPriority(e,t){if(t&&t.has(e))return t.get(e);var r=e.refine==="ADD"||e.tileset.skipLevelOfDetail,n=e.parent,o=n&&(!r||e.state.screenSpaceError===0),s=o?n.state.screenSpaceError:e.state.screenSpaceError,l=e.tileset.root?e.tileset.root.state.screenSpaceError:0,u=Math.max(l-s,0);return t&&t.set(e,u),u}var TileRequestScheduler=function(){function e(t,r){this.tileset=t,this.options=r,this.activeRequests=0,this.requestQueue=[]}return e.prototype.reset=function(){for(var t=0,r=this.requestQueue;t<r.length;t++){var n=r[t];this.options.onTileSkip&&this.options.onTileSkip(n.tile)}this.requestQueue.length=0},e.prototype.update=function(t,r,n){for(var o=this,s=n.time,l=this.requestQueue,u=new Set(t),c=0;c<l.length;c++){var h=l[c];if(u.has(h.tile)){u.delete(h.tile);continue}h.status==="WAITING"&&(l.splice(c,1),c--,this.options.onTileSkip&&this.options.onTileSkip(h.tile))}u.size>0&&(u.forEach(function(_){l.push({tile:_,status:"WAITING",time:s,error:null})}),u.clear());for(var f=this.tileset.maxRequests,c=0;c<l.length&&f>0;c++){var h=l[c];if(h.status==="DONE")h.error!==null?this.options.onTileError&&this.options.onTileError(h.tile,h.error):(f--,h.tile.content&&(h.tile.content.loadState="READY"),this.options.onTileLoad&&this.options.onTileLoad(h.tile)),l.splice(c,1),c--;else if(h.status==="PENDING"&&s-h.time<1e3)break}switch(priorityCache.clear(),r){case"SCREEN_SPACE_ERROR":{l.sort(function(_,S){if(_.tile.state.requestedFrameNumber!==S.tile.state.requestedFrameNumber)return S.tile.state.requestedFrameNumber-_.tile.state.requestedFrameNumber;if(_.tile.state.requestedFrameNumber===n.frameNumber){var C=getPriority(_.tile,priorityCache),P=getPriority(S.tile,priorityCache);return C-P}else return _.tile.level!==S.tile.level?_.tile.level-S.tile.level:_.tile.state.distanceToCamera-S.tile.state.distanceToCamera});break}case"SCREEN_VERTICAL":{l.sort(function(_,S){return _.tile.state.requestedFrameNumber!==S.tile.state.requestedFrameNumber?S.tile.state.requestedFrameNumber-_.tile.state.requestedFrameNumber:_.tile.state.requestedFrameNumber===n.frameNumber?_.tile.state.centerScreenY!==S.tile.state.centerScreenY?_.tile.state.centerScreenY-S.tile.state.centerScreenY:_.tile.state.centerZDepth!==S.tile.state.centerZDepth?_.tile.state.centerZDepth-S.tile.state.centerZDepth:_.tile.level!==S.tile.level?_.tile.level-S.tile.level:_.tile.state.distanceToCamera-S.tile.state.distanceToCamera:_.tile.level!==S.tile.level?_.tile.level-S.tile.level:_.tile.state.distanceToCamera-S.tile.state.distanceToCamera});break}case"SCREEN_LEVEL_VERTICAL":{l.sort(function(_,S){return _.tile.state.requestedFrameNumber!==S.tile.state.requestedFrameNumber?S.tile.state.requestedFrameNumber-_.tile.state.requestedFrameNumber:_.tile.state.requestedFrameNumber===n.frameNumber?_.tile.level!==S.tile.level?_.tile.level-S.tile.level:_.tile.state.centerScreenY!==S.tile.state.centerScreenY?_.tile.state.centerScreenY-S.tile.state.centerScreenY:_.tile.state.centerZDepth!==S.tile.state.centerZDepth?_.tile.state.centerZDepth-S.tile.state.centerZDepth:_.tile.state.distanceToCamera-S.tile.state.distanceToCamera:_.tile.level!==S.tile.level?_.tile.level-S.tile.level:_.tile.state.distanceToCamera-S.tile.state.distanceToCamera});break}}if(f=Math.max(this.tileset.maxRequests-this.activeRequests,0),!this.tileset.skipLevelOfDetail)for(var m=0,y=l.length,c=0;c<y;c++){var A=l[c].tile;if(A.hasTilesetContent||A.contentParent===null||A.contentParent.state.selectedFrameNumber===this.tileset.frameNumber){var M=l.splice(c,1);l.splice.apply(l,__spreadArray([m++,0],M,!1))}}for(var b=function(S){var C=l[S];C.status==="WAITING"&&(f--,C.status="PENDING",C.time=s,T.activeRequests++,T.tileset.options.tileLoader(C.tile).catch(function(P){C.error=P}).then(function(){C.status="DONE",C.tile.content&&C.tile.content.loadState==="READY"&&(C.tile.content.loadState="LOADING"),o.activeRequests--}))},T=this,c=0;c<l.length&&f>0;c++)b(c)},e}(),CacheNode=function(){function e(t,r,n){this.item=t,this.previous=r,this.next=n}return e}(),CacheNodeList=function(){function e(){this.head=null,this.tail=null,this._length=0}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),e.prototype.add=function(t){var r=new CacheNode(t,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),this._length++,r},e.prototype.remove=function(t){t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,this._length--},e.prototype.splice=function(t,r){t!==r&&(this.remove(r),this.insert(t,r))},e.prototype.insert=function(t,r){var n=t.next;t.next=r,this.tail===t?this.tail=r:n.previous=r,r.next=n,r.previous=t,this._length++},e.prototype.toArray=function(){for(var t=[],r=this.head;r;)t.push(r),r=r.next;return t},e}(),TileCache=function(){function e(t){t===void 0&&(t={}),this.options=t,this.cacheNodeMap=new Map,this.list=new CacheNodeList,this.sentinel=this.list.add("sentinel")}return e.prototype.reset=function(){this.list.tail&&this.list.splice(this.list.tail,this.sentinel)},e.prototype.touchTile=function(t){var r=this.cacheNodeMap.get(t);r&&this.list.splice(this.sentinel,r)},e.prototype.loadTile=function(t){if(!this.cacheNodeMap.has(t)){var r=this.list.add(t);this.cacheNodeMap.set(t,r),this.options.onTileLoad&&this.options.onTileLoad(t)}},e.prototype.unloadTile=function(t){var r=this.cacheNodeMap.get(t);r&&(this.list.remove(r),this.cacheNodeMap.delete(t),this.options.onTileUnload&&this.options.onTileUnload(t))},e.prototype.unloadTiles=function(t){for(var r=this.list.head;r!==this.sentinel&&t();){var n=r.item;r=r.next,this.unloadTile(n)}},e.prototype.toArray=function(){for(var t=[],r=0,n=this.list.toArray();r<n.length;r++){var o=n[r];o.item!=="sentinel"&&t.push(o.item)}return t},e}(),ManagedArray=function(){function e(){this.map=new Map,this.array=[],this._length=0}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),e.prototype.get=function(t){return this.array[t]},e.prototype.set=function(t,r){t>=this.length&&(this._length=t+1),this.map.has(this.array[t])&&this.map.delete(this.array[t]),this.array[t]=r,this.map.set(r,t)},e.prototype.delete=function(t){var r=this.map.get(t);r!==void 0&&r>=0&&(this.array.splice(r,1),this.map.delete(t),this._length--)},e.prototype.push=function(t){if(!this.map.has(t)){var r=this._length++;this.array[r]=t,this.map.set(t,r)}},e.prototype.pop=function(){var t=this.array[--this._length];return this.map.delete(t),this.array[this._length]=void 0,t},e.prototype.reset=function(){this.array=[],this.map=new Map,this._length=0},e.prototype.find=function(t){return this.map.has(t)},e.prototype.peek=function(){return this.array[this._length-1]},e}(),TilesetBaseTraverser=function(){function e(t){this.tileset=t,this._canSelectTile=!0,this._loadAllTilesTraversalStack=new ManagedArray,this.root=null}return e.prototype.traverse=function(t,r,n){this.root=t,this.reset()},e.prototype.reset=function(){this._loadAllTilesTraversalStack.reset(),this.tileset.hasMixedContent=!1,this.tileset.needsRefinedTiles.clear(),this.tileset.requestedTiles.length=0,this.tileset.selectedTiles.length=0},e.prototype.updateTile=function(t,r){this.updateTileVisibility(t,r),t.state.shouldSelect=!1,t.state.finalResolution=!0},e.prototype.selectTile=function(t,r){var n=t.contentAvailable&&this._canSelectTile;n&&t.state.selectedFrameNumber<r.frameNumber&&(t.state.selectedFrameNumber=r.frameNumber,this.tileset.selectedTiles.push(t),this.tileset.needsRefinedTiles.add(t))},e.prototype.loadTile=function(t,r){t.state.requestedFrameNumber<r.frameNumber&&(t.state.requestedFrameNumber=r.frameNumber,t.content&&(t.content.loadState==="FAILED"&&r.time-t.content.loadStateUpdateTime>t.content.loadfailRetryDelay&&(t.content.loadState="UNLOADED",t.content.loadStateUpdateTime=r.time),t.content.loadState==="UNLOADED"&&this.tileset.requestedTiles.push(t))),this.tileset.needsRefinedTiles.add(t)},e.prototype.touchTile=function(t,r){this.tileset.cache.touchTile(t),t.state.touchedFrameNumber=r.frameNumber},e.prototype.canTraverse=function(t,r){return!t.state.inRequestVolume||t.levelOfContent>=r.maxLevelOfDetail||t.levelOfContent>=0&&t.geometricError<=r.minGeometricError||t.children.length===0?!1:t.levelOfContent<=r.minLevelOfDetail||t.geometricError>=r.maxGeometricError||t.hasTilesetContent?!0:t.state.screenSpaceError>this.tileset.currentMaxScreenSpaceError},e.prototype.updateTileVisibility=function(t,r){if(t.updateState(r),!(!t.state.visible||!t.state.inRequestVolume)){var n=t.children.length>0;if(t.hasTilesetContent&&n){var o=t.children[0];this.updateTileVisibility(o,r),t.state.visible=o.state.visible;return}if(this.meetsScreenSpaceErrorEarly(t,r)){t.state.visible=!1;return}var s=t.refine==="REPLACE";if(s&&n&&!this.anyChildrenVisible(t,r)){t.state.visible=!1;return}}},e.prototype.anyChildrenVisible=function(t,r){for(var n=!1,o=t.children,s=0,l=o;s<l.length;s++){var u=l[s];u.updateState(r),n=n||u.state.visible}return n},e.prototype.meetsScreenSpaceErrorEarly=function(t,r){var n=t.parent;return!n||n.refine!=="ADD"||n.levelOfContent<r.minLevelOfDetail||n.geometricError>r.maxGeometricError?!1:n.levelOfContent>r.maxLevelOfDetail||n.levelOfContent>=0&&n.geometricError<r.minGeometricError?!0:t.getScreenSpaceError(r,t.state.distanceToCamera,!0)<this.tileset.currentMaxScreenSpaceError},e.prototype.sortTilesByDistanceToCamera=function(t){t.sort(function(r,n){return n.state.distanceToCamera===0&&r.state.distanceToCamera===0?n.state.centerZDepth-r.state.centerZDepth:n.state.distanceToCamera-r.state.distanceToCamera})},e.prototype.loadAllTiles=function(t,r){var n=this._loadAllTilesTraversalStack;for(n.push(t);n.length>0;){var o=n.pop();o.content&&o.content.loadState==="UNLOADED"&&o.state.requestedFrameNumber<r.frameNumber&&this.tileset.requestedTiles.push(o),this.touchTile(o,r);for(var s=0,l=o.children;s<l.length;s++){var u=l[s];n.push(u)}}},e}(),TilesetNormalTraverser=function(e){__extends(t,e);function t(r){var n=e.call(this,r)||this;return n.tileset=r,n._traversalStack=new ManagedArray,n._emptyTraversalStack=new ManagedArray,n}return t.prototype.traverse=function(r,n,o){o===void 0&&(o=[]),e.prototype.traverse.call(this,r,n,o);for(var s=0,l=o;s<l.length;s++){var u=l[s];this._traversalStack.reset(),this._emptyTraversalStack.reset(),u.camera.refine&&(this._canSelectTile=u.camera.visible,this.updateTile(r,u),this.executeTraversal(r,u))}this._traversalStack.reset(),this._emptyTraversalStack.reset(),n.camera.refine&&(this._canSelectTile=n.camera.visible,this.updateTile(r,n),this.executeTraversal(r,n)),this.tileset.loadAll&&this.loadAllTiles(r,n)},t.prototype.reset=function(){e.prototype.reset.call(this),this._traversalStack.reset(),this._emptyTraversalStack.reset()},t.prototype.executeTraversal=function(r,n){var o=this._traversalStack;for(r.state.visible&&r.state.inRequestVolume&&o.push(r);o.length>0;){var s=o.pop(),l=s.parent,u=!l||l.state.shouldRefine,c=!1;this.canTraverse(s,n)&&(c=this.updateAndPushChildren(s,n,o)&&u);var h=!c&&u;s.hasRenderContent?s.refine==="ADD"?(this.loadTile(s,n),this.selectDesiredTile(s,n)):s.refine==="REPLACE"&&(this.loadTile(s,n),h&&this.selectDesiredTile(s,n)):(this.loadTile(s,n),h&&this.selectDesiredTile(s,n)),this.touchTile(s,n),s.state.shouldRefine=c}},t.prototype.updateAndPushChildren=function(r,n,o){for(var s=r.children,l=0,u=s;l<u.length;l++){var c=u[l];this.updateTile(c,n)}this.sortTilesByDistanceToCamera(s);for(var h=r.refine==="REPLACE"&&r.hasRenderContent,f=!1,m=!0,y=0,A=s;y<A.length;y++){var c=A[y];if(c.levelOfContent<=n.minLevelOfDetail||c.geometricError>=n.maxGeometricError||c.state.visible&&c.state.inRequestVolume?(o.find(c)&&o.delete(c),o.push(c),f===!1&&(f=!0)):(h||this.tileset.loadSiblings)&&(this.loadTile(c,n),this.touchTile(c,n)),h){var M=void 0;c.state.inRequestVolume?c.hasRenderContent?M=c.contentAvailable:M=this.executeEmptyTraversal(c,n):M=!1,m=m&&M}}return f||(m=!1),m},t.prototype.selectDesiredTile=function(r,n){r.contentAvailable&&e.prototype.selectTile.call(this,r,n)},t.prototype.executeEmptyTraversal=function(r,n){var o=!0,s=this._emptyTraversalStack;for(s.push(r);s.length>0&&o;){var l=s.pop(),u=!l.hasRenderContent&&this.canTraverse(l,n);if(!u&&!l.contentAvailable&&(o=!1),this.updateTile(l,n),l.state.visible||(this.loadTile(l,n),this.touchTile(l,n)),u)for(var c=l.children,h=0,f=c;h<f.length;h++){var m=f[h];s.find(m)&&s.delete(m),s.push(m)}}return o},t}(TilesetBaseTraverser),TilesetSkipTraverser=function(e){__extends(t,e);function t(r){var n=e.call(this,r)||this;return n.tileset=r,n.baseScreenSpaceError=1024,n.skipScreenSpaceErrorFactor=16,n.skipLevels=1,n._traversalStack=new ManagedArray,n._descendantTraversalStack=new ManagedArray,n._selectionTraversalStack=new ManagedArray,n._selectionTraversalancestorStack=new ManagedArray,n}return t.prototype.traverse=function(r,n,o){o===void 0&&(o=[]),e.prototype.traverse.call(this,r,n,o);for(var s=0,l=o;s<l.length;s++){var u=l[s];this._traversalStack.reset(),u.camera.refine&&(this._canSelectTile=u.camera.visible,this.updateTile(r,u),this.executeTraversal(r,u),this.traverseAndSelect(r,u))}this.tileset.hasMixedContent=!1,this._traversalStack.reset(),this._descendantTraversalStack.reset(),this._selectionTraversalStack.reset(),this._selectionTraversalancestorStack.reset(),n.camera.refine&&(this._canSelectTile=n.camera.visible,this.updateTile(r,n),this.executeTraversal(r,n),this.traverseAndSelect(r,n)),this.tileset.loadAll&&this.loadAllTiles(r,n)},t.prototype.reset=function(){e.prototype.reset.call(this),this._traversalStack.reset(),this._descendantTraversalStack.reset(),this._selectionTraversalStack.reset(),this._selectionTraversalancestorStack.reset()},t.prototype.executeTraversal=function(r,n){var o=this._traversalStack;for(r.state.visible&&r.state.inRequestVolume&&o.push(r);o.length>0;){var s=o.pop();this.updateTileAncestorContentLinks(s,n);var l=s.parent,u=!l||l.state.shouldRefine,c=!1;this.canTraverse(s,n)&&(c=this.updateAndPushChildren(s,n,o)&&u);var h=!c&&u;s.hasRenderContent?s.refine==="ADD"?(this.loadTile(s,n),this.selectDesiredTile(s,n)):s.refine==="REPLACE"&&(this.inBaseTraversal(s,this.baseScreenSpaceError)?(this.loadTile(s,n),h&&this.selectDesiredTile(s,n)):h?(this.loadTile(s,n),this.selectDesiredTile(s,n)):this.reachedSkippingThreshold(s)&&this.loadTile(s,n)):(this.loadTile(s,n),h&&this.selectDesiredTile(s,n)),this.touchTile(s,n),s.state.shouldRefine=c}},t.prototype.updateAndPushChildren=function(r,n,o){for(var s=r.children,l=0,u=s;l<u.length;l++){var c=u[l];this.updateTile(c,n)}this.sortTilesByDistanceToCamera(s);for(var h=!1,f=0,m=s;f<m.length;f++){var c=m[f];c.levelOfContent<=n.minLevelOfDetail||c.geometricError>=n.maxGeometricError||c.state.visible&&c.state.inRequestVolume?(o.push(c),h===!1&&(h=!0)):this.tileset.loadSiblings&&(this.loadTile(c,n),this.touchTile(c,n))}return h},t.prototype.selectDesiredTile=function(r,n){var o=r.contentAvailable?r:r.state.ancestorWithContentAvailable;o&&(o.state.shouldSelect=!0),r.contentAvailable||this.selectDescendants(r,n)},t.prototype.selectDescendants=function(r,n){var o=this._descendantTraversalStack;for(o.push(r);o.length>0;)for(var s=o.pop(),l=s.children,u=0,c=l;u<c.length;u++){var h=c[u];h.state.visible&&(h.contentAvailable?(this.updateTile(h,n),this.touchTile(h,n),this.selectTile(h,n)):o.push(h))}},t.prototype.reachedSkippingThreshold=function(r){var n=r.state.ancestorWithContent,o=n!==null&&r.state.screenSpaceError<n.state.screenSpaceError/this.skipScreenSpaceErrorFactor&&r.levelOfContent>n.levelOfContent+this.skipLevels;return o},t.prototype.updateTileAncestorContentLinks=function(r,n){r.state.ancestorWithContent=null,r.state.ancestorWithContentAvailable=null;var o=r.parent;if(o){var s=!(o.hasRenderContent&&o.hasUnloadedContent)||o.state.requestedFrameNumber===n.frameNumber;r.state.ancestorWithContent=s?o:o.state.ancestorWithContent,r.state.ancestorWithContentAvailable=o.contentAvailable?o:o.state.ancestorWithContentAvailable}},t.prototype.inBaseTraversal=function(r,n){return r.state.ancestorWithContent?r.parent&&r.state.screenSpaceError===0?r.parent.state.screenSpaceError>n:r.state.screenSpaceError>n:!0},t.prototype.traverseAndSelect=function(r,n){var o=this._selectionTraversalStack,s=this._selectionTraversalancestorStack,l;for(o.push(r);o.length>0||s.length>0;){if(s.length>0){var u=s.peek();if(u.state.stackLength===o.length){s.pop(),u!==l&&(u.state.finalResolution=!1),this.selectTile(u,n);continue}}var c=o.pop();if(c){var h=this.canTraverse(c,n);if(c.state.shouldSelect)if(c.refine==="ADD")this.selectTile(c,n);else{if(c.state.selectionDepth=s.length,c.state.selectionDepth>0&&(c.tileset.hasMixedContent=!0),l=c,!h){this.selectTile(c,n);continue}s.push(c),c.state.stackLength=o.length}if(h)for(var f=0,m=c.children;f<m.length;f++){var y=m[f];y.state.visible&&o.push(y)}}}},t}(TilesetBaseTraverser),TilesetMostDetailTraverser=function(e){__extends(t,e);function t(r){var n=e.call(this,r)||this;return n.tileset=r,n._traversalStack=new ManagedArray,n}return t.prototype.canTraverse=function(r,n){return!(!r.state.inRequestVolume||r.levelOfContent>=n.maxLevelOfDetail||r.levelOfContent>=0&&r.geometricError<=n.minGeometricError||r.children.length===0)},t.prototype.traverse=function(r,n,o){e.prototype.traverse.call(this,r,n,[]),this._traversalStack.reset(),r.updateState(n);for(var s=0,l=o;s<l.length;s++){var u=l[s];this._traversalStack.reset(),u.camera.refine&&(this._canSelectTile=u.camera.visible,r.updateState(u),this.executeTraversal(r,u))}this._traversalStack.reset(),n.camera.refine&&(this._canSelectTile=n.camera.visible,r.updateState(n),this.executeTraversal(r,n)),this.tileset.loadAll&&this.loadAllTiles(r,n)},t.prototype.reset=function(){e.prototype.reset.call(this),this._traversalStack.reset()},t.prototype.executeTraversal=function(r,n){var o=this._traversalStack;for(o.push(r);o.length>0;){var s=o.pop(),l=s.refine==="ADD",u=s.refine==="REPLACE",c=this.canTraverse(s,n);c&&this.updateAndPushChildren(s,n,o),(l||u&&!c)&&(this.loadTile(s,n),this.touchTile(s,n),this.selectDesiredTile(s,n))}},t.prototype.updateAndPushChildren=function(r,n,o){for(var s=r.children,l=0;l<s.length;++l){var u=s[l];u.updateState(n),u.state.visible&&o.push(u)}},t.prototype.selectDesiredTile=function(r,n){r.contentAvailable&&e.prototype.selectTile.call(this,r,n)},t}(TilesetBaseTraverser),Trajectory=function(){function e(t,r,n){this.index=t,this.name=r.name,this.visible=!1,this.tileset=n,this.transform=new Matrix4,r.transform&&this.transform.fromArray(r.transform),this.transform.premultiply(this.tileset.root.transform),this.content={uri:r.file,byteLength:0,memoryUsage:0,loadState:"UNLOADED",loadStateUpdateTime:now(),loadfailRetryDelay:0,data:void 0}}return e}(),identityMatrix4=new Matrix4,Tileset=function(){function e(t,r,n){var o=this,s,l,u,c,h,f,m,y,A;if(this.id=t,this.transform=new Matrix4,this.transformIsIdentity=!0,this.hasMixedContent=!1,this.url=(s=n.url)!==null&&s!==void 0?s:"",this.referer=(l=n.referer)!==null&&l!==void 0?l:"",this.asset={version:r.asset.version,tilesetVersion:r.asset.tilesetVersion||"",gltfUpAxis:(u=r.asset.gltfUpAxis)!==null&&u!==void 0?u:"Y",overview:r.asset.overview,trajectories:(h=(c=r.asset.trajectories)===null||c===void 0?void 0:c.list)!==null&&h!==void 0?h:[],extras:r.asset.extras},this.rootMeta=(f=r.rootMeta)!==null&&f!==void 0?f:{},this.pointLength=(m=this.rootMeta.numTotalPoints)!==null&&m!==void 0?m:1/0,this.floorLength=(y=this.rootMeta.numFloors)!==null&&y!==void 0?y:1,this.properties=(A=r.properties)!==null&&A!==void 0?A:{},this.options=n,this.memoryOverflow=e.DEFAULT_MEMORY_OVERFLOW,this.maxMemoryUsage=e.DEFAULT_MAX_MEMORY_USAGE,this.memoryAdjustedScreenSpaceError=e.DEFAULT_MEMORY_ADJUSTED_SCREEN_SPACE_ERROR,this.maxScreenSpaceError=e.DEFAULT_MAX_SCREEN_SPACE_ERROR,this.skipLevelOfDetail=e.DEFAULT_SKIP_LEVEL_OF_DETAIL,this.mostDetail=e.DEFAULT_MOST_DETAIL,this.loadSiblings=e.DEFAULT_LOAD_SIBLINGS,this.loadAll=e.DEFAULT_LOAD_ALL,this.maxRequests=e.DEFAULT_MAX_REQUESTS,this.tileRequestOrder=e.DEFAULT_REQUEST_ORDER,this.requestedTiles=[],this.selectedTiles=[],this.unloadTiles=[],this.needsRefinedTiles=new Set,this.selectedTrajectories=[],this.normalTraverser=new TilesetNormalTraverser(this),this.skipTraverser=new TilesetSkipTraverser(this),this.mostDetailTraverser=new TilesetMostDetailTraverser(this),this.cache=new TileCache({onTileLoad:function(T){o.cacheMemoryUsageInBytes+=T.contentMemoryUsage},onTileUnload:function(T){o.cacheMemoryUsageInBytes-=T.contentMemoryUsage,o.unloadTiles.push(T)}}),this.requestScheduler=new TileRequestScheduler(this,{onTileSkip:function(T){},onTileLoad:function(T){var _;!((_=T.content)===null||_===void 0)&&_.data&&(o.loadedTiles.add(T),o.cache.loadTile(T)),o.options.onTileLoad(T)},onTileError:function(T,_){o.options.onTileError(T,_)}}),this.frameNumber=0,this.maxLevelOfDetail=0,this.minLevelOfDetail=0,this.minGeometricError=0,this.maxGeometricError=0,this.loadedTiles=new Set,this.cacheMemoryUsageInBytes=0,this.currentMaxScreenSpaceError=this.maxScreenSpaceError,this.root=new Tile("".concat(this.id,".0"),r.root,this),this.geometricError=r.geometricError,this.trajectories=[],this.asset.trajectories)for(var M=0;M<this.asset.trajectories.length;M++){var b=new Trajectory(M,this.asset.trajectories[M],this);this.trajectories.push(b)}}return e.prototype.adjustScreenSpaceError=function(){if(this.memoryAdjustedScreenSpaceError){var t=0;this.needsRefinedTiles.forEach(function(o){o.content&&(t+=o.content.memoryUsage)});var r=(this.maxMemoryUsage-this.memoryOverflow)*1024*1024,n=this.maxMemoryUsage*1024*1024;t<r?this.currentMaxScreenSpaceError=Math.max(this.currentMaxScreenSpaceError/1.02,this.maxScreenSpaceError):t>n&&this.selectedTiles.length>0&&(this.currentMaxScreenSpaceError*=1.02)}else this.currentMaxScreenSpaceError=this.maxScreenSpaceError},Object.defineProperty(e.prototype,"traverser",{get:function(){return this.mostDetail?this.mostDetailTraverser:this.skipLevelOfDetail?this.skipTraverser:this.normalTraverser},enumerable:!1,configurable:!0}),e.prototype.reset=function(){for(var t=this,r=[this.root],n;n=r.pop();){for(var o=0,s=n.children.length;o<s;o++)r.push(n.children[o]);this.cache.unloadTile(n)}for(var l=function(){var f=u.unloadTiles.pop();f&&(u.loadedTiles.delete(f),u.cacheMemoryUsageInBytes-=f.contentMemoryUsage,u.options.tileUnloader(f).catch(function(){}).then(function(){t.options.onTileUnload&&t.options.onTileUnload(f)}))},u=this;this.unloadTiles.length;)l();this.cache.reset(),this.traverser.reset(),this.requestScheduler.reset(),this.loadedTiles.clear();for(var c=function(){var f=h.trajectories.pop();f&&h.options.trajectoryUnloader(f).catch(function(){}).then(function(){t.options.onTrajectoryUnload&&t.options.onTrajectoryUnload(f)})},h=this;this.trajectories.length;)c()},e.prototype.update=function(t,r){var n=this,o;r===void 0&&(r=[]),this.frameNumber=t.frameNumber,this.minLevelOfDetail=t.minLevelOfDetail,this.maxLevelOfDetail=t.maxLevelOfDetail,this.minGeometricError=t.minGeometricError,this.maxGeometricError=t.maxGeometricError,this.adjustScreenSpaceError(),this.transformIsIdentity=this.transform.equals(identityMatrix4),this.traverser.traverse(this.root,t,r),this.cache.unloadTiles(function(){var y=n.cacheMemoryUsageInBytes>n.maxMemoryUsage*1024*1024;return y}),this.requestScheduler.update(this.requestedTiles,this.tileRequestOrder,t);for(var s=function(){var y=l.unloadTiles.pop();y&&(l.loadedTiles.delete(y),l.options.tileUnloader(y).catch(function(){}).then(function(){n.options.onTileUnload&&n.options.onTileUnload(y)}))},l=this;this.unloadTiles.length;)s();this.selectedTrajectories.length=0;for(var u=function(y){y.visible===!0&&y.content.loadState==="READY"&&!((o=y.content.data)===null||o===void 0)&&o.object?c.selectedTrajectories.push(y):y.visible===!0&&(y.content.loadState==="FAILED"&&t.time-y.content.loadStateUpdateTime>y.content.loadfailRetryDelay&&(y.content.loadState="UNLOADED",y.content.loadStateUpdateTime=t.time),y.content.loadState==="UNLOADED"&&c.options.trajectoryLoader(y).then(function(){n.options.onTrajectoryLoad(y)}).catch(function(A){n.options.onTrajectoryError(y,A)}))},c=this,h=0,f=this.trajectories;h<f.length;h++){var m=f[h];u(m)}},e.DEFAULT_MAX_MEMORY_USAGE=16,e.DEFAULT_MEMORY_OVERFLOW=4,e.DEFAULT_MEMORY_ADJUSTED_SCREEN_SPACE_ERROR=!1,e.DEFAULT_MAX_SCREEN_SPACE_ERROR=4,e.DEFAULT_SKIP_LEVEL_OF_DETAIL=!1,e.DEFAULT_MOST_DETAIL=!1,e.DEFAULT_LOAD_SIBLINGS=!1,e.DEFAULT_LOAD_ALL=!1,e.DEFAULT_MAX_REQUESTS=6,e.DEFAULT_REQUEST_ORDER="SCREEN_SPACE_ERROR",e}(),BVHObject=function(){function e(t,r){this.position=t,this.indices=r}return e.prototype.getPositionCount=function(){var t,r,n=this.indices,o=this.position;return n?n.array.length/((t=n.stride)!==null&&t!==void 0?t:1):o.array.length/((r=o.stride)!==null&&r!==void 0?r:3)},e.prototype.getPositionByIndex=function(t,r){var n,o,s,l,u=this.indices,c=this.position,h=t;if(u){var f=u.array,m=(n=u.stride)!==null&&n!==void 0?n:1,y=(o=u.offset)!==null&&o!==void 0?o:0;h=f[t*m+y]}var A=c.array,M=(s=c.stride)!==null&&s!==void 0?s:3,b=(l=c.offset)!==null&&l!==void 0?l:0;return h=h*M+b,r.x=A[h],r.y=A[h+1],r.z=A[h+2],r},e.prototype.createTree=function(t,r,n){throw new Error("not implemented")},e.prototype.trianglesInSphere=function(t,r){throw new Error("not implemented")},e.prototype.intersectRay=function(t,r,n,o){throw new Error("not implemented")},e}(),BVHNode=function(){function e(t,r,n,o,s){this.id=t,this.extents=r,this.startIndex=n,this.endIndex=o,this.deepth=s}return e}(),BYTES_PER_NODE=6*4+4+4+2+2;function packBVHNode(e,t){for(var r=new ArrayBuffer(t*BYTES_PER_NODE),n=new Float32Array(r),o=new Uint32Array(r),s=new Uint16Array(r),l=[e],u,c;u=l.pop();)c=u.id*BYTES_PER_NODE/4,n[c]=u.extents[0],n[c+1]=u.extents[1],n[c+2]=u.extents[2],n[c+3]=u.extents[3],n[c+4]=u.extents[4],n[c+5]=u.extents[5],o[c+6]=u.startIndex,o[c+7]=u.endIndex,c=u.id*BYTES_PER_NODE/2,u.node0&&(s[c+16]=u.node0.id,l.push(u.node0)),u.node1&&(s[c+17]=u.node1.id,l.push(u.node1));return r}function intersectNodeBox(e,t,r,n,o,s,l,u,c){c===void 0&&(c=0),r=r-c,n=n-c,o=o-c,s=s+c,l=l+c,u=u+c;var h=0,f=0,m=0,y=0,A=0,M=0;return t.x>=0?(h=(r-e.x)*t.x,f=(s-e.x)*t.x):(h=(s-e.x)*t.x,f=(r-e.x)*t.x),t.y>=0?(m=(n-e.y)*t.y,y=(l-e.y)*t.y):(m=(l-e.y)*t.y,y=(n-e.y)*t.y),!(h>y||m>f||(m>h&&(h=m),y<f&&(f=y),t.z>=0?(A=(o-e.z)*t.z,M=(u-e.z)*t.z):(A=(u-e.z)*t.z,M=(o-e.z)*t.z),h>M||A>f)||(A>h&&(h=A),M<f&&(f=M),f<0))}var BVHVector3=function(){function e(t,r,n){this.x=t,this.y=r,this.z=n}return e.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},e.prototype.set=function(t,r,n){return this.x=t,this.y=r,this.z=n,this},e.prototype.fromArray=function(t,r){return r===void 0&&(r=0),this.x=t[r],this.y=t[r+1],this.z=t[r+2],this},e.prototype.toArray=function(t,r){return t===void 0&&(t=[]),r===void 0&&(r=0),t[r]=this.x,t[r+1]=this.y,t[r+2]=this.z,t},e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},e.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.prototype.subVectors=function(t,r){return this.x=t.x-r.x,this.y=t.y-r.y,this.z=t.z-r.z,this},e.prototype.addScaledVector=function(t,r){return this.x+=t.x*r,this.y+=t.y*r,this.z+=t.z*r,this},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.prototype.cross=function(t){var r=this.x,n=this.y,o=this.z;return this.x=n*t.z-o*t.y,this.y=o*t.x-r*t.z,this.z=r*t.y-n*t.x,this},e.prototype.crossVectors=function(t,r){var n=t.x,o=t.y,s=t.z,l=r.x,u=r.y,c=r.z;return this.x=o*c-s*u,this.y=s*l-n*c,this.z=n*u-o*l,this},e.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},e.prototype.distanceToSquared=function(t){var r=this.x-t.x,n=this.y-t.y,o=this.z-t.z;return r*r+n*n+o*o},e.prototype.clone=function(){return new e(this.x,this.y,this.z)},e}(),BVHIntersect=function(){function e(t,r,n){this.triangle=t,this.intersectionPoint=r,this.index=n}return e}(),EPSILON$1=1e-6,scratchVector3$3=new BVHVector3(0,0,0),scratchVector3A=new BVHVector3(0,0,0),scratchVector3B=new BVHVector3(0,0,0),scratchVector3C=new BVHVector3(0,0,0),BVHMesh=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.createTree=function(r,n,o){n=Math.min(n,16);var s=this.getPositionCount()/3,l=s>65535?new Uint32Array(s):new Uint16Array(s),u=new Float32Array(s*6),c=[],h=0,f=-1;if(o)for(var m=0,y=0,A=0,M=void 0,b=void 0,T=void 0,_=void 0,S=void 0,C=void 0,P=void 0;m<s;m+=1,y+=3,A+=6)l[m]=m,this.getPositionByIndex(y,scratchVector3A),this.getPositionByIndex(y+1,scratchVector3B),this.getPositionByIndex(y+2,scratchVector3C),M=_=scratchVector3A.x,P=scratchVector3B.x,P<M&&(M=P),P>_&&(_=P),P=scratchVector3C.x,P<M&&(M=P),P>_&&(_=P),b=S=scratchVector3A.y,P=scratchVector3B.y,P<b&&(b=P),P>S&&(S=P),P=scratchVector3C.y,P<b&&(b=P),P>S&&(S=P),T=C=scratchVector3A.z,P=scratchVector3B.z,P<T&&(T=P),P>C&&(C=P),P=scratchVector3C.z,P<T&&(T=P),P>C&&(C=P),u[A]=M,u[A+1]=b,u[A+2]=T,u[A+3]=_,u[A+4]=S,u[A+5]=C;else{for(var F=1/0,O=1/0,N=1/0,V=-1/0,q=-1/0,Q=-1/0,m=0,y=0,A=0,M=void 0,b=void 0,T=void 0,_=void 0,S=void 0,C=void 0,P=void 0;m<s;m+=1,y+=3,A+=6)l[m]=m,this.getPositionByIndex(y,scratchVector3A),this.getPositionByIndex(y+1,scratchVector3B),this.getPositionByIndex(y+2,scratchVector3C),M=_=scratchVector3A.x,P=scratchVector3B.x,P<M&&(M=P),P>_&&(_=P),P=scratchVector3C.x,P<M&&(M=P),P>_&&(_=P),b=S=scratchVector3A.y,P=scratchVector3B.y,P<b&&(b=P),P>S&&(S=P),P=scratchVector3C.y,P<b&&(b=P),P>S&&(S=P),T=C=scratchVector3A.z,P=scratchVector3B.z,P<T&&(T=P),P>C&&(C=P),P=scratchVector3C.z,P<T&&(T=P),P>C&&(C=P),u[A]=M,u[A+1]=b,u[A+2]=T,u[A+3]=_,u[A+4]=S,u[A+5]=C,M<F&&(F=M),_>V&&(V=_),b<O&&(O=b),S>q&&(q=S),T<N&&(N=T),C>Q&&(Q=C);o=[F,O,N,V,q,Q]}var z=new BVHNode(++f,o,0,s,0);c[h++]=z;var H=[],W=[0,1,2],J=function(te,X){return H[X]-H[te]};function G(te){var X=te.startIndex,K=te.endIndex,Z=te.extents;H[0]=Z[3]-Z[0],H[1]=Z[4]-Z[1],H[2]=Z[5]-Z[2],W.sort(J);for(var ee=0;ee<3;ee++){for(var j=W[ee],re=Z[j]+Z[j+3],pe=X,ge=K-1,_e=-1,he=void 0;pe<=ge;)_e===-1?(he=l[pe],u[he*6+j]+u[he*6+j+3]<re?pe++:_e=he):(he=l[ge],u[he*6+j]+u[he*6+j+3]>=re||(l[pe]=he,l[ge]=_e,_e=-1,pe++),ge--);if(pe>X&&pe<K){var Fe=new BVHNode(++f,calcExtents(l,u,X,pe,EPSILON$1),X,pe,te.deepth+1);Fe.deepth<n&&Fe.endIndex-Fe.startIndex>r&&(c[h++]=Fe);var Re=new BVHNode(++f,calcExtents(l,u,pe,K,EPSILON$1),pe,K,te.deepth+1);Re.deepth<n&&Re.endIndex-Re.startIndex>r&&(c[h++]=Re),te.node0=Fe,te.node1=Re,te.startIndex=0,te.endIndex=0;break}}}for(;h;)G(c[--h]);return this.offsetArray=l,this.rootNodePacked=packBVHNode(z,f+1),c.length=0,this},t.prototype.trianglesInSphere=function(r,n){for(var o=this.offsetArray,s=this.rootNodePacked,l=new Float32Array(s),u=new Uint32Array(s),c=new Uint16Array(s),h=[0],f=[],m,y,A,M;(m=h.pop())!==void 0;){M=m*BYTES_PER_NODE/4;var b=clamp(r.x,l[M],l[M+3])-r.x,T=clamp(r.y,l[M+1],l[M+4])-r.y,_=clamp(r.z,l[M+2],l[M+5])-r.z;if(b*b+T*T+_*_<=n*n){for(var S=u[M+6];S<u[M+7];S++)f.push(o[S]);M=m*BYTES_PER_NODE/2,y=c[M+16],A=c[M+17],y&&h.push(y),A&&h.push(A)}}for(var C=f.length,P=new Float32Array(C*9),S=0;S<C;S++){var F=f[S];this.getPositionByIndex(F,scratchVector3$3),P[S*9]=scratchVector3$3.x,P[S*9+1]=scratchVector3$3.y,P[S*9+2]=scratchVector3$3.z,this.getPositionByIndex(F+1,scratchVector3$3),P[S*9+3]=scratchVector3$3.x,P[S*9+4]=scratchVector3$3.y,P[S*9+5]=scratchVector3$3.z,this.getPositionByIndex(F+2,scratchVector3$3),P[S*9+6]=scratchVector3$3.x,P[S*9+7]=scratchVector3$3.y,P[S*9+8]=scratchVector3$3.z}return P},t.prototype.intersectRay=function(r,n,o,s){for(var l=this.offsetArray,u=this.rootNodePacked,c=new Float32Array(u),h=new Uint32Array(u),f=new Uint16Array(u),m=new BVHVector3(1/n.x,1/n.y,1/n.z),y=[0],A,M,b,T;(A=y.pop())!==void 0;)if(T=A*BYTES_PER_NODE/4,intersectNodeBox(r,m,c[T],c[T+1],c[T+2],c[T+3],c[T+4],c[T+5])){for(var _=h[T+6],S=h[T+7],C=void 0,P=void 0,F=void 0,O=r.x,N=r.y,V=r.z,q=n.x,Q=n.y,z=n.z,H=void 0,W=void 0,J=void 0,G=void 0,te=void 0,X=void 0,K=void 0,Z=void 0,ee=void 0,j=void 0,re=void 0,pe=void 0,ge=void 0,_e=void 0,he=void 0,Fe=void 0,Re=void 0,Le=void 0,Se=void 0,we=void 0,Ve=void 0,je=void 0,st=void 0,We=void 0,bt=void 0,oe=void 0,ue=void 0;_<S;_++){if(C=l[_],P=C*3,this.getPositionByIndex(P,scratchVector3$3),H=scratchVector3$3.x,W=scratchVector3$3.y,J=scratchVector3$3.z,this.getPositionByIndex(P+1,scratchVector3$3),G=scratchVector3$3.x,te=scratchVector3$3.y,X=scratchVector3$3.z,this.getPositionByIndex(P+2,scratchVector3$3),K=scratchVector3$3.x,Z=scratchVector3$3.y,ee=scratchVector3$3.z,j=G-H,re=te-W,pe=X-J,ge=K-H,_e=Z-W,he=ee-J,Fe=re*he-pe*_e,Re=pe*ge-j*he,Le=j*_e-re*ge,st=q*Fe+Q*Re+z*Le,st>0)je=1;else if(st<0)je=-1,st=-st;else continue;Se=O-H,we=N-W,Ve=V-J,We=je*(q*(we*he-Ve*_e)+Q*(Ve*ge-Se*he)+z*(Se*_e-we*ge)),!(We<0)&&(bt=je*(q*(re*Ve-pe*we)+Q*(pe*Se-j*Ve)+z*(j*we-re*Se)),!(bt<0)&&(We+bt>st||(oe=-je*(Se*Fe+we*Re+Ve*Le),!(oe<0)&&(ue=oe/st,s.push(new BVHIntersect([H,W,J,G,te,X,K,Z,ee],[O+q*ue,N+Q*ue,V+z*ue],C))))))}T=A*BYTES_PER_NODE/2,M=f[T+16],b=f[T+17],M&&y.push(M),b&&y.push(b)}return s},t}(BVHObject);function clamp(e,t,r){return e<t?t:e>r?r:e}function calcExtents(e,t,r,n,o){if(r>=n)return[0,0,0,0,0,0];for(var s=1/0,l=1/0,u=1/0,c=-1/0,h=-1/0,f=-1/0,m=r,y=void 0,A=void 0;m<n;m++)y=e[m]*6,A=t[y],A<s&&(s=A),A=t[y+1],A<l&&(l=A),A=t[y+2],A<u&&(u=A),A=t[y+3],A>c&&(c=A),A=t[y+4],A>h&&(h=A),A=t[y+5],A>f&&(f=A);return[s-o,l-o,u-o,c+o,h+o,f+o]}var EPSILON=1e-6,ORDER_AXISES=["x","y","z"],scratchVector3$2=new BVHVector3(0,0,0),BVHPoints=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.createTree=function(r,n,o){n=Math.min(n,16);var s=this.getPositionByIndex.bind(this),l=this.getPositionCount(),u=l>65535?new Uint32Array(l):new Uint16Array(l),c=[],h=0,f=-1;if(o)for(var m=0;m<l;m+=1)u[m]=m;else{s(0,scratchVector3$2);for(var y=scratchVector3$2.x,A=scratchVector3$2.y,M=scratchVector3$2.z,b=y,T=A,_=M,m=0,S=void 0,C=void 0,P=void 0;m<l;m+=1)u[m]=m,s(m,scratchVector3$2),S=scratchVector3$2.x,C=scratchVector3$2.y,P=scratchVector3$2.z,S<y?y=S:S>b&&(b=S),C<A?A=C:C>T&&(T=C),P<M?M=P:P>_&&(_=P);o=[y,A,M,b,T,_]}var F=new BVHNode(++f,o,0,l,0);c[h++]=F;var O=[],N=[0,1,2],V=function(Q,z){return O[z]-O[Q]};function q(Q){var z=Q.startIndex,H=Q.endIndex,W=Q.extents;O[0]=W[3]-W[0],O[1]=W[4]-W[1],O[2]=W[5]-W[2];for(var J=N.sort(V)[0],G=ORDER_AXISES[J],te=(W[J]+W[J+3])/2,X=z,K=H-1,Z=-1,ee;X<=K;)Z===-1?(ee=u[X],s(ee,scratchVector3$2),scratchVector3$2[G]<te?X++:Z=ee):(ee=u[K],s(ee,scratchVector3$2),scratchVector3$2[G]>=te||(u[X]=ee,u[K]=Z,Z=-1,X++),K--);if(X>z){var j=W.slice();j[J+3]=te+EPSILON;var re=new BVHNode(++f,j,z,X,Q.deepth+1);re.deepth<n&&re.endIndex-re.startIndex>r&&(c[h++]=re),Q.node0=re}if(H>X){var pe=W.slice();pe[J]=te-EPSILON;var ge=new BVHNode(++f,pe,X,H,Q.deepth+1);ge.deepth<n&&ge.endIndex-ge.startIndex>r&&(c[h++]=ge),Q.node1=ge}Q.startIndex=0,Q.endIndex=0}for(;h;)q(c[--h]);return this.offsetArray=u,this.rootNodePacked=packBVHNode(F,f+1),c.length=0,this},t.prototype.intersectRay=function(r,n,o,s){for(var l=this.offsetArray,u=this.rootNodePacked,c=new Float32Array(u),h=new Uint32Array(u),f=new Uint16Array(u),m=o*o,y=new BVHVector3(1/n.x,1/n.y,1/n.z),A=[0],M,b,T,_;(M=A.pop())!==void 0;)if(_=M*BYTES_PER_NODE/4,intersectNodeBox(r,y,c[_],c[_+1],c[_+2],c[_+3],c[_+4],c[_+5],o)){for(var S=h[_+6],C=h[_+7],P=void 0,F=void 0,O=void 0,N=void 0,V=void 0,q=void 0,Q=void 0,z=void 0,H=void 0,W=void 0,J=void 0,G=void 0;S<C;S++)P=l[S],this.getPositionByIndex(P,scratchVector3$2),F=scratchVector3$2.x,O=scratchVector3$2.y,N=scratchVector3$2.z,V=r.x,q=r.y,Q=r.z,z=n.x,H=n.y,W=n.z,J=z*(F-V)+H*(O-q)+W*(N-Q),J>0&&(V+=z*J,q+=H*J,Q+=W*J),z=F-V,H=O-q,W=N-Q,J=z*z+H*H+W*W,J<=m&&s.push(new BVHIntersect([F,O,N,F,O,N,F,O,N],[V,q,Q],P));_=M*BYTES_PER_NODE/2,b=f[_+16],T=f[_+17],b&&A.push(b),T&&A.push(T)}return s},t}(BVHObject);const encodedJs$1="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciBlcj1mdW5jdGlvbihlLHIpe3JldHVybiBlcj1PYmplY3Quc2V0UHJvdG90eXBlT2Z8fHtfX3Byb3RvX186W119aW5zdGFuY2VvZiBBcnJheSYmZnVuY3Rpb24odCxvKXt0Ll9fcHJvdG9fXz1vfXx8ZnVuY3Rpb24odCxvKXtmb3IodmFyIGYgaW4gbylPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobyxmKSYmKHRbZl09b1tmXSl9LGVyKGUscil9O2Z1bmN0aW9uIGhyKGUscil7aWYodHlwZW9mIHIhPSJmdW5jdGlvbiImJnIhPT1udWxsKXRocm93IG5ldyBUeXBlRXJyb3IoIkNsYXNzIGV4dGVuZHMgdmFsdWUgIitTdHJpbmcocikrIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsIik7ZXIoZSxyKTtmdW5jdGlvbiB0KCl7dGhpcy5jb25zdHJ1Y3Rvcj1lfWUucHJvdG90eXBlPXI9PT1udWxsP09iamVjdC5jcmVhdGUocik6KHQucHJvdG90eXBlPXIucHJvdG90eXBlLG5ldyB0KX10eXBlb2YgU3VwcHJlc3NlZEVycm9yPT0iZnVuY3Rpb24iJiZTdXBwcmVzc2VkRXJyb3I7dmFyIGRyPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShyLHQpe3RoaXMucG9zaXRpb249cix0aGlzLmluZGljZXM9dH1yZXR1cm4gZS5wcm90b3R5cGUuZ2V0UG9zaXRpb25Db3VudD1mdW5jdGlvbigpe3ZhciByLHQsbz10aGlzLmluZGljZXMsZj10aGlzLnBvc2l0aW9uO3JldHVybiBvP28uYXJyYXkubGVuZ3RoLygocj1vLnN0cmlkZSkhPT1udWxsJiZyIT09dm9pZCAwP3I6MSk6Zi5hcnJheS5sZW5ndGgvKCh0PWYuc3RyaWRlKSE9PW51bGwmJnQhPT12b2lkIDA/dDozKX0sZS5wcm90b3R5cGUuZ2V0UG9zaXRpb25CeUluZGV4PWZ1bmN0aW9uKHIsdCl7dmFyIG8sZixkLHYsbj10aGlzLmluZGljZXMscz10aGlzLnBvc2l0aW9uLHU9cjtpZihuKXt2YXIgdz1uLmFycmF5LHk9KG89bi5zdHJpZGUpIT09bnVsbCYmbyE9PXZvaWQgMD9vOjEscD0oZj1uLm9mZnNldCkhPT1udWxsJiZmIT09dm9pZCAwP2Y6MDt1PXdbcip5K3BdfXZhciBhPXMuYXJyYXksaD0oZD1zLnN0cmlkZSkhPT1udWxsJiZkIT09dm9pZCAwP2Q6MyxBPSh2PXMub2Zmc2V0KSE9PW51bGwmJnYhPT12b2lkIDA/djowO3JldHVybiB1PXUqaCtBLHQueD1hW3VdLHQueT1hW3UrMV0sdC56PWFbdSsyXSx0fSxlLnByb3RvdHlwZS5jcmVhdGVUcmVlPWZ1bmN0aW9uKHIsdCxvKXt0aHJvdyBuZXcgRXJyb3IoIm5vdCBpbXBsZW1lbnRlZCIpfSxlLnByb3RvdHlwZS50cmlhbmdsZXNJblNwaGVyZT1mdW5jdGlvbihyLHQpe3Rocm93IG5ldyBFcnJvcigibm90IGltcGxlbWVudGVkIil9LGUucHJvdG90eXBlLmludGVyc2VjdFJheT1mdW5jdGlvbihyLHQsbyxmKXt0aHJvdyBuZXcgRXJyb3IoIm5vdCBpbXBsZW1lbnRlZCIpfSxlfSgpLG09ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHIsdCxvLGYsZCl7dGhpcy5pZD1yLHRoaXMuZXh0ZW50cz10LHRoaXMuc3RhcnRJbmRleD1vLHRoaXMuZW5kSW5kZXg9Zix0aGlzLmRlZXB0aD1kfXJldHVybiBlfSgpLFE9Nio0KzQrNCsyKzI7ZnVuY3Rpb24geXIoZSxyKXtmb3IodmFyIHQ9bmV3IEFycmF5QnVmZmVyKHIqUSksbz1uZXcgRmxvYXQzMkFycmF5KHQpLGY9bmV3IFVpbnQzMkFycmF5KHQpLGQ9bmV3IFVpbnQxNkFycmF5KHQpLHY9W2VdLG4scztuPXYucG9wKCk7KXM9bi5pZCpRLzQsb1tzXT1uLmV4dGVudHNbMF0sb1tzKzFdPW4uZXh0ZW50c1sxXSxvW3MrMl09bi5leHRlbnRzWzJdLG9bcyszXT1uLmV4dGVudHNbM10sb1tzKzRdPW4uZXh0ZW50c1s0XSxvW3MrNV09bi5leHRlbnRzWzVdLGZbcys2XT1uLnN0YXJ0SW5kZXgsZltzKzddPW4uZW5kSW5kZXgscz1uLmlkKlEvMixuLm5vZGUwJiYoZFtzKzE2XT1uLm5vZGUwLmlkLHYucHVzaChuLm5vZGUwKSksbi5ub2RlMSYmKGRbcysxN109bi5ub2RlMS5pZCx2LnB1c2gobi5ub2RlMSkpO3JldHVybiB0fWZ1bmN0aW9uIGNyKGUscix0LG8sZixkLHYsbixzKXtzPT09dm9pZCAwJiYocz0wKSx0PXQtcyxvPW8tcyxmPWYtcyxkPWQrcyx2PXYrcyxuPW4rczt2YXIgdT0wLHc9MCx5PTAscD0wLGE9MCxoPTA7cmV0dXJuIHIueD49MD8odT0odC1lLngpKnIueCx3PShkLWUueCkqci54KToodT0oZC1lLngpKnIueCx3PSh0LWUueCkqci54KSxyLnk+PTA/KHk9KG8tZS55KSpyLnkscD0odi1lLnkpKnIueSk6KHk9KHYtZS55KSpyLnkscD0oby1lLnkpKnIueSksISh1PnB8fHk+d3x8KHk+dSYmKHU9eSkscDx3JiYodz1wKSxyLno+PTA/KGE9KGYtZS56KSpyLnosaD0obi1lLnopKnIueik6KGE9KG4tZS56KSpyLnosaD0oZi1lLnopKnIueiksdT5ofHxhPncpfHwoYT51JiYodT1hKSxoPHcmJih3PWgpLHc8MCkpfXZhciBZPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShyLHQsbyl7dGhpcy54PXIsdGhpcy55PXQsdGhpcy56PW99cmV0dXJuIGUucHJvdG90eXBlLmNvcHk9ZnVuY3Rpb24ocil7cmV0dXJuIHRoaXMueD1yLngsdGhpcy55PXIueSx0aGlzLno9ci56LHRoaXN9LGUucHJvdG90eXBlLnNldD1mdW5jdGlvbihyLHQsbyl7cmV0dXJuIHRoaXMueD1yLHRoaXMueT10LHRoaXMuej1vLHRoaXN9LGUucHJvdG90eXBlLmZyb21BcnJheT1mdW5jdGlvbihyLHQpe3JldHVybiB0PT09dm9pZCAwJiYodD0wKSx0aGlzLng9clt0XSx0aGlzLnk9clt0KzFdLHRoaXMuej1yW3QrMl0sdGhpc30sZS5wcm90b3R5cGUudG9BcnJheT1mdW5jdGlvbihyLHQpe3JldHVybiByPT09dm9pZCAwJiYocj1bXSksdD09PXZvaWQgMCYmKHQ9MCksclt0XT10aGlzLngsclt0KzFdPXRoaXMueSxyW3QrMl09dGhpcy56LHJ9LGUucHJvdG90eXBlLmFkZD1mdW5jdGlvbihyKXtyZXR1cm4gdGhpcy54Kz1yLngsdGhpcy55Kz1yLnksdGhpcy56Kz1yLnosdGhpc30sZS5wcm90b3R5cGUubXVsdGlwbHlTY2FsYXI9ZnVuY3Rpb24ocil7cmV0dXJuIHRoaXMueCo9cix0aGlzLnkqPXIsdGhpcy56Kj1yLHRoaXN9LGUucHJvdG90eXBlLnN1YlZlY3RvcnM9ZnVuY3Rpb24ocix0KXtyZXR1cm4gdGhpcy54PXIueC10LngsdGhpcy55PXIueS10LnksdGhpcy56PXIuei10LnosdGhpc30sZS5wcm90b3R5cGUuYWRkU2NhbGVkVmVjdG9yPWZ1bmN0aW9uKHIsdCl7cmV0dXJuIHRoaXMueCs9ci54KnQsdGhpcy55Kz1yLnkqdCx0aGlzLnorPXIueip0LHRoaXN9LGUucHJvdG90eXBlLmRvdD1mdW5jdGlvbihyKXtyZXR1cm4gdGhpcy54KnIueCt0aGlzLnkqci55K3RoaXMueipyLnp9LGUucHJvdG90eXBlLmNyb3NzPWZ1bmN0aW9uKHIpe3ZhciB0PXRoaXMueCxvPXRoaXMueSxmPXRoaXMuejtyZXR1cm4gdGhpcy54PW8qci56LWYqci55LHRoaXMueT1mKnIueC10KnIueix0aGlzLno9dCpyLnktbypyLngsdGhpc30sZS5wcm90b3R5cGUuY3Jvc3NWZWN0b3JzPWZ1bmN0aW9uKHIsdCl7dmFyIG89ci54LGY9ci55LGQ9ci56LHY9dC54LG49dC55LHM9dC56O3JldHVybiB0aGlzLng9ZipzLWQqbix0aGlzLnk9ZCp2LW8qcyx0aGlzLno9bypuLWYqdix0aGlzfSxlLnByb3RvdHlwZS5kaXN0YW5jZVRvPWZ1bmN0aW9uKHIpe3JldHVybiBNYXRoLnNxcnQodGhpcy5kaXN0YW5jZVRvU3F1YXJlZChyKSl9LGUucHJvdG90eXBlLmRpc3RhbmNlVG9TcXVhcmVkPWZ1bmN0aW9uKHIpe3ZhciB0PXRoaXMueC1yLngsbz10aGlzLnktci55LGY9dGhpcy56LXIuejtyZXR1cm4gdCp0K28qbytmKmZ9LGUucHJvdG90eXBlLmNsb25lPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBlKHRoaXMueCx0aGlzLnksdGhpcy56KX0sZX0oKSxwcj1mdW5jdGlvbigpe2Z1bmN0aW9uIGUocix0LG8pe3RoaXMudHJpYW5nbGU9cix0aGlzLmludGVyc2VjdGlvblBvaW50PXQsdGhpcy5pbmRleD1vfXJldHVybiBlfSgpLGxyPTFlLTYsUz1uZXcgWSgwLDAsMCksRD1uZXcgWSgwLDAsMCksZz1uZXcgWSgwLDAsMCksWD1uZXcgWSgwLDAsMCksQXI9ZnVuY3Rpb24oZSl7aHIocixlKTtmdW5jdGlvbiByKCl7cmV0dXJuIGUhPT1udWxsJiZlLmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8dGhpc31yZXR1cm4gci5wcm90b3R5cGUuY3JlYXRlVHJlZT1mdW5jdGlvbih0LG8sZil7bz1NYXRoLm1pbihvLDE2KTt2YXIgZD10aGlzLmdldFBvc2l0aW9uQ291bnQoKS8zLHY9ZD42NTUzNT9uZXcgVWludDMyQXJyYXkoZCk6bmV3IFVpbnQxNkFycmF5KGQpLG49bmV3IEZsb2F0MzJBcnJheShkKjYpLHM9W10sdT0wLHc9LTE7aWYoZilmb3IodmFyIHk9MCxwPTAsYT0wLGg9dm9pZCAwLEE9dm9pZCAwLGw9dm9pZCAwLEk9dm9pZCAwLGM9dm9pZCAwLHo9dm9pZCAwLGk9dm9pZCAwO3k8ZDt5Kz0xLHArPTMsYSs9Nil2W3ldPXksdGhpcy5nZXRQb3NpdGlvbkJ5SW5kZXgocCxEKSx0aGlzLmdldFBvc2l0aW9uQnlJbmRleChwKzEsZyksdGhpcy5nZXRQb3NpdGlvbkJ5SW5kZXgocCsyLFgpLGg9ST1ELngsaT1nLngsaTxoJiYoaD1pKSxpPkkmJihJPWkpLGk9WC54LGk8aCYmKGg9aSksaT5JJiYoST1pKSxBPWM9RC55LGk9Zy55LGk8QSYmKEE9aSksaT5jJiYoYz1pKSxpPVgueSxpPEEmJihBPWkpLGk+YyYmKGM9aSksbD16PUQueixpPWcueixpPGwmJihsPWkpLGk+eiYmKHo9aSksaT1YLnosaTxsJiYobD1pKSxpPnomJih6PWkpLG5bYV09aCxuW2ErMV09QSxuW2ErMl09bCxuW2ErM109SSxuW2ErNF09YyxuW2ErNV09ejtlbHNle2Zvcih2YXIgaz0xLzAsSD0xLzAsaj0xLzAscT0tMS8wLE09LTEvMCxQPS0xLzAseT0wLHA9MCxhPTAsaD12b2lkIDAsQT12b2lkIDAsbD12b2lkIDAsST12b2lkIDAsYz12b2lkIDAsej12b2lkIDAsaT12b2lkIDA7eTxkO3krPTEscCs9MyxhKz02KXZbeV09eSx0aGlzLmdldFBvc2l0aW9uQnlJbmRleChwLEQpLHRoaXMuZ2V0UG9zaXRpb25CeUluZGV4KHArMSxnKSx0aGlzLmdldFBvc2l0aW9uQnlJbmRleChwKzIsWCksaD1JPUQueCxpPWcueCxpPGgmJihoPWkpLGk+SSYmKEk9aSksaT1YLngsaTxoJiYoaD1pKSxpPkkmJihJPWkpLEE9Yz1ELnksaT1nLnksaTxBJiYoQT1pKSxpPmMmJihjPWkpLGk9WC55LGk8QSYmKEE9aSksaT5jJiYoYz1pKSxsPXo9RC56LGk9Zy56LGk8bCYmKGw9aSksaT56JiYoej1pKSxpPVgueixpPGwmJihsPWkpLGk+eiYmKHo9aSksblthXT1oLG5bYSsxXT1BLG5bYSsyXT1sLG5bYSszXT1JLG5bYSs0XT1jLG5bYSs1XT16LGg8ayYmKGs9aCksST5xJiYocT1JKSxBPEgmJihIPUEpLGM+TSYmKE09YyksbDxqJiYoaj1sKSx6PlAmJihQPXopO2Y9W2ssSCxqLHEsTSxQXX12YXIgVD1uZXcgbSgrK3csZiwwLGQsMCk7c1t1KytdPVQ7dmFyIE49W10sQj1bMCwxLDJdLFY9ZnVuY3Rpb24oVSxfKXtyZXR1cm4gTltfXS1OW1VdfTtmdW5jdGlvbiBSKFUpe3ZhciBfPVUuc3RhcnRJbmRleCwkPVUuZW5kSW5kZXgsRj1VLmV4dGVudHM7TlswXT1GWzNdLUZbMF0sTlsxXT1GWzRdLUZbMV0sTlsyXT1GWzVdLUZbMl0sQi5zb3J0KFYpO2Zvcih2YXIgVz0wO1c8MztXKyspe2Zvcih2YXIgTD1CW1ddLEc9RltMXStGW0wrM10seD1fLEM9JC0xLEs9LTEsSj12b2lkIDA7eDw9QzspSz09PS0xPyhKPXZbeF0sbltKKjYrTF0rbltKKjYrTCszXTxHP3grKzpLPUopOihKPXZbQ10sbltKKjYrTF0rbltKKjYrTCszXT49R3x8KHZbeF09Six2W0NdPUssSz0tMSx4KyspLEMtLSk7aWYoeD5fJiZ4PCQpe3ZhciBiPW5ldyBtKCsrdyxJcih2LG4sXyx4LGxyKSxfLHgsVS5kZWVwdGgrMSk7Yi5kZWVwdGg8byYmYi5lbmRJbmRleC1iLnN0YXJ0SW5kZXg+dCYmKHNbdSsrXT1iKTt2YXIgTz1uZXcgbSgrK3csSXIodixuLHgsJCxscikseCwkLFUuZGVlcHRoKzEpO08uZGVlcHRoPG8mJk8uZW5kSW5kZXgtTy5zdGFydEluZGV4PnQmJihzW3UrK109TyksVS5ub2RlMD1iLFUubm9kZTE9TyxVLnN0YXJ0SW5kZXg9MCxVLmVuZEluZGV4PTA7YnJlYWt9fX1mb3IoO3U7KVIoc1stLXVdKTtyZXR1cm4gdGhpcy5vZmZzZXRBcnJheT12LHRoaXMucm9vdE5vZGVQYWNrZWQ9eXIoVCx3KzEpLHMubGVuZ3RoPTAsdGhpc30sci5wcm90b3R5cGUudHJpYW5nbGVzSW5TcGhlcmU9ZnVuY3Rpb24odCxvKXtmb3IodmFyIGY9dGhpcy5vZmZzZXRBcnJheSxkPXRoaXMucm9vdE5vZGVQYWNrZWQsdj1uZXcgRmxvYXQzMkFycmF5KGQpLG49bmV3IFVpbnQzMkFycmF5KGQpLHM9bmV3IFVpbnQxNkFycmF5KGQpLHU9WzBdLHc9W10seSxwLGEsaDsoeT11LnBvcCgpKSE9PXZvaWQgMDspe2g9eSpRLzQ7dmFyIEE9c3IodC54LHZbaF0sdltoKzNdKS10LngsbD1zcih0LnksdltoKzFdLHZbaCs0XSktdC55LEk9c3IodC56LHZbaCsyXSx2W2grNV0pLXQuejtpZihBKkErbCpsK0kqSTw9bypvKXtmb3IodmFyIGM9bltoKzZdO2M8bltoKzddO2MrKyl3LnB1c2goZltjXSk7aD15KlEvMixwPXNbaCsxNl0sYT1zW2grMTddLHAmJnUucHVzaChwKSxhJiZ1LnB1c2goYSl9fWZvcih2YXIgej13Lmxlbmd0aCxpPW5ldyBGbG9hdDMyQXJyYXkoeio5KSxjPTA7Yzx6O2MrKyl7dmFyIGs9d1tjXTt0aGlzLmdldFBvc2l0aW9uQnlJbmRleChrLFMpLGlbYyo5XT1TLngsaVtjKjkrMV09Uy55LGlbYyo5KzJdPVMueix0aGlzLmdldFBvc2l0aW9uQnlJbmRleChrKzEsUyksaVtjKjkrM109Uy54LGlbYyo5KzRdPVMueSxpW2MqOSs1XT1TLnosdGhpcy5nZXRQb3NpdGlvbkJ5SW5kZXgoaysyLFMpLGlbYyo5KzZdPVMueCxpW2MqOSs3XT1TLnksaVtjKjkrOF09Uy56fXJldHVybiBpfSxyLnByb3RvdHlwZS5pbnRlcnNlY3RSYXk9ZnVuY3Rpb24odCxvLGYsZCl7Zm9yKHZhciB2PXRoaXMub2Zmc2V0QXJyYXksbj10aGlzLnJvb3ROb2RlUGFja2VkLHM9bmV3IEZsb2F0MzJBcnJheShuKSx1PW5ldyBVaW50MzJBcnJheShuKSx3PW5ldyBVaW50MTZBcnJheShuKSx5PW5ldyBZKDEvby54LDEvby55LDEvby56KSxwPVswXSxhLGgsQSxsOyhhPXAucG9wKCkpIT09dm9pZCAwOylpZihsPWEqUS80LGNyKHQseSxzW2xdLHNbbCsxXSxzW2wrMl0sc1tsKzNdLHNbbCs0XSxzW2wrNV0pKXtmb3IodmFyIEk9dVtsKzZdLGM9dVtsKzddLHo9dm9pZCAwLGk9dm9pZCAwLGs9dm9pZCAwLEg9dC54LGo9dC55LHE9dC56LE09by54LFA9by55LFQ9by56LE49dm9pZCAwLEI9dm9pZCAwLFY9dm9pZCAwLFI9dm9pZCAwLFU9dm9pZCAwLF89dm9pZCAwLCQ9dm9pZCAwLEY9dm9pZCAwLFc9dm9pZCAwLEw9dm9pZCAwLEc9dm9pZCAwLHg9dm9pZCAwLEM9dm9pZCAwLEs9dm9pZCAwLEo9dm9pZCAwLGI9dm9pZCAwLE89dm9pZCAwLGFyPXZvaWQgMCxycj12b2lkIDAsdHI9dm9pZCAwLG9yPXZvaWQgMCxpcj12b2lkIDAsWj12b2lkIDAsdnI9dm9pZCAwLGZyPXZvaWQgMCx1cj12b2lkIDAsbnI9dm9pZCAwO0k8YztJKyspe2lmKHo9dltJXSxpPXoqMyx0aGlzLmdldFBvc2l0aW9uQnlJbmRleChpLFMpLE49Uy54LEI9Uy55LFY9Uy56LHRoaXMuZ2V0UG9zaXRpb25CeUluZGV4KGkrMSxTKSxSPVMueCxVPVMueSxfPVMueix0aGlzLmdldFBvc2l0aW9uQnlJbmRleChpKzIsUyksJD1TLngsRj1TLnksVz1TLnosTD1SLU4sRz1VLUIseD1fLVYsQz0kLU4sSz1GLUIsSj1XLVYsYj1HKkoteCpLLE89eCpDLUwqSixhcj1MKkstRypDLFo9TSpiK1AqTytUKmFyLFo+MClpcj0xO2Vsc2UgaWYoWjwwKWlyPS0xLFo9LVo7ZWxzZSBjb250aW51ZTtycj1ILU4sdHI9ai1CLG9yPXEtVix2cj1pciooTSoodHIqSi1vcipLKStQKihvcipDLXJyKkopK1QqKHJyKkstdHIqQykpLCEodnI8MCkmJihmcj1pciooTSooRypvci14KnRyKStQKih4KnJyLUwqb3IpK1QqKEwqdHItRypycikpLCEoZnI8MCkmJih2citmcj5afHwodXI9LWlyKihycipiK3RyKk8rb3IqYXIpLCEodXI8MCkmJihucj11ci9aLGQucHVzaChuZXcgcHIoW04sQixWLFIsVSxfLCQsRixXXSxbSCtNKm5yLGorUCpucixxK1QqbnJdLHopKSkpKSl9bD1hKlEvMixoPXdbbCsxNl0sQT13W2wrMTddLGgmJnAucHVzaChoKSxBJiZwLnB1c2goQSl9cmV0dXJuIGR9LHJ9KGRyKTtmdW5jdGlvbiBzcihlLHIsdCl7cmV0dXJuIGU8cj9yOmU+dD90OmV9ZnVuY3Rpb24gSXIoZSxyLHQsbyxmKXtpZih0Pj1vKXJldHVyblswLDAsMCwwLDAsMF07Zm9yKHZhciBkPTEvMCx2PTEvMCxuPTEvMCxzPS0xLzAsdT0tMS8wLHc9LTEvMCx5PXQscD12b2lkIDAsYT12b2lkIDA7eTxvO3krKylwPWVbeV0qNixhPXJbcF0sYTxkJiYoZD1hKSxhPXJbcCsxXSxhPHYmJih2PWEpLGE9cltwKzJdLGE8biYmKG49YSksYT1yW3ArM10sYT5zJiYocz1hKSxhPXJbcCs0XSxhPnUmJih1PWEpLGE9cltwKzVdLGE+dyYmKHc9YSk7cmV0dXJuW2QtZix2LWYsbi1mLHMrZix1K2YsdytmXX12YXIgd3I9MWUtNix6cj1bIngiLCJ5IiwieiJdLEU9bmV3IFkoMCwwLDApLFByPWZ1bmN0aW9uKGUpe2hyKHIsZSk7ZnVuY3Rpb24gcigpe3JldHVybiBlIT09bnVsbCYmZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXN9cmV0dXJuIHIucHJvdG90eXBlLmNyZWF0ZVRyZWU9ZnVuY3Rpb24odCxvLGYpe289TWF0aC5taW4obywxNik7dmFyIGQ9dGhpcy5nZXRQb3NpdGlvbkJ5SW5kZXguYmluZCh0aGlzKSx2PXRoaXMuZ2V0UG9zaXRpb25Db3VudCgpLG49dj42NTUzNT9uZXcgVWludDMyQXJyYXkodik6bmV3IFVpbnQxNkFycmF5KHYpLHM9W10sdT0wLHc9LTE7aWYoZilmb3IodmFyIHk9MDt5PHY7eSs9MSluW3ldPXk7ZWxzZXtkKDAsRSk7Zm9yKHZhciBwPUUueCxhPUUueSxoPUUueixBPXAsbD1hLEk9aCx5PTAsYz12b2lkIDAsej12b2lkIDAsaT12b2lkIDA7eTx2O3krPTEpblt5XT15LGQoeSxFKSxjPUUueCx6PUUueSxpPUUueixjPHA/cD1jOmM+QSYmKEE9YyksejxhP2E9ejp6PmwmJihsPXopLGk8aD9oPWk6aT5JJiYoST1pKTtmPVtwLGEsaCxBLGwsSV19dmFyIGs9bmV3IG0oKyt3LGYsMCx2LDApO3NbdSsrXT1rO3ZhciBIPVtdLGo9WzAsMSwyXSxxPWZ1bmN0aW9uKFAsVCl7cmV0dXJuIEhbVF0tSFtQXX07ZnVuY3Rpb24gTShQKXt2YXIgVD1QLnN0YXJ0SW5kZXgsTj1QLmVuZEluZGV4LEI9UC5leHRlbnRzO0hbMF09QlszXS1CWzBdLEhbMV09Qls0XS1CWzFdLEhbMl09Qls1XS1CWzJdO2Zvcih2YXIgVj1qLnNvcnQocSlbMF0sUj16cltWXSxVPShCW1ZdK0JbViszXSkvMixfPVQsJD1OLTEsRj0tMSxXO188PSQ7KUY9PT0tMT8oVz1uW19dLGQoVyxFKSxFW1JdPFU/XysrOkY9Vyk6KFc9blskXSxkKFcsRSksRVtSXT49VXx8KG5bX109VyxuWyRdPUYsRj0tMSxfKyspLCQtLSk7aWYoXz5UKXt2YXIgTD1CLnNsaWNlKCk7TFtWKzNdPVUrd3I7dmFyIEc9bmV3IG0oKyt3LEwsVCxfLFAuZGVlcHRoKzEpO0cuZGVlcHRoPG8mJkcuZW5kSW5kZXgtRy5zdGFydEluZGV4PnQmJihzW3UrK109RyksUC5ub2RlMD1HfWlmKE4+Xyl7dmFyIHg9Qi5zbGljZSgpO3hbVl09VS13cjt2YXIgQz1uZXcgbSgrK3cseCxfLE4sUC5kZWVwdGgrMSk7Qy5kZWVwdGg8byYmQy5lbmRJbmRleC1DLnN0YXJ0SW5kZXg+dCYmKHNbdSsrXT1DKSxQLm5vZGUxPUN9UC5zdGFydEluZGV4PTAsUC5lbmRJbmRleD0wfWZvcig7dTspTShzWy0tdV0pO3JldHVybiB0aGlzLm9mZnNldEFycmF5PW4sdGhpcy5yb290Tm9kZVBhY2tlZD15cihrLHcrMSkscy5sZW5ndGg9MCx0aGlzfSxyLnByb3RvdHlwZS5pbnRlcnNlY3RSYXk9ZnVuY3Rpb24odCxvLGYsZCl7Zm9yKHZhciB2PXRoaXMub2Zmc2V0QXJyYXksbj10aGlzLnJvb3ROb2RlUGFja2VkLHM9bmV3IEZsb2F0MzJBcnJheShuKSx1PW5ldyBVaW50MzJBcnJheShuKSx3PW5ldyBVaW50MTZBcnJheShuKSx5PWYqZixwPW5ldyBZKDEvby54LDEvby55LDEvby56KSxhPVswXSxoLEEsbCxJOyhoPWEucG9wKCkpIT09dm9pZCAwOylpZihJPWgqUS80LGNyKHQscCxzW0ldLHNbSSsxXSxzW0krMl0sc1tJKzNdLHNbSSs0XSxzW0krNV0sZikpe2Zvcih2YXIgYz11W0krNl0sej11W0krN10saT12b2lkIDAsaz12b2lkIDAsSD12b2lkIDAsaj12b2lkIDAscT12b2lkIDAsTT12b2lkIDAsUD12b2lkIDAsVD12b2lkIDAsTj12b2lkIDAsQj12b2lkIDAsVj12b2lkIDAsUj12b2lkIDA7Yzx6O2MrKylpPXZbY10sdGhpcy5nZXRQb3NpdGlvbkJ5SW5kZXgoaSxFKSxrPUUueCxIPUUueSxqPUUueixxPXQueCxNPXQueSxQPXQueixUPW8ueCxOPW8ueSxCPW8ueixWPVQqKGstcSkrTiooSC1NKStCKihqLVApLFY+MCYmKHErPVQqVixNKz1OKlYsUCs9QipWKSxUPWstcSxOPUgtTSxCPWotUCxWPVQqVCtOKk4rQipCLFY8PXkmJmQucHVzaChuZXcgcHIoW2ssSCxqLGssSCxqLGssSCxqXSxbcSxNLFBdLGkpKTtJPWgqUS8yLEE9d1tJKzE2XSxsPXdbSSsxN10sQSYmYS5wdXNoKEEpLGwmJmEucHVzaChsKX1yZXR1cm4gZH0scn0oZHIpO2Z1bmN0aW9uIEJyKGUpe29ubWVzc2FnZT1mdW5jdGlvbihyKXtQcm9taXNlLnJlc29sdmUoci5kYXRhKS50aGVuKGZ1bmN0aW9uKHQpe3JldHVybiBlKHQpfSkudGhlbihmdW5jdGlvbih0KXt2YXIgbz10Lm91dHB1dCxmPXQudHJhbnNmZXI7cmV0dXJuIHBvc3RNZXNzYWdlKG8sZil9KS5jYXRjaChmdW5jdGlvbih0KXtyZXR1cm4gcG9zdE1lc3NhZ2UoeyQkZXJyb3I6dH0pfSl9fUJyKGZ1bmN0aW9uKGUpe3JldHVybiBQcm9taXNlLnJlc29sdmUoZSkudGhlbihmdW5jdGlvbihyKXtmb3IodmFyIHQ9W10sbz1uZXcgU2V0LGY9MCxkPXI7ZjxkLmxlbmd0aDtmKyspe3ZhciB2PWRbZl0sbj12b2lkIDA7aWYodi50eXBlPT09Im1lc2giKW49bmV3IEFyKHYuYXR0cmlidXRlcy5wb3NpdGlvbix2LmluZGljZXMpO2Vsc2UgaWYodi50eXBlPT09InBvaW50cyIpbj1uZXcgUHIodi5hdHRyaWJ1dGVzLnBvc2l0aW9uLHYuaW5kaWNlcyk7ZWxzZSB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgVHlwZSIpO24uY3JlYXRlVHJlZSh2Lm1heEl0ZW1QZXJOb2RlLHYubWF4VHJlZURlcHRoLHYuZXh0ZW50cyk7dmFyIHM9e3R5cGU6di50eXBlLGF0dHJpYnV0ZXM6di5hdHRyaWJ1dGVzLGluZGljZXM6di5pbmRpY2VzLG9mZnNldEFycmF5Om4ub2Zmc2V0QXJyYXkscm9vdE5vZGVQYWNrZWQ6bi5yb290Tm9kZVBhY2tlZH07dC5wdXNoKHMpO3ZhciB1PXZvaWQgMDtmb3IodmFyIHcgaW4gcy5hdHRyaWJ1dGVzKXt2YXIgeT1zLmF0dHJpYnV0ZXNbd107eSYmeS5idWZmZXIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmby5hZGQoeS5idWZmZXIpfXU9cy5pbmRpY2VzLHUmJnUuYnVmZmVyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXImJm8uYWRkKHUuYnVmZmVyKSx1PXMub2Zmc2V0QXJyYXksdSYmdS5idWZmZXIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmby5hZGQodS5idWZmZXIpLG8uYWRkKHMucm9vdE5vZGVQYWNrZWQpfXJldHVybntvdXRwdXQ6dCx0cmFuc2ZlcjpBcnJheS5mcm9tKG8pfX0pfSl9KSgpOwo=",decodeBase64$1=e=>Uint8Array.from(atob(e),t=>t.charCodeAt(0)),blob$2=typeof self<"u"&&self.Blob&&new Blob([decodeBase64$1(encodedJs$1)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper$1(e){let t;try{if(t=blob$2&&(self.URL||self.webkitURL).createObjectURL(blob$2),!t)throw"";const r=new Worker(t,{name:e==null?void 0:e.name});return r.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(t)}),r}catch{return new Worker("data:text/javascript;base64,"+encodedJs$1,{name:e==null?void 0:e.name})}finally{t&&(self.URL||self.webkitURL).revokeObjectURL(t)}}var WorkerPool$1=function(){function e(t,r){this.pool=r,this.workerCreator=t,this.queue=[],this.workers=[],this.workersResolver=[],this.workerStatus=0}return e.prototype.initWorker=function(t){if(this.workerCreator&&!this.workers[t]){var r=this.workerCreator();r.addEventListener("message",this.onMessage.bind(this,t)),this.workers[t]=r}},e.prototype.getIdleWorker=function(){for(var t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1},e.prototype.onMessage=function(t,r){var n=this.workersResolver[t],o=n.resolve,s=n.reject;if(r.data&&"$$error"in r.data?s(r.data.$$error):o(r.data),this.queue.length){var l=this.queue.shift(),u=l.resolve,c=l.reject,h=l.input,f=l.transfer;this.workersResolver[t]={resolve:u,reject:c},this.workers[t].postMessage(h,f)}else this.workerStatus^=1<<t},e.prototype.postMessage=function(t,r){var n=this;return r===void 0&&(r=[]),new Promise(function(o,s){var l=n.getIdleWorker();l!==-1?(n.initWorker(l),n.workerStatus|=1<<l,n.workersResolver[l]={resolve:o,reject:s},n.workers[l].postMessage(t,r)):n.queue.push({resolve:o,reject:s,input:t,transfer:r})})},e.prototype.dispose=function(){this.workers.forEach(function(t){return t.terminate()}),this.workersResolver.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},e}(),bvhWorkerPool=new WorkerPool$1(function(){return new WorkerWrapper$1},4),bvhMeshMap=new Map,scratchRay=new Ray,scratchNormalMatrix=new Matrix3,scratchInverseMatrix=new Matrix4,scratchIntersectionFaceA=new Vector3,scratchIntersectionFaceB=new Vector3,scratchIntersectionFaceC=new Vector3,scratchIntersectionTriangle=new Triangle;function raycastMesh(e,t,r,n){var o,s=e.matrixWorld;scratchInverseMatrix.getInverse(s),scratchRay.copy(r.ray).applyMatrix4(scratchInverseMatrix);for(var l=t.intersectRay(scratchRay.origin,scratchRay.direction,0,[]),u=e.geometry,c=e.material,h=u.groups,f=u.index,m=0,y=l.length;m<y;m++){var A=l[m],M=A.triangle,b=A.index,T=A.intersectionPoint,_=new Vector3(T[0],T[1],T[2]).applyMatrix4(s),S=r.ray.origin.distanceTo(_);if(!(S<r.near||S>r.far)){var C=void 0;if(Array.isArray(c)){if(h)for(var P=b*3,F=0,O=h;F<O.length;F++){var N=O[F];if(P>=N.start&&P-N.start<N.count){C=c[(o=N.materialIndex)!==null&&o!==void 0?o:0];break}}}else C=c;if(C){var V=scratchIntersectionTriangle.set(scratchIntersectionFaceA.set(M[0],M[1],M[2]).applyMatrix4(s),scratchIntersectionFaceB.set(M[3],M[4],M[5]).applyMatrix4(s),scratchIntersectionFaceC.set(M[6],M[7],M[8]).applyMatrix4(s)).getNormal(new Vector3),q=b*3,Q=new Face3(f?f.array[q]:q,f?f.array[q+1]:q+1,f?f.array[q+2]:q+2,V),z=r.ray.direction.dot(V);C.side===FrontSide&&z>=0||C.side===BackSide&&z<=0||n.push({distance:S,object:e,face:Q,point:_,distanceToRay:0,faceIndex:b})}}}}function raycastPoints(e,t,r,n){var o,s,l=e.matrixWorld;scratchNormalMatrix.getNormalMatrix(l),scratchInverseMatrix.getInverse(l);var u=((s=(o=r.params.Points)===null||o===void 0?void 0:o.threshold)!==null&&s!==void 0?s:1)*scratchInverseMatrix.getMaxScaleOnAxis();scratchRay.copy(r.ray).applyMatrix4(scratchInverseMatrix);for(var c=t.intersectRay(scratchRay.origin,scratchRay.direction,u,[]),h=e.geometry,f=h.index,m=h.getAttribute("normal"),y=0,A=c.length;y<A;y++){var M=c[y],b=M.triangle,T=M.index,_=M.intersectionPoint,S=new Vector3(_[0],_[1],_[2]).applyMatrix4(l),C=r.ray.origin.distanceTo(S);if(!(C<r.near||C>r.far)){var P=scratchIntersectionFaceA.set(b[0],b[1],b[2]).applyMatrix4(l),F=f?f.array[T]:T,O=void 0;if(m instanceof BufferAttribute){var N=new Vector3().fromBufferAttribute(m,F).applyNormalMatrix(scratchNormalMatrix);O=new Face3(F,F,F,N)}n.push({distance:C,object:e,face:O,point:S,distanceToRay:S.distanceTo(P),index:T})}}}var BVH_MESH_PROP="__bvh_mesh__",originMeshRaycast=Mesh.prototype.raycast;function overrideMeshRaycast(e,t){var r=getBvhTreeForMesh(this);r?raycastMesh(this,r,e,t):originMeshRaycast.call(this,e,t)}function getBvhTreeForMesh(e){var t=e[BVH_MESH_PROP];return t}function bindBvhTreeForMesh(e,t){var r;Object.assign(e,(r={},r[BVH_MESH_PROP]=t,r.raycast=overrideMeshRaycast,r))}var BVH_POINTS_PROP="__bvh_points__",originPointsRaycast=Points.prototype.raycast;function overridePointsRaycast(e,t){var r=getBvhTreeForPoints(this);r?raycastPoints(this,r,e,t):originPointsRaycast.call(this,e,t)}function getBvhTreeForPoints(e){var t=e[BVH_POINTS_PROP];return t}function bindBvhTreeForPoints(e,t){var r;Object.assign(e,(r={},r[BVH_POINTS_PROP]=t,r.raycast=overridePointsRaycast,r))}function generateBvhTree(e,t,r,n){var o=[];return e.traverse(function(s){(s instanceof Mesh||s instanceof Points)&&s.geometry instanceof BufferGeometry&&o.push(s)}),Promise.resolve().then(function(){for(var s=[],l=new Set,u=null,c=0;c<o.length;c++){var h=o[c],f=h.geometry;if(f instanceof BufferGeometry){var m=void 0;if(h instanceof Mesh?m="mesh":h instanceof Points&&(m="points"),!!m){var y=f.boundingBox,A=y?[y.min.x,y.min.y,y.min.z,y.max.x,y.max.y,y.max.z]:void 0,M={};for(var b in f.attributes){var T=f.attributes[b];T instanceof InterleavedBufferAttribute?(M[b]={array:T.data.array,stride:T.data.stride,offset:T.offset},u=T.data.array,u&&u.buffer instanceof ArrayBuffer&&l.add(u.buffer)):(M[b]={array:T.array},u=T.array,u&&u.buffer instanceof ArrayBuffer&&l.add(u.buffer))}var _=void 0,S=f.getIndex();S&&(S instanceof InterleavedBufferAttribute?(_={array:S.data.array,stride:S.data.stride,offset:S.offset},u=S.data.array,u&&u.buffer instanceof ArrayBuffer&&l.add(u.buffer)):(_={array:S.array},u=S.array,u&&u.buffer instanceof ArrayBuffer&&l.add(u.buffer)));var C={type:m,attributes:M,indices:_,maxItemPerNode:r,maxTreeDepth:n,extents:A};s.push(C)}}}return bvhWorkerPool.postMessage(s,Array.from(l))}).then(function(s){for(var l=0;l<o.length;l++){var u=o[l],c=u.geometry,h=s[l];if(c instanceof BufferGeometry){for(var f in h.attributes){var m=h.attributes[f].array,y=c.attributes[f];y instanceof InterleavedBufferAttribute?y.data.array=m:y.array=m}var A=c.getIndex();if(A&&h.indices){var m=h.indices.array;A instanceof InterleavedBufferAttribute?A.data.array=m:A.array=m}if(u instanceof Mesh){var M=new BVHMesh(h.attributes.position,h.indices);M.offsetArray=h.offsetArray,M.rootNodePacked=h.rootNodePacked,bindBvhTreeForMesh(u,M)}else if(u instanceof Points){var M=new BVHPoints(h.attributes.position,h.indices);M.offsetArray=h.offsetArray,M.rootNodePacked=h.rootNodePacked,bindBvhTreeForPoints(u,M)}}}return e})}var TileNode=function(e){__extends(t,e);function t(r,n,o){o===void 0&&(o=noop$1);var s=e.call(this)||this;return s.contentObject=n,s.name=r,s.materials=[],s.pbmObjects=[],s.disposers=[o],s.add(n),n.traverse(function(l){var u;if(l instanceof Mesh||l instanceof Points){var c=l.material;Array.isArray(c)?(u=s.materials).push.apply(u,c):s.materials.push(c)}(l instanceof PBMMesh||l instanceof PBMSkinnedMesh||l instanceof PBMPointCloud)&&s.pbmObjects.push(l)}),s}return t.prototype.generateBvhTree=function(){return generateBvhTree(this,!0,200,10)},t.prototype.intersectRaycaster=function(r,n,o){n===void 0&&(n=!0),o===void 0&&(o=[]);for(var s=this.children.slice(),l,u=[];l=s.pop();)if(l.visible){l.raycast(r,u);for(var c=0,h=l.children.length;c<h;c++)s.push(l.children[c])}return u.forEach(function(f){var m=0;if((f.object instanceof PBMMesh||f.object instanceof PBMSkinnedMesh||f.object instanceof PBMPointCloud)&&f.face){var y=Array.isArray(f.object.material)?f.object.material[f.face.materialIndex]:f.object.material;y&&(m=y.floorIndex)}f.floor=m}),n&&u.sort(function(f,m){return f.distance-m.distance}),o.push.apply(o,u),o},t.prototype.update=function(r,n,o,s){for(var l=0,u=this.pbmObjects;l<u.length;l++){var c=u[l];c.update(r,n,o,s)}},t.prototype.dispose=function(){for(var r=0,n=this.disposers;r<n.length;r++){var o=n[r];o()}this.disposers.length=0,this.pbmObjects.length=0},t.prototype.clone=function(){return new t(this.name,this.contentObject.clone())},t}(Object3D);function pathJoin(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=[];e=e.map(function(u){return(u??"").trim()}).filter(function(u){return u.length>0&&!/^\/+$/.test(u)});for(var n=0;n<e.length;n++){var o=n===0,s=n===e.length-1,l=e[n];o||(l=l.replace(/^\.\//,"").replace(/^\/+/,"")),s||(l=l.replace(/\/+$/,"")),r.push(l)}return r.join("/")}function normalizeURL(e){var t,r=/^(http\:|https\:|file\:)?\/\/[^/]/.exec(e);if(!r)return e;var n=r[1]||"",o=e.slice(n.length+2),s=o.indexOf("#");s>=0&&(e.slice(s),o=e.slice(0,s));var l=o.indexOf("?");l>=0&&(e.slice(l),o=e.slice(0,l));for(var u=o.split("/"),c=u.shift(),h=(t=u.pop())!==null&&t!==void 0?t:"",f=[],m=0,y=u;m<y.length;m++){var A=y[m];if(!(A===""||A===".")){if(A===".."){f.pop();continue}f.push(A)}}return n+"//"+c+"/"+f.join("/")+"/"+h}function isAbsoluteURL(e){return e.indexOf("//")===0||/^[0-9a-z]+\:/i.test(e)}function normalizeTileHeader(e,t,r){var n;if(e.content){var o=(n=e.content.uri)!==null&&n!==void 0?n:e.content.url;typeof o=="string"&&!isAbsoluteURL(o)&&(e.content.uri=normalizeURL(pathJoin(t,o)))}if(e.transform){for(var s=!1,l=0;l<16;l++){var u=e.transform[l];if(typeof u!="number"||isNaN(u)||!isFinite(u)){s=!0;break}}if(e.transform[15]===0&&(s=!0),s)throw new Error("Invalid Tile Transform: "+JSON.stringify(e.transform))}if(e.children)for(var c=0,h=e.children;c<h.length;c++){var f=h[c];normalizeTileHeader(f,t)}return e}function normalizeTilesetHeader(e,t){if(e.asset||(e.asset={}),e.rootMeta||(e.rootMeta={}),e.rootMeta.taskParameters||(e.rootMeta.taskParameters={}),e.asset.overview){var r=e.asset.overview;isAbsoluteURL(r.imageFile)||(r.imageFile=normalizeURL(pathJoin(t,r.imageFile))),isAbsoluteURL(r.worldFile)||(r.worldFile=normalizeURL(pathJoin(t,r.worldFile)))}if(e.asset.trajectories)for(var n=0;n<e.asset.trajectories.list.length;n++){var o=e.asset.trajectories.list[n];o.file=normalizeURL(pathJoin(t,o.file))}return normalizeTileHeader(e.root,t),e}function initTextures(e,t,r){for(var n,o,s=Promise.resolve(),l=e.slice(),u=function(){for(var c=[],h=0,f=void 0;f=l.shift();){c.push(f);var m=((n=f.image)===null||n===void 0?void 0:n.width)*((o=f.image)===null||o===void 0?void 0:o.height);if(!isNaN(m)&&isFinite(m)&&(h+=m),h>=r)break}s=s.then(function(){return new Promise(function(y){AnimationFrameLoop.shared.add(function(){for(var A=0,M=c;A<M.length;A++){var b=M[A];t.initTexture(b)}y()},!0)})}).catch(function(){})};l.length>0;)u();return s}function appendSearch(e,t){if(t===void 0&&(t=""),(t[0]==="?"||t[0]==="&")&&(t=t.slice(1)),!t)return e;var r=e.indexOf("#"),n="";return r>=0&&(n=e.slice(r),e=e.slice(0,r)),(e[e.length-1]==="?"||e[e.length-1]==="&")&&(e=e.slice(0,-1)),e.indexOf("?")>=0?"".concat(e,"&").concat(t).concat(n):"".concat(e,"?").concat(t).concat(n)}var SIZEOF_UINT32$1=4;function parseHeader$1(e,t,r){var n=new DataView(t);if(e.magic=n.getUint32(r,!0),r+=SIZEOF_UINT32$1,e.version=n.getUint32(r,!0),r+=SIZEOF_UINT32$1,e.byteLength=n.getUint32(r,!0),r+=SIZEOF_UINT32$1,e.version!==1)throw new Error("3D Tile Version ".concat(e.version," not supported"));return r}var _a$4,GL_TYPE;(function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE"})(GL_TYPE||(GL_TYPE={}));var GL_TYPE_TO_ARRAY_TYPE=(_a$4={},_a$4[GL_TYPE.DOUBLE]=Float64Array,_a$4[GL_TYPE.FLOAT]=Float32Array,_a$4[GL_TYPE.UNSIGNED_SHORT]=Uint16Array,_a$4[GL_TYPE.UNSIGNED_INT]=Uint32Array,_a$4[GL_TYPE.UNSIGNED_BYTE]=Uint8Array,_a$4[GL_TYPE.BYTE]=Int8Array,_a$4[GL_TYPE.SHORT]=Int16Array,_a$4[GL_TYPE.INT]=Int32Array,_a$4),NAME_TO_GL_TYPE={DOUBLE:GL_TYPE.DOUBLE,FLOAT:GL_TYPE.FLOAT,UNSIGNED_SHORT:GL_TYPE.UNSIGNED_SHORT,UNSIGNED_INT:GL_TYPE.UNSIGNED_INT,UNSIGNED_BYTE:GL_TYPE.UNSIGNED_BYTE,BYTE:GL_TYPE.BYTE,SHORT:GL_TYPE.SHORT,INT:GL_TYPE.INT};function getArrayType(e){var t=GL_TYPE_TO_ARRAY_TYPE[e];if(!t)throw new Error("Failed to convert GL type");return t}function getByteSize(e){var t=getArrayType(e);return t.BYTES_PER_ELEMENT}function createTypedArray(e,t,r,n){r===void 0&&(r=0);var o=getArrayType(e);if(r%getByteSize(e)!==0){var s=n?t.slice(r,r+n*getByteSize(e)):t.slice(r);return new o(s)}else return new o(t,r,n??(t.byteLength-r)/getByteSize(e))}function glTypeFromName(e){var t=NAME_TO_GL_TYPE[e];if(!t)throw new Error("Failed to convert GL type");return t}var FeatureTable=function(){function e(t,r){this.featuresLength=0,this.cachedTypedArrays={},this.json=t,this.buffer=r;var n=this.getGlobalProperty("POINTS_LENGTH",GL_TYPE.UNSIGNED_INT,1);n&&n.length&&(this.featuresLength=n[0])}return e.prototype.getExtension=function(t){return this.json.extensions&&this.json.extensions[t]},e.prototype.hasProperty=function(t){return!!this.json[t]},e.prototype.getGlobalProperty=function(t,r,n){var o=this.json[t];if(typeof o=="number"){var s=getArrayType(r);return new s([o])}else if(Array.isArray(o)){var s=getArrayType(r);return new s(o)}else if(o&&Number.isFinite(o.byteOffset))return this.getTypedArrayFromBinary(t,r,n,1,o.byteOffset);return null},e.prototype.getPropertyArray=function(t,r,n){var o=this.json[t];return o&&Number.isFinite(o.byteOffset)?("componentType"in o&&(r=glTypeFromName(o.componentType)),this.getTypedArrayFromBinary(t,r,n,this.featuresLength,o.byteOffset)):this.getTypedArrayFromArray(t,r,o)},e.prototype.getProperty=function(t,r,n,o,s){var l=this.json[t];if(!l)return null;var u=this.getPropertyArray(t,r,n);if(n===1)return s[0]=u[o],s;for(var c=0;c<n;++c)s[c]=u[n*o+c];return s},e.prototype.getTypedArrayFromBinary=function(t,r,n,o,s){var l=this.cachedTypedArrays,u=l[t];return u||(u=createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+s,o*n),l[t]=u),u},e.prototype.getTypedArrayFromArray=function(t,r,n){var o=this.cachedTypedArrays,s=o[t];return s||(s=createTypedArray(r,n),o[t]=s),s},e}(),SIZEOF_UINT32=4,DEPRECATION_WARNING="b3dm tile in legacy format.";function getStringFromArrayBuffer(e,t,r){var n=new TextDecoder("utf8"),o=new Uint8Array(e,t,r),s=n.decode(o);return s}function parseTable(e,t,r){return r=parseTablesHeader(e,t,r),r=parseFeatureTable(e,t,r),r=parseBatchTable(e,t,r),r}function parseTablesHeader(e,t,r){var n=new DataView(t),o=0;e.header=e.header||{};var s=n.getUint32(r,!0);r+=SIZEOF_UINT32;var l=n.getUint32(r,!0);r+=SIZEOF_UINT32;var u=n.getUint32(r,!0);r+=SIZEOF_UINT32;var c=n.getUint32(r,!0);return r+=SIZEOF_UINT32,u>=570425344?(r-=SIZEOF_UINT32*2,o=s,u=l,c=0,s=0,l=0,console.warn(DEPRECATION_WARNING)):c>=570425344&&(r-=SIZEOF_UINT32,o=u,u=s,c=l,s=0,l=0,console.warn(DEPRECATION_WARNING)),e.header.featureTableJsonByteLength=s,e.header.featureTableBinaryByteLength=l,e.header.batchTableJsonByteLength=u,e.header.batchTableBinaryByteLength=c,e.header.batchLength=o,r}function parseFeatureTable(e,t,r){var n=e.header||{},o=n.featureTableJsonByteLength,s=n.featureTableBinaryByteLength,l=n.batchLength;if(e.featureTableJson={BATCH_LENGTH:l||0},o&&o>0){var u=getStringFromArrayBuffer(t,r,o);e.featureTableJson=JSON.parse(u)}r+=o||0,e.featureTableBinary=new Uint8Array(t,r,s),r+=s||0,e.rtcCenter=[0,0,0];var c=new FeatureTable(e.featureTableJson,e.featureTableBinary);if(Array.isArray(c.json.RTC_CENTER)){var h=c.json.RTC_CENTER;e.rtcCenter[0]=h[0],e.rtcCenter[1]=h[1],e.rtcCenter[2]=h[2]}else{var h=c.getGlobalProperty("RTC_CENTER",GL_TYPE.FLOAT,3);h&&(e.rtcCenter[0]=h[0],e.rtcCenter[1]=h[1],e.rtcCenter[2]=h[2])}return r}function parseBatchTable(e,t,r){var n=e.header||{},o=n.batchTableJsonByteLength,s=n.batchTableBinaryByteLength;if(o&&o>0){var l=getStringFromArrayBuffer(t,r,o);e.batchTableJson=JSON.parse(l),r+=o,s&&s>0&&(e.batchTableBinary=new Uint8Array(t,r,s),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=s)}return r}function sliceArrayBuffer(e,t,r){var n=r!==void 0?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t),o=new Uint8Array(n);return o.buffer}function parseGlTFArrayBuffer(e,t,r){var n=e.byteLength-r;if(n===0)throw new Error("glTF byte length must be greater than 0.");return r%4!==0&&console.warn("".concat(e.type,": embedded glb is not aligned to a 4-byte boundary.")),e.gltfArrayBuffer=sliceArrayBuffer(t,r,n),e.byteLength}function decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}}var WEBGL_CONSTANTS={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function values(e){var t=[];for(var r in e)t.push(e[r]);return t}function composeDsiposeSet(e){var t=Array.from(e);return function(){for(var r=0,n=t;r<n.length;r++){var o=n[r];typeof o.dispose=="function"&&o.dispose(),typeof o.close=="function"&&o.close()}}}var Parser=function(){function e(t,r,n){this.json=t,this.extensions=r,this.options=n,this.cache=new Map,this.disposeSet=new Set,this.textureSet=new Set,this.nodeNamesUsed={}}return e.prototype.dispose=function(){this.cache.clear(),this.disposeSet.forEach(function(t){typeof t.dispose=="function"&&t.dispose(),typeof t.close=="function"&&t.close()}),this.disposeSet.clear(),this.textureSet.clear(),this.extensions={},this.json={asset:{version:"unknown"}}},e.prototype.markDefs=function(){for(var t=this.json.nodes||[],r=this.json.skins||[],n=this.json.meshes||[],o=0,s=r.length;o<s;o++)for(var l=r[o].joints,u=0,c=l.length;u<c;u++)t[l[u]].isBone=!0;for(var h=0,f=t.length;h<f;h++){var m=t[h];m.mesh!==void 0&&m.skin!==void 0&&(n[m.mesh].isSkinnedMesh=!0)}},e.prototype.parse=function(){var t=this,r=this.json,n=this.extensions;this.markDefs();for(var o=0,s=values(n);o<s.length;o++){var l=s[o];l.markDefs(this)}return Promise.all(values(n).map(function(u){return u.prepare(t)})).then(function(){var u,c,h;return Promise.all([Promise.all(((u=r.scenes)!==null&&u!==void 0?u:[]).map(function(f,m){return t.loadScene(m)})),Promise.all(((c=r.animations)!==null&&c!==void 0?c:[]).map(function(f,m){return t.loadAnimation(m)})),Promise.all(((h=r.cameras)!==null&&h!==void 0?h:[]).map(function(f,m){return t.loadCamera(m)}))])}).then(function(u){var c=u[0],h=u[1],f=u[2],m={json:r,scene:c[r.scene||0],scenes:c,animations:h,cameras:f,textures:[],dispose:noop$1};return m}).then(function(u){return Promise.all(values(n).map(function(c){return c.emitResult(u,t)})).then(function(){return u})}).then(function(u){var c=Array.from(t.textureSet),h=composeDsiposeSet(t.disposeSet);return Object.assign(u,{textures:c,dispose:h}),t.textureSet.clear(),t.disposeSet.clear(),t.dispose(),u})},e.prototype.loadCamera=function(t){var r="camera:"+t,n=this.cache.get(r);if(n)return n;for(var o=null,s=0,l=values(this.extensions);s<l.length;s++){var u=l[s];if(o=u.loadCamera(t,this),o)break}if(!o){var c=void 0,h=this.json.cameras[t],f=h[h.type];f?h.type==="perspective"?c=new PerspectiveCamera(MathUtils.radToDeg(f.yfov),f.aspectRatio||1,f.znear||1,f.zfar||2e6):h.type==="orthographic"?c=new OrthographicCamera(-f.xmag,f.xmag,f.ymag,-f.ymag,f.znear,f.zfar):(console.warn("glTF: Invalid camera type ".concat(h.type,".")),c=new Camera$1):(console.warn("glTF: Missing camera parameters."),c=new Camera$1),h.name&&(c.name=this.createUniqueName(h.name)),o=Promise.resolve(c)}return this.cache.set(r,o),o},e.prototype.loadSkin=function(t){var r="skin:"+t,n=this.cache.get(r);if(n)return n;var o,s=this.json.skins[t],l={joints:s.joints};return s.inverseBindMatrices===void 0?o=Promise.resolve(l):o=this.loadAccessor(s.inverseBindMatrices).then(function(u){return u&&(l.inverseBindMatrices=u),l}),this.cache.set(r,o),o},e.prototype.loadAnimation=function(t){var r="animation:"+t,n=this.cache.get(r);if(n)return n;for(var o=null,s=0,l=values(this.extensions);s<l.length;s++){var u=l[s];if(o=u.loadAnimation(t,this),o)break}if(!o){for(var c=this.json,h=c.animations[t],f=[],m=[],y=[],A=[],M=[],b=0,T=h.channels.length;b<T;b++){var _=h.channels[b],S=h.samplers[_.sampler],C=_.target,P=C.node!==void 0?C.node:C.id,F=h.parameters!==void 0?h.parameters[S.input]:S.input,O=h.parameters!==void 0?h.parameters[S.output]:S.output;f.push(this.loadNode(P)),m.push(this.loadAccessor(F)),y.push(this.loadAccessor(O)),A.push(S),M.push(C)}o=Promise.all([Promise.all(f),Promise.all(m),Promise.all(y),Promise.all(A),Promise.all(M)]).then(function(N){for(var V=N[0],q=N[1],Q=N[2],z=N[3],H=N[4],W=[],J=function(K,Z){var ee=V[K],j=q[K],re=Q[K],pe=z[K],ge=H[K];if(ee===void 0)return"continue";ee.updateMatrix(),ee.matrixAutoUpdate=!0;var _e=void 0;switch(PATH_PROPERTIES[ge.path]){case PATH_PROPERTIES.weights:_e=NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:_e=QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:default:_e=VectorKeyframeTrack;break}var he=ee.name?ee.name:ee.uuid,Fe=pe.interpolation!==void 0?INTERPOLATION[pe.interpolation]:InterpolateLinear,Re=[];PATH_PROPERTIES[ge.path]===PATH_PROPERTIES.weights?ee.traverse(function(We){We.morphTargetInfluences&&Re.push(We.name?We.name:We.uuid)}):Re.push(he);var Le=re.array;if(re.normalized){for(var Se=getNormalizedComponentScale(Le.constructor),we=new Float32Array(Le.length),Ve=0,je=Le.length;Ve<je;Ve++)we[Ve]=Le[Ve]*Se;Le=we}for(var Ve=0,je=Re.length;Ve<je;Ve++){var st=new _e(Re[Ve]+"."+PATH_PROPERTIES[ge.path],j.array,Le,Fe);W.push(st)}},G=0,te=V.length;G<te;G++)J(G);var X=h.name?h.name:"animation_"+t;return new AnimationClip(X,void 0,W)})}return this.cache.set(r,o),o},e.prototype.loadBuffer=function(t){var r=this.json.buffers[t];if(r.type&&r.type!=="arraybuffer")throw new Error("glTF: "+r.type+" buffer type is not supported.");var n="buffer:"+t,o=this.cache.get(n);if(o)return o;for(var s=null,l=0,u=values(this.extensions);l<u.length;l++){var c=u[l];if(s=c.loadBuffer(t,this),s)break}if(!s){var h=this.json.buffers[t];s=this.options.fetcher.ajax(this.resolveResouce(h.uri),{responseType:"arraybuffer"}).then(function(f){return f.body})}return this.cache.set(n,s),s},e.prototype.loadBufferView=function(t){var r="bufferView:"+t,n=this.cache.get(r);if(n)return n;for(var o=null,s=0,l=values(this.extensions);s<l.length;s++){var u=l[s];if(o=u.loadBufferView(t,this),o)break}if(!o){var c=this.json.bufferViews[t];o=this.loadBuffer(c.buffer).then(function(h){var f=c.byteLength||0,m=c.byteOffset||0;return h.slice(m,m+f)})}return this.cache.set(r,o),o},e.prototype.loadAccessor=function(t){var r=this,n="accessor:"+t,o=this.cache.get(n);if(o)return o;var s=null;if(!s){var l=this.json.accessors[t];if(l.bufferView===void 0&&l.sparse===void 0)s=Promise.resolve(null);else{var u=[];l.bufferView!==void 0?u.push(this.loadBufferView(l.bufferView)):u.push(Promise.resolve(null)),l.sparse!==void 0&&(u.push(this.loadBufferView(l.sparse.indices.bufferView)),u.push(this.loadBufferView(l.sparse.values.bufferView))),s=Promise.all(u).then(function(c){var h=c[0],f=WEBGL_TYPE_SIZES[l.type],m=WEBGL_COMPONENT_TYPES[l.componentType],y=m.BYTES_PER_ELEMENT,A=y*f,M=l.byteOffset||0,b=l.bufferView!==void 0?r.json.bufferViews[l.bufferView].byteStride:void 0,T=l.normalized===!0,_,S;if(b&&b!==A){var C=Math.floor(M/b),P="InterleavedBuffer:"+l.bufferView+":"+l.componentType+":"+C+":"+l.count,F=r.cache.get(P);F||(_=new m(h,C*b,l.count*b/y),F=new InterleavedBuffer(_,b/y),r.cache.set(P,F)),S=new InterleavedBufferAttribute(F,f,M%b/y,T)}else h===null?_=new m(l.count*f):_=new m(h,M,l.count*f),S=new BufferAttribute(_,f,T);if(l.sparse!==void 0){var O=WEBGL_TYPE_SIZES.SCALAR,N=WEBGL_COMPONENT_TYPES[l.sparse.indices.componentType],V=l.sparse.indices.byteOffset||0,q=l.sparse.values.byteOffset||0,Q=new N(c[1],V,l.sparse.count*O),z=new m(c[2],q,l.sparse.count*f);h!==null&&(S=new BufferAttribute(S.array.slice(),S.itemSize,S.normalized));for(var H=0,W=Q.length;H<W;H++){var J=Q[H];if(S.setX(J,z[H*f]),f>=2&&S.setY(J,z[H*f+1]),f>=3&&S.setZ(J,z[H*f+2]),f>=4&&S.setW(J,z[H*f+3]),f>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return S})}}return this.cache.set(n,s),s},e.prototype.createPrimitiveKey=function(t){for(var r=0,n=values(this.extensions);r<n.length;r++){var o=n[r],s=o.createPrimitiveKey(t,this);if(s)return s}for(var l="",u=Object.keys(t.attributes).sort(),c=0,h=u.length;c<h;c++)l+=u[c]+":"+t.attributes[u[c]]+";";return t.indices+":"+l+":"+t.mode},e.prototype.loadGeometry=function(t){for(var r=this,n=null,o=0,s=values(this.extensions);o<s.length;o++){var l=s[o];if(n=l.loadGeometry(t,this),n)break}return n||(n=this.addGeometryPrimitiveAttributes(new BufferGeometry,t)),n=n.then(function(u){return r.disposeSet.add(u),u}),n},e.prototype.loadImage=function(t){for(var r=this,n=null,o=0,s=values(this.extensions);o<s.length;o++){var l=s[o];if(n=l.loadImage(t,this),n)break}if(!n){var u=this.json.images[t];if(u.bufferView!==void 0){var c=this.json.bufferViews[u.bufferView];n=this.loadBuffer(c.buffer).then(function(f){var m=c.byteOffset||0,y=c.byteLength||0,A=new Uint8Array(f,m,y),M=new Blob([A],{type:u.mimeType});return createImageBitmapLike(M)})}else if(u.uri){var h=this.resolveResouce(u.uri);n=this.options.fetcher.loadImage(h,{},void 0,void 0,void 0,createImageBitmapLikeImage()).then(function(f){return f.body})}else throw new Error("glTF: Invalid image defs.")}return n=n.then(function(f){return r.disposeSet.add(f),f}),n},e.prototype.loadMaterialAsMeshStandardMaterial=function(t){var r=this,n=[],o=new MeshStandardMaterial;o.color=new Color(1,1,1),o.opacity=1;var s={};for(var l in t.attributes){var u=ATTRIBUTES[l]||l.toLowerCase();s[u]=l}if("color"in s&&(o.vertexColors=!0),"normal"in s||(o.flatShading=!0),"tangent"in s?o.vertexTangents=!0:(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),t.material!==void 0){var c=this.json.materials[t.material];c.name&&(o.name=c.name);var h=c.pbrMetallicRoughness||{};if(Array.isArray(h.baseColorFactor)){var f=h.baseColorFactor;o.color.fromArray(f),o.opacity=f[3]}h.baseColorTexture!==void 0&&n.push(this.createMaterialTexture(h.baseColorTexture).then(function(A){A.encoding=sRGBEncoding,o.map=A,r.disposeSet.add(A)})),o.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,o.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&n.push(this.createMaterialTexture(h.metallicRoughnessTexture).then(function(A){o.metalnessMap=A,o.roughnessMap=A,r.disposeSet.add(A)})),c.doubleSided===!0&&(o.side=DoubleSide);var m=c.alphaMode||ALPHA_MODES.OPAQUE;if(m===ALPHA_MODES.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,m===ALPHA_MODES.MASK&&(o.alphaTest=c.alphaCutoff!==void 0?c.alphaCutoff:.5)),c.normalTexture!==void 0&&(n.push(this.createMaterialTexture(c.normalTexture).then(function(A){o.normalMap=A,r.disposeSet.add(A)})),o.normalScale=new Vector2(1,1),c.normalTexture.scale!==void 0)){var y=c.normalTexture.scale;o.normalScale.set(y,y)}c.occlusionTexture!==void 0&&(n.push(this.createMaterialTexture(c.occlusionTexture).then(function(A){o.aoMap=A,r.disposeSet.add(A)})),c.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=c.occlusionTexture.strength)),c.emissiveFactor!==void 0&&(o.emissive=new Color().fromArray(c.emissiveFactor)),c.emissiveTexture!==void 0&&n.push(this.createMaterialTexture(c.emissiveTexture).then(function(A){o.emissiveMap=A,r.disposeSet.add(A)}))}return this.disposeSet.add(o),Promise.all(n).then(function(){return o})},e.prototype.loadMaterialAsMeshBasicMaterial=function(t){var r=this,n=[],o=new MeshBasicMaterial;o.color=new Color(1,1,1),o.opacity=1;var s={};for(var l in t.attributes){var u=ATTRIBUTES[l]||l.toLowerCase();s[u]=l}if("color"in s&&(o.vertexColors=!0),"normal"in s||(o.flatShading=!0),t.material!==void 0){var c=this.json.materials[t.material];c.name&&(o.name=c.name);var h=c.pbrMetallicRoughness||{};if(Array.isArray(h.baseColorFactor)){var f=h.baseColorFactor;o.color.fromArray(f),o.opacity=f[3]}h.baseColorTexture!==void 0&&n.push(this.createMaterialTexture(h.baseColorTexture).then(function(y){o.map=y,r.disposeSet.add(y)})),c.doubleSided===!0&&(o.side=DoubleSide);var m=c.alphaMode||ALPHA_MODES.OPAQUE;m===ALPHA_MODES.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,m===ALPHA_MODES.MASK&&(o.alphaTest=c.alphaCutoff!==void 0?c.alphaCutoff:.5)),c.occlusionTexture!==void 0&&(n.push(this.createMaterialTexture(c.occlusionTexture).then(function(y){o.aoMap=y,r.disposeSet.add(y)})),c.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=c.occlusionTexture.strength))}return this.disposeSet.add(o),Promise.all(n).then(function(){return o})},e.prototype.loadMaterialAsLineBasicMaterial=function(t){var r=[],n=new LineBasicMaterial;if(n.color=new Color(1,1,1),n.opacity=1,Object.keys(t.attributes).filter(function(c){return ATTRIBUTES[c]==="color"}).length>0&&(n.vertexColors=!0),Object.keys(t.attributes).filter(function(c){return ATTRIBUTES[c]==="tangent"}).length===0&&(n.normalScale&&(n.normalScale.y*=-1),n.clearcoatNormalScale&&(n.clearcoatNormalScale.y*=-1)),t.material!==void 0){var o=this.json.materials[t.material];o.name&&(n.name=o.name);var s=o.pbrMetallicRoughness||{};if(Array.isArray(s.baseColorFactor)){var l=s.baseColorFactor;n.color.fromArray(l),n.opacity=l[3]}o.doubleSided===!0&&(n.side=DoubleSide);var u=o.alphaMode||ALPHA_MODES.OPAQUE;u===ALPHA_MODES.BLEND?(n.transparent=!0,n.depthWrite=!1):(n.transparent=!1,u===ALPHA_MODES.MASK&&(n.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5))}return this.disposeSet.add(n),Promise.all(r).then(function(){return n})},e.prototype.loadMaterialAsPointsMaterial=function(t){var r=this,n=[],o=new PointsMaterial;if(o.color=new Color(1,1,1),o.opacity=1,o.sizeAttenuation=!1,Object.keys(t.attributes).filter(function(h){return ATTRIBUTES[h]==="color"}).length>0&&(o.vertexColors=!0),Object.keys(t.attributes).filter(function(h){return ATTRIBUTES[h]==="tangent"}).length===0&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),t.material!==void 0){var s=this.json.materials[t.material];s.name&&(o.name=s.name);var l=s.pbrMetallicRoughness||{};if(Array.isArray(l.baseColorFactor)){var u=l.baseColorFactor;o.color.fromArray(u),o.opacity=u[3]}l.baseColorTexture!==void 0&&n.push(this.createMaterialTexture(l.baseColorTexture).then(function(h){h.encoding=sRGBEncoding,o.map=h,r.disposeSet.add(h)})),s.doubleSided===!0&&(o.side=DoubleSide);var c=s.alphaMode||ALPHA_MODES.OPAQUE;c===ALPHA_MODES.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,c===ALPHA_MODES.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5))}return this.disposeSet.add(o),Promise.all(n).then(function(){return o})},e.prototype.loadMaterial=function(t){var r=this,n,o=(n=t.mode)!==null&&n!==void 0?n:WEBGL_CONSTANTS.TRIANGLES,s="material:"+this.createPrimitiveKey(t),l=this.cache.get(s);if(l)return l;for(var u=null,c=0,h=values(this.extensions);c<h.length;c++){var f=h[c];if(u=f.loadMaterial(t,this),u)break}if(!u)if(o===WEBGL_CONSTANTS.TRIANGLES||o===WEBGL_CONSTANTS.TRIANGLE_STRIP||o===WEBGL_CONSTANTS.TRIANGLE_FAN)this.extensions.KHR_materials_unlit?u=this.loadMaterialAsMeshBasicMaterial(t):u=this.loadMaterialAsMeshStandardMaterial(t);else if(o===WEBGL_CONSTANTS.LINES||o===WEBGL_CONSTANTS.LINE_STRIP||o===WEBGL_CONSTANTS.LINE_LOOP)u=this.loadMaterialAsLineBasicMaterial(t);else if(o===WEBGL_CONSTANTS.POINTS)u=this.loadMaterialAsPointsMaterial(t);else throw new Error("glTF: Primitive mode unsupported: "+o);return u=u.then(function(m){return Promise.all(values(r.extensions).map(function(y){return y.extendMaterial(m,t,r)})).then(function(){return m})}),this.cache.set(s,u),u},e.prototype.loadTexture=function(t){var r=this,n="texture:"+t,o=this.cache.get(n);if(o)return o;for(var s=null,l=0,u=values(this.extensions);l<u.length;l++){var c=u[l];if(s=c.loadTexture(t,this),s)break}if(!s){var h=this.json.textures[t];s=this.loadImage(h.source).then(function(f){var m=new Texture(f);m.needsUpdate=!0,m.flipY=!1,h.name&&(m.name=h.name);var y=r.json.samplers||{},A=y[h.sampler]||{};return m.magFilter=WEBGL_FILTERS[A.magFilter]||LinearFilter,m.minFilter=WEBGL_FILTERS[A.minFilter]||LinearMipmapLinearFilter,m.wrapS=WEBGL_WRAPPINGS[A.wrapS]||RepeatWrapping,m.wrapT=WEBGL_WRAPPINGS[A.wrapT]||RepeatWrapping,m.onUpdate=function(){f.close()},m})}return s=s.then(function(f){return r.disposeSet.add(f),f}),this.cache.set(n,s),s},e.prototype.loadMesh=function(t){for(var r=this,n=null,o=0,s=values(this.extensions);o<s.length;o++){var l=s[o];if(n=l.loadMesh(t,this),n)break}if(!n){var u=this.json.meshes[t],c=u.primitives,h=Promise.all(c.map(function(m){return r.loadGeometry(m)})),f=Promise.all(c.map(function(m){return r.loadMaterial(m)}));n=Promise.all([h,f]).then(function(m){for(var y=m[0],A=m[1],M=[],b=0;b<c.length;b++){var T=c[b],_=y[b],S=A[b],C=T.mode||WEBGL_CONSTANTS.TRIANGLES,P=void 0;if(C===WEBGL_CONSTANTS.TRIANGLES||C===WEBGL_CONSTANTS.TRIANGLE_STRIP||C===WEBGL_CONSTANTS.TRIANGLE_FAN)if(C===WEBGL_CONSTANTS.TRIANGLE_STRIP?_=r.toGeometryTrianglesDrawMode(_,TriangleStripDrawMode):C===WEBGL_CONSTANTS.TRIANGLE_FAN&&(_=r.toGeometryTrianglesDrawMode(_,TriangleFanDrawMode)),r.disposeSet.add(_),u.isSkinnedMesh){var F=new SkinnedMesh(_,S);_.attributes.skinWeight.normalized||F.normalizeSkinWeights(),P=F}else P=new Mesh(_,S);else if(C===WEBGL_CONSTANTS.POINTS)P=new Points(_,S);else if(C===WEBGL_CONSTANTS.LINES)P=new LineSegments(_,S);else if(C===WEBGL_CONSTANTS.LINE_STRIP)P=new Line(_,S);else if(C===WEBGL_CONSTANTS.LINE_LOOP)P=new LineLoop(_,S);else throw new Error("glTF: Primitive mode unsupported: "+C);if(Object.keys(_.morphAttributes).length>0){if(u.weights!==void 0)for(var O=0,N=u.weights.length;O<N;O++)P.morphTargetInfluences[O]=u.weights[O];if(u.extras&&Array.isArray(u.extras.targetNames)){var V=u.extras.targetNames;if(P.morphTargetInfluences.length===V.length){P.morphTargetDictionary={};for(var O=0,N=V.length;O<N;O++)P.morphTargetDictionary[V[O]]=O}else console.warn("glTF: Invalid extras.targetNames length. Ignoring names.")}}P.name=r.createUniqueName(u.name||"mesh_"+t),M.push(P)}if(M.length===1)return M[0];for(var q=new Group,Q=0,z=M;Q<z.length;Q++){var P=z[Q];q.add(P)}return q})}return n},e.prototype.loadNodeAttachments=function(t){for(var r=[],n=0,o=values(this.extensions);n<o.length;n++){var s=o[n],l=s.loadNodeAttachments(t,this);l&&r.push(l)}return r},e.prototype.loadNode=function(t){var r="node:"+t,n=this.cache.get(r);if(n)return n;var o=this.json,s=o.nodes[t],l=s.name?this.createUniqueName(s.name):"",u=[];s.mesh!==void 0&&u.push(this.loadMesh(s.mesh).then(function(y){if(s.weights!==void 0){var A=s.weights;y.traverse(function(M){if(M instanceof Mesh||M instanceof Line||M instanceof Points)for(var b=0,T=A.length;b<T;b++)M.morphTargetInfluences[b]=A[b]})}return y})),s.camera!==void 0&&u.push(this.loadCamera(s.camera));for(var c=this.loadNodeAttachments(t),h=0,f=c;h<f.length;h++){var m=f[h];u.push(m)}return Promise.all(u).then(function(y){var A;if(s.isBone===!0?A=new Bone:y.length>1?A=new Group:y.length===1?A=y[0]:A=new Object3D,A!==y[0])for(var M=0,b=y.length;M<b;M++)A.add(y[M]);if(s.name&&(A.name=l),s.matrix!==void 0){var T=new Matrix4;T.fromArray(s.matrix),A.applyMatrix4(T)}else s.translation!==void 0&&A.position.fromArray(s.translation),s.rotation!==void 0&&A.quaternion.fromArray(s.rotation),s.scale!==void 0&&A.scale.fromArray(s.scale);return A})},e.prototype.loadScene=function(t){var r=this.json,n=r.scenes[t],o=new Group;n.name&&(o.name=this.createUniqueName(n.name));for(var s=n.nodes||[],l=[],u=0,c=s.length;u<c;u++)l.push(this.buildNodeHierarchy(s[u],o));return Promise.all(l).then(function(){return o})},e.prototype.createMaterialTexture=function(t){var r=this;return this.loadTexture(t.index).then(function(n){for(var o=0,s=values(r.extensions);o<s.length;o++){var l=s[o],u=l.extendTexture(n,t,r);u&&(n=u)}return r.textureSet.add(n),r.disposeSet.add(n),n})},e.prototype.addGeometryPrimitiveAttributes=function(t,r){var n=this,o=r.attributes,s=[],l=function(F){var O=ATTRIBUTES[F]||F.toLowerCase();if(O in t.attributes)return"continue";s.push(u.loadAccessor(o[F]).then(function(N){N&&t.setAttribute(O,N)}))},u=this;for(var c in o)l(c);r.indices!==void 0&&!t.index&&s.push(this.loadAccessor(r.indices).then(function(F){F&&t.setIndex(F)}));var h=new Box3;if(o.POSITION!==void 0){var f=this.json.accessors[o.POSITION],m=f.min,y=f.max;if(m!==void 0&&y!==void 0){if(h.set(new Vector3(m[0],m[1],m[2]),new Vector3(y[0],y[1],y[2])),f.normalized){var A=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[f.componentType]);h.min.multiplyScalar(A),h.max.multiplyScalar(A)}}else console.warn("glTF: Missing min/max properties for accessor POSITION.")}var M=r.targets;if(M!==void 0){for(var b=new Vector3,T=new Vector3,_=0,S=M.length;_<S;_++){var C=M[_];if(C.POSITION!==void 0){var f=this.json.accessors[C.POSITION],m=f.min,y=f.max;if(m!==void 0&&y!==void 0){if(T.setX(Math.max(Math.abs(m[0]),Math.abs(y[0]))),T.setY(Math.max(Math.abs(m[1]),Math.abs(y[1]))),T.setZ(Math.max(Math.abs(m[2]),Math.abs(y[2]))),f.normalized){var A=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[f.componentType]);T.multiplyScalar(A)}b.max(T)}else console.warn("glTF: Missing min/max properties for accessor POSITION.")}}h.expandByVector(b)}t.boundingBox=h;var P=new Sphere;return h.getCenter(P.center),P.radius=h.min.distanceTo(h.max)/2,t.boundingSphere=P,Promise.all(s).then(function(){if(t.attributes.uv&&!t.attributes.uv2&&n.options.copyUV2&&t.setAttribute("uv2",t.attributes.uv),r.targets){for(var F=!1,O=!1,N=0,V=r.targets.length;N<V;N++){var q=r.targets[N];if(q.POSITION!==void 0&&(F=!0),q.NORMAL!==void 0&&(O=!0),F&&O)break}if(!F&&!O)return t;var Q=[];t.morphTargetsRelative=!0;for(var z=function(J,G){var te=r.targets[J];F?Q.push(n.loadAccessor(te.POSITION).then(function(X){X&&(t.morphAttributes.position=t.morphAttributes.position||[],t.morphAttributes.position[J]=X)})):t.attributes.position&&(t.morphAttributes.position=t.morphAttributes.position||[],t.morphAttributes.position[J]=t.attributes.position),O?Q.push(n.loadAccessor(te.NORMAL).then(function(X){X&&(t.morphAttributes.normal=t.morphAttributes.normal||[],t.morphAttributes.normal[J]=X)})):t.attributes.normal&&(t.morphAttributes.normal=t.morphAttributes.normal||[],t.morphAttributes.normal[J]=t.attributes.normal)},N=0,V=r.targets.length;N<V;N++)z(N,V);return Promise.all(Q).then(function(){return t})}else return t})},e.prototype.buildNodeHierarchy=function(t,r){var n=this,o=this.json.nodes[t];return this.loadNode(t).then(function(s){if(o.skin===void 0)return s;var l;return n.loadSkin(o.skin).then(function(u){l=u;for(var c=[],h=0,f=l.joints.length;h<f;h++)c.push(n.loadNode(l.joints[h]));return Promise.all(c)}).then(function(u){return s.traverse(function(c){if(c instanceof SkinnedMesh){for(var h=[],f=[],m=0,y=u.length;m<y;m++){var A=u[m];if(A instanceof Bone){h.push(A);var M=new Matrix4;l.inverseBindMatrices!==void 0&&M.fromArray(l.inverseBindMatrices.array,m*16),f.push(M)}else console.warn('glTF: Joint "%s" could not be found.',l.joints[m])}c.bind(new Skeleton(h,f),c.matrixWorld)}}),s})}).then(function(s){r.add(s);var l=[];if(o.children)for(var u=o.children,c=0,h=u.length;c<h;c++){var f=u[c];l.push(n.buildNodeHierarchy(f,s))}return Promise.all(l).then(function(){return s})})},e.prototype.createUniqueName=function(t){for(var r=PropertyBinding.sanitizeNodeName(t||""),n=r,o=1;this.nodeNamesUsed[n];++o)n=r+"_"+o;return this.nodeNamesUsed[n]=!0,n},e.prototype.resolveResouce=function(t){return/^[a-z]{0,8}\:/i.test(t)?t:pathJoin(this.options.resourcePath,appendSearch(t,this.options.search))},e.prototype.toGeometryTrianglesDrawMode=function(t,r){var n=t.getIndex();if(n===null){var o=[],s=t.getAttribute("position");if(s!==void 0){for(var l=0;l<s.count;l++)o.push(l);t.setIndex(o),n=t.getIndex()}}if(n===null)return console.error("glTF: Undefined position attribute. Processing not possible."),t;var u=n.count-2,c=[];if(r===TriangleFanDrawMode)for(var l=1;l<=u;l++)c.push(n.getX(0)),c.push(n.getX(l)),c.push(n.getX(l+1));else for(var l=0;l<u;l++)l%2===0?(c.push(n.getX(l)),c.push(n.getX(l+1)),c.push(n.getX(l+2))):(c.push(n.getX(l+2)),c.push(n.getX(l+1)),c.push(n.getX(l)));c.length/3!==u&&console.error("glTF: Unable to generate correct amount of triangles.");var h=t.clone();return h.setIndex(c),this.disposeSet.add(h),h},e}();function getNormalizedComponentScale(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("glTF: Unsupported normalized accessor component type.")}}var BaseExtension=function(){function e(){}return e.prototype.markDefs=function(t){},e.prototype.prepare=function(t){},e.prototype.emitResult=function(t,r){},e.prototype.createPrimitiveKey=function(t,r){},e.prototype.extendTexture=function(t,r,n){return null},e.prototype.loadBuffer=function(t,r){return null},e.prototype.loadBufferView=function(t,r){return null},e.prototype.loadImage=function(t,r){return null},e.prototype.loadTexture=function(t,r){return null},e.prototype.loadGeometry=function(t,r){return null},e.prototype.loadMaterial=function(t,r){return null},e.prototype.extendMaterial=function(t,r,n){return Promise.resolve()},e.prototype.loadMesh=function(t,r){return null},e.prototype.loadNodeAttachments=function(t,r){return null},e.prototype.loadCamera=function(t,r){return null},e.prototype.loadAnimation=function(t,r){return null},e}(),KHR_binary_glTF=function(e){__extends(t,e);function t(){var r=e.call(this)||this;return r.header={magic:"",version:0,length:0},r.content="",r.body=null,r}return t.getMagic=function(r){return decodeText(new Uint8Array(r.slice(0,4)))},t.prototype.loadGlbBinary=function(r){var n=new DataView(r,0,t.HEADER_LENGTH);if(this.header={magic:t.getMagic(r),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==t.HEADER_MAGIC)throw new Error("glTF:KHR_binary_glTF: Unsupported.");if(this.header.version<2)throw new Error("glTF:KHR_binary_glTF: Legacy binary file detected.");for(var o=new DataView(r,t.HEADER_LENGTH),s=0,l=null,u=null;s<o.byteLength;){var c=o.getUint32(s,!0);if(s+=4,c!==0){var h=o.getUint32(s,!0);if(s+=4,h===t.CHUNK_TYPES.JSON){var f=new Uint8Array(r,t.HEADER_LENGTH+s,c);l=decodeText(f)}else if(h===t.CHUNK_TYPES.BIN){var m=t.HEADER_LENGTH+s;u=r.slice(m,m+c)}s+=c}}if(l===null)throw new Error("glTF:KHR_binary_glTF: JSON content not found.");this.content=l,this.body=u},t.prototype.loadBuffer=function(r,n){var o=n.json.buffers[r];return o.uri===void 0&&r===0&&this.body?Promise.resolve(this.body):null},t.prototype.clear=function(){this.body=null,this.content=""},t.HEADER_MAGIC="glTF",t.HEADER_LENGTH=12,t.CHUNK_TYPES={JSON:1313821514,BIN:5130562},t}(BaseExtension),defaultDecoderPath="https://vr-public.realsee-cdn.cn/release/static/image/release/five/resource/draco/1.5.6/",defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},Draco=function(){function e(){this.decoderPath=defaultDecoderPath,this.decoderConfig={},this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL=""}return e.prototype.setDecoderPath=function(t){this.decoderPath=t},e.prototype.setDecoderConfig=function(t){return this.decoderConfig=t,this},e.prototype.setWorkerLimit=function(t){return this.workerLimit=t,this},e.prototype.decodeDracoFile=function(t,r,n,o){var s={attributeIDs:n||defaultAttributeIDs,attributeTypes:o||defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(t,s).then(r)},e.prototype.decodeGeometry=function(t,r){var n=this;r===void 0&&(r={attributeIDs:defaultAttributeIDs,attributeTypes:defaultAttributeTypes,useUniqueIDs:!1});for(var o in r.attributeTypes){var s=r.attributeTypes[o];s.BYTES_PER_ELEMENT!==void 0&&(r.attributeTypes[o]=s.name)}var l,u=this.workerNextTaskID++,c=t.byteLength,h=this._getWorker(u,c).then(function(f){return l=f,new Promise(function(m,y){l._callbacks[u]={resolve:m,reject:y},l.postMessage({type:"decode",id:u,taskConfig:r,buffer:t},[t])})}).then(function(f){return n._createGeometry(f.geometry)});return h.catch(function(){return!0}).then(function(){l&&u&&n._releaseTask(l,u)}),h},e.prototype._createGeometry=function(t){var r=new BufferGeometry;t.index&&r.setIndex(new BufferAttribute(t.index.array,1));for(var n=0;n<t.attributes.length;n++){var o=t.attributes[n],s=o.name,l=o.array,u=o.itemSize,c=!(l instanceof Float32Array||l instanceof Float64Array);r.setAttribute(s,new BufferAttribute(l,u,c))}return r},e.prototype._initDecoder=function(){var t=this;if(this.decoderPending)return this.decoderPending;var r=typeof WebAssembly!="object"||this.decoderConfig.type==="js";if(r){var n=ajax(this.decoderPath+"draco_decoder.js",{responseType:"text"}).then(function(s){return s.body});this.decoderPending=n.then(function(s){var l=["/* draco decoder */",s,"","/* worker */",DRACOWorker].join(`
`);t.workerSourceURL=URL.createObjectURL(new Blob([l]))})}else{var n=ajax(this.decoderPath+"draco_wasm_wrapper.js",{responseType:"text"}).then(function(l){return l.body}),o=ajax(this.decoderPath+"draco_decoder.wasm",{responseType:"arraybuffer"}).then(function(l){return l.body});this.decoderPending=Promise.all([n,o]).then(function(l){var u=l[0],c=l[1];t.decoderConfig.wasmBinary=c;var h=["/* draco decoder */",u,"","/* worker */",DRACOWorker].join(`
`);t.workerSourceURL=URL.createObjectURL(new Blob([h]))})}return this.decoderPending},e.prototype._getWorker=function(t,r){var n=this;return this._initDecoder().then(function(){if(n.workerPool.length<n.workerLimit){var o=new Worker(n.workerSourceURL);o._callbacks={},o._taskCosts={},o._taskLoad=0,o.postMessage({type:"init",decoderConfig:n.decoderConfig}),o.onmessage=function(l){var u=l.data;switch(u.type){case"decode":o._callbacks[u.id].resolve(u);break;case"error":o._callbacks[u.id].reject(u);break;default:console.error('DRACO: Unexpected message, "'+u.type+'"')}},n.workerPool.push(o)}else n.workerPool.sort(function(l,u){return l._taskLoad>u._taskLoad?-1:1});var s=n.workerPool[n.workerPool.length-1];return s._taskCosts[t]=r,s._taskLoad+=r,s})},e.prototype._releaseTask=function(t,r){t._taskLoad-=t._taskCosts[r],delete t._callbacks[r],delete t._taskCosts[r]},e.prototype.dispose=function(){for(var t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this},e}(),draco=new Draco,DRACOWorker=`
  let decoderConfig;
  let decoderPending;

  onmessage = function ( e ) {

    const message = e.data;

    switch ( message.type ) {

      case 'init':
        decoderConfig = message.decoderConfig;
        decoderPending = new Promise( function ( resolve/*, reject*/ ) {

          decoderConfig.onModuleLoaded = function ( draco ) {

            // Module is Promise-like. Wrap before resolving to avoid loop.
            resolve( { draco: draco } );

          };

          DracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef

        } );
        break;

      case 'decode':
        const buffer = message.buffer;
        const taskConfig = message.taskConfig;
        decoderPending.then( ( module ) => {

          const draco = module.draco;
          const decoder = new draco.Decoder();
          const decoderBuffer = new draco.DecoderBuffer();
          decoderBuffer.Init( new Int8Array( buffer ), buffer.byteLength );

          try {

            const geometry = decodeGeometry( draco, decoder, decoderBuffer, taskConfig );

            const buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );

            if ( geometry.index ) buffers.push( geometry.index.array.buffer );

            self.postMessage( { type: 'decode', id: message.id, geometry }, buffers );

          } catch ( error ) {

            console.error( error );

            self.postMessage( { type: 'error', id: message.id, error: error.message } );

          } finally {

            draco.destroy( decoderBuffer );
            draco.destroy( decoder );

          }

        } );
        break;

    }

  };

  function decodeGeometry( draco, decoder, decoderBuffer, taskConfig ) {

    const attributeIDs = taskConfig.attributeIDs;
    const attributeTypes = taskConfig.attributeTypes;

    let dracoGeometry;
    let decodingStatus;

    const geometryType = decoder.GetEncodedGeometryType( decoderBuffer );

    if ( geometryType === draco.TRIANGULAR_MESH ) {

      dracoGeometry = new draco.Mesh();
      decodingStatus = decoder.DecodeBufferToMesh( decoderBuffer, dracoGeometry );

    } else if ( geometryType === draco.POINT_CLOUD ) {

      dracoGeometry = new draco.PointCloud();
      decodingStatus = decoder.DecodeBufferToPointCloud( decoderBuffer, dracoGeometry );

    } else {

      throw new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );

    }

    if ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {

      throw new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );

    }

    const geometry = { index: null, attributes: [] };

    // Gather all vertex attributes.
    for ( const attributeName in attributeIDs ) {

      const attributeType = self[ attributeTypes[ attributeName ] ];

      let attribute;
      let attributeID;

      // A Draco file may be created with default vertex attributes, whose attribute IDs
      // are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
      // a Draco file may contain a custom set of attributes, identified by known unique
      // IDs. glTF files always do the latter, and .drc files typically do the former.
      if ( taskConfig.useUniqueIDs ) {

        attributeID = attributeIDs[ attributeName ];
        attribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );

      } else {

        attributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );

        if ( attributeID === - 1 ) continue;

        attribute = decoder.GetAttribute( dracoGeometry, attributeID );

      }

      geometry.attributes.push( decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) );

    }

    // Add index.
    if ( geometryType === draco.TRIANGULAR_MESH ) {

      geometry.index = decodeIndex( draco, decoder, dracoGeometry );

    }

    draco.destroy( dracoGeometry );

    return geometry;

  }

  function decodeIndex( draco, decoder, dracoGeometry ) {

    const numFaces = dracoGeometry.num_faces();
    const numIndices = numFaces * 3;
    const byteLength = numIndices * 4;

    const ptr = draco._malloc( byteLength );
    decoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );
    const index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();
    draco._free( ptr );

    return { array: index, itemSize: 1 };

  }

  function decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {

    const numComponents = attribute.num_components();
    const numPoints = dracoGeometry.num_points();
    const numValues = numPoints * numComponents;
    const byteLength = numValues * attributeType.BYTES_PER_ELEMENT;
    const dataType = getDracoDataType( draco, attributeType );

    const ptr = draco._malloc( byteLength );
    decoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );
    const array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();
    draco._free( ptr );

    return {
      name: attributeName,
      array: array,
      itemSize: numComponents
    };

  }

  function getDracoDataType( draco, attributeType ) {

    switch ( attributeType ) {

      case Float32Array: return draco.DT_FLOAT32;
      case Int8Array: return draco.DT_INT8;
      case Int16Array: return draco.DT_INT16;
      case Int32Array: return draco.DT_INT32;
      case Uint8Array: return draco.DT_UINT8;
      case Uint16Array: return draco.DT_UINT16;
      case Uint32Array: return draco.DT_UINT32;

    }

  }
`,EXTENSION_NAME$6="KHR_draco_mesh_compression",KHR_draco_mesh_compression=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.loadGeometry=function(r,n){return r.extensions&&r.extensions[EXTENSION_NAME$6]?this.decodePrimitive(r,n).then(function(o){return n.addGeometryPrimitiveAttributes(o,r)}):null},t.prototype.decodePrimitive=function(r,n){var o=n.json,s=r.extensions[EXTENSION_NAME$6].bufferView,l=r.extensions[EXTENSION_NAME$6].attributes,u={},c={},h={};for(var f in l){var m=ATTRIBUTES[f]||f.toLowerCase();u[m]=l[f]}for(var f in r.attributes){var m=ATTRIBUTES[f]||f.toLowerCase();if(l[f]!==void 0){var y=o.accessors[r.attributes[f]],A=WEBGL_COMPONENT_TYPES[y.componentType];h[m]=A,c[m]=y.normalized===!0}}return n.loadBufferView(s).then(function(M){return new Promise(function(b){draco.decodeDracoFile(M,function(T){for(var _ in T.attributes){var S=T.attributes[_],C=c[_];C!==void 0&&(S.normalized=C)}b(T)},u,h)})})},t}(BaseExtension),defaultTranscoderPath="https://vr-public.realsee-cdn.cn/release/static/image/release/five/resource/basis/1.16/",KTX2TransferSRGB=2,KTX2_ALPHA_PREMULTIPLIED=1,WorkerPool=function(){function e(t){this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0,this.workerCreator=null}return e.prototype._initWorker=function(t){if(this.workerCreator&&!this.workers[t]){var r=this.workerCreator();r.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=r}},e.prototype._getIdleWorker=function(){for(var t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1},e.prototype._onMessage=function(t,r){var n=this.workersResolve[t];if(n&&n(r),this.queue.length){var o=this.queue.shift(),s=o.resolve,l=o.msg,u=o.transfer;this.workersResolve[t]=s,this.workers[t].postMessage(l,u)}else this.workerStatus^=1<<t},e.prototype.setWorkerCreator=function(t){this.workerCreator=t},e.prototype.setWorkerLimit=function(t){this.pool=t},e.prototype.postMessage=function(t,r){var n=this;return new Promise(function(o){var s=n._getIdleWorker();s!==-1?(n._initWorker(s),n.workerStatus|=1<<s,n.workersResolve[s]=o,n.workers[s].postMessage(t,r)):n.queue.push({resolve:o,msg:t,transfer:r})})},e.prototype.dispose=function(){this.workers.forEach(function(t){return t.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0},e}(),KTX2=function(){function e(){this.transcoderPath=defaultTranscoderPath,this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new WorkerPool(4),this.workerSourceURL="",this.workerConfig=null}return e.prototype.setTranscoderPath=function(t){this.transcoderPath=t},e.prototype.detectSupport=function(t){if(!this.workerConfig){var r=console.warn;console.warn=function(){},this.workerConfig={astcSupported:!!t.extensions.get("WEBGL_compressed_texture_astc"),etc1Supported:!!t.extensions.get("WEBGL_compressed_texture_etc1"),etc2Supported:!!t.extensions.get("WEBGL_compressed_texture_etc"),dxtSupported:!!t.extensions.get("WEBGL_compressed_texture_s3tc"),bptcSupported:!!t.extensions.get("EXT_texture_compression_bptc"),pvrtcSupported:!!t.extensions.get("WEBGL_compressed_texture_pvrtc")||!!t.extensions.get("WEBKIT_WEBGL_compressed_texture_pvrtc")},console.warn=r}return this},e.prototype.init=function(){var t=this;if(!this.transcoderPending){var r=ajax(this.transcoderPath+"basis_transcoder.js",{responseType:"text"}).then(function(o){return o.body}),n=ajax(this.transcoderPath+"basis_transcoder.wasm",{responseType:"arraybuffer"}).then(function(o){return o.body});this.transcoderPending=Promise.all([r,n]).then(function(o){var s=o[0],l=o[1],u=["/* constants */","let _EngineFormat = "+JSON.stringify(EngineFormat),"let _TranscoderFormat = "+JSON.stringify(TranscoderFormat),"let _BasisFormat = "+JSON.stringify(BasisFormat),"/* basis_transcoder.js */",s,"/* worker */",BasisWorker].join(`
`);t.workerSourceURL=URL.createObjectURL(new Blob([u])),t.transcoderBinary=l,t.workerPool.setWorkerCreator(function(){var c=new Worker(t.workerSourceURL),h=t.transcoderBinary.slice(0);return c.postMessage({type:"init",config:t.workerConfig,transcoderBinary:h},[h]),c})})}return this.transcoderPending},e.prototype.parse=function(t){return this._createTexture([t])},e.prototype._createTextureFrom=function(t){var r=t.mipmaps,n=t.width,o=t.height,s=t.format,l=t.type,u=t.error,c=t.dfdTransferFn,h=t.dfdFlags;if(l==="error")return Promise.reject(u);var f=new CompressedTexture(r,n,o,s,UnsignedByteType);return f.minFilter=r.length===1?LinearFilter:LinearMipmapLinearFilter,f.magFilter=LinearFilter,f.generateMipmaps=!1,f.needsUpdate=!0,f.encoding=c===KTX2TransferSRGB?sRGBEncoding:LinearEncoding,f.premultiplyAlpha=!!(h&KTX2_ALPHA_PREMULTIPLIED),Promise.resolve(f)},e.prototype._createTexture=function(t){var r=this,n=this.init().then(function(){return r.workerPool.postMessage({type:"transcode",buffers:t},t)}).then(function(o){return r._createTextureFrom(o.data)});return n},e.prototype.dispose=function(){return URL.revokeObjectURL(this.workerSourceURL),this.workerPool.dispose(),this},e}(),ktx2=new KTX2,BasisFormat={ETC1S:0,UASTC_4x4:1},TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},EngineFormat={RGBAFormat,RGBA_ASTC_4x4_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format,RGB_ETC1_Format,RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format},BasisWorker=`

  let config;
  let transcoderPending;
  let BasisModule;

  const EngineFormat = _EngineFormat; // eslint-disable-line no-undef
  const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef
  const BasisFormat = _BasisFormat; // eslint-disable-line no-undef

  self.addEventListener( 'message', function ( e ) {

    const message = e.data;

    switch ( message.type ) {

      case 'init':
        config = message.config;
        init( message.transcoderBinary );
        break;

      case 'transcode':
        transcoderPending.then( () => {

          try {

            const { width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags } = transcode( message.buffers[ 0 ] );

            const buffers = [];

            for ( let i = 0; i < mipmaps.length; ++ i ) {

              buffers.push( mipmaps[ i ].data.buffer );

            }

            self.postMessage( { type: 'transcode', id: message.id, width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags }, buffers );

          } catch ( error ) {

            console.error( error );

            self.postMessage( { type: 'error', id: message.id, error: error.message } );

          }

        } );
        break;

    }

  } );

  function init( wasmBinary ) {

    transcoderPending = new Promise( ( resolve ) => {

      BasisModule = { wasmBinary, onRuntimeInitialized: resolve };
      BASIS( BasisModule ); // eslint-disable-line no-undef

    } ).then( () => {

      BasisModule.initializeBasis();

      if ( BasisModule.KTX2File === undefined ) {

        console.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );

      }

    } );

  }

  function transcode( buffer ) {

    const ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );

    function cleanup() {

      ktx2File.close();
      ktx2File.delete();

    }

    if ( ! ktx2File.isValid() ) {

      cleanup();
      throw new Error( 'THREE.KTX2Loader:	Invalid or unsupported .ktx2 file' );

    }

    const basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;
    const width = ktx2File.getWidth();
    const height = ktx2File.getHeight();
    const levels = ktx2File.getLevels();
    const hasAlpha = ktx2File.getHasAlpha();
    const dfdTransferFn = ktx2File.getDFDTransferFunc();
    const dfdFlags = ktx2File.getDFDFlags();

    const { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );

    if ( ! width || ! height || ! levels ) {

      cleanup();
      throw new Error( 'THREE.KTX2Loader:	Invalid texture' );

    }

    if ( ! ktx2File.startTranscoding() ) {

      cleanup();
      throw new Error( 'THREE.KTX2Loader: .startTranscoding failed' );

    }

    const mipmaps = [];

    for ( let mip = 0; mip < levels; mip ++ ) {

      const levelInfo = ktx2File.getImageLevelInfo( mip, 0, 0 );
      const mipWidth = levelInfo.origWidth;
      const mipHeight = levelInfo.origHeight;
      const dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, 0, 0, transcoderFormat ) );

      const status = ktx2File.transcodeImage(
        dst,
        mip,
        0,
        0,
        transcoderFormat,
        0,
        - 1,
        - 1,
      );

      if ( ! status ) {

        cleanup();
        throw new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );

      }

      mipmaps.push( { data: dst, width: mipWidth, height: mipHeight } );

    }

    cleanup();

    return { width, height, hasAlpha, mipmaps, format: engineFormat, dfdTransferFn, dfdFlags };

  }

  //

  // Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),
  // device capabilities, and texture dimensions. The list below ranks the formats separately
  // for ETC1S and UASTC.
  //
  // In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at
  // significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently
  // chooses RGBA32 only as a last resort and does not expose that option to the caller.
  const FORMAT_OPTIONS = [
    {
      if: 'astcSupported',
      basisFormat: [ BasisFormat.UASTC_4x4 ],
      transcoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],
      engineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],
      priorityETC1S: Infinity,
      priorityUASTC: 1,
      needsPowerOfTwo: false,
    },
    {
      if: 'bptcSupported',
      basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
      transcoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],
      engineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],
      priorityETC1S: 3,
      priorityUASTC: 2,
      needsPowerOfTwo: false,
    },
    {
      if: 'dxtSupported',
      basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
      transcoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],
      engineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],
      priorityETC1S: 4,
      priorityUASTC: 5,
      needsPowerOfTwo: false,
    },
    {
      if: 'etc2Supported',
      basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
      transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],
      engineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],
      priorityETC1S: 1,
      priorityUASTC: 3,
      needsPowerOfTwo: false,
    },
    {
      if: 'etc1Supported',
      basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
      transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC1 ],
      engineFormat: [ EngineFormat.RGB_ETC1_Format, EngineFormat.RGB_ETC1_Format ],
      priorityETC1S: 2,
      priorityUASTC: 4,
      needsPowerOfTwo: false,
    },
    {
      if: 'pvrtcSupported',
      basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
      transcoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],
      engineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],
      priorityETC1S: 5,
      priorityUASTC: 6,
      needsPowerOfTwo: true,
    },
  ];

  const ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

    return a.priorityETC1S - b.priorityETC1S;

  } );
  const UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

    return a.priorityUASTC - b.priorityUASTC;

  } );

  function getTranscoderFormat( basisFormat, width, height, hasAlpha ) {

    let transcoderFormat;
    let engineFormat;

    const options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;

    for ( let i = 0; i < options.length; i ++ ) {

      const opt = options[ i ];

      if ( ! config[ opt.if ] ) continue;
      if ( ! opt.basisFormat.includes( basisFormat ) ) continue;
      if ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;

      transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];
      engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];

      return { transcoderFormat, engineFormat };

    }

    console.warn( 'KTX2: No suitable compressed texture format found. Decoding to RGBA32.' );

    transcoderFormat = TranscoderFormat.RGBA32;
    engineFormat = EngineFormat.RGBAFormat;

    return { transcoderFormat, engineFormat };

  }

  function isPowerOfTwo( value ) {

    if ( value <= 2 ) return true;

    return ( value & ( value - 1 ) ) === 0 && value !== 0;

  }
`,EXTENSION_NAME$5="KHR_texture_basisu",KHR_texture_basisu=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.loadTexture=function(r,n){var o=n.json.textures[r];if(!o.extensions||!o.extensions[EXTENSION_NAME$5])return null;var s=o.extensions[EXTENSION_NAME$5],l=n.json.images[s.source],u=null;if(l.bufferView!==void 0)u=n.loadBufferView(l.bufferView).then(function(f){return ktx2.parse(f)});else if(l.uri)u=n.options.fetcher.ajax(n.resolveResouce(l.uri),{responseType:"arraybuffer"}).then(function(f){return ktx2.parse(f.body)});else throw new Error("glTF: Invalid image defs.");var c=n.json.samplers||{},h=c[o.sampler]||{};return u=u.then(function(f){return f.magFilter=LinearFilter,f.minFilter=LinearFilter,f.wrapS=WEBGL_WRAPPINGS[h.wrapS]||RepeatWrapping,f.wrapT=WEBGL_WRAPPINGS[h.wrapT]||RepeatWrapping,f}),u},t}(BaseExtension),EXTENSION_NAME$4="KHR_texture_transform",KHR_texture_transform=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.extendTexture=function(r,n,o){var s=n.extensions!==void 0?n.extensions[EXTENSION_NAME$4]:void 0;return s?(s.texCoord!==void 0&&console.warn('glTF: Custom UV sets in "'+EXTENSION_NAME$4+'" extension not yet supported.'),s.offset===void 0&&s.rotation===void 0&&s.scale===void 0||(r=r.clone(),r.needsUpdate=!0,s.offset!==void 0&&r.offset.fromArray(s.offset),s.rotation!==void 0&&(r.rotation=s.rotation),s.scale!==void 0&&r.repeat.fromArray(s.scale)),r):null},t}(BaseExtension),KHR_mesh_quantization=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(BaseExtension),KHR_materials_unlit=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(BaseExtension),meshoptDecoder=function(){var e="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:78Yqdbk:qzezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhlaicefhodnadTmbalc;WFbGglcjdalcjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfglcl4cifcd4hxdndndndnalc9WGgmTmbcbhPcehsawcjdfhzaohHinaraH9Rax6midnaraHaxfgo9RcK6mbczhlinalgic9Wfglawcj;cbffhOdndndndndnaHalco4fRbbalci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOaoRblaoRbbgAco4glalciSgCE86bbawcj;cbfaifglcGfaoclfaCfgORbbaAcl4ciGgCaCciSgCE86bbalcVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbalc7faOaCfgORbbaAciGgAaAciSgAE86bbalctfaOaAfgARbbaoRbegOco4gCaCciSgCE86bbalc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbalc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbalc93faAaCfgARbbaOciGgOaOciSgOE86bbalc94faAaOfgARbbaoRbdgOco4gCaCciSgCE86bbalc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbalc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbalc97faAaCfgARbbaOciGgOaOciSgOE86bbalc98faAaOfgORbbaoRbigoco4gAaAciSgAE86bbalc99faOaAfgORbbaocl4ciGgAaAciSgAE86bbalc9:faOaAfgORbbaocd4ciGgAaAciSgAE86bbalcufaOaAfglRbbaociGgoaociSgoE86bbalaofhoxdkaOaoRbwaoRbbgAcl4glalcsSgCE86bbawcj;cbfaifglcGfaocwfaCfgORbbaAcsGgAaAcsSgAE86bbalcVfaOaAfgORbbaoRbegAcl4gCaCcsSgCE86bbalc7faOaCfgORbbaAcsGgAaAcsSgAE86bbalctfaOaAfgORbbaoRbdgAcl4gCaCcsSgCE86bbalc91faOaCfgORbbaAcsGgAaAcsSgAE86bbalc4faOaAfgORbbaoRbigAcl4gCaCcsSgCE86bbalc93faOaCfgORbbaAcsGgAaAcsSgAE86bbalc94faOaAfgORbbaoRblgAcl4gCaCcsSgCE86bbalc95faOaCfgORbbaAcsGgAaAcsSgAE86bbalc96faOaAfgORbbaoRbvgAcl4gCaCcsSgCE86bbalc97faOaCfgORbbaAcsGgAaAcsSgAE86bbalc98faOaAfgORbbaoRbogAcl4gCaCcsSgCE86bbalc99faOaCfgORbbaAcsGgAaAcsSgAE86bbalc9:faOaAfgORbbaoRbrgocl4gAaAcsSgAE86bbalcufaOaAfglRbbaocsGgoaocsSgoE86bbalaofhoxekaOao8Pbb83bbaOcwfaocwf8Pbb83bbaoczfhokdnaiam9pmbaiczfhlarao9RcL0mekkaiam6miaoTmidnakTmbawaPfRbbhOawcj;cbfhlazhiakhHinaialRbbgAce4cbaAceG9R7aOfgO86bbaiadfhialcefhlaHcufgHmbkkazcefhzaPcefgPad6hsaohHaPad9hmexvkkcbhoasceGmdxikaoaxad2fhPdnakTmbcbhmcehsawcjdfhCinarao9Rax6miaoTmdaoaxfhoawamfRbbhOawcj;cbfhlaChiakhHinaialRbbgAce4cbaAceG9R7aOfgO86bbaiadfhialcefhlaHcufgHmbkaCcefhCamcefgmad6hsamad9hmbkaPhoxikcbhlcehsinarao9Rax6mdaoTmeaoaxfhoalcefglad6hsadal9hmbkaPhoxdkcbhoasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqaombkc9:hoxekcbc99arao9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;xzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhrcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgDc;Ve0mbavc;abfalaDcu7gPcl4fcsGcitfgsydlhzasydbhHdnaDcsGgDak9pmbavaiaPfcsGcdtfydbaxaDEhsaDThDdndnadcd9hmbabarcetfgPaH87ebaPcdfaz87ebaPclfas87ebxekabarcdtfgPaHBdbaPclfazBdbaPcwfasBdbkaxaDfhxavc;abfalcitfgPasBdbaPazBdlavaicdtfasBdbavc;abfalcefcsGglcitfgPaHBdbaPasBdlaiaDfhialcefhlxdkdndnaDcsSmbamaDfaDc987fcefhmxekaocefhDao8SbbgscFeGhPdndnascu9mmbaDhoxekaocvfhoaPcFbGhPcrhsdninaD8SbbgOcFbGastaPVhPaOcu9kmeaDcefhDascrfgsc8J9hmbxdkkaDcefhokaPce4cbaPceG9R7amfhmkdndnadcd9hmbabarcetfgDaH87ebaDcdfaz87ebaDclfam87ebxekabarcdtfgDaHBdbaDclfazBdbaDcwfamBdbkavc;abfalcitfgDamBdbaDazBdlavaicdtfamBdbavc;abfalcefcsGglcitfgDaHBdbaDamBdlaicefhialcefhlxekdnaDcpe0mbaxcefgOavaiaqaDcsGfRbbgscl49RcsGcdtfydbascz6gPEhDavaias9RcsGcdtfydbaOaPfgzascsGgOEhsaOThOdndnadcd9hmbabarcetfgHax87ebaHcdfaD87ebaHclfas87ebxekabarcdtfgHaxBdbaHclfaDBdbaHcwfasBdbkavaicdtfaxBdbavc;abfalcitfgHaDBdbaHaxBdlavaicefgicsGcdtfaDBdbavc;abfalcefcsGcitfgHasBdbaHaDBdlavaiaPfcsGgicdtfasBdbavc;abfalcdfcsGglcitfgDaxBdbaDasBdlalcefhlaiaOfhiazaOfhxxekaxcbaoRbbgHEgAaDc;:eSgDfhzaHcsGhCaHcl4hXdndnaHcs0mbazcefhOxekazhOavaiaX9RcsGcdtfydbhzkdndnaCmbaOcefhxxekaOhxavaiaH9RcsGcdtfydbhOkdndnaDTmbaocefhDxekaocdfhDao8SbegPcFeGhsdnaPcu9kmbaocofhAascFbGhscrhodninaD8SbbgPcFbGaotasVhsaPcu9kmeaDcefhDaocrfgoc8J9hmbkaAhDxekaDcefhDkasce4cbasceG9R7amfgmhAkdndnaXcsSmbaDhsxekaDcefhsaD8SbbgocFeGhPdnaocu9kmbaDcvfhzaPcFbGhPcrhodninas8SbbgDcFbGaotaPVhPaDcu9kmeascefhsaocrfgoc8J9hmbkazhsxekascefhskaPce4cbaPceG9R7amfgmhzkdndnaCcsSmbashoxekascefhoas8SbbgDcFeGhPdnaDcu9kmbascvfhOaPcFbGhPcrhDdninao8SbbgscFbGaDtaPVhPascu9kmeaocefhoaDcrfgDc8J9hmbkaOhoxekaocefhokaPce4cbaPceG9R7amfgmhOkdndnadcd9hmbabarcetfgDaA87ebaDcdfaz87ebaDclfaO87ebxekabarcdtfgDaABdbaDclfazBdbaDcwfaOBdbkavc;abfalcitfgDazBdbaDaABdlavaicdtfaABdbavc;abfalcefcsGcitfgDaOBdbaDazBdlavaicefgicsGcdtfazBdbavc;abfalcdfcsGcitfgDaABdbaDaOBdlavaiaHcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiarcifgrae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:flevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2gdTmbinababydbgecwtcw91:Yaece91cjjj;8ifcjjj98G::NUdbabclfhbadcufgdmbkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",t="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;a9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;d8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgAclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;tzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhrcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgDc;Ve0mbavc;abfalaDcu7gPcl4fcsGcitfgsydlhzasydbhHdnaDcsGgDak9pmbavaiaPfcsGcdtfydbaxaDEhsaDThDdndnadcd9hmbabarcetfgPaH87ebaPcdfaz87ebaPclfas87ebxekabarcdtfgPaHBdbaPclfazBdbaPcwfasBdbkaxaDfhxavc;abfalcitfgPasBdbaPazBdlavaicdtfasBdbavc;abfalcefcsGglcitfgPaHBdbaPasBdlaiaDfhialcefhlxdkdndnaDcsSmbamaDfaDc987fcefhmxekaocefhDao8SbbgscFeGhPdndnascu9mmbaDhoxekaocvfhoaPcFbGhPcrhsdninaD8SbbgOcFbGastaPVhPaOcu9kmeaDcefhDascrfgsc8J9hmbxdkkaDcefhokaPce4cbaPceG9R7amfhmkdndnadcd9hmbabarcetfgDaH87ebaDcdfaz87ebaDclfam87ebxekabarcdtfgDaHBdbaDclfazBdbaDcwfamBdbkavc;abfalcitfgDamBdbaDazBdlavaicdtfamBdbavc;abfalcefcsGglcitfgDaHBdbaDamBdlaicefhialcefhlxekdnaDcpe0mbaxcefgOavaiaqaDcsGfRbbgscl49RcsGcdtfydbascz6gPEhDavaias9RcsGcdtfydbaOaPfgzascsGgOEhsaOThOdndnadcd9hmbabarcetfgHax87ebaHcdfaD87ebaHclfas87ebxekabarcdtfgHaxBdbaHclfaDBdbaHcwfasBdbkavaicdtfaxBdbavc;abfalcitfgHaDBdbaHaxBdlavaicefgicsGcdtfaDBdbavc;abfalcefcsGcitfgHasBdbaHaDBdlavaiaPfcsGgicdtfasBdbavc;abfalcdfcsGglcitfgDaxBdbaDasBdlalcefhlaiaOfhiazaOfhxxekaxcbaoRbbgHEgAaDc;:eSgDfhzaHcsGhCaHcl4hXdndnaHcs0mbazcefhOxekazhOavaiaX9RcsGcdtfydbhzkdndnaCmbaOcefhxxekaOhxavaiaH9RcsGcdtfydbhOkdndnaDTmbaocefhDxekaocdfhDao8SbegPcFeGhsdnaPcu9kmbaocofhAascFbGhscrhodninaD8SbbgPcFbGaotasVhsaPcu9kmeaDcefhDaocrfgoc8J9hmbkaAhDxekaDcefhDkasce4cbasceG9R7amfgmhAkdndnaXcsSmbaDhsxekaDcefhsaD8SbbgocFeGhPdnaocu9kmbaDcvfhzaPcFbGhPcrhodninas8SbbgDcFbGaotaPVhPaDcu9kmeascefhsaocrfgoc8J9hmbkazhsxekascefhskaPce4cbaPceG9R7amfgmhzkdndnaCcsSmbashoxekascefhoas8SbbgDcFeGhPdnaDcu9kmbascvfhOaPcFbGhPcrhDdninao8SbbgscFbGaDtaPVhPascu9kmeaocefhoaDcrfgDc8J9hmbkaOhoxekaocefhokaPce4cbaPceG9R7amfgmhOkdndnadcd9hmbabarcetfgDaA87ebaDcdfaz87ebaDclfaO87ebxekabarcdtfgDaABdbaDclfazBdbaDcwfaOBdbkavc;abfalcitfgDazBdbaDaABdlavaicdtfaABdbavc;abfalcefcsGcitfgDaOBdbaDazBdlavaicefgicsGcdtfazBdbavc;abfalcdfcsGcitfgDaABdbaDaOBdlavaiaHcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiarcifgrae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:flevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:wPliuo97eue978Jjjjjbca9Rhiaec98Ghldndnadcl9hmbdnalTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaipxbbbbbbbbbbbbbbbbgqpklbaiabalcdtfgdaeciGglcdtgv;8qbbdnalTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDaqp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkadaiav;8qbbskdnalTmbcbhvabhdinadczfgxaxpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgval6mbkkalae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabalcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbheabhdinadadpbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbadczfhdaeclfgeav6mbkkdnaval9pmbaialciGgecdtgdVcbc;abad9R;8kbaiabavcdtfgvad;8qbbdnaeTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiad;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var o=WebAssembly.validate(r)?t:e,s,l=WebAssembly.instantiate(u(o),{}).then(function(_){s=_.instance,s.exports.__wasm_call_ctors()});function u(_){for(var S=new Uint8Array(_.length),C=0;C<_.length;++C){var P=_.charCodeAt(C);S[C]=P>96?P-97:P>64?P-39:P+4}for(var F=0,C=0;C<_.length;++C)S[F++]=S[C]<60?n[S[C]]:(S[C]-60)*64+S[++C];return S.buffer.slice(0,F)}function c(_,S,C,P,F,O){var N=s.exports.sbrk,V=C+3&-4,q=N(V*P),Q=N(F.length),z=new Uint8Array(s.exports.memory.buffer);z.set(F,Q);var H=_(q,C,P,Q,F.length);if(H==0&&O&&O(q,V,P),S.set(z.subarray(q,q+C*P)),N(q-N(0)),H!=0)throw new Error("Malformed buffer data: "+H)}var h={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},f={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},m=[],y=0;function A(_){var S={object:new Worker(_),pending:0,requests:{}};return S.object.onmessage=function(C){var P=C.data;S.pending-=P.count,S.requests[P.id][P.action](P.value),delete S.requests[P.id]},S}function M(_){for(var S="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(u(o))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+c.toString()+T.toString(),C=new Blob([S],{type:"text/javascript"}),P=URL.createObjectURL(C),F=0;F<_;++F)m[F]=A(P);URL.revokeObjectURL(P)}function b(_,S,C,P,F){for(var O=m[0],N=1;N<m.length;++N)m[N].pending<O.pending&&(O=m[N]);return new Promise(function(V,q){var Q=new Uint8Array(C),z=y++;O.pending+=_,O.requests[z]={resolve:V,reject:q},O.object.postMessage({id:z,count:_,size:S,source:Q,mode:P,filter:F},[Q.buffer])})}function T(_){l.then(function(){var S=_.data;try{var C=new Uint8Array(S.count*S.size);c(s.exports[S.mode],C,S.count,S.size,S.source,s.exports[S.filter]),self.postMessage({id:S.id,count:S.count,action:"resolve",value:C},[C.buffer])}catch(P){self.postMessage({id:S.id,count:S.count,action:"reject",value:P})}})}return{ready:l,supported:!0,useWorkers:function(_){M(_)},decodeVertexBuffer:function(_,S,C,P,F){c(s.exports.meshopt_decodeVertexBuffer,_,S,C,P,s.exports[h[F]])},decodeIndexBuffer:function(_,S,C,P){c(s.exports.meshopt_decodeIndexBuffer,_,S,C,P)},decodeIndexSequence:function(_,S,C,P){c(s.exports.meshopt_decodeIndexSequence,_,S,C,P)},decodeGltfBuffer:function(_,S,C,P,F,O){c(s.exports[f[F]],_,S,C,P,s.exports[h[O]])},decodeGltfBufferAsync:function(_,S,C,P,F){return m.length>0?b(_,S,C,f[P],h[F]):l.then(function(){var O=new Uint8Array(_*S);return c(s.exports[f[P]],O,_,S,C,s.exports[h[F]]),O})}}}(),EXTENSION_NAME$3="EXT_meshopt_compression",EXT_meshopt_compression=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.loadBufferView=function(r,n){var o=n.json,s=o.bufferViews[r];if(s.extensions&&s.extensions[EXTENSION_NAME$3]){var l=s.extensions[EXTENSION_NAME$3],u=n.loadBuffer(l.buffer);if(!meshoptDecoder.supported){if(o.extensionsRequired&&o.extensionsRequired.indexOf(EXTENSION_NAME$3)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([u,meshoptDecoder.ready]).then(function(c){var h=c[0],f=l.byteOffset||0,m=l.byteLength||0,y=l.count,A=l.byteStride,M=new ArrayBuffer(y*A),b=new Uint8Array(h,f,m);return meshoptDecoder.decodeGltfBuffer(new Uint8Array(M),y,A,b,l.mode,l.filter),M})}else return null},t}(BaseExtension),EXTENSION_NAME$2="EXT_texture_webp",EXT_texture_webp=function(e){__extends(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.supportsWep=!1,r}return t.prototype.prepare=function(r){var n=this;return imageSupport().then(function(o){n.supportsWep=o.webp})},t.prototype.loadTexture=function(r,n){var o=n.json,s=o.textures[r];if(!s.extensions||!s.extensions[EXTENSION_NAME$2]||!this.supportsWep)return null;var l=s.extensions[EXTENSION_NAME$2];return n.loadImage(l.source).then(function(u){var c=new Texture(u);c.needsUpdate=!0,c.flipY=!1,s.name&&(c.name=s.name);var h=n.json.samplers||{},f=h[s.sampler]||{};return c.magFilter=WEBGL_FILTERS[f.magFilter]||LinearFilter,c.minFilter=WEBGL_FILTERS[f.minFilter]||LinearMipmapLinearFilter,c.wrapS=WEBGL_WRAPPINGS[f.wrapS]||RepeatWrapping,c.wrapT=WEBGL_WRAPPINGS[f.wrapT]||RepeatWrapping,c.onUpdate=function(){u.close()},c})},t}(BaseExtension),EXTENSION_NAME$1="CESIUM_RTC",CESIUM_RTC=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.emitResult=function(r,n){if(n.json.extensions[EXTENSION_NAME$1]&&n.json.extensions[EXTENSION_NAME$1].center){var o=n.json.extensions[EXTENSION_NAME$1].center;r.CESIUM_RTC={center:new Vector3().fromArray(o)}}},t}(BaseExtension),PBM_mesh=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.loadMesh=function(r,n){var o=this,s=n.json.meshes[r],l=s.primitives,u=Promise.all(l.map(function(f){return n.loadGeometry(f)})),c=Promise.all(l.map(function(f){return o.loadPBMMaterial(f,n)})),h=Promise.all([u,c]).then(function(f){for(var m=f[0],y=f[1],A=[],M=0;M<l.length;M++){var b=l[M],T=m[M],_=y[M],S=b.mode||WEBGL_CONSTANTS.TRIANGLES,C=void 0;if(S===WEBGL_CONSTANTS.TRIANGLES||S===WEBGL_CONSTANTS.TRIANGLE_STRIP||S===WEBGL_CONSTANTS.TRIANGLE_FAN)if(S===WEBGL_CONSTANTS.TRIANGLE_STRIP?T=n.toGeometryTrianglesDrawMode(T,TriangleStripDrawMode):S===WEBGL_CONSTANTS.TRIANGLE_FAN&&(T=n.toGeometryTrianglesDrawMode(T,TriangleFanDrawMode)),T.clearGroups(),T.addGroup(0,T.index?T.index.count:T.attributes.position.count,0),n.disposeSet.add(T),s.isSkinnedMesh){var P=new PBMSkinnedMesh(T,[_]);T.attributes.skinWeight.normalized||P.normalizeSkinWeights(),C=P}else C=new PBMMesh(T,[_]);else if(S===WEBGL_CONSTANTS.POINTS)C=new PBMPointCloud(T,_);else throw new Error("glTF: Primitive mode unsupported: "+S);if(Object.keys(T.morphAttributes).length>0){if(s.weights!==void 0)for(var F=0,O=s.weights.length;F<O;F++)C.morphTargetInfluences[F]=s.weights[F];if(s.extras&&Array.isArray(s.extras.targetNames)){var N=s.extras.targetNames;if(C.morphTargetInfluences.length===N.length){C.morphTargetDictionary={};for(var F=0,O=N.length;F<O;F++)C.morphTargetDictionary[N[F]]=F}else console.warn("glTF: Invalid extras.targetNames length. Ignoring names.")}}C.name=n.createUniqueName(s.name||"mesh_"+r),A.push(C)}if(A.length===1)return A[0];for(var V=new Group,q=0,Q=A;q<Q.length;q++){var C=Q[q];V.add(C)}return V});return h},t.prototype.loadPBMMaterial=function(r,n){var o,s=(o=r.mode)!==null&&o!==void 0?o:WEBGL_CONSTANTS.TRIANGLES,l=null;if(s===WEBGL_CONSTANTS.TRIANGLES||s===WEBGL_CONSTANTS.TRIANGLE_STRIP||s===WEBGL_CONSTANTS.TRIANGLE_FAN)l=this.loadPBMMeshMaterial(r,n);else if(s===WEBGL_CONSTANTS.POINTS)l=this.loadPBMPointCloudMaterial(r,n);else throw new Error("glTF: Primitive mode unsupported: "+s);return l=l.then(function(u){return Promise.all(values(n.extensions).map(function(c){return c.extendMaterial(u,r,n)})).then(function(){return u})}),l},t.prototype.extendTexture=function(r,n,o){return r.minFilter=LinearFilter,r.magFilter=LinearFilter,r.generateMipmaps=!1,r},t.prototype.loadPBMPointCloudMaterial=function(r,n){var o=new PBMPointCloudMaterial;return Object.keys(r.attributes).filter(function(s){return ATTRIBUTES[s]==="normal"}).length>0&&(o.defines.USE_POINT_NORMAL=!0),n.disposeSet.add(o),Promise.resolve(o)},t.prototype.loadPBMMeshMaterial=function(r,n){var o=[],s=n.extensions.KHR_materials_unlit?"basic":"standard",l=new PBMMeshMaterial(s);l.color=new Color(1,1,1);var u={};for(var c in r.attributes){var h=ATTRIBUTES[c]||c.toLowerCase();u[h]=c}if("color"in u&&(l.vertexColors=!0),"normal"in u||(l.flatShading=!0),"tangent"in u?l.vertexTangents=!0:(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),"_feature_id_rsmask"in u&&(l.defines.USE_VERTEX_MARK=!0),r.material!==void 0){var f=n.json.materials[r.material];f.name&&(l.name=f.name);var m=f.pbrMetallicRoughness||{};if(Array.isArray(m.baseColorFactor)){var y=m.baseColorFactor;l.color=new Color().fromArray(y),l.colorAlpha=y[3]}m.baseColorTexture!==void 0&&o.push(n.createMaterialTexture(m.baseColorTexture).then(function(b){n.disposeSet.add(b),b.encoding=sRGBEncoding,l.map=b})),typeof m.roughnessFactor=="number"&&(l.roughness=m.roughnessFactor),typeof m.metallicFactor=="number"&&(l.metalness=m.metallicFactor),m.metallicRoughnessTexture!==void 0&&o.push(n.createMaterialTexture(m.metallicRoughnessTexture).then(function(b){n.disposeSet.add(b),b.encoding=sRGBEncoding,l.roughnessMap=b,l.metalnessMap=b})),f.doubleSided===!0&&(l.side=DoubleSide);var A=f.alphaMode||ALPHA_MODES.OPAQUE;if(l.alphaMode="OPAQUE",A===ALPHA_MODES.BLEND?(l.alphaMode="BLEND",l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,A===ALPHA_MODES.MASK&&(l.alphaMode="MASK",l.alphaTest=f.alphaCutoff!==void 0?f.alphaCutoff:.5)),f.normalTexture!==void 0&&(o.push(n.createMaterialTexture(f.normalTexture).then(function(b){n.disposeSet.add(b),l.normalMap=b})),l.normalScale=new Vector2(1,1),f.normalTexture.scale!==void 0)){var M=f.normalTexture.scale;l.normalScale.set(M,M)}}return n.disposeSet.add(l),Promise.all(o).then(function(){return l.refreshUniforms(),l})},t}(BaseExtension),EXTENSION_NAME="REALSEE_materials_lightmap",REALSEE_materials_lightmap=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.extendMaterial=function(r,n,o){var s=[];if(o.json.materials&&n.material!==void 0){var l=o.json.materials[n.material],u=l.extensions[EXTENSION_NAME];u&&(u.lightMapTexture!==void 0&&s.push(o.createMaterialTexture(u.lightMapTexture).then(function(c){r.lightMap=c})),u.lightMapIntensity!==void 0&&(r.lightMapIntensity=u.lightMapIntensity))}return Promise.all(s).then(function(){})},t}(BaseExtension),EXTENSIONS={KHR_binary_glTF,KHR_draco_mesh_compression,KHR_texture_basisu,KHR_texture_transform,KHR_mesh_quantization,KHR_materials_unlit,EXT_meshopt_compression,EXT_texture_webp,CESIUM_RTC,REALSEE_materials_lightmap,PBM_mesh};function parseGltf(e,t){var r,n,o,s={},l,u;if(typeof e=="string")u=e;else{var c=EXTENSIONS.KHR_binary_glTF.getMagic(e);if(c===EXTENSIONS.KHR_binary_glTF.HEADER_MAGIC){l=new EXTENSIONS.KHR_binary_glTF;try{l.loadGlbBinary(e)}catch(M){return Promise.reject(M)}s.KHR_binary_glTF=l,u=l.content}else u=decodeText(new Uint8Array(e))}var h=JSON.parse(u);if(t.jsonModify&&(h=t.jsonModify(h)),h.asset===void 0||Number(h.asset.version[0])<2)return Promise.reject(new Error("glTF: Unsupported asset. glTF versions >=2.0 are supported."));if(h.extensionsUsed)for(var f=h.extensionsRequired||[],m=0;m<h.extensionsUsed.length;m++){var y=h.extensionsUsed[m];s[y]||(EXTENSIONS[y]?s[y]=new EXTENSIONS[y]:f.indexOf(y)>=0&&console.warn('glTF: Unknown extension "'+y+'".'))}var A=new Parser(h,s,{copyUV2:(r=t.copyUV2)!==null&&r!==void 0?r:!0,resourcePath:(n=t.resourcePath)!==null&&n!==void 0?n:"",search:(o=t.search)!==null&&o!==void 0?o:"",fetcher:t.fetcher});return A.parse().then(function(M){return l&&l.clear(),M})}function fixNumber(e){return isNaN(e)||!isFinite(e)?0:e}function getGeometryMemoryUsed(e){var t=0;if(e instanceof BufferGeometry){for(var r in e.attributes){var n=e.getAttribute(r),o=4;"BYTES_PER_ELEMENT"in n.array&&typeof n.array.BYTES_PER_ELEMENT=="number"&&(o=n.array.BYTES_PER_ELEMENT),t+=fixNumber(n.count*n.itemSize*o)}var s=e.getIndex();if(s){var o=4;"BYTES_PER_ELEMENT"in s.array&&typeof s.array.BYTES_PER_ELEMENT=="number"&&(o=s.array.BYTES_PER_ELEMENT),t+=fixNumber(s.count*s.itemSize*o)}}else e instanceof Geometry&&(t+=fixNumber(e.faces.length*3*3*4),t+=fixNumber(e.faceVertexUvs.length*3*2*4));return t}function makeComputeBlockRectSizeFunction(e,t,r){return function(n,o,s){var l=(n+e-1)/e|0,u=(o+t-1)/t|0;return l*u*r*s}}function makeComputePaddedRectSizeFunction(e,t,r){return function(n,o,s){return(Math.max(n,e)*Math.max(o,t)/r|0)*s}}var compressedTextureFunctions=new Map([[RGB_S3TC_DXT1_Format,makeComputeBlockRectSizeFunction(4,4,8)],[RGBA_S3TC_DXT1_Format,makeComputeBlockRectSizeFunction(4,4,8)],[RGBA_S3TC_DXT3_Format,makeComputeBlockRectSizeFunction(4,4,16)],[RGBA_S3TC_DXT5_Format,makeComputeBlockRectSizeFunction(4,4,16)],[RGB_ETC1_Format,makeComputeBlockRectSizeFunction(4,4,8)],[RGB_PVRTC_4BPPV1_Format,makeComputePaddedRectSizeFunction(8,8,2)],[RGBA_PVRTC_4BPPV1_Format,makeComputePaddedRectSizeFunction(8,8,2)],[RGB_PVRTC_2BPPV1_Format,makeComputePaddedRectSizeFunction(16,8,4)],[RGBA_PVRTC_2BPPV1_Format,makeComputePaddedRectSizeFunction(16,8,4)],[RGB_ETC2_Format,makeComputeBlockRectSizeFunction(4,4,8)],[RGBA_ETC2_EAC_Format,makeComputeBlockRectSizeFunction(4,4,16)],[RGBA_ASTC_4x4_Format,makeComputeBlockRectSizeFunction(4,4,16)],[SRGB8_ALPHA8_ASTC_4x4_Format,makeComputeBlockRectSizeFunction(4,4,16)],[RGBA_ASTC_5x4_Format,makeComputeBlockRectSizeFunction(5,4,16)],[SRGB8_ALPHA8_ASTC_5x4_Format,makeComputeBlockRectSizeFunction(5,4,16)],[RGBA_ASTC_5x5_Format,makeComputeBlockRectSizeFunction(5,5,16)],[SRGB8_ALPHA8_ASTC_5x5_Format,makeComputeBlockRectSizeFunction(5,5,16)],[RGBA_ASTC_6x5_Format,makeComputeBlockRectSizeFunction(6,5,16)],[SRGB8_ALPHA8_ASTC_6x5_Format,makeComputeBlockRectSizeFunction(6,5,16)],[RGBA_ASTC_6x6_Format,makeComputeBlockRectSizeFunction(6,6,16)],[SRGB8_ALPHA8_ASTC_6x6_Format,makeComputeBlockRectSizeFunction(6,6,16)],[RGBA_ASTC_8x5_Format,makeComputeBlockRectSizeFunction(8,5,16)],[SRGB8_ALPHA8_ASTC_8x5_Format,makeComputeBlockRectSizeFunction(8,5,16)],[RGBA_ASTC_8x6_Format,makeComputeBlockRectSizeFunction(8,6,16)],[SRGB8_ALPHA8_ASTC_8x6_Format,makeComputeBlockRectSizeFunction(8,6,16)],[RGBA_ASTC_8x8_Format,makeComputeBlockRectSizeFunction(8,8,16)],[SRGB8_ALPHA8_ASTC_8x8_Format,makeComputeBlockRectSizeFunction(8,8,16)],[RGBA_ASTC_10x5_Format,makeComputeBlockRectSizeFunction(10,5,16)],[SRGB8_ALPHA8_ASTC_10x5_Format,makeComputeBlockRectSizeFunction(10,5,16)],[RGBA_ASTC_10x6_Format,makeComputeBlockRectSizeFunction(10,6,16)],[SRGB8_ALPHA8_ASTC_10x6_Format,makeComputeBlockRectSizeFunction(10,6,16)],[RGBA_ASTC_10x8_Format,makeComputeBlockRectSizeFunction(10,8,16)],[SRGB8_ALPHA8_ASTC_10x8_Format,makeComputeBlockRectSizeFunction(10,8,16)],[RGBA_ASTC_10x10_Format,makeComputeBlockRectSizeFunction(10,10,16)],[SRGB8_ALPHA8_ASTC_10x10_Format,makeComputeBlockRectSizeFunction(10,10,16)],[RGBA_ASTC_12x10_Format,makeComputeBlockRectSizeFunction(12,10,16)],[SRGB8_ALPHA8_ASTC_12x10_Format,makeComputeBlockRectSizeFunction(12,10,16)],[RGBA_ASTC_12x12_Format,makeComputeBlockRectSizeFunction(12,12,16)],[SRGB8_ALPHA8_ASTC_12x12_Format,makeComputeBlockRectSizeFunction(12,12,16)],[RGBA_BPTC_Format,makeComputeBlockRectSizeFunction(4,4,16)]]);function getTextureMemoryUsed(e){var t=0,r=1;(e.generateMipmaps===!0||e.mipmaps&&e.mipmaps.length>1)&&(r=1.33);for(var n=e instanceof CompressedTexture,o=n?compressedTextureFunctions.get(e.format):void 0,s=[].concat(e.image),l=0,u=s;l<u.length;l++){var c=u[l];if(c instanceof Texture)t+=getTextureMemoryUsed(c);else{var h=c.width,f=h===void 0?1:h,m=c.height,y=m===void 0?1:m,A=c.depth,M=A===void 0?1:A;o?t+=fixNumber(o(f,y,M)*r):t+=fixNumber(f*y*M*4*r)}}return t}var textureSet=new Set,textureNames=["map","alphaMap","bumpMap","normalMap","displacementMap","emissiveMap","specularMap","envMap","flipEnvMap","lightMap","aoMap","gradientMap","metalnessMap","roughnessMap","sheenColorMap","sheenRoughnessMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","iridescenceMap","iridescenceThicknessMap","transmissionMap","thicknessMap","anisotropyMap","specularColorMap","specularIntensityMap"];function getMaterialMemoryUsed(e){var t=0;if(textureSet.clear(),e instanceof ShaderMaterial)for(var r in e.uniforms){var n=e.uniforms[r],o=n&&n.value&&n.value instanceof Texture?n.value:void 0;o instanceof Texture&&(textureSet.has(o)||(t=getTextureMemoryUsed(o),textureSet.add(o)))}else for(var s=0,l=textureNames;s<l.length;s++){var u=l[s],o=e[u];o instanceof Texture&&(textureSet.has(o)||(t=getTextureMemoryUsed(o),textureSet.add(o)))}return textureSet.clear(),t}var sceneSet=new Set;function getMemoryUsage(e){var t=0;return sceneSet.clear(),e.traverse(function(r){if(r instanceof Mesh||r instanceof Line||r instanceof Points){var n=r.geometry;(n instanceof BufferGeometry||n instanceof Geometry)&&(sceneSet.has(n)||(t+=getGeometryMemoryUsed(n),sceneSet.add(n)));for(var o=[].concat(r.material),s=0,l=o;s<l.length;s++){var u=l[s];u instanceof Material&&(sceneSet.has(u)||(t+=getMaterialMemoryUsed(u),sceneSet.add(u)))}}}),sceneSet.clear(),t}var ROTATE_X_MATRIX$6=new Matrix4().fromArray([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]);function loadB3dm(e,t){var r,n;t===void 0&&(t={});var o=(r=t.upAxis)!==null&&r!==void 0?r:"Y",s=(n=t.fetcher)!==null&&n!==void 0?n:new Fetcher({allowHosts:["*"]}),l={uri:e};return Promise.resolve().then(function(){return s.ajax(e,{responseType:"arraybuffer"}).then(function(u){return u.body})}).then(function(u){return Promise.resolve(0).then(function(c){return parseHeader$1(l,u,c)}).then(function(c){return parseTable(l,u,c)}).then(function(c){return parseGlTFArrayBuffer(l,u,c)})}).then(function(){var u;return parseGltf(l.gltfArrayBuffer,{copyUV2:!1,resourcePath:e.slice(0,e.lastIndexOf("/")+1),search:(u=e.split("?")[1])!==null&&u!==void 0?u:"",jsonModify:function(c){var h;if(c.extensionsUsed=(h=c.extensionsUsed)!==null&&h!==void 0?h:[],typeof t.light=="boolean"){var f="KHR_materials_unlit";if(t.light){var m=c.extensionsUsed.indexOf(f);m>=0&&c.extensionsUsed.splice(m,1)}else{var m=c.extensionsUsed.indexOf(f);m===-1&&c.extensionsUsed.push(f)}}{var f="PBM_mesh",m=c.extensionsUsed.indexOf(f);m===-1&&c.extensionsUsed.push(f)}return c},fetcher:s}).then(function(c){var h=new Matrix4;o==="Y"&&h.premultiply(ROTATE_X_MATRIX$6);var f=new Matrix4().setPosition(l.rtcCenter[0],l.rtcCenter[1],l.rtcCenter[2]);if(h.premultiply(f),c.CESIUM_RTC){var m=new Matrix4().setPosition(c.CESIUM_RTC.center);h.premultiply(m)}var y=c.scene;return y.applyMatrix4(h),delete l.featureTableBinary,delete l.batchTableBinary,delete l.gltfArrayBuffer,{type:"b3dm",upAxis:"Z",uri:l.uri,byteLength:l.byteLength,memoryUsage:getMemoryUsage(y),scene:y,textures:c.textures,dispose:function(){return c.dispose()}}})})}const encodedJs="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIEIoYSl7b25tZXNzYWdlPWZ1bmN0aW9uKHIpe1Byb21pc2UucmVzb2x2ZShyLmRhdGEpLnRoZW4oZnVuY3Rpb24obil7cmV0dXJuIGEobil9KS50aGVuKGZ1bmN0aW9uKG4pe3ZhciBlPW4ub3V0cHV0LHQ9bi50cmFuc2ZlcjtyZXR1cm4gcG9zdE1lc3NhZ2UoZSx0KX0pLmNhdGNoKGZ1bmN0aW9uKG4pe3JldHVybiBwb3N0TWVzc2FnZSh7JCRlcnJvcjpufSl9KX19dmFyIHUseTsoZnVuY3Rpb24oYSl7YVthLkJZVEU9NTEyMF09IkJZVEUiLGFbYS5VTlNJR05FRF9CWVRFPTUxMjFdPSJVTlNJR05FRF9CWVRFIixhW2EuU0hPUlQ9NTEyMl09IlNIT1JUIixhW2EuVU5TSUdORURfU0hPUlQ9NTEyM109IlVOU0lHTkVEX1NIT1JUIixhW2EuSU5UPTUxMjRdPSJJTlQiLGFbYS5VTlNJR05FRF9JTlQ9NTEyNV09IlVOU0lHTkVEX0lOVCIsYVthLkZMT0FUPTUxMjZdPSJGTE9BVCIsYVthLkRPVUJMRT01MTMwXT0iRE9VQkxFIn0pKHl8fCh5PXt9KSk7dmFyIGM9KHU9e30sdVt5LkRPVUJMRV09RmxvYXQ2NEFycmF5LHVbeS5GTE9BVF09RmxvYXQzMkFycmF5LHVbeS5VTlNJR05FRF9TSE9SVF09VWludDE2QXJyYXksdVt5LlVOU0lHTkVEX0lOVF09VWludDMyQXJyYXksdVt5LlVOU0lHTkVEX0JZVEVdPVVpbnQ4QXJyYXksdVt5LkJZVEVdPUludDhBcnJheSx1W3kuU0hPUlRdPUludDE2QXJyYXksdVt5LklOVF09SW50MzJBcnJheSx1KSxGPXtET1VCTEU6eS5ET1VCTEUsRkxPQVQ6eS5GTE9BVCxVTlNJR05FRF9TSE9SVDp5LlVOU0lHTkVEX1NIT1JULFVOU0lHTkVEX0lOVDp5LlVOU0lHTkVEX0lOVCxVTlNJR05FRF9CWVRFOnkuVU5TSUdORURfQllURSxCWVRFOnkuQllURSxTSE9SVDp5LlNIT1JULElOVDp5LklOVH07ZnVuY3Rpb24gTyhhKXt2YXIgcj1jW2FdO2lmKCFyKXRocm93IG5ldyBFcnJvcigiRmFpbGVkIHRvIGNvbnZlcnQgR0wgdHlwZSIpO3JldHVybiByfWZ1bmN0aW9uIHAoYSl7dmFyIHI9TyhhKTtyZXR1cm4gci5CWVRFU19QRVJfRUxFTUVOVH1mdW5jdGlvbiBfKGEscixuLGUpe249PT12b2lkIDAmJihuPTApO3ZhciB0PU8oYSk7aWYobiVwKGEpIT09MCl7dmFyIGk9ZT9yLnNsaWNlKG4sbitlKnAoYSkpOnIuc2xpY2Uobik7cmV0dXJuIG5ldyB0KGkpfWVsc2UgcmV0dXJuIG5ldyB0KHIsbixlIT1udWxsP2U6KHIuYnl0ZUxlbmd0aC1uKS9wKGEpKX1mdW5jdGlvbiBsKGEpe3ZhciByPUZbYV07aWYoIXIpdGhyb3cgbmV3IEVycm9yKCJGYWlsZWQgdG8gY29udmVydCBHTCB0eXBlIik7cmV0dXJuIHJ9dmFyIFI9ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKHIsbil7dGhpcy5mZWF0dXJlc0xlbmd0aD0wLHRoaXMuY2FjaGVkVHlwZWRBcnJheXM9e30sdGhpcy5qc29uPXIsdGhpcy5idWZmZXI9bjt2YXIgZT10aGlzLmdldEdsb2JhbFByb3BlcnR5KCJQT0lOVFNfTEVOR1RIIix5LlVOU0lHTkVEX0lOVCwxKTtlJiZlLmxlbmd0aCYmKHRoaXMuZmVhdHVyZXNMZW5ndGg9ZVswXSl9cmV0dXJuIGEucHJvdG90eXBlLmdldEV4dGVuc2lvbj1mdW5jdGlvbihyKXtyZXR1cm4gdGhpcy5qc29uLmV4dGVuc2lvbnMmJnRoaXMuanNvbi5leHRlbnNpb25zW3JdfSxhLnByb3RvdHlwZS5oYXNQcm9wZXJ0eT1mdW5jdGlvbihyKXtyZXR1cm4hIXRoaXMuanNvbltyXX0sYS5wcm90b3R5cGUuZ2V0R2xvYmFsUHJvcGVydHk9ZnVuY3Rpb24ocixuLGUpe3ZhciB0PXRoaXMuanNvbltyXTtpZih0eXBlb2YgdD09Im51bWJlciIpe3ZhciBpPU8obik7cmV0dXJuIG5ldyBpKFt0XSl9ZWxzZSBpZihBcnJheS5pc0FycmF5KHQpKXt2YXIgaT1PKG4pO3JldHVybiBuZXcgaSh0KX1lbHNlIGlmKHQmJk51bWJlci5pc0Zpbml0ZSh0LmJ5dGVPZmZzZXQpKXJldHVybiB0aGlzLmdldFR5cGVkQXJyYXlGcm9tQmluYXJ5KHIsbixlLDEsdC5ieXRlT2Zmc2V0KTtyZXR1cm4gbnVsbH0sYS5wcm90b3R5cGUuZ2V0UHJvcGVydHlBcnJheT1mdW5jdGlvbihyLG4sZSl7dmFyIHQ9dGhpcy5qc29uW3JdO3JldHVybiB0JiZOdW1iZXIuaXNGaW5pdGUodC5ieXRlT2Zmc2V0KT8oImNvbXBvbmVudFR5cGUiaW4gdCYmKG49bCh0LmNvbXBvbmVudFR5cGUpKSx0aGlzLmdldFR5cGVkQXJyYXlGcm9tQmluYXJ5KHIsbixlLHRoaXMuZmVhdHVyZXNMZW5ndGgsdC5ieXRlT2Zmc2V0KSk6dGhpcy5nZXRUeXBlZEFycmF5RnJvbUFycmF5KHIsbix0KX0sYS5wcm90b3R5cGUuZ2V0UHJvcGVydHk9ZnVuY3Rpb24ocixuLGUsdCxpKXt2YXIgbz10aGlzLmpzb25bcl07aWYoIW8pcmV0dXJuIG51bGw7dmFyIHY9dGhpcy5nZXRQcm9wZXJ0eUFycmF5KHIsbixlKTtpZihlPT09MSlyZXR1cm4gaVswXT12W3RdLGk7Zm9yKHZhciBBPTA7QTxlOysrQSlpW0FdPXZbZSp0K0FdO3JldHVybiBpfSxhLnByb3RvdHlwZS5nZXRUeXBlZEFycmF5RnJvbUJpbmFyeT1mdW5jdGlvbihyLG4sZSx0LGkpe3ZhciBvPXRoaXMuY2FjaGVkVHlwZWRBcnJheXMsdj1vW3JdO3JldHVybiB2fHwodj1fKG4sdGhpcy5idWZmZXIuYnVmZmVyLHRoaXMuYnVmZmVyLmJ5dGVPZmZzZXQraSx0KmUpLG9bcl09diksdn0sYS5wcm90b3R5cGUuZ2V0VHlwZWRBcnJheUZyb21BcnJheT1mdW5jdGlvbihyLG4sZSl7dmFyIHQ9dGhpcy5jYWNoZWRUeXBlZEFycmF5cyxpPXRbcl07cmV0dXJuIGl8fChpPV8obixlKSx0W3JdPWkpLGl9LGF9KCk7QihmdW5jdGlvbihhKXtyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGEpLnRoZW4oZnVuY3Rpb24ocil7dmFyIG49bmV3IFIoci5mZWF0dXJlVGFibGVKc29uLHIuZmVhdHVyZVRhYmxlQmluYXJ5KSxlPWQobiksdD1nKG4pLGk9UChuKSxvPVtdO3JldHVybiBlJiZvLnB1c2goZS5hcnJheS5idWZmZXIpLHQmJm8ucHVzaCh0LmFycmF5LmJ1ZmZlciksaSYmby5wdXNoKGkuYXJyYXkuYnVmZmVyKSx7b3V0cHV0Ontwb3NpdGlvbjplLGNvbG9yOnQsbm9ybWFsOml9LHRyYW5zZmVyOm99fSl9KTt2YXIgVT02NTUzNTtmdW5jdGlvbiBkKGEpe2lmKGEuaGFzUHJvcGVydHkoIlBPU0lUSU9OIikpe3ZhciByPWEuZ2V0UHJvcGVydHlBcnJheSgiUE9TSVRJT04iLHkuRkxPQVQsMyk7cmV0dXJue2FycmF5OnIsaXRlbVNpemU6Myxub3JtYWxpemVkOiExfX1lbHNlIGlmKGEuaGFzUHJvcGVydHkoIlBPU0lUSU9OX1FVQU5USVpFRCIpKXt2YXIgbj1hLmdldFByb3BlcnR5QXJyYXkoIlBPU0lUSU9OX1FVQU5USVpFRCIseS5VTlNJR05FRF9TSE9SVCwzKSxlPWEuZ2V0R2xvYmFsUHJvcGVydHkoIlFVQU5USVpFRF9WT0xVTUVfU0NBTEUiLHkuRkxPQVQsMyksdD1hLmdldEdsb2JhbFByb3BlcnR5KCJRVUFOVElaRURfVk9MVU1FX09GRlNFVCIseS5GTE9BVCwzKTtpZighZXx8IXQpdGhyb3cgbmV3IEVycm9yKCJRVUFOVElaRURfVk9MVU1FX1NDQUxFIG9yIFFVQU5USVpFRF9WT0xVTUVfT0ZGU0VUIG5ldmVyIGZvdW5kLiIpO2Zvcih2YXIgaT1uZXcgRmxvYXQzMkFycmF5KG4ubGVuZ3RoKSxvPW4ubGVuZ3RoLzMsdj1lWzBdL1UsQT1lWzFdL1UsTj1lWzJdL1UsRT10WzBdLFM9dFsxXSxzPXRbMl0sVD0wLEk9dm9pZCAwO1Q8bztUKyspST1UKjMsaVtJXT1uW0ldKnYrRSxpWysrSV09bltJXSpBK1MsaVsrK0ldPW5bSV0qTitzO3JldHVybnthcnJheTppLGl0ZW1TaXplOjMsbm9ybWFsaXplZDohMX19cmV0dXJuIG51bGx9ZnVuY3Rpb24gZyhhKXtpZihhLmhhc1Byb3BlcnR5KCJSR0IiKSl7Zm9yKHZhciByPWEuZ2V0UHJvcGVydHlBcnJheSgiUkdCIix5LlVOU0lHTkVEX0JZVEUsMyksbj1yLmxlbmd0aC8zLGU9bmV3IFVpbnQ4QXJyYXkobio0KSx0PTAsaT12b2lkIDAsbz12b2lkIDA7dDxuO3QrKylvPXQqNCxpPXQqMyxlW29dPXJbaV0sZVsrK29dPXJbKytpXSxlWysrb109clsrK2ldO3JldHVybnthcnJheTplLGl0ZW1TaXplOjQsbm9ybWFsaXplZDohMH19ZWxzZSBpZihhLmhhc1Byb3BlcnR5KCJSR0JBIikpe3ZhciByPWEuZ2V0UHJvcGVydHlBcnJheSgiUkdCQSIseS5VTlNJR05FRF9CWVRFLDQpO3JldHVybnthcnJheTpyLGl0ZW1TaXplOjQsbm9ybWFsaXplZDohMH19ZWxzZSBpZihhLmhhc1Byb3BlcnR5KCJSR0I1NjUiKSl7Zm9yKHZhciByPWEuZ2V0UHJvcGVydHlBcnJheSgiUkdCNTY1Iix5LlVOU0lHTkVEX1NIT1JULDEpLG49ci5sZW5ndGgsZT1uZXcgVWludDhBcnJheShuKjQpLHQ9MCx2PXZvaWQgMCxBPXZvaWQgMDt0PG47dCsrKUE9clt0XSx2PXQqNCxlW3ZdPShBPj4xMSYzMSk8PDMsZVsrK3ZdPShBPj41JjYzKTw8MixlWysrdl09KEEmMzEpPDwzO3JldHVybnthcnJheTplLGl0ZW1TaXplOjQsbm9ybWFsaXplZDohMH19cmV0dXJuIG51bGx9dmFyIEc9MjU1LGg9MTI3LEQ9Mi9HO2Z1bmN0aW9uIFAoYSl7aWYoYS5oYXNQcm9wZXJ0eSgiTk9STUFMIikpe2Zvcih2YXIgcj1hLmdldFByb3BlcnR5QXJyYXkoIk5PUk1BTCIseS5GTE9BVCwzKSxuPXIubGVuZ3RoLzMsZT1uZXcgSW50OEFycmF5KG4qNCksdD0wLGk9dm9pZCAwLG89dm9pZCAwO3Q8bjt0Kyspbz10KjQsaT10KjMsZVtvXT1yW2ldKmgsZVsrK29dPXJbKytpXSpoLGVbKytvXT1yWysraV0qaDtyZXR1cm57YXJyYXk6ZSxpdGVtU2l6ZTo0LG5vcm1hbGl6ZWQ6ITB9fWVsc2UgaWYoYS5oYXNQcm9wZXJ0eSgiTk9STUFMX09DVDE2UCIpKXtmb3IodmFyIHI9YS5nZXRQcm9wZXJ0eUFycmF5KCJOT1JNQUxfT0NUMTZQIix5LlVOU0lHTkVEX0JZVEUsMiksbj1yLmxlbmd0aC8yLGU9bmV3IEludDhBcnJheShuKjQpLHQ9MCx2PXZvaWQgMCxBPXZvaWQgMCxOPXZvaWQgMCxFPXZvaWQgMCxTPXZvaWQgMCxzPXZvaWQgMCxUPXZvaWQgMDt0PG47dCsrKXY9dCoyLEE9clt2XSpELTEsTj1yWysrdl0qRC0xLFM9QTwwPy1BOkEscz1OPDA/LU46TixFPTEtKFMrcyksRTwwJiYoQT0oMS1zKSooQTwwPy0xOjEpLE49KDEtUykqKE48MD8tMToxKSksVD1NYXRoLnNxcnQoQSpBK04qTitFKkUpLHY9dCo0LGVbdl09QS9UKmgsZVsrK3ZdPU4vVCpoLGVbKyt2XT1FL1QqaDtyZXR1cm57YXJyYXk6ZSxpdGVtU2l6ZTo0LG5vcm1hbGl6ZWQ6ITB9fXJldHVybiBudWxsfX0pKCk7Cg==",decodeBase64=e=>Uint8Array.from(atob(e),t=>t.charCodeAt(0)),blob$1=typeof self<"u"&&self.Blob&&new Blob([decodeBase64(encodedJs)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper(e){let t;try{if(t=blob$1&&(self.URL||self.webkitURL).createObjectURL(blob$1),!t)throw"";const r=new Worker(t,{name:e==null?void 0:e.name});return r.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(t)}),r}catch{return new Worker("data:text/javascript;base64,"+encodedJs,{name:e==null?void 0:e.name})}finally{t&&(self.URL||self.webkitURL).revokeObjectURL(t)}}var attributeWorkerPool=new WorkerPool$1(function(){return new WorkerWrapper},2);function parsePointCloud(e,t,r){var n=new FeatureTable(e.featureTableJson,e.featureTableBinary);return Promise.resolve().then(function(){var o=n.getExtension("3DTILES_draco_point_compression");return o?parseDraco(o,n):attributeWorkerPool.postMessage({featureTableBinary:n.buffer,featureTableJson:n.json},[n.buffer.buffer])}).then(function(o){return e.attributes=o,r})}function parseDraco(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,o,s,l,u;return __generator(this,function(c){if(r=e.properties||{},n=e.byteOffset,o=e.byteLength,!r||!Number.isFinite(n)||!o)throw new Error("Draco properties, byteOffset, and byteLength must be defined");return s=t.buffer.slice(n,n+o),l=e.properties,u={POSITION:"Float32Array",NORMAL:"Float32Array",RGB:"Uint8Array",RGBA:"Uint8Array"},[2,draco.decodeGeometry(s.buffer,{attributeIDs:l,attributeTypes:u,useUniqueIDs:!0}).then(function(h){var f=h.getAttribute("POSITION"),m=h.getAttribute("RGB"),y=h.getAttribute("RGBA"),A=h.getAttribute("NORMAL"),M;if(y)M=y;else if(m){for(var b=m.count,T=m.array,_=new Uint8Array(b*4),S=0,C=void 0,P=void 0;S<b;S++)P=S*4,C=S*3,_[P]=T[C],_[++P]=T[++C],_[++P]=T[++C];M=new BufferAttribute(_,4,m.normalized)}return{position:f?{array:f.array,itemSize:f.itemSize,normalized:f.normalized}:null,color:M?{array:M.array,itemSize:M.itemSize,normalized:M.normalized}:null,normal:A?{array:A.array,itemSize:A.itemSize,normalized:A.normalized}:null}})]})})}function loadPnts(e,t){var r;t===void 0&&(t={});var n=(r=t.fetcher)!==null&&r!==void 0?r:new Fetcher({allowHosts:["*"]}),o={uri:e};return Promise.resolve().then(function(){return n.ajax(e,{responseType:"arraybuffer"}).then(function(s){return s.body})}).then(function(s){return Promise.resolve(0).then(function(l){return parseHeader$1(o,s,l)}).then(function(l){return parseTable(o,s,l)}).then(function(l){return parsePointCloud(o,s,l)})}).then(function(){var s;return createPoints(o.attributes,{computeBoundingBox:(s=t.computeBoundingBox)!==null&&s!==void 0?s:!0})}).then(function(s){var l=new Matrix4,u=new Matrix4().setPosition(o.rtcCenter[0],o.rtcCenter[1],o.rtcCenter[2]);return l.premultiply(u),s.object.applyMatrix4(l),delete o.gltfArrayBuffer,delete o.featureTableBinary,delete o.batchTableBinary,{type:"pnts",upAxis:"Z",uri:o.uri,byteLength:o.byteLength,memoryUsage:getMemoryUsage(s.object),scene:s.object,textures:[],dispose:function(){return s.dispose()}}})}function createPoints(e,t){var r=new Set,n=new BufferGeometry;r.add(n);var o=new PBMPointCloudMaterial;r.add(o),e.position&&n.setAttribute("position",new BufferAttribute(e.position.array,e.position.itemSize,e.position.normalized)),e.color&&n.setAttribute("color",new BufferAttribute(e.color.array,e.color.itemSize,e.color.normalized)),e.normal&&(n.setAttribute("normal",new BufferAttribute(e.normal.array,e.normal.itemSize,e.normal.normalized)),o.defines.USE_POINT_NORMAL=!0),t.computeBoundingBox&&n.computeBoundingBox();var s=new PBMPointCloud(n,o);return s.matrix.compose(s.position,s.quaternion,s.scale),s.matrixAutoUpdate=!1,s.frustumCulled=!1,Promise.resolve({object:s,dispose:function(){r.forEach(function(l){l.dispose()}),r.clear()}})}function createLZMA(){var e={};return e.OutWindow=function(){this._windowSize=0},e.OutWindow.prototype.create=function(t){(!this._buffer||this._windowSize!==t)&&(this._buffer=[]),this._windowSize=t,this._pos=0,this._streamPos=0},e.OutWindow.prototype.flush=function(){var t=this._pos-this._streamPos;if(t!==0){for(;t--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos}},e.OutWindow.prototype.releaseStream=function(){this.flush(),this._stream=null},e.OutWindow.prototype.setStream=function(t){this.releaseStream(),this._stream=t},e.OutWindow.prototype.init=function(t){t||(this._streamPos=0,this._pos=0)},e.OutWindow.prototype.copyBlock=function(t,r){var n=this._pos-t-1;for(n<0&&(n+=this._windowSize);r--;)n>=this._windowSize&&(n=0),this._buffer[this._pos++]=this._buffer[n++],this._pos>=this._windowSize&&this.flush()},e.OutWindow.prototype.putByte=function(t){this._buffer[this._pos++]=t,this._pos>=this._windowSize&&this.flush()},e.OutWindow.prototype.getByte=function(t){var r=this._pos-t-1;return r<0&&(r+=this._windowSize),this._buffer[r]},e.RangeDecoder=function(){},e.RangeDecoder.prototype.setStream=function(t){this._stream=t},e.RangeDecoder.prototype.releaseStream=function(){this._stream=null},e.RangeDecoder.prototype.init=function(){var t=5;for(this._code=0,this._range=-1;t--;)this._code=this._code<<8|this._stream.readByte()},e.RangeDecoder.prototype.decodeDirectBits=function(t){for(var r=0,n=t,o;n--;)this._range>>>=1,o=this._code-this._range>>>31,this._code-=this._range&o-1,r=r<<1|1-o,this._range&4278190080||(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return r},e.RangeDecoder.prototype.decodeBit=function(t,r){var n=t[r],o=(this._range>>>11)*n;return(this._code^2147483648)<(o^2147483648)?(this._range=o,t[r]+=2048-n>>>5,this._range&4278190080||(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=o,this._code-=o,t[r]-=n>>>5,this._range&4278190080||(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)},e.initBitModels=function(t,r){for(;r--;)t[r]=1024},e.BitTreeDecoder=function(t){this._models=[],this._numBitLevels=t},e.BitTreeDecoder.prototype.init=function(){e.initBitModels(this._models,1<<this._numBitLevels)},e.BitTreeDecoder.prototype.decode=function(t){for(var r=1,n=this._numBitLevels;n--;)r=r<<1|t.decodeBit(this._models,r);return r-(1<<this._numBitLevels)},e.BitTreeDecoder.prototype.reverseDecode=function(t){for(var r=1,n=0,o=0,s;o<this._numBitLevels;++o)s=t.decodeBit(this._models,r),r=r<<1|s,n|=s<<o;return n},e.reverseDecode2=function(t,r,n,o){for(var s=1,l=0,u=0,c;u<o;++u)c=n.decodeBit(t,r+s),s=s<<1|c,l|=c<<u;return l},e.LenDecoder=function(){this._choice=[],this._lowCoder=[],this._midCoder=[],this._highCoder=new e.BitTreeDecoder(8),this._numPosStates=0},e.LenDecoder.prototype.create=function(t){for(;this._numPosStates<t;++this._numPosStates)this._lowCoder[this._numPosStates]=new e.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new e.BitTreeDecoder(3)},e.LenDecoder.prototype.init=function(){var t=this._numPosStates;for(e.initBitModels(this._choice,2);t--;)this._lowCoder[t].init(),this._midCoder[t].init();this._highCoder.init()},e.LenDecoder.prototype.decode=function(t,r){return t.decodeBit(this._choice,0)===0?this._lowCoder[r].decode(t):t.decodeBit(this._choice,1)===0?8+this._midCoder[r].decode(t):16+this._highCoder.decode(t)},e.Decoder2=function(){this._decoders=[]},e.Decoder2.prototype.init=function(){e.initBitModels(this._decoders,768)},e.Decoder2.prototype.decodeNormal=function(t){var r=1;do r=r<<1|t.decodeBit(this._decoders,r);while(r<256);return r&255},e.Decoder2.prototype.decodeWithMatchByte=function(t,r){var n=1,o,s;do if(o=r>>7&1,r<<=1,s=t.decodeBit(this._decoders,(1+o<<8)+n),n=n<<1|s,o!==s){for(;n<256;)n=n<<1|t.decodeBit(this._decoders,n);break}while(n<256);return n&255},e.LiteralDecoder=function(){},e.LiteralDecoder.prototype.create=function(t,r){var n;if(!(this._coders&&this._numPrevBits===r&&this._numPosBits===t))for(this._numPosBits=t,this._posMask=(1<<t)-1,this._numPrevBits=r,this._coders=[],n=1<<this._numPrevBits+this._numPosBits;n--;)this._coders[n]=new e.Decoder2},e.LiteralDecoder.prototype.init=function(){for(var t=1<<this._numPrevBits+this._numPosBits;t--;)this._coders[t].init()},e.LiteralDecoder.prototype.getDecoder=function(t,r){return this._coders[((t&this._posMask)<<this._numPrevBits)+((r&255)>>>8-this._numPrevBits)]},e.Decoder=function(){this._outWindow=new e.OutWindow,this._rangeDecoder=new e.RangeDecoder,this._isMatchDecoders=[],this._isRepDecoders=[],this._isRepG0Decoders=[],this._isRepG1Decoders=[],this._isRepG2Decoders=[],this._isRep0LongDecoders=[],this._posSlotDecoder=[],this._posDecoders=[],this._posAlignDecoder=new e.BitTreeDecoder(4),this._lenDecoder=new e.LenDecoder,this._repLenDecoder=new e.LenDecoder,this._literalDecoder=new e.LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder[0]=new e.BitTreeDecoder(6),this._posSlotDecoder[1]=new e.BitTreeDecoder(6),this._posSlotDecoder[2]=new e.BitTreeDecoder(6),this._posSlotDecoder[3]=new e.BitTreeDecoder(6)},e.Decoder.prototype.setDictionarySize=function(t){return t<0?!1:(this._dictionarySize!==t&&(this._dictionarySize=t,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)},e.Decoder.prototype.setLcLpPb=function(t,r,n){var o=1<<n;return t>8||r>4||n>4?!1:(this._literalDecoder.create(r,t),this._lenDecoder.create(o),this._repLenDecoder.create(o),this._posStateMask=o-1,!0)},e.Decoder.prototype.init=function(){var t=4;for(this._outWindow.init(!1),e.initBitModels(this._isMatchDecoders,192),e.initBitModels(this._isRep0LongDecoders,192),e.initBitModels(this._isRepDecoders,12),e.initBitModels(this._isRepG0Decoders,12),e.initBitModels(this._isRepG1Decoders,12),e.initBitModels(this._isRepG2Decoders,12),e.initBitModels(this._posDecoders,114),this._literalDecoder.init();t--;)this._posSlotDecoder[t].init();this._lenDecoder.init(),this._repLenDecoder.init(),this._posAlignDecoder.init(),this._rangeDecoder.init()},e.Decoder.prototype.decode=function(t,r,n){var o=0,s=0,l=0,u=0,c=0,h=0,f=0,m,y,A,M,b,T;for(this._rangeDecoder.setStream(t),this._outWindow.setStream(r),this.init();n<0||h<n;)if(m=h&this._posStateMask,this._rangeDecoder.decodeBit(this._isMatchDecoders,(o<<4)+m)===0)y=this._literalDecoder.getDecoder(h++,f),o>=7?f=y.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(s)):f=y.decodeNormal(this._rangeDecoder),this._outWindow.putByte(f),o=o<4?0:o-(o<10?3:6);else{if(this._rangeDecoder.decodeBit(this._isRepDecoders,o)===1)A=0,this._rangeDecoder.decodeBit(this._isRepG0Decoders,o)===0?this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(o<<4)+m)===0&&(o=o<7?9:11,A=1):(this._rangeDecoder.decodeBit(this._isRepG1Decoders,o)===0?M=l:(this._rangeDecoder.decodeBit(this._isRepG2Decoders,o)===0?M=u:(M=c,c=u),u=l),l=s,s=M),A===0&&(A=2+this._repLenDecoder.decode(this._rangeDecoder,m),o=o<7?8:11);else if(c=u,u=l,l=s,A=2+this._lenDecoder.decode(this._rangeDecoder,m),o=o<7?7:10,b=this._posSlotDecoder[A<=5?A-2:3].decode(this._rangeDecoder),b>=4){if(T=(b>>1)-1,s=(2|b&1)<<T,b<14)s+=e.reverseDecode2(this._posDecoders,s-b-1,this._rangeDecoder,T);else if(s+=this._rangeDecoder.decodeDirectBits(T-4)<<4,s+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),s<0){if(s===-1)break;return!1}}else s=b;if(s>=h||s>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(s,A),h+=A,f=this._outWindow.getByte(0)}return this._outWindow.flush(),this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0},e.Decoder.prototype.setDecoderProperties=function(t){var r,n,o,s,l;return t.size<5||(r=t.readByte(),n=r%9,r=~~(r/9),o=r%5,s=~~(r/5),!this.setLcLpPb(n,o,s))?!1:(l=t.readByte(),l|=t.readByte()<<8,l|=t.readByte()<<16,l+=t.readByte()*16777216,this.setDictionarySize(l))},e.decompress=function(t,r,n,o){var s=new e.Decoder;if(!s.setDecoderProperties(t))throw"Incorrect stream properties";if(!s.decode(r,n,o))throw"Error in data stream";return!0},e.decompressFile=function(t,r){var n=new e.Decoder,o;if(!n.setDecoderProperties(t))throw"Incorrect stream properties";if(o=t.readByte(),o|=t.readByte()<<8,o|=t.readByte()<<16,o+=t.readByte()*16777216,t.readByte(),t.readByte(),t.readByte(),t.readByte(),!n.decode(t,r,o))throw"Error in data stream";return!0},e}var LZMA=createLZMA();function createWASM(){function e(r){for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=new Uint8Array(256),s=0;s<n.length;s++)o[n.charCodeAt(s)]=s;var l=r.length*.75,u=r.length,c,h=0,f,m,y,A;r[r.length-1]==="="&&(l--,r[r.length-2]==="="&&l--);var M=new ArrayBuffer(l),b=new Uint8Array(M);for(c=0;c<u;c+=4)f=o[r.charCodeAt(c)],m=o[r.charCodeAt(c+1)],y=o[r.charCodeAt(c+2)],A=o[r.charCodeAt(c+3)],b[h++]=f<<2|m>>4,b[h++]=(m&15)<<4|y>>2,b[h++]=(y&3)<<6|A&63;return M}var t="AGFzbQEAAAABSg1gAABgAX8Bf2ACf38Bf2AEf39/fwBgA39/fwBgAX8AYAJ/fwBgA39/fwF/YAR/f39/AX9gAn9/AGABfwF/YAABf2AEf39/fwF/AhsCA2VudgVhYm9ydAADA2VudgZtZW1vcnkCAAEDJiUBAQkKAgoKCwsLCwsAAgoBAgQKAQYFCAoFBQQEBwgCBwwCAQAABAQBcAABBhoFfwFBAAt/AUEAC38BQQALfwFBAAt/AUEACwc9BgZtZW1vcnkCAAV0YWJsZQEABXJlc2V0AA0KbmV3VThBcnJheQAQCnVucGFja1NpemUAFAZkZWNvZGUAIwgBJAkHAQBBAAsBJQqAViVoAQN/IABBgICAgARLBEAACyMBIgEgAEEBIABBAUsbakEHakF4cSICPwAiA0EQdEsEQCADIAIgAWtB//8DakGAgHxxQRB2IgAgAyAAShtAAEEASARAIABAAEEASARAAAsLCyACJAEgAQsbAQF/QQFBICAAQQdqZ2t0EAEiASAANgIAIAELkQMBAX8gAUUEQA8LIABBADoAACAAIAFqQQFrQQA6AAAgAUECTQRADwsgAEEBakEAOgAAIABBAmpBADoAACAAIAFqIgJBAmtBADoAACACQQNrQQA6AAAgAUEGTQRADwsgAEEDakEAOgAAIAAgAWpBBGtBADoAACABQQhNBEAPC0EAIABrQQNxIgIgAGoiAEEANgIAIAEgAmtBfHEiASAAakEEa0EANgIAIAFBCE0EQA8LIABBBGpBADYCACAAQQhqQQA2AgAgACABaiICQQxrQQA2AgAgAkEIa0EANgIAIAFBGE0EQA8LIABBDGpBADYCACAAQRBqQQA2AgAgAEEUakEANgIAIABBGGpBADYCACAAIAFqIgJBHGtBADYCACACQRhrQQA2AgAgAkEUa0EANgIAIAJBEGtBADYCACAAQQRxQRhqIgIgAGohACABIAJrIQEDQCABQSBPBEAgAEIANwMAIABBCGpCADcDACAAQRBqQgA3AwAgAEEYakIANwMAIAFBIGshASAAQSBqIQAMAQsLC1EBA38gAEH+////AEsEQEEAQSBBLUEnEAAACyAAQQJ0IgMQAiECQQgQASIBQQA2AgAgAUEANgIEIAEgAjYCACABIAA2AgQgAkEIaiADEAMgAQtmAQF/IAFB/P///wFLBEBBAEHAAEEXQSIQAAALIAFBAXQiARACIgJBCGogARADIABFBEBBDBABIQALIABBADYCACAAQQA2AgQgAEEANgIIIAAgAjYCACAAQQA2AgQgACABNgIIIAALCgBBDBABIAAQBQsuAQF/QQgQASIBQQA2AgAgAUEANgIEIAEgADYCBCABQQEgASgCBHQQBjYCACABC6EBAQR/QRAQASIBQQA2AgAgAUEANgIEIAFBADYCCCABQQA2AgxBEBAEIQIDQCAAQRBIBEBBAxAHIQMgAigCACAAQQJ0aiADNgIIIABBAWohAAwBCwsgASACNgIEQRAQBCECQQAhAANAIABBEEgEQEEDEAchAyACKAIAIABBAnRqIAM2AgggAEEBaiEADAELCyABIAI2AgggAUEIEAc2AgwgAQs0AQF/QRQQASIAQQA2AgAgAEEAOgAEIABBADYCCCAAQQA2AgwgAEEANgIQIABBDTYCCCAAC0IBAX9BGRABIgBBADYCACAAQQA2AgQgAEEANgIIIABBADYCDCAAQQA2AhAgAEEANgIUIABBADoAGCAAQQA2AhAgAAu1AgEEf0HQABABIgBBADoAACAAQQA2AgQgAEEANgIIIABBADYCDCAAQQA2AhAgAEEAOgAUIABBADYCGCAAQQA2AhwgAEEANgIgIABBADYCJCAAQQA2AiggAEEANgIsIABBADYCMCAAQQA2AjQgAEEANgI4IABBADYCPCAAQQA2AkAgAEEANgJEIABBADYCSCAAQQA2AkxBBBAEIQIDQCABQQRIBEBBBhAHIQMgAigCACABQQJ0aiADNgIIIAFBAWohAQwBCwsgACACNgIkIABBBBAHNgIoIABB8wAQBjYCLCAAQcABEAY2AjAgAEEMEAY2AjQgAEEMEAY2AjggAEEMEAY2AjwgAEEMEAY2AkAgAEHAARAGNgJEIAAQCDYCSCAAEAg2AkwgABAJNgIEIAAQCjYCCCAACx8BAX9BCBABIgBBADYCACAAQQA2AgQgABALNgIAIAALCgAjACQBEAwkAwthAQF/IAFB+P///wNLBEBBAEHAAEEXQSIQAAALIAEQAiICQQhqIAEQAyAARQRAQQwQASEACyAAQQA2AgAgAEEANgIEIABBADYCCCAAIAI2AgAgAEEANgIEIAAgATYCCCAACwoAQQwQASAAEA4LBgAgABAPCyoAIAEgACgCCE8EQEEAQcAAQSdBPxAAAAsgACgCBCABIAAoAgBqai0ACAssACABIAAoAghPBEBBAEHAAEEyQT8QAAALIAAoAgQgASAAKAIAamogAjoACAtkAQJ/QQ0QDyECA0AgAUENSARAIAIgASAAIAEQEUH/AXEQEiABQQFqIQEMAQsLQQAhAEEAIQEDQCABQQhIBEAgAiABQQVqEBFB/wFxIAFBA3R0IAByIQAgAUEBaiEBDAELCyAACwYAIAAQEwsnACAAIAEQDzYCCCAAQQA2AgwgACABNgIUIABBADoAGCAAQQA2AgALJAAgACgCCCAAKAIYEBUgAEGABiAAKAIMIAAtABRqdBAGNgIgC5UBAQR/IAEhBSAAIgYoAgAhASAAKAIEIQcgACgCCEEBdiEEIAJBAEgEfyACIARqIgBBACAAQQBKGwUgAiIAIAQgACAESBsLIQIgA0EASAR/IAMgBGoiAEEAIABBAEobBSADIgAgBCAAIARIGwshAwNAIAIgA05FBEAgAkEBdCABaiAHaiAFOwEIIAJBAWohAgwBCwsgBgssAQF/AkACQAJAIwRBAWsOAwEBAgALAAtB/////wchAQsgAEGACEEAIAEQFwvBAQECfyAAQQIQBjYCACAAKAIAIgEoAgAgASgCBGpBgAg7AQggACgCACICKAIAIQEgAigCBCABQQJqakGACDsBCCAAKAIMKAIAQQEkBBAYGkEAIQIDQCACQRBIBEAgAiAAKAIEKAIAIgEoAgBBAnZJBH8gAkECdCABaigCCAUACygCAEEBJAQQGBogAiAAKAIIKAIAIgEoAgBBAnZJBH8gAkECdCABaigCCAUACygCAEEBJAQQGBogAkEBaiECDAELCwuHAgEFfyAAIQJBgAYgACgCDCAALQAUanQhAQNAIAMgAUgEQCACKAIgIgQoAgAhBSAEKAIEIANBAXQgBWpqQYAIOwEIIANBAWohAwwBCwsgAiEBQQAhAgNAIAJBBEkEQCACIAEoAiQoAgAiAygCAEECdkkEfyACQQJ0IANqKAIIBQALKAIAQQEkBBAYGiACQQFqIQIMAQsLIAEoAigoAgBBASQEEBgaIAEoAixBASQEEBgaIAAoAjBBASQEEBgaIAAoAjRBASQEEBgaIAAoAjhBASQEEBgaIAAoAjxBASQEEBgaIAAoAkBBASQEEBgaIAAoAkRBASQEEBgaIAAoAkgQGSAAKAJMEBkLyAwBA38DQCABQQNxIAIgAhsEQCAAIgRBAWohACABIgNBAWohASAEIAMtAAA6AAAgAkEBayECDAELCyAAQQNxRQRAA0AgAkEQTwRAIAAgASgCADYCACAAQQRqIAFBBGooAgA2AgAgAEEIaiABQQhqKAIANgIAIABBDGogAUEMaigCADYCACABQRBqIQEgAEEQaiEAIAJBEGshAgwBCwsgAkEIcQRAIAAgASgCADYCACAAQQRqIAFBBGooAgA2AgAgAUEIaiEBIABBCGohAAsgAkEEcQRAIAAgASgCADYCACABQQRqIQEgAEEEaiEACyACQQJxBEAgACABLwEAOwEAIAFBAmohASAAQQJqIQALIAJBAXEEQCAAIAEtAAA6AAALDwsgAkEgTwRAAkACQAJAIABBA3EiA0EBRwRAIANBAkYNASADQQNGDQIMAwsgASgCACEFIAAgASIDLQAAOgAAIABBAWoiASABIANBAWoiAS0AADoAAEEBaiIEQQFqIQAgAUEBaiIDQQFqIQEgBCADLQAAOgAAIAJBA2shAgNAIAJBEU8EQCAAIAFBAWooAgAiA0EIdCAFQRh2cjYCACAAQQRqIAFBBWooAgAiBUEIdCADQRh2cjYCACAAQQhqIAFBCWooAgAiA0EIdCAFQRh2cjYCACAAQQxqIAFBDWooAgAiBUEIdCADQRh2cjYCACABQRBqIQEgAEEQaiEAIAJBEGshAgwBCwsMAgsgASgCACEFIAAgAS0AADoAACAAQQFqIgRBAWohACABQQFqIgNBAWohASAEIAMtAAA6AAAgAkECayECA0AgAkESTwRAIAAgAUECaigCACIDQRB0IAVBEHZyNgIAIABBBGogAUEGaigCACIFQRB0IANBEHZyNgIAIABBCGogAUEKaigCACIDQRB0IAVBEHZyNgIAIABBDGogAUEOaigCACIFQRB0IANBEHZyNgIAIAFBEGohASAAQRBqIQAgAkEQayECDAELCwwBCyABKAIAIQUgACIEQQFqIQAgASIDQQFqIQEgBCADLQAAOgAAIAJBAWshAgNAIAJBE08EQCAAIAFBA2ooAgAiA0EYdCAFQQh2cjYCACAAQQRqIAFBB2ooAgAiBUEYdCADQQh2cjYCACAAQQhqIAFBC2ooAgAiA0EYdCAFQQh2cjYCACAAQQxqIAFBD2ooAgAiBUEYdCADQQh2cjYCACABQRBqIQEgAEEQaiEAIAJBEGshAgwBCwsLCyACQRBxBEAgACABIgMtAAA6AAAgAEEBaiIBIAEgA0EBaiIBLQAAOgAAQQFqIgMgAyABQQFqIgEtAAA6AABBAWoiAyADIAFBAWoiAS0AADoAAEEBaiIDIAMgAUEBaiIBLQAAOgAAQQFqIgMgAyABQQFqIgEtAAA6AABBAWoiAyADIAFBAWoiAS0AADoAAEEBaiIDIAMgAUEBaiIBLQAAOgAAQQFqIgMgAyABQQFqIgEtAAA6AABBAWoiAyADIAFBAWoiAS0AADoAAEEBaiIDIAMgAUEBaiIBLQAAOgAAQQFqIgMgAyABQQFqIgEtAAA6AABBAWoiAyADIAFBAWoiAS0AADoAAEEBaiIDIAMgAUEBaiIBLQAAOgAAQQFqIgMgAyABQQFqIgEtAAA6AABBAWoiBEEBaiEAIAFBAWoiA0EBaiEBIAQgAy0AADoAAAsgAkEIcQRAIAAgASIDLQAAOgAAIABBAWoiASABIANBAWoiAS0AADoAAEEBaiIDIAMgAUEBaiIBLQAAOgAAQQFqIgMgAyABQQFqIgEtAAA6AABBAWoiAyADIAFBAWoiAS0AADoAAEEBaiIDIAMgAUEBaiIBLQAAOgAAQQFqIgMgAyABQQFqIgEtAAA6AABBAWoiBEEBaiEAIAFBAWoiA0EBaiEBIAQgAy0AADoAAAsgAkEEcQRAIAAgASIDLQAAOgAAIABBAWoiASABIANBAWoiAS0AADoAAEEBaiIDIAMgAUEBaiIBLQAAOgAAQQFqIgRBAWohACABQQFqIgNBAWohASAEIAMtAAA6AAALIAJBAnEEQCAAIAEtAAA6AAAgAEEBaiIEQQFqIQAgAUEBaiIDQQFqIQEgBCADLQAAOgAACyACQQFxBEAgACABLQAAOgAACwvVAgECfyAAIAFGBEAPCyABIAJqIABNIgNFBEAgACACaiABTSEDCyADBEAgACABIAIQGw8LIAAgAUkEQCABQQdxIABBB3FGBEADQCAAQQdxBEAgAkUEQA8LIAJBAWshAiAAIgRBAWohACABIgNBAWohASAEIAMtAAA6AAAMAQsLA0AgAkEITwRAIAAgASkDADcDACACQQhrIQIgAEEIaiEAIAFBCGohAQwBCwsLA0AgAgRAIAAiBEEBaiEAIAEiA0EBaiEBIAQgAy0AADoAACACQQFrIQIMAQsLBSABQQdxIABBB3FGBEADQCAAIAJqQQdxBEAgAkUEQA8LIAJBAWsiAiAAaiABIAJqLQAAOgAADAELCwNAIAJBCE8EQCACQQhrIgIgAGogASACaikDADcDAAwBCwsLA0AgAgRAIAJBAWsiAiAAaiABIAJqLQAAOgAADAELCwsL4AoBCH8gACgCACIGIgQoAgAgBCgCBGovAQgiCCABIgcoAgxBC3ZsIQQgBygCECAESQR/QYAQIAhrQf//A3FBBXYgCGohCCAHIAQ2AgxBAAUgCCAIQf//A3FBBXZrIQggByAHKAIQIARrNgIQIAcgBygCDCAEazYCDEEBCyAGKAIEIAYoAgBqIAg7AQggByIFKAIMIwJJBEAgBSAFKAIMQQh0NgIMIAUoAhBBCHQhByAFKAIAIQYgBSAFKAIIIglBAWo2AgggBSAGIAkQEUH/AXEgB3I2AhALQf//A3FFBEAgAiAAKAIEKAIAIgAoAgBBAnZJBH8gAkECdCAAaigCCAUACyEDIAEhBEEBIQgDQCAKIAMoAgRJBEAgAygCACIHKAIAIQEgBCgCECAHKAIEIAgiBUEBdCIIIAFqai8BCCIGIAQoAgxBC3ZsIglJBH9BgBAgBmtB//8DcUEFdiAGaiEGIAQgCTYCDEEABSAGIAZB//8DcUEFdmshBiAEIAQoAhAgCWs2AhAgBCAEKAIMIAlrNgIMQQELIAcoAgQgBygCACAFQQF0amogBjsBCCAEKAIMIwJJBEAgBCAEKAIMQQh0NgIMIAQoAhBBCHQhACAEKAIAIQUgBCAEKAIIIgFBAWo2AgggBCAFIAEQEUH/AXEgAHI2AhALQf//A3EgCGohCCAKQQFqIQoMAQsLIAhBASADKAIEdGsPCyAAKAIAIgooAgAhCCAFKAIQIAooAgQgCEECamovAQgiBCABKAIMQQt2bCIDSQR/IAUgAzYCDEEAIQlBgBAgBGtB//8DcUEFdiAEagUgBSAFKAIQIANrNgIQIAUgBSgCDCADazYCDEEBIQkgBCAEQf//A3FBBXZrCyEEIAoiBygCBCAHKAIAQQJqaiAEOwEIIAUiBigCDCMCSQRAIAYgBigCDEEIdDYCDCAGKAIQQQh0IQUgBigCACEHIAYgBigCCCIIQQFqNgIIIAYgByAIEBFB/wFxIAVyNgIQCyAJQf//A3FFBEAgAiAAKAIIKAIAIgAoAgBBAnZJBH8gAkECdCAAaigCCAUACyEJIAEhA0EBIQRBACECA0AgAiAJKAIESQRAIAMoAhAgCSgCACIFKAIEIAQiBkEBdCIEIAUoAgBqai8BCCIHIAMoAgxBC3ZsIghJBH9BgBAgB2tB//8DcUEFdiAHaiEHIAMgCDYCDEEABSAHIAdB//8DcUEFdmshByADIAMoAhAgCGs2AhAgAyADKAIMIAhrNgIMQQELIAUoAgQgBSgCACAGQQF0amogBzsBCCADKAIMIwJJBEAgAyADKAIMQQh0NgIMIAMoAhBBCHQhBSADKAIAIQcgAyADKAIIIgZBAWo2AgggAyAHIAYQEUH/AXEgBXI2AhALQf//A3EgBGohBCACQQFqIQIMAQsLIARBASAJKAIEdGtBCGoPCyAAKAIMIQQgASEDQQEhCUEAIQIDQCACIAQoAgRJBEAgBCgCACIIKAIAIQogAygCECAIKAIEIAogCSIHQQF0IgFqai8BCCIFIAMoAgxBC3ZsIgZJBH8gAyAGNgIMQQAhBkGAECAFa0H//wNxQQV2IAVqBSADIAMoAhAgBms2AhAgAyADKAIMIAZrNgIMQQEhBiAFIAVB//8DcUEFdmsLIQUgCCgCBCAIKAIAIAdBAXRqaiAFOwEIIAMoAgwjAkkEQCADIAMoAgxBCHQ2AgwgAygCEEEIdCEAIAMoAgAhBSADIAMoAggiCkEBajYCCCADIAUgChARQf8BcSAAcjYCEAsgBkH//wNxIAFqIQkgAkEBaiECDAELCyAJQQEgBCgCBHRrQRBqC5YCAQh/QQEhBwNAAkAgBiABTg0AIAIoAhAgACgCBCAAKAIAIAMgB2oiCUEBdGpqLwEIIgQgAigCDEELdmwiBUkEfyACIAU2AgxBACEFQYAQIARrQf//A3FBBXYgBGoFIAIgAigCECAFazYCECACIAIoAgwgBWs2AgxBASEFIAQgBEH//wNxQQV2awshBCAAKAIEIAAoAgAgCUEBdGpqIAQ7AQggAiIEKAIMIwJJBEAgBCAEKAIMQQh0NgIMIAQoAhBBCHQhCiAEKAIAIQsgBCAEKAIIIglBAWo2AgggBCALIAkQEUH/AXEgCnI2AhALIAVB//8DcSIEIAdBAXRqIQcgBCAGdCAIciEIIAZBAWohBgwBCwsgCAvwBAEIf0EDIAEgAUEDSxsiAiAAKAIkKAIAIgEoAgBBAnZJBH8gAkECdCABaigCCAUACyEEIAAoAgQhAkEBIQEDQCAHIAQoAgRJBEAgBCgCACIFKAIAIQMgAigCECAFKAIEIAFBAXQiCSADamovAQgiAyACKAIMQQt2bCIGSQR/IAIgBjYCDEEAIQhBgBAgA2tB//8DcUEFdiADagUgAiACKAIQIAZrNgIQIAIgAigCDCAGazYCDEEBIQggAyADQf//A3FBBXZrCyEDIAUoAgQgBSgCACABQQF0amogAzsBCCACKAIMIwJJBEAgAiACKAIMQQh0NgIMIAIoAhBBCHQhBiACKAIAIQUgAiACKAIIIgNBAWo2AgggAiAFIAMQEUH/AXEgBnI2AhALIAhB//8DcSAJaiEBIAdBAWohBwwBCwsgAUEBIAQoAgR0ayIBQQRJBEAgAQ8LIAFBAXFBAnIgAUEBdkEBayICdCEDIAFBDkkEfyAAKAIsIAIgACgCBCADIAFrEB4gA2oFIAAoAgQhASACQQRrIQJBACEEA0AgASABKAIMQQF2NgIMIAEgASgCECABKAIMazYCECABIAEoAhBBACABKAIQQR92ayIHIAEoAgxxajYCECABKAIQIAEoAgxGBEAgAUEBOgAECyABKAIMIwJJBEAgASABKAIMQQh0NgIMIAEoAhBBCHQhBSABKAIAIQggASABKAIIIgZBAWo2AgggASAIIAYQEUH/AXEgBXI2AhALIAdBAWogBEEBdGohBCACQQFrIgINAAsgBEEEdCADaiAAKAIoIgQoAgAgBCgCBCAAKAIEQQAQHmoLC9AcAQ9/IAAQGiAAKAIEIgdBADoABCAHKAIAIAcgBygCCCIDQQFqNgIIIAMQEUH/AXEEQCAHQQE6AAQLIAdBfzYCDCAHQQA2AhBBACEDA0AgA0EESARAIAcoAhBBCHQhBSAHKAIAIQwgByAHKAIIIghBAWo2AgggByAMIAgQEUH/AXEgBXI2AhAgA0EBaiEDDAELCyAHKAIQIAcoAgxGBEAgB0EBOgAECyABBEAgACgCCCACEA82AgQFIAAoAghBBBAPNgIEC0EAIQwDQAJAIAJFIAEgARsiBwR/IAAtAABFBSAHCwRAIAAoAgQoAhBFBEBBAw8LCyAAKAIwIgUoAgAhByAFKAIEIAAoAggoAgBBASAAKAIQdEEBa3EiCyAMQQR0Qf8BcWoiBkEBdCAHamovAQghAyAGIQcgACgCBCIEKAIMQQt2IANsIQggBCgCECAISQR/IAQgCDYCDEEAIQlBgBAgA2tB//8DcUEFdiADagUgBCAEKAIQIAhrNgIQIAQgBCgCDCAIazYCDEEBIQkgAyADQf//A3FBBXZrCyEIIAUiAygCBCADKAIAIAdBAXRqaiAIOwEIIAQiBigCDCMCSQRAIAYgBigCDEEIdDYCDCAGKAIQQQh0IQggBigCACEDIAYgBigCCCIHQQFqNgIIIAYgAyAHEBFB/wFxIAhyNgIQCyAJQf//A3FFBEAgAkUgASABGw0BIAwhCEEAIQYgACgCCCIFKAIMRSIEBH8gBS0AGEUFIAQLRQRAIAAoAggiBSgCCCIGKAIEQQEgBSgCDEwEfyAFKAIMQQFrBSAFKAIMIAUoAhRBAWtqCyAGKAIAamotAAghBgtBASEEIAAoAggoAgBBASAALQAUdEEBa3EgACgCDHQgBkEIIAAoAgxrdmpBgAZsIQcgCEEHTwRAIAAoAggiBigCCCIJKAIEIA5BAWoiDSAGKAIMTAR/IAYoAgwgDWsFIAYoAgwgBigCFCANa2oLIAkoAgBqai0ACCENA0ACQCANQf8BcUEHdiEGIA1BAXQhDSAAKAIgIgkoAgAhCyAJKAIEIAZBAWpBCHQgB2ogBGoiDEEBdCALamovAQgiCyAAKAIEIgMoAgxBC3ZsIQogAygCECAKSQR/QYAQIAtrQf//A3FBBXYgC2ohCyADIAo2AgxBAAUgCyALQf//A3FBBXZrIQsgAyADKAIQIAprNgIQIAMgAygCDCAKazYCDEEBCyEFIAkoAgQgCSgCACAMQQF0amogCzsBCCADIgooAgwjAkkEQCAKIAooAgxBCHQ2AgwgCigCEEEIdCEDIAooAgAhDCAKIAooAggiC0EBajYCCCAKIAwgCxARQf8BcSADcjYCEAsgBEEBdCAFciEEIAVB//8DcSAGRw0AIARB//8DcUGAAkkNAQsLCwNAIARBgAJJBEAgBEEBdCEJIAAoAiAiBSgCACEMIAUoAgQgBCAHaiIGQQF0IAxqai8BCCILIAAoAgQiDSgCDEELdmwhCiANKAIQIApJBH9BgBAgC2tB//8DcUEFdiALaiELIA0gCjYCDEEABSALIAtB//8DcUEFdmshCyANIA0oAhAgCms2AhAgDSANKAIMIAprNgIMQQELIAUoAgQgBSgCACAGQQF0amogCzsBCCANIgooAgwjAkkEQCAKIAooAgxBCHQ2AgwgCigCEEEIdCEGIAooAgAhBSAKIAooAggiDEEBajYCCCAKIAUgDBARQf8BcSAGcjYCEAsgCXIhBAwBCwsgACgCCCIDIAMoAgBBAWo2AgAgAygCCCELIAMgAygCDCIGQQFqNgIMIAsoAgQgCygCACAGamogBEGAAmsiCjoACCADKAIMIAMoAhRGBEAgA0EANgIMIANBAToAGAsgAygCBCgCCCADKAIQRgRAIAMgAygCBCIGKAIIQQF0EA82AgQgAygCBCgCACADKAIEKAIEakEIaiAGKAIAIAYoAgRqQQhqIAYoAggQHCAGKAIAGgsgAygCBCEJIAMgAygCECIMQQFqNgIQIAkoAgQgCSgCACAMamogCjoACCAIIgVBBEkEf0EABSAFQQNrIAVBBmsgBUEKSRsLIQwgAkEBayECDAILIAAoAjQiBigCACEFIAYoAgQgDCIDQQF0IAVqai8BCCIHIAAoAgQiCigCDEELdmwhBCAKKAIQIARJBH9BgBAgB2tB//8DcUEFdiAHaiEHIAogBDYCDEEABSAHIAdB//8DcUEFdmshByAKIAooAhAgBGs2AhAgCiAKKAIMIARrNgIMQQELIAMhBSAGIgMoAgAhDSADKAIEIAVBAXQgDWpqIAc7AQggCiIJKAIMIwJJBEAgCSAJKAIMQQh0NgIMIAkoAhBBCHQhBiAJKAIAIQMgCSAJKAIIIgVBAWo2AgggCSADIAUQEUH/AXEgBnI2AhALQf//A3EEQCACRSABIAEbDQEgACgCCCIIKAIMRSIEBH8gCC0AGEUFIAQLDQEgACgCOCIDKAIAIQggAygCBCAMQQF0IAhqai8BCCIEIAAoAgQiBSgCDEELdmwhByAFKAIQIAdJBH9BgBAgBGtB//8DcUEFdiAEaiEEIAUgBzYCDEEABSAEIARB//8DcUEFdmshBCAFIAUoAhAgB2s2AhAgBSAFKAIMIAdrNgIMQQELIAMoAgQgAygCACAMQQF0amogBDsBCCAFIgkoAgwjAkkEQCAJIAkoAgxBCHQ2AgwgCSgCEEEIdCEFIAkoAgAhAyAJIAkoAggiCEEBajYCCCAJIAMgCBARQf8BcSAFcjYCEAtB//8DcQRAIAAoAjwiCCgCACEHIAgoAgQgDEEBdCAHamovAQgiBCAAKAIEIgUoAgxBC3ZsIQYgBSgCECAGSQR/QYAQIARrQf//A3FBBXYgBGohBCAFIAY2AgxBAAUgBCAEQf//A3FBBXZrIQQgBSAFKAIQIAZrNgIQIAUgBSgCDCAGazYCDEEBCyAIIgMoAgQgAygCACAMQQF0amogBDsBCCAFIgkoAgwjAkkEQCAJIAkoAgxBCHQ2AgwgCSgCEEEIdCEIIAkoAgAhAyAJIAkoAggiB0EBajYCCCAJIAMgBxARQf8BcSAIcjYCEAtB//8DcQRAIAAoAkAiAygCACEKIAMoAgQgDEEBdCAKamovAQgiBiAAKAIEIgcoAgxBC3ZsIQQgBygCECAESQR/QYAQIAZrQf//A3FBBXYgBmohBiAHIAQ2AgxBAAUgBiAGQf//A3FBBXZrIQYgByAHKAIQIARrNgIQIAcgBygCDCAEazYCDEEBCyADKAIEIAMoAgAgDEEBdGpqIAY7AQggByIJKAIMIwJJBEAgCSAJKAIMQQh0NgIMIAkoAhBBCHQhCCAJKAIAIQMgCSAJKAIIIgpBAWo2AgggCSADIAoQEUH/AXEgCHI2AhALQf//A3EEQCARIQMgDyERBSAPIQMLIBAhDwUgECEDCyAOIRAgAyEOBSAAKAJEIgYoAgAhCiAGKAIEIAxBBHRB/wFxIAtqIgNBAXQgCmpqLwEIIgcgACgCBCIIKAIMQQt2bCEEIAgoAhAgBEkEf0GAECAHa0H//wNxQQV2IAdqIQcgCCAENgIMQQAFIAcgB0H//wNxQQV2ayEHIAggCCgCECAEazYCECAIIAgoAgwgBGs2AgxBAQsgAyEKIAYiAygCACENIAMoAgQgCkEBdCANamogBzsBCCAIIgkoAgwjAkkEQCAJIAkoAgxBCHQ2AgwgCSgCEEEIdCEIIAkoAgAhAyAJIAkoAggiCkEBajYCCCAJIAMgChARQf8BcSAIcjYCEAtB//8DcUUEQEEJQQsgDEEHSRshDCAAKAIIIQQgACgCCCIFKAIIIgMoAgQgDkEBaiIHIAUoAgxMBH8gBSgCDCAHawUgBSgCDCAFKAIUIAdragsgAygCAGpqLQAIIQcgBCAEKAIAQQFqNgIAIAQoAgghBSAEIAQoAgwiBkEBajYCDCAFKAIEIAUoAgAgBmpqIAc6AAggBCgCDCAEKAIURgRAIARBADYCDCAEQQE6ABgLIAQoAgQoAgggBCgCEEYEQCAEIAQoAgQiBigCCEEBdBAPNgIEIAQoAgQoAgAgBCgCBCgCBGpBCGogBigCACAGKAIEakEIaiAGKAIIEBwgBigCABoLIAQoAgQhAyAEIAQoAhAiCEEBajYCECADKAIEIAMoAgAgCGpqIAc6AAggAkEBayECDAQLCyAAKAJMIAAoAgQgCxAdIQtBCEELIAxBB0kbIQwFIA8hESAQIQ8gDiEQQQdBCiAMQQdJGyEMIAAgACgCSCAAKAIEIAsQHSILEB8iDkF/RgRAIAAoAgQoAhAEf0EBBUECCw8LIAJFIAEgARsNASAOIAAoAhhPIgUEfyAFBSAOIAAoAggiBCgCDEwiBgR/IAYFIAQtABgLRQsNAQtBACENIAAoAgghBSAOQQFqIQQgAiALQQJqIgtIIAEgARsEQEEBIQ0gAiELCyALIQYDQCAGQQBKBEAgBSIIKAIIIgkoAgQgBCAFKAIMTAR/IAUoAgwgBGsFIAUoAgwgBSgCFCAEa2oLIAkoAgBqai0ACCEHIAggCCgCAEEBajYCACAIKAIIIQMgCCAIKAIMIgpBAWo2AgwgAygCBCADKAIAIApqaiAHOgAIIAgoAgwgCCgCFEYEQCAIQQA2AgwgCEEBOgAYCyAIKAIEKAIIIAgoAhBGBEAgCCAIKAIEIgMoAghBAXQQDzYCBCAIKAIEKAIAIAgoAgQoAgRqQQhqIAMoAgAgAygCBGpBCGogAygCCBAcIAMoAgAaCyAIKAIEIQkgCCAIKAIQIgNBAWo2AhAgCSgCBCAJKAIAIANqaiAHOgAIIAZBAWshBgwBCwsgAiALayECIA1FDQELC0EBCyYBAX9BEBABIgQgADYCACAEIAE2AgQgBCACNgIIIAQgAzYCDCAEC7YEAQZ/IAAgATYCBEENEA8hAgNAAkAgA0ENTg0AIAIgAyABIAMQEUH/AXEQEiADQQFqIQMMAQsLIAAoAgAhBCACIQZBBBAPIgIoAgQgAigCAGogBigCBCAGKAIAai0ACCIDOgAIIANB/wFxQeEBTwRAQQBBgAFBoQFBDBAAAAsgAigCBCACKAIAQQFqaiADQf8BcUEJcCIHOgAIIAIoAgQgAigCAGogA0H/AXFBCW4iAzoACCADQQVwIQUgAigCBCACKAIAQQJqaiADQQVuIgM6AAggAigCBCACKAIAQQNqaiAFOgAIIAQgBzYCDCAEIAM2AhAgBCAFOgAUIARBADYCHEEAIQIDQAJAIAJBBE8NACAEIAQoAhwgBigCBCAGKAIAIAJBAWpqai0ACCACQQN0dHI2AhwgAkEBaiECDAELCyAEIAQoAhw2AhggBCgCGEGAIEkEQCAEQYAgNgIYC0EAIQJBACEFQQAhAwNAAkAgA0EITg0AIAYgA0EFahARQf8BcSIEQf8BRwRAQQEhBQsgBCADQQN0dCACciECIANBAWohAwwBCwsgACgCACAFRToAACAAKAIAKAIEIAE2AgAgACgCABAWAkAgACgCACAFIAIQICIBQQFGDQAgAUEDRwRAIAFBAkYEQCAFBEAgACgCACgCCCgCECACRw0DCwUMAgsLIAAoAgAoAgQtAAQaQQFBACAAKAIAKAIIKAIQIAAoAgAoAggoAgQQIQ8LQQBBAUEAQQAQIQsIACMDIAAQIgsWAEG4ASQAIwAkAUGAgIAIJAIQDCQDCwMAAQsLtwEEAEEICxcKAAAAdQBzAGUAIABzAHQAcgBpAGMAdABBIAsdDQAAAH4AbABpAGIALwBhAHIAcgBhAHkALgB0AHMAQcAACzkbAAAAfgBsAGkAYgAvAGkAbgB0AGUAcgBuAGEAbAAvAHQAeQBwAGUAZABhAHIAcgBhAHkALgB0AHMAQYABCzMYAAAAcwByAGMALwBsAHoAbQBhAC8AbAB6AG0AYQAtAGQAZQBjAG8AZABlAHIALgB0AHM=";return e(t)}function decodeLZMA(e,t,r){try{var n={data:t,offset:0,readByte:function(){return this.data[this.offset++]}},o=n.data.length,s={data:[],offset:0,writeByte:function(c){var h=Math.floor(this.offset/o);this.data[h]||(this.data[h]=new Uint8Array(o)),this.data[h][this.offset%o]=c,this.offset++}};e.decompressFile(n,s);for(var l=new Uint8Array(s.offset),u=0;u<s.offset;u++)l[u]=s.data[Math.floor(u/o)][u%o];r(null,l)}catch(c){r(c)}}function decodeLZMAWithWASM(e,t,r){var n=24;try{var o=new WebAssembly.Memory({initial:16}),s=new WebAssembly.Module(e),l=new WebAssembly.Instance(s,{env:{memory:o,abort:function(){r(new Error("webAssembly abort"))}}}),u=l.exports,c=u.newU8Array(t.length),h=new Uint8Array(o.buffer,c+n,t.length);h.set(t);var f=u.decode(c),m=new Uint32Array(o.buffer,f,4),y=m[0],A=m[2],M=m[3];y?r(null,new Uint8Array(o.buffer,M+n,A).slice(0,A)):r(new Error("lzma deocder error"))}catch(b){r(b)}}var lzmaWorkerSource=`
var decodeLZMA = (function() {
  var LZMA = (`.concat(createLZMA.toString(),`)();
  return function(data, callback) {
    return (`).concat(decodeLZMA.toString(),`)(LZMA, data, callback);
  }
})();

var decodeLZMAWithWASM = (function() {
  var LZMA_WASM = (`).concat(createWASM.toString(),`)();
  return function(data, callback) {
    return (`).concat(decodeLZMAWithWASM.toString(),`)(LZMA_WASM, data, callback);
  }
})();

self.onmessage = function(event) {
  var packet = event.data;
  if (!packet.id) {
    postMessage({ id: packet.id, error: "No incoming id." });
    return;
  }
  if (!packet.data) {
    postMessage({ id: packet.id, error: "No input data." });
    return;
  }
  if (packet.type == "decompress") {
    if (packet.data.constructor !== Uint8Array) {
      postMessage({ id: packet.id, error: "Input data is not Uint8Array." });
    }
    const callback = function(error, result) {
      if (error) {
        postMessage({ id: packet.id, error: error.toString() });
      } else {
        postMessage({ id: packet.id, result: result, error: null }, [ result.buffer ]);
      }
    }
    if (typeof WebAssembly !== "undefined" && WebAssembly.instantiate) {
      decodeLZMAWithWASM(packet.data, callback);
    } else {
      decodeLZMA(packet.data, callback);
    }
    return;
  }
  postMessage({ id: packet.id, error: "type never matched." });
};
`),support=typeof Worker<"u"&&typeof Blob<"u",lzmaWorkerURL="";if(support)try{var blob=new Blob([lzmaWorkerSource],{type:"text/javascript"});lzmaWorkerURL=URL.createObjectURL(blob)}catch{}var LZMAWorker=function(){function e(){var t=this;if(!support)throw new Error("LZMAWorker cannot work in this broswer.");this.callCounter=0,this.requests={};var r=this.worker=new Worker(lzmaWorkerURL);r.onmessage=function(n){var o=n.data,s=o.id,l=o.result,u=o.error,c=t.getKey(s);t.requests[c]&&(u?t.requests[c](new Error(u)):t.requests[c](null,l),delete t.requests[c])},r.onerror=function(n){return console.error(n)}}return e.prototype.getKey=function(t){return"key_"+String(t)},e.prototype.decompress=function(t,r){var n=++this.callCounter;this.requests[this.getKey(n)]=r,this.worker.postMessage({type:"decompress",id:n,data:t},[t.buffer])},e.prototype.terminate=function(){this.worker.terminate()},e.support=support,e}();function readUint32(e){return Array.prototype.reduce.call(e,function(t,r,n){return t|r<<n*8},0)}function binaryArrays(e){for(var t=[],r=e.length,n=function(l){var u={data:e[l],offset:0,readByte:function(){return this.data[this.offset++]}},c=u.data.length,h={data:[],offset:0,writeByte:function(m){var y=Math.floor(this.offset/c);this.data[y]||(this.data[y]=new Uint8Array(c)),this.data[y][this.offset%c]=m,this.offset++}};LZMA.decompressFile(u,h),o=new Uint8Array(h.offset);for(var f=0;f<h.offset;f++)o[f]=h.data[Math.floor(f/c)][f%c];t.push(o)},o,s=0;s<r;s++)n(s);return t}function binaryArraysWithWorker(e){for(var t=[],r=e.length,n=function(s){t.push(new Promise(function(l,u){var c=new LZMAWorker;c.decompress(e[s],function(h,f){if(c.terminate(),h)return u(h);l(f)})}))},o=0;o<r;o++)n(o);return Promise.all(t)}function lzma(e){var t=new Uint8Array(e),r=readUint32(t.slice(0,4));if(r>10)return Promise.reject(new Error("LZMA got too many sub chunks."));for(var n=[],o=[],s=4+r*4,l=0;l<r;l++)o[l]=readUint32(t.slice(4+l*4,8+l*4)),l===r-1?n[l]=t.subarray(s,s+o[l]):n[l]=t.slice(s,s+o[l]),s+=o[l];return LZMAWorker.support?binaryArraysWithWorker(n):Promise.resolve(binaryArrays(n))}var dequeuing=!1,queue=[];function dequeue(e){if(e===void 0&&(e=!1),!(!e&&dequeuing)){dequeuing=!0;var t=queue.shift();if(t){try{t()}catch{}AnimationFrameLoop.shared.add(function(){return dequeue(!0)},!0,2,-100)}else dequeuing=!1}}function delay(e){return new Promise(function(t,r){var n=function(){try{t(e())}catch(o){r(o)}};queue.push(n),AnimationFrameLoop.shared.add(function(){return dequeue()},!0,2,-100)})}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(e,t){for(var r=new Array(arguments.length-1),n=0,o=2,s=!0;o<arguments.length;)r[n++]=arguments[o++];return new Promise(function(l,u){r[n]=function(c){if(s)if(s=!1,c)u(c);else{for(var h=new Array(arguments.length-1),f=0;f<h.length;)h[f++]=arguments[f];l.apply(null,h)}};try{e.apply(t||null,r)}catch(c){s&&(s=!1,u(c))}})}var base64$1={};(function(e){var t=e;t.length=function(l){var u=l.length;if(!u)return 0;for(var c=0;--u%4>1&&l.charAt(u)==="=";)++c;return Math.ceil(l.length*3)/4-c};for(var r=new Array(64),n=new Array(123),o=0;o<64;)n[r[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;t.encode=function(l,u,c){for(var h=null,f=[],m=0,y=0,A;u<c;){var M=l[u++];switch(y){case 0:f[m++]=r[M>>2],A=(M&3)<<4,y=1;break;case 1:f[m++]=r[A|M>>4],A=(M&15)<<2,y=2;break;case 2:f[m++]=r[A|M>>6],f[m++]=r[M&63],y=0;break}m>8191&&((h||(h=[])).push(String.fromCharCode.apply(String,f)),m=0)}return y&&(f[m++]=r[A],f[m++]=61,y===1&&(f[m++]=61)),h?(m&&h.push(String.fromCharCode.apply(String,f.slice(0,m))),h.join("")):String.fromCharCode.apply(String,f.slice(0,m))};var s="invalid encoding";t.decode=function(l,u,c){for(var h=c,f=0,m,y=0;y<l.length;){var A=l.charCodeAt(y++);if(A===61&&f>1)break;if((A=n[A])===void 0)throw Error(s);switch(f){case 0:m=A,f=1;break;case 1:u[c++]=m<<2|(A&48)>>4,m=A,f=2;break;case 2:u[c++]=(m&15)<<4|(A&60)>>2,m=A,f=3;break;case 3:u[c++]=(m&3)<<6|A,f=0;break}}if(f===1)throw Error(s);return c-h},t.test=function(l){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(l)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};EventEmitter.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this};EventEmitter.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this};var float=factory(factory);function factory(e){return typeof Float32Array<"u"?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=r[3]===128;function o(c,h,f){t[0]=c,h[f]=r[0],h[f+1]=r[1],h[f+2]=r[2],h[f+3]=r[3]}function s(c,h,f){t[0]=c,h[f]=r[3],h[f+1]=r[2],h[f+2]=r[1],h[f+3]=r[0]}e.writeFloatLE=n?o:s,e.writeFloatBE=n?s:o;function l(c,h){return r[0]=c[h],r[1]=c[h+1],r[2]=c[h+2],r[3]=c[h+3],t[0]}function u(c,h){return r[3]=c[h],r[2]=c[h+1],r[1]=c[h+2],r[0]=c[h+3],t[0]}e.readFloatLE=n?l:u,e.readFloatBE=n?u:l}():function(){function t(n,o,s,l){var u=o<0?1:0;if(u&&(o=-o),o===0)n(1/o>0?0:2147483648,s,l);else if(isNaN(o))n(2143289344,s,l);else if(o>34028234663852886e22)n((u<<31|2139095040)>>>0,s,l);else if(o<11754943508222875e-54)n((u<<31|Math.round(o/1401298464324817e-60))>>>0,s,l);else{var c=Math.floor(Math.log(o)/Math.LN2),h=Math.round(o*Math.pow(2,-c)*8388608)&8388607;n((u<<31|c+127<<23|h)>>>0,s,l)}}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE);function r(n,o,s){var l=n(o,s),u=(l>>31)*2+1,c=l>>>23&255,h=l&8388607;return c===255?h?NaN:u*(1/0):c===0?u*1401298464324817e-60*h:u*Math.pow(2,c-150)*(h+8388608)}e.readFloatLE=r.bind(null,readUintLE),e.readFloatBE=r.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=r[7]===128;function o(c,h,f){t[0]=c,h[f]=r[0],h[f+1]=r[1],h[f+2]=r[2],h[f+3]=r[3],h[f+4]=r[4],h[f+5]=r[5],h[f+6]=r[6],h[f+7]=r[7]}function s(c,h,f){t[0]=c,h[f]=r[7],h[f+1]=r[6],h[f+2]=r[5],h[f+3]=r[4],h[f+4]=r[3],h[f+5]=r[2],h[f+6]=r[1],h[f+7]=r[0]}e.writeDoubleLE=n?o:s,e.writeDoubleBE=n?s:o;function l(c,h){return r[0]=c[h],r[1]=c[h+1],r[2]=c[h+2],r[3]=c[h+3],r[4]=c[h+4],r[5]=c[h+5],r[6]=c[h+6],r[7]=c[h+7],t[0]}function u(c,h){return r[7]=c[h],r[6]=c[h+1],r[5]=c[h+2],r[4]=c[h+3],r[3]=c[h+4],r[2]=c[h+5],r[1]=c[h+6],r[0]=c[h+7],t[0]}e.readDoubleLE=n?l:u,e.readDoubleBE=n?u:l}():function(){function t(n,o,s,l,u,c){var h=l<0?1:0;if(h&&(l=-l),l===0)n(0,u,c+o),n(1/l>0?0:2147483648,u,c+s);else if(isNaN(l))n(0,u,c+o),n(2146959360,u,c+s);else if(l>17976931348623157e292)n(0,u,c+o),n((h<<31|2146435072)>>>0,u,c+s);else{var f;if(l<22250738585072014e-324)f=l/5e-324,n(f>>>0,u,c+o),n((h<<31|f/4294967296)>>>0,u,c+s);else{var m=Math.floor(Math.log(l)/Math.LN2);m===1024&&(m=1023),f=l*Math.pow(2,-m),n(f*4503599627370496>>>0,u,c+o),n((h<<31|m+1023<<20|f*1048576&1048575)>>>0,u,c+s)}}}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0);function r(n,o,s,l,u){var c=n(l,u+o),h=n(l,u+s),f=(h>>31)*2+1,m=h>>>20&2047,y=4294967296*(h&1048575)+c;return m===2047?y?NaN:f*(1/0):m===0?f*5e-324*y:f*Math.pow(2,m-1075)*(y+4503599627370496)}e.readDoubleLE=r.bind(null,readUintLE,0,4),e.readDoubleBE=r.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function writeUintBE(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=e&255}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$2={};(function(e){var t=e;t.length=function(r){for(var n=0,o=0,s=0;s<r.length;++s)o=r.charCodeAt(s),o<128?n+=1:o<2048?n+=2:(o&64512)===55296&&(r.charCodeAt(s+1)&64512)===56320?(++s,n+=4):n+=3;return n},t.read=function(r,n,o){var s=o-n;if(s<1)return"";for(var l=null,u=[],c=0,h;n<o;)h=r[n++],h<128?u[c++]=h:h>191&&h<224?u[c++]=(h&31)<<6|r[n++]&63:h>239&&h<365?(h=((h&7)<<18|(r[n++]&63)<<12|(r[n++]&63)<<6|r[n++]&63)-65536,u[c++]=55296+(h>>10),u[c++]=56320+(h&1023)):u[c++]=(h&15)<<12|(r[n++]&63)<<6|r[n++]&63,c>8191&&((l||(l=[])).push(String.fromCharCode.apply(String,u)),c=0);return l?(c&&l.push(String.fromCharCode.apply(String,u.slice(0,c))),l.join("")):String.fromCharCode.apply(String,u.slice(0,c))},t.write=function(r,n,o){for(var s=o,l,u,c=0;c<r.length;++c)l=r.charCodeAt(c),l<128?n[o++]=l:l<2048?(n[o++]=l>>6|192,n[o++]=l&63|128):(l&64512)===55296&&((u=r.charCodeAt(c+1))&64512)===56320?(l=65536+((l&1023)<<10)+(u&1023),++c,n[o++]=l>>18|240,n[o++]=l>>12&63|128,n[o++]=l>>6&63|128,n[o++]=l&63|128):(n[o++]=l>>12|224,n[o++]=l>>6&63|128,n[o++]=l&63|128);return o-s}})(utf8$2);var pool_1=pool;function pool(e,t,r){var n=r||8192,o=n>>>1,s=null,l=n;return function(u){if(u<1||u>o)return e(u);l+u>n&&(s=e(n),l=0);var c=t.call(s,l,l+=u);return l&7&&(l=(l|7)+1),c}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(s,l){this.lo=s>>>0,this.hi=l>>>0}var r=t.zero=new t(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var n=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(s){if(s===0)return r;var l=s<0;l&&(s=-s);var u=s>>>0,c=(s-u)/4294967296>>>0;return l&&(c=~c>>>0,u=~u>>>0,++u>4294967295&&(u=0,++c>4294967295&&(c=0))),new t(u,c)},t.from=function(s){if(typeof s=="number")return t.fromNumber(s);if(e.isString(s))if(e.Long)s=e.Long.fromString(s);else return t.fromNumber(parseInt(s,10));return s.low||s.high?new t(s.low>>>0,s.high>>>0):r},t.prototype.toNumber=function(s){if(!s&&this.hi>>>31){var l=~this.lo+1>>>0,u=~this.hi>>>0;return l||(u=u+1>>>0),-(l+u*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(s){return e.Long?new e.Long(this.lo|0,this.hi|0,!!s):{low:this.lo|0,high:this.hi|0,unsigned:!!s}};var o=String.prototype.charCodeAt;return t.fromHash=function(s){return s===n?r:new t((o.call(s,0)|o.call(s,1)<<8|o.call(s,2)<<16|o.call(s,3)<<24)>>>0,(o.call(s,4)|o.call(s,5)<<8|o.call(s,6)<<16|o.call(s,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var s=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^s)>>>0,this.lo=(this.lo<<1^s)>>>0,this},t.prototype.zzDecode=function(){var s=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^s)>>>0,this.hi=(this.hi>>>1^s)>>>0,this},t.prototype.length=function(){var s=this.lo,l=(this.lo>>>28|this.hi<<4)>>>0,u=this.hi>>>24;return u===0?l===0?s<16384?s<128?1:2:s<2097152?3:4:l<16384?l<128?5:6:l<2097152?7:8:u<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var t=e;t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=requireLongbits(),t.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(o){return typeof o=="number"&&isFinite(o)&&Math.floor(o)===o},t.isString=function(o){return typeof o=="string"||o instanceof String},t.isObject=function(o){return o&&typeof o=="object"},t.isset=t.isSet=function(o,s){var l=o[s];return l!=null&&o.hasOwnProperty(s)?typeof l!="object"||(Array.isArray(l)?l.length:Object.keys(l).length)>0:!1},t.Buffer=function(){try{var o=t.inquire("buffer").Buffer;return o.prototype.utf8Write?o:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(o){return typeof o=="number"?t.Buffer?t._Buffer_allocUnsafe(o):new t.Array(o):t.Buffer?t._Buffer_from(o):typeof Uint8Array>"u"?o:new Uint8Array(o)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(o){return o?t.LongBits.from(o).toHash():t.LongBits.zeroHash},t.longFromHash=function(o,s){var l=t.LongBits.fromHash(o);return t.Long?t.Long.fromBits(l.lo,l.hi,s):l.toNumber(!!s)};function r(o,s,l){for(var u=Object.keys(s),c=0;c<u.length;++c)(o[u[c]]===void 0||!l)&&(o[u[c]]=s[u[c]]);return o}t.merge=r,t.lcFirst=function(o){return o.charAt(0).toLowerCase()+o.substring(1)};function n(o){function s(l,u){if(!(this instanceof s))return new s(l,u);Object.defineProperty(this,"message",{get:function(){return l}}),Error.captureStackTrace?Error.captureStackTrace(this,s):Object.defineProperty(this,"stack",{value:new Error().stack||""}),u&&r(this,u)}return s.prototype=Object.create(Error.prototype,{constructor:{value:s,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return o},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),s}t.newError=n,t.ProtocolError=n("ProtocolError"),t.oneOfGetter=function(o){for(var s={},l=0;l<o.length;++l)s[o[l]]=1;return function(){for(var u=Object.keys(this),c=u.length-1;c>-1;--c)if(s[u[c]]===1&&this[u[c]]!==void 0&&this[u[c]]!==null)return u[c]}},t.oneOfSetter=function(o){return function(s){for(var l=0;l<o.length;++l)o[l]!==s&&delete this[o[l]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var o=t.Buffer;if(!o){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=o.from!==Uint8Array.from&&o.from||function(s,l){return new o(s,l)},t._Buffer_allocUnsafe=o.allocUnsafe||function(s){return new o(s)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function e(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function e(t){return new util$4.Array(t)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function e(t,r,n){return this.tail=this.tail.next=new Op(t,r,n),this.len+=r,this};function writeByte(e,t,r){t[r]=e&255}function writeVarint32(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function e(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};Writer$1.prototype.int32=function e(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)};Writer$1.prototype.sint32=function e(t){return this.uint32((t<<1^t>>31)>>>0)};function writeVarint64(e,t,r){for(;e.hi;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}Writer$1.prototype.uint64=function e(t){var r=LongBits$1.from(t);return this._push(writeVarint64,r.length(),r)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function e(t){var r=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,r.length(),r)};Writer$1.prototype.bool=function e(t){return this._push(writeByte,1,t?1:0)};function writeFixed32(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Writer$1.prototype.fixed32=function e(t){return this._push(writeFixed32,4,t>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function e(t){var r=LongBits$1.from(t);return this._push(writeFixed32,4,r.lo)._push(writeFixed32,4,r.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function e(t){return this._push(util$4.float.writeFloatLE,4,t)};Writer$1.prototype.double=function e(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function e(t,r,n){r.set(t,n)}:function e(t,r,n){for(var o=0;o<t.length;++o)r[n+o]=t[o]};Writer$1.prototype.bytes=function e(t){var r=t.length>>>0;if(!r)return this._push(writeByte,1,0);if(util$4.isString(t)){var n=Writer$1.alloc(r=base64.length(t));base64.decode(t,n,0),t=n}return this.uint32(r)._push(writeBytes,r,t)};Writer$1.prototype.string=function e(t){var r=utf8$1.length(t);return r?this.uint32(r)._push(utf8$1.write,r,t):this._push(writeByte,1,0)};Writer$1.prototype.fork=function e(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function e(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function e(){var t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=r,this.len+=n),this};Writer$1.prototype.finish=function e(){for(var t=this.head.next,r=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r};Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}};BufferWriter.prototype.bytes=function e(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var r=t.length>>>0;return this.uint32(r),r&&this._push(BufferWriter.writeBytesBuffer,r,t),this};function writeStringBuffer(e,t,r){e.length<40?util$3.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}BufferWriter.prototype.string=function e(t){var r=util$3.Buffer.byteLength(t);return this.uint32(r),r&&this._push(writeStringBuffer,r,t),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array=typeof Uint8Array<"u"?function e(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function e(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create=function e(){return util$2.Buffer?function(t){return(Reader$1.create=function(r){return util$2.Buffer.isBuffer(r)?new BufferReader$1(r):create_array(r)})(t)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function e(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return t}}();Reader$1.prototype.int32=function e(){return this.uint32()|0};Reader$1.prototype.sint32=function e(){var t=this.uint32();return t>>>1^-(t&1)|0};function readLongVarint(){var e=new LongBits(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function e(){return this.uint32()!==0};function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}Reader$1.prototype.fixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};Reader$1.prototype.double=function e(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};Reader$1.prototype.bytes=function e(){var t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw indexOutOfRange(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(r,n);if(r===n){var o=util$2.Buffer;return o?o.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,r,n)};Reader$1.prototype.string=function e(){var t=this.bytes();return utf8.read(t,0,t.length)};Reader$1.prototype.skip=function e(t){if(typeof t=="number"){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this};Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function e(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(e,t,r){if(typeof e!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}Service.prototype.rpcCall=function e(t,r,n,o,s){if(!o)throw TypeError("request must be specified");var l=this;if(!s)return util.asPromise(e,l,t,r,n,o);if(!l.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return l.rpcImpl(t,r[l.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(u,c){if(u)return l.emit("error",u,t),s(u);if(c===null){l.end(!0);return}if(!(c instanceof n))try{c=n[l.responseDelimited?"decodeDelimited":"decode"](c)}catch(h){return l.emit("error",h,t),s(h)}return l.emit("data",c,t),s(null,c)})}catch(u){l.emit("error",u,t),setTimeout(function(){s(u)},0);return}};Service.prototype.end=function e(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(e){var t=e;t.Service=service})(rpc);var roots={};(function(e){var t=e;t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=r;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}r()})(indexMinimal);var minimal=indexMinimal;const $Reader$1=minimal.Reader,$util$1=minimal.util,$root$1=minimal.roots["@REALSEE/FIVE:five/loaders/model/parsers/protobuf/pbm.proto"]||(minimal.roots["@REALSEE/FIVE:five/loaders/model/parsers/protobuf/pbm.proto"]={}),Model$2=$root$1.Model=(()=>{function e(t){if(this.chunks=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.chunks=$util$1.emptyArray,e.prototype.createAt=$util$1.Long?$util$1.Long.fromBits(0,0,!0):0,e.prototype.description="",e.decode=function(t,r){t instanceof $Reader$1||(t=$Reader$1.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root$1.Model;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{o.chunks&&o.chunks.length||(o.chunks=[]),o.chunks.push($root$1.Chunk.decode(t,t.uint32()));break}case 2:{o.createAt=t.uint64();break}case 3:{o.description=t.string();break}default:t.skipType(s&7);break}}return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Model"},e})();$root$1.Chunk=(()=>{function e(t){if(t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.vertices=null,e.prototype.faces=null,e.prototype.name="",e.prototype.texture="",e.decode=function(t,r){t instanceof $Reader$1||(t=$Reader$1.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root$1.Chunk;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{o.vertices=$root$1.Vertices.decode(t,t.uint32());break}case 2:{o.faces=$root$1.Faces.decode(t,t.uint32());break}case 3:{o.name=t.string();break}case 4:{o.texture=t.string();break}default:t.skipType(s&7);break}}if(!o.hasOwnProperty("vertices"))throw $util$1.ProtocolError("missing required 'vertices'",{instance:o});if(!o.hasOwnProperty("faces"))throw $util$1.ProtocolError("missing required 'faces'",{instance:o});if(!o.hasOwnProperty("name"))throw $util$1.ProtocolError("missing required 'name'",{instance:o});return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Chunk"},e})();$root$1.Vertices=(()=>{function e(t){if(this.xyz=[],this.uvs=[],this.marks=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.xyz=$util$1.emptyArray,e.prototype.uvs=$util$1.emptyArray,e.prototype.marks=$util$1.emptyArray,e.decode=function(t,r){t instanceof $Reader$1||(t=$Reader$1.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root$1.Vertices;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{if(o.xyz&&o.xyz.length||(o.xyz=[]),(s&7)===2){let l=t.uint32()+t.pos;for(;t.pos<l;)o.xyz.push(t.float())}else o.xyz.push(t.float());break}case 2:{if(o.uvs&&o.uvs.length||(o.uvs=[]),(s&7)===2){let l=t.uint32()+t.pos;for(;t.pos<l;)o.uvs.push(t.float())}else o.uvs.push(t.float());break}case 3:{if(o.marks&&o.marks.length||(o.marks=[]),(s&7)===2){let l=t.uint32()+t.pos;for(;t.pos<l;)o.marks.push(t.int32())}else o.marks.push(t.int32());break}default:t.skipType(s&7);break}}return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Vertices"},e})();$root$1.Faces=(()=>{function e(t){if(this.indices=[],this.normals=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.indices=$util$1.emptyArray,e.prototype.normals=$util$1.emptyArray,e.decode=function(t,r){t instanceof $Reader$1||(t=$Reader$1.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root$1.Faces;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{if(o.indices&&o.indices.length||(o.indices=[]),(s&7)===2){let l=t.uint32()+t.pos;for(;t.pos<l;)o.indices.push(t.uint32())}else o.indices.push(t.uint32());break}case 2:{if(o.normals&&o.normals.length||(o.normals=[]),(s&7)===2){let l=t.uint32()+t.pos;for(;t.pos<l;)o.normals.push(t.float())}else o.normals.push(t.float());break}default:t.skipType(s&7);break}}return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Faces"},e})();$root$1.VertexMark=(()=>{const e={},t=Object.create(e);return t[e[0]="VERTEX_MARK_UNSPECIFIED"]=0,t[e[1]="VERTEX_MARK_ROOF"]=1,t})();function loadPbm(e,t){var r,n,o,s;t===void 0&&(t={});var l=(r=t.fetcher)!==null&&r!==void 0?r:new Fetcher({allowHosts:["*"]}),u={byteLength:0},c=autoRestImageOptionsByTextureLength((n=t.textureOptions)!==null&&n!==void 0?n:{},(s=(o=t.textureArray)===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0),h={};if(t.textureArray)for(var f=0,m=t.textureArray;f<m.length;f++){var y=m[f];h[y]=loadTexture$1(y,c,l)}return Promise.resolve().then(function(){return l.ajax(e,{responseType:"arraybuffer"})}).then(function(A){return u.byteLength=A.body.byteLength,delay(function(){var M=new Uint8Array(A.body);return Model$2.decode(M)})}).then(function(A){return delay(function(){var M,b,T;return parse$4(A,(M=t.light)!==null&&M!==void 0?M:!1,(b=t.textureBaseUri)!==null&&b!==void 0?b:function(){var _=e.lastIndexOf("/");if(_>=0){var S=e.slice(0,_)+"/";return/\/model\/$/.test(S)&&(S=S.replace(/\/model\/$/,"/materials/")),S}return""}(),((T=t.textureArray)!==null&&T!==void 0?T:[]).slice(),c,h,l)})}).then(function(A){var M=new Group;M.matrixAutoUpdate=!1,M.matrix.compose(M.position,M.quaternion,M.scale),M.name=e;for(var b=0,T=A.objects;b<T.length;b++){var _=T[b];M.add(_)}return{type:"pbm",upAxis:"Z",uri:e,byteLength:u.byteLength,memoryUsage:getMemoryUsage(M),scene:M,textures:A.textures,dispose:function(){return A.dispose()}}})}function parseFloorName(e){var t=e.match(/(group|floor)-?(\d+)/);return t?parseInt(t[2],10):0}function parseChunkName(e){var t=e.match(/(chunk)-?(\d+)/);return t?parseInt(t[2],10):0}function parseSubName(e){var t=e.match(/(sub)-?(\d+)/);return t?parseInt(t[2],10):0}function chunkOrder(e){var t=parseFloorName(e.name),r=parseChunkName(e.name),n=parseSubName(e.name);return t*1e6+r*1e3+n}function parsePBMModel(e){for(var t,r,n,o=typeof e.createAt=="number"?e.createAt:0,s=(t=e.description)!==null&&t!==void 0?t:"",l=[],u=!0,c=!0,h=0,f=e.chunks;h<f.length;h++){var m=f[h];if(!m.vertices.marks||m.vertices.marks.length===0){c=!1;break}}for(var y=0,A=e.chunks;y<A.length;y++){var m=A[y];if(!m.faces.normals||m.faces.normals.length===0){u=!1;break}}for(var M=e.chunks.sort(function(st,We){return chunkOrder(st)-chunkOrder(We)}),b=[],T=0,_=M;T<_.length;T++){var m=_[T],S=parseFloorName(m.name);b[S]||(b[S]=[]),b[S].push(m)}for(var C=0;C<b.length;C++){var P=b[C];if(P)if(u){for(var F=0,O=0;O<P.length;O++){var m=P[O];F+=m.faces.indices.length}for(var N=new Float32Array(F*3),V=new Float32Array(F*2),q=new Float32Array(F*3),Q=c?new Float32Array(F):void 0,z=[],H=[1/0,1/0,1/0,-1/0,-1/0,-1/0],W=0,J=0;J<P.length;J++){for(var G=[1/0,1/0,1/0,-1/0,-1/0,-1/0],m=P[J],te=m.vertices.xyz,X=m.vertices.uvs,K=m.faces.indices,Z=m.faces.normals,ee=m.vertices.marks,j=K.length,O=0;O<j;O++){var re=K[O],pe=N[W*3+O*3]=te[re*3],ge=N[W*3+O*3+1]=te[re*3+1],_e=N[W*3+O*3+2]=te[re*3+2];Q&&(Q[W+O]=ee[re]),V[W*2+O*2]=X[re*2],V[W*2+O*2+1]=X[re*2+1];var he=Math.floor(O/3)*3;q[W*3+O*3]=Z[he],q[W*3+O*3+1]=Z[he+1],q[W*3+O*3+2]=Z[he+2],pe<G[0]&&(G[0]=pe),ge<G[1]&&(G[1]=ge),_e<G[2]&&(G[2]=_e),pe>G[3]&&(G[3]=pe),ge>G[4]&&(G[4]=ge),_e>G[5]&&(G[5]=_e)}G[0]<H[0]&&(H[0]=G[0]),G[1]<H[1]&&(H[1]=G[1]),G[2]<H[2]&&(H[2]=G[2]),G[3]>H[3]&&(H[3]=G[3]),G[4]>H[4]&&(H[4]=G[4]),G[5]>H[5]&&(H[5]=G[5]),z.push({materialIndex:J,name:m.name,chunkName:parseChunkName(m.name),start:W,count:m.faces.indices.length,texture:(r=m.texture)!==null&&r!==void 0?r:void 0}),W+=j}var Fe={createAt:o,description:s,vertices:N,uvs:V,normals:q,masks:Q,indices:null,floorIndex:C,groups:z,extents:H};l.push(Fe)}else{for(var F=0,Re=0,O=0;O<P.length;O++){var m=P[O];Re+=m.vertices.xyz.length/3,F+=m.faces.indices.length}for(var N=new Float32Array(Re*3),V=new Float32Array(Re*2),q=void 0,Le=new Float32Array(Re),Se=new Uint32Array(F),Q=c?new Float32Array(F):void 0,z=[],H=[1/0,1/0,1/0,-1/0,-1/0,-1/0],we=0,W=0,J=0;J<P.length;J++){for(var G=[1/0,1/0,1/0,-1/0,-1/0,-1/0],m=P[J],te=m.vertices.xyz,Ve=m.vertices.marks,X=m.vertices.uvs,K=m.faces.indices,je=te.length/3,j=K.length,O=0;O<je;O++){var pe=N[W*3+O*3]=te[O*3],ge=N[W*3+O*3+1]=te[O*3+1],_e=N[W*3+O*3+2]=te[O*3+2];Q&&(Q[W+O]=Ve[O]),V[W*2+O*2]=X[O*2],V[W*2+O*2+1]=X[O*2+1],Le[W+O]=C,pe<G[0]&&(G[0]=pe),ge<G[1]&&(G[1]=ge),_e<G[2]&&(G[2]=_e),pe>G[3]&&(G[3]=pe),ge>G[4]&&(G[4]=ge),_e>G[5]&&(G[5]=_e)}G[0]<H[0]&&(H[0]=G[0]),G[1]<H[1]&&(H[1]=G[1]),G[2]<H[2]&&(H[2]=G[2]),G[3]>H[3]&&(H[3]=G[3]),G[4]>H[4]&&(H[4]=G[4]),G[5]>H[5]&&(H[5]=G[5]);for(var O=0;O<j;O++)Se[we+O]=W+K[O];z.push({materialIndex:J,name:m.name,chunkName:parseChunkName(m.name),start:we,count:m.faces.indices.length,texture:(n=m.texture)!==null&&n!==void 0?n:void 0}),W+=je,we+=j}var Fe={createAt:o,description:s,vertices:N,uvs:V,normals:q,masks:Q,indices:Se,floorIndex:C,groups:z,extents:H};l.push(Fe)}}return l}function loadTexture$1(e,t,r){var n=__assign({key:"texture.pbm"},pick(t,["format","quality","size","sharpen","mappings"])),o=new TextureLoader,s=o.loadTexture(e,{imageURL:{transform:t.transform,options:n},encoding:sRGBEncoding,wrapS:ClampToEdgeWrapping,wrapT:ClampToEdgeWrapping,minFilter:LinearFilter,maxSize:typeof n.size=="number"?new Vector2(n.size,n.size):void 0,fetcher:r}).then(function(l){var u=l.body;return u.needsUpdate=!0,u});return Object.assign(s,{url:e,textureOptions:t})}function parse$4(e,t,r,n,o,s,l){s===void 0&&(s={});for(var u=parsePBMModel(e),c=0,h="",f=[],m={},y=new Set,A=0,M=0,b=u;M<b.length;M++){var T=b[M],_=T.createAt,S=T.description,C=T.vertices,P=T.masks,F=T.uvs,O=T.normals,N=T.indices,V=T.floorIndex,q=T.groups,Q=T.extents,z=new Box3;z.min.x=Q[0],z.min.y=Q[1],z.min.z=Q[2],z.max.x=Q[3],z.max.y=Q[4],z.max.z=Q[5];var H=new BufferGeometry;H.setAttribute("position",new BufferAttribute(C,3)),H.setAttribute("uv",new BufferAttribute(F,2)),O&&H.setAttribute("normal",new BufferAttribute(O,3)),P&&H.setAttribute("_feature_id_rsmask",new BufferAttribute(P,1)),N&&H.setIndex(new BufferAttribute(N,1)),H.boundingBox=z,H.boundingSphere=z.getBoundingSphere(new Sphere);for(var W=0,J=q;W<J.length;W++){var G=J[W];H.addGroup(G.start,G.count,G.materialIndex)}y.add(H);for(var te=[],X=0,K=q;X<K.length;X++){var G=K[X],Z=n[G.chunkName]||(G.texture?pathJoin(r||"",G.texture):void 0),ee=new PBMMeshMaterial(t?"phong":"basic");ee.floorIndex=V,H.attributes.normal===void 0&&(ee.flatShading=!0),H.attributes._feature_id_rsmask&&(ee.defines.USE_VERTEX_MARK=!0),te.push(ee),Z?(A++,m[Z]?m[Z].push(ee):m[Z]=[ee]):ee.color=new Color(16777215),y.add(ee),ee.refreshUniforms()}var j=new PBMMesh(H,te);j.name="model_floor_"+V,j.userData.createAt=_,j.userData.description=S,j.matrix.compose(j.position,j.quaternion,j.scale),j.matrixAutoUpdate=!1,j.frustumCulled=!1,c=_,h=S,f.push(j)}var re=function(pe){pe=autoRestImageOptionsByTextureLength(pe,A);for(var ge=[],_e=function(Le){var Se=null;Le in s&&(Se=s[Le]),Se||(Se=loadTexture$1(Le,pe,l)),ge.push(Se.then(function(we){for(var Ve=0,je=m[Le];Ve<je.length;Ve++){var st=je[Ve];st.map&&(y.delete(st.map),st.map.dispose()),st.map=we,st.refreshUniforms(),y.add(we)}return we}).catch(function(){for(var we=0,Ve=m[Le];we<Ve.length;we++){var je=Ve[we];je.map&&(y.delete(je.map),je.map.dispose()),je.map=null,je.color=new Color(16777215),je.refreshUniforms()}return null}))},he=0,Fe=Object.keys(m);he<Fe.length;he++){var Re=Fe[he];_e(Re)}for(var Re in s)delete s[Re];return Promise.all(ge).then(function(Le){return Le.filter(function(Se){return Se})})};return re(o).then(function(pe){return{createAt:c,description:h,objects:f,textures:pe,dispose:function(){y.forEach(function(ge){ge.dispose()}),y.clear()}}})}function autoRestImageOptionsByTextureLength(e,t){return e=Object.assign({},e),e.autoResize!==!1&&(t>96?e.size=Math.min(e.size||1/0,100):t>48?e.size=Math.min(e.size||1/0,200):t>24?e.size=Math.min(e.size||1/0,400):t>22?e.size=Math.min(e.size||1/0,800):t>5&&(e.size=Math.min(e.size||1/0,1024))),e}function loadAt3d(e,t){var r,n,o,s;t===void 0&&(t={});var l=(r=t.fetcher)!==null&&r!==void 0?r:new Fetcher({allowHosts:["*"]}),u={byteLength:0},c=autoRestImageOptionsByTextureLength((n=t.textureOptions)!==null&&n!==void 0?n:{},(s=(o=t.textureArray)===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0),h={};if(t.textureArray)for(var f=0,m=t.textureArray;f<m.length;f++){var y=m[f];h[y]=loadTexture$1(y,c,l)}return Promise.resolve().then(function(){return l.ajax(e,{responseType:"arraybuffer"})}).then(function(A){return lzma(A.body)}).then(function(A){return delay(function(){for(var M,b={chunks:[],createAt:void 0,description:void 0},T=0,_=A;T<_.length;T++){var S=_[T],C=Model$2.decode(S);C.chunks.length&&((M=b.chunks).push.apply(M,C.chunks),b.createAt=C.createAt,b.description=C.description)}return b})}).then(function(A){return delay(function(){var M,b,T,_;return parse$4(A,(M=t.light)!==null&&M!==void 0?M:!1,(b=t.textureBaseUri)!==null&&b!==void 0?b:function(){var S=e.lastIndexOf("/");if(S>=0){var C=e.slice(0,S)+"/";return/\/model\/$/.test(C)&&(C=C.replace(/\/model\/$/,"/materials/")),C}return""}(),((T=t.textureArray)!==null&&T!==void 0?T:[]).slice(),(_=t.textureOptions)!==null&&_!==void 0?_:{},h,l)})}).then(function(A){var M=new Group;M.name=e;for(var b=0,T=A.objects;b<T.length;b++){var _=T[b];M.add(_)}return{type:"at3d",upAxis:"Z",uri:e,byteLength:u.byteLength,memoryUsage:getMemoryUsage(M),scene:M,textures:A.textures,dispose:function(){return A.dispose()}}})}const $Reader=minimal.Reader,$util=minimal.util,$root=minimal.roots["@REALSEE/FIVE:five/loaders/model/parsers/protobuf/dome.proto"]||(minimal.roots["@REALSEE/FIVE:five/loaders/model/parsers/protobuf/dome.proto"]={}),Model$1=$root.Model=(()=>{function e(t){if(this.meshes=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.meshes=$util.emptyArray,e.decode=function(t,r){t instanceof $Reader||(t=$Reader.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root.Model;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{o.meshes&&o.meshes.length||(o.meshes=[]),o.meshes.push($root.Mesh.decode(t,t.uint32()));break}default:t.skipType(s&7);break}}return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Model"},e})();$root.Mesh=(()=>{function e(t){if(this.chunks=[],this.matrix=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.name="",e.prototype.chunks=$util.emptyArray,e.prototype.matrix=$util.emptyArray,e.decode=function(t,r){t instanceof $Reader||(t=$Reader.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root.Mesh;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{o.name=t.string();break}case 2:{o.chunks&&o.chunks.length||(o.chunks=[]),o.chunks.push($root.Chunk.decode(t,t.uint32()));break}case 3:{o.matrix&&o.matrix.length||(o.matrix=[]),o.matrix.push($root.Matrix.decode(t,t.uint32()));break}default:t.skipType(s&7);break}}if(!o.hasOwnProperty("name"))throw $util.ProtocolError("missing required 'name'",{instance:o});return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Mesh"},e})();$root.Matrix=(()=>{function e(t){if(this.elements=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.elements=$util.emptyArray,e.decode=function(t,r){t instanceof $Reader||(t=$Reader.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root.Matrix;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{if(o.elements&&o.elements.length||(o.elements=[]),(s&7)===2){let l=t.uint32()+t.pos;for(;t.pos<l;)o.elements.push(t.float())}else o.elements.push(t.float());break}default:t.skipType(s&7);break}}return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Matrix"},e})();$root.Chunk=(()=>{function e(t){if(this.material=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.geometry=null,e.prototype.material=$util.emptyArray,e.decode=function(t,r){t instanceof $Reader||(t=$Reader.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root.Chunk;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 2:{o.geometry=$root.Geometry.decode(t,t.uint32());break}case 3:{o.material&&o.material.length||(o.material=[]),o.material.push($root.Material.decode(t,t.uint32()));break}default:t.skipType(s&7);break}}if(!o.hasOwnProperty("geometry"))throw $util.ProtocolError("missing required 'geometry'",{instance:o});return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Chunk"},e})();$root.Geometry=(()=>{function e(t){if(this.groups=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.position=null,e.prototype.uv=null,e.prototype.uv2=null,e.prototype.normal=null,e.prototype.groups=$util.emptyArray,e.decode=function(t,r){t instanceof $Reader||(t=$Reader.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root.Geometry;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{o.position=$root.Position.decode(t,t.uint32());break}case 2:{o.uv=$root.UV.decode(t,t.uint32());break}case 3:{o.uv2=$root.UV.decode(t,t.uint32());break}case 4:{o.normal=$root.Normal.decode(t,t.uint32());break}case 5:{o.groups&&o.groups.length||(o.groups=[]),o.groups.push($root.Group.decode(t,t.uint32()));break}default:t.skipType(s&7);break}}if(!o.hasOwnProperty("position"))throw $util.ProtocolError("missing required 'position'",{instance:o});if(!o.hasOwnProperty("normal"))throw $util.ProtocolError("missing required 'normal'",{instance:o});return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Geometry"},e})();$root.Position=(()=>{function e(t){if(this.array=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.array=$util.emptyArray,e.decode=function(t,r){t instanceof $Reader||(t=$Reader.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root.Position;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{if(o.array&&o.array.length||(o.array=[]),(s&7)===2){let l=t.uint32()+t.pos;for(;t.pos<l;)o.array.push(t.float())}else o.array.push(t.float());break}default:t.skipType(s&7);break}}return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Position"},e})();$root.UV=(()=>{function e(t){if(this.array=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.array=$util.emptyArray,e.decode=function(t,r){t instanceof $Reader||(t=$Reader.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root.UV;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{if(o.array&&o.array.length||(o.array=[]),(s&7)===2){let l=t.uint32()+t.pos;for(;t.pos<l;)o.array.push(t.float())}else o.array.push(t.float());break}default:t.skipType(s&7);break}}return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/UV"},e})();$root.Normal=(()=>{function e(t){if(this.array=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.array=$util.emptyArray,e.decode=function(t,r){t instanceof $Reader||(t=$Reader.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root.Normal;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{if(o.array&&o.array.length||(o.array=[]),(s&7)===2){let l=t.uint32()+t.pos;for(;t.pos<l;)o.array.push(t.float())}else o.array.push(t.float());break}default:t.skipType(s&7);break}}return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Normal"},e})();$root.Group=(()=>{function e(t){if(t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.start=0,e.prototype.count=0,e.prototype.materialIndex=0,e.decode=function(t,r){t instanceof $Reader||(t=$Reader.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root.Group;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{o.start=t.uint32();break}case 2:{o.count=t.uint32();break}case 3:{o.materialIndex=t.uint32();break}default:t.skipType(s&7);break}}if(!o.hasOwnProperty("start"))throw $util.ProtocolError("missing required 'start'",{instance:o});if(!o.hasOwnProperty("count"))throw $util.ProtocolError("missing required 'count'",{instance:o});if(!o.hasOwnProperty("materialIndex"))throw $util.ProtocolError("missing required 'materialIndex'",{instance:o});return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Group"},e})();$root.Material=(()=>{function e(t){if(t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.kd=null,e.prototype.ks=null,e.prototype.ke=null,e.prototype.mapkd="",e.prototype.mapks="",e.prototype.mapke="",e.prototype.norm="",e.prototype.mapbump="",e.prototype.bump="",e.prototype.mapd="",e.prototype.ns=0,e.prototype.d=0,e.prototype.tr=0,e.prototype.mapkdrepeat="",e.decode=function(t,r){t instanceof $Reader||(t=$Reader.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root.Material;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{o.kd=$root.Color.decode(t,t.uint32());break}case 2:{o.ks=$root.Color.decode(t,t.uint32());break}case 3:{o.ke=$root.Color.decode(t,t.uint32());break}case 4:{o.mapkd=t.string();break}case 5:{o.mapks=t.string();break}case 6:{o.mapke=t.string();break}case 7:{o.norm=t.string();break}case 8:{o.mapbump=t.string();break}case 9:{o.bump=t.string();break}case 10:{o.mapd=t.string();break}case 11:{o.ns=t.float();break}case 12:{o.d=t.float();break}case 13:{o.tr=t.float();break}case 14:{o.mapkdrepeat=t.string();break}default:t.skipType(s&7);break}}return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Material"},e})();$root.Color=(()=>{function e(t){if(this.rgb=[],t)for(let r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.rgb=$util.emptyArray,e.decode=function(t,r){t instanceof $Reader||(t=$Reader.create(t));let n=r===void 0?t.len:t.pos+r,o=new $root.Color;for(;t.pos<n;){let s=t.uint32();switch(s>>>3){case 1:{if(o.rgb&&o.rgb.length||(o.rgb=[]),(s&7)===2){let l=t.uint32()+t.pos;for(;t.pos<l;)o.rgb.push(t.float())}else o.rgb.push(t.float());break}default:t.skipType(s&7);break}}return o},e.getTypeUrl=function(t){return t===void 0&&(t="type.googleapis.com"),t+"/Color"},e})();var ROTATE_X_MATRIX$5=new Matrix4().fromArray([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]);function loadDome(e,t){var r;t===void 0&&(t={});var n=(r=t.fetcher)!==null&&r!==void 0?r:new Fetcher({allowHosts:["*"]}),o={byteLength:0};return Promise.resolve().then(function(){return n.ajax(e,{responseType:"arraybuffer"})}).then(function(s){var l,u;return o.byteLength=s.body.byteLength,parse$3(new Uint8Array(s.body),(l=t.light)!==null&&l!==void 0?l:!0,t.textureBaseUri||"",(u=t.textureOptions)!==null&&u!==void 0?u:{},n)}).then(function(s){var l=new Group;l.matrixAutoUpdate=!1,l.applyMatrix4(ROTATE_X_MATRIX$5),l.matrix.compose(l.position,l.quaternion,l.scale),l.name=e;for(var u=0,c=s.objects;u<c.length;u++){var h=c[u];l.add(h)}return{type:"dome",upAxis:"Z",uri:e,byteLength:o.byteLength,memoryUsage:getMemoryUsage(l),scene:l,textures:s.textures,dispose:function(){return s.dispose()}}})}function flipBufferGeometryNormals(e){for(var t=[0,0,0],r=0;r<e.attributes.normal.array.length/9;r++)t[0]=e.attributes.normal.array[r*9],t[1]=e.attributes.normal.array[r*9+1],t[2]=e.attributes.normal.array[r*9+2],e.attributes.normal.array[r*9]=e.attributes.normal.array[r*9+6],e.attributes.normal.array[r*9+1]=e.attributes.normal.array[r*9+7],e.attributes.normal.array[r*9+2]=e.attributes.normal.array[r*9+8],e.attributes.normal.array[r*9+6]=t[0],e.attributes.normal.array[r*9+7]=t[1],e.attributes.normal.array[r*9+8]=t[2];for(var r=0;r<e.attributes.position.array.length/9;r++)t[0]=e.attributes.position.array[r*9],t[1]=e.attributes.position.array[r*9+1],t[2]=e.attributes.position.array[r*9+2],e.attributes.position.array[r*9]=e.attributes.position.array[r*9+6],e.attributes.position.array[r*9+1]=e.attributes.position.array[r*9+7],e.attributes.position.array[r*9+2]=e.attributes.position.array[r*9+8],e.attributes.position.array[r*9+6]=t[0],e.attributes.position.array[r*9+7]=t[1],e.attributes.position.array[r*9+8]=t[2];for(var r=0;r<e.attributes.uv.array.length/6;r++)t[0]=e.attributes.uv.array[r*6],t[1]=e.attributes.uv.array[r*6+1],e.attributes.uv.array[r*6]=e.attributes.uv.array[r*6+4],e.attributes.uv.array[r*6+1]=e.attributes.uv.array[r*6+5],e.attributes.uv.array[r*6+4]=t[0],e.attributes.uv.array[r*6+5]=t[1];e.attributes.normal.needsUpdate=!0,e.attributes.position.needsUpdate=!0,e.attributes.uv.needsUpdate=!0}function parseGeometry(e){var t=e.position,r=e.normal,n=e.uv,o=e.uv2,s=e.groups,l=new BufferGeometry;l.setAttribute("position",new BufferAttribute(new Float32Array(t.array),3)),r&&l.setAttribute("normal",new BufferAttribute(new Float32Array(r.array),3)),n&&l.setAttribute("uv",new BufferAttribute(new Float32Array(n.array),2)),o&&l.setAttribute("uv2",new BufferAttribute(new Float32Array(o.array),2));for(var u=0,c=s;u<c.length;u++){var h=c[u];l.addGroup(h.start,h.count,h.materialIndex)}return l}function loadTexture(e,t,r,n,o,s,l){if(l.hasOwnProperty(e))return l[e];e=e.split("?")[0],isAbsoluteURL(e)||(e=pathJoin(t,e)),e=e.replace(/\/\/vrlab-image\d*.ljcdn.com\//,"//vrlab-public.ljcdn.com/"),e.indexOf("//")===0&&(e="https:"+e);var u=__assign({key:"texture.dome",size:64},pick(r,["quality","format","sharpen","mappings"])),c=l[e]=o.loadTexture(e,{imageURL:{transform:r.transform,options:u},wrapS:RepeatWrapping,wrapT:RepeatWrapping,fetcher:s}).then(function(h){var f=h.body;return n&&f.repeat.copy(n),f.needsUpdate=!0,f.updateMatrix(),f});return c}function parseMaterial(e,t,r,n,o,s,l,u,c){var h=[],f=new PBMMeshMaterial(t?"phong":"basic");if(u.add(f),e.kd&&(f.color=new Color().fromArray(e.kd.rgb).convertLinearToSRGB()),e.mapkd){var m=null;if(e.mapkdrepeat){var y=e.mapkdrepeat.split(/\s+/).map(function(T){return Number(T)}),A=y[0],M=y[1];m=new Vector2(A,M)}h.push(loadTexture(e.mapkd,r,n,m,o,s,l).then(function(T){T.encoding=sRGBEncoding,f.map=T,u.add(T),c.add(T),f.needsUpdate=!0}).catch(noop$1))}if(e.ks&&(f.specular=new Color().fromArray(e.ks.rgb).convertLinearToSRGB()),e.mapks&&h.push(loadTexture(e.mapks,r,n,null,o,s,l).then(function(T){f.specularMap=T,u.add(T),c.add(T)}).catch(noop$1)),e.ke&&(f.emissive=new Color().fromArray(e.ke.rgb).convertLinearToSRGB()),e.mapke&&h.push(loadTexture(e.mapke,r,n,null,o,s,l).then(function(T){T.encoding=sRGBEncoding,f.emissiveMap=T,u.add(T),c.add(T)}).catch(noop$1)),e.norm&&h.push(loadTexture(e.norm,r,n,null,o,s,l).then(function(T){f.normalMap=T,u.add(T),c.add(T)}).catch(noop$1)),e.mapbump&&h.push(loadTexture(e.mapbump,r,n,null,o,s,l).then(function(T){f.bumpMap=T,u.add(T),c.add(T)}).catch(noop$1)),e.bump&&h.push(loadTexture(e.bump,r,n,null,o,s,l).then(function(T){f.bumpMap=T,u.add(T),c.add(T)}).catch(noop$1)),typeof e.ns=="number"&&(f.shininess=e.ns),typeof e.d=="number"){var b=e.d;b>0&&b<1&&(f.opacity=b)}return f.floorIndex=0,f.refreshUniforms(),{material:f,textureReady:Promise.all(h).then(function(){return f.refreshUniforms()}).then(noop$1)}}function fromProtoBuf(e){return Model$1.decode(e).meshes}function parse$3(e,t,r,n,o){for(var s=[],l=[],u=new Set,c=fromProtoBuf(e),h=new TextureLoader,f=new Matrix4,m=new Vector3,y=new Quaternion,A=new Vector3,M={},b=new Set,T=0,_=c;T<_.length;T++){var S=_[T],C=S.name,P=S.chunks,F=S.matrix;if(!(C==="Ceiling"||C==="CeilingDrop"))for(var O=0,N=F;O<N.length;O++){var V=N[O];f.elements=V.elements;for(var q=new Group,Q=0;Q<P.length;Q++){var z=parseGeometry(P[Q].geometry);z.applyMatrix4(f),f.decompose(m,y,A),A.x*A.y*A.z<0&&z.attributes.normal&&z.attributes.position&&z.attributes.uv&&flipBufferGeometryNormals(z),u.add(z);for(var H=[],W=0,J=P[Q].material;W<J.length;W++){var G=J[W],te=parseMaterial(G,t,r||"",n,h,o,M,u,b),X=te.material,K=te.textureReady;l.push(K),H.push(X)}var Z=new PBMMesh(z,H);Z.name="chunk_"+Q,Z.matrix.compose(Z.position,Z.quaternion,Z.scale),Z.matrixAutoUpdate=!1,Z.frustumCulled=!1,q.add(Z)}q.name=C,s.push(q)}}return Promise.all(l).catch(noop$1).then(function(){return{createAt:0,description:"",objects:s,textures:Array.from(b),dispose:function(){u.forEach(function(ee){ee.dispose()}),u.clear()}}})}var ROTATE_X_MATRIX$4=new Matrix4().fromArray([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]);function loadDomez(e,t){var r;t===void 0&&(t={});var n=(r=t.fetcher)!==null&&r!==void 0?r:new Fetcher({allowHosts:["*"]}),o={byteLength:0};return Promise.resolve().then(function(){return n.ajax(e,{responseType:"arraybuffer"})}).then(function(s){return o.byteLength=s.body.byteLength,lzma(s.body)}).then(function(s){var l=s.reduce(function(h,f){return h+f.length},0),u=new Uint8Array(l),c=0;return s.forEach(function(h){u.set(h,c),c+=h.length}),u}).then(function(s){var l,u;return parse$3(s,(l=t.light)!==null&&l!==void 0?l:!0,t.textureBaseUri||"",(u=t.textureOptions)!==null&&u!==void 0?u:{},n)}).then(function(s){var l=new Group;l.matrixAutoUpdate=!1,l.applyMatrix4(ROTATE_X_MATRIX$4),l.matrix.compose(l.position,l.quaternion,l.scale),l.name=e;for(var u=0,c=s.objects;u<c.length;u++){var h=c[u];l.add(h)}return{type:"domez",upAxis:"Z",uri:e,byteLength:o.byteLength,memoryUsage:getMemoryUsage(l),scene:l,textures:s.textures,dispose:function(){return s.dispose()}}})}var ROTATE_X_MATRIX$3=new Matrix4().fromArray([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]);function loadGltf(e,t){var r,n;t===void 0&&(t={});var o=(r=t.upAxis)!==null&&r!==void 0?r:"Y",s=(n=t.fetcher)!==null&&n!==void 0?n:new Fetcher({allowHosts:["*"]}),l=0;return Promise.resolve().then(function(){return s.ajax(e,{responseType:"arraybuffer"}).then(function(u){return l=u.body.byteLength,u.body})}).then(function(u){var c;return parseGltf(u,{copyUV2:!1,resourcePath:e.slice(0,e.lastIndexOf("/")+1),search:(c=e.split("?")[1])!==null&&c!==void 0?c:"",jsonModify:function(h){var f;if(h.extensionsUsed=(f=h.extensionsUsed)!==null&&f!==void 0?f:[],typeof t.light=="boolean"){var m="KHR_materials_unlit";if(t.light){var y=h.extensionsUsed.indexOf(m);y>=0&&h.extensionsUsed.splice(y,1)}else{var y=h.extensionsUsed.indexOf(m);y===-1&&h.extensionsUsed.push(m)}}{var m="PBM_mesh",y=h.extensionsUsed.indexOf(m);y===-1&&h.extensionsUsed.push(m)}return h},fetcher:s})}).then(function(u){var c=new Matrix4;if(o==="Y"&&c.premultiply(ROTATE_X_MATRIX$3),u.CESIUM_RTC){var h=new Matrix4().setPosition(u.CESIUM_RTC.center);c.premultiply(h)}var f=u.scene;return f.applyMatrix4(c),{type:"gltf",upAxis:"Z",uri:e,byteLength:l,memoryUsage:getMemoryUsage(f),scene:f,textures:u.textures,dispose:function(){return u.dispose()}}})}var ROTATE_X_MATRIX$2=new Matrix4().fromArray([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),scratchColor=new Color;function loadPly(e,t){var r,n;t===void 0&&(t={});var o=(r=t.upAxis)!==null&&r!==void 0?r:"Z",s=(n=t.fetcher)!==null&&n!==void 0?n:new Fetcher({allowHosts:["*"]}),l=0;return Promise.resolve().then(function(){return s.ajax(e,{responseType:"arraybuffer"}).then(function(u){return l=u.body.byteLength,u.body})}).then(function(u){var c,h;return parsePly(u,{propertyNameMapping:(c=t.propertyNameMapping)!==null&&c!==void 0?c:{},customPropertyMapping:(h=t.customPropertyMapping)!==null&&h!==void 0?h:{}})}).then(function(u){var c=u.geometry;switch(t.type){case"geometry":{var h=c;return o==="Y"&&h.applyMatrix4(ROTATE_X_MATRIX$2),{type:"ply",upAxis:"Z",uri:e,byteLength:l,memoryUsage:getGeometryMemoryUsed(h),scene:h,meta:{},textures:[],dispose:function(){c.dispose()}}}case"line":{var f="color"in c.attributes,m=new LineBasicMaterial({vertexColors:f}),h=new Line(c,m);return h.computeLineDistances(),o==="Y"&&h.applyMatrix4(ROTATE_X_MATRIX$2),{type:"ply",upAxis:"Z",uri:e,byteLength:l,memoryUsage:getMemoryUsage(h),scene:h,meta:{},textures:[],dispose:function(){c.dispose(),m.dispose()}}}case"pbmMesh":{var y=new PBMMeshMaterial(t.light?"phong":"basic");y.vertexColors="color"in c.attributes;var h=new Mesh(c,y);return o==="Y"&&h.applyMatrix4(ROTATE_X_MATRIX$2),{type:"ply",upAxis:"Z",uri:e,byteLength:l,memoryUsage:getMemoryUsage(h),scene:h,meta:{},textures:[],dispose:function(){c.dispose(),y.dispose()}}}case"pbmPointCloud":{var A=new PBMPointCloudMaterial,h=new PBMPointCloud(c,A);return o==="Y"&&h.applyMatrix4(ROTATE_X_MATRIX$2),{type:"ply",upAxis:"Z",uri:e,byteLength:l,memoryUsage:getMemoryUsage(h),scene:h,meta:{},textures:[],dispose:function(){c.dispose(),A.dispose()}}}}throw new Error("Invalid Type: ".concat(t.type))})}function parsePly(e,t){var r=new Uint8Array(e),n=extractHeaderText(r),o=n.headerText,s=n.headerLength,l=parseHeader(o,s,t);if(l.format==="ascii"){var u=new TextDecoder().decode(r);return{header:l,geometry:parseASCII(u,l,t)}}else return{header:l,geometry:parseBinary(e,l,t)}}function makePlyElementProperty(e,t){var r={name:"",type:e[0]};return r.type==="list"?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t.propertyNameMapping&&(r.name=t.propertyNameMapping[r.name]),r}function parseHeader(e,t,r){t===void 0&&(t=0);var n=/^ply([\s\S]*)end_header(\r\n|\r|\n)/,o="",s=n.exec(e);s!==null&&(o=s[1]);for(var l={format:"",version:"",comments:[],elements:[],headerLength:t,objInfo:""},u=o.split(/\r\n|\r|\n/),c=null,h=0;h<u.length;h++){var f=u[h];if(f=f.trim(),f!==""){var m=f.split(/\s+/),y=m.shift();switch(f=m.join(" "),y){case"format":l.format=m[0],l.version=m[1];break;case"comment":l.comments.push(f);break;case"element":c&&l.elements.push(c),c={name:m[0],count:parseInt(m[1]),properties:[]};break;case"property":c&&c.properties.push(makePlyElementProperty(m,r));break;case"obj_info":l.objInfo=f;break;default:console.log("unhandled",y,m)}}}return c&&l.elements.push(c),l}function parseASCIINumber(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e);default:throw new Error("unspport type: "+t)}}function parseASCIIElement(e,t){for(var r={},n=0;n<e.length;n++){if(t.empty())return null;if(e[n].type==="list"){for(var o=[],s=parseASCIINumber(t.next(),e[n].countType),l=0;l<s;l++){if(t.empty())return null;o.push(parseASCIINumber(t.next(),e[n].itemType))}r[e[n].name]=o}else r[e[n].name]=parseASCIINumber(t.next(),e[n].type)}return r}function createBuffer(e){for(var t={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]},r=0,n=Object.keys(e.customPropertyMapping);r<n.length;r++){var o=n[r];t[o]=[]}return t}function mapElementAttributes(e){var t=e.map(function(n){return n.name});function r(n){for(var o=0,s=n.length;o<s;o++){var l=n[o];if(t.includes(l))return l}return null}return{attrX:r(["x","px","posx"])||"x",attrY:r(["y","py","posy"])||"y",attrZ:r(["z","pz","posz"])||"z",attrNX:r(["nx","normalx"]),attrNY:r(["ny","normaly"]),attrNZ:r(["nz","normalz"]),attrS:r(["s","u","texture_u","tx"]),attrT:r(["t","v","texture_v","ty"]),attrR:r(["red","diffuse_red","r","diffuse_r"]),attrG:r(["green","diffuse_green","g","diffuse_g"]),attrB:r(["blue","diffuse_blue","b","diffuse_b"])}}function parseASCII(e,t,r){var n=createBuffer(r),o=/end_header\s+(\S[\s\S]*\S|\S)\s*$/,s,l=null;(l=o.exec(e))!==null?s=l[1].split(/\s+/):s=[];var u=new ArrayStream(s);e:for(var c=0;c<t.elements.length;c++)for(var h=t.elements[c],f=mapElementAttributes(h.properties),m=0;m<h.count;m++){var y=parseASCIIElement(h.properties,u);if(!y)break e;handleElement(n,h.name,y,f,r)}return postProcess(n,r)}function postProcess(e,t){var r=new BufferGeometry;e.indices.length>0&&r.setIndex(e.indices),r.setAttribute("position",new Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&r.setAttribute("normal",new Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&r.setAttribute("uv",new Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&r.setAttribute("color",new Float32BufferAttribute(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(r=r.toNonIndexed(),e.faceVertexUvs.length>0&&r.setAttribute("uv",new Float32BufferAttribute(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&r.setAttribute("color",new Float32BufferAttribute(e.faceVertexColors,3)));for(var n=0,o=Object.keys(t.customPropertyMapping);n<o.length;n++){var s=o[n];if(e[s].length>0){var l=t.customPropertyMapping[s],u=l.itemType,c=l.itemNames,h=l.normalized,f=c.length,m=void 0;switch(u){case"float32":m=new Float32BufferAttribute(e[s],f,h);break;case"uint32":m=new Uint32BufferAttribute(e[s],f,h);break;case"int32":m=new Int32BufferAttribute(e[s],f,h);break;case"uint16":m=new Uint16BufferAttribute(e[s],f,h);break;case"int16":m=new Int16BufferAttribute(e[s],f,h);break;case"uint8":m=new Uint8BufferAttribute(e[s],f,h);break;case"int8":m=new Int8BufferAttribute(e[s],f,h);break;default:m=new Float32BufferAttribute(e[s],f,h);break}r.setAttribute(s,m)}}return r.computeBoundingSphere(),r}function handleElement(e,t,r,n,o){if(t==="vertex"){n.attrX!==null&&n.attrY!==null&&n.attrZ!==null&&e.vertices.push(r[n.attrX],r[n.attrY],r[n.attrZ]),n.attrNX!==null&&n.attrNY!==null&&n.attrNZ!==null&&e.normals.push(r[n.attrNX],r[n.attrNY],r[n.attrNZ]),n.attrS!==null&&n.attrT!==null&&e.uvs.push(r[n.attrS],r[n.attrT]),n.attrR!==null&&n.attrG!==null&&n.attrB!==null&&(scratchColor.setRGB(r[n.attrR]/255,r[n.attrG]/255,r[n.attrB]/255),e.colors.push(scratchColor.r,scratchColor.g,scratchColor.b));for(var s=0,l=Object.keys(o.customPropertyMapping);s<l.length;s++)for(var u=l[s],c=0,h=o.customPropertyMapping[u].itemNames;c<h.length;c++){var f=h[c];e[u].push(r[f])}}else if(t==="face"){var m=r.vertex_indices||r.vertex_index,y=r.texcoord;m.length===3?(e.indices.push(m[0],m[1],m[2]),y&&y.length===6&&(e.faceVertexUvs.push(y[0],y[1]),e.faceVertexUvs.push(y[2],y[3]),e.faceVertexUvs.push(y[4],y[5]))):m.length===4&&(e.indices.push(m[0],m[1],m[3]),e.indices.push(m[1],m[2],m[3])),n.attrR!==null&&n.attrG!==null&&n.attrB!==null&&(scratchColor.setRGB(r[n.attrR]/255,r[n.attrG]/255,r[n.attrB]/255),e.faceVertexColors.push(scratchColor.r,scratchColor.g,scratchColor.b),e.faceVertexColors.push(scratchColor.r,scratchColor.g,scratchColor.b),e.faceVertexColors.push(scratchColor.r,scratchColor.g,scratchColor.b))}}function binaryReadElement(e,t){for(var r={},n=0,o=0;o<t.length;o++){var s=t[o],l=s.valueReader;if(s.type==="list"){var u=[],c=s.countReader.read(e+n);n+=s.countReader.size;for(var h=0;h<c;h++)u.push(l.read(e+n)),n+=l.size;r[s.name]=u}else r[s.name]=l.read(e+n),n+=l.size}return[r,n]}function setPropertyBinaryReaders(e,t,r){function n(u,c,h){switch(c){case"int8":case"char":return{read:function(f){return u.getInt8(f)},size:1};case"uint8":case"uchar":return{read:function(f){return u.getUint8(f)},size:1};case"int16":case"short":return{read:function(f){return u.getInt16(f,h)},size:2};case"uint16":case"ushort":return{read:function(f){return u.getUint16(f,h)},size:2};case"int32":case"int":return{read:function(f){return u.getInt32(f,h)},size:4};case"uint32":case"uint":return{read:function(f){return u.getUint32(f,h)},size:4};case"float32":case"float":return{read:function(f){return u.getFloat32(f,h)},size:4};case"float64":case"double":return{read:function(f){return u.getFloat64(f,h)},size:8};default:throw new Error("not support type: "+c)}}for(var o=0,s=e.length;o<s;o++){var l=e[o];l.type==="list"?(l.countReader=n(t,l.countType,r),l.valueReader=n(t,l.itemType,r)):l.valueReader=n(t,l.type,r)}}function parseBinary(e,t,r){for(var n=createBuffer(r),o=t.format==="binary_little_endian",s=new DataView(e,t.headerLength),l,u=0,c=0;c<t.elements.length;c++){var h=t.elements[c],f=h.properties,m=mapElementAttributes(f);setPropertyBinaryReaders(f,s,o);for(var y=0;y<h.count;y++){l=binaryReadElement(u,f),u+=l[1];var A=l[0];handleElement(n,h.name,A,m,r)}}return postProcess(n,r)}function extractHeaderText(e){var t=0,r=!0,n="",o=[],s=new TextDecoder().decode(e.subarray(0,5)),l=/^ply\r\n/.test(s);do{var u=String.fromCharCode(e[t++]);u!==`
`&&u!=="\r"?n+=u:(n==="end_header"&&(r=!1),n!==""&&(o.push(n),n=""))}while(r&&t<e.length);return l===!0&&t++,{headerText:o.join("\r")+"\r",headerLength:t}}var ArrayStream=function(){function e(t){this.arr=t,this.i=0}return e.prototype.empty=function(){return this.i>=this.arr.length},e.prototype.next=function(){return this.arr[this.i++]},e}(),ROTATE_X_MATRIX$1=new Matrix4().fromArray([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),_object_pattern=/^[og]\s*(.+)?/,_material_library_pattern=/^mtllib /,_material_use_pattern=/^usemtl /,_map_use_pattern=/^usemap /,_face_vertex_data_separator_pattern=/\s+/,_color=new Color,ObjState=function(){function e(){this.objects=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.materials={},this.materialLibraries=[],this.startObject("",!1)}return e.prototype.startObject=function(t,r){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=r!==!1;return}var n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:r!==!1,geometry:{vertices:[],hasNormal:!0,normals:[],hasColor:!0,colors:[],hasUV:!0,uvs:[],index:[],indexMap:{}},materials:[],smooth:!0,startMaterial:function(s,l){var u,c,h=this._finalize(!1);h&&(h.inherited||((u=h.groupCount)!==null&&u!==void 0?u:0)<=0)&&this.materials.splice((c=h.index)!==null&&c!==void 0?c:0,1);var f={index:this.materials.length,name:s||"",mtllib:Array.isArray(l)&&l.length>0?l[l.length-1]:"",smooth:h!==void 0?h.smooth:this.smooth,groupStart:h!==void 0?h.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(m){var y={index:typeof m=="number"?m:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(){return this}};return y.clone=this.clone.bind(y),y}};return this.materials.push(f),f},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){var l,u,c=this.currentMaterial();if(c&&c.groupEnd===-1&&(c.groupEnd=this.geometry.index.length,c.groupCount=c.groupEnd-((l=c.groupStart)!==null&&l!==void 0?l:0),c.inherited=!1),s&&this.materials.length>1)for(var h=this.materials.length-1;h>=0;h--)((u=this.materials[h].groupCount)!==null&&u!==void 0?u:0)<=0&&this.materials.splice(h,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),c}},n&&n.name&&typeof n.clone=="function"){var o=n.clone(0);o.inherited=!0,this.object.materials.push(o)}this.objects.push(this.object)},e.prototype.finalize=function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},e.prototype.parseVertexIndex=function(t,r){var n=parseInt(t,10);return(n>=0?n-1:n+r/3)*3},e.prototype.parseNormalIndex=function(t,r){var n=parseInt(t,10);return(n>=0?n-1:n+r/3)*3},e.prototype.parseUVIndex=function(t,r){var n=parseInt(t,10);return(n>=0?n-1:n+r/2)*2},e.prototype.addFace=function(t,r,n,o,s,l,u,c,h){var f=this.object.geometry,m=this.vertices.length,y=this.normals.length,A=this.uvs.length,M=this.parseVertexIndex(t,m),b=this.parseVertexIndex(r,m),T=this.parseVertexIndex(n,m),_=u!==void 0?this.parseNormalIndex(u,y):void 0,S=c!==void 0?this.parseNormalIndex(c,y):void 0,C=h!==void 0?this.parseNormalIndex(h,y):void 0,P=o!==void 0?this.parseUVIndex(o,A):void 0,F=s!==void 0?this.parseUVIndex(s,A):void 0,O=l!==void 0?this.parseUVIndex(l,A):void 0;(f.hasNormal===!0&&_===void 0||S===void 0||C===void 0)&&(f.hasNormal=!1),(f.hasUV===!0&&P===void 0||F===void 0||O===void 0)&&(f.hasUV=!1);var N=[M,P,_].join(":"),V=f.indexMap[N];V===void 0&&(V=f.vertices.length/3,f.indexMap[N]=V,f.vertices.push(this.vertices[M+0],this.vertices[M+1],this.vertices[M+2]),f.hasColor&&(this.colors[M]===void 0?f.hasColor=!1:f.colors.push(this.colors[M+0],this.colors[M+1],this.colors[M+2])),f.hasNormal&&f.normals.push(this.normals[M+0],this.normals[M+1],this.normals[M+2]),f.hasUV&&f.uvs.push(this.uvs[P+0],this.uvs[P+1])),f.index.push(V);var q=[b,F,S].join(":"),Q=f.indexMap[q];Q===void 0&&(Q=f.vertices.length/3,f.indexMap[q]=Q,f.vertices.push(this.vertices[b+0],this.vertices[b+1],this.vertices[b+2]),f.hasColor&&(this.colors[b]===void 0?f.hasColor=!1:f.colors.push(this.colors[b+0],this.colors[b+1],this.colors[b+2])),f.hasNormal&&f.normals.push(this.normals[b+0],this.normals[b+1],this.normals[b+2]),f.hasUV&&f.uvs.push(this.uvs[F+0],this.uvs[F+1])),f.index.push(Q);var z=[T,O,C].join(":"),H=f.indexMap[z];H===void 0&&(H=f.vertices.length/3,f.indexMap[z]=H,f.vertices.push(this.vertices[T+0],this.vertices[T+1],this.vertices[T+2]),f.hasColor&&(this.colors[T]===void 0?f.hasColor=!1:f.colors.push(this.colors[T+0],this.colors[T+1],this.colors[T+2])),f.hasNormal&&f.normals.push(this.normals[T+0],this.normals[T+1],this.normals[T+2]),f.hasUV&&f.uvs.push(this.uvs[O+0],this.uvs[O+1])),f.index.push(H)},e}();function parseObj(e){var t=new ObjState;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));for(var r=e.split(`
`),n=[],o=0,s=r.length;o<s;o++){var l=r[o].trimStart();if(l.length!==0){var u=l.charAt(0);if(u!=="#"){if(u==="v"){var c=l.split(_face_vertex_data_separator_pattern);switch(c[0]){case"v":t.vertices.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])),c.length>=7?(_color.setRGB(parseFloat(c[4]),parseFloat(c[5]),parseFloat(c[6])),_color.convertSRGBToLinear(),t.colors.push(_color.r,_color.g,_color.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));break;case"vt":t.uvs.push(parseFloat(c[1]),parseFloat(c[2]));break}}else if(u==="f"){for(var h=l.slice(1).trim(),f=h.split(_face_vertex_data_separator_pattern),m=[],y=0,A=f.length;y<A;y++){var M=f[y];if(M.length>0){var b=M.split("/");m.push(b)}}for(var T=m[0],y=1,A=m.length-1;y<A;y++){var _=m[y],S=m[y+1];t.addFace(T[0],_[0],S[0],T[1],_[1],S[1],T[2],_[2],S[2])}}else if(u!=="l"&&u!=="p")if((n=_object_pattern.exec(l))!==null){var C=(" "+n[0].slice(1).trim()).slice(1);t.startObject(C)}else if(_material_use_pattern.test(l))t.object.startMaterial(l.substring(7).trim(),t.materialLibraries);else if(_material_library_pattern.test(l))t.materialLibraries.push(l.substring(7).trim());else if(_map_use_pattern.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(u==="s"){if(n=l.split(" "),n.length>1){var P=n[1].trim().toLowerCase();t.object.smooth=P!=="0"&&P!=="off"}else t.object.smooth=!0;var F=t.object.currentMaterial();F&&(F.smooth=t.object.smooth)}else{if(l==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}}}}return t.finalize(),t}function parseMtl(e,t,r){for(var n=new TextureLoader,o=t.split(`
`),s={name:""},l=/\s+/,u={},c=0;c<o.length;c++){var h=o[c];if(h=h.trim(),!(h.length===0||h.charAt(0)==="#")){var f=h.indexOf(" "),m=f>=0?h.substring(0,f):h;m=m.toLowerCase();var y=f>=0?h.substring(f+1):"";if(y=y.trim(),m==="newmtl")s={name:y},u[y]=s;else if(m==="ka"||m==="kd"||m==="ks"||m==="ke"){var A=y.split(l,3);s[m]=[parseFloat(A[0]),parseFloat(A[1]),parseFloat(A[2])]}else(m==="map_kd"||m==="map_ks"||m==="map_ke"||m==="norm"||m==="map_bump"||m==="bump"||m==="map_d"||m==="ns"||m==="d"||m==="tr")&&(s[m]=y)}}function M(T){var _={url:"",scale:new Vector2(1,1),offset:new Vector2(0,0),bumpScale:1},S=T.split(/\s+/),C;return C=S.indexOf("-bm"),C>=0&&(_.bumpScale=parseFloat(S[C+1]),S.splice(C,2)),C=S.indexOf("-s"),C>=0&&(_.scale.set(parseFloat(S[C+1]),parseFloat(S[C+2])),S.splice(C,4)),C=S.indexOf("-o"),C>=0&&(_.offset.set(parseFloat(S[C+1]),parseFloat(S[C+2])),S.splice(C,4)),_.url=S.join(" ").trim(),_}function b(T,_,S){var C=M(S),P=pathJoin(r.path,C.url);return n.loadTexture(P,{fetcher:r.fetcher,encoding:_==="map"||_==="emissiveMap"?sRGBEncoding:LinearEncoding,minFilter:LinearFilter,magFilter:LinearFilter,wrapS:RepeatWrapping,wrapT:RepeatWrapping}).then(function(F){var O=F.body;return O.repeat.copy(C.scale),O.offset.copy(C.offset),T.bumpScale=C.bumpScale,T[_]=O,O})}return{name:e,create:function(T){var _=new PBMMeshMaterial(r.light?"phong":"basic"),S=[],C=u[T];if(C){if(C.kd!==void 0&&_.color.fromArray(C.kd),C.ks!==void 0&&_.specular.fromArray(C.ks),C.ke!==void 0&&_.emissive.fromArray(C.ke),C.map_kd!==void 0&&S.push(b(_,"map",C.map_kd)),C.map_ks!==void 0&&S.push(b(_,"specularMap",C.map_ks)),C.map_ke!==void 0&&S.push(b(_,"emissiveMap",C.map_ke)),C.norm!==void 0&&S.push(b(_,"normalMap",C.norm)),C.map_bump!==void 0&&S.push(b(_,"bumpMap",C.map_bump)),C.bump!==void 0&&S.push(b(_,"bumpMap",C.bump)),C.map_d!==void 0&&S.push(b(_,"alphaMap",C.map_d)),C.ns!==void 0&&(_.shininess=parseFloat(C.ns)),C.d!==void 0){var P=parseFloat(C.d);P<1&&(_.opacity=P,_.transparent=!0)}if(C.tr!==void 0){var P=parseFloat(C.tr);P>0&&(_.opacity=1-P,_.transparent=!0)}}var F=Promise.all(S).then(function(O){return _.refreshUniforms(),O});return[_,F]}}}function build(e,t){for(var r,n=[],o=[],s=new Group,l=function(h,f){var m=e.objects[h],y=m.geometry,A=m.materials,M=!1;if(y.vertices.length===0)return"continue";var b=new BufferGeometry;o.push(function(){return b.dispose()}),b.setAttribute("position",new BufferAttribute(new Float32Array(y.vertices),3)),y.normals.length>0&&b.setAttribute("normal",new BufferAttribute(new Float32Array(y.normals),3)),y.colors.length>0&&(M=!0,b.setAttribute("color",new BufferAttribute(new Float32Array(y.colors),3))),y.uvs.length>0&&b.setAttribute("uv",new BufferAttribute(new Float32Array(y.uvs),2)),y.index.length>0&&b.setIndex(new BufferAttribute(new Uint32Array(y.index),1)),b.computeBoundingBox(),b.computeBoundingSphere();for(var T=[],_=function(O,N){var V=A[O],q=V.name+"_"+V.smooth+"_"+M,Q=e.materials[q];if(!Q){for(var z=null,H=0,W=t;H<W.length;H++){var J=W[H],G=J.name,te=J.create;G===V.mtllib&&(z=te(V.name))}if(!z){var X=new PBMMeshMaterial;X.refreshUniforms(),z=[X,Promise.resolve([])]}Q=z[0],Q.name=V.name,Q.flatShading=!(V.smooth||b.attributes.normal),Q.vertexColors=M,e.materials[q]=Q;var K=z[1];n.push(K),o.push(function(){return Q.dispose()})}T.push(Q)},S=0,C=A.length;S<C;S++)_(S);b.clearGroups();for(var S=0,C=A.length;S<C;S++){var P=A[S];P.groupCount&&b.addGroup((r=P.groupStart)!==null&&r!==void 0?r:0,P.groupCount,S)}(!b.groups||b.groups.length===0)&&b.addGroup(0,b.index?b.index.count:b.attributes.position.count,0);var F=new PBMMesh(b,T);F.name=m.name,s.add(F)},u=0,c=e.objects.length;u<c;u++)l(u);return Promise.all(n).then(function(h){for(var f=[],m=0,y=h;m<y.length;m++){var A=y[m];f=f.concat(A)}return{scene:s,textures:f,dispose:function(){return o.forEach(function(M){return M()})}}})}function loadObj(e,t){var r,n;t===void 0&&(t={});var o=(r=t.upAxis)!==null&&r!==void 0?r:"Z",s=(n=t.fetcher)!==null&&n!==void 0?n:new Fetcher({allowHosts:["*"]}),l=e.slice(0,e.lastIndexOf("/")+1),u=0,c;return Promise.resolve().then(function(){return s.ajax(e,{responseType:"arraybuffer"})}).then(function(h){u=h.body.byteLength;var f=new TextDecoder;return f.decode(h.body)}).then(function(h){return c=parseObj(h),Promise.all(c.materialLibraries.map(function(f){var m=pathJoin(l,f),y=m.slice(0,m.lastIndexOf("/")+1);return s.ajax(m,{responseType:"text"}).then(function(A){var M;return parseMtl(f,A.body,{path:y,light:(M=t.light)!==null&&M!==void 0?M:!1,fetcher:s})})}))}).then(function(h){return build(c,h)}).then(function(h){var f=new Matrix4;return o==="Y"&&f.premultiply(ROTATE_X_MATRIX$1),h.scene.applyMatrix4(f),{type:"obj",upAxis:"Z",uri:e,byteLength:u,memoryUsage:getMemoryUsage(h.scene),scene:h.scene,textures:h.textures,dispose:function(){return h.dispose()}}})}var u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(e,t){for(var r=new u16(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var o=new i32(r[30]),n=1;n<30;++n)for(var s=r[n];s<r[n+1];++s)o[s]=s-r[n]<<5|n;return{b:r,r:o}},_a$3=freb(fleb,2),fl=_a$3.b,revfl=_a$3.r;fl[28]=258,revfl[258]=28;var _b=freb(fdeb,0),fd=_b.b,rev=new u16(32768);for(var i=0;i<32768;++i){var x=(i&43690)>>1|(i&21845)<<1;x=(x&52428)>>2|(x&13107)<<2,x=(x&61680)>>4|(x&3855)<<4,rev[i]=((x&65280)>>8|(x&255)<<8)>>1}var hMap=function(e,t,r){for(var n=e.length,o=0,s=new u16(t);o<n;++o)e[o]&&++s[e[o]-1];var l=new u16(t);for(o=1;o<t;++o)l[o]=l[o-1]+s[o-1]<<1;var u;{u=new u16(1<<t);var c=15-t;for(o=0;o<n;++o)if(e[o])for(var h=o<<4|e[o],f=t-e[o],m=l[e[o]-1]++<<f,y=m|(1<<f)-1;m<=y;++m)u[rev[m]>>c]=h}return u},flt=new u8(288);for(var i=0;i<144;++i)flt[i]=8;for(var i=144;i<256;++i)flt[i]=9;for(var i=256;i<280;++i)flt[i]=7;for(var i=280;i<288;++i)flt[i]=8;var fdt=new u8(32);for(var i=0;i<32;++i)fdt[i]=5;var flrm=hMap(flt,9),fdrm=hMap(fdt,5),max=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},bits=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},bits16=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},shft=function(e){return(e+7)/8|0},slc=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new u8(e.subarray(t,r))},ec=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],err=function(e,t,r){var n=new Error(t||ec[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,err),!r)throw n;return n},inflt=function(e,t,r,n){var o=e.length,s=n?n.length:0;if(!o||t.f&&!t.l)return r||new u8(0);var l=!r,u=l||t.i!=2,c=t.i;l&&(r=new u8(o*3));var h=function(we){var Ve=r.length;if(we>Ve){var je=new u8(Math.max(Ve*2,we));je.set(r),r=je}},f=t.f||0,m=t.p||0,y=t.b||0,A=t.l,M=t.d,b=t.m,T=t.n,_=o*8;do{if(!A){f=bits(e,m,1);var S=bits(e,m+1,3);if(m+=3,S)if(S==1)A=flrm,M=fdrm,b=9,T=5;else if(S==2){var C=bits(e,m,31)+257,P=bits(e,m+10,15)+4,F=C+bits(e,m+5,31)+1;m+=14;for(var O=new u8(F),N=new u8(19),V=0;V<P;++V)N[clim[V]]=bits(e,m+V*3,7);m+=P*3;for(var q=max(N),Q=(1<<q)-1,z=hMap(N,q),V=0;V<F;){var H=z[bits(e,m,Q)];m+=H&15;var W=H>>4;if(W<16)O[V++]=W;else{var J=0,G=0;for(W==16?(G=3+bits(e,m,3),m+=2,J=O[V-1]):W==17?(G=3+bits(e,m,7),m+=3):W==18&&(G=11+bits(e,m,127),m+=7);G--;)O[V++]=J}}var te=O.subarray(0,C),X=O.subarray(C);b=max(te),T=max(X),A=hMap(te,b),M=hMap(X,T)}else err(1);else{var W=shft(m)+4,K=e[W-4]|e[W-3]<<8,Z=W+K;if(Z>o){c&&err(0);break}u&&h(y+K),r.set(e.subarray(W,Z),y),t.b=y+=K,t.p=m=Z*8,t.f=f;continue}if(m>_){c&&err(0);break}}u&&h(y+131072);for(var ee=(1<<b)-1,j=(1<<T)-1,re=m;;re=m){var J=A[bits16(e,m)&ee],pe=J>>4;if(m+=J&15,m>_){c&&err(0);break}if(J||err(2),pe<256)r[y++]=pe;else if(pe==256){re=m,A=null;break}else{var ge=pe-254;if(pe>264){var V=pe-257,_e=fleb[V];ge=bits(e,m,(1<<_e)-1)+fl[V],m+=_e}var he=M[bits16(e,m)&j],Fe=he>>4;he||err(3),m+=he&15;var X=fd[Fe];if(Fe>3){var _e=fdeb[Fe];X+=bits16(e,m)&(1<<_e)-1,m+=_e}if(m>_){c&&err(0);break}u&&h(y+131072);var Re=y+ge;if(y<X){var Le=s-X,Se=Math.min(X,Re);for(Le+y<0&&err(3);y<Se;++y)r[y]=n[Le+y]}for(;y<Re;++y)r[y]=r[y-X]}}t.l=A,t.p=re,t.b=y,t.f=f,A&&(f=1,t.m=b,t.d=M,t.n=T)}while(!f);return y!=r.length&&l?slc(r,0,y):r.subarray(0,y)},et=new u8(0),b2=function(e,t){return e[t]|e[t+1]<<8},b4=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},b8=function(e,t){return b4(e,t)+b4(e,t+4)*4294967296},zls=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&err(6,"invalid zlib data"),(e[1]>>5&1)==1&&err(6,"invalid zlib data: "+(e[1]&32?"need":"unexpected")+" dictionary"),(e[1]>>3&4)+2};function inflateSync(e,t){return inflt(e,{i:2},t&&t.out,t&&t.dictionary)}function unzlibSync(e,t){return inflt(e.subarray(zls(e),-4),{i:2},t,t)}var td=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td.decode(et,{stream:!0}),tds=1}catch(e){}var dutf8=function(e){for(var t="",r=0;;){var n=e[r++],o=(n>127)+(n>223)+(n>239);if(r+o>e.length)return{s:t,r:slc(e,r-1)};o?o==3?(n=((n&15)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,t+=String.fromCharCode(55296|n>>10,56320|n&1023)):o&1?t+=String.fromCharCode((n&31)<<6|e[r++]&63):t+=String.fromCharCode((n&15)<<12|(e[r++]&63)<<6|e[r++]&63):t+=String.fromCharCode(n)}};function strFromU8(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}else{if(td)return td.decode(e);var o=dutf8(e),s=o.s,r=o.r;return r.length&&err(8),s}}var slzh=function(e,t){return t+30+b2(e,t+26)+b2(e,t+28)},zh=function(e,t,r){var n=b2(e,t+28),o=strFromU8(e.subarray(t+46,t+46+n),!(b2(e,t+8)&2048)),s=t+46+n,l=b4(e,t+20),u=r&&l==4294967295?z64e(e,s):[l,b4(e,t+24),b4(e,t+42)],c=u[0],h=u[1],f=u[2];return[b2(e,t+10),c,h,o,s+b2(e,t+30)+b2(e,t+32),f]},z64e=function(e,t){for(;b2(e,t)!=1;t+=4+b2(e,t+2));return[b8(e,t+12),b8(e,t+4),b8(e,t+20)]};function unzipSync(e,t){for(var r={},n=e.length-22;b4(e,n)!=101010256;--n)(!n||e.length-n>65558)&&err(13);var o=b2(e,n+8);if(!o)return{};var s=b4(e,n+16),l=s==4294967295||o==65535;if(l){var u=b4(e,n-12);l=b4(e,u)==101075792,l&&(o=b4(e,u+32),s=b4(e,u+48))}for(var c=0;c<o;++c){var h=zh(e,s,l),f=h[0],m=h[1],y=h[2],A=h[3],M=h[4],b=h[5],T=slzh(e,b);s=M,f?f==8?r[A]=inflateSync(e.subarray(T,T+m),{out:new u8(y)}):err(14,"unknown compression type "+f):r[A]=slc(e,T,T+m)}return r}var ROTATE_X_MATRIX=new Matrix4().fromArray([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]);function loadFbx(e,t){var r;t===void 0&&(t={});var n=(r=t.fetcher)!==null&&r!==void 0?r:new Fetcher({allowHosts:["*"]}),o=0;return Promise.resolve().then(function(){return n.ajax(e,{responseType:"arraybuffer"}).then(function(s){return o=s.body.byteLength,s.body})}).then(function(s){var l;return parse$2(s,{light:t.light,resourcePath:e.slice(0,e.lastIndexOf("/")+1),search:(l=e.split("?")[1])!==null&&l!==void 0?l:"",fetcher:n})}).then(function(s){var l=s.scene,u=s.unitScale/100,c=new Matrix4;return c.makeScale(u,u,u),s.upAxis==="Y"&&c.premultiply(ROTATE_X_MATRIX),l.applyMatrix4(c),{type:"fbx",upAxis:"Z",uri:e,byteLength:o,memoryUsage:getMemoryUsage(l),scene:l,textures:s.textures,dispose:function(){return s.dispose()}}})}function parse$2(e,t){var r;if(isFbxFormatBinary(e))r=new BinaryParser().parse(e);else{var n=convertArrayBufferToString(e);if(!isFbxFormatASCII(n))throw new Error("THREE.FBXLoader: Unknown format.");if(getFbxVersion(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+getFbxVersion(n));r=new TextParser().parse(n)}return new FBXTreeParser(t).parse(r)}var FBXTreeParser=function(){function e(t){var r,n,o;this.light=(r=t.light)!==null&&r!==void 0?r:!0,this.resourcePath=(n=t.resourcePath)!==null&&n!==void 0?n:"",this.search=(o=t.search)!==null&&o!==void 0?o:"",this.fetcher=t.fetcher}return e.prototype.parse=function(t){var r,n,o,s,l,u,c=this.parseConnections(t),h=new Group,f=[],m=this.parseImages(t),y=this.parseTextures(t,m,c,f),A=this.parseMaterials(t,y,c),M=this.parseDeformers(t,c),b=new GeometryParser().parse(t,M,c);this.parseScene(t,M,b,A,c,h);var T=(n=(r=t.GlobalSettings.UpAxis)===null||r===void 0?void 0:r.value)!==null&&n!==void 0?n:1,_=(s=(o=t.GlobalSettings.FrontAxis)===null||o===void 0?void 0:o.value)!==null&&s!==void 0?s:2,S=(u=(l=t.GlobalSettings.UnitScaleFactor)===null||l===void 0?void 0:l.value)!==null&&u!==void 0?u:1,C;if(t.GlobalSettings.AmbientColor){var P=t.GlobalSettings.AmbientColor.value,F=P[0],O=P[1],N=P[2];if(F!==0||O!==0||N!==0){var V=new Color().setRGB(F,O,N);C=new AmbientLight(V,1)}}return Promise.all(f).then(function(q){return{scene:h,textures:q,ambientLight:C,upAxis:["X","Y","Z"][T],frontAxis:["X","Y","Z"][_],unitScale:S,dispose:function(){q.forEach(function(Q){return Q.dispose()}),A.forEach(function(Q){return Q.dispose()}),b.forEach(function(Q){return Q.dispose()})}}})},e.prototype.parseConnections=function(t){var r=new Map;if("Connections"in t){var n=t.Connections.connections;n.forEach(function(o){var s=o[0],l=o[1],u=o[2];r.has(s)||r.set(s,{parents:[],children:[]});var c={ID:l,relationship:u};r.get(s).parents.push(c),r.has(l)||r.set(l,{parents:[],children:[]});var h={ID:s,relationship:u};r.get(l).children.push(h)})}return r},e.prototype.parseImages=function(t){var r={},n={};if("Video"in t.Objects){var o=t.Objects.Video;for(var s in o){var l=o[s],u=parseInt(s);if(r[u]=l.RelativeFilename||l.Filename,"Content"in l){var c=l.Content instanceof ArrayBuffer&&l.Content.byteLength>0,h=typeof l.Content=="string"&&l.Content!=="";if(c||h){var f=this.parseImage(o[s]);n[l.RelativeFilename||l.Filename]=f}}}}for(var u in r){var m=r[u];n[m]!==void 0?r[u]=n[m]:r[u]=r[u].split("\\").pop()}return r},e.prototype.parseImage=function(t){var r=t.Content,n=t.RelativeFilename||t.Filename,o=n.slice(n.lastIndexOf(".")+1).toLowerCase(),s;switch(o){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":s="image/tga";break;default:return}if(typeof r=="string")return"data:"+s+";base64,"+r;var l=new Uint8Array(r);return window.URL.createObjectURL(new Blob([l],{type:s}))},e.prototype.parseTextures=function(t,r,n,o){var s=new Map;if("Texture"in t.Objects){var l=t.Objects.Texture;for(var u in l){var c=this.parseTexture(l[u],r,n,o);s.set(parseInt(u),c)}}return s},e.prototype.parseTexture=function(t,r,n,o){var s=this.loadTexture(t,r,n,o);s.ID=t.id,s.name=t.attrName;var l=t.WrapModeU,u=t.WrapModeV,c=l!==void 0?l.value:0,h=u!==void 0?u.value:0;if(s.wrapS=c===0?RepeatWrapping:ClampToEdgeWrapping,s.wrapT=h===0?RepeatWrapping:ClampToEdgeWrapping,t.Scaling){var f=t.Scaling.value;s.repeat.x=f[0],s.repeat.y=f[1]}if(t.Translation){var f=t.Translation.value;s.offset.x=f[0],s.offset.y=f[1]}return s},e.prototype.loadTexture=function(t,r,n,o){var s=n.get(t.id).children,l="";s!==void 0&&s.length>0&&r[s[0].ID]!==void 0&&(l=r[s[0].ID]),l=pathJoin(this.resourcePath,appendSearch(l,this.search));var u=Object.assign(new Texture,{ID:0}),c;c=this.fetcher.loadImage(l,{},void 0,void 0,void 0,createImageBitmapLikeImage()).then(function(f){return f.body});var h=c.then(function(f){return u.image=f,u.needsUpdate=!0,u});return o.push(h),u},e.prototype.parseMaterials=function(t,r,n){var o=new Map;if("Material"in t.Objects){var s=t.Objects.Material;for(var l in s){var u=this.parseMaterial(t,s[l],r,n);u!==null&&o.set(parseInt(l),u)}}return o},e.prototype.parseMaterial=function(t,r,n,o){var s=r.id;r.attrName;var l=r.ShadingModel;if(typeof l=="object"&&(l=l.value),l=l.toLowerCase(),!o.has(s))return null;var u=new PBMMeshMaterial(this.light?"phong":"basic");r.BumpFactor&&(u.bumpScale=r.BumpFactor.value),r.Diffuse?u.color=new Color().fromArray(r.Diffuse.value):r.DiffuseColor&&(r.DiffuseColor.type==="Color"||r.DiffuseColor.type==="ColorRGB")&&(u.color=new Color().fromArray(r.DiffuseColor.value)),r.DisplacementFactor&&(u.displacementScale=r.DisplacementFactor.value),r.Emissive?u.emissive=new Color().fromArray(r.Emissive.value):r.EmissiveColor&&(r.EmissiveColor.type==="Color"||r.EmissiveColor.type==="ColorRGB")&&(u.emissive=new Color().fromArray(r.EmissiveColor.value)),r.EmissiveFactor&&(u.emissiveIntensity=parseFloat(r.EmissiveFactor.value));var c=1-(r.TransparencyFactor?parseFloat(r.TransparencyFactor.value):0);(c===1||c===0)&&(c=r.Opacity?parseFloat(r.Opacity.value):null,c===null&&(c=1-(r.TransparentColor?parseFloat(r.TransparentColor.value[0]):0))),u.opacity=c,u.opacity<1&&(u.transparent=!0),r.ReflectionFactor&&(u.reflectivity=r.ReflectionFactor.value),r.Shininess&&(u.shininess=r.Shininess.value),r.Specular?u.specular=new Color().fromArray(r.Specular.value):r.SpecularColor&&r.SpecularColor.type==="Color"&&(u.specular=new Color().fromArray(r.SpecularColor.value));var h=this;return o.get(s).children.forEach(function(f){var m=f.relationship;switch(m){case"Bump":u.bumpMap=h.getTexture(t,n,f.ID,o);break;case"Maya|TEX_ao_map":u.aoMap=h.getTexture(t,n,f.ID,o);break;case"DiffuseColor":case"Maya|TEX_color_map":u.map=h.getTexture(t,n,f.ID,o),u.map!==void 0&&(u.map.encoding=sRGBEncoding);break;case"DisplacementColor":u.displacementMap=h.getTexture(t,n,f.ID,o);break;case"EmissiveColor":u.emissiveMap=h.getTexture(t,n,f.ID,o),u.emissiveMap!==void 0&&(u.emissiveMap.encoding=sRGBEncoding);break;case"NormalMap":case"Maya|TEX_normal_map":u.normalMap=h.getTexture(t,n,f.ID,o);break;case"ReflectionColor":u.envMap=h.getTexture(t,n,f.ID,o),u.envMap!==void 0&&(u.envMap.mapping=EquirectangularReflectionMapping,u.envMap.encoding=sRGBEncoding);break;case"SpecularColor":u.specularMap=h.getTexture(t,n,f.ID,o),u.specularMap!==void 0&&(u.specularMap.encoding=sRGBEncoding);break;case"TransparentColor":case"TransparencyFactor":u.alphaMap=h.getTexture(t,n,f.ID,o),u.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",m);break}}),u.refreshUniforms(),u},e.prototype.getTexture=function(t,r,n,o){return t.Objects.LayeredTexture&&n in t.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=o.get(n).children[0].ID),r.get(n)},e.prototype.parseDeformers=function(t,r){var n={},o={};if("Deformer"in t.Objects){var s=t.Objects.Deformer;for(var l in s){var u=s[l],c=r.get(parseInt(l));if(u.attrType==="Skin"){var h=this.parseSkeleton(c,s);h.ID=l,c.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),h.geometryID=c.parents[0].ID,n[l]=h}else if(u.attrType==="BlendShape"){var f={id:l};f.rawTargets=this.parseMorphTargets(c,s,r),f.id=l,c.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),o[l]=f}}}return{skeletons:n,morphTargets:o}},e.prototype.parseSkeleton=function(t,r){var n=[];return t.children.forEach(function(o){var s=r[o.ID];if(s.attrType==="Cluster"){var l={ID:o.ID,indices:[],weights:[],transformLink:new Matrix4().fromArray(s.TransformLink.a)};s.Indexes&&(l.indices=s.Indexes.a,l.weights=s.Weights.a),n.push(l)}}),{ID:"",geometryID:0,rawBones:n,bones:[]}},e.prototype.parseMorphTargets=function(t,r,n){for(var o=[],s=0;s<t.children.length;s++){var l=t.children[s],u=r[l.ID],c={name:u.attrName,initialWeight:u.DeformPercent,id:u.id,fullWeights:u.FullWeights.a,geoID:0};if(u.attrType!=="BlendShapeChannel")return;c.geoID=n.get(parseInt(l.ID)).children.filter(function(h){return h.relationship===void 0})[0].ID,o.push(c)}return o},e.prototype.parseScene=function(t,r,n,o,s,l){var u=this.parseModels(t,r.skeletons,n,o,s),c=t.Objects.Model,h=this;u.forEach(function(m){var y=c[m.ID];h.setLookAtProperties(t,m,y,s,l);var A=s.get(m.ID).parents;A.forEach(function(M){var b=u.get(M.ID);b!==void 0&&b.add(m)}),m.parent===null&&l.add(m)}),this.bindSkeleton(t,r.skeletons,n,u,s),l.traverse(function(m){if(m.userData.transformData){m.parent&&(m.userData.transformData.parentMatrix=m.parent.matrix,m.userData.transformData.parentMatrixWorld=m.parent.matrixWorld);var y=generateTransform(m.userData.transformData);m.applyMatrix4(y),m.updateWorldMatrix(!0,!0)}});var f=new AnimationParser().parse(t,s,l);l.children.length===1&&l.children[0]instanceof Group&&(l.children[0].animations=f,l=l.children[0]),l.animations=f},e.prototype.parseModels=function(t,r,n,o,s){var l=new Map,u=t.Objects.Model;for(var c in u){var h=parseInt(c),f=u[c],m=s.get(h),y=this.buildSkeleton(m,r,h,f.attrName);if(!y){switch(f.attrType){case"Camera":y=this.createCamera(t,m);break;case"Light":y=this.createLight(t,m);break;case"Mesh":y=this.createMesh(m,n,o);break;case"NurbsCurve":case"LimbNode":case"Root":y=new Bone;break;case"Null":default:y=new Group;break}y.name=f.attrName?PropertyBinding.sanitizeNodeName(f.attrName):"",y.userData.originalName=f.attrName,y.ID=h}this.getTransformData(y,f),l.set(h,y)}return l},e.prototype.buildSkeleton=function(t,r,n,o){var s=null;return t.parents.forEach(function(l){var u=function(h){var f=r[h];f.rawBones.forEach(function(m,y){if(m.ID===l.ID){var A=s;s=new Bone,s.matrixWorld.copy(m.transformLink),s.name=o?PropertyBinding.sanitizeNodeName(o):"",s.userData.originalName=o,s.ID=n,f.bones[y]=s,A!==null&&s.add(A)}})};for(var c in r)u(c)}),s},e.prototype.createCamera=function(t,r){var n,o;if(r.children.forEach(function(A){var M=t.Objects.NodeAttribute[A.ID];M!==void 0&&(o=M)}),o===void 0)n=new Object3D;else{var s=0;o.CameraProjectionType!==void 0&&o.CameraProjectionType.value===1&&(s=1);var l=1;o.NearPlane!==void 0&&(l=o.NearPlane.value/1e3);var u=1e3;o.FarPlane!==void 0&&(u=o.FarPlane.value/1e3);var c=window.innerWidth,h=window.innerHeight;o.AspectWidth!==void 0&&o.AspectHeight!==void 0&&(c=o.AspectWidth.value,h=o.AspectHeight.value);var f=c/h,m=45;o.FieldOfView!==void 0&&(m=o.FieldOfView.value);var y=o.FocalLength?o.FocalLength.value:null;switch(s){case 0:n=new PerspectiveCamera(m,f,l,u),y!==null&&n.setFocalLength(y);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),n=new Object3D;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),n=new Object3D;break}}return n},e.prototype.createLight=function(t,r){var n,o;if(r.children.forEach(function(y){var A=t.Objects.NodeAttribute[y.ID];A!==void 0&&(o=A)}),o===void 0)n=new Object3D;else{var s=void 0;o.LightType===void 0?s=0:s=o.LightType.value;var l=new Color(16777215);o.Color!==void 0&&(l=new Color().fromArray(o.Color.value));var u=o.Intensity===void 0?1:o.Intensity.value/100;o.CastLightOnObject!==void 0&&o.CastLightOnObject.value===0&&(u=0);var c=0;o.FarAttenuationEnd!==void 0&&(o.EnableFarAttenuation!==void 0&&o.EnableFarAttenuation.value===0?c=0:c=o.FarAttenuationEnd.value);var h=1;switch(s){case 0:n=new PointLight(l,u,c,h);break;case 1:n=new DirectionalLight(l,u);break;case 2:var f=Math.PI/3;o.InnerAngle!==void 0&&(f=MathUtils.degToRad(o.InnerAngle.value));var m=0;o.OuterAngle!==void 0&&(m=MathUtils.degToRad(o.OuterAngle.value),m=Math.max(m,1)),n=new SpotLight(l,u,c,f,m,h);break;default:console.warn("THREE.FBXLoader: Unknown light type "+o.LightType.value+", defaulting to a PointLight."),n=new PointLight(l,u);break}o.CastShadows!==void 0&&o.CastShadows.value===1&&(n.castShadow=!0)}return n},e.prototype.createMesh=function(t,r,n){var o,s=null,l=[];if(t.children.forEach(function(c){r.has(c.ID)&&(s=r.get(c.ID)),n.has(c.ID)&&l.push(n.get(c.ID))}),l.length===0){var u=new PBMMeshMaterial(this.light?"phong":"basic");u.color=new Color(13421772),l.push(u)}return"color"in s.attributes&&l.forEach(function(c){c.vertexColors=!0}),(!s.groups||s.groups.length===0)&&s.addGroup(0,s.index?s.index.count:s.attributes.position.count,0),s.FBX_Deformer?(o=new PBMSkinnedMesh(s,l),o.normalizeSkinWeights()):o=new PBMMesh(s,l),o},e.prototype.createCurve=function(t,r){var n=t.children.reduce(function(s,l){return r.has(l.ID)&&(s=r.get(l.ID)),s},null),o=new LineBasicMaterial({name:"",color:3342591,linewidth:1});return new Line(n,o)},e.prototype.getTransformData=function(t,r){var n={};r.InheritType&&(n.inheritType=parseInt(r.InheritType.value)),r.RotationOrder?n.eulerOrder=getEulerOrder(r.RotationOrder.value):n.eulerOrder=getEulerOrder(0),r.Lcl_Translation&&(n.translation=r.Lcl_Translation.value),r.PreRotation&&(n.preRotation=r.PreRotation.value),r.Lcl_Rotation&&(n.rotation=r.Lcl_Rotation.value),r.PostRotation&&(n.postRotation=r.PostRotation.value),r.Lcl_Scaling&&(n.scale=r.Lcl_Scaling.value),r.ScalingOffset&&(n.scalingOffset=r.ScalingOffset.value),r.ScalingPivot&&(n.scalingPivot=r.ScalingPivot.value),r.RotationOffset&&(n.rotationOffset=r.RotationOffset.value),r.RotationPivot&&(n.rotationPivot=r.RotationPivot.value),t.userData.transformData=n},e.prototype.setLookAtProperties=function(t,r,n,o,s){if("LookAtProperty"in n){var l=o.get(r.ID).children;l.forEach(function(u){if(u.relationship==="LookAtProperty"){var c=t.Objects.Model[u.ID];if(c.Lcl_Translation){var h=c.Lcl_Translation.value;"target"in r&&r.target instanceof Object3D?(r.target.position.fromArray(h),s.add(r.target)):r.lookAt(new Vector3().fromArray(h))}}})}},e.prototype.bindSkeleton=function(t,r,n,o,s){var l=this.parsePoseNodes(t),u=function(h){var f=r[h],m=s.get(parseInt(f.ID)).parents;m.forEach(function(y){if(n.has(y.ID)){var A=y.ID,M=s.get(A);M.parents.forEach(function(b){if(o.has(b.ID)){var T=o.get(b.ID);T instanceof SkinnedMesh&&T.bind(new Skeleton(f.bones),l[b.ID])}})}})};for(var c in r)u(c)},e.prototype.parsePoseNodes=function(t){var r={};if(t.Objects.Pose){var n=t.Objects.Pose;for(var o in n)if(n[o].attrType==="BindPose"&&n[o].NbPoseNodes>0){var s=n[o].PoseNode;Array.isArray(s)?s.forEach(function(l){r[l.Node]=new Matrix4().fromArray(l.Matrix.a)}):r[s.Node]=new Matrix4().fromArray(s.Matrix.a)}}return r},e}(),GeometryParser=function(){function e(){this.negativeMaterialIndices=!1}return e.prototype.parse=function(t,r,n){var o=new Map;if("Geometry"in t.Objects){var s=t.Objects.Geometry;for(var l in s){var u=n.get(parseInt(l)),c=this.parseGeometry(t,u,s[l],r);o.set(parseInt(l),c)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),o},e.prototype.parseGeometry=function(t,r,n,o){switch(n.attrType){case"Mesh":return this.parseMeshGeometry(t,r,n,o);case"NurbsCurve":return this.parseNurbsGeometry(n)}},e.prototype.parseMeshGeometry=function(t,r,n,o){var s=o.skeletons,l=[],u=r.parents.map(function(y){return t.Objects.Model[y.ID]});if(u.length!==0){var c=r.children.reduce(function(y,A){return s[A.ID]!==void 0&&(y=s[A.ID]),y},null);r.children.forEach(function(y){o.morphTargets[y.ID]!==void 0&&l.push(o.morphTargets[y.ID])});var h=u[0],f={};h.RotationOrder&&(f.eulerOrder=getEulerOrder(h.RotationOrder.value)),h.InheritType&&(f.inheritType=parseInt(h.InheritType.value)),h.GeometricTranslation&&(f.translation=h.GeometricTranslation.value),h.GeometricRotation&&(f.rotation=h.GeometricRotation.value),h.GeometricScaling&&(f.scale=h.GeometricScaling.value);var m=generateTransform(f);return this.genGeometry(t,n,c,l,m)}},e.prototype.genGeometry=function(t,r,n,o,s){var l=new BufferGeometry;r.attrName&&(l.name=r.attrName);var u=this.parseGeoNode(r,n),c=this.genBuffers(u),h=new Float32BufferAttribute(c.vertex,3);if(h.applyMatrix4(s),l.setAttribute("position",h),c.colors.length>0&&l.setAttribute("color",new Float32BufferAttribute(c.colors,3)),n&&(l.setAttribute("skinIndex",new Uint16BufferAttribute(c.weightsIndices,4)),l.setAttribute("skinWeight",new Float32BufferAttribute(c.vertexWeights,4)),l.FBX_Deformer=n),c.normal.length>0){var f=new Matrix3().getNormalMatrix(s),m=new Float32BufferAttribute(c.normal,3);m.applyNormalMatrix(f),l.setAttribute("normal",m)}if(c.uvs.forEach(function(T,_){var S=_===0?"uv":"uv".concat(_+1);l.setAttribute(S,new Float32BufferAttribute(c.uvs[_],2))}),u.material&&u.material.mappingType!=="AllSame"){var y=c.materialIndex[0],A=0;if(c.materialIndex.forEach(function(T,_){T!==y&&(l.addGroup(A,_-A,y),y=T,A=_)}),l.groups.length>0){var M=l.groups[l.groups.length-1],b=M.start+M.count;b!==c.materialIndex.length&&l.addGroup(b,c.materialIndex.length-b,y)}l.groups.length===0&&l.addGroup(0,c.materialIndex.length,c.materialIndex[0])}return this.addMorphTargets(t,l,r,o,s),l},e.prototype.parseGeoNode=function(t,r){var n={};if(n.vertexPositions=t.Vertices!==void 0?t.Vertices.a:[],n.vertexIndices=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];for(var o=0;t.LayerElementUV[o];)t.LayerElementUV[o].UV&&n.uv.push(this.parseUVs(t.LayerElementUV[o])),o++}return n.weightTable={},r!==null&&(n.skeleton=r,r.rawBones.forEach(function(s,l){s.indices.forEach(function(u,c){n.weightTable[u]===void 0&&(n.weightTable[u]=[]),n.weightTable[u].push({id:l,weight:s.weights[c]})})})),n},e.prototype.genBuffers=function(t){var r={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,o=0,s=!1,l=[],u=[],c=[],h=[],f=[],m=[],y=this;return t.vertexIndices.forEach(function(A,M){var b=0,T=!1;A<0&&(A=A^-1,T=!0);var _=[],S=[];if(l.push(A*3,A*3+1,A*3+2),t.color){var C=getData(M,n,A,t.color);c.push(C[0],C[1],C[2])}if(t.skeleton){if(t.weightTable[A]!==void 0&&t.weightTable[A].forEach(function(N){S.push(N.weight),_.push(N.id)}),S.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);var P=[0,0,0,0],F=[0,0,0,0];S.forEach(function(N,V){var q=N,Q=_[V];F.forEach(function(z,H,W){if(q>z){W[H]=q,q=z;var J=P[H];P[H]=Q,Q=J}})}),_=P,S=F}for(;S.length<4;)S.push(0),_.push(0);for(var O=0;O<4;++O)f.push(S[O]),m.push(_[O])}if(t.normal){var C=getData(M,n,A,t.normal);u.push(C[0],C[1],C[2])}t.material&&t.material.mappingType!=="AllSame"&&(b=getData(M,n,A,t.material)[0],b<0&&(y.negativeMaterialIndices=!0,b=0)),t.uv&&t.uv.forEach(function(N,V){var q=getData(M,n,A,N);h[V]===void 0&&(h[V]=[]),h[V].push(q[0]),h[V].push(q[1])}),o++,T&&(y.genFace(r,t,l,b,u,c,h,f,m,o),n++,o=0,l=[],u=[],c=[],h=[],f=[],m=[])}),r},e.prototype.getNormalNewell=function(t){for(var r=new Vector3(0,0,0),n=0;n<t.length;n++){var o=t[n],s=t[(n+1)%t.length];r.x+=(o.y-s.y)*(o.z+s.z),r.y+=(o.z-s.z)*(o.x+s.x),r.z+=(o.x-s.x)*(o.y+s.y)}return r.normalize(),r},e.prototype.getNormalTangentAndBitangent=function(t){var r=this.getNormalNewell(t),n=Math.abs(r.z)>.5?new Vector3(0,1,0):new Vector3(0,0,1),o=n.cross(r).normalize(),s=r.clone().cross(o).normalize();return{normal:r,tangent:o,bitangent:s}},e.prototype.flattenVertex=function(t,r,n){return new Vector2(t.dot(r),t.dot(n))},e.prototype.genFace=function(t,r,n,o,s,l,u,c,h,f){var m;if(f>3){for(var y=[],A=r.baseVertexPositions||r.vertexPositions,M=0;M<n.length;M+=3)y.push(new Vector3(A[n[M]],A[n[M+1]],A[n[M+2]]));for(var b=this.getNormalTangentAndBitangent(y),T=b.tangent,_=b.bitangent,S=[],C=0,P=y;C<P.length;C++){var F=P[C];S.push(this.flattenVertex(F,T,_))}m=ShapeUtils.triangulateShape(S,[])}else m=[[0,1,2]];for(var O=function(W,J,G){t.vertex.push(r.vertexPositions[n[W*3]]),t.vertex.push(r.vertexPositions[n[W*3+1]]),t.vertex.push(r.vertexPositions[n[W*3+2]]),t.vertex.push(r.vertexPositions[n[J*3]]),t.vertex.push(r.vertexPositions[n[J*3+1]]),t.vertex.push(r.vertexPositions[n[J*3+2]]),t.vertex.push(r.vertexPositions[n[G*3]]),t.vertex.push(r.vertexPositions[n[G*3+1]]),t.vertex.push(r.vertexPositions[n[G*3+2]]),r.skeleton&&(t.vertexWeights.push(c[W*4]),t.vertexWeights.push(c[W*4+1]),t.vertexWeights.push(c[W*4+2]),t.vertexWeights.push(c[W*4+3]),t.vertexWeights.push(c[J*4]),t.vertexWeights.push(c[J*4+1]),t.vertexWeights.push(c[J*4+2]),t.vertexWeights.push(c[J*4+3]),t.vertexWeights.push(c[G*4]),t.vertexWeights.push(c[G*4+1]),t.vertexWeights.push(c[G*4+2]),t.vertexWeights.push(c[G*4+3]),t.weightsIndices.push(h[W*4]),t.weightsIndices.push(h[W*4+1]),t.weightsIndices.push(h[W*4+2]),t.weightsIndices.push(h[W*4+3]),t.weightsIndices.push(h[J*4]),t.weightsIndices.push(h[J*4+1]),t.weightsIndices.push(h[J*4+2]),t.weightsIndices.push(h[J*4+3]),t.weightsIndices.push(h[G*4]),t.weightsIndices.push(h[G*4+1]),t.weightsIndices.push(h[G*4+2]),t.weightsIndices.push(h[G*4+3])),r.color&&(t.colors.push(l[W*3]),t.colors.push(l[W*3+1]),t.colors.push(l[W*3+2]),t.colors.push(l[J*3]),t.colors.push(l[J*3+1]),t.colors.push(l[J*3+2]),t.colors.push(l[G*3]),t.colors.push(l[G*3+1]),t.colors.push(l[G*3+2])),r.material&&r.material.mappingType!=="AllSame"&&(t.materialIndex.push(o),t.materialIndex.push(o),t.materialIndex.push(o)),r.normal&&(t.normal.push(s[W*3]),t.normal.push(s[W*3+1]),t.normal.push(s[W*3+2]),t.normal.push(s[J*3]),t.normal.push(s[J*3+1]),t.normal.push(s[J*3+2]),t.normal.push(s[G*3]),t.normal.push(s[G*3+1]),t.normal.push(s[G*3+2])),r.uv&&r.uv.forEach(function(te,X){t.uvs[X]===void 0&&(t.uvs[X]=[]),t.uvs[X].push(u[X][W*2]),t.uvs[X].push(u[X][W*2+1]),t.uvs[X].push(u[X][J*2]),t.uvs[X].push(u[X][J*2+1]),t.uvs[X].push(u[X][G*2]),t.uvs[X].push(u[X][G*2+1])})},N=0,V=m;N<V.length;N++){var q=V[N],Q=q[0],z=q[1],H=q[2];O(Q,z,H)}},e.prototype.addMorphTargets=function(t,r,n,o,s){if(o.length!==0){r.morphTargetsRelative=!0,r.morphAttributes.position=[];var l=this;o.forEach(function(u){u.rawTargets.forEach(function(c){var h=t.Objects.Geometry[c.geoID];h!==void 0&&l.genMorphGeometry(r,n,h,s,c.name)})})}},e.prototype.genMorphGeometry=function(t,r,n,o,s){for(var l=r.Vertices!==void 0?r.Vertices.a:[],u=r.PolygonVertexIndex!==void 0?r.PolygonVertexIndex.a:[],c=n.Vertices!==void 0?n.Vertices.a:[],h=n.Indexes?n.Indexes.a:[],f=t.attributes.position.count*3,m=new Float32Array(f),y=0;y<h.length;y++){var A=h[y]*3;m[A]=c[y*3],m[A+1]=c[y*3+1],m[A+2]=c[y*3+2]}var M={vertexIndices:u,vertexPositions:m,baseVertexPositions:l},b=this.genBuffers(M),T=new Float32BufferAttribute(b.vertex,3);T.name=s||n.attrName,T.applyMatrix4(o),t.morphAttributes.position.push(T)},e.prototype.parseNormals=function(t){var r=t.MappingInformationType,n=t.ReferenceInformationType,o=t.Normals.a,s=[];return n==="IndexToDirect"&&(t.NormalIndex?s=t.NormalIndex.a:t.NormalsIndex&&(s=t.NormalsIndex.a)),{dataSize:3,buffer:o,indices:s,mappingType:r,referenceType:n}},e.prototype.parseUVs=function(t){var r=t.MappingInformationType,n=t.ReferenceInformationType,o=t.UV.a,s=[];return n==="IndexToDirect"&&(s=t.UVIndex.a),{dataSize:2,buffer:o,indices:s,mappingType:r,referenceType:n}},e.prototype.parseVertexColors=function(t){var r=t.MappingInformationType,n=t.ReferenceInformationType,o=t.Colors.a,s=[];n==="IndexToDirect"&&(s=t.ColorIndex.a);for(var l=0,u=new Color;l<o.length;l+=4)u.fromArray(o,l),u.toArray(o,l);return{dataSize:4,buffer:o,indices:s,mappingType:r,referenceType:n}},e.prototype.parseMaterialIndices=function(t){var r=t.MappingInformationType,n=t.ReferenceInformationType;if(r==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var o=t.Materials.a,s=[],l=0;l<o.length;++l)s.push(l);return{dataSize:1,buffer:o,indices:s,mappingType:r,referenceType:n}},e.prototype.parseNurbsGeometry=function(t){var r=parseInt(t.Order);if(isNaN(r))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new BufferGeometry;for(var n=r-1,o=t.KnotVector.a,s=[],l=t.Points.a,u=0,c=l.length;u<c;u+=4)s.push(new Vector4().fromArray(l,u));var h,f;if(t.Form==="Closed")s.push(s[0]);else if(t.Form==="Periodic"){h=n,f=o.length-1-h;for(var u=0;u<n;++u)s.push(s[u])}var m=new NURBSCurve(n,o,s,h,f),y=m.getPoints(s.length*12);return new BufferGeometry().setFromPoints(y)},e}(),AnimationParser=function(){function e(){}return e.prototype.parse=function(t,r,n){var o=[],s=this.parseClips(t,r,n);if(s!==void 0)for(var l in s){var u=s[l],c=this.addClip(u,n);o.push(c)}return o},e.prototype.parseClips=function(t,r,n){if(t.Objects.AnimationCurve!==void 0){var o=this.parseAnimationCurveNodes(t);this.parseAnimationCurves(t,o,r);var s=this.parseAnimationLayers(t,o,r,n),l=this.parseAnimStacks(t,s,r);return l}},e.prototype.parseAnimationCurveNodes=function(t){var r=t.Objects.AnimationCurveNode,n=new Map;for(var o in r){var s=r[o];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){var l={id:s.id,attr:s.attrName,curves:{}};n.set(l.id,l)}}return n},e.prototype.parseAnimationCurves=function(t,r,n){var o=t.Objects.AnimationCurve;for(var s in o){var l={id:o[s].id,times:o[s].KeyTime.a.map(convertFBXTimeToSeconds),values:o[s].KeyValueFloat.a},u=n.get(l.id);if(u!==void 0){var c=u.parents[0].ID,h=u.parents[0].relationship,f=r.get(c);f&&(h.match(/X/)?f.curves.x=l:h.match(/Y/)?f.curves.y=l:h.match(/Z/)?f.curves.z=l:h.match(/DeformPercent/)&&r.has(c)&&(f.curves.morph=l))}}},e.prototype.parseAnimationLayers=function(t,r,n,o){var s=t.Objects.AnimationLayer,l=new Map,u=function(h){var f=[],m=n.get(parseInt(h));if(m!==void 0){var y=m.children;y.forEach(function(A,M){if(r.has(A.ID)){var b=r.get(A.ID);if(b.curves.x!==void 0||b.curves.y!==void 0||b.curves.z!==void 0){if(f[M]===void 0){var T=n.get(A.ID).parents.filter(function(V){return V.relationship!==void 0})[0].ID;if(T!==void 0){var _=t.Objects.Model[T.toString()];if(_===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",A);return}var S={modelName:_.attrName?PropertyBinding.sanitizeNodeName(_.attrName):"",ID:_.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1],transform:new Matrix4,eulerOrder:"",preRotation:[0,0,0],postRotation:[0,0,0]};o.traverse(function(V){V.ID===_.id&&(S.transform=V.matrix,V.userData.transformData&&(S.eulerOrder=V.userData.transformData.eulerOrder))}),S.transform||(S.transform=new Matrix4),_.PreRotation&&(S.preRotation=_.PreRotation.value),_.PostRotation&&(S.postRotation=_.PostRotation.value),f[M]=S}}f[M]&&(f[M][b.attr]=b)}else if(b.curves.morph!==void 0){if(f[M]===void 0){var C=n.get(A.ID).parents.filter(function(q){return q.relationship!==void 0})[0].ID,P=n.get(C).parents[0].ID,F=n.get(P).parents[0].ID,T=n.get(F).parents[0].ID,O=t.Objects.Model[T],N={modelName:O.attrName?PropertyBinding.sanitizeNodeName(O.attrName):"",morphName:t.Objects.Deformer[C].attrName};f[M]=N}f[M][b.attr]=b}}}),l.set(parseInt(h),f)}};for(var c in s)u(c);return l},e.prototype.parseAnimStacks=function(t,r,n){var o=t.Objects.AnimationStack,s={};for(var l in o){var u=n.get(parseInt(l)).children;u.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var c=r.get(u[0].ID);s[l]={name:o[l].attrName,layer:c}}return s},e.prototype.addClip=function(t,r){var n=[],o=this;return t.layer.forEach(function(s){n=n.concat(o.generateTracks(s,r))}),new AnimationClip(t.name,-1,n)},e.prototype.generateTracks=function(t,r){var n=[],o=new Vector3,s=new Vector3;t.transform&&t.transform.decompose(o,new Quaternion,s);var l=o.toArray(),u=s.toArray();if(t.T!==void 0&&Object.keys(t.T.curves).length>0){var c=this.generateVectorTrack(t.modelName,t.T.curves,l,"position");c!==void 0&&n.push(c)}if(t.R!==void 0&&Object.keys(t.R.curves).length>0){var h=this.generateRotationTrack(t.modelName,t.R.curves,t.preRotation,t.postRotation,t.eulerOrder);h!==void 0&&n.push(h)}if(t.S!==void 0&&Object.keys(t.S.curves).length>0){var f=this.generateVectorTrack(t.modelName,t.S.curves,u,"scale");f!==void 0&&n.push(f)}if(t.DeformPercent!==void 0){var m=this.generateMorphTrack(t,r);m!==void 0&&n.push(m)}return n},e.prototype.generateVectorTrack=function(t,r,n,o){var s=this.getTimesForAllAxes(r),l=this.getKeyframeTrackValues(s,r,n);return new VectorKeyframeTrack(t+"."+o,s,l)},e.prototype.generateRotationTrack=function(t,r,n,o,s){var l,u;if(r.x!==void 0&&r.y!==void 0&&r.z!==void 0){var c=this.interpolateRotations(r.x,r.y,r.z,s);l=c[0],u=c[1]}var h=getEulerOrder(0),f=new Quaternion,m=new Quaternion;n!==void 0&&(n=n.map(MathUtils.degToRad),n.push(h),f.setFromEuler(new Euler().fromArray(n))),o!==void 0&&(o=o.map(MathUtils.degToRad),o.push(h),m.setFromEuler(new Euler().fromArray(o)),m.inverse());var y=new Quaternion,A=new Euler,M=[];if(!u||!l)return new QuaternionKeyframeTrack(t+".quaternion",[0],[0]);for(var b=0;b<u.length;b+=3){if(A.set(u[b],u[b+1],u[b+2],s),y.setFromEuler(A),y.premultiply(f),y.multiply(m),b>2){var T=new Quaternion().fromArray(M,(b-3)/3*4);T.dot(y)<0&&y.set(-y.x,-y.y,-y.z,-y.w)}y.toArray(M,b/3*4)}return new QuaternionKeyframeTrack(t+".quaternion",l,M)},e.prototype.generateMorphTrack=function(t,r){var n=t.DeformPercent.curves.morph,o=n.values.map(function(l){return l/100}),s=r.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+s+"]",n.times,o)},e.prototype.getTimesForAllAxes=function(t){var r=[];if(t.x!==void 0&&(r=r.concat(t.x.times)),t.y!==void 0&&(r=r.concat(t.y.times)),t.z!==void 0&&(r=r.concat(t.z.times)),r=r.sort(function(u,c){return u-c}),r.length>1){for(var n=1,o=r[0],s=1;s<r.length;s++){var l=r[s];l!==o&&(r[n]=l,o=l,n++)}r=r.slice(0,n)}return r},e.prototype.getKeyframeTrackValues=function(t,r,n){var o=n,s=[],l=-1,u=-1,c=-1;return t.forEach(function(h){if(r.x&&(l=r.x.times.indexOf(h)),r.y&&(u=r.y.times.indexOf(h)),r.z&&(c=r.z.times.indexOf(h)),l!==-1){var f=r.x.values[l];s.push(f),o[0]=f}else s.push(o[0]);if(u!==-1){var m=r.y.values[u];s.push(m),o[1]=m}else s.push(o[1]);if(c!==-1){var y=r.z.values[c];s.push(y),o[2]=y}else s.push(o[2])}),s},e.prototype.interpolateRotations=function(t,r,n,o){var s=[],l=[];s.push(t.times[0]),l.push(MathUtils.degToRad(t.values[0])),l.push(MathUtils.degToRad(r.values[0])),l.push(MathUtils.degToRad(n.values[0]));for(var u=1;u<t.values.length;u++){var c=[t.values[u-1],r.values[u-1],n.values[u-1]];if(!(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))){var h=c.map(MathUtils.degToRad),f=[t.values[u],r.values[u],n.values[u]];if(!(isNaN(f[0])||isNaN(f[1])||isNaN(f[2]))){f.map(MathUtils.degToRad);var m=[f[0]-c[0],f[1]-c[1],f[2]-c[2]],y=[Math.abs(m[0]),Math.abs(m[1]),Math.abs(m[2])];if(y[0]>=180||y[1]>=180||y[2]>=180){var A=Math.max.apply(Math,y),M=A/180,b=new Euler(h[0],h[1],h[2],o),T=new Euler(h[0],h[1],h[2],o),_=new Quaternion().setFromEuler(b),S=new Quaternion().setFromEuler(T);_.dot(S)&&S.set(-S.x,-S.y,-S.z,-S.w);for(var C=t.times[u-1],P=t.times[u]-C,F=new Quaternion,O=new Euler,N=0;N<1;N+=1/M)F.copy(_.clone().slerp(S.clone(),N)),s.push(C+N*P),O.setFromQuaternion(F,o),l.push(O.x),l.push(O.y),l.push(O.z)}else s.push(t.times[u]),l.push(MathUtils.degToRad(t.values[u])),l.push(MathUtils.degToRad(r.values[u])),l.push(MathUtils.degToRad(n.values[u]))}}}return[s,l]},e}(),TextParser=function(){function e(){this.allNodes=new FBXTree,this.nodeStack=[],this.currentIndent=0,this.currentPropName=""}return e.prototype.getPrevNode=function(){return this.nodeStack[this.currentIndent-2]},e.prototype.getCurrentNode=function(){return this.nodeStack[this.currentIndent-1]},e.prototype.getCurrentProp=function(){return this.currentProp},e.prototype.pushStack=function(t){this.nodeStack.push(t),this.currentIndent+=1},e.prototype.popStack=function(){this.nodeStack.pop(),this.currentIndent-=1},e.prototype.setCurrentProp=function(t,r){this.currentProp=t,this.currentPropName=r},e.prototype.parse=function(t){this.currentIndent=0,this.allNodes=new FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var r=this,n=t.split(/[\r\n]+/);return n.forEach(function(o,s){var l=o.match(/^[\s\t]*;/),u=o.match(/^[\s\t]*$/);if(!(l||u)){var c=o.match("^\\t{"+r.currentIndent+"}(\\w+):(.*){"),h=o.match("^\\t{"+r.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=o.match("^\\t{"+(r.currentIndent-1)+"}}");c?r.parseNodeBegin(o,c):h?r.parseNodeProperty(o,h,n[++s]):f?r.popStack():o.match(/^[^\s\t}]/)&&r.parseNodePropertyContinued(o)}}),this.allNodes},e.prototype.parseNodeBegin=function(t,r){var n=r[1].trim().replace(/^"/,"").replace(/"$/,""),o=r[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:n},l=this.parseNodeAttr(o),u=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,s):n in u?(n==="PoseNode"?u.PoseNode.push(s):u[n].id!==void 0&&(u[n]={},u[n][u[n].id]=u[n]),l.id!==""&&(u[n][l.id]=s)):typeof l.id=="number"?(u[n]={},u[n][l.id]=s):n!=="Properties70"&&(n==="PoseNode"?u[n]=[s]:u[n]=s),typeof l.id=="number"&&(s.id=l.id),l.name!==""&&(s.attrName=l.name),l.type!==""&&(s.attrType=l.type),this.pushStack(s)},e.prototype.parseNodeAttr=function(t){var r=t[0];t[0]!==""&&(r=parseInt(t[0]),isNaN(r)&&(r=t[0]));var n="",o="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),o=t[2]),{id:r,name:n,type:o}},e.prototype.parseNodeProperty=function(t,r,n){var o=r[1].replace(/^"/,"").replace(/"$/,"").trim(),s=r[2].replace(/^"/,"").replace(/"$/,"").trim();o==="Content"&&s===","&&(s=n.replace(/"/g,"").replace(/,$/,"").trim());var l=this.getCurrentNode(),u=l.name;if(u==="Properties70"){this.parseNodeSpecialProperty(t,o,s);return}if(o==="C"){var c=s.split(",").slice(1),h=parseInt(c[0]),f=parseInt(c[1]),m=s.split(",").slice(3);m=m.map(function(y){return y.trim().replace(/^"/,"")}),o="connections",s=[h,f],append(s,m),l[o]===void 0&&(l[o]=[])}o==="Node"&&(l.id=s),o in l&&Array.isArray(l[o])?l[o].push(s):o!=="a"?l[o]=s:l.a=s,this.setCurrentProp(l,o),o==="a"&&s.slice(-1)!==","&&(l.a=parseNumberArray(s))},e.prototype.parseNodePropertyContinued=function(t){var r=this.getCurrentNode();r.a+=t,t.slice(-1)!==","&&(r.a=parseNumberArray(r.a))},e.prototype.parseNodeSpecialProperty=function(t,r,n){var o=n.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=o[0],l=o[1],u=o[2],c=o[3],h=o[4];switch(l){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=parseNumberArray(h);break}this.getPrevNode()[s]={type:l,type2:u,flag:c,value:h},this.setCurrentProp(this.getPrevNode(),s)},e}(),BinaryParser=function(){function e(){}return e.prototype.parse=function(t){var r=new BinaryReader(t);r.skip(23);var n=r.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);for(var o=new FBXTree;!this.endOfContent(r);){var s=this.parseNode(r,n);s!==null&&o.add(s.name,s)}return o},e.prototype.endOfContent=function(t){return t.size()%16===0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()},e.prototype.parseNode=function(t,r){var n={},o=r>=7500?t.getUint64():t.getUint32(),s=r>=7500?t.getUint64():t.getUint32();r>=7500?t.getUint64():t.getUint32();var l=t.getUint8(),u=t.getString(l);if(o===0)return null;for(var c=[],h=0;h<s;h++)c.push(this.parseProperty(t));var f=c.length>0?c[0]:"",m=c.length>1?c[1]:"",y=c.length>2?c[2]:"";for(n.singleProperty=s===1&&t.getOffset()===o;o>t.getOffset();){var A=this.parseNode(t,r);A!==null&&this.parseSubNode(u,n,A)}return n.propertyList=c,typeof f=="number"&&(n.id=f),m!==""&&(n.attrName=m),y!==""&&(n.attrType=y),u!==""&&(n.name=u),n},e.prototype.parseSubNode=function(t,r,n){if(n.singleProperty===!0){var o=n.propertyList[0];Array.isArray(o)?(r[n.name]=n,n.a=o):r[n.name]=o}else if(t==="Connections"&&n.name==="C"){var s=[];n.propertyList.forEach(function(y,A){A!==0&&s.push(y)}),r.connections===void 0&&(r.connections=[]),r.connections.push(s)}else if(n.name==="Properties70"){var l=Object.keys(n);l.forEach(function(y){r[y]=n[y]})}else if(t==="Properties70"&&n.name==="P"){var u=n.propertyList[0],c=n.propertyList[1],h=n.propertyList[2],f=n.propertyList[3],m=void 0;u.indexOf("Lcl ")===0&&(u=u.replace("Lcl ","Lcl_")),c.indexOf("Lcl ")===0&&(c=c.replace("Lcl ","Lcl_")),c==="Color"||c==="ColorRGB"||c==="Vector"||c==="Vector3D"||c.indexOf("Lcl_")===0?m=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:m=n.propertyList[4],r[u]={type:c,type2:h,flag:f,value:m}}else r[n.name]===void 0?typeof n.id=="number"?(r[n.name]={},r[n.name][n.id]=n):r[n.name]=n:n.name==="PoseNode"?(Array.isArray(r[n.name])||(r[n.name]=[r[n.name]]),r[n.name].push(n)):r[n.name][n.id]===void 0&&(r[n.name][n.id]=n)},e.prototype.parseProperty=function(t){var r=t.getString(1),n;switch(r){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return n=t.getUint32(),t.getArrayBuffer(n);case"S":return n=t.getUint32(),t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var o=t.getUint32(),s=t.getUint32(),l=t.getUint32();if(s===0)switch(r){case"b":case"c":return t.getBooleanArray(o);case"d":return t.getFloat64Array(o);case"f":return t.getFloat32Array(o);case"i":return t.getInt32Array(o);case"l":return t.getInt64Array(o)}var u=unzlibSync(new Uint8Array(t.getArrayBuffer(l))),c=new BinaryReader(u.buffer);switch(r){case"b":case"c":return c.getBooleanArray(o);case"d":return c.getFloat64Array(o);case"f":return c.getFloat32Array(o);case"i":return c.getInt32Array(o);case"l":return c.getInt64Array(o)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+r)}},e}(),BinaryReader=function(){function e(t,r){this.dv=new DataView(t),this.offset=0,this.littleEndian=r!==void 0?r:!0,this._textDecoder=new TextDecoder}return e.prototype.getOffset=function(){return this.offset},e.prototype.size=function(){return this.dv.buffer.byteLength},e.prototype.skip=function(t){this.offset+=t},e.prototype.getBoolean=function(){return(this.getUint8()&1)===1},e.prototype.getBooleanArray=function(t){for(var r=[],n=0;n<t;n++)r.push(this.getBoolean());return r},e.prototype.getUint8=function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},e.prototype.getInt16=function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},e.prototype.getInt32=function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},e.prototype.getInt32Array=function(t){for(var r=[],n=0;n<t;n++)r.push(this.getInt32());return r},e.prototype.getUint32=function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},e.prototype.getInt64=function(){var t,r;return this.littleEndian?(t=this.getUint32(),r=this.getUint32()):(r=this.getUint32(),t=this.getUint32()),r&2147483648?(r=~r&4294967295,t=~t&4294967295,t===4294967295&&(r=r+1&4294967295),t=t+1&4294967295,-(r*4294967296+t)):r*4294967296+t},e.prototype.getInt64Array=function(t){for(var r=[],n=0;n<t;n++)r.push(this.getInt64());return r},e.prototype.getUint64=function(){var t,r;return this.littleEndian?(t=this.getUint32(),r=this.getUint32()):(r=this.getUint32(),t=this.getUint32()),r*4294967296+t},e.prototype.getFloat32=function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},e.prototype.getFloat32Array=function(t){for(var r=[],n=0;n<t;n++)r.push(this.getFloat32());return r},e.prototype.getFloat64=function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},e.prototype.getFloat64Array=function(t){for(var r=[],n=0;n<t;n++)r.push(this.getFloat64());return r},e.prototype.getArrayBuffer=function(t){var r=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,r},e.prototype.getString=function(t){var r=this.offset,n=new Uint8Array(this.dv.buffer,r,t);this.skip(t);var o=n.indexOf(0);return o>=0&&(n=new Uint8Array(this.dv.buffer,r,o)),this._textDecoder.decode(n)},e}(),FBXTree=function(){function e(){this.Connections={connections:[]},this.Objects={Model:{},NodeAttribute:{},Geometry:{}},this.GlobalSettings={}}return e.prototype.add=function(t,r){this[t]=r},e}();function isFbxFormatBinary(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===convertArrayBufferToString(e,0,t.length)}function isFbxFormatASCII(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function n(l){var u=e[l-1];return e=e.slice(r+l),r++,u}for(var o=0;o<t.length;++o){var s=n(1);if(s===t[o])return!1}return!0}function getFbxVersion(e){var t=/FBXVersion: (\d+)/,r=e.match(t);if(r){var n=parseInt(r[1]);return n}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function convertFBXTimeToSeconds(e){return e/46186158e3}var dataArray=[];function getData(e,t,r,n){var o;switch(n.mappingType){case"ByPolygonVertex":o=e;break;case"ByPolygon":o=t;break;case"ByVertice":o=r;break;case"AllSame":o=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType),o=0}n.referenceType==="IndexToDirect"&&(o=n.indices[o]);var s=o*n.dataSize,l=s+n.dataSize;return slice(dataArray,n.buffer,s,l)}var tempEuler=new Euler,tempVec=new Vector3;function generateTransform(e){var t=new Matrix4,r=new Matrix4,n=new Matrix4,o=new Matrix4,s=new Matrix4,l=new Matrix4,u=new Matrix4,c=new Matrix4,h=new Matrix4,f=new Matrix4,m=new Matrix4,y=new Matrix4,A=e.inheritType?e.inheritType:0;e.translation&&t.setPosition(tempVec.fromArray(e.translation));var M=getEulerOrder(0);if(e.preRotation){var b=e.preRotation.map(MathUtils.degToRad);b.push(M),r.makeRotationFromEuler(tempEuler.fromArray(b))}if(e.rotation){var b=e.rotation.map(MathUtils.degToRad);b.push(e.eulerOrder||M),n.makeRotationFromEuler(tempEuler.fromArray(b))}if(e.postRotation){var b=e.postRotation.map(MathUtils.degToRad);b.push(M),o.makeRotationFromEuler(tempEuler.fromArray(b)),o.copy(new Matrix4().getInverse(o))}e.scale&&s.scale(tempVec.fromArray(e.scale)),e.scalingOffset&&u.setPosition(tempVec.fromArray(e.scalingOffset)),e.scalingPivot&&l.setPosition(tempVec.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(tempVec.fromArray(e.rotationOffset)),e.rotationPivot&&h.setPosition(tempVec.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(m.copy(e.parentMatrix),f.copy(e.parentMatrixWorld));var T=r.clone().multiply(n).multiply(o),_=new Matrix4;_.extractRotation(f);var S=new Matrix4;S.copyPosition(f);var C=new Matrix4().getInverse(S).multiply(f),P=new Matrix4().getInverse(_).multiply(C),F=s,O=new Matrix4;if(A===0)O.copy(_).multiply(T).multiply(P).multiply(F);else if(A===1)O.copy(_).multiply(P).multiply(T).multiply(F);else{var N=new Matrix4().scale(new Vector3().setFromMatrixScale(m)),V=new Matrix4().getInverse(N),q=P.clone().multiply(V);O.copy(_).multiply(T).multiply(q).multiply(F)}var Q=new Matrix4().getInverse(h),z=new Matrix4().getInverse(l),H=t.clone().multiply(c).multiply(h).multiply(r).multiply(n).multiply(o).multiply(Q).multiply(u).multiply(l).multiply(s).multiply(z),W=new Matrix4().copyPosition(H),J=f.clone().multiply(W);return y.copyPosition(J),H=y.clone().multiply(O),H.premultiply(new Matrix4().getInverse(f)),H}function getEulerOrder(e){e=e||0;var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return e===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function parseNumberArray(e){var t=e.split(",").map(function(r){return parseFloat(r)});return t}function convertArrayBufferToString(e,t,r){return t===void 0&&(t=0),r===void 0&&(r=e.byteLength),new TextDecoder().decode(new Uint8Array(e,t,r))}function append(e,t){for(var r=0,n=e.length,o=t.length;r<o;r++,n++)e[n]=t[r]}function slice(e,t,r,n){for(var o=r,s=0;o<n;o++,s++)e[s]=t[o];return e}var NURBSCurve=function(e){__extends(t,e);function t(r,n,o,s,l){var u=e.call(this)||this,c=n?n.length-1:0,h=o?o.length:0;u.degree=r,u.knots=n,u.controlPoints=[],u.startKnot=s||0,u.endKnot=l||c;for(var f=0;f<h;++f){var m=o[f];u.controlPoints[f]=new Vector4(m.x,m.y,m.z,m.w)}return u}return t.prototype.getPoint=function(r,n){n===void 0&&(n=new Vector3);var o=n,s=this.knots[this.startKnot]+r*(this.knots[this.endKnot]-this.knots[this.startKnot]),l=calcBSplinePoint(this.degree,this.knots,this.controlPoints,s);return l.w!==1&&l.divideScalar(l.w),o.set(l.x,l.y,l.z)},t.prototype.getTangent=function(r,n){n===void 0&&(n=new Vector3);var o=n,s=this.knots[0]+r*(this.knots[this.knots.length-1]-this.knots[0]),l=calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,s,1);return o.copy(l[1]).normalize(),o},t.prototype.toJSON=function(){var r=e.prototype.toJSON.call(this);return r.degree=this.degree,r.knots=__spreadArray([],this.knots,!0),r.controlPoints=this.controlPoints.map(function(n){return n.toArray()}),r.startKnot=this.startKnot,r.endKnot=this.endKnot,r},t.prototype.fromJSON=function(r){return e.prototype.fromJSON.call(this,r),this.degree=r.degree,this.knots=__spreadArray([],r.knots,!0),this.controlPoints=r.controlPoints.map(function(n){return new Vector4(n[0],n[1],n[2],n[3])}),this.startKnot=r.startKnot,this.endKnot=r.endKnot,this},t}(Curve);function findSpan(e,t,r){var n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;for(var o=e,s=n,l=Math.floor((o+s)/2);t<r[l]||t>=r[l+1];)t<r[l]?s=l:o=l,l=Math.floor((o+s)/2);return l}function calcBasisFunctions(e,t,r,n){var o=[],s=[],l=[];o[0]=1;for(var u=1;u<=r;++u){s[u]=t-n[e+1-u],l[u]=n[e+u]-t;for(var c=0,h=0;h<u;++h){var f=l[h+1],m=s[u-h],y=o[h]/(f+m);o[h]=c+f*y,c=m*y}o[u]=c}return o}function calcBSplinePoint(e,t,r,n){for(var o=findSpan(e,n,t),s=calcBasisFunctions(o,n,e,t),l=new Vector4(0,0,0,0),u=0;u<=e;++u){var c=r[o-e+u],h=s[u],f=c.w*h;l.x+=c.x*f,l.y+=c.y*f,l.z+=c.z*f,l.w+=c.w*h}return l}function calcBasisFunctionDerivatives(e,t,r,n,o){for(var s=[],l=0;l<=r;++l)s[l]=0;for(var u=[],l=0;l<=n;++l)u[l]=s.slice(0);for(var c=[],l=0;l<=r;++l)c[l]=s.slice(0);c[0][0]=1;for(var h=s.slice(0),f=s.slice(0),m=1;m<=r;++m){h[m]=t-o[e+1-m],f[m]=o[e+m]-t;for(var y=0,A=0;A<m;++A){var M=f[A+1],b=h[m-A];c[m][A]=M+b;var T=c[A][m-1]/c[m][A];c[A][m]=y+M*T,y=b*T}c[m][m]=y}for(var m=0;m<=r;++m)u[0][m]=c[m][r];for(var _=0;_<=r;++_){for(var S=0,C=1,P=[],l=0;l<=r;++l)P[l]=s.slice(0);P[0][0]=1;for(var F=1;F<=n;++F){var O=0,N=_-F,V=r-F;_>=F&&(P[C][0]=P[S][0]/c[V+1][N],O=P[C][0]*c[N][V]);for(var q=N>=-1?1:-N,Q=_-1<=V?F-1:r-_,z=q;z<=Q;++z)P[C][z]=(P[S][z]-P[S][z-1])/c[V+1][N+z],O+=P[C][z]*c[N+z][V];_<=V&&(P[C][F]=-P[S][F-1]/c[V+1][_],O+=P[C][F]*c[_][V]),u[F][_]=O;var m=S;S=C,C=m}}for(var H=r,F=1;F<=n;++F){for(var m=0;m<=r;++m)u[F][m]*=H;H*=r-F}return u}function calcBSplineDerivatives(e,t,r,n,o){for(var s=o<e?o:e,l=[],u=findSpan(e,n,t),c=calcBasisFunctionDerivatives(u,n,e,s,t),h=[],f=0;f<r.length;++f){var m=r[f].clone(),y=m.w;m.x*=y,m.y*=y,m.z*=y,h[f]=m}for(var A=0;A<=s;++A){for(var m=h[u-e].clone().multiplyScalar(c[A][0]),M=1;M<=e;++M)m.add(h[u-e+M].clone().multiplyScalar(c[A][M]));l[A]=m}for(var A=s+1;A<=o+1;++A)l[A]=new Vector4(0,0,0);return l}function calcKoverI(e,t){for(var r=1,n=2;n<=e;++n)r*=n;for(var o=1,n=2;n<=t;++n)o*=n;for(var n=2;n<=e-t;++n)o*=n;return r/o}function calcRationalCurveDerivatives(e){for(var t=e.length,r=[],n=[],o=0;o<t;++o){var s=e[o];r[o]=new Vector3(s.x,s.y,s.z),n[o]=s.w}for(var l=[],u=0;u<t;++u){for(var c=r[u].clone(),o=1;o<=u;++o)c.sub(l[u-o].clone().multiplyScalar(calcKoverI(u,o)*n[o]));l[u]=c.divideScalar(n[0])}return l}function calcNURBSDerivatives(e,t,r,n,o){var s=calcBSplineDerivatives(e,t,r,n,o);return calcRationalCurveDerivatives(s)}var _vector=new Vector3;function getPointArray(e,t){switch(t){case"D":return new Float64Array(e);case"F":return new Float32Array(e);case"L":return new Int32Array(e);case"I":return new Int16Array(e);default:return new Uint8Array(e)}}function loadX3p(e,t){var r;t===void 0&&(t={});var n=(r=t.fetcher)!==null&&r!==void 0?r:new Fetcher({allowHosts:["*"]}),o={byteLength:0};return Promise.resolve().then(function(){return n.ajax(e,{responseType:"arraybuffer"})}).then(function(s){var l,u;return o.byteLength=s.body.byteLength,parse$1(new Uint8Array(s.body),{light:(l=t.light)!==null&&l!==void 0?l:!0,color:t.color,resourcePath:e.slice(0,e.lastIndexOf("/")+1),search:(u=e.split("?")[1])!==null&&u!==void 0?u:""})}).then(function(s){var l=new Group;return l.matrixAutoUpdate=!1,l.matrix.compose(l.position,l.quaternion,l.scale),l.name=e,l.add(s.object),{type:"x3p",upAxis:"Z",uri:e,byteLength:o.byteLength,memoryUsage:getMemoryUsage(l),scene:l,textures:[],dispose:function(){return s.dispose()}}})}function parse$1(e,t){for(var r,n,o,s,l,u,c,h,f,m,y,A,M,b,T,_,S,C,P,F,O,N,V,q,Q,z,H,W,J,G,te,X,K,Z,ee,j,re,pe,ge,_e,he,Fe,Re,Le,Se,we,Ve,je,st,We,bt,oe,ue,Qe,Me=unzipSync(e),De="",be=null,ze=0,at=Object.keys(Me);ze<at.length;ze++){var ot=at[ze];/(^|\/)main\.xml$/i.test(ot)&&(be=Me[ot],De=ot.slice(0,ot.lastIndexOf("/")+1))}if(!be)throw new Error("X3p: main.xml not found.");if(typeof DOMParser>"u")throw new Error("X3p: DOMParser not found.");var nt=(r=t.color)!==null&&r!==void 0?r:new Color(10066329),Ue=new DOMParser,He=decodeText(be),qe=Ue.parseFromString(He,"text/xml"),ke=qe.querySelector("Record1 Axes"),ve={x:{type:(s=(o=(n=ke==null?void 0:ke.querySelector("CX AxisType"))===null||n===void 0?void 0:n.textContent)===null||o===void 0?void 0:o.toUpperCase())!==null&&s!==void 0?s:"I",dataType:(c=(u=(l=ke==null?void 0:ke.querySelector("CX DataType"))===null||l===void 0?void 0:l.textContent)===null||u===void 0?void 0:u.toUpperCase())!==null&&c!==void 0?c:"D",increment:Number((f=(h=ke==null?void 0:ke.querySelector("CX Increment"))===null||h===void 0?void 0:h.textContent)!==null&&f!==void 0?f:"1"),offset:Number((y=(m=ke==null?void 0:ke.querySelector("CX Offset"))===null||m===void 0?void 0:m.textContent)!==null&&y!==void 0?y:"0")},y:{type:(b=(M=(A=ke==null?void 0:ke.querySelector("CY AxisType"))===null||A===void 0?void 0:A.textContent)===null||M===void 0?void 0:M.toUpperCase())!==null&&b!==void 0?b:"I",dataType:(S=(_=(T=ke==null?void 0:ke.querySelector("CY DataType"))===null||T===void 0?void 0:T.textContent)===null||_===void 0?void 0:_.toUpperCase())!==null&&S!==void 0?S:"D",increment:Number((P=(C=ke==null?void 0:ke.querySelector("CY Increment"))===null||C===void 0?void 0:C.textContent)!==null&&P!==void 0?P:"1"),offset:Number((O=(F=ke==null?void 0:ke.querySelector("CY Offset"))===null||F===void 0?void 0:F.textContent)!==null&&O!==void 0?O:"0")},z:{type:(q=(V=(N=ke==null?void 0:ke.querySelector("CZ AxisType"))===null||N===void 0?void 0:N.textContent)===null||V===void 0?void 0:V.toUpperCase())!==null&&q!==void 0?q:"A",dataType:(H=(z=(Q=ke==null?void 0:ke.querySelector("CZ DataType"))===null||Q===void 0?void 0:Q.textContent)===null||z===void 0?void 0:z.toUpperCase())!==null&&H!==void 0?H:"D",increment:Number((J=(W=ke==null?void 0:ke.querySelector("CZ Increment"))===null||W===void 0?void 0:W.textContent)!==null&&J!==void 0?J:"1"),offset:Number((te=(G=ke==null?void 0:ke.querySelector("CZ Offset"))===null||G===void 0?void 0:G.textContent)!==null&&te!==void 0?te:"0")}},Ye=null,tt=qe.querySelector("Record1 Axes Rotation");tt&&(Ye=new Matrix3,Ye.set(Number((K=(X=tt.querySelector("r11"))===null||X===void 0?void 0:X.textContent)!==null&&K!==void 0?K:0),Number((ee=(Z=tt.querySelector("r12"))===null||Z===void 0?void 0:Z.textContent)!==null&&ee!==void 0?ee:0),Number((re=(j=tt.querySelector("r13"))===null||j===void 0?void 0:j.textContent)!==null&&re!==void 0?re:0),Number((ge=(pe=tt.querySelector("r21"))===null||pe===void 0?void 0:pe.textContent)!==null&&ge!==void 0?ge:0),Number((he=(_e=tt.querySelector("r22"))===null||_e===void 0?void 0:_e.textContent)!==null&&he!==void 0?he:0),Number((Re=(Fe=tt.querySelector("r23"))===null||Fe===void 0?void 0:Fe.textContent)!==null&&Re!==void 0?Re:0),Number((Se=(Le=tt.querySelector("r31"))===null||Le===void 0?void 0:Le.textContent)!==null&&Se!==void 0?Se:0),Number((Ve=(we=tt.querySelector("r32"))===null||we===void 0?void 0:we.textContent)!==null&&Ve!==void 0?Ve:0),Number((st=(je=tt.querySelector("r33"))===null||je===void 0?void 0:je.textContent)!==null&&st!==void 0?st:0)));var xt=(We=qe.querySelector("Record3 DataLink PointDataLink"))===null||We===void 0?void 0:We.textContent;if(typeof xt!="string")throw new Error("X3p: PointDataLink not found.");xt=pathJoin(De,xt);var Ze=Me[xt];if(!Ze)throw new Error("X3p: ".concat(Ze," not found."));for(var lt=getPointArray(Ze.buffer,ve.z.dataType),Pt=Number((oe=(bt=qe.querySelector("Record3 MatrixDimension SizeX"))===null||bt===void 0?void 0:bt.textContent)!==null&&oe!==void 0?oe:"0"),Lt=Number((Qe=(ue=qe.querySelector("Record3 MatrixDimension SizeY"))===null||ue===void 0?void 0:ue.textContent)!==null&&Qe!==void 0?Qe:"0"),Gt=Math.floor(Pt-1),Rt=Math.floor(Lt-1),Ft=Gt+1,Nt=Rt+1,Ht=new Float32Array(Ft*Nt*3),or=new Float32Array(Ft*Nt*2),Xt=new Uint32Array(Gt*Rt*6),Zt=new Box3,ae=0;ae<Nt;ae++)for(var Pe=ae*ve.y.increment+ve.y.offset,Te=0;Te<Ft;Te++){var Ne=ae*Ft+Te,it=Te*ve.x.increment+ve.x.offset,ft=lt[Ne],gt=!isNaN(ft),ut=gt?ft:NaN;_vector.set(it,-Pe,ut),Ye&&_vector.applyMatrix3(Ye),gt&&Zt.expandByPoint(_vector),Ht[Ne*3+0]=_vector.x,Ht[Ne*3+1]=_vector.y,Ht[Ne*3+2]=_vector.z,or[Ne*2+0]=Te/Gt,or[Ne*2+1]=1-ae/Rt}for(var ae=0;ae<Rt;ae++)for(var Te=0;Te<Gt;Te++){var vt=Te+Ft*ae,yt=Te+Ft*(ae+1),Ot=Te+1+Ft*(ae+1),It=Te+1+Ft*ae,Tt=(ae*Gt+Te)*6;Xt[Tt+0]=vt,Xt[Tt+1]=yt,Xt[Tt+2]=It,Xt[Tt+3]=yt,Xt[Tt+4]=Ot,Xt[Tt+5]=It}var ht=new BufferGeometry;ht.setAttribute("position",new BufferAttribute(Ht,3)),ht.setAttribute("uv",new BufferAttribute(or,2)),ht.setIndex(new BufferAttribute(Xt,1)),(!ht.groups||ht.groups.length===0)&&ht.addGroup(0,ht.index?ht.index.count:ht.attributes.position.count,0),ht.boundingBox=Zt;var St=new PBMMeshMaterial(t.light?"phong":"basic");St.flatShading=!0,St.color.copy(nt),St.refreshUniforms();var zt=new PBMMesh(ht,[St]);return{object:zt,dispose:function(){ht.dispose(),St.dispose()}}}var scratchMatrix4$3=new Matrix4,MAX_RETRY_DELAY$1=5e3,RETRY_DELAY_STEP$1=1e3;function attachTileAttributes(e,t){e.name=t.id;var r=t.tileset.properties.floorInfo;e.traverse(function(n){if("floor"in t.extras){if(n instanceof Mesh||n instanceof Points)for(var o=Array.isArray(n.material)?n.material:n.material?[n.material]:[],s=0,l=o;s<l.length;s++){var u=l[s];(u instanceof PBMMeshMaterial||u instanceof PBMPointCloudMaterial)&&(u.floorIndex=t.extras.floor)}}else if(!(n instanceof PBMPointCloud)&&(n instanceof PBMMesh||n instanceof PBMSkinnedMesh)&&r){for(var c=new Box3().expandByObject(n),h=c.getCenter(new Vector3),f=0,m=0;m<r.length;m++){var y=r[m],A=y.ground,M=y.height;if(h.y<A+M){f=m;break}}t.floor=f,t.tileset.floorLength=Math.max(t.tileset.floorLength,t.floor+1),n.material.forEach(function(b){return b.floorIndex=f})}})}function loadTileContent(e,t){if(!e.content)return Promise.resolve(e);var r=e.content,n=appendSearch(r.uri,t.search);if(e.type==="TILESET"){var o=imageURL(n,{key:"model.".concat(e.siblingIndex)});return r.loadState="LOADING",r.loadStateUpdateTime=now(),t.fetcher.ajax(o,{responseType:"text"}).then(function(s){return s.body}).then(function(s){var l=n.slice(0,n.lastIndexOf("/")+1);return normalizeTilesetHeader(JSON.parse(s),l)}).then(function(s){r.loadState="READY",r.loadStateUpdateTime=now(),r.loadfailRetryDelay=0,e.children.length===0&&(e.children=[new Tile("".concat(e.id,".0"),s.root,e.tileset,e)])}).then(function(){return e}).catch(function(s){return r.loadState="FAILED",r.loadStateUpdateTime=now(),r.loadfailRetryDelay=Math.min(r.loadfailRetryDelay+1e3,5e3),Promise.reject(s)})}if(e.type==="SCENEGRAPH")return r.loadState="LOADING",r.loadStateUpdateTime=now(),Promise.resolve().then(function(){var s,l,u,c,h,f,m,y,A,M,b="",T=n.split("#"),_=T[0],S=T[1],C=(S||_).split("?")[0].match(/\.([0-9a-zA-Z]+)$/);if(C&&(b=C[1]),b==="b3dm"){var P=imageURL(n,{key:"model.".concat(e.siblingIndex)});return loadB3dm(P,{upAxis:e.tileset.asset.gltfUpAxis,light:t.light,fetcher:t.fetcher}).then(function(F){return F.scene.applyMatrix4(e.transform),F.scene.updateWorldMatrix(!1,!0),F.scene.matrixAutoUpdate=!1,attachTileAttributes(F.scene,e),F})}if(b==="pnts"){var P=imageURL(n,{key:"model.".concat(e.siblingIndex)});return loadPnts(P,{computeBoundingBox:!1,fetcher:t.fetcher}).then(function(O){if(O.scene.applyMatrix4(e.transform),O.scene.updateWorldMatrix(!1,!0),O.scene.matrixAutoUpdate=!1,e.boundingVolume){var N=e.boundingVolume;O.scene.traverse(function(V){if(V instanceof PBMPointCloud){scratchMatrix4$3.getInverse(V.matrixWorld);var q=new Box3;N.getBoundingBox(q),q.applyMatrix4(scratchMatrix4$3),V.geometry.boundingBox=q}})}return attachTileAttributes(O.scene,e),O})}if(b==="glb"||b==="gltf"){var P=imageURL(n,{key:"model.".concat(e.siblingIndex)});return loadGltf(P,{upAxis:e.tileset.asset.gltfUpAxis,light:t.light,fetcher:t.fetcher}).then(function(O){return O.scene.applyMatrix4(e.transform),O.scene.updateWorldMatrix(!1,!0),O.scene.matrixAutoUpdate=!1,attachTileAttributes(O.scene,e),O})}if(b==="at3d"){var P=e.extras.at3d?n:imageURL(n,{key:"model.".concat(e.siblingIndex)});return loadAt3d(P,{light:t.light,textureBaseUri:(s=e.extras.at3d)===null||s===void 0?void 0:s.textureBaseUri,textureArray:(l=e.extras.at3d)===null||l===void 0?void 0:l.textureArray,textureOptions:(u=e.extras.at3d)===null||u===void 0?void 0:u.textureOptions,fetcher:t.fetcher}).then(function(O){return O.scene.applyMatrix4(e.transform),O.scene.updateWorldMatrix(!1,!0),O.scene.matrixAutoUpdate=!1,O})}if(b==="pbm"){var P=e.extras.pbm?n:imageURL(n,{key:"model.".concat(e.siblingIndex)});return loadPbm(P,{light:t.light,textureBaseUri:(c=e.extras.pbm)===null||c===void 0?void 0:c.textureBaseUri,textureArray:(h=e.extras.pbm)===null||h===void 0?void 0:h.textureArray,textureOptions:(f=e.extras.pbm)===null||f===void 0?void 0:f.textureOptions,fetcher:t.fetcher}).then(function(O){return O.scene.applyMatrix4(e.transform),O.scene.updateWorldMatrix(!1,!0),O.scene.matrixAutoUpdate=!1,O})}if(b==="dome"){var P=e.extras.dome?n:imageURL(n,{key:"model.".concat(e.siblingIndex)});return loadDome(P,{light:t.light,textureBaseUri:(m=e.extras.dome)===null||m===void 0?void 0:m.textureBaseUri,textureOptions:(y=e.extras.dome)===null||y===void 0?void 0:y.textureOptions,fetcher:t.fetcher}).then(function(O){return O.scene.applyMatrix4(e.transform),O.scene.updateWorldMatrix(!1,!0),O.scene.matrixAutoUpdate=!1,O})}if(b==="domez"){var P=e.extras.domez?n:imageURL(n,{key:"model.".concat(e.siblingIndex)});return loadDomez(P,{light:t.light,textureBaseUri:(A=e.extras.domez)===null||A===void 0?void 0:A.textureBaseUri,textureOptions:(M=e.extras.domez)===null||M===void 0?void 0:M.textureOptions,fetcher:t.fetcher}).then(function(O){return O.scene.applyMatrix4(e.transform),O.scene.updateWorldMatrix(!1,!0),O.scene.matrixAutoUpdate=!1,O})}if(b==="ply"){var P=e.extras.ply?n:imageURL(n,{key:"model.".concat(e.siblingIndex)});return loadPly(P,{type:"pbmPointCloud",light:t.light,upAxis:"Z",fetcher:t.fetcher}).then(function(O){return O.scene.applyMatrix4(e.transform),O.scene.updateWorldMatrix(!1,!0),O.scene.matrixAutoUpdate=!1,O})}if(b==="obj"){var P=e.extras.obj?n:imageURL(n,{key:"model.".concat(e.siblingIndex)});return loadObj(P,{upAxis:"Z",light:t.light,fetcher:t.fetcher}).then(function(O){return O.scene.applyMatrix4(e.transform),O.scene.updateWorldMatrix(!1,!0),O.scene.matrixAutoUpdate=!1,O})}if(b==="fbx"){var P=e.extras.obj?n:imageURL(n,{key:"model.".concat(e.siblingIndex)});return loadFbx(P,{light:t.light,fetcher:t.fetcher}).then(function(O){return O.scene.applyMatrix4(e.transform),O.scene.updateWorldMatrix(!1,!0),O.scene.matrixAutoUpdate=!1,O})}if(b==="x3p"){var P=e.extras.x3p?n:imageURL(n,{key:"model.".concat(e.siblingIndex)});return loadX3p(P,{light:t.light,fetcher:t.fetcher}).then(function(O){return O.scene.applyMatrix4(e.transform),O.scene.updateWorldMatrix(!1,!0),O.scene.matrixAutoUpdate=!1,O})}throw new Error("Invalid Tile content: ".concat(n))}).then(function(s){s.scene.traverse(function(u){if(u instanceof PBMPointCloud)u.material.uniforms.geometricError.value=e.geometricError;else if(u instanceof PBMMesh||u instanceof PBMSkinnedMesh)for(var c=0,h=u.material;c<h.length;c++){var f=h[c];f.uniforms.geometricError.value=e.geometricError}});var l={type:s.type,uri:s.uri,byteLength:s.byteLength,memoryUsage:s.memoryUsage,object:new TileNode(e.id,s.scene,s.dispose)};return Promise.resolve().then(function(){return Promise.all([l.object.generateBvhTree(),t.renderer&&s.textures.length<16?initTextures(s.textures,t.renderer,1024*1024):null])}).then(function(){return r.loadState="READY",r.loadStateUpdateTime=now(),r.loadfailRetryDelay=0,r.byteLength=l.byteLength,r.memoryUsage=l.memoryUsage,r.data=l,e}).catch(function(u){return unloadTileContent(e),Promise.reject(u)})}).catch(function(s){return r.loadState="FAILED",r.loadStateUpdateTime=now(),s instanceof NetworkResponseError&&s.httpStatus===0||s instanceof NetworkTimeoutError||s instanceof NetworkProxyError?r.loadfailRetryDelay=clamp$1(r.loadfailRetryDelay+RETRY_DELAY_STEP$1,RETRY_DELAY_STEP$1,MAX_RETRY_DELAY$1):r.loadfailRetryDelay=1/0,Promise.reject(s)});throw new Error("Invalid Tile type: ".concat(e.type))}function unloadTileContent(e){e.content&&(e.content.data&&e.content.data.object.dispose(),e.content.data=void 0,e.content.loadState="UNLOADED",e.content.loadStateUpdateTime=now(),e.content.byteLength=0,e.content.memoryUsage=0)}var TrajectoryNode=function(e){__extends(t,e);function t(r,n,o){o===void 0&&(o=noop$1);var s=e.call(this)||this;return s.name=r,s.contentObject=n,s.name=r,s.add(n),s.disposers=[o],s}return t.prototype.update=function(r,n,o){var s=this.contentObject.material[2];s.uniforms.dashOffset.value=(s.uniforms.dashOffset.value-.003)%(s.uniforms.dashSize.value.x+s.uniforms.dashSize.value.y),o.needsRender=!0},t.prototype.dispose=function(){for(var r=0,n=this.disposers;r<n.length;r++){var o=n[r];o()}this.disposers.length=0},t.prototype.clone=function(){return new t(this.name,this.contentObject.clone())},t}(Object3D),MAX_RETRY_DELAY=5e3,RETRY_DELAY_STEP=1e3,TRAJECTOR_PIPE_SHADER={vertexShader:`
varying vec2 vUv;
uniform float displacementScalar;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
  vUv = uv;
  #include <color_vertex>
  #include <begin_vertex>
  vec3 objectNormal = vec3( normal );
  transformed += normalize( objectNormal ) * displacementScalar;
  #include <morphtarget_vertex>
  #include <project_vertex>
  #include <logdepthbuf_vertex>
  #include <clipping_planes_vertex>
  #include <fog_vertex>
}
`,fragmentShader:`
varying vec2 vUv;
uniform vec3 diffuse;
uniform vec3 diffuse2;
uniform float opacity;
uniform float dashOffset;
uniform vec2 dashSize;
uniform float totalLength;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
  if (mod(abs(vUv.x * totalLength + dashOffset), (dashSize.x + dashSize.y)) > dashSize.x) {
    discard;
  }
  #include <clipping_planes_fragment>
  vec3 outgoingLight = vec3( 0.0 );
  vec4 diffuseColor = vec4( mix(diffuse, diffuse2, vUv.x), opacity );

  #include <logdepthbuf_fragment>
  #include <color_fragment>

  outgoingLight = diffuseColor.rgb; // simple shader

  gl_FragColor = vec4( outgoingLight, diffuseColor.a );

  #include <tonemapping_fragment>
  #include <encodings_fragment>
  #include <fog_fragment>
  #include <premultiplied_alpha_fragment>
}
`,uniforms:{diffuse:{value:new Color},diffuse2:{value:new Color},opacity:{value:1},displacementScalar:{value:0},totalLength:{value:1},dashSize:{value:new Vector3},dashOffset:{value:0}}},TRAJECTOR_SPHERE_SHADER={vertexShader:`
uniform float displacementScalar;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
  #include <color_vertex>
  #include <begin_vertex>
  vec3 objectNormal = vec3( normal );
  transformed += normalize( objectNormal ) * displacementScalar;
  #include <morphtarget_vertex>
  #include <project_vertex>
  #include <logdepthbuf_vertex>
  #include <clipping_planes_vertex>
  #include <fog_vertex>
}
`,fragmentShader:`
uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
  #include <clipping_planes_fragment>
  vec3 outgoingLight = vec3( 0.0 );
  vec4 diffuseColor = vec4( diffuse, opacity );

  #include <logdepthbuf_fragment>
  #include <color_fragment>

  outgoingLight = diffuseColor.rgb; // simple shader

  gl_FragColor = vec4( outgoingLight, diffuseColor.a );

  #include <tonemapping_fragment>
  #include <encodings_fragment>
  #include <fog_fragment>
  #include <premultiplied_alpha_fragment>
}
`,uniforms:{diffuse:{value:new Color},opacity:{value:1},displacementScalar:{value:0}}};function createPipeBufferGeometry(e,t,r,n){for(var o=new Float32Array((r+1)*(n+1)*3),s=new Float32Array((r+1)*(n+1)*3),l=new Float32Array((r+1)*(n+1)*2),u=new Uint32Array(r*n*6),c=e.computeFrenetFrames(r),h=new Vector3,f=new Vector3,m=new Vector2,y=new Vector3,A=0;A<=r;A++){y=e.getPointAt(A/r,y);for(var M=c.normals[A],b=c.binormals[A],T=0;T<=n;T++){var _=A*(n+1)+T,S=T/n*Math.PI*2,C=Math.sin(S),P=-Math.cos(S);f.x=P*M.x+C*b.x,f.y=P*M.y+C*b.y,f.z=P*M.z+C*b.z,f.normalize(),f.toArray(s,_*3),h.x=y.x+t*f.x,h.y=y.y+t*f.y,h.z=y.z+t*f.z,h.toArray(o,_*3),m.x=A/r,m.y=T/n,m.toArray(l,_*2)}}for(var A=0;A<r;A++)for(var T=0;T<n;T++){var F=(A*n+T)*6,O=(n+1)*A+T,N=(n+1)*(A+1)+T,V=(n+1)*(A+1)+(T+1),q=(n+1)*A+(T+1);u[F]=O,u[F+1]=N,u[F+2]=q,u[F+3]=N,u[F+4]=V,u[F+5]=q}var Q=new BufferGeometry;return Q.setIndex(new BufferAttribute(u,1)),Q.setAttribute("position",new BufferAttribute(o,3)),Q.setAttribute("normal",new BufferAttribute(s,3)),Q.setAttribute("uv",new BufferAttribute(l,2)),Q}function parseTrajectoryObject(e,t){for(var r=new Color(0).convertSRGBToLinear(),n=new Color(52949).convertSRGBToLinear(),o=new Color(3370495).convertSRGBToLinear(),s=new Color(16777215).convertSRGBToLinear(),l=0,u=new CurvePath,c=e.length,h=3;h<c;h+=3){var f=new Vector3().fromArray(e,h-3),m=new Vector3().fromArray(e,h);l+=f.distanceTo(m);var y=new LineCurve3(f,m);u.add(y)}var A=.03,M=Math.ceil(l*100),b=6,T=createPipeBufferGeometry(u,A,M,b);T.clearGroups(),T.addGroup(0,T.index?T.index.count:T.attributes.position.count,0),T.addGroup(0,T.index?T.index.count:T.attributes.position.count,1),T.addGroup(0,T.index?T.index.count:T.attributes.position.count,2);var _=new ShaderMaterial({vertexShader:TRAJECTOR_PIPE_SHADER.vertexShader,fragmentShader:TRAJECTOR_PIPE_SHADER.fragmentShader,uniforms:UniformsUtils.clone(TRAJECTOR_PIPE_SHADER.uniforms),side:BackSide});_.uniforms.totalLength.value=l,_.uniforms.diffuse.value=r,_.uniforms.diffuse2.value=r,_.uniforms.opacity.value=.5,_.transparent=!0;var S=new ShaderMaterial({vertexShader:TRAJECTOR_PIPE_SHADER.vertexShader,fragmentShader:TRAJECTOR_PIPE_SHADER.fragmentShader,uniforms:UniformsUtils.clone(TRAJECTOR_PIPE_SHADER.uniforms),side:BackSide});S.uniforms.totalLength.value=l,S.uniforms.displacementScalar.value=-.01,S.uniforms.diffuse.value=n,S.uniforms.diffuse2.value=o;var C=new ShaderMaterial({vertexShader:TRAJECTOR_PIPE_SHADER.vertexShader,fragmentShader:TRAJECTOR_PIPE_SHADER.fragmentShader,uniforms:UniformsUtils.clone(TRAJECTOR_PIPE_SHADER.uniforms),side:DoubleSide});C.uniforms.totalLength.value=l,C.uniforms.displacementScalar.value=-.026,C.uniforms.dashSize.value=new Vector2(.06,.09),C.uniforms.diffuse.value=s,C.uniforms.diffuse2.value=s;var P=new Mesh(T,[_,S,C]),F=.08,O=24,N=new SphereBufferGeometry(F,O,O);N.clearGroups(),N.addGroup(0,T.index?T.index.count:T.attributes.position.count,0),N.addGroup(0,T.index?T.index.count:T.attributes.position.count,1);var V=new ShaderMaterial({vertexShader:TRAJECTOR_SPHERE_SHADER.vertexShader,fragmentShader:TRAJECTOR_SPHERE_SHADER.fragmentShader,uniforms:UniformsUtils.clone(TRAJECTOR_SPHERE_SHADER.uniforms),side:BackSide});V.uniforms.diffuse.value=r,V.uniforms.opacity.value=.5,V.transparent=!0;var q=new ShaderMaterial({vertexShader:TRAJECTOR_SPHERE_SHADER.vertexShader,fragmentShader:TRAJECTOR_SPHERE_SHADER.fragmentShader,uniforms:UniformsUtils.clone(TRAJECTOR_SPHERE_SHADER.uniforms),side:FrontSide});q.uniforms.displacementScalar.value=-.01,q.uniforms.diffuse.value=n;var Q=new Mesh(N,[V,q]);Q.position.fromArray(e,0),P.add(Q);var z=new ShaderMaterial({vertexShader:TRAJECTOR_SPHERE_SHADER.vertexShader,fragmentShader:TRAJECTOR_SPHERE_SHADER.fragmentShader,uniforms:UniformsUtils.clone(TRAJECTOR_SPHERE_SHADER.uniforms),side:FrontSide});z.uniforms.displacementScalar.value=-.01,z.uniforms.diffuse.value=o;var H=new Mesh(N,[V,z]);return H.position.fromArray(e,e.length-3),P.add(H),{scene:P,dispose:function(){T.dispose(),_.dispose(),S.dispose(),C.dispose(),N.dispose(),V.dispose(),q.dispose(),z.dispose()}}}function loadTrajectory(e,t){var r=e.name,n=appendSearch(e.content.uri,t.search),o=imageURL(n,{key:"model.0"});return e.content.loadState="LOADING",e.content.loadStateUpdateTime=now(),loadPly(o,{type:"geometry",customPropertyMapping:{time:{itemType:"uint32",itemNames:["time_milisec"]}},fetcher:t.fetcher}).then(function(s){var l,u,c,h,f=(u=(l=s.scene.attributes)===null||l===void 0?void 0:l.time.array)!==null&&u!==void 0?u:[],m=(h=(c=s.scene.attributes)===null||c===void 0?void 0:c.position.array)!==null&&h!==void 0?h:[],y=s.byteLength,A=s.memoryUsage,M=parseTrajectoryObject(m);M.scene.applyMatrix4(e.transform),M.scene.updateWorldMatrix(!1,!0),M.scene.matrixAutoUpdate=!1;var b=new TrajectoryNode(r,M.scene);return e.content.data={uri:o,byteLength:y,memoryUsage:A,positionArray:m,timeArray:f,object:b},e.content.byteLength=y,e.content.memoryUsage=A,e.content.loadState="READY",e.content.loadStateUpdateTime=now(),e}).catch(function(s){return e.content.data=void 0,e.content.loadState="FAILED",e.content.loadStateUpdateTime=now(),s instanceof NetworkResponseError&&s.httpStatus===0||s instanceof NetworkTimeoutError||s instanceof NetworkProxyError?e.content.loadfailRetryDelay=clamp$1(e.content.loadfailRetryDelay+RETRY_DELAY_STEP,RETRY_DELAY_STEP,MAX_RETRY_DELAY):e.content.loadfailRetryDelay=1/0,Promise.reject(s)})}function unloadTrajectory(e){e.content&&(e.content.data&&e.content.data.object.dispose(),e.content.data=void 0,e.content.loadState="UNLOADED",e.content.loadStateUpdateTime=now(),e.content.byteLength=0,e.content.memoryUsage=0)}var scratchVector3$1=new Vector3,scratchMatrix3=new Matrix3,scratchMatrix4$2=new Matrix4,a=6378137,invF=298.257223563;function ecefToLla(e){for(var t=a-a/invF,r=(a*a-t*t)/(a*a),n=Math.sqrt(e.x*e.x+e.y*e.y),o=1e-12,s=1e3,l=0,u=Math.atan2(e.z,n),c=0;l++<s;){var h=Math.sin(u),f=a/Math.sqrt(1-r*h*h);c=n/Math.cos(u)-f;var m=Math.atan2(e.z/(f*(1-r)+c),n/(f+c));if(isNaN(m))break;var y=Math.abs(m-u);if(y<o)break;u=m}return e.set(u,Math.atan2(e.y,e.x),c)}function llaToEcef(e){var t=e.x,r=e.y,n=e.z,o=a-a/invF,s=(a*a-o*o)/(a*a),l=Math.sin(t),u=Math.cos(t),c=Math.sin(r),h=Math.cos(r),f=a/Math.sqrt(1-s*l*l),m=(f+n)*u*h,y=(f+n)*u*c,A=(o*o/(a*a)*f+n)*l;return e.set(m,y,A)}function getEcefToEnuMatrix(e,t){var r=ecefToLla(scratchVector3$1.copy(e)),n=r.x,o=r.y,s=r.z,l=Math.sin(n),u=Math.sin(o),c=Math.cos(n),h=Math.cos(o);t.fromArray([-u,-l*h,c*h,0,+h,-l*u,c*u,0,0,c,l,0,0,0,0,1]);var f=scratchMatrix3.setFromMatrix4(t),m=scratchVector3$1.copy(e).applyMatrix3(f).multiplyScalar(-1);t.setPosition(m);var y=scratchMatrix4$2.fromArray([1,0,0,0,0,1,0,0,0,0,1,0,0,0,s,1]);return t.premultiply(y),t}var StencilConstants={TILE_MASK:128,SKIP_LOD_MASK:112,SKIP_LOD_BIT_SHIFT:4},SKIP_BACKFACE_MATERIAL=function(){var e=new MeshBasicMaterial;return e.side=BackSide,e.color.setHex(16711935),e.colorWrite=!1,e.stencilWrite=!0,e.polygonOffset=!0,e.polygonOffsetFactor=2,e.polygonOffsetUnits=2,e.stencilRef=StencilConstants.TILE_MASK,e.stencilFunc=AlwaysStencilFunc,e.stencilFuncMask=StencilConstants.TILE_MASK,e.stencilZPass=ReplaceStencilOp,e.stencilWriteMask=StencilConstants.TILE_MASK,e}(),SKIP_BACKFACE_TRANSPARENT_MATERIAL=function(){var e=new MeshBasicMaterial;return e.visible=!1,e}(),CLEAR_STENCIL_GEOMETRY=new BufferGeometry,CLEAR_STENCIL_MATERIAL=new MeshBasicMaterial,Tile3DModel=function(e){__extends(t,e);function t(r,n,o){var s,l,u,c=e.call(this)||this;return c.modelIndex=0,c.renderObjects=[],c.backfaceObjects=[],c.debugObjects=[],c.tileObjects=[],c.debug="none",c.name=o.name,c.type=o.type,c.light=o.light,c.upAxis=o.upAxis,c.model=r,c.fetcher=o.fetcher,c.search=(s=o.search)!==null&&s!==void 0?s:"",c.groundHeight=o.groundHeight,c.coordinateTransform=o.coordinateTransform,c.boundingBox=new Box3,c.minLevelOfDetail=t.DEFAULT_MIN_LEVEL_OF_DETAIL,c.maxLevelOfDetail=t.DEFAULT_MAX_LEVEL_OF_DETAIL,c.minGeometricError=t.DEFAULT_MIN_GEOMETRIC_ERROR,c.maxGeometricError=t.DEFAULT_MAX_GEOMETRIC_ERROR,c.panoramaMinGeometricError=t.DEFAULT_PANORAMA_MIN_GEOMETRIC_ERROR,c.needsRefined=!0,c.refined=!1,c.refineProgress=[0,0],c.loaded=!1,c.modelsLoaded=!1,c.disposed=!1,c.needsRender=!0,c.lastRenderHash="",c.matrixAutoUpdate=!1,c.cacheCameras=[],c.clearStencilObject=new Mesh(CLEAR_STENCIL_GEOMETRY,CLEAR_STENCIL_MATERIAL),c.clearStencilObject.frustumCulled=!1,c.clearStencilObject.onAfterRender=function(h){return h.clearStencil()},c.tileset=new Tileset((u=(l=c.model.work)===null||l===void 0?void 0:l.workCode)!==null&&u!==void 0?u:"",n,{referer:o.referer,tileLoader:function(h){return c.loadContent(h)},tileUnloader:function(h){return c.unloadContent(h)},onTileLoad:function(){},onTileUnload:function(h){},onTileError:function(h,f){o.onError&&o.onError(Object.assign(f,{error:f})),console.error("Tile error",h.id,f)},trajectoryLoader:function(h){return c.loadTrajectory(h)},trajectoryUnloader:function(h){return c.unloadTrajectory(h)},onTrajectoryLoad:function(){},onTrajectoryUnload:function(h){},onTrajectoryError:function(h,f){o.onError&&o.onError(Object.assign(f,{error:f})),console.error("Trajectory error",h,f)}}),c.tileset.root.boundingVolume&&c.tileset.root.boundingVolume.getBoundingBox(c.boundingBox),c}return t.prototype.getRecommendProps=function(r){var n,o,s;r===void 0&&(r={});var l,u,c,h=128;r.powerPreference==="high"&&(h=512);var f=typeof this.tileset.rootMeta.creationTime=="string";if(f){var m=typeof this.tileset.rootMeta.numTotalPoints=="number"&&this.tileset.rootMeta.numTotalPoints>0;if(m){c=4,r.powerPreference==="high"&&(c=2),l=c/1.6;var y=0;if(((n=this.tileset.rootMeta.taskParameters)===null||n===void 0?void 0:n.point_homogenization)==="1"&&!((o=this.tileset.rootMeta.taskParameters)===null||o===void 0)&&o.homo_point_density){var A=Number((s=this.tileset.rootMeta.taskParameters)===null||s===void 0?void 0:s.homo_point_density);isFinite(A)&&!isNaN(A)&&(y=A)}y<=0&&(y=.02),u=y*1.4}else c=5,r.powerPreference==="high"&&(c=4),l=1,u=.03}else c=6,l=1,u=.03,this.name==="aerophoto"?(c=12,r.powerPreference==="high"&&(c=10)):this.tileset.asset.extras&&typeof this.tileset.asset.extras.name=="string"&&/^matterport\b/i.test(this.tileset.asset.extras.name)&&(c=5,r.powerPreference==="high"&&(c=4));return{pointScale:u,pointMinPixel:l,maxScreenSpaceError:c,maxMemoryUsage:h}},t.prototype.getRenderHash=function(){return jsonHash([this.tileset.id,this.tileset.skipLevelOfDetail,this.tileset.selectedTiles.map(function(r){return r.id}),this.tileset.selectedTrajectories.map(function(r){return r.index}),this.debug])},Object.defineProperty(t.prototype,"maxMemoryUsage",{get:function(){return this.tileset.maxMemoryUsage},set:function(r){this.tileset.maxMemoryUsage=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxRequests",{get:function(){return this.tileset.maxRequests},set:function(r){this.tileset.maxRequests=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"requestOrder",{get:function(){return this.tileset.tileRequestOrder},set:function(r){this.tileset.tileRequestOrder=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skipLevelOfDetail",{get:function(){return this.tileset.skipLevelOfDetail},set:function(r){this.tileset.skipLevelOfDetail=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mostDetail",{get:function(){return this.tileset.mostDetail},set:function(r){this.tileset.mostDetail=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadSiblings",{get:function(){return this.tileset.loadSiblings},set:function(r){this.tileset.loadSiblings=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadAll",{get:function(){return this.tileset.loadAll},set:function(r){this.tileset.loadAll=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScreenSpaceError",{get:function(){return this.tileset.maxScreenSpaceError},set:function(r){this.tileset.maxScreenSpaceError=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentMaxScreenSpaceError",{get:function(){return this.tileset.currentMaxScreenSpaceError},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trajectories",{get:function(){return this.tileset.trajectories},enumerable:!1,configurable:!0}),t.prototype.localToEnu=function(r){return r.applyMatrix4(this.coordinateTransform.localToEnuMatrix)},t.prototype.enuToLocal=function(r){return r.applyMatrix4(this.coordinateTransform.enuToLocalMatrix)},t.prototype.localToEcef=function(r){return r.applyMatrix4(this.coordinateTransform.localToEcefMatrix)},t.prototype.ecefToLocal=function(r){return r.applyMatrix4(this.coordinateTransform.ecefToLocalMatrix)},t.prototype.localToLla=function(r){return ecefToLla(this.localToEcef(r))},t.prototype.llaToLocal=function(r){return this.ecefToLocal(llaToEcef(r))},t.prototype.worldToEnu=function(r){return this.localToEnu(this.worldToLocal(r))},t.prototype.enuToWorld=function(r){return this.localToWorld(this.enuToLocal(r))},t.prototype.worldToEcef=function(r){return this.localToEcef(this.worldToLocal(r))},t.prototype.ecefToWorld=function(r){return this.localToWorld(this.ecefToLocal(r))},t.prototype.worldToLla=function(r){return this.localToLla(this.worldToLocal(r))},t.prototype.llaToWorld=function(r){return this.localToWorld(this.llaToLocal(r))},t.prototype.loadContent=function(r){var n=this;return loadTileContent(r,{light:this.light,fetcher:this.fetcher,search:this.search,renderer:this.renderer}).then(function(o){r.type==="SCENEGRAPH"&&(n.disposed||!r.content?unloadTileContent(r):r.content.data&&n.boundingBox.expandByObject(r.content.data.object))})},t.prototype.unloadContent=function(r){return unloadTileContent(r),Promise.resolve()},t.prototype.loadAllTilesets=function(){var r=this,n=function(o){var s=[];return r.tileset.root.traverse(function(l){var u;l.type==="TILESET"&&((u=l.content)===null||u===void 0?void 0:u.loadState)!=="READY"&&s.push(l)}),Promise.all(s.map(function(l){return r.loadContent(l).then(function(){return n()})})).then(function(){})};return n(this.tileset.root)},t.prototype.loadTrajectory=function(r){var n=this;return loadTrajectory(r,{fetcher:this.fetcher,search:this.search,renderer:this.renderer}).then(function(o){n.disposed&&unloadTrajectory(o)})},t.prototype.unloadTrajectory=function(r){return unloadTrajectory(r),Promise.resolve()},t.prototype.intersectRaycaster=function(r,n,o){var s=this;n===void 0&&(n=!0),o===void 0&&(o=[]);for(var l=[this.tileset.root],u=this.tileset.transform,c=this.tileset.transformIsIdentity,h,f=[];h=l.pop();){var m=void 0;if(h.boundingVolume){var y=c?h.boundingVolume:h.boundingVolume.clone().applyMatrix4(u);m=y.intersectRay(r.ray,r.far)}else m=!0;if(m){for(var A=0,M=h.children.length;A<M;A++)l.push(h.children[A]);h.selected&&h.content&&h.content.data&&h.content.data.object.visible&&h.content.data.object.intersectRaycaster(r,!1,f)}}return this.model.shownFloorIndex>=0&&(f=f.filter(function(b){return b.floor===s.model.shownFloorIndex})),n&&f.sort(function(b,T){return b.distance-T.distance}),f.map(function(b){b.model=s.model,b.viewLayer=s.viewLayer}),o.push.apply(o,f),o},t.prototype.cloneSkipBackfaceObject=function(r){var n;r instanceof Mesh?n=new Mesh(r.geometry,Array.isArray(r.material)?r.material.map(function(u){return u.transparent?SKIP_BACKFACE_TRANSPARENT_MATERIAL:SKIP_BACKFACE_MATERIAL}):r.material&&r.material.transparent?SKIP_BACKFACE_TRANSPARENT_MATERIAL:SKIP_BACKFACE_MATERIAL):r instanceof Group?n=new Group:n=new Object3D,n.copy(r,!1);for(var o=0,s=r.children;o<s.length;o++){var l=s[o];n.add(this.cloneSkipBackfaceObject(l))}return n},t.prototype.update=function(r,n,o){var s,l,u,c=this,h,f,m;this.renderObjects.length=0,this.backfaceObjects.length=0,this.debugObjects.length=0,this.tileObjects.length=0,this.renderer=r,this.updateMatrixWorld(!0),this.tileset.transform.equals(this.matrixWorld)||this.tileset.transform.copy(this.matrixWorld),this.tileset.cache.reset();var y=this.tileset.frameNumber+1,A=this.maxLevelOfDetail;A=Math.max(A,0);var M=Math.min(this.minLevelOfDetail,A);(!this.visible||!this.loaded||!this.modelsLoaded)&&(A=Math.max(M,0));var b=this.minGeometricError,T=this.maxGeometricError;if(T=Math.max(b,T),o==="Panorama"||o==="VRPanorama"||o==="XRPanorama"){var _=this.model.getMaterial().modelAlpha;_<.1&&(b=this.panoramaMinGeometricError)}var S={time:now(),camera:{type:n.type,position:new Vector3().copy(n.position),direction:n.getDirection(new Vector3),up:new Vector3().copy(n.up).applyQuaternion(n.quaternion),projectionMatrix:n.projectionMatrix.clone(),visible:n.visible,refine:n.refineModel},minLevelOfDetail:M,maxLevelOfDetail:A,minGeometricError:b,maxGeometricError:T,height:n.resolution.height,pixelRatio:n.pixelRatio,frameNumber:y,sseDenominator:2*Math.tan(.5*n.fov/180*Math.PI),cullingVolume:new CullingVolume().setFromCamera(n)},C=this.cacheCameras.map(function(Se){return Se.updateProjectionMatrix(),__assign(__assign({},S),{camera:{type:n.type,position:new Vector3().copy(Se.position),direction:Se.getWorldDirection(new Vector3),up:new Vector3().copy(Se.up),projectionMatrix:Se.projectionMatrix.clone(),visible:Se.visible,refine:!0},cullingVolume:new CullingVolume().setFromCamera(Se)})});if(this.needsRefined&&this.tileset.update(S,C),this.refined=!0,this.refineProgress[0]=0,this.refineProgress[1]=0,this.tileset.needsRefinedTiles.forEach(function(Se){if(c.refineProgress[1]++,Se.content){var we=Se.content.loadState;if(we==="UNLOADED"||we==="LOADING"){c.refined=!1;return}}c.refineProgress[0]++}),this.loaded===!1&&this.needsRefined){this.loaded=!0;var P=!1;this.tileset.needsRefinedTiles.forEach(function(Se){if(c.loaded!==!1&&Se.content){if(P=!0,c.tileset.skipLevelOfDetail){if(Se.state.finalResolution){var we=Se.state.ancestorWithContentAvailable,Ve=we&&we.content?we.content:Se.content,je=Ve.loadState;(je==="UNLOADED"||je==="LOADING")&&(c.loaded=!1)}}else if(Se.state.visible&&Se.levelOfContent<=0){var je=Se.content.loadState;(je==="UNLOADED"||je==="LOADING")&&(c.loaded=!1)}}}),P&&this.tileset.selectedTiles.length===0&&(this.loaded=!1),this.loaded===!0&&(this.refined=!1,this.refineProgress[1]++)}this.remove.apply(this,this.children),this.tileset.skipLevelOfDetail||this.tileset.selectedTiles.sort(function(Se,we){return Se.floor!==we.floor?Se.floor-we.floor:Se.levelOfContent!==we.levelOfContent?we.levelOfContent-Se.levelOfContent:Se.state.distanceToCamera!==we.state.distanceToCamera?Se.state.distanceToCamera-we.state.distanceToCamera:Se.state.centerZDepth-we.state.centerZDepth}),this.debug==="root-bounding-volume"&&this.tileset.root.boundingVolumeDebugObject&&this.debugObjects.push(this.tileset.root.boundingVolumeDebugObject);for(var F=0,O=this.tileset.selectedTiles;F<O.length;F++){var N=O[F];this.debug==="selected-bounding-volume"&&N.boundingVolumeDebugObject&&this.debugObjects.push(N.boundingVolumeDebugObject);var V=(f=(h=N.content)===null||h===void 0?void 0:h.data)===null||f===void 0?void 0:f.object;if(V){if(V.update(r,n,this.model,N),this.tileset.hasMixedContent&&this.tileset.skipLevelOfDetail){if(!N.state.finalResolution){var q=this.cloneSkipBackfaceObject(V);this.backfaceObjects.push(q)}for(var Q=N.state.selectionDepth,z=StencilConstants.TILE_MASK|Q<<StencilConstants.SKIP_LOD_BIT_SHIFT,H=GreaterEqualStencilFunc,W=StencilConstants.SKIP_LOD_MASK,J=ReplaceStencilOp,G=StencilConstants.TILE_MASK|StencilConstants.SKIP_LOD_MASK,te=0,X=V.materials;te<X.length;te++){var K=X[te];K.stencilWrite=!0,K.stencilRef=z,K.stencilFunc=H,K.stencilFuncMask=W,K.stencilZPass=J,K.stencilWriteMask=G}}else for(var Z=0,ee=V.materials;Z<ee.length;Z++){var K=ee[Z];K.stencilWrite=!1,K.stencilRef=StencilConstants.TILE_MASK,K.stencilFunc=AlwaysStencilFunc,K.stencilFuncMask=StencilConstants.TILE_MASK,K.stencilZPass=ReplaceStencilOp,K.stencilWriteMask=StencilConstants.TILE_MASK}this.tileObjects.push(V)}}this.tileset.skipLevelOfDetail&&this.backfaceObjects.length&&(s=this.renderObjects).push.apply(s,this.backfaceObjects),this.tileObjects.length&&(l=this.renderObjects).push.apply(l,this.tileObjects),this.tileset.skipLevelOfDetail&&this.renderObjects.push(this.clearStencilObject);for(var j=0,re=this.tileset.selectedTrajectories;j<re.length;j++){var pe=re[j],ge=(m=pe.content.data)===null||m===void 0?void 0:m.object;ge&&(ge.update(r,n,this.model),this.renderObjects.push(ge))}this.debug&&(u=this.renderObjects).push.apply(u,this.debugObjects);for(var _e=this.modelIndex*1e4,he=function(Se){var we=Fe.renderObjects[Se],Ve=Se+_e;we.traverse(function(je){(je instanceof Mesh||je instanceof Line||je instanceof Points)&&(je.renderOrder=Ve)}),Fe.add(we)},Fe=this,Re=0;Re<this.renderObjects.length;Re++)he(Re);var Le=this.getRenderHash();this.lastRenderHash!==Le&&(this.needsRender=!0,this.lastRenderHash=Le)},t.prototype.dispose=function(){this.disposed=!0,this.viewLayer=void 0,this.tileset.reset(),this.remove.apply(this,this.children),this.refineProgress[0]=0,this.refineProgress[1]=0,this.refined=!1,this.loaded=!1},t.DEFAULT_PANORAMA_MIN_GEOMETRIC_ERROR=1,t.DEFAULT_MIN_LEVEL_OF_DETAIL=0,t.DEFAULT_MAX_LEVEL_OF_DETAIL=20,t.DEFAULT_MIN_GEOMETRIC_ERROR=0,t.DEFAULT_MAX_GEOMETRIC_ERROR=1e4,t.DEFAULT_MAX_MEMORY_USAGE=16,t.DEFAULT_MAX_SCREEN_SPACE_ERROR=Tileset.DEFAULT_MAX_SCREEN_SPACE_ERROR,t.DEFAULT_SKIP_LEVEL_OF_DETAIL=Tileset.DEFAULT_SKIP_LEVEL_OF_DETAIL,t.DEFAULT_MOST_DETAIL=Tileset.DEFAULT_MOST_DETAIL,t.DEFAULT_LOAD_SIBLINGS=Tileset.DEFAULT_LOAD_SIBLINGS,t.DEFAULT_LOAD_ALL=Tileset.DEFAULT_LOAD_ALL,t.DEFAULT_MAX_REQUESTS=Tileset.DEFAULT_MAX_REQUESTS,t.DEFAULT_REQUEST_ORDER=Tileset.DEFAULT_REQUEST_ORDER,t}(Object3D);function headingToLongitude(e){return-((e-.25)*360+90)/180*Math.PI}function equal(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,o;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!equal(e[n],t[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(o=Object.keys(e),r=o.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[n]))return!1;for(n=r;n--!==0;){var s=o[n];if(!equal(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}function isNumber(e){return typeof e=="number"}function S4(){return((1+Math.random())*65536|0).toString(16).substring(1)}function createUuid(){return(S4()+S4()+"-"+S4()+"-4"+S4().substr(0,3)+"-"+S4()+"-"+S4()+S4()+S4()).toLowerCase()}var error_invalid_input=function(){return new Error("Invalid input.")},error_invalid_certificate=function(){return new Error("Invalid certificate.")},error_invalid_signature=function(){return new Error("Invalid signature.")},error_date_expired=function(e){return new Error("date(".concat(e.toString(),") expired."))},error_host_not_allowed=function(e){return new Error("host(".concat(JSON.stringify(e),") is not allowed."))};function ObjectOmit(e,t){for(var r={},n=0,o=Object.keys(e);n<o.length;n++){var s=o[n];t.indexOf(s)===-1&&(r[s]=e[s])}return r}function jsonStableNoneNumberStrinfiy_(e,t){t===void 0&&(t=!1);var r=typeof e;if(r==="string")return JSON.stringify(e);if(e===!0)return"true";if(e===!1)return"false";if(e===null)return"null";if(e instanceof Array){for(var n="[",o=e.length-1,s=0;s<o;s++)n+=jsonStableNoneNumberStrinfiy_(e[s],!1)+",";return o>-1&&(n+=jsonStableNoneNumberStrinfiy_(e[s],!1)),n+"]"}if(e instanceof Object){if(typeof e.toJSON=="function")return jsonStableNoneNumberStrinfiy_(e.toJSON(),t);for(var l=Object.keys(e).sort(),u=l.length,n="",s=0;s<u;){var c=l[s],h=jsonStableNoneNumberStrinfiy_(e[c],!0);h!==void 0&&(s&&n!==""&&(n+=","),n+=JSON.stringify(c)+":"+h),s++}return"{"+n+"}"}switch(r){case"function":case"undefined":return t?void 0:null;case"number":return 0;default:return isFinite(e)?e:null}}function jsonStableNoneNumberStrinfiy(e){return String(jsonStableNoneNumberStrinfiy_(e,!1))}function verify(e){var t,r,n;if(Array.isArray(e)){var o=void 0,s,l;if(e.length<=0)return error_invalid_input();for(var u=function(F){var O=verify(e[F]);if(O instanceof Error)return{value:O};if(!o)o=O.issuer;else if(o!==O.issuer)return{value:error_invalid_certificate()};s?O.expire.getTime()<s.getTime()&&(s=O.expire):s=O.expire,l?l=l.filter(function(N){return O.allowHosts.indexOf(N)!==-1}):l=O.allowHosts},c=0;c<e.length;c++){var h=u(c);if(typeof h=="object")return h.value}return deepFreeze({issuer:o,expire:s,allowHosts:l})}var f=JSON.parse(e),m=typeof location<"u"?location.hostname:"",y=Date.now();if(typeof f!="object")return error_invalid_input();var A=new Date(typeof f.expire_at=="string"&&/^\d+$/.test(f.expire_at)?Number(f.expire_at):f.expire_at),M=Array.isArray(f.allow_hosts)?f.allow_hosts:[];if(m.length===0||isIPDomain(m)||BUILDIN_ALLOW_HOST.filter(function(F){return matchDomain(F,m)}).length>0){var b=String((t=f.certificate)!==null&&t!==void 0?t:"");if(b){var T=new X509;return T.readCertPEM(b),deepFreeze({issuer:T.getSubjectString(),expire:A,allowHosts:M})}return deepFreeze({issuer:"none",expire:A,allowHosts:M})}var _=String((r=f.certificate)!==null&&r!==void 0?r:"");if(!_)return error_invalid_certificate();var S=new X509;S.readCertPEM(_);var C=String((n=f._signature)!==null&&n!==void 0?n:"");if(!C)return error_invalid_signature();var P=jsonStableNoneNumberStrinfiy(ObjectOmit(f,["_signature"]));return verifyMessage(P,C,S)===!1?error_invalid_signature():y<A.getTime()?M.filter(function(F){return matchDomain(F,m)}).length===0?error_host_not_allowed(m):deepFreeze({issuer:S.getSubjectString(),expire:A,allowHosts:M}):error_date_expired(A)}var scratchMatrix4$1=new Matrix4,workRawMapping=new WeakMap,needsUpdateWorkCodeSet=new Set,Work=function(){function e(t,r){this.name="",this.baseURL="",this.workCode="",this.expire=new Date,this.allowHosts=[],this.initial={work:this},this.observers=[],this.issuer="none",this.raw={works:[""],options:""},this.transform=new Matrix4;{var n=this;this.options={get transform(){return n.transform},set transform(s){n.transform.copy(s)}}}if(t!==null)if("up"in t&&typeof t.up=="string"&&"down"in t&&typeof t.down=="string"&&"right"in t&&typeof t.right=="string"&&"left"in t&&typeof t.left=="string"&&"front"in t&&typeof t.front=="string"&&"back"in t&&typeof t.back=="string"&&"size"in t&&typeof t.size=="number")parsePanoWork(t,this);else{var o=parse(t,r,this);if(o instanceof Error)throw new Error("[PARSE FAILED]: "+o.message+`
Error work input:
`+JSON.stringify(t))}else parseNull(t,this)}return e.prototype.toJSON=function(){return this.raw},e.parse=parseWork,e}();function getType(e){return e==null?"null":Array.isArray(e)?"array":typeof e=="object"?"dict":"value"}function deepMerge(e,t){var r=getType(e),n=getType(t);if(n==="null")return e;if(n==="value")return t;if(n!==r)return JSON.parse(JSON.stringify(t));if(n==="array")for(var o=0;o<t.length;o++)e[o]=deepMerge(e[o],t[o]);else if(n==="dict")for(var s in t)e[s]=deepMerge(e[s],t[s]);return e}function startWithString(e,t){return e.indexOf(t)===0}function urlWithParseOptions(e,t,r,n){var o,s=t;if(n.jsonp===!0){s=t.replace(/([\?\#].*)?$/i,"");var l=sha256("".concat(s)).slice(0,7);s="".concat(s,".").concat(l,".jsonp")}if(n.shortPath===!0){var u=s.replace(e,"").split("."),c=(o=u.shift())!==null&&o!==void 0?o:"",h=u.join(".");s=pathJoin(e,sha256(c))+(h?"."+h:"")}var f=s.replace(e,"");return n.baseURL&&(s=pathJoin(n.baseURL,f)),n.traverseResource&&n.traverseResource({origin:t,absolute:s,relative:f,type:r}),s}function panoURL(e,t,r,n,o){var s=r;return isAbsoluteURL(r)||(t&&(t=pathJoin(t,String(n))),s=pathJoin(t,s)),isAbsoluteURL(s)||(s=pathJoin(e,s)),startWithString(s,e)||console.warn("".concat(s," is not start with base_url(").concat(e,").")),urlWithParseOptions(e,s,"panorama",o)}function fileURL(e,t,r){var n=t;return isAbsoluteURL(n)||(n=pathJoin(e,t)),startWithString(n,e)||console.warn("".concat(n," is not start with base_url(").concat(e,").")),urlWithParseOptions(e,n,"model",r)}function textureURL$1(e,t,r,n){var o=t;return isAbsoluteURL(o)||(o=pathJoin(r,o)),isAbsoluteURL(o)||(o=pathJoin(e,o)),startWithString(o,e)||console.warn("".concat(o," is not start with base_url(").concat(e,").")),urlWithParseOptions(e,o,"texture",n)}var getTileLevel=function(e){for(var t=10;t>=0;t--){var r=512*Math.pow(2,t);if(r<=e)return t}return null},sortTile=function(e){e=e.slice().sort(function(l,u){return l.level-u.level});for(var t=[],r=0,n=e;r<n.length;r++){var o=n[r];if(t.length===0){t.push(o);continue}var s=t[t.length-1];if(o.level>s.level){t.push(o);continue}if(o.size>s.size){t[t.length-1]=o;continue}}return t};function parse(e,t,r){for(var n,o,s,l,u,c,h,f,m,y,A,M,b,T,_,S,C,P,F,O,N=JSON.stringify(t),V=[],q=0,Q=[].concat(e);q<Q.length;q++){var z=Q[q];z instanceof Work?V.push.apply(V,z.raw.works):typeof z=="string"?V.push(z):V.push(JSON.stringify(z))}var H=verify(V);if(H instanceof Error)return H;Array.isArray(t.transform)?r.transform.fromArray(t.transform):t.transform&&r.transform.copy(t.transform),e=V.map(function(Me){return JSON.parse(Me)}).reduce(function(Me,De){return deepMerge(Me,De)}),Object.defineProperty(r,"raw",{configurable:!1,get:function(){return{works:V,options:N}}});{var W;if(t.workCode&&(typeof t.workCode=="string"?W=t.workCode:typeof t.workCode=="function"&&(W=t.workCode(e))),typeof W>"u"&&(W=String(e.resource_code||e.basic_code||e.vr_code||e.code||e.project_id||e.work_code||e.workCode)),typeof W>"u")return new Error("WorkCode never matched.");Object.defineProperty(r,"workCode",{configurable:!1,get:function(){return W}})}{var J=String(e.name);Object.defineProperty(r,"name",{configurable:!1,get:function(){return J}})}if(H instanceof Error)return H;Object.defineProperty(r,"issuer",{configurable:!1,get:function(){return H.issuer}}),Object.defineProperty(r,"expire",{configurable:!1,get:function(){return H.expire}}),Object.defineProperty(r,"allowHosts",{configurable:!1,get:function(){return H.allowHosts}});var G=(n=e.base_url)!==null&&n!==void 0?n:"";if(G&&G[G.length-1]!=="/"&&(G+="/"),r.baseURL=(o=t.baseURL)!==null&&o!==void 0?o:G,H instanceof Error)return H;if(e.model){var te={work:r,layers:[]},X;e.model.file?X=fileURL(G,e.model.file,t):e.model.file_url&&(X=fileURL(G,e.model.file_url,t)),Object.defineProperty(te,"file",{configurable:!1,get:function(){return X}});var K;e.model.textureBase?K=textureURL$1(G,"",e.model.textureBase,t):e.model.material_base_url?K=textureURL$1(G,"",e.model.material_base_url,t):te.file&&(K=te.file.split("/").slice(0,-1).join("/").replace("/model/","/materials/")),Object.defineProperty(te,"textureBase",{configurable:!1,get:function(){return K}});var Z;Array.isArray(e.model.textures)?(Z=e.model.textures.map(function(Me){var De,be;return textureURL$1(G,Me,(be=(De=e.model.textureBase)!==null&&De!==void 0?De:e.model.material_base_url)!==null&&be!==void 0?be:"",t)}),Object.freeze(Z)):Array.isArray(e.model.material_textures)&&(Z=e.model.material_textures.map(function(Me){var De,be;return textureURL$1(G,Me,(be=(De=e.model.textureBase)!==null&&De!==void 0?De:e.model.material_base_url)!==null&&be!==void 0?be:"",t)}),Object.freeze(Z)),Object.defineProperty(te,"textures",{configurable:!1,get:function(){return Z}});var ee=[];if(Array.isArray(e.model.tiles))for(var j=0,re=e.model.tiles;j<re.length;j++){var pe=re[j];pe&&(pe.tileset||pe.tileset_url)&&ee.push(Object.freeze({type:(s=pe.type)!==null&&s!==void 0?s:"mesh",name:(l=pe.name)!==null&&l!==void 0?l:"",upAxis:(c=(u=pe.upAxis)!==null&&u!==void 0?u:pe.up_axis)!==null&&c!==void 0?c:"-Y",tileset:fileURL(G,pe.tileset||pe.tileset_url,t)}))}else e.model.tiles&&(e.model.tiles.tileset||e.model.tiles.tileset_url)&&ee.push(Object.freeze({type:(h=e.model.tiles.type)!==null&&h!==void 0?h:"mesh",name:(f=e.model.tiles.name)!==null&&f!==void 0?f:"lod",upAxis:(y=(m=e.model.tiles.upAxis)!==null&&m!==void 0?m:e.model.tiles.up_axis)!==null&&y!==void 0?y:"-Y",tileset:fileURL(G,e.model.tiles.tileset||e.model.tiles.tileset_url,t)}));if(Array.isArray(e.model.layers))for(var ge=0,_e=e.model.layers;ge<_e.length;ge++){var he=_e[ge];he&&(he.tileset||he.tileset_url)&&ee.push(Object.freeze({type:(A=he.type)!==null&&A!==void 0?A:"mesh",name:(M=he.name)!==null&&M!==void 0?M:"",upAxis:(b=he.upAxis)!==null&&b!==void 0?b:he.up_axis,tileset:fileURL(G,he.tileset||he.tileset_url,t)}))}Object.freeze(ee),Object.defineProperty(te,"layers",{configurable:!1,get:function(){return ee}}),Object.defineProperty(r,"model",{configurable:!1,get:function(){if(te.file||te.layers.length)return te}})}if(H instanceof Error)return H;var Fe=new Set,Re=new Set;{var Le=[];if(e.observers&&Array.isArray(e.observers)){var Se=[];e.panorama&&(Array.isArray(e.panorama)?Se=e.panorama:Array.isArray(e.panorama.list)?Se=e.panorama.list:Array.isArray(e.panorama.info)&&(Se=e.panorama.info));for(var we=function(Me){var De={},be=e.observers[Me];if(!be)return"break";var ze=Se[Me];if(!ze)return"break";be=Object.assign({},be,ze,{active:be.active!==!1&&ze.active!==!1}),Object.defineProperty(De,"work",{configurable:!1,get:function(){return r}}),Object.defineProperty(De,"index",{configurable:!1,get:function(){return Me}}),Re.add(Me),Object.defineProperty(De,"panoIndex",{configurable:!1,get:function(){return Me}});var at=panoStringify({workCode:r.workCode,panoIndex:Me});Fe.add(at),Object.defineProperty(De,"panoId",{configurable:!1,get:function(){return at}});var ot=Object.freeze({workCode:r.workCode,panoIndex:Me});Object.defineProperty(De,"pano",{configurable:!1,get:function(){return ot}});var nt=be.active!==!1;Object.defineProperty(De,"active",{configurable:!1,get:function(){return nt}});var Ue=be.loadable===!0;Object.defineProperty(De,"loadable",{configurable:!1,get:function(){return Ue}});var He=be.derived_id;Object.defineProperty(De,"derivedId",{configurable:!1,get:function(){return He}});var qe=be.derived_id_str;Object.defineProperty(De,"derivedIdStr",{configurable:!1,get:function(){return qe}});var ke=(F=(C=(_=(T=e.panorama)===null||T===void 0?void 0:T.pano_high_cube_base_url)!==null&&_!==void 0?_:(S=e.panorama)===null||S===void 0?void 0:S.pano_cube_base_url)!==null&&C!==void 0?C:(P=e.panorama)===null||P===void 0?void 0:P.base_url)!==null&&F!==void 0?F:"",ve={up:panoURL(G,ke,be.images?be.images.up:be.up,Me,t),down:panoURL(G,ke,be.images?be.images.down:be.down,Me,t),right:panoURL(G,ke,be.images?be.images.right:be.right,Me,t),left:panoURL(G,ke,be.images?be.images.left:be.left,Me,t),front:panoURL(G,ke,be.images?be.images.front:be.front,Me,t),back:panoURL(G,ke,be.images?be.images.back:be.back,Me,t)};if(be.size_list)ve.sizeList=be.size_list.slice();else{var Ye=getImageSizeFromURL(ve.up);if(Ye&&(ve.sizeList=[Ye],be.tiles))for(var tt=be.tiles.slice().sort(function(Et,jt){return Et-jt}).map(function(Et){return 512*Math.pow(2,Et)}),xt=0,Ze=tt;xt<Ze.length;xt++){var lt=Ze[xt];lt>Ye&&ve.sizeList.push(lt)}}var Pt=be.images?be.images.luminance:be.luminance;Pt&&(ve.luminance=Object.freeze({up:panoURL(G,ke,Pt.up,Me,t),down:panoURL(G,ke,Pt.down,Me,t),right:panoURL(G,ke,Pt.right,Me,t),left:panoURL(G,ke,Pt.left,Me,t),front:panoURL(G,ke,Pt.front,Me,t),back:panoURL(G,ke,Pt.back,Me,t)}));var Lt=void 0;if(be.images)Lt=be.images.tiles;else if(Array.isArray(be.size_list)){var Gt=be.size_list.slice().sort(function(Et,jt){return Et-jt});if(Gt[0]){var Rt=getTileLevel(Gt[0]);if(Rt)for(var Ft=Rt-1;Ft>=0;Ft--)Gt.unshift(512*Math.pow(2,Ft));Lt=Gt}}else if(Array.isArray(be.tiles)&&(Lt=be.tiles.slice(),typeof Lt[0]=="number")){for(var Nt=Lt[0];--Nt>=0;)Lt.unshift(Nt);Lt=Lt.sort(function(Et,jt){return Et-jt}).map(function(Et){return 512*Math.pow(2,Et)})}if(Lt){for(var Ht=[],or=0,Xt=Lt;or<Xt.length;or++){var lt=Xt[or];if(typeof lt=="number"){var Zt=getTileLevel(lt);if(typeof Zt!="number")continue;var ae=getImageSizeFromURL(ve.front);if(!ae)continue;if(lt>ae){var Pe=replaceImageSize(ve.up,lt),Te=replaceImageSize(ve.down,lt),Ne=replaceImageSize(ve.right,lt),it=replaceImageSize(ve.left,lt),ft=replaceImageSize(ve.front,lt),gt=replaceImageSize(ve.back,lt);Ht.push(Object.freeze({level:Zt,size:lt,scale:1,up:Pe,down:Te,right:Ne,left:it,front:ft,back:gt}))}else{var Pe=ve.up,Te=ve.down,Ne=ve.right,it=ve.left,ft=ve.front,gt=ve.back;Ht.push(Object.freeze({level:Zt,size:ae,scale:lt/ae,up:Pe,down:Te,right:Ne,left:it,front:ft,back:gt}))}}else{var Zt=lt.level;if(typeof Zt!="number")continue;var Ye=lt.size;if(typeof Ye!="number")continue;var Pe=panoURL(G,ke,lt.up,Me,t),Te=panoURL(G,ke,lt.down,Me,t),Ne=panoURL(G,ke,lt.right,Me,t),it=panoURL(G,ke,lt.left,Me,t),ft=panoURL(G,ke,lt.front,Me,t),gt=panoURL(G,ke,lt.back,Me,t);Ht.push(Object.freeze({level:Zt,size:Ye,scale:(O=lt.scale)!==null&&O!==void 0?O:1,up:Pe,down:Te,right:Ne,left:it,front:ft,back:gt}))}}Ht=sortTile(Ht),Object.freeze(Ht),Object.defineProperty(ve,"tiles",{configurable:!1,get:function(){return Ht}})}Object.freeze(ve),Object.defineProperty(De,"images",{configurable:!1,get:function(){return ve}});var ut=new Vector3;if(be.position instanceof Vector3)ut.copy(be.position);else if(Array.isArray(be.position))ut.fromArray(be.position);else return"break";Object.freeze(ut),Object.defineProperty(De,"position",{configurable:!1,get:function(){return ut}});var vt=new Vector3;if(be.standingPosition instanceof Vector3)vt.copy(be.standingPosition);else if(Array.isArray(be.standingPosition))vt.fromArray(be.standingPosition);else if(be.standing_position instanceof Vector3)vt.copy(be.standing_position);else if(Array.isArray(be.standing_position))vt.fromArray(be.standing_position);else return"break";Object.freeze(vt),Object.defineProperty(De,"standingPosition",{configurable:!1,get:function(){return vt}});var yt=new Quaternion;if(be.quaternion instanceof Quaternion)yt.copy(be.quaternion);else if(Array.isArray(be.quaternion))yt.fromArray(be.quaternion);else if(be.quaternion){var Ot=be.quaternion,It=Ot.x,Tt=Ot.y,ht=Ot.z,St=Ot.w;yt.set(It,Tt,ht,St)}else return"break";Object.freeze(yt),Object.defineProperty(De,"quaternion",{configurable:!1,get:function(){return yt}});var zt=0;isNumber(be.floorIndex)?zt=be.floorIndex:isNumber(be.floor_index)?zt=be.floor_index:isNumber(be.floor)&&(zt=be.floor),Object.defineProperty(De,"floorIndex",{configurable:!1,get:function(){return zt}});var Dt;be.video&&(Dt={},typeof be.video.source=="string"&&(Dt.source=be.video.source),be.video.matrix instanceof Matrix4?Dt.matrix=be.video.matrix.clone():Array.isArray(be.video.matrix)&&(Dt.matrix=new Matrix4().fromArray(be.video.matrix)),be.video.size instanceof Vector2?Dt.size=be.video.size.clone():Array.isArray(be.video.size)&&(Dt.size=new Vector2().fromArray(be.video.size)),Dt.source&&Dt.matrix&&Dt.size&&(De.video=Dt)),Object.freeze(Dt),Object.defineProperty(De,"video",{configurable:!1,get:function(){return Dt}}),Array.isArray(be.accessibleNodes)?(De.accessibleNodes=be.accessibleNodes.slice(),De.accessibleIds=be.accessibleNodes.map(function(Et){return panoStringify({workCode:r.workCode,panoIndex:Et})})):Array.isArray(be.accessible_nodes)&&(De.accessibleNodes=be.accessible_nodes.slice(),De.accessibleIds=be.accessible_nodes.map(function(Et){return panoStringify({workCode:r.workCode,panoIndex:Et})})),Array.isArray(be.visibleNodes)?(De.visibleNodes=be.visibleNodes.slice(),De.visibleIds=be.visibleNodes.map(function(Et){return panoStringify({workCode:r.workCode,panoIndex:Et})})):Array.isArray(be.visible_nodes)&&(De.visibleNodes=be.visible_nodes.slice(),De.visibleIds=be.visible_nodes.map(function(Et){return panoStringify({workCode:r.workCode,panoIndex:Et})})),Le[Me]=De},Ve=0;Ve<e.observers.length;Ve++){var je=we(Ve);if(je==="break")break}}for(var st=function(Me){if(Me.accessibleIds){var De=Me.accessibleIds.filter(function(ke){return Fe.has(ke)});Object.freeze(De),Object.defineProperty(Me,"accessibleIds",{configurable:!1,get:function(){return De}})}else{for(var be=[],ze=0;ze<Le.length;ze++)Le[ze]!==Me&&(Math.abs(Le[ze].position.y-Me.position.y)>3||Le[ze].position.distanceTo(Me.position)>10||be.push(Le[ze].panoId));Object.freeze(be),Object.defineProperty(Me,"accessibleIds",{configurable:!1,get:function(){return be}})}if(Me.accessibleNodes){var at=Me.accessibleNodes.filter(function(ke){return Re.has(ke)});Object.freeze(at),Object.defineProperty(Me,"accessibleNodes",{configurable:!1,get:function(){return at}})}else{for(var ot=[],ze=0;ze<Le.length;ze++)Le[ze]!==Me&&(Math.abs(Le[ze].position.y-Me.position.y)>3||Le[ze].position.distanceTo(Me.position)>10||ot.push(Le[ze].panoIndex));Object.freeze(ot),Object.defineProperty(Me,"accessibleNodes",{configurable:!1,get:function(){return ot}})}if(Me.visibleIds){var nt=Me.visibleIds.filter(function(ke){return Fe.has(ke)});Object.freeze(nt),Object.defineProperty(Me,"visibleIds",{configurable:!1,get:function(){return nt}})}else{var Ue=Me.accessibleIds.slice();Object.freeze(Ue),Object.defineProperty(Me,"visibleIds",{configurable:!1,get:function(){return Ue}})}if(Me.visibleNodes){var He=Me.visibleNodes.filter(function(ke){return Re.has(ke)});Object.freeze(He),Object.defineProperty(Me,"visibleNodes",{configurable:!1,get:function(){return He}})}else{var qe=Me.accessibleNodes.slice();Object.freeze(qe),Object.defineProperty(Me,"visibleNodes",{configurable:!1,get:function(){return qe}})}},We=0,bt=Le;We<bt.length;We++){var oe=bt[We];st(oe)}Object.freeze(Le),Object.defineProperty(r,"observers",{configurable:!1,get:function(){return Le}})}if(H instanceof Error)return H;if(e.initial){if((e.initial.mode==="Panorama"&&r.observers.length===0||e.initial.mode==="Floorplan"||e.initial.mode==="Topview"||e.initial.mode==="Model"||e.initial.mode==="Mapview"||e.initial.mode==="DepthPanorama")&&(r.initial.mode=e.initial.mode),isNumber(e.initial.latitude)&&(r.initial.latitude=e.initial.latitude),isNumber(e.initial.longitude)?r.initial.longitude=e.initial.longitude:isNumber(e.initial.heading)&&(r.initial.longitude=headingToLongitude(e.initial.heading)),isNumber(e.initial.fov)&&(r.initial.fov=e.initial.fov),r.observers.length>0){var ue=void 0;isNumber(e.initial.panoIndex)?ue=e.initial.panoIndex:isNumber(e.initial.pano_index)?ue=e.initial.pano_index:isNumber(e.initial.pano)&&(ue=e.initial.pano),typeof ue=="number"&&(ue=clamp$1(ue,0,r.observers.length-1),r.initial.panoIndex=ue)}if(isNumber(e.initial.distance)&&(r.initial.distance=e.initial.distance),Array.isArray(e.initial.offset)){var Qe=[0,0,0].map(function(Me,De){var be=Number(e.initial.offset[De]);return isNaN(be)||!isFinite(be)?0:be});r.initial.offset=new Vector3().fromArray(Qe)}else typeof e.initial.offset=="object"&&typeof e.initial.offset.x=="number"&&typeof e.initial.offset.y=="number"&&typeof e.initial.offset.z=="number"&&(r.initial.offset=new Vector3(e.initial.offset.x,e.initial.offset.y,e.initial.offset.z));!r.initial.mode&&typeof r.initial.panoIndex=="number"&&(r.initial.mode="Panorama")}return H instanceof Error?H:(workRawMapping.set(r,{works:V,options:N}),r)}function parseNull(e,t){return t.issuer="null",deepFreeze(t),workRawMapping.set(t,{works:["null"],options:"{}"}),t}function parsePanoWork(e,t){var r;t.issuer="null",t.allowHosts=["*"],t.workCode=(r=e.code)!==null&&r!==void 0?r:createUuid();var n=[e.size],o=[],s=getTileLevel(n[0]);if(s)for(var l=s-1;l>=0;l--)n.unshift(512*Math.pow(2,l));for(var u=0,c=n;u<c.length;u++){var h=c[u],f=getTileLevel(h);f&&o.push({level:f,size:e.size,scale:h/e.size,up:e.up,down:e.down,right:e.right,left:e.left,front:e.front,back:e.back})}var m={up:e.up,down:e.down,right:e.right,left:e.left,front:e.front,back:e.back,sizeList:n};o&&(m.tiles=o);var y={accessibleIds:[],accessibleNodes:[],active:!0,floorIndex:0,images:m,index:0,loadable:!1,pano:{workCode:t.workCode,panoIndex:0},panoId:"".concat(t.workCode,"[0]"),panoIndex:0,position:new Vector3(0,1.5,0),quaternion:new Quaternion(0,1,0,0),standingPosition:new Vector3(0,0,0),visibleIds:[],visibleNodes:[],work:t};return t.observers=[y],deepFreeze(t),workRawMapping.set(t,{works:[JSON.stringify(e)],options:"{}"}),t}function parseWork(e,t){typeof e=="string"&&e.trim()[0]==="{"&&(e=JSON.parse(e));var r=workRawMapping.get(e);if(r){if(t&&!equal(JSON.parse(r.options),t))throw new Error("[PARSE FAILED]: work is parsed with different options.");return e}else try{return new Work(e,t??{})}catch(n){throw new Error("[PARSE FAILED]: "+n.message+`
Error work input:
`+JSON.stringify(e))}}function createWorks(e){for(var t={},r=[],n={},o=0,s=e;o<s.length;o++){var l=s[o],u=t[l.workCode];u||(u=t[l.workCode]=new Matrix4().copy(l.transform));for(var c=0,h=l.observers;c<h.length;c++){var f=h[c],m={isResolved:!0,active:f.active,accessibleIds:f.accessibleIds,visibleIds:f.visibleIds,accessibleNodes:f.accessibleNodes,visibleNodes:f.visibleNodes,floorIndex:f.floorIndex,images:f.images,index:f.index,panoIndex:f.panoIndex,loadable:f.loadable,panoId:f.panoId,pano:f.pano,work:f.work,derivedId:f.derivedId,video:f.video,position:new Vector3().copy(f.position).applyMatrix4(u),standingPosition:new Vector3().copy(f.standingPosition).applyMatrix4(u),quaternion:new Quaternion().setFromRotationMatrix(scratchMatrix4$1.makeRotationFromQuaternion(f.quaternion).premultiply(u))};Object.freeze(m),r.push(m),n[m.panoId]=m}}Object.freeze(r);for(var y=e.slice(),A={},M=0,b=y;M<b.length;M++){var l=b[M];A[l.workCode]=l}return Object.freeze(Object.assign(y,{get initial(){return y.length>0?y[0].initial:{work:{}}},get resolvedObservers(){return r},getWork:function(T){return A[T]},getResolvedObserver:function(T){var _,S;return isPanoId(T)?n[T]:typeof T=="number"?n[panoStringify({workCode:(S=(_=e[0])===null||_===void 0?void 0:_.workCode)!==null&&S!==void 0?S:"",panoIndex:T})]:n[panoStringify(T)]},update:function(){for(var T=0,_=y;T<_.length;T++){var S=_[T],C=S.transform,P=t[S.workCode];P?P.equals(C)||(P.copy(C),needsUpdateWorkCodeSet.add(S.workCode)):(t[S.workCode]=new Matrix4().copy(C),needsUpdateWorkCodeSet.add(S.workCode))}if(needsUpdateWorkCodeSet.size>0){for(var F=0,O=r;F<O.length;F++){var N=O[F];if(needsUpdateWorkCodeSet.has(N.work.workCode)){var V=N.work.observers[N.index],q=N.work.transform;N.position.copy(V.position).applyMatrix4(q),N.standingPosition.copy(V.standingPosition).applyMatrix4(q),N.quaternion.setFromRotationMatrix(scratchMatrix4$1.makeRotationFromQuaternion(V.quaternion).premultiply(q))}}needsUpdateWorkCodeSet.clear()}}}))}var fetcherMap=new Map;function getFetcher(e){var t=fetcherMap.get(e);if(t)return t;throw new Error("fetcher never registered.")}function registerFetcher(e,t){return fetcherMap.set(e,t)}var BufferGeometryUtils={computeTangents:function(e){var t=e.index,r=e.attributes;if(t===null||r.position===void 0||r.normal===void 0||r.uv===void 0){console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var n=t.array,o=r.position.array,s=r.normal.array,l=r.uv.array,u=o.length/3;r.tangent===void 0&&e.setAttribute("tangent",new BufferAttribute(new Float32Array(4*u),4));for(var c=r.tangent.array,h=[],f=[],m=0;m<u;m++)h[m]=new Vector3,f[m]=new Vector3;var y=new Vector3,A=new Vector3,M=new Vector3,b=new Vector2,T=new Vector2,_=new Vector2,S=new Vector3,C=new Vector3;function P(ee,j,re){y.fromArray(o,ee*3),A.fromArray(o,j*3),M.fromArray(o,re*3),b.fromArray(l,ee*2),T.fromArray(l,j*2),_.fromArray(l,re*2);var pe=A.x-y.x,ge=M.x-y.x,_e=A.y-y.y,he=M.y-y.y,Fe=A.z-y.z,Re=M.z-y.z,Le=T.x-b.x,Se=_.x-b.x,we=T.y-b.y,Ve=_.y-b.y,je=1/(Le*Ve-Se*we);S.set((Ve*pe-we*ge)*je,(Ve*_e-we*he)*je,(Ve*Fe-we*Re)*je),C.set((Le*ge-Se*pe)*je,(Le*he-Se*_e)*je,(Le*Re-Se*Fe)*je),h[ee].add(S),h[j].add(S),h[re].add(S),f[ee].add(C),f[j].add(C),f[re].add(C)}var F=e.groups;F.length===0&&(F=[{start:0,count:n.length}]);for(var m=0,O=F.length;m<O;++m)for(var N=F[m],V=N.start,q=N.count,Q=V,z=V+q;Q<z;Q+=3)P(n[Q+0],n[Q+1],n[Q+2]);var H=new Vector3,W=new Vector3,J=new Vector3,G=new Vector3,te,X,K;function Z(ee){J.fromArray(s,ee*3),G.copy(J),X=h[ee],H.copy(X),H.sub(J.multiplyScalar(J.dot(X))).normalize(),W.crossVectors(G,X),K=W.dot(f[ee]),te=K<0?-1:1,c[ee*4]=H.x,c[ee*4+1]=H.y,c[ee*4+2]=H.z,c[ee*4+3]=te}for(var m=0,O=F.length;m<O;++m)for(var N=F[m],V=N.start,q=N.count,Q=V,z=V+q;Q<z;Q+=3)Z(n[Q+0]),Z(n[Q+1]),Z(n[Q+2])},mergeBufferGeometries:function(e,t){for(var r=e[0].index!==null,n=new Set(Object.keys(e[0].attributes)),o=new Set(Object.keys(e[0].morphAttributes)),s={},l={},u=new BufferGeometry,c=0,h=0;h<e.length;++h){var f=e[h];if(r!==(f.index!==null))return null;for(var m in f.attributes){if(!n.has(m))return null;s[m]===void 0&&(s[m]=[]),s[m].push(f.attributes[m])}for(var m in f.morphAttributes){if(!o.has(m))return null;l[m]===void 0&&(l[m]=[]),l[m].push(f.morphAttributes[m])}if(u.userData.mergedUserData=u.userData.mergedUserData||[],u.userData.mergedUserData.push(f.userData),t){var y;if(r)y=f.index.count;else if(f.attributes.position!==void 0)y=f.attributes.position.count;else return null;u.addGroup(c,y,h),c+=y}}if(r){for(var A=0,M=[],h=0;h<e.length;++h){for(var b=e[h].index,T=0;T<b.count;++T)M.push(b.getX(T)+A);A+=e[h].attributes.position.count}u.setIndex(M)}for(var m in s){var _=this.mergeBufferAttributes(s[m]);if(!_)return null;u.setAttribute(m,_)}for(var m in l){var S=l[m][0].length;if(S===0)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[m]=[];for(var h=0;h<S;++h){for(var C=[],T=0;T<l[m].length;++T)C.push(l[m][T][h]);var P=this.mergeBufferAttributes(C);if(!P)return null;u.morphAttributes[m].push(P)}}return u},mergeBufferAttributes:function(e){for(var t,r,n,o=0,s=0;s<e.length;++s){var l=e[s];if(l.isInterleavedBufferAttribute||(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)||(r===void 0&&(r=l.itemSize),r!==l.itemSize)||(n===void 0&&(n=l.normalized),n!==l.normalized))return null;o+=l.array.length}for(var u=new t(o),c=0,s=0;s<e.length;++s)u.set(e[s].array,c),c+=e[s].array.length;return new BufferAttribute(u,r,n)},interleaveAttributes:function(e){for(var t,r=0,n=0,o=0,s=e.length;o<s;++o){var l=e[o];if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.warn("AttributeBuffers of different types cannot be interleaved"),null;r+=l.array.length,n+=l.itemSize}for(var u=new InterleavedBuffer(new t(r),n),c=0,h=[],f=["getX","getY","getZ","getW"],m=["setX","setY","setZ","setW"],y=0,s=e.length;y<s;y++){var l=e[y],A=l.itemSize,M=l.count,b=new InterleavedBufferAttribute(u,A,c,l.normalized);h.push(b),c+=A;for(var T=0;T<M;T++)for(var _=0;_<A;_++)b[m[_]](T,l[f[_]](T))}return h},estimateBytesUsed:function(e){var t=0;for(var r in e.attributes){var n=e.getAttribute(r);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}var o=e.getIndex();return t+=o?o.count*o.itemSize*o.array.BYTES_PER_ELEMENT:0,t},mergeVertices:function(e,t){t===void 0&&(t=1e-4),t=Math.max(t,Number.EPSILON);for(var r={},n=e.getIndex(),o=e.getAttribute("position"),s=n?n.count:o.count,l=0,u=Object.keys(e.attributes),c={},h={},f=[],m=["getX","getY","getZ","getW"],y=0,A=u.length;y<A;y++){var M=u[y];c[M]=[];var b=e.morphAttributes[M];b&&(h[M]=new Array(b.length).fill().map(function(){return[]}))}for(var T=Math.log10(1/t),_=Math.pow(10,T),y=0;y<s;y++){for(var S=n?n.getX(y):y,C="",P=0,A=u.length;P<A;P++)for(var M=u[P],F=e.getAttribute(M),O=F.itemSize,N=0;N<O;N++)C+="".concat(~~(F[m[N]](S)*_),",");if(C in r)f.push(r[C]);else{for(var P=0,A=u.length;P<A;P++)for(var M=u[P],F=e.getAttribute(M),b=e.morphAttributes[M],O=F.itemSize,V=c[M],q=h[M],N=0;N<O;N++){var Q=m[N];if(V.push(F[Q](S)),b)for(var z=0,H=b.length;z<H;z++)q[z].push(b[z][Q](S))}r[C]=l,f.push(l),l++}}for(var W=e.clone(),y=0,A=u.length;y<A;y++){var M=u[y],J=e.getAttribute(M),G=new J.array.constructor(c[M]),F=new BufferAttribute(G,J.itemSize,J.normalized);if(W.setAttribute(M,F),M in h)for(var P=0;P<h[M].length;P++){var te=e.morphAttributes[M][P],G=new te.array.constructor(h[M][P]),X=new BufferAttribute(G,te.itemSize,te.normalized);W.morphAttributes[M][P]=X}}return W.setIndex(f),W}};function isThirdPersonMode(e){switch(e){case"Floorplan":return!0;case"Mapview":return!0;default:return!1}}function isFristPersonMode(e){switch(e){case"Panorama":return!0;case"VRPanorama":return!0;case"XRPanorama":return!0;case"Model":return!0;default:return!1}}var scratchVector3=new Vector3,scratchSphere=new Sphere,scratchMatrix4=new Matrix4,scratchMatrix4Inverse=new Matrix4,scratchBoundingBox=new Box3,ROTATE_X_90_MATRIX=new Matrix4().fromArray([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),ROTATE_X_90_MATRIX_INVERSE=new Matrix4().fromArray([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),DEFAULT_BOUNDING=new Box3(new Vector3(-.5,-.5,-.5),new Vector3(.5,.5,.5));function getEcefToEnuMatrixFromUpAxis(e,t,r){switch(e){case"Z":break;case"Y":r.copy(ROTATE_X_90_MATRIX_INVERSE);break;case"-Y":r.copy(ROTATE_X_90_MATRIX);break;case"WGS84":case"GCJ02":case"BD09":getEcefToEnuMatrix(t,r);break;default:r.identity();break}return r}function getExt(e){var t=/([0-9a-z\.\_\-]+)([\?\#].*)?$/i.exec(e);if(t){var r=String(t[1]).trim().split(".").slice(1).reverse()[0];if(r)return r}return""}var ModelViewLayer=function(){function e(t,r){this.scene=t,this.error=r,t.viewLayer=this}return Object.defineProperty(e.prototype,"name",{get:function(){return this.scene.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this.scene.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"upAxis",{get:function(){return this.scene.upAxis},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groundHeight",{get:function(){return this.scene.groundHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){return this.scene.model},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinates",{get:function(){scratchVector3.setScalar(0);var t=this.scene.localToLla(scratchVector3),r=t.x,n=t.y;return[r,n].map(function(o){return(o/Math.PI*180).toFixed(6)}).join(",")},enumerable:!1,configurable:!0}),e.prototype.getTransformMatrix4=function(t){return t===void 0&&(t=new Matrix4),t.copy(this.scene.coordinateTransform.ecefToLocalMatrix),this.scene&&t.premultiply(this.scene.matrixWorld),t},e.prototype.coordinatesToWorldPoint=function(t){var r=new Vector3(t.latitude,t.longitude,t.altitude);return this.scene.llaToWorld(r)},e.prototype.worldPointToCoordinates=function(t){return scratchVector3.copy(t),this.scene.worldToLla(scratchVector3),{latitude:scratchVector3.x,longitude:scratchVector3.y,altitude:scratchVector3.z}},e}(),Model=function(e){__extends(t,e);function t(r){r===void 0&&(r={});var n,o,s,l=e.call(this)||this;return l.name="",l.onError=(n=r.onError)!==null&&n!==void 0?n:noop$1,l.onShownFloorChange=(o=r.onShownFloorChange)!==null&&o!==void 0?o:noop$1,l.onLoad=(s=r.onLoad)!==null&&s!==void 0?s:noop$1,l.work=null,l.viewLayers=[],l.bounding=new Box3(new Vector3,new Vector3),l.floorLength=0,l.textureOptions={},l.refined=!1,l.refineProgress=[0,0],l.loaded=!1,l.matrixAutoUpdate=!1,l.needsRender=!0,l.autoRefine=!0,l.materialVersion=0,l.materialParameters=__assign({},defaultPbmParameters),l.cacheCameras=[],l.disposed=!1,l}return Object.defineProperty(t.prototype,"empty",{get:function(){return this.viewLayers.length===0},enumerable:!1,configurable:!0}),t.prototype.getMaterial=function(){return __assign({},this.materialParameters)},t.prototype.setMaterial=function(r){var n=this.materialParameters.shownFloorIndex,o=updatePBMParameters(this.materialParameters,r);if(o){var s=this.materialParameters.shownFloorIndex;n!==s&&this.onShownFloorChange(s),this.materialVersion++,this.needsRender=!0}},Object.defineProperty(t.prototype,"brightness",{get:function(){return this.materialParameters.brightness},set:function(r){this.setMaterial({brightness:typeof r=="number"?r:1})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shownFloorIndex",{get:function(){return this.materialParameters.shownFloorIndex},set:function(r){this.setMaterial({shownFloorIndex:r})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shownFloor",{get:function(){return this.shownFloorIndex===-1?null:this.shownFloorIndex},set:function(r){this.shownFloorIndex=r===null?-1:r},enumerable:!1,configurable:!0}),t.prototype.show=function(r){this.shownFloor=r??null},Object.defineProperty(t.prototype,"clippers",{get:function(){return this.materialParameters.clippers},set:function(r){this.setMaterial({clippers:r})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"customShaders",{get:function(){return this.materialParameters.customShaders},set:function(r){this.setMaterial({customShaders:r})},enumerable:!1,configurable:!0}),t.prototype.getEdgesBySphere=function(r,n){n===void 0&&(n=30/180*Math.PI);for(var o=Math.cos(n),s=[],l=0,u=this.children;l<u.length;l++){var c=u[l];c instanceof Tile3DModel&&c.tileset.selectedTiles.forEach(function(h){var f,m,y;if(!(h.boundingVolume&&h.boundingVolume.distanceToPoint(r.center)>r.radius)){var A=(m=(f=h.content)===null||f===void 0?void 0:f.data)===null||m===void 0?void 0:m.object;if(A&&A.visible){var M=[];if(A.traverseVisible(function(re){if(re instanceof Mesh){var pe=bvhMeshMap.get(re);if(pe){scratchMatrix4.copy(re.matrixWorld),scratchMatrix4Inverse.getInverse(scratchMatrix4),scratchSphere.copy(r).applyMatrix4(scratchMatrix4Inverse);var ge=pe.trianglesInSphere(scratchSphere.center,scratchSphere.radius),_e=new BufferGeometry;_e.setAttribute("position",new BufferAttribute(ge,3)),_e.applyMatrix4(re.matrixWorld),_e=BufferGeometryUtils.mergeVertices(_e,.01),M.push(_e)}}}),M.length===0)return;for(var b=["a","b","c"],T=BufferGeometryUtils.mergeBufferGeometries(M,!1),_=T.getAttribute("position").array,S=((y=T.getIndex())===null||y===void 0?void 0:y.array)||[],C=[],P=[],F=0,O=_.length;F<O;F+=3){var N=new Vector3(_[F],_[F+1],_[F+2]);C.push(N)}for(var F=0,O=S.length;F<O;F+=3){var V=S[F],q=S[F+1],Q=S[F+2],z=new Vector3().crossVectors(C[q].clone().sub(C[V]),C[Q].clone().sub(C[V])).normalize();P.push({a:V,b:q,c:Q,normal:z})}for(var H={},F=0,O=P.length;F<O;F++)for(var W=P[F],J=0;J<3;J++){var G=W[b[J]],te=W[b[(J+1)%3]],X=[Math.min(G,te),Math.max(G,te)],K=X[0]+"-"+X[1];H[K]===void 0?H[K]={index1:X[0],index2:X[1],face1:F}:H[K].face2=F}for(var K in H){var Z=H[K];if(Z.face2===void 0||P[Z.face1].normal.dot(P[Z.face2].normal)<=o){var ee=C[Z.index1],j=C[Z.index2];s.push(new Line3(ee,j))}}C.length=0,P.length=0}}})}return s},t.prototype.intersectRaycaster=function(r,n,o){n===void 0&&(n=null),o===void 0&&(o=!0);for(var s=[],l=0,u=this.children.length;l<u;l++){var c=this.children[l];c.visible&&c instanceof Tile3DModel&&c.intersectRaycaster(r,!1,s)}return n!=null&&(s=s.filter(function(h){return h.floor===n})),this.getMaterial().pointBack==="HIDDEN"&&(s=s.filter(function(h){return!(h.object instanceof PBMPointCloud&&h.face&&h.face.normal.angleTo(r.ray.direction)<Math.PI/2)})),o&&s.sort(function(h,f){return h.distance-f.distance}),s},t.prototype.load=function(r,n){var o,s=this,l,u,c,h,f;if(n===void 0&&(n={}),this.work=r,this.name=this.work.workCode,!r.model)return Promise.resolve();for(var m=r.model,y=0,A=0,M=r.observers;A<M.length;A++){var b=M[A];y=Math.max(y,b.floorIndex)}this.floorLength=y+1;for(var T=!1,_=[],S=function(he){var Fe=he.tileset,Re=he.upAxis,Le=he.name,Se=he.type;Se==="mesh"&&(T=!0);var we=Fe.split("#"),Ve=we[0],je=we[1],st=(l=(je||Ve).split("?")[1])!==null&&l!==void 0?l:"",We=typeof n["3d-tiles"]=="function"?n["3d-tiles"](he):(u=n["3d-tiles"])!==null&&u!==void 0?u:{},bt=getFetcher(r).ajax(Fe,{responseType:"text"}).then(function(oe){var ue,Qe,Me=Fe?Fe.slice(0,Fe.lastIndexOf("/")+1):"",De=normalizeTilesetHeader(JSON.parse(oe.body),Me),be=De.root,ze=De.rootMeta,at=ze===void 0?{}:ze;at.upAxis&&at.upAxis!==Re&&(Re=at.upAxis),"lodVersion"in De&&(Re="-Y","floorInfo"in De&&(De.properties=De.properties||{},De.properties.floorInfo=De.floorInfo.map(function(lt){return{ground:-lt.ground,height:lt.height}}),delete De.floorInfo),De.asset.tilesetVersion=String(De.lodVersion),delete De.lodVersion);var ot=be.boundingVolume?makeBoundingVolume(be.boundingVolume):void 0;ot&&be.transform&&ot.applyMatrix4(scratchMatrix4.fromArray(be.transform));var nt=null,Ue=new Matrix4,He=new Matrix4;at.coordinate?(nt=at.coordinate.ground_height,Ue.fromArray(at.coordinate.pose_ecef_to_enu),He.fromArray(at.coordinate.pose_enu_to_ecef)):(ot?ot.getCenter(scratchVector3):scratchVector3.setScalar(0),getEcefToEnuMatrixFromUpAxis(Re,scratchVector3,Ue),He.getInverse(Ue));var qe=new Matrix4().copy(ROTATE_X_90_MATRIX),ke=new Matrix4().copy(ROTATE_X_90_MATRIX_INVERSE),ve=new Matrix4().premultiply(Ue).premultiply(qe),Ye=new Matrix4().getInverse(ve),tt;if(We.viewerRequestVolume){var xt=isBoundingVolume(We.viewerRequestVolume)?We.viewerRequestVolume:makeBoundingVolume(We.viewerRequestVolume);xt.applyMatrix4(Ye),tt=xt.toJson()}De.root={refine:(ue=be.refine)!==null&&ue!==void 0?ue:"REPLACE",geometricError:be.geometricError,transform:ve.toArray(),boundingVolume:ot?ot.toJson():void 0,viewerRequestVolume:tt,children:[be]};var Ze=new Tile3DModel(s,De,{name:Le,light:(Qe=n.light)!==null&&Qe!==void 0?Qe:!1,type:Se,upAxis:Re,url:Fe,referer:Fe,search:st,fetcher:getFetcher(r),groundHeight:nt,coordinateTransform:{localToEnuMatrix:ke,enuToLocalMatrix:qe,enuToEcefMatrix:He,ecefToEnuMatrix:Ue,localToEcefMatrix:Ye,ecefToLocalMatrix:ve}});return Ze.matrix.copy(r.transform),Ze.matrix.decompose(Ze.position,Ze.quaternion,Ze.scale),Ze.matrixWorldNeedsUpdate=!0,Object.assign(Ze.maxMemoryUsage,Ze.getRecommendProps()),typeof We.debug<"u"&&(Ze.debug=We.debug),typeof We.minLevelOfDetail<"u"&&(Ze.minLevelOfDetail=We.minLevelOfDetail),typeof We.maxLevelOfDetail<"u"&&(Ze.maxLevelOfDetail=We.maxLevelOfDetail),typeof We.minGeometricError<"u"&&(Ze.minGeometricError=We.minGeometricError),typeof We.maxGeometricError<"u"&&(Ze.maxGeometricError=We.maxGeometricError),typeof We.skipLevelOfDetail<"u"&&(Ze.skipLevelOfDetail=We.skipLevelOfDetail),typeof We.mostDetail<"u"&&(Ze.mostDetail=We.mostDetail),typeof We.loadSiblings<"u"&&(Ze.loadSiblings=We.loadSiblings),typeof We.loadAll<"u"&&(Ze.loadAll=We.loadAll),typeof We.maxMemoryUsage<"u"&&(Ze.maxMemoryUsage=We.maxMemoryUsage),typeof We.maxRequests<"u"&&(Ze.maxRequests=We.maxRequests),typeof We.requestOrder<"u"&&(Ze.requestOrder=We.requestOrder),typeof We.maxScreenSpaceError<"u"&&(Ze.maxScreenSpaceError=We.maxScreenSpaceError),(We.showLayers===!1||Array.isArray(We.showLayers)&&We.showLayers.indexOf(Le)===-1)&&(Ze.visible=!1),new ModelViewLayer(Ze,null)});_.push(bt.catch(function(oe){var ue;s.onError(oe);var Qe=new Matrix4,Me=new Matrix4,De=new Matrix4().copy(ROTATE_X_90_MATRIX),be=new Matrix4().copy(ROTATE_X_90_MATRIX_INVERSE),ze=new Matrix4().premultiply(Qe).premultiply(De),at=new Matrix4().getInverse(ze),ot=Fe?Fe.slice(0,Fe.lastIndexOf("/")+1):"",nt;if(We.viewerRequestVolume){var Ue=isBoundingVolume(We.viewerRequestVolume)?We.viewerRequestVolume:makeBoundingVolume(We.viewerRequestVolume);Ue.applyMatrix4(at),nt=Ue.toJson()}var He=normalizeTilesetHeader({asset:{version:"0.0"},geometricError:0,viewerRequestVolume:nt,root:{geometricError:0}},ot),qe=new Tile3DModel(s,He,{name:Le,light:(ue=n.light)!==null&&ue!==void 0?ue:!1,type:Se,upAxis:Re,url:Fe,referer:Fe,search:st,fetcher:getFetcher(r),groundHeight:null,coordinateTransform:{localToEnuMatrix:be,enuToLocalMatrix:De,enuToEcefMatrix:Me,ecefToEnuMatrix:Qe,localToEcefMatrix:at,ecefToLocalMatrix:ze},onError:s.onError});return qe.matrix.copy(r.transform),qe.matrix.decompose(qe.position,qe.quaternion,qe.scale),qe.matrixWorldNeedsUpdate=!0,(We.showLayers===!1||Array.isArray(We.showLayers)&&We.showLayers.indexOf(Le)===-1)&&(qe.visible=!1),new ModelViewLayer(qe,oe)}))},C=0,P=m.layers;C<P.length;C++){var F=P[C];S(F)}if(!T&&m.file){var O=m.file,N=m.textureBase,V=m.textures,q="fallback",Q="mesh",z="Z",H="",F={name:q,type:Q,upAxis:z,tileset:H},W=typeof n["3d-tiles"]=="function"?n["3d-tiles"](F):(c=n["3d-tiles"])!==null&&c!==void 0?c:{},J=getExt(O)||"at3d",G=new Matrix4,te=new Matrix4,X=new Matrix4().copy(ROTATE_X_90_MATRIX),K=new Matrix4().copy(ROTATE_X_90_MATRIX_INVERSE);getEcefToEnuMatrixFromUpAxis(z,scratchVector3.setScalar(0),G),te.getInverse(G);var Z=new Matrix4().premultiply(G).premultiply(X),ee=new Matrix4().getInverse(Z),j=void 0;if(W.viewerRequestVolume){var re=isBoundingVolume(W.viewerRequestVolume)?W.viewerRequestVolume:makeBoundingVolume(W.viewerRequestVolume);re.applyMatrix4(ee),j=re.toJson()}var pe=normalizeTilesetHeader({asset:{version:"0.0"},geometricError:0,root:{refine:"REPLACE",geometricError:0,transform:Z.toArray(),viewerRequestVolume:j,content:{uri:O},extras:(o={},o[J]={textureBaseUri:N,textureArray:V,textureOptions:(h=n.textureOptions)!==null&&h!==void 0?h:{}},o)}},""),ge=new Tile3DModel(this,pe,{name:q,light:(f=n.light)!==null&&f!==void 0?f:!1,type:Q,upAxis:z,url:H,referer:O,fetcher:getFetcher(r),groundHeight:null,coordinateTransform:{localToEnuMatrix:K,enuToLocalMatrix:X,enuToEcefMatrix:te,ecefToEnuMatrix:G,localToEcefMatrix:ee,ecefToLocalMatrix:Z},onError:this.onError});ge.matrix.copy(r.transform),ge.matrix.decompose(ge.position,ge.quaternion,ge.scale),ge.matrixWorldNeedsUpdate=!0,(W.showLayers===!1||Array.isArray(W.showLayers)&&W.showLayers.indexOf(q)===-1)&&(ge.visible=!1);var _e=new ModelViewLayer(ge,null);_.push(Promise.resolve(_e))}return Promise.all(_).then(function(he){for(var Fe=0,Re=he;Fe<Re.length;Fe++){var Le=Re[Fe];if(s.disposed){Le.scene.dispose();continue}s.viewLayers.push(Le),s.add(Le.scene)}})},t.prototype.update=function(r,n,o){if(this.children.length){var s=this.loaded;this.refined=this.work!==null,this.refineProgress[0]=0,this.refineProgress[1]=0,this.loaded=this.work!==null;for(var l=0,u=this.viewLayers;l<u.length;l++){var c=u[l],h=c.scene;h&&(this.work&&(h.cacheCameras=this.cacheCameras,this.autoRefine===!1?h.needsRefined=!1:isFristPersonMode(o)?h.needsRefined=this.materialParameters.modelAlpha===0||this.materialParameters.modelAlpha===1:h.needsRefined=!0,this.work.transform.equals(h.matrix)||(h.matrix.copy(this.work.transform),h.matrix.decompose(h.position,h.quaternion,h.scale),h.matrixWorldNeedsUpdate=!0)),h.update(r,n,o),h.needsRender===!0&&(h.needsRender=!1,this.needsRender=!0),h.refined===!1&&(this.refined=!1),this.refineProgress[0]+=h.refineProgress[0],this.refineProgress[1]+=h.refineProgress[1],h.loaded===!1&&(this.loaded=!1))}this.bounding.makeEmpty();for(var f=0,m=this.viewLayers;f<m.length;f++){var c=m[f],h=c.scene;h&&(h.boundingBox.isEmpty()||(scratchBoundingBox.copy(h.boundingBox).applyMatrix4(h.matrix),this.bounding.union(scratchBoundingBox)))}this.bounding.isEmpty()&&this.bounding.copy(DEFAULT_BOUNDING),s===!1&&this.loaded===!0&&this.onLoad()}else this.work&&!this.work.model?(this.refined=!0,this.refineProgress[0]=0,this.refineProgress[1]=0,this.loaded=!0):(this.refined=!1,this.refineProgress[0]=0,this.refineProgress[1]=0,this.loaded=!1),this.bounding.set(new Vector3,new Vector3)},t.prototype.dispose=function(){this.disposed=!0;for(var r;r=this.children[0];)r instanceof Tile3DModel&&r.dispose(),this.remove(r)},t}(Object3D);function createModels(){var e=new Box3,t=omit(defaultPbmParameters,["clippers","shownFloorIndex","brightness","customShaders"]),r=Object.assign([],{bounding:e,needsRender:!1,refined:!1,refineProgress:[0,0],loaded:!1,materialVersion:0,cacheCameras:[],autoUpdate:!0,intersectRaycaster:function(n,o,s){s===void 0&&(s=!0);var l;if(r.length===1)l=r[0].intersectRaycaster(n,o,s);else if(r.length===0)l=[];else{l=[];for(var u=0,c=r;u<c.length;u++){var h=c[u];if(h.visible){var f=h.intersectRaycaster(n,o,!1);f.length&&l.push.apply(l,f)}}s&&l.sort(function(m,y){return m.distance-y.distance})}return l},setMaterial:function(n){var o=updatePBMParameters(t,n);o&&(r.materialVersion++,r.needsRender=!0)},getMaterial:function(){return __assign({},t)},resetBrightness:function(){for(var n=0,o=r;n<o.length;n++){var s=o[n];s.setMaterial({brightness:1})}},update:function(n,o,s){r.refined=r.length>0,r.loaded=r.length>0,r.refineProgress[0]=0,r.refineProgress[1]=0,e.makeEmpty();for(var l=0,u=r.cacheCameras;l<u.length;l++){var c=u[l];c.updateMatrixWorld(!0),c.updateProjectionMatrix()}for(var h=0,f=0,m=r;f<m.length;f++){for(var y=m[f],A=0,M=y.viewLayers;A<M.length;A++){var b=M[A];b.scene.modelIndex=h++}y.setMaterial(t),y.cacheCameras=r.cacheCameras,y.autoRefine=this.autoUpdate,y.update(n,o,s),y.needsRender===!0&&(r.needsRender=!0,y.needsRender=!1),y.refined===!1&&(r.refined=!1),r.refineProgress[0]+=y.refineProgress[0],r.refineProgress[1]+=y.refineProgress[1],y.loaded===!1&&(r.loaded=!1),e.union(y.bounding)}for(var T=0,_=r;T<_.length;T++)for(var y=_[T],S=0,C=y.viewLayers;S<C.length;S++){var b=C[S];b.scene.modelsLoaded=r.loaded}e.isEmpty()&&e.copy(DEFAULT_BOUNDING)}});return r}var easeOut$2=function(e){return e*(2-e)},sharedGeometry2$2=function(){var e=new Float32Array([-.18,0,-.18,.18,0,-.18,-.18,0,.18,.18,0,.18]),t=new Float32Array([1,0,0,0,1,1,0,1]),r=new Uint8Array([0,2,1,2,3,1]),n=new BufferGeometry;return n.setAttribute("position",new BufferAttribute(e,3)),n.setAttribute("uv",new BufferAttribute(t,2)),n.setIndex(new BufferAttribute(r,1)),n}(),vertexShader$4=`
varying vec2 vUv;
#include <common>
#include <logdepthbuf_pars_vertex>
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  #include <logdepthbuf_vertex>
}
`,fragmentShader$4=`
uniform vec3 baseColor;
uniform float circleScale;
uniform float ringScale;
uniform float ringOpacity;
uniform float loadingAngle;
uniform float loadingOpacity;
uniform float progress;
uniform float progressOpacity;
uniform float expand0;
uniform float expand1;
uniform float expandOpacity;
uniform float opacity;
uniform float tapScale;
uniform float tapOpacity;
uniform float disable;
varying vec2 vUv;

#include <common>
#include <logdepthbuf_pars_fragment>
#define SMOOTH_DIST 0.017
#define CENTER vec2(0.5, 0.5)

float inside(float innerDist) {
  float dist = length(CENTER - vUv);
  return smoothstep(innerDist, innerDist + SMOOTH_DIST, dist);
}
float outside(float outerDist) {
  float dist = length(CENTER - vUv);
  return 1.0 - smoothstep(outerDist - SMOOTH_DIST, outerDist, dist);
}

vec4 create_circle() {
  float dist = length(CENTER - vUv);
  float gradient = clamp(0.8 + abs(dot(normalize(vec2(1.0, -1.0)), vUv - CENTER)) * 1.5, 0.0, 1.0);
  return vec4(1.0, 1.0, 1.0, gradient * tapOpacity * inside(0.15 * circleScale * tapScale) * outside(0.234 * circleScale * tapScale));
}

vec4 create_disable() {
  float dist = length(CENTER - vUv);
  return vec4(1.0, 1.0, 1.0, 0.5 * tapOpacity * outside(0.32 * circleScale * tapScale));
}

vec4 create_ring() {
  float gradient = clamp(0.5 + abs(dot(normalize(vec2(1.0, 1.0)), vUv - CENTER)), 0.0, 1.0);
  return vec4(1.0, 1.0, 1.0, gradient * tapOpacity * ringOpacity * inside(0.27 * ringScale * tapScale) * outside(0.32 * ringScale * tapScale));
}

vec4 create_loading() {
  float angle = PI - atan(CENTER.x - vUv.x, CENTER.y - vUv.y);
  angle = mod(angle + loadingAngle, PI2);
  float gradient = (1.0 - smoothstep(0.0, PI2, angle)) * 0.4 + 0.1;
  return vec4(1.0, 1.0, 1.0, gradient * tapOpacity * loadingOpacity * inside(0.208 * circleScale * tapScale) * outside(0.3 * circleScale * tapScale));
}

vec4 create_progress() {
  float angle = PI + atan(CENTER.x - vUv.x, CENTER.y - vUv.y);
  float bar = (1.0 - step(progress * PI2, angle)) * 0.5;
  return vec4(1.0, 1.0, 1.0, bar * tapOpacity * progressOpacity * inside(0.208 * circleScale * tapScale) * outside(0.3 * circleScale * tapScale));
}

vec4 create_expand0() {
  float width = 0.2;
  float radius = 0.2 + (0.43 - 0.2) * expand0;
  float dist = length(CENTER - vUv);
  float gradient = (1.0 - clamp((radius - dist) / width, 0.0, 1.0)) * 0.8 * clamp((1.0 - abs(expand0 - 0.5) * 2.0) * 1.2, 0.0, 1.0);
  return vec4(1.0, 1.0, 1.0, gradient * expandOpacity * outside(radius));
}

vec4 create_expand1() {
  float width = 0.2;
  float radius = 0.2 + (0.43 - 0.2) * expand1;
  float dist = length(CENTER - vUv);
  float gradient = (1.0 - clamp((radius - dist) / width, 0.0, 1.0)) * 0.8 * clamp((1.0 - abs(expand1 - 0.5) * 2.0) * 1.2, 0.0, 1.0);
  return vec4(1.0, 1.0, 1.0, gradient * expandOpacity * outside(radius));
}

void main() {
  #include <logdepthbuf_fragment>
  gl_FragColor = vec4(1.0, 1.0, 1.0, 0);

  vec4 expand1Color = create_expand1();
  gl_FragColor = mix(gl_FragColor, expand1Color, expand1Color.a);

  vec4 expand0Color = create_expand0();
  gl_FragColor = mix(gl_FragColor, expand0Color, expand0Color.a);

  vec4 progressColor = create_progress();
  gl_FragColor = mix(gl_FragColor, progressColor, progressColor.a);

  vec4 loadingColor = create_loading();
  gl_FragColor = mix(gl_FragColor, loadingColor, loadingColor.a);

  vec4 circleColor = create_circle();
  gl_FragColor = mix(gl_FragColor, circleColor, circleColor.a);

  vec4 ringColor = create_ring();
  gl_FragColor = mix(gl_FragColor, ringColor, ringColor.a);

  gl_FragColor = mix(gl_FragColor, create_disable(), disable);

  gl_FragColor = vec4(gl_FragColor.rgb * baseColor, gl_FragColor.a * opacity * opacity);
}
`,PanoCircleMesh=function(e){__extends(t,e);function t(r){r===void 0&&(r={});var n,o,s=e.call(this)||this,l=(n=r.color)!==null&&n!==void 0?n:16777215,u=(o=r.scale)!==null&&o!==void 0?o:1;return s.progress=0,s.opacity=0,s.loading=!1,s.current=!1,s.disabled=!1,s.currentMotion=new Motion({progress:0}),s.ringMotion=new Motion({scale:1,opacity:1}),s.tapMotion=new Motion({scale:1,opacity:1}),s.loadingOpacityMotion=new Motion({opacity:0}),s.progressMotion=new Motion({progress:0}),s.progressOpacityMotion=new Motion({opacity:0}),s.opacityMotion=new Motion({opacity:0}),s.disableMotion=new Motion({progress:0}),s.panoMesh=new Mesh(sharedGeometry2$2,new ShaderMaterial({blending:CustomBlending,blendSrc:SrcAlphaFactor,blendDst:OneMinusSrcAlphaFactor,blendSrcAlpha:OneFactor,blendDstAlpha:OneMinusSrcAlphaFactor,depthWrite:!1,vertexShader:vertexShader$4,fragmentShader:fragmentShader$4,uniforms:{baseColor:{value:new Color(l)},circleScale:{value:1},ringScale:{value:1},ringOpacity:{value:1},loadingAngle:{value:0},loadingOpacity:{value:0},progress:{value:0},progressOpacity:{value:0},expand0:{value:0},expand1:{value:0},expandOpacity:{value:0},opacity:{value:0},tapScale:{value:1},tapOpacity:{value:1},disable:{value:0}}})),s.renderOrder=-2,s.panoMesh.renderOrder=-2,s.panoMesh.position.y=.004,s.panoMesh.scale.set(u,1,u),s.add(s.panoMesh),s.currentStartTime=now(),s.needsRender=!0,s}return t.prototype.setProgress=function(r){var n=this;this.setDisabled(!1),this.setLoading(!1),this.progress!==r&&(r=clamp$1(r,0,1),this.tapMotion.ended&&(this.progress===0&&this.progressOpacityMotion.set({opacity:1},500).catch(noop$1),r===0?this.progressOpacityMotion.set({opacity:0},500).catch(noop$1).then(function(){n.progressMotion.set({progress:0},0).catch(noop$1)}):this.progressMotion.set({progress:clamp$1(r*1.2,0,1)},100).catch(noop$1)),this.progress=r)},t.prototype.setOpacity=function(r){this.opacity!==r&&(this.opacity=r=clamp$1(r,0,1),this.opacityMotion.set({opacity:r},200).catch(noop$1))},t.prototype.setCurrent=function(r){this.current!==r&&(this.currentMotion.set({progress:r?1:0},2e3).catch(noop$1),this.current=r,this.current===!0&&(this.currentStartTime=now()))},t.prototype.setLoading=function(r){this.loading!==r&&(this.loading=r,this.disabled===!0&&this.setDisabled(!1),this.loadingOpacityMotion.set({opacity:r?1:0},500).catch(noop$1))},t.prototype.setDisabled=function(r){this.disabled!==r&&(this.disabled=r,this.loading===!0&&this.setLoading(!1),this.disableMotion.set({progress:r?1:0},500).catch(noop$1))},t.prototype.tap=function(){var r=this;if(!this.tapMotion.ended)return Promise.resolve();var n=[{progress:0,value:{scale:1,opacity:1}},{progress:.3,value:{scale:.85,opacity:.5}},{progress:.8,value:{scale:1.05,opacity:.6}},{progress:1,value:{scale:1,opacity:1}}];return this.progressOpacityMotion.set({opacity:0},0).catch(noop$1),this.progressMotion.set({progress:0},0).catch(noop$1),this.tapMotion.setKeyframes(n,600).then(function(){r.progressOpacityMotion.set({opacity:r.progress>0?1:0},300).catch(noop$1),r.progressMotion.set({progress:r.progress},120).catch(noop$1)}).catch(noop$1)},t.prototype.updateTime=function(r,n){if(!this.progressMotion.ended){this.progressMotion.update(r);var o=this.progressMotion.value.progress;this.panoMesh.material.uniforms.progress.value=o,this.needsRender=!0}if(!this.progressOpacityMotion.ended){this.progressOpacityMotion.update(r);var s=this.progressOpacityMotion.value.opacity;this.panoMesh.material.uniforms.progressOpacity.value=s,this.needsRender=!0}if(!this.opacityMotion.ended){this.opacityMotion.update(r);var s=this.opacityMotion.value.opacity;this.panoMesh.material.uniforms.opacity.value=s,this.needsRender=!0}if(this.visible=this.opacityMotion.value.opacity!==0,(!this.loadingOpacityMotion.ended||this.loadingOpacityMotion.value.opacity>0)&&(this.loadingOpacityMotion.update(r),this.panoMesh.material.uniforms.loadingOpacity.value=this.loadingOpacityMotion.value.opacity,this.panoMesh.material.uniforms.loadingAngle.value=r/120%(Math.PI*2),this.needsRender=!0),this.tapMotion.ended||(this.tapMotion.update(r),this.panoMesh.material.uniforms.tapOpacity.value=this.tapMotion.value.opacity,this.panoMesh.material.uniforms.tapScale.value=this.tapMotion.value.scale,this.needsRender=!0),this.current||!this.currentMotion.ended){this.currentMotion.update(r),this.panoMesh.material.uniforms.expandOpacity.value=this.currentMotion.value.progress;{var l=(r-this.currentStartTime-1500)/2e3;if(l%5<2){var u=1+Math.sin(Math.PI*l)/25*this.currentMotion.value.progress;this.panoMesh.material.uniforms.circleScale.value=u,this.needsRender=!0}}{var c=(r-this.currentStartTime-1500)/2e3;if(c%5<2){var h=c%1;this.panoMesh.material.uniforms.expand0.value=easeOut$2(h)*this.currentMotion.value.progress,this.needsRender=!0}}{var f=(r-this.currentStartTime-1e3)/2e3;if(f%5<2){var h=f%1;this.panoMesh.material.uniforms.expand1.value=easeOut$2(h)*this.currentMotion.value.progress,this.needsRender=!0}}}if(this.currentMotion.value.progress>.2&&this.progress===0&&this.loading===!1){var m=(r-this.currentStartTime-1e3)/2e3;m%5<2?this.ringMotion.getTargetKeyframe().value.scale!==.8&&this.ringMotion.set({scale:.8,opacity:0},600).catch(noop$1):this.ringMotion.getTargetKeyframe().value.scale!==1&&this.ringMotion.set({scale:1,opacity:1},600).catch(noop$1)}else this.ringMotion.getTargetKeyframe().value.scale!==1&&this.ringMotion.set({scale:1,opacity:1},600).catch(noop$1);if(!this.ringMotion.ended){var y=this.ringMotion.value,u=y.scale,s=y.opacity;this.ringMotion.update(r),this.panoMesh.material.uniforms.ringScale.value=u,this.panoMesh.material.uniforms.ringOpacity.value=s,this.needsRender=!0}if(!this.disableMotion.ended){var o=this.disableMotion.value.progress;this.disableMotion.update(r),this.panoMesh.material.uniforms.disable.value=o,this.needsRender=!0}},t.prototype.dispose=function(){this.ringMotion.dispose(),this.tapMotion.dispose(),this.progressMotion.dispose(),this.progressOpacityMotion.dispose(),this.opacityMotion.dispose(),this.currentMotion.dispose(),this.panoMesh.material.dispose()},t}(Object3D),easeOut$1=function(e){return e*(2-e)},sharedGeometry2$1=function(){var e=new Float32Array([-.18,0,-.18,.18,0,-.18,-.18,0,.18,.18,0,.18]),t=new Float32Array([1,0,0,0,1,1,0,1]),r=new Uint8Array([0,2,1,2,3,1]),n=new BufferGeometry;return n.setAttribute("position",new BufferAttribute(e,3)),n.setAttribute("uv",new BufferAttribute(t,2)),n.setIndex(new BufferAttribute(r,1)),n}(),vertexShader$3=`
varying vec2 vUv;
#include <common>
#include <logdepthbuf_pars_vertex>
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  #include <logdepthbuf_vertex>
}
`,fragmentShader$3=`
uniform vec3 baseColor;
uniform float circleScale;
uniform float circleOpacity;
uniform float loadingAngle;
uniform float loadingOpacity;
uniform float progress;
uniform float progressOpacity;
uniform float expand0;
uniform float expand1;
uniform float expandOpacity;
uniform float opacity;
uniform float tapScale;
uniform float tapOpacity;
uniform float disable;
varying vec2 vUv;

#include <common>
#include <logdepthbuf_pars_fragment>
#define SMOOTH_DIST 0.017
#define CENTER vec2(0.5, 0.5)

float inside(float innerDist) {
  float dist = length(CENTER - vUv);
  return smoothstep(innerDist, innerDist + SMOOTH_DIST, dist);
}
float outside(float outerDist) {
  float dist = length(CENTER - vUv);
  return 1.0 - smoothstep(outerDist - SMOOTH_DIST, outerDist, dist);
}

vec4 create_circle() {
  float dist = length(CENTER - vUv);
  return vec4(1.0, 1.0, 1.0, 0.8 * circleOpacity * tapOpacity * inside(0.2 * circleScale * tapScale) * outside(0.3 * circleScale * tapScale));
}

vec4 create_disable() {
  float dist = length(CENTER - vUv);
  return vec4(1.0, 1.0, 1.0, 0.5 * tapOpacity * outside(0.32 * circleScale * tapScale));
}

vec4 create_loading() {
  float angle = PI - atan(CENTER.x - vUv.x, CENTER.y - vUv.y);
  angle = mod(angle + loadingAngle, PI2);
  float gradient = (1.0 - smoothstep(0.0, PI2, angle)) * 0.9 + 0.1;
  return vec4(1.0, 1.0, 1.0, gradient * tapOpacity * loadingOpacity * inside(0.2 * circleScale * tapScale) * outside(0.3 * circleScale * tapScale));
}

vec4 create_progress() {
  float angle = PI + atan(CENTER.x - vUv.x, CENTER.y - vUv.y);
  float bar = (1.0 - step(progress * PI2, angle)) * 0.7;
  return vec4(1.0, 1.0, 1.0, bar * tapOpacity * progressOpacity * inside(0.2 * circleScale * tapScale) * outside(0.3 * circleScale * tapScale));
}

vec4 create_expand0() {
  float width = 0.2;
  float radius = 0.25 + (0.5 - 0.25) * expand0;
  float dist = length(CENTER - vUv);
  float gradient = (1.0 - clamp((radius - dist) / width, 0.0, 1.0)) * 0.8 * clamp((1.0 - abs(expand0 - 0.5) * 2.0) * 1.2, 0.0, 1.0);
  return vec4(1.0, 1.0, 1.0, gradient * expandOpacity * outside(radius));
}

vec4 create_expand1() {
  float width = 0.2;
  float radius = 0.25 + (0.48 - 0.25) * expand1;
  float dist = length(CENTER - vUv);
  float gradient = (1.0 - clamp((radius - dist) / width, 0.0, 1.0)) * 0.8 * clamp((1.0 - abs(expand1 - 0.5) * 2.0) * 1.2, 0.0, 1.0);
  return vec4(1.0, 1.0, 1.0, gradient * expandOpacity * outside(radius));
}

void main() {
  #include <logdepthbuf_fragment>
  gl_FragColor = vec4(1.0, 1.0, 1.0, 0);

  vec4 expand1Color = create_expand1();
  gl_FragColor = mix(gl_FragColor, expand1Color, expand1Color.a);

  vec4 expand0Color = create_expand0();
  gl_FragColor = mix(gl_FragColor, expand0Color, expand0Color.a);

  vec4 circleColor = create_circle();
  gl_FragColor = mix(gl_FragColor, circleColor, circleColor.a);

  vec4 progressColor = create_progress();
  gl_FragColor = mix(gl_FragColor, progressColor, progressColor.a);

  vec4 loadingColor = create_loading();
  gl_FragColor = mix(gl_FragColor, loadingColor, loadingColor.a);

  gl_FragColor = mix(gl_FragColor, create_disable(), disable);

  gl_FragColor = vec4(gl_FragColor.rgb * baseColor, gl_FragColor.a * opacity * opacity);
}
`;(function(e){__extends(t,e);function t(r){r===void 0&&(r={});var n,o,s=e.call(this)||this,l=(n=r.color)!==null&&n!==void 0?n:16777215,u=(o=r.scale)!==null&&o!==void 0?o:1;return s.progress=0,s.opacity=0,s.loading=!1,s.current=!1,s.disabled=!1,s.currentMotion=new Motion({progress:0}),s.tapMotion=new Motion({scale:1,opacity:1}),s.loadingOpacityMotion=new Motion({opacity:0}),s.progressMotion=new Motion({progress:0}),s.progressOpacityMotion=new Motion({opacity:0}),s.opacityMotion=new Motion({opacity:0}),s.disableMotion=new Motion({progress:0}),s.panoMesh=new Mesh(sharedGeometry2$1,new ShaderMaterial({blending:CustomBlending,blendSrc:SrcAlphaFactor,blendDst:OneMinusSrcAlphaFactor,blendSrcAlpha:OneFactor,blendDstAlpha:OneMinusSrcAlphaFactor,depthWrite:!1,vertexShader:vertexShader$3,fragmentShader:fragmentShader$3,uniforms:{baseColor:{value:new Color(l)},circleScale:{value:1},circleOpacity:{value:1},loadingAngle:{value:0},loadingOpacity:{value:0},progress:{value:0},progressOpacity:{value:0},expand0:{value:0},expand1:{value:0},expandOpacity:{value:0},opacity:{value:0},tapScale:{value:1},tapOpacity:{value:1},disable:{value:0}}})),s.renderOrder=-2,s.panoMesh.renderOrder=-2,s.panoMesh.position.y=.004,s.panoMesh.scale.set(u,1,u),s.add(s.panoMesh),s.currentStartTime=now(),s.needsRender=!0,s}return t.prototype.setProgress=function(r){var n=this;this.setDisabled(!1),this.setLoading(!1),this.progress!==r&&(r=clamp$1(r,0,1),this.tapMotion.ended&&(this.progress===0&&this.progressOpacityMotion.set({opacity:1},500).catch(noop$1),r===0?this.progressOpacityMotion.set({opacity:0},500).catch(noop$1).then(function(){n.progressMotion.set({progress:0},0).catch(noop$1)}):this.progressMotion.set({progress:clamp$1(r*1.2,0,1)},100).catch(noop$1)),this.progress=r)},t.prototype.setOpacity=function(r){this.opacity!==r&&(this.opacity=r=clamp$1(r,0,1),this.opacityMotion.set({opacity:r},200).catch(noop$1))},t.prototype.setCurrent=function(r){this.current!==r&&(this.currentMotion.set({progress:r?1:0},2e3).catch(noop$1),this.current=r,this.current===!0&&(this.currentStartTime=now()))},t.prototype.setLoading=function(r){this.loading!==r&&(this.loading=r,this.disabled===!0&&this.setDisabled(!1),this.loadingOpacityMotion.set({opacity:r?1:0},500).catch(noop$1))},t.prototype.setDisabled=function(r){this.disabled!==r&&(this.disabled=r,this.loading===!0&&this.setLoading(!1),this.disableMotion.set({progress:r?1:0},500).catch(noop$1))},t.prototype.tap=function(){var r=this;if(!this.tapMotion.ended)return Promise.resolve();var n=[{progress:0,value:{scale:1,opacity:1}},{progress:.3,value:{scale:.85,opacity:.5}},{progress:.8,value:{scale:1.05,opacity:.6}},{progress:1,value:{scale:1,opacity:1}}];return this.progressOpacityMotion.set({opacity:0},0).catch(noop$1),this.progressMotion.set({progress:0},0).catch(noop$1),this.tapMotion.setKeyframes(n,600).then(function(){r.progressOpacityMotion.set({opacity:r.progress>0?1:0},300).catch(noop$1),r.progressMotion.set({progress:r.progress},120).catch(noop$1)}).catch(noop$1)},t.prototype.updateTime=function(r,n){if(!this.progressMotion.ended){this.progressMotion.update(r);var o=this.progressMotion.value.progress;this.panoMesh.material.uniforms.progress.value=o,this.needsRender=!0}if(!this.progressOpacityMotion.ended){this.progressOpacityMotion.update(r);var s=this.progressOpacityMotion.value.opacity;this.panoMesh.material.uniforms.progressOpacity.value=s,this.needsRender=!0}if(!this.opacityMotion.ended){this.opacityMotion.update(r);var s=this.opacityMotion.value.opacity;this.panoMesh.material.uniforms.opacity.value=s,this.needsRender=!0}if(this.visible=this.opacityMotion.value.opacity!==0,(!this.loadingOpacityMotion.ended||this.loadingOpacityMotion.value.opacity>0)&&(this.loadingOpacityMotion.update(r),this.panoMesh.material.uniforms.loadingOpacity.value=this.loadingOpacityMotion.value.opacity,this.panoMesh.material.uniforms.loadingAngle.value=r/120%(Math.PI*2),this.needsRender=!0),this.tapMotion.ended||(this.tapMotion.update(r),this.panoMesh.material.uniforms.tapOpacity.value=this.tapMotion.value.opacity,this.panoMesh.material.uniforms.tapScale.value=this.tapMotion.value.scale,this.needsRender=!0),this.panoMesh.material.uniforms.circleOpacity.value=Math.max(.6,1-Math.max(this.loadingOpacityMotion.value.opacity,this.progressOpacityMotion.value.opacity)),this.current||!this.currentMotion.ended){this.currentMotion.update(r),this.panoMesh.material.uniforms.expandOpacity.value=this.currentMotion.value.progress;{var l=(r-this.currentStartTime-1500)/2e3;if(l%5<2){var u=1+Math.sin(Math.PI*l)/25*this.currentMotion.value.progress;this.panoMesh.material.uniforms.circleScale.value=u,this.needsRender=!0}}{var c=(r-this.currentStartTime-1500)/2e3;if(c%5<2){var h=c%1;this.panoMesh.material.uniforms.expand0.value=easeOut$1(h)*this.currentMotion.value.progress,this.needsRender=!0}}{var f=(r-this.currentStartTime-1e3)/2e3;if(f%5<2){var h=f%1;this.panoMesh.material.uniforms.expand1.value=easeOut$1(h)*this.currentMotion.value.progress,this.needsRender=!0}}}if(!this.disableMotion.ended){var o=this.disableMotion.value.progress;this.disableMotion.update(r),this.panoMesh.material.uniforms.disable.value=o,this.needsRender=!0}},t.prototype.dispose=function(){this.tapMotion.dispose(),this.progressMotion.dispose(),this.progressOpacityMotion.dispose(),this.opacityMotion.dispose(),this.currentMotion.dispose(),this.panoMesh.material.dispose()},t})(Object3D);var easeOut=function(e){return e*(2-e)},sharedGeometry2=function(){var e=new Float32Array([-.18,0,-.18,.18,0,-.18,-.18,0,.18,.18,0,.18]),t=new Float32Array([1,0,0,0,1,1,0,1]),r=new Uint8Array([0,2,1,2,3,1]),n=new BufferGeometry;return n.setAttribute("position",new BufferAttribute(e,3)),n.setAttribute("uv",new BufferAttribute(t,2)),n.setIndex(new BufferAttribute(r,1)),n}(),vertexShader$2=`
varying vec2 vUv;
#include <common>
#include <logdepthbuf_pars_vertex>
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  #include <logdepthbuf_vertex>
}
`,fragmentShader$2=`
#if defined(USE_MAP)
uniform sampler2D map;
uniform float mapAlpha;
#endif
#if defined(USE_BORDER)
uniform float borderWidth;
uniform vec3 borderColor;
#endif
uniform vec3 baseColor;
uniform float circleScale;
uniform float circleOpacity;
uniform float loadingAngle;
uniform float loadingOpacity;
uniform float progress;
uniform float progressOpacity;
uniform float expand0;
uniform float expand1;
uniform float expandOpacity;
uniform float opacity;
uniform float tapScale;
uniform float tapOpacity;
uniform float disable;
varying vec2 vUv;

#include <common>
#include <logdepthbuf_pars_fragment>
#define SMOOTH_DIST 0.017
#define CENTER vec2(0.5, 0.5)

float inside(float innerDist) {
  float dist = length(CENTER - vUv);
  return smoothstep(innerDist, innerDist + SMOOTH_DIST, dist);
}
float outside(float outerDist) {
  float dist = length(CENTER - vUv);
  return 1.0 - smoothstep(outerDist - SMOOTH_DIST, outerDist, dist);
}

vec4 create_circle() {
  float dist = length(CENTER - vUv);
  float radius = 0.3 * circleScale * tapScale;
  #if defined(USE_MAP)
    float delta = radius / 0.5;
    vec2 deltaUv = (vUv - CENTER) / delta + CENTER;
    vec4 image = texture2D(map, deltaUv);
    image.a = image.a * mapAlpha;
    #if defined(USE_COLOR)
    image = vec4(baseColor, 1.0) * image;
    #endif
  #endif
  #if defined(USE_REVERSE)
    image = vec4(baseColor, 1.0 - image.a);
  #else
    #if defined(USE_BORDER)
      float borderDist = clamp(borderWidth, 0.0, 1.0);
      float clipAlpha = inside(radius - borderDist * radius);
      float gradient = clamp(borderWidth * 2.0 + abs(dot(normalize(vec2(1.0, -1.0)), vUv - CENTER)), 0.0, 1.0);
      vec4 borderColor = vec4(borderColor, clipAlpha * gradient);
      image = mix(borderColor, image, image.a);
    #endif
  #endif
  return vec4(image.rgb, image.a * circleOpacity * tapOpacity * outside(radius));
}

vec4 create_disable() {
  float dist = length(CENTER - vUv);
  return vec4(baseColor, 0.5 * tapOpacity * outside(0.32 * circleScale * tapScale));
}

vec4 create_loading() {
  float angle = PI - atan(CENTER.x - vUv.x, CENTER.y - vUv.y);
  angle = mod(angle + loadingAngle, PI2);
  float gradient = (1.0 - smoothstep(0.0, PI2, angle)) * 0.9 + 0.1;
  float radius = 0.3 * circleScale * tapScale;
  float inner = inside(radius - 0.2 * radius);
  #if defined(USE_BORDER)
    float borderDist = clamp(borderWidth, 0.0, 1.0);
    inner = inside(radius - borderDist * radius);
  #endif
  return vec4(baseColor, gradient * tapOpacity * loadingOpacity * inner * outside(radius));
}

vec4 create_progress() {
  float angle = PI + atan(CENTER.x - vUv.x, CENTER.y - vUv.y);
  float bar = (1.0 - step(progress * PI2, angle)) * 0.7;
  float radius = 0.3 * circleScale * tapScale;
  float inner = inside(radius - 0.2 * radius);
  #if defined(USE_BORDER)
    float borderDist = clamp(borderWidth, 0.0, 1.0);
    inner = inside(radius - borderDist * radius);
  #endif
  return vec4(baseColor, bar * tapOpacity * progressOpacity * inner * outside(radius));
}

vec4 create_expand0() {
  float width = 0.2;
  float radius = 0.25 + (0.5 - 0.25) * expand0;
  float dist = length(CENTER - vUv);
  float gradient = (1.0 - clamp((radius - dist) / width, 0.0, 1.0)) * 0.8 * clamp((1.0 - abs(expand0 - 0.5) * 2.0) * 1.2, 0.0, 1.0);
  return vec4(baseColor, gradient * expandOpacity * outside(radius));
}

vec4 create_expand1() {
  float width = 0.2;
  float radius = 0.25 + (0.48 - 0.25) * expand1;
  float dist = length(CENTER - vUv);
  float gradient = (1.0 - clamp((radius - dist) / width, 0.0, 1.0)) * 0.8 * clamp((1.0 - abs(expand1 - 0.5) * 2.0) * 1.2, 0.0, 1.0);
  return vec4(baseColor, gradient * expandOpacity * outside(radius));
}

void main() {
  #include <logdepthbuf_fragment>
  gl_FragColor = vec4(baseColor, 0);

  vec4 expand1Color = create_expand1();
  gl_FragColor = mix(gl_FragColor, expand1Color, expand1Color.a);

  vec4 expand0Color = create_expand0();
  gl_FragColor = mix(gl_FragColor, expand0Color, expand0Color.a);

  vec4 circleColor = create_circle();
  gl_FragColor = mix(gl_FragColor, circleColor, circleColor.a);

  vec4 progressColor = create_progress();
  gl_FragColor = mix(gl_FragColor, progressColor, progressColor.a);

  vec4 loadingColor = create_loading();
  gl_FragColor = mix(gl_FragColor, loadingColor, loadingColor.a);

  gl_FragColor = mix(gl_FragColor, create_disable(), disable);

  gl_FragColor = vec4(gl_FragColor.rgb, gl_FragColor.a * opacity);
}
`;(function(e){__extends(t,e);function t(r){r===void 0&&(r={});var n,o,s,l,u,c,h,f=e.call(this)||this,m=(n=r.color)!==null&&n!==void 0?n:16777215,y=(o=r.scale)!==null&&o!==void 0?o:1,A=r.map,M=(s=r.mapAlpha)!==null&&s!==void 0?s:1,b=(l=r.mapUseColor)!==null&&l!==void 0?l:!1,T=(u=r.mapUseReverse)!==null&&u!==void 0?u:!1,_=(c=r.borderWidth)!==null&&c!==void 0?c:.1,S=(h=r.borderColor)!==null&&h!==void 0?h:16777215;return f.progress=0,f.opacity=0,f.loading=!1,f.current=!1,f.disabled=!1,f.currentMotion=new Motion({progress:0}),f.tapMotion=new Motion({scale:1,opacity:1}),f.loadingOpacityMotion=new Motion({opacity:0}),f.progressMotion=new Motion({progress:0}),f.progressOpacityMotion=new Motion({opacity:0}),f.opacityMotion=new Motion({opacity:0}),f.disableMotion=new Motion({progress:0}),f.panoMesh=new Mesh(sharedGeometry2,new ShaderMaterial({blending:CustomBlending,blendSrc:SrcAlphaFactor,blendDst:OneMinusSrcAlphaFactor,blendSrcAlpha:OneFactor,blendDstAlpha:OneMinusSrcAlphaFactor,depthWrite:!1,vertexShader:vertexShader$2,fragmentShader:fragmentShader$2,defines:{USE_COLOR:b,USE_MAP:A!==void 0,USE_BORDER:_>0,USE_REVERSE:T},uniforms:{baseColor:{value:new Color(m)},circleScale:{value:1},circleOpacity:{value:1},loadingAngle:{value:0},loadingOpacity:{value:0},progress:{value:0},progressOpacity:{value:0},expand0:{value:0},expand1:{value:0},expandOpacity:{value:0},opacity:{value:0},tapScale:{value:1},tapOpacity:{value:1},disable:{value:0},map:{value:A},mapAlpha:{value:M},borderWidth:{value:_},borderColor:{value:new Color(S)}}})),f.renderOrder=-2,f.panoMesh.renderOrder=-2,f.panoMesh.position.y=.004,f.panoMesh.scale.set(y,1,y),f.add(f.panoMesh),f.currentStartTime=now(),f.needsRender=!0,f}return t.prototype.setProgress=function(r){var n=this;this.setDisabled(!1),this.setLoading(!1),this.progress!==r&&(r=clamp$1(r,0,1),this.tapMotion.ended&&(this.progress===0&&this.progressOpacityMotion.set({opacity:1},500).catch(noop$1),r===0?this.progressOpacityMotion.set({opacity:0},500).catch(noop$1).then(function(){n.progressMotion.set({progress:0},0).catch(noop$1)}):this.progressMotion.set({progress:clamp$1(r*1.2,0,1)},100).catch(noop$1)),this.progress=r)},t.prototype.setOpacity=function(r){this.opacity!==r&&(this.opacity=r=clamp$1(r,0,1),this.opacityMotion.set({opacity:r},200).catch(noop$1))},t.prototype.setCurrent=function(r){this.current!==r&&(this.currentMotion.set({progress:r?1:0},2e3).catch(noop$1),this.current=r,this.current===!0&&(this.currentStartTime=now()))},t.prototype.setLoading=function(r){this.loading!==r&&(this.loading=r,this.disabled===!0&&this.setDisabled(!1),this.loadingOpacityMotion.set({opacity:r?1:0},500).catch(noop$1))},t.prototype.setDisabled=function(r){this.disabled!==r&&(this.disabled=r,this.loading===!0&&this.setLoading(!1),this.disableMotion.set({progress:r?1:0},500).catch(noop$1))},t.prototype.tap=function(){var r=this;if(!this.tapMotion.ended)return Promise.resolve();var n=[{progress:0,value:{scale:1,opacity:1}},{progress:.3,value:{scale:.85,opacity:.5}},{progress:.8,value:{scale:1.05,opacity:.6}},{progress:1,value:{scale:1,opacity:1}}];return this.progressOpacityMotion.set({opacity:0},0).catch(noop$1),this.progressMotion.set({progress:0},0).catch(noop$1),this.tapMotion.setKeyframes(n,600).then(function(){r.progressOpacityMotion.set({opacity:r.progress>0?1:0},300).catch(noop$1),r.progressMotion.set({progress:r.progress},120).catch(noop$1)}).catch(noop$1)},t.prototype.updateTime=function(r,n){if(!this.progressMotion.ended){this.progressMotion.update(r);var o=this.progressMotion.value.progress;this.panoMesh.material.uniforms.progress.value=o,this.needsRender=!0}if(!this.progressOpacityMotion.ended){this.progressOpacityMotion.update(r);var s=this.progressOpacityMotion.value.opacity;this.panoMesh.material.uniforms.progressOpacity.value=s,this.needsRender=!0}if(!this.opacityMotion.ended){this.opacityMotion.update(r);var s=this.opacityMotion.value.opacity;this.panoMesh.material.uniforms.opacity.value=s,this.needsRender=!0}if(this.visible=this.opacityMotion.value.opacity!==0,(!this.loadingOpacityMotion.ended||this.loadingOpacityMotion.value.opacity>0)&&(this.loadingOpacityMotion.update(r),this.panoMesh.material.uniforms.loadingOpacity.value=this.loadingOpacityMotion.value.opacity,this.panoMesh.material.uniforms.loadingAngle.value=r/120%(Math.PI*2),this.needsRender=!0),this.tapMotion.ended||(this.tapMotion.update(r),this.panoMesh.material.uniforms.tapOpacity.value=this.tapMotion.value.opacity,this.panoMesh.material.uniforms.tapScale.value=this.tapMotion.value.scale,this.needsRender=!0),this.panoMesh.material.uniforms.circleOpacity.value=Math.max(.6,1-Math.max(this.loadingOpacityMotion.value.opacity,this.progressOpacityMotion.value.opacity)),this.current||!this.currentMotion.ended){this.currentMotion.update(r),this.panoMesh.material.uniforms.expandOpacity.value=this.currentMotion.value.progress;{var l=(r-this.currentStartTime-1500)/2e3;if(l%5<2){var u=l%1;this.panoMesh.material.uniforms.expand0.value=easeOut(u)*this.currentMotion.value.progress,this.needsRender=!0}}{var c=(r-this.currentStartTime-1e3)/2e3;if(c%5<2){var u=c%1;this.panoMesh.material.uniforms.expand1.value=easeOut(u)*this.currentMotion.value.progress,this.needsRender=!0}}}if(!this.disableMotion.ended){var o=this.disableMotion.value.progress;this.disableMotion.update(r),this.panoMesh.material.uniforms.disable.value=o,this.needsRender=!0}},t.prototype.dispose=function(){this.tapMotion.dispose(),this.progressMotion.dispose(),this.progressOpacityMotion.dispose(),this.opacityMotion.dispose(),this.currentMotion.dispose(),this.panoMesh.material.dispose()},t})(Object3D);var sharedGeometry$2=new CircleBufferGeometry(.1,16),vertexShader$1=`
varying vec2 vUv;
#include <common>
#include <logdepthbuf_pars_vertex>
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  #include <logdepthbuf_vertex>
}
`,fragmentShader$1=`
varying vec2 vUv;
#include <common>
#include <logdepthbuf_pars_fragment>

float smoothDist = 0.01;
void main() {
  #include <logdepthbuf_fragment>
  vec2 center = vec2(0.5, 0.5);
  float dist = length(center - vUv);
  float outerDist = 0.49;
  float innerDist = 0.29;

  float outside = 1.0 - smoothstep(outerDist - smoothDist, outerDist, dist);
  float inside = smoothstep(innerDist, innerDist + smoothDist, dist);

  vec4 bg = vec4(0.576, 0.635, 1.0, 0.3);
  float gradientAlpha = clamp(abs(dist - (outerDist + innerDist) / 2.0) / (outerDist - innerDist) * 1.5 + 0.1, 0.0, 1.0);
  vec4 gradient = vec4(1.0, 1.0, 1.0, gradientAlpha);

  gl_FragColor = mix(bg, gradient, gradient.a);

  gl_FragColor = vec4(gl_FragColor.rgb, gl_FragColor.a * outside * inside);
}
`,sharedMaterial=new ShaderMaterial({vertexShader:vertexShader$1,fragmentShader:fragmentShader$1,side:DoubleSide,blending:CustomBlending,blendSrc:SrcAlphaFactor,blendDst:OneMinusSrcAlphaFactor,blendSrcAlpha:OneFactor,blendDstAlpha:OneMinusSrcAlphaFactor,depthWrite:!1}),IntersectMesh=function(e){__extends(t,e);function t(){var r=e.call(this)||this;return r.ringMesh=new Mesh(sharedGeometry$2,sharedMaterial),r.ringMesh.position.z=.01,r.ringMesh.renderOrder=-2,r.add(r.ringMesh),r}return t.prototype.dispose=function(){this.remove(this.ringMesh)},t}(Object3D);function isSimilarValue(e,t,r){var n=Math.abs(e-t);return n<.001||typeof r<"u"&&Math.abs(r-n)<.001}function notSimilarValue(e,t,r){return!isSimilarValue(e,t,r)}function isSimilarVector3(e,t){return e.distanceTo(t)<.001}function notSimilarVector3(e,t){return!isSimilarVector3(e,t)}var DEFAULT_OFFSET_VECTOR=new Vector3(0,0,0),BoundingMesh=function(e){__extends(t,e);function t(r,n){n===void 0&&(n=DEFAULT_OFFSET_VECTOR);var o=this,s=new BoxBufferGeometry(r.max.x-r.min.x+n.x*2,r.max.y-r.min.y+n.y*2,r.max.z-r.min.z+n.z*2,1,1);s.clearGroups(),s.addGroup(0,s.index?s.index.count:s.attributes.position.count,0),s.applyMatrix4(new Matrix4().makeScale(-1,1,1)),s.computeVertexNormals();var l=new PBMMeshMaterial("none");return l.refreshUniforms(),o=e.call(this,s,[l])||this,o.position.copy(r.getCenter(new Vector3)),o.frustumCulled=!1,o.boundingBox=new Box3,o.boundingBox.setFromObject(o),o.renderOrder=-1001,o}return t}(PBMMesh);function generateBoundingMesh(e,t){return t===void 0&&(t=DEFAULT_OFFSET_VECTOR),new BoundingMesh(e,t)}function cameraWorldToLocal(e,t){var r=new Vector3(0,0,-1);r.applyQuaternion(e.quaternion);var n=t.quaternion.clone().inverse();r.applyQuaternion(n);var o=Math.atan2(r.x,-r.z),s=-Math.asin(r.y);return{theta:o,phi:s,lookAtVector:r}}var TAU$1=Math.PI*2;function formatRad(e){return e>=0&&e<TAU$1?e:(e%TAU$1+TAU$1)%TAU$1}var PI=Math.PI,TAU=PI*2;function stepNumber(e,t,r){if(e===t)return t;var n=t-e,o=Math.abs(n);if(o<=r)return t;var s=n>0?1:-1;return e+s*r}function stepVector(e,t,r){if(e.equals(t))return new Vector3().copy(t);var n=new Vector3().subVectors(t,e);return n.lengthSq()<r*r?n.copy(t):n.setLength(r).add(e)}function stepCoordinates(e,t,r){if(e.longitude===t.longitude&&e.latitude===t.latitude)return{longitude:t.longitude,latitude:t.latitude};var n=formatRad(e.longitude),o=e.latitude,s=formatRad(t.longitude),l=t.latitude;s-n>PI?n+=TAU:n-s>PI&&(n-=TAU);var u=Math.sqrt(Math.pow(s-n,2)+Math.pow(l-o,2)),c=r/u;return c>=1?{longitude:t.longitude,latitude:t.latitude}:{longitude:n+(s-n)*c,latitude:o+(l-o)*c}}function isPromise(e){return!!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function"}var _a$2,userAgent=typeof navigator<"u"?((_a$2=navigator==null?void 0:navigator.userAgent)!==null&&_a$2!==void 0?_a$2:"").toLowerCase():"node";(function(){try{var e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch{return!1}})();var isMobile=/android/i.test(userAgent)||/webos/i.test(userAgent)||/ipad|iphone|ipod/i.test(userAgent)||/iemobile/i.test(userAgent)||/opera mini/i.test(userAgent)||/blackberry/i.test(userAgent)||/windows phone/i.test(userAgent);function createEvent(e,t){for(var r=!1,n={type:e,timeStamp:now(),get defaultPrevented(){return r},preventDefault:function(){r=!0}},o=0,s=Object.keys(t);o<s.length;o++){var l=s[o];l in n||(n[l]=t[l])}return n}function requestDeviceOrientationPermission(){return typeof location>"u"||location.protocol!=="https:"?Promise.reject(new Error("Request DeviceOrientation Permission denied.")):typeof DeviceOrientationEvent<"u"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(e){if(e=="granted")return Promise.resolve();var t=new Error("Request DeviceOrientation Permission denied.");return Promise.reject(t)}):Promise.resolve()}function requestXRSessionPermission(){if("xr"in navigator)return navigator.xr.isSessionSupported("immersive-vr").then(function(t){return t?Promise.resolve():Promise.reject()}).then(function(){var t={optionalFeatures:["local-floor"]};return navigator.xr.requestSession("immersive-vr",t).then(function(r){return Promise.resolve(r)})});var e=new Error("Request XR Permission denied.");return Promise.reject(e)}function assignState(e,t){e.mode=t.mode,e.workCode=t.workCode,e.panoIndex=t.panoIndex,e.longitude=t.longitude,e.latitude=t.latitude,e.fov=t.fov,e.offset.copy(t.offset),e.distance=t.distance}function stateEqual(e,t){return e.workCode===t.workCode&&e.mode===t.mode&&e.panoIndex===t.panoIndex&&isSimilarValue(e.longitude,t.longitude,Math.PI*2)&&isSimilarValue(e.latitude,t.latitude)&&isSimilarValue(e.fov,t.fov)&&isSimilarVector3(e.offset,t.offset)&&isSimilarValue(e.distance,t.distance)}function assignPose(e,t){e.longitude=t.longitude,e.latitude=t.latitude,e.fov=t.fov,e.distance=t.distance,e.offset.copy(t.offset)}function clonePose(e){return{longitude:e.longitude,latitude:e.latitude,fov:e.fov,offset:e.offset.clone(),distance:e.distance}}function omitUndefinedFields(e){var t={};for(var r in e){var n=e[r];n!==void 0&&(t[r]=n)}return t}var defaultIterator=function(e){return Number(e)};function arrayMin(e,t,r){var n;t===void 0&&(t=defaultIterator),r===void 0&&(r=!1);for(var o,s=1/0,l=0,u=e;l<u.length;l++){var c=u[l],h=t(c);h<=s&&(n=[c,h],o=n[0],s=n[1])}return isFinite(s)||(s=0),r?[o,s]:o}function isEmptyObject(e){for(var t in e)return!1;return!0}/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var Hammer=function(e,t,r,n){var o=["","webkit","Moz","MS","ms","o"],s=t.createElement?t.createElement("div"):n,l="function",u=Math.round,c=Math.abs,h=Date.now;function f(Y,ne,me){return setTimeout(S(Y,me),ne)}function m(Y,ne,me){return Array.isArray(Y)?(y(Y,me[ne],me),!0):!1}function y(Y,ne,me){var Ee;if(Y)if(Y.forEach)Y.forEach(ne,me);else if(Y.length!==n)for(Ee=0;Ee<Y.length;)ne.call(me,Y[Ee],Ee,Y),Ee++;else for(Ee in Y)Y.hasOwnProperty(Ee)&&ne.call(me,Y[Ee],Ee,Y)}function A(Y,ne,me){var Ee="DEPRECATED METHOD: "+ne+`
`+me+` AT 
`;return function(){var Xe=new Error("get-stack-trace"),_t=Xe&&Xe.stack?Xe.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Bt=e.console&&(e.console.warn||e.console.log);return Bt&&Bt.call(e.console,Ee,_t),Y.apply(this,arguments)}}var M;typeof Object.assign!="function"?M=function(Y){if(Y===n||Y===null)throw new TypeError("Cannot convert undefined or null to object");for(var ne=Object(Y),me=1;me<arguments.length;me++){var Ee=arguments[me];if(Ee!==n&&Ee!==null)for(var Xe in Ee)Ee.hasOwnProperty(Xe)&&(ne[Xe]=Ee[Xe])}return ne}:M=Object.assign;var b=A(function(Y,ne,me){for(var Ee=Object.keys(ne),Xe=0;Xe<Ee.length;)(!me||me&&Y[Ee[Xe]]===n)&&(Y[Ee[Xe]]=ne[Ee[Xe]]),Xe++;return Y},"extend","Use `assign`."),T=A(function(Y,ne){return b(Y,ne,!0)},"merge","Use `assign`.");function _(Y,ne,me){var Ee=ne.prototype,Xe;Xe=Y.prototype=Object.create(Ee),Xe.constructor=Y,Xe._super=Ee,me&&M(Xe,me)}function S(Y,ne){return function(){return Y.apply(ne,arguments)}}function C(Y,ne){return typeof Y==l?Y.apply(ne&&ne[0]||n,ne):Y}function P(Y,ne){return Y===n?ne:Y}function F(Y,ne,me){y(q(ne),function(Ee){Y.addEventListener(Ee,me,!1)})}function O(Y,ne,me){y(q(ne),function(Ee){Y.removeEventListener(Ee,me,!1)})}function N(Y,ne){for(;Y;){if(Y==ne)return!0;Y=Y.parentNode}return!1}function V(Y,ne){return Y.indexOf(ne)>-1}function q(Y){return Y.trim().split(/\s+/g)}function Q(Y,ne,me){if(Y.indexOf&&!me)return Y.indexOf(ne);for(var Ee=0;Ee<Y.length;){if(me&&Y[Ee][me]==ne||!me&&Y[Ee]===ne)return Ee;Ee++}return-1}function z(Y){return Array.prototype.slice.call(Y,0)}function H(Y,ne,me){for(var Ee=[],Xe=[],_t=0;_t<Y.length;){var Bt=Y[_t][ne];Q(Xe,Bt)<0&&Ee.push(Y[_t]),Xe[_t]=Bt,_t++}return Ee=Ee.sort(function($t,ir){return $t[ne]>ir[ne]}),Ee}function W(Y,ne){for(var me,Ee,Xe=ne[0].toUpperCase()+ne.slice(1),_t=0;_t<o.length;){if(me=o[_t],Ee=me?me+Xe:ne,Ee in Y)return Ee;_t++}return n}var J=1;function G(){return J++}function te(Y){var ne=Y.ownerDocument||Y;return ne.defaultView||ne.parentWindow||e}var X=/mobile|tablet|ip(ad|hone|od)|android/i,K="ontouchstart"in e,Z=W(e,"PointerEvent")!==n,ee=K&&X.test(navigator.userAgent),j="touch",re="pen",pe="mouse",ge="kinect",_e=25,he=1,Fe=2,Re=4,Le=8,Se=1,we=2,Ve=4,je=8,st=16,We=we|Ve,bt=je|st,oe=We|bt,ue=["x","y"],Qe=["clientX","clientY"];function Me(Y,ne){var me=this;this.manager=Y,this.callback=ne,this.element=Y.element,this.target=Y.options.inputTarget,this.domHandler=function(Ee){C(Y.options.enable,[Y])&&me.handler(Ee)},this.init()}Me.prototype={handler:function(){},init:function(){this.evEl&&F(this.element,this.evEl,this.domHandler),this.evTarget&&F(this.target,this.evTarget,this.domHandler),this.evWin&&F(te(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&O(this.element,this.evEl,this.domHandler),this.evTarget&&O(this.target,this.evTarget,this.domHandler),this.evWin&&O(te(this.element),this.evWin,this.domHandler)}};function De(Y){var ne,me=Y.options.inputClass;return me?ne=me:Z?ne=Nt:ee?ne=Ne:K?ne=ut:ne=Pt,new ne(Y,be)}function be(Y,ne,me){var Ee=me.pointers.length,Xe=me.changedPointers.length,_t=ne&he&&Ee-Xe===0,Bt=ne&(Re|Le)&&Ee-Xe===0;me.isFirst=!!_t,me.isFinal=!!Bt,_t&&(Y.session={}),me.eventType=ne,ze(Y,me),Y.emit("hammer.input",me),Y.recognize(me),Y.session.prevInput=me}function ze(Y,ne){var me=Y.session,Ee=ne.pointers,Xe=Ee.length;me.firstInput||(me.firstInput=nt(ne)),Xe>1&&!me.firstMultiple?me.firstMultiple=nt(ne):Xe===1&&(me.firstMultiple=!1);var _t=me.firstInput,Bt=me.firstMultiple,$t=Bt?Bt.center:_t.center,ir=ne.center=Ue(Ee);ne.timeStamp=h(),ne.deltaTime=ne.timeStamp-_t.timeStamp,ne.angle=ve($t,ir),ne.distance=ke($t,ir),at(me,ne),ne.offsetDirection=qe(ne.deltaX,ne.deltaY);var gr=He(ne.deltaTime,ne.deltaX,ne.deltaY);ne.overallVelocityX=gr.x,ne.overallVelocityY=gr.y,ne.overallVelocity=c(gr.x)>c(gr.y)?gr.x:gr.y,ne.scale=Bt?tt(Bt.pointers,Ee):1,ne.rotation=Bt?Ye(Bt.pointers,Ee):0,ne.maxPointers=me.prevInput?ne.pointers.length>me.prevInput.maxPointers?ne.pointers.length:me.prevInput.maxPointers:ne.pointers.length,ot(me,ne);var Mr=Y.element;N(ne.srcEvent.target,Mr)&&(Mr=ne.srcEvent.target),ne.target=Mr}function at(Y,ne){var me=ne.center,Ee=Y.offsetDelta||{},Xe=Y.prevDelta||{},_t=Y.prevInput||{};(ne.eventType===he||_t.eventType===Re)&&(Xe=Y.prevDelta={x:_t.deltaX||0,y:_t.deltaY||0},Ee=Y.offsetDelta={x:me.x,y:me.y}),ne.deltaX=Xe.x+(me.x-Ee.x),ne.deltaY=Xe.y+(me.y-Ee.y)}function ot(Y,ne){var me=Y.lastInterval||ne,Ee=ne.timeStamp-me.timeStamp,Xe,_t,Bt,$t;if(ne.eventType!=Le&&(Ee>_e||me.velocity===n)){var ir=ne.deltaX-me.deltaX,gr=ne.deltaY-me.deltaY,Mr=He(Ee,ir,gr);_t=Mr.x,Bt=Mr.y,Xe=c(Mr.x)>c(Mr.y)?Mr.x:Mr.y,$t=qe(ir,gr),Y.lastInterval=ne}else Xe=me.velocity,_t=me.velocityX,Bt=me.velocityY,$t=me.direction;ne.velocity=Xe,ne.velocityX=_t,ne.velocityY=Bt,ne.direction=$t}function nt(Y){for(var ne=[],me=0;me<Y.pointers.length;)ne[me]={clientX:u(Y.pointers[me].clientX),clientY:u(Y.pointers[me].clientY)},me++;return{timeStamp:h(),pointers:ne,center:Ue(ne),deltaX:Y.deltaX,deltaY:Y.deltaY}}function Ue(Y){var ne=Y.length;if(ne===1)return{x:u(Y[0].clientX),y:u(Y[0].clientY)};for(var me=0,Ee=0,Xe=0;Xe<ne;)me+=Y[Xe].clientX,Ee+=Y[Xe].clientY,Xe++;return{x:u(me/ne),y:u(Ee/ne)}}function He(Y,ne,me){return{x:ne/Y||0,y:me/Y||0}}function qe(Y,ne){return Y===ne?Se:c(Y)>=c(ne)?Y<0?we:Ve:ne<0?je:st}function ke(Y,ne,me){me||(me=ue);var Ee=ne[me[0]]-Y[me[0]],Xe=ne[me[1]]-Y[me[1]];return Math.sqrt(Ee*Ee+Xe*Xe)}function ve(Y,ne,me){me||(me=ue);var Ee=ne[me[0]]-Y[me[0]],Xe=ne[me[1]]-Y[me[1]];return Math.atan2(Xe,Ee)*180/Math.PI}function Ye(Y,ne){return ve(ne[1],ne[0],Qe)+ve(Y[1],Y[0],Qe)}function tt(Y,ne){return ke(ne[0],ne[1],Qe)/ke(Y[0],Y[1],Qe)}var xt={mousedown:he,mousemove:Fe,mouseup:Re},Ze="mousedown",lt="mousemove mouseup";function Pt(){this.evEl=Ze,this.evWin=lt,this.pressed=!1,Me.apply(this,arguments)}_(Pt,Me,{handler:function(Y){var ne=xt[Y.type];ne&he&&(Y.button===0||Y.button===2)&&(this.pressed=!0),ne&Fe&&Y.which!==1&&(ne=Re),this.pressed&&(ne&Re&&(this.pressed=!1),this.callback(this.manager,ne,{pointers:[Y],changedPointers:[Y],pointerType:pe,srcEvent:Y}))}});var Lt={pointerdown:he,pointermove:Fe,pointerup:Re,pointercancel:Le,pointerout:Le},Gt={2:j,3:re,4:pe,5:ge},Rt="pointerdown",Ft="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Rt="MSPointerDown",Ft="MSPointerMove MSPointerUp MSPointerCancel");function Nt(){this.evEl=Rt,this.evWin=Ft,Me.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}_(Nt,Me,{handler:function(Y){var ne=this.store,me=!1,Ee=!1,Xe=Y.type.toLowerCase().replace("ms",""),_t=Lt[Xe],Bt=Gt[Y.pointerType]||Y.pointerType,$t=Bt==j,ir=Q(ne,Y.pointerId,"pointerId");_t&he&&(Y.button===0||Y.button===2||$t)?ir<0&&(ne.push(Y),ir=ne.length-1):_t&(Re|Le)?me=!0:!$t&&Y.buttons===0&&(me=!0,Ee=!0,_t=Lt.pointerup),!(ir<0)&&(Ee||(ne[ir]=Y),this.callback(this.manager,_t,{pointers:ne,changedPointers:[Y],pointerType:Bt,srcEvent:ne[ir]}),me&&ne.splice(ir,1))}});var Ht={touchstart:he,touchmove:Fe,touchend:Re,touchcancel:Le},or="touchstart",Xt="touchstart touchmove touchend touchcancel";function Zt(){this.evTarget=or,this.evWin=Xt,this.started=!1,Me.apply(this,arguments)}_(Zt,Me,{handler:function(Y){var ne=Ht[Y.type];if(ne===he&&(this.started=!0),!!this.started){var me=ae.call(this,Y,ne);ne&(Re|Le)&&me[0].length-me[1].length===0&&(this.started=!1),this.callback(this.manager,ne,{pointers:me[0],changedPointers:me[1],pointerType:j,srcEvent:Y})}}});function ae(Y,ne){var me=z(Y.touches),Ee=z(Y.changedTouches);return ne&(Re|Le)&&(me=H(me.concat(Ee),"identifier")),[me,Ee]}var Pe={touchstart:he,touchmove:Fe,touchend:Re,touchcancel:Le},Te="touchstart touchmove touchend touchcancel";function Ne(){this.evTarget=Te,this.targetIds={},Me.apply(this,arguments)}_(Ne,Me,{handler:function(Y){var ne=Pe[Y.type],me=it.call(this,Y,ne);me&&this.callback(this.manager,ne,{pointers:me[0],changedPointers:me[1],pointerType:j,srcEvent:Y})}});function it(Y,ne){var me=z(Y.touches),Ee=this.targetIds;if(ne&(he|Fe)&&me.length===1)return Ee[me[0].identifier]=!0,[me,me];var Xe,_t,Bt=z(Y.changedTouches),$t=[],ir=this.target;if(_t=me.filter(function(gr){return N(gr.target,ir)}),ne===he)for(Xe=0;Xe<_t.length;)Ee[_t[Xe].identifier]=!0,Xe++;for(Xe=0;Xe<Bt.length;)Ee[Bt[Xe].identifier]&&$t.push(Bt[Xe]),ne&(Re|Le)&&delete Ee[Bt[Xe].identifier],Xe++;if($t.length)return[H(_t.concat($t),"identifier"),$t]}var ft=2500,gt=25;function ut(){Me.apply(this,arguments);var Y=S(this.handler,this);this.touch=new Ne(this.manager,Y),this.mouse=new Pt(this.manager,Y),this.primaryTouch=null,this.lastTouches=[]}_(ut,Me,{handler:function(Y,ne,me){var Ee=me.pointerType==j,Xe=me.pointerType==pe;if(!(Xe&&me.sourceCapabilities&&me.sourceCapabilities.firesTouchEvents)){if(Ee)vt.call(this,ne,me);else if(Xe&&Ot.call(this,me))return;this.callback(Y,ne,me)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function vt(Y,ne){Y&he?(this.primaryTouch=ne.changedPointers[0].identifier,yt.call(this,ne)):Y&(Re|Le)&&yt.call(this,ne)}function yt(Y){var ne=Y.changedPointers[0];if(ne.identifier===this.primaryTouch){var me={x:ne.clientX,y:ne.clientY};this.lastTouches.push(me);var Ee=this.lastTouches,Xe=function(){var _t=Ee.indexOf(me);_t>-1&&Ee.splice(_t,1)};setTimeout(Xe,ft)}}function Ot(Y){for(var ne=Y.srcEvent.clientX,me=Y.srcEvent.clientY,Ee=0;Ee<this.lastTouches.length;Ee++){var Xe=this.lastTouches[Ee],_t=Math.abs(ne-Xe.x),Bt=Math.abs(me-Xe.y);if(_t<=gt&&Bt<=gt)return!0}return!1}var It=s?W(s.style,"touchAction"):n,Tt=It!==n,ht="compute",St="auto",zt="manipulation",Dt="none",Et="pan-x",jt="pan-y",kt=Dn();function pr(Y,ne){this.manager=Y,this.set(ne)}pr.prototype={set:function(Y){Y==ht&&(Y=this.compute()),Tt&&this.manager.element.style&&kt[Y]&&(this.manager.element.style[It]=Y),this.actions=Y.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Y=[];return y(this.manager.recognizers,function(ne){C(ne.options.enable,[ne])&&(Y=Y.concat(ne.getTouchAction()))}),fr(Y.join(" "))},preventDefaults:function(Y){var ne=Y.srcEvent,me=Y.offsetDirection;if(this.manager.session.prevented){ne.preventDefault();return}var Ee=this.actions,Xe=V(Ee,Dt)&&!kt[Dt],_t=V(Ee,jt)&&!kt[jt],Bt=V(Ee,Et)&&!kt[Et];if(Xe){var $t=Y.pointers.length===1,ir=Y.distance<2,gr=Y.deltaTime<250;if($t&&ir&&gr)return}if(!(Bt&&_t)&&(Xe||_t&&me&We||Bt&&me&bt))return this.preventSrc(ne)},preventSrc:function(Y){this.manager.session.prevented=!0,Y.preventDefault()}};function fr(Y){if(V(Y,Dt))return Dt;var ne=V(Y,Et),me=V(Y,jt);return ne&&me?Dt:ne||me?ne?Et:jt:V(Y,zt)?zt:St}function Dn(){if(!Tt)return!1;var Y={},ne=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(me){Y[me]=ne?e.CSS.supports("touch-action",me):!0}),Y}var pn=1,Vt=2,fn=4,Or=8,Dr=Or,Yr=16,kr=32;function Nr(Y){this.options=M({},this.defaults,Y||{}),this.id=G(),this.manager=null,this.options.enable=P(this.options.enable,!0),this.state=pn,this.simultaneous={},this.requireFail=[]}Nr.prototype={defaults:{},set:function(Y){return M(this.options,Y),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Y){if(m(Y,"recognizeWith",this))return this;var ne=this.simultaneous;return Y=Zn(Y,this),ne[Y.id]||(ne[Y.id]=Y,Y.recognizeWith(this)),this},dropRecognizeWith:function(Y){return m(Y,"dropRecognizeWith",this)?this:(Y=Zn(Y,this),delete this.simultaneous[Y.id],this)},requireFailure:function(Y){if(m(Y,"requireFailure",this))return this;var ne=this.requireFail;return Y=Zn(Y,this),Q(ne,Y)===-1&&(ne.push(Y),Y.requireFailure(this)),this},dropRequireFailure:function(Y){if(m(Y,"dropRequireFailure",this))return this;Y=Zn(Y,this);var ne=Q(this.requireFail,Y);return ne>-1&&this.requireFail.splice(ne,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Y){return!!this.simultaneous[Y.id]},emit:function(Y){var ne=this,me=this.state;function Ee(Xe){ne.manager.emit(Xe,Y)}me<Or&&Ee(ne.options.event+kn(me)),Ee(ne.options.event),Y.additionalEvent&&Ee(Y.additionalEvent),me>=Or&&Ee(ne.options.event+kn(me))},tryEmit:function(Y){if(this.canEmit())return this.emit(Y);this.state=kr},canEmit:function(){for(var Y=0;Y<this.requireFail.length;){if(!(this.requireFail[Y].state&(kr|pn)))return!1;Y++}return!0},recognize:function(Y){var ne=M({},Y);if(!C(this.options.enable,[this,ne])){this.reset(),this.state=kr;return}this.state&(Dr|Yr|kr)&&(this.state=pn),this.state=this.process(ne),this.state&(Vt|fn|Or|Yr)&&this.tryEmit(ne)},process:function(Y){},getTouchAction:function(){},reset:function(){}};function kn(Y){return Y&Yr?"cancel":Y&Or?"end":Y&fn?"move":Y&Vt?"start":""}function Rr(Y){return Y==st?"down":Y==je?"up":Y==we?"left":Y==Ve?"right":""}function Zn(Y,ne){var me=ne.manager;return me?me.get(Y):Y}function Yt(){Nr.apply(this,arguments)}_(Yt,Nr,{defaults:{pointers:1},attrTest:function(Y){var ne=this.options.pointers;return ne===0||Y.pointers.length===ne},process:function(Y){var ne=this.state,me=Y.eventType,Ee=ne&(Vt|fn),Xe=this.attrTest(Y);return Ee&&(me&Le||!Xe)?ne|Yr:Ee||Xe?me&Re?ne|Or:ne&Vt?ne|fn:Vt:kr}});function Yn(){Yt.apply(this,arguments),this.pX=null,this.pY=null}_(Yn,Yt,{defaults:{event:"pan",threshold:10,pointers:1,direction:oe},getTouchAction:function(){var Y=this.options.direction,ne=[];return Y&We&&ne.push(jt),Y&bt&&ne.push(Et),ne},directionTest:function(Y){var ne=this.options,me=!0,Ee=Y.distance,Xe=Y.direction,_t=Y.deltaX,Bt=Y.deltaY;return Xe&ne.direction||(ne.direction&We?(Xe=_t===0?Se:_t<0?we:Ve,me=_t!=this.pX,Ee=Math.abs(Y.deltaX)):(Xe=Bt===0?Se:Bt<0?je:st,me=Bt!=this.pY,Ee=Math.abs(Y.deltaY))),Y.direction=Xe,me&&Ee>ne.threshold&&Xe&ne.direction},attrTest:function(Y){return Yt.prototype.attrTest.call(this,Y)&&(this.state&Vt||!(this.state&Vt)&&this.directionTest(Y))},emit:function(Y){this.pX=Y.deltaX,this.pY=Y.deltaY;var ne=Rr(Y.direction);ne&&(Y.additionalEvent=this.options.event+ne),this._super.emit.call(this,Y)}});function xi(){Yt.apply(this,arguments)}_(xi,Yt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Dt]},attrTest:function(Y){return this._super.attrTest.call(this,Y)&&(Math.abs(Y.scale-1)>this.options.threshold||this.state&Vt)},emit:function(Y){if(Y.scale!==1){var ne=Y.scale<1?"in":"out";Y.additionalEvent=this.options.event+ne}this._super.emit.call(this,Y)}});function _i(){Nr.apply(this,arguments),this._timer=null,this._input=null}_(_i,Nr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[St]},process:function(Y){var ne=this.options,me=Y.pointers.length===ne.pointers,Ee=Y.distance<ne.threshold,Xe=Y.deltaTime>ne.time;if(this._input=Y,!Ee||!me||Y.eventType&(Re|Le)&&!Xe)this.reset();else if(Y.eventType&he)this.reset(),this._timer=f(function(){this.state=Dr,this.tryEmit()},ne.time,this);else if(Y.eventType&Re)return Dr;return kr},reset:function(){clearTimeout(this._timer)},emit:function(Y){this.state===Dr&&(Y&&Y.eventType&Re?this.manager.emit(this.options.event+"up",Y):(this._input.timeStamp=h(),this.manager.emit(this.options.event,this._input)))}});function vn(){Yt.apply(this,arguments)}_(vn,Yt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Dt]},attrTest:function(Y){return this._super.attrTest.call(this,Y)&&(Math.abs(Y.rotation)>this.options.threshold||this.state&Vt)}});function mn(){Yt.apply(this,arguments)}_(mn,Yt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:We|bt,pointers:1},getTouchAction:function(){return Yn.prototype.getTouchAction.call(this)},attrTest:function(Y){var ne=this.options.direction,me;return ne&(We|bt)?me=Y.overallVelocity:ne&We?me=Y.overallVelocityX:ne&bt&&(me=Y.overallVelocityY),this._super.attrTest.call(this,Y)&&ne&Y.offsetDirection&&Y.distance>this.options.threshold&&Y.maxPointers==this.options.pointers&&c(me)>this.options.velocity&&Y.eventType&Re},emit:function(Y){var ne=Rr(Y.offsetDirection);ne&&this.manager.emit(this.options.event+ne,Y),this.manager.emit(this.options.event,Y)}});function $r(){Nr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}_($r,Nr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[zt]},process:function(Y){var ne=this.options,me=Y.pointers.length===ne.pointers,Ee=Y.distance<ne.threshold,Xe=Y.deltaTime<ne.time;if(this.reset(),Y.eventType&he&&this.count===0)return this.failTimeout();if(Ee&&Xe&&me){if(Y.eventType!=Re)return this.failTimeout();var _t=this.pTime?Y.timeStamp-this.pTime<ne.interval:!0,Bt=!this.pCenter||ke(this.pCenter,Y.center)<ne.posThreshold;this.pTime=Y.timeStamp,this.pCenter=Y.center,!Bt||!_t?this.count=1:this.count+=1,this._input=Y;var $t=this.count%ne.taps;if($t===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=Dr,this.tryEmit()},ne.interval,this),Vt):Dr}return kr},failTimeout:function(){return this._timer=f(function(){this.state=kr},this.options.interval,this),kr},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Dr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function jr(Y,ne){return ne=ne||{},ne.recognizers=P(ne.recognizers,jr.defaults.preset),new Nn(Y,ne)}jr.VERSION="2.0.7",jr.defaults={domEvents:!1,touchAction:ht,enable:!0,inputTarget:null,inputClass:null,preset:[[vn,{enable:!1}],[xi,{enable:!1},["rotate"]],[mn,{direction:We}],[Yn,{direction:We},["swipe"]],[$r],[$r,{event:"doubletap",taps:2},["tap"]],[_i]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var io=1,ra=2;function Nn(Y,ne){this.options=M({},jr.defaults,ne||{}),this.options.inputTarget=this.options.inputTarget||Y,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Y,this.input=De(this),this.touchAction=new pr(this,this.options.touchAction),Si(this,!0),y(this.options.recognizers,function(me){var Ee=this.add(new me[0](me[1]));me[2]&&Ee.recognizeWith(me[2]),me[3]&&Ee.requireFailure(me[3])},this)}Nn.prototype={set:function(Y){return M(this.options,Y),Y.touchAction&&this.touchAction.update(),Y.inputTarget&&(this.input.destroy(),this.input.target=Y.inputTarget,this.input.init()),this},stop:function(Y){this.session.stopped=Y?ra:io},recognize:function(Y){var ne=this.session;if(!ne.stopped){this.touchAction.preventDefaults(Y);var me,Ee=this.recognizers,Xe=ne.curRecognizer;(!Xe||Xe&&Xe.state&Dr)&&(Xe=ne.curRecognizer=null);for(var _t=0;_t<Ee.length;)me=Ee[_t],ne.stopped!==ra&&(!Xe||me==Xe||me.canRecognizeWith(Xe))?me.recognize(Y):me.reset(),!Xe&&me.state&(Vt|fn|Or)&&(Xe=ne.curRecognizer=me),_t++}},get:function(Y){if(Y instanceof Nr)return Y;for(var ne=this.recognizers,me=0;me<ne.length;me++)if(ne[me].options.event==Y)return ne[me];return null},add:function(Y){if(m(Y,"add",this))return this;var ne=this.get(Y.options.event);return ne&&this.remove(ne),this.recognizers.push(Y),Y.manager=this,this.touchAction.update(),Y},remove:function(Y){if(m(Y,"remove",this))return this;if(Y=this.get(Y),Y){var ne=this.recognizers,me=Q(ne,Y);me!==-1&&(ne.splice(me,1),this.touchAction.update())}return this},on:function(Y,ne){if(Y!==n&&ne!==n){var me=this.handlers;return y(q(Y),function(Ee){me[Ee]=me[Ee]||[],me[Ee].push(ne)}),this}},off:function(Y,ne){if(Y!==n){var me=this.handlers;return y(q(Y),function(Ee){ne?me[Ee]&&me[Ee].splice(Q(me[Ee],ne),1):delete me[Ee]}),this}},emit:function(Y,ne){this.options.domEvents&&Mi(Y,ne);var me=this.handlers[Y]&&this.handlers[Y].slice();if(!(!me||!me.length)){ne.type=Y,ne.preventDefault=function(){ne.srcEvent.preventDefault()};for(var Ee=0;Ee<me.length;)me[Ee](ne),Ee++}},destroy:function(){this.element&&Si(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Si(Y,ne){var me=Y.element;if(me.style){var Ee;y(Y.options.cssProps,function(Xe,_t){Ee=W(me.style,_t),ne?(Y.oldCssProps[Ee]=me.style[Ee],me.style[Ee]=Xe):me.style[Ee]=Y.oldCssProps[Ee]||""}),ne||(Y.oldCssProps={})}}function Mi(Y,ne){var me=t.createEvent("Event");me.initEvent(Y,!0,!0),me.gesture=ne,ne.target.dispatchEvent(me)}return M(jr,{INPUT_START:he,INPUT_MOVE:Fe,INPUT_END:Re,INPUT_CANCEL:Le,STATE_POSSIBLE:pn,STATE_BEGAN:Vt,STATE_CHANGED:fn,STATE_ENDED:Or,STATE_RECOGNIZED:Dr,STATE_CANCELLED:Yr,STATE_FAILED:kr,DIRECTION_NONE:Se,DIRECTION_LEFT:we,DIRECTION_RIGHT:Ve,DIRECTION_UP:je,DIRECTION_DOWN:st,DIRECTION_HORIZONTAL:We,DIRECTION_VERTICAL:bt,DIRECTION_ALL:oe,Manager:Nn,Input:Me,TouchAction:pr,TouchInput:Ne,MouseInput:Pt,PointerEventInput:Nt,TouchMouseInput:ut,SingleTouchInput:Zt,Recognizer:Nr,AttrRecognizer:Yt,Tap:$r,Pan:Yn,Swipe:mn,Pinch:xi,Rotate:vn,Press:_i,on:F,off:O,each:y,merge:T,extend:b,assign:M,inherit:_,bindFn:S,prefixed:W}),jr}(typeof window<"u"?window:{},typeof document<"u"?document:{});function calculateThreeMouse(e,t,r){var n=t.getBoundingClientRect(),o=n.top,s=n.left,l=n.width,u=n.height;return r&&(s=s+l*r.left,o=o+u*(1-r.bottom-r.height),l=l*r.width,u=u*r.height),new Vector2((e.x-s)/l*2-1,-(e.y-o)/u*2+1)}var camera$2=new OrthographicCamera(-1,1,1,-1,0,1),geometry$5=new BufferGeometry;geometry$5.setAttribute("position",new Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3));geometry$5.setAttribute("uv",new Float32BufferAttribute([0,2,0,0,2,0],2));var mesh$4=new Mesh(geometry$5),scene$2=new Scene$1;scene$2.add(mesh$4);var DEFAULT_VERTEX_SHADER=`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Pass=function(){function e(t,r){var n;this.renderer=t,this.material=new ShaderMaterial({vertexShader:(n=r.vertex)!==null&&n!==void 0?n:DEFAULT_VERTEX_SHADER,fragmentShader:r.fragment,uniforms:Object.assign({inputBuffer:new Uniform(null)},r.uniforms),defines:Object.assign({},r.defines),blending:NoBlending,depthWrite:!1,depthTest:!1})}return e.prototype.render=function(t,r){var n=this.renderer.getRenderTarget(),o=mesh$4.material;this.material.uniforms.inputBuffer.value=t.texture,mesh$4.material=this.material,this.renderer.setRenderTarget(r||null),this.renderer.render(scene$2,camera$2),this.renderer.setRenderTarget(n),mesh$4.material=o},e.prototype.dispose=function(){this.material.dispose()},e}(),VALUE_VERTEX_SHADER=`
void main() {
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,VALUE_FRAGMENT_SHADER=`
uniform vec3 inputValue;
void main() {
  gl_FragColor = vec4(inputValue, 1.0);
}
`,ValuePass=function(){function e(t){this.renderer=t,this.material=new ShaderMaterial({vertexShader:VALUE_VERTEX_SHADER,fragmentShader:VALUE_FRAGMENT_SHADER,uniforms:Object.assign({inputValue:new Uniform(new Vector3)}),blending:NoBlending,depthWrite:!1,depthTest:!1})}return e.prototype.render=function(t,r){var n=this.renderer.getRenderTarget(),o=mesh$4.material;this.material.uniforms.inputValue.value.copy(t),mesh$4.material=this.material,this.renderer.setRenderTarget(r||null),this.renderer.render(scene$2,camera$2),this.renderer.setRenderTarget(n),mesh$4.material=o},e.prototype.dispose=function(){this.material.dispose()},e}(),FRAGMENT$2=`
uniform sampler2D inputBuffer;
varying vec2 vUv;
void main() {
  gl_FragColor = texture2D(inputBuffer, vUv);
}
`,CopyPass=function(e){__extends(t,e);function t(r){return e.call(this,r,{fragment:FRAGMENT$2})||this}return t}(Pass),FRAGMENT$1=`
precision mediump float;
precision mediump int;
uniform sampler2D depthBuffer;
varying vec2 vUv;
void main() {
  gl_FragColor = vec4(0.0,0.0,0.0,1.0);
  gl_FragDepthEXT = texture2D(depthBuffer, vUv).r;
}
`,VERTEX=`

varying vec2 vUv;

void main() {
	vUv = uv;

	vec4 mvPosition = modelViewMatrix * vec4(position,1.0);

	gl_Position = projectionMatrix * mvPosition;
}
`,camera$1=new OrthographicCamera(-1,1,1,-1,0,1),geometry$4=new BufferGeometry;geometry$4.setAttribute("position",new Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3));geometry$4.setAttribute("uv",new Float32BufferAttribute([0,2,0,0,2,0],2));var noneMaterial=new MeshBasicMaterial,mesh$3=new Mesh(geometry$4,noneMaterial),scene$1=new Scene$1;scene$1.add(mesh$3);var DepthCopyPass=function(){function e(t){this.renderer=t,this.material=new ShaderMaterial({vertexShader:VERTEX,fragmentShader:FRAGMENT$1,uniforms:Object.assign({depthBuffer:new Uniform(null)}),blending:NoBlending,depthWrite:!0,depthTest:!0}),this.renderer.getContext()&&this.renderer.getContext()instanceof WebGLRenderingContext&&(this.material.extensions.fragDepth=!0)}return e.prototype.render=function(t,r){var n=this.renderer.getRenderTarget();this.material.uniforms.depthBuffer.value=t,mesh$3.material=this.material,this.renderer.setRenderTarget(r||null),this.renderer.render(scene$1,camera$1),this.renderer.setRenderTarget(n),mesh$3.material=noneMaterial},e.prototype.dispose=function(){this.material.dispose()},e}(),sharedVector2$1=new Vector2,BaseController=function(e){__extends(t,e);function t(r){var n,o,s,l,u,c,h,f=e.call(this)||this,m=t.parseArgs(r);f.mode="",f.pending=new Set,f.userAction=m.initial.userAction,f.destroyed=!1,f.ident=m.ident,f.scene=m.scene,f.xrCustomObjectsScene=m.xrCustomObjectsScene,f.helper=m.helper,f.boundingMesh=m.boundingMesh,f.camera=m.camera,f.renderer=m.renderer,f.scissor=m.scissor,f.element=m.element,f.models=m.models,f.enableWheel=m.enableWheel,f.enableIOSEDR=(n=m.enableIOSEDR)!==null&&n!==void 0?n:!1,f.enableEDL=(o=m.enableEDL)!==null&&o!==void 0?o:!0,f.enableHQ=(s=m.enableHQ)!==null&&s!==void 0?s:!0,f.works=m.works,f.imageOptions=m.imageOptions,f.videoTexture=m.videoTexture,f.extraElements=m.extraElements,f.initial=m.initial,f.currentPano=typeof f.initial.state.panoIndex=="number"?{workCode:(c=(l=f.initial.state.workCode)!==null&&l!==void 0?l:(u=m.works[0])===null||u===void 0?void 0:u.workCode)!==null&&c!==void 0?c:"",panoIndex:f.initial.state.panoIndex}:{workCode:f.initial.currentState.workCode,panoIndex:f.initial.currentState.panoIndex},f.needsRender=!0,f.modelSceneNeedsRender=!0,f.cameraMotion=new Motion({longitude:{value:f.camera.pose.longitude,circle:[0,Math.PI*2]},latitude:f.camera.pose.latitude,fov:f.camera.pose.fov}),f.inMomentumMovement=null,f.eventUnbinds=[m.element].concat(m.extraElements||[]).map(function(M){return f.bindEvents(M)}),f.pending.add("init-animation"),f.initAnimationReady=new Promise(function(M){AnimationFrameLoop.shared.add(function(){f.initAnimation().then(function(){f.pending.delete("init-animation"),M()})},!0)}),f.initAnimationIsReady=!1,f.initAnimationReady.then(function(){return f.initAnimationIsReady=!0}),f.modelScene=m.modelScene;var y=new Vector2;f.renderer.getDrawingBufferSize(y),f.modelRenderTarget=m.modelRenderTarget,f.copyPass=new CopyPass(f.renderer),f.depthCopyPass=new DepthCopyPass(f.renderer),f.screenBuffers=[],f.lastPostProcessingType=null,f.enableLayeringRendering=m.enableLayeringRendering;var A=(h=f.renderer)===null||h===void 0?void 0:h.getContext();return f.enableFragDepth=f.enableLayeringRendering&&(typeof WebGL2RenderingContext<"u"&&A instanceof WebGL2RenderingContext||A.getExtension("EXT_frag_depth")!==null),f}return t.parseArgs=function(r){return r instanceof t?r:__assign({},r)},t.initAnimationEndState=function(r){var n,o,s,l,u,c,h,f,m=this.parseArgs(r),y=m.initial,A=y.state,M=y.currentState,b=typeof A.panoIndex=="number"?{workCode:(s=(n=A.workCode)!==null&&n!==void 0?n:(o=m.works[0])===null||o===void 0?void 0:o.workCode)!==null&&s!==void 0?s:"",panoIndex:A.panoIndex}:{workCode:M.workCode,panoIndex:M.panoIndex};return __assign(__assign({},b),{mode:"",longitude:(l=A.longitude)!==null&&l!==void 0?l:M.longitude,latitude:(u=A.latitude)!==null&&u!==void 0?u:M.latitude,fov:(c=A.fov)!==null&&c!==void 0?c:M.fov,offset:(h=A.offset)!==null&&h!==void 0?h:M.offset,distance:(f=A.distance)!==null&&f!==void 0?f:M.distance})},t.prototype.updateConfiguration=function(r){return!0},t.prototype.destroy=function(){var r;this.stopMomentumMovement(),this.destroyed=!0,this.off(),this.cameraMotion.dispose();for(var n=0,o=this.eventUnbinds;n<o.length;n++){var s=o[n];s()}this.copyEffect&&(this.copyEffect.dispose(),delete this.copyEffect),delete this.panState,(r=this.pressState)===null||r===void 0||r.stop(),delete this.pressState},t.prototype.isReady=function(){return this.inMomentumMovement===null&&this.pending.size===0&&this.cameraMotion.ended===!0},t.prototype.bindExtraElement=function(r){for(var n=0,o=this.eventUnbinds;n<o.length;n++){var s=o[n];if(s.element===r)return}this.eventUnbinds.push(this.bindEvents(r))},t.prototype.unbindExtraElement=function(r){for(var n=[],o=0,s=this.eventUnbinds;o<s.length;o++){var l=s[o];l.element===r?l():n.push(l)}this.eventUnbinds=n},t.prototype.updateRenderSize=function(r){this.needsRender=!0,this.modelSceneNeedsRender=!0,this.modelRenderTarget.setSize(r.x,r.y),this.screenBuffers.forEach(function(n){n!==null&&n.setSize(r.x,r.y)})},t.prototype.updateModel=function(r){this.needsRender=!0,this.modelSceneNeedsRender=!0},t.prototype.updateWork=function(r,n,o,s){return this.works=r,this.userAction=s,!1},t.prototype.updateTime=function(r,n){if(!this.destroyed){var o={};this.cameraMotion.ended&&(this.cameraMotion.update(r),o.longitude=this.cameraMotion.value.longitude,o.latitude=this.cameraMotion.value.latitude,o.fov=this.cameraMotion.value.fov),isEmptyObject(o)&&this.setCamera(o)}},t.prototype.render=function(r,n){var o=this.renderer.getRenderTarget();this.updateScreenBuffer(n),this.enableFragDepth?(r&&(this.renderer.setRenderTarget(this.modelRenderTarget),this.renderer.render(this.modelScene,this.camera)),this.depthCopyPass.render(this.modelRenderTarget.depthTexture,o),this.renderer.autoClearDepth=!1,this.renderer.autoClearColor=!0,this.copyPass.render(this.modelRenderTarget,o),this.renderer.setRenderTarget(o),this.renderer.autoClearColor=!1,this.renderer.autoClearDepth=!1,this.renderer.render(this.scene,this.camera),this.renderer.autoClearColor=!0,this.renderer.autoClearDepth=!0):(this.renderer.render(this.modelScene,this.camera),this.renderer.autoClearColor=!1,this.renderer.autoClearDepth=!1,this.renderer.render(this.scene,this.camera),this.renderer.autoClearColor=!0,this.renderer.autoClearDepth=!0)},t.prototype.postProcessing=function(r,n){this.destroyed},t.prototype.updateCamera=function(r,n,o){var s=this;return this.initAnimationReady.then(function(){s.userAction=o,s.stopMomentumMovement();var l={};return r.longitude!==void 0&&(l.longitude=r.longitude),r.latitude!==void 0&&(l.latitude=r.latitude),r.fov!==void 0&&(l.fov=r.fov),s.cameraMotion.set(l,n).catch(noop$1)})},t.prototype.updateCameraWithKeyframes=function(r,n,o){var s=this;return this.initAnimationReady.then(function(){s.userAction=o,s.stopMomentumMovement();for(var l=[],u=0,c=r;u<c.length;u++){var h=c[u];l.push({key:h.key,progress:h.progress,value:{longitude:h.value.longitude,latitude:h.value.latitude,fov:h.value.fov}})}return s.cameraMotion.setKeyframes(l,n)})},t.prototype.getTargetState=function(){var r=this.cameraMotion.getKeyFrameSegment(now())[1];return __assign(__assign({},this.currentPano),{mode:this.mode,longitude:r.value.longitude,latitude:r.value.latitude,fov:r.value.fov,offset:this.camera.pose.offset.clone(),distance:this.camera.pose.distance})},t.prototype.initAnimation=function(){var r=this.initial;r.state,r.currentState,r.duration;var n=r.userAction,o=t.initAnimationEndState(this);return this.userAction=n,this.emit("initAnimation.start",createEvent("initAnimation.start",{state:o,userAction:this.userAction})),this.emit("initAnimation.end",createEvent("initAnimation.end",{state:o,userAction:this.userAction})),Promise.resolve()},t.prototype.setCamera=function(r){var n,o,s,l,u;r===void 0&&(r={});var c=(n=r.longitude)!==null&&n!==void 0?n:this.camera.pose.longitude,h=(o=r.latitude)!==null&&o!==void 0?o:this.camera.pose.latitude,f=(s=r.fov)!==null&&s!==void 0?s:this.camera.pose.fov,m=(l=r.distance)!==null&&l!==void 0?l:this.camera.pose.distance,y=(u=r.offset)!==null&&u!==void 0?u:this.camera.pose.offset,A=notSimilarValue(c,this.camera.pose.longitude,Math.PI*2)||notSimilarValue(h,this.camera.pose.latitude),M=notSimilarValue(f,this.camera.pose.fov),b=notSimilarValue(m,this.camera.pose.distance),T=notSimilarVector3(y,this.camera.pose.offset);(M||A||T||b)&&(this.camera.setFromPose({longitude:c,latitude:h,fov:f,distance:m,offset:y}),this.emit("camera.update",createEvent("camera.update",{userAction:this.userAction,state:__assign(__assign({},this.currentPano),{mode:this.mode,longitude:c,latitude:h,fov:f,offset:y,distance:m})})),this.needsRender=!0,this.modelSceneNeedsRender=!0)},t.prototype.stopMomentumMovement=function(){if(this.inMomentumMovement&&this.inMomentumMovement.event&&!this.inMomentumMovement.event.defaultPrevented&&!this.inMomentumMovement.event.isFinal){var r=createEvent("gesture.momentum",__assign(__assign({},this.inMomentumMovement.event),{isFirst:!1,isFinal:!0}));this.emit("gesture.momentum",r)}this.inMomentumMovement=null},t.prototype.onPanGesture=function(r){this.stopMomentumMovement(),this.emit("gesture.pan",r)},t.prototype.onTapGesture=function(r){this.stopMomentumMovement(),this.emit("gesture.tap",r)},t.prototype.onDblTapGesture=function(r){this.stopMomentumMovement(),this.emit("gesture.dbltap",r),!r.defaultPrevented&&(r.type="gesture.tap",this.onTapGesture(r))},t.prototype.onPressGesture=function(r){this.stopMomentumMovement(),this.emit("gesture.press",r)},t.prototype.onPinchGesture=function(r){this.stopMomentumMovement(),this.emit("gesture.pinch",r)},t.prototype.onMouseWheel=function(r){this.stopMomentumMovement(),this.emit("gesture.mousewheel",r)},t.prototype.onMouseMove=function(r){this.stopMomentumMovement(),this.emit("gesture.mousemove",r)},t.prototype.relativeClientPosition=function(r){return calculateThreeMouse(r,this.element,this.scissor)},t.prototype.bindEvents=function(r){var n=this,o=function(z){var H=calculateThreeMouse(z,n.element,n.scissor);return!(Math.abs(H.x)>1||Math.abs(H.y)>1)},s=new Hammer.Manager(r),l=function(z){var H=z.session;return H.firstInput||null},u=new Hammer.Pan({threshold:10,pointers:0}),c=new Hammer.Tap({interval:410}),h=new Hammer.Pinch({threshold:0,pointers:2});s.add([u,c,h]),s.on("panstart pan",function(z){var H=l(s);if(!(H&&!o(H.center))){var W=createEvent("gesture.pan",{target:z.target,pointerType:z.pointerType,srcEvent:z.srcEvent,pointers:z.pointers.map(function(J){var G=n.relativeClientPosition(J),te=new Raycaster;return te.params.Points={threshold:.1},te.setFromCamera(G,n.camera),{x:J.x,y:J.y,delta:0,buttons:0,coords:G,raycaster:te}}),isFirst:z.isFirst,isFinal:z.isFinal,scale:z.scale,center:function(J){var G=n.relativeClientPosition(J),te=new Raycaster;return te.params.Points={threshold:.1},te.setFromCamera(G,n.camera),{x:J.x,y:J.y,delta:0,buttons:0,coords:G,raycaster:te}}(z.center),velocityX:z.velocityX,velocityY:z.velocityY,overallVelocityX:z.overallVelocityX,overallVelocityY:z.overallVelocityY,userAction:!0,state:__assign(__assign({mode:n.mode},n.currentPano),clonePose(n.camera.pose))});n.onPanGesture(W),C()}}),s.on("tap",function(z){if(!(z.pointerType==="mouse"&&z.srcEvent.button!==0)){var H=l(s);if(!(H&&!o(H.center))){var W=createEvent("gesture.tap",{target:z.target,pointerType:z.pointerType,srcEvent:z.srcEvent,pointers:z.pointers.map(function(J){var G=n.relativeClientPosition(J),te=new Raycaster;return te.params.Points={threshold:.1},te.setFromCamera(G,n.camera),{x:J.x,y:J.y,delta:0,buttons:0,coords:G,raycaster:te}}),isFirst:!0,isFinal:!0,scale:z.scale,center:function(J){var G=n.relativeClientPosition(J),te=new Raycaster;return te.params.Points={threshold:.1},te.setFromCamera(G,n.camera),{x:J.x,y:J.y,delta:0,buttons:0,coords:G,raycaster:te}}(z.center),velocityX:z.velocityX,velocityY:z.velocityY,overallVelocityX:z.overallVelocityX,overallVelocityY:z.overallVelocityY,userAction:!0,state:__assign(__assign({mode:n.mode},n.currentPano),clonePose(n.camera.pose))});n.onTapGesture(W),C()}}}),s.on("pinchstart pinch pinchend",function(z){var H=l(s);if(!(H&&!o(H.center))){var W=createEvent("gesture.pinch",{target:z.target,pointerType:z.pointerType,srcEvent:z.srcEvent,pointers:z.pointers.map(function(J){var G,te=n.relativeClientPosition(J),X=new Raycaster;return X.params.Points={threshold:.1},X.setFromCamera(te,n.camera),{x:J.x,y:J.y,delta:(G=J.delta)!==null&&G!==void 0?G:0,buttons:0,coords:te,raycaster:X}}),isFirst:z.type==="pinchstart",isFinal:z.type==="pinchend",scale:z.scale,center:function(J){var G=n.relativeClientPosition(J),te=new Raycaster;return te.params.Points={threshold:.1},te.setFromCamera(G,n.camera),{x:J.x,y:J.y,delta:0,buttons:0,coords:G,raycaster:te}}(z.center),velocityX:z.velocityX,velocityY:z.velocityY,overallVelocityX:z.overallVelocityX,overallVelocityY:z.overallVelocityY,userAction:!0,state:__assign(__assign({mode:n.mode},n.currentPano),clonePose(n.camera.pose))});n.onPinchGesture(W),C()}}),s.on("dbltap",function(z){if(!(z.pointerType==="mouse"&&z.srcEvent.button!==0)){var H=l(s);if(!(H&&!o(H.center))){var W=createEvent("gesture.dbltap",{target:z.target,pointerType:z.pointerType,srcEvent:z.srcEvent,pointers:z.pointers.map(function(J){var G=n.relativeClientPosition(J),te=new Raycaster;return te.params.Points={threshold:.1},te.setFromCamera(G,n.camera),{x:J.x,y:J.y,delta:0,buttons:0,coords:G,raycaster:te}}),isFirst:!0,isFinal:!0,scale:z.scale,center:function(J){var G=n.relativeClientPosition(J),te=new Raycaster;return te.params.Points={threshold:.1},te.setFromCamera(G,n.camera),{x:J.x,y:J.y,delta:0,buttons:0,coords:G,raycaster:te}}(z.center),velocityX:z.velocityX,velocityY:z.velocityY,overallVelocityX:z.overallVelocityX,overallVelocityY:z.overallVelocityY,userAction:!0,state:__assign(__assign({mode:n.mode},n.currentPano),clonePose(n.camera.pose))});n.onDblTapGesture(W),C()}}});var f=null,m=null,y=function(z,H,W){var J={x:W.clientX,y:W.clientY},G=n.relativeClientPosition(J),te=new Raycaster;te.params.Points={threshold:.1},te.setFromCamera(G,n.camera);var X=__assign(__assign({},J),{coords:G,raycaster:te,buttons:W.buttons,delta:0}),K=z==="pinchend"?H:H-W.deltaY/280,Z=createEvent("gesture.pinch",{target:W.target,pointerType:"mouse",srcEvent:W,pointers:[__assign({},X)],isFirst:z==="pinchstart",isFinal:z==="pinchend",scale:clamp$1(K,.1,10),center:__assign({},X),velocityX:0,velocityY:0,overallVelocityX:0,overallVelocityY:0,userAction:!0,state:__assign(__assign({mode:n.mode},n.currentPano),clonePose(n.camera.pose))});return Z},A=function(z){var H,W={x:z.clientX,y:z.clientY};if(o(W)){if(z.preventDefault(),z.ctrlKey){var J=(H=f==null?void 0:f.prevEvent.scale)!==null&&H!==void 0?H:1,G=y(f?"pinch":"pinchstart",J,z);f===null?f={firstEvent:G,prevEvent:G}:f.prevEvent=G,n.onPinchGesture(G),m!==null&&window.clearTimeout(m),m=window.setTimeout(function(){var re;m=null;var pe=(re=f==null?void 0:f.prevEvent.scale)!==null&&re!==void 0?re:1,ge=y("pinchend",pe,z);f=null,n.onPinchGesture(ge)},200)}else{var te=(Math.abs(z.deltaY)>Math.abs(z.deltaX)?z.deltaY:z.deltaX)/-60,X=n.mouseWheelState!==void 0,K={x:z.clientX,y:z.clientY},Z=n.relativeClientPosition(K),ee=new Raycaster;ee.params.Points={threshold:.1},ee.setFromCamera(Z,n.camera);var j=__assign(__assign({},K),{coords:Z,raycaster:ee,buttons:z.buttons,delta:te}),G=createEvent("gesture.mousewheel",{target:z.target,pointerType:"mouse",srcEvent:z,pointers:[__assign({},j)],isFirst:X,isFinal:!1,scale:0,center:__assign({},j),velocityX:0,velocityY:0,overallVelocityX:0,overallVelocityY:0,userAction:!0,state:__assign(__assign({mode:n.mode},n.currentPano),clonePose(n.camera.pose))});n.onMouseWheel(G),n.mouseWheelState&&clearTimeout(n.mouseWheelState.timer),n.mouseWheelState={timer:setTimeout(function(){delete n.mouseWheelState;var pe=createEvent("gesture.mousewheel",{target:z.target,pointerType:"mouse",srcEvent:z,pointers:[__assign(__assign({},j),{delta:0})],isFirst:!1,isFinal:!0,scale:0,center:__assign(__assign({},j),{delta:0}),velocityX:0,velocityY:0,overallVelocityX:0,overallVelocityY:0,userAction:!0,state:__assign(__assign({mode:n.mode},n.currentPano),clonePose(n.camera.pose))});n.onMouseWheel(pe)},100)}}C()}},M=function(z){if(!isMobile){if(!o({x:z.clientX,y:z.clientY})){b();return}var H=!1;n.mouseMoveState||(H=!0);var W={x:z.clientX,y:z.clientY},J=n.relativeClientPosition(W),G=new Raycaster;G.params.Points={threshold:.1},G.setFromCamera(J,n.camera);var te=__assign(__assign({},W),{coords:J,raycaster:G,buttons:z.buttons,delta:0}),X=createEvent("gesture.mousemove",{target:z.target,pointerType:"mouse",srcEvent:z,pointers:[__assign({},te)],isFirst:H,isFinal:!1,scale:0,center:__assign({},te),velocityX:0,velocityY:0,overallVelocityX:0,overallVelocityY:0,userAction:!0,state:__assign(__assign({mode:n.mode},n.currentPano),clonePose(n.camera.pose))});n.mouseMoveState={timeStamp:now(),event:X},n.onMouseMove(X),n.pressState&&Math.abs(z.clientX-n.pressState.event.center.y)>10&&Math.abs(z.clientY-n.pressState.event.center.y)>10&&C()}},b=function(){if(n.mouseMoveState){var z=createEvent(n.mouseMoveState.event.type,__assign(__assign({},n.mouseMoveState.event),{isFinal:!0}));delete n.mouseMoveState,n.onMouseMove(z)}C()},T=function(z){if(!o(z.center)){C();return}var H=!1;n.pressState||(H=!0,n.pressState={event:z,timeStamp:now(),stop:noop$1});var W=now()-n.pressState.timeStamp,J=createEvent(n.pressState.event.type,__assign(__assign({},n.pressState.event),{isFirst:H,isFinal:!1,center:__assign(__assign({},n.pressState.event.center),{delta:W}),pointers:n.pressState.event.pointers.map(function(G){return __assign(__assign({},G),{delta:W})})}));n.onPressGesture(J),n.pressState&&(n.pressState.stop=AnimationFrameLoop.shared.add(function(G){T(z)},!0,1))},_=function(z){if(C(),!(z.touches.length>1||z.changedTouches.length<=0)){var H={x:z.changedTouches[0].clientX,y:z.changedTouches[0].clientY},W=n.relativeClientPosition(H),J=new Raycaster;J.params.Points={threshold:.1},J.setFromCamera(W,n.camera);var G=__assign(__assign({},H),{coords:W,raycaster:J,buttons:0,delta:0}),te=createEvent("gesture.press",{target:z.target,pointerType:"touch",srcEvent:z,pointers:[__assign({},G)],isFirst:!1,isFinal:!1,scale:0,center:G,velocityX:0,velocityY:0,overallVelocityX:0,overallVelocityY:0,userAction:!0,state:__assign(__assign({mode:n.mode},n.currentPano),clonePose(n.camera.pose))});T(te)}},S=function(z){C();var H={x:z.clientX,y:z.clientY},W=n.relativeClientPosition(H),J=new Raycaster;J.params.Points={threshold:.1},J.setFromCamera(W,n.camera);var G=__assign(__assign({},H),{coords:W,raycaster:J,buttons:z.buttons,delta:0}),te=createEvent("gesture.press",{target:z.target,pointerType:"mouse",srcEvent:z,pointers:[__assign({},G)],isFirst:!1,isFinal:!1,scale:0,center:G,velocityX:0,velocityY:0,overallVelocityX:0,overallVelocityY:0,userAction:!0,state:__assign(__assign({mode:n.mode},n.currentPano),clonePose(n.camera.pose))});T(te)},C=function(){var z;if(n.pressState){var H=now()-n.pressState.timeStamp,W=createEvent(n.pressState.event.type,__assign(__assign({},n.pressState.event),{center:__assign(__assign({},n.pressState.event.center),{delta:H}),isFirst:!1,isFinal:!0,pointers:n.pressState.event.pointers.map(function(J){return __assign(__assign({},J),{delta:H})})}));n.onPressGesture(W),(z=n.pressState)===null||z===void 0||z.stop(),delete n.pressState}},P=null,F=function(z){var H,W=!1,J=!1;switch(z.type){case"gesturestart":W=!0;break;case"gestureend":J=!0;break}var G={x:z.clientX,y:z.clientY},te=n.relativeClientPosition(G),X=new Raycaster;X.params.Points={threshold:.1},X.setFromCamera(te,n.camera);var K=__assign(__assign({},G),{coords:te,raycaster:X,buttons:0,delta:0}),Z=createEvent("gesture.pinch",{target:z.target,pointerType:"mouse",srcEvent:z,pointers:[__assign({},K)],isFirst:W,isFinal:J,scale:(H=z.scale)!==null&&H!==void 0?H:1,center:__assign({},K),velocityX:0,velocityY:0,overallVelocityX:0,overallVelocityY:0,userAction:!0,state:__assign(__assign({mode:n.mode},n.currentPano),clonePose(n.camera.pose))});return Z},O=function(z){if(z.preventDefault(),!isMobile){var H=F(z);P={firstEvent:H};var W=P.firstEvent;W&&!o(W.center)||n.onPinchGesture(H)}},N=function(z){if(z.preventDefault(),!isMobile&&P){var H=F(z),W=P.firstEvent;W&&!o(W.center)||n.onPinchGesture(H)}},V=function(z){if(z.preventDefault(),!isMobile&&P){var H=F(z),W=P.firstEvent;P=null,!(W&&!o(W.center))&&n.onPinchGesture(H)}},q=function(z){if(z&&typeof z.preventDefault=="function"&&z.currentTarget===r&&z.preventDefault(),typeof getSelection=="function"){var H=getSelection();H&&H.focusNode&&(H.removeAllRanges&&H.removeAllRanges(),H.empty&&H.empty())}};this.enableWheel&&r.addEventListener("wheel",A,{passive:!1}),r.addEventListener("mousemove",M,!1),r.addEventListener("mouseout",b,!1),r.addEventListener("touchstart",_,{passive:!0}),r.addEventListener("touchend",C,!1),r.addEventListener("touchcancel",C,!1),r.addEventListener("mousedown",S,!1),r.addEventListener("mouseup",C,!1),r.addEventListener("gesturestart",O,{passive:!1}),r.addEventListener("gesturechange",N,{passive:!1}),r.addEventListener("gestureend",V,{passive:!1}),r.addEventListener("touchstart",q,{passive:!1}),r.addEventListener("contextmenu",q,!1);var Q=function(){s.destroy(),r.removeEventListener("wheel",A,!1),r.removeEventListener("mousemove",M,!1),r.removeEventListener("mouseout",b,!1),r.removeEventListener("touchstart",_,!1),r.removeEventListener("touchend",C,!1),r.removeEventListener("touchcancel",C,!1),r.removeEventListener("mousedown",S,!1),r.removeEventListener("mouseup",C,!1),r.removeEventListener("gesturestart",O,!1),r.removeEventListener("gesturechange",N,!1),r.removeEventListener("gestureend",V,!1),r.removeEventListener("touchstart",q,!1),r.removeEventListener("contextmenu",q,!1)};return Object.assign(Q,{element:r})},t.prototype.preloadPano=function(r,n){var o=this;n===void 0&&(n=noop$1);var s=this.works.getResolvedObserver(r);if(!s)return Promise.resolve();var l=["right","left","up","down","front","back"];return Promise.all(l.map(function(u){var c=__assign({key:"pano.".concat(panoStringify(r),".").concat(u)},pick(o.imageOptions,["size","format","quality","mappings"])),h=s.images[u],f=applyImageURLOptions(h,o.imageOptions.transform,c);return getFetcher(s.work).preload(f,{timeout:500})})).then(function(){return n(r),r})},t.prototype.updateScreenBuffer=function(r){var n,o,s,l,u,c;if(this.lastPostProcessingType!==r)if(this.lastPostProcessingType=r,r==="luminance"){if(this.screenBuffers.length===0){var h=this.renderer.getDrawingBufferSize(sharedVector2$1);this.screenBuffers=[new WebGLRenderTarget(h.x,h.y,{generateMipmaps:!1,encoding:(o=(n=this.renderer)===null||n===void 0?void 0:n.outputEncoding)!==null&&o!==void 0?o:sRGBEncoding}),this.enableFragDepth?this.modelRenderTarget:null]}}else if(r==="edl"){if(this.screenBuffers.length===0){var h=this.renderer.getDrawingBufferSize(sharedVector2$1);this.screenBuffers=[new WebGLRenderTarget(h.x,h.y,{generateMipmaps:!1,encoding:(l=(s=this.renderer)===null||s===void 0?void 0:s.outputEncoding)!==null&&l!==void 0?l:sRGBEncoding,minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat,type:FloatType}),this.enableFragDepth?this.modelRenderTarget:null]}this.models.setMaterial({useEDL:!0})}else if(r==="hq"){if(this.screenBuffers.length===0){var h=this.renderer.getDrawingBufferSize(sharedVector2$1),f=new WebGLRenderTarget(h.x,h.y,{generateMipmaps:!1,minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat,type:FloatType,depthTexture:new DepthTexture(h.x,h.y,UnsignedIntType)});f.depthTexture.format=DepthFormat,f.depthBuffer=!0;var m=new WebGLRenderTarget(h.x,h.y,{generateMipmaps:!1,encoding:(c=(u=this.renderer)===null||u===void 0?void 0:u.outputEncoding)!==null&&c!==void 0?c:sRGBEncoding,minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat,type:FloatType,depthTexture:f.depthTexture});this.screenBuffers=[f,m,this.enableFragDepth?this.modelRenderTarget:null]}this.models.setMaterial({useHQDepth:!0,useHQWeight:!1,pointShape:"CIRCLE"})}else this.screenBuffers&&(this.screenBuffers.forEach(function(y){y!==null&&y.dispose()}),this.screenBuffers=[]),this.models.setMaterial({useEDL:!1,useHQDepth:!1,useHQWeight:!1})},t}(Subscribe),defaultFloorplanControllerCustomInitArgs={defaultLongitude:Math.PI/4,defaultLatitude:Math.PI/4,defaultFov:80,maxFov:120,minFov:20,maxLatitude:+Math.PI/2,minLatitude:-Math.PI/2,intersectMeshCreator:function(){return new IntersectMesh}},FloorplanController=function(e){__extends(t,e);function t(r){var n=this,o,s=t.parseArgs(r);return n=e.call(this,s)||this,n.mode="Floorplan",n.defaultLongitude=s.defaultLongitude,n.defaultLatitude=s.defaultLatitude,n.defaultFov=s.defaultFov,n.maxFov=s.maxFov,n.minFov=s.minFov,n.maxLatitude=s.maxLatitude,n.minLatitude=s.minLatitude,n.locationMotion=new Motion({x:n.camera.pose.offset.x,y:n.camera.pose.offset.y,z:n.camera.pose.offset.z,distance:n.camera.pose.distance}),n.modelAlphaMotion=new Motion({modelAlpha:(o=n.models.getMaterial().modelAlpha)!==null&&o!==void 0?o:0}),n.perspToOrthoMotion=new Motion({perspToOrtho:n.camera.perspToOrtho.x}),n.currentTapId=null,n.intersectMeshCreator=s.intersectMeshCreator,n.intersectMesh=n.intersectMeshCreator(),n.intersectMesh.name="intersect",n.intersectMesh.visible=!1,n.helper.add(n.intersectMesh),n}return t.distanceFromModel=function(r,n,o){var s=r.bounding,l=Math.pow(Math.pow(s.max.x-s.min.x+1,2)+Math.pow(s.max.y-s.min.y+1,2)+Math.pow(s.max.z-s.min.z+1,2),1/2),u=l/2/Math.tan(Math.PI*n/360);return o<1&&(u=u/o),isNaN(u)?l:u},t.parseArgs=function(r){var n,o,s,l,u,c,h,f;if(r instanceof t)return r;var m=e.parseArgs.call(this,r);return __assign(__assign({},m),{defaultLongitude:(n=r.defaultLongitude)!==null&&n!==void 0?n:defaultFloorplanControllerCustomInitArgs.defaultLongitude,defaultLatitude:(o=r.defaultLatitude)!==null&&o!==void 0?o:defaultFloorplanControllerCustomInitArgs.defaultLatitude,defaultFov:(s=r.defaultFov)!==null&&s!==void 0?s:defaultFloorplanControllerCustomInitArgs.defaultFov,maxFov:(l=r.maxFov)!==null&&l!==void 0?l:defaultFloorplanControllerCustomInitArgs.maxFov,minFov:(u=r.minFov)!==null&&u!==void 0?u:defaultFloorplanControllerCustomInitArgs.minFov,maxLatitude:(c=r.maxLatitude)!==null&&c!==void 0?c:defaultFloorplanControllerCustomInitArgs.maxLatitude,minLatitude:(h=r.minLatitude)!==null&&h!==void 0?h:defaultFloorplanControllerCustomInitArgs.minLatitude,intersectMeshCreator:(f=r.intersectMeshCreator)!==null&&f!==void 0?f:defaultFloorplanControllerCustomInitArgs.intersectMeshCreator})},t.initAnimationEndState=function(r){var n,o,s,l,u,c,h,f=this.parseArgs(r),m=r.initial,y=m.state,A=m.currentState,M=typeof y.panoIndex=="number"?{workCode:(s=(n=y.workCode)!==null&&n!==void 0?n:(o=f.works[0])===null||o===void 0?void 0:o.workCode)!==null&&s!==void 0?s:"",panoIndex:y.panoIndex}:{workCode:A.workCode,panoIndex:A.panoIndex},b=__assign(__assign({},M),{mode:"Floorplan",longitude:(l=y.longitude)!==null&&l!==void 0?l:isThirdPersonMode(A.mode)?A.longitude:f.defaultLongitude,latitude:clamp$1((u=y.latitude)!==null&&u!==void 0?u:A.mode==="Floorplan"?A.latitude:f.defaultLatitude,f.minLatitude,f.maxLatitude),fov:(c=y.fov)!==null&&c!==void 0?c:f.defaultFov,offset:y.offset?y.offset.clone():r.models.bounding.getCenter(new Vector3),distance:(h=y.distance)!==null&&h!==void 0?h:t.distanceFromModel(f.models,f.defaultFov,f.camera.aspect)});return b},t.prototype.updateConfiguration=function(r){var n=e.prototype.updateConfiguration.call(this,r);if(n===!1)return!1;if(r.defaultLongitude!==void 0&&this.defaultLongitude!==r.defaultLongitude&&(this.defaultLongitude=r.defaultLongitude),r.defaultLatitude!==void 0&&this.defaultLatitude!==r.defaultLatitude&&(this.defaultLatitude=r.defaultLatitude),r.defaultFov!==void 0&&this.defaultFov!==r.defaultFov&&(this.defaultFov=r.defaultFov),r.maxFov!==void 0&&this.maxFov!==r.maxFov&&(this.maxFov=r.maxFov),r.minFov!==void 0&&this.minFov!==r.minFov&&(this.minFov=r.minFov),r.maxLatitude!==void 0&&this.maxLatitude!==r.maxLatitude&&(this.maxLatitude=r.maxLatitude),r.minLatitude!==void 0&&this.minLatitude!==r.minLatitude&&(this.minLatitude=r.minLatitude),r.intersectMeshCreator!==void 0&&this.intersectMeshCreator!==r.intersectMeshCreator){this.intersectMeshCreator=r.intersectMeshCreator;var o=this.intersectMesh;this.intersectMesh=this.intersectMeshCreator(),this.intersectMesh.name=o.name,this.intersectMesh.visible=o.visible;var s=this.intersectMesh.parent;s&&s.add(this.intersectMesh),o.dispose()}return!0},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.locationMotion.dispose(),delete this.panState,this.intersectMesh.dispose(),this.helper.remove(this.intersectMesh)},t.prototype.isReady=function(){return this.locationMotion.ended===!1?!1:e.prototype.isReady.call(this)},t.prototype.updateWork=function(r,n,o,s){var l;return this.works=r,this.updateCamera(n,(l=o.duration)!==null&&l!==void 0?l:0,s),!0},t.prototype.updateModel=function(r){e.prototype.updateModel.call(this,r);var n=r.bounding.getCenter(new Vector3),o=t.distanceFromModel(r,this.defaultFov,this.camera.aspect);this.updateCamera({offset:n,distance:o},0,!0)},t.prototype.updateCamera=function(r,n,o){var s=this;return this.initAnimationReady.then(function(){s.userAction=o,s.stopMomentumMovement();var l={},u={};return r.distance!==void 0&&(l.distance=r.distance),r.offset!==void 0&&(l.x=r.offset.x,l.y=r.offset.y,l.z=r.offset.z),r.longitude!==void 0&&(u.longitude=r.longitude),r.latitude!==void 0&&(u.latitude=r.latitude),r.fov!==void 0&&(u.fov=r.fov),s.locationMotion.set(l,n).catch(noop$1),s.cameraMotion.set(u,n).catch(noop$1)})},t.prototype.updateCameraWithKeyframes=function(r,n,o){var s=this;return this.initAnimationReady.then(function(){s.userAction=o,s.stopMomentumMovement();for(var l=[],u=[],c=0,h=r;c<h.length;c++){var f=h[c];l.push({key:f.key,progress:f.progress,value:{distance:f.value.distance,x:f.value.offset.x,y:f.value.offset.x,z:f.value.offset.x}}),u.push({key:f.key,progress:f.progress,value:{longitude:f.value.longitude,latitude:f.value.latitude,fov:f.value.fov}})}return s.locationMotion.setKeyframes(l,n).catch(noop$1),s.cameraMotion.setKeyframes(r,n)})},t.prototype.updateTime=function(r,n){if(!this.destroyed){var o={},s={};if(this.modelAlphaMotion.ended||(this.modelAlphaMotion.update(r),o.modelAlpha=this.modelAlphaMotion.value.modelAlpha),this.perspToOrthoMotion.ended||(this.perspToOrthoMotion.update(r),this.camera.perspToOrtho.setScalar(clamp$1(this.perspToOrthoMotion.value.perspToOrtho,0,1))),this.locationMotion.ended||(this.locationMotion.update(r),s.distance=this.locationMotion.value.distance,s.offset=new Vector3(this.locationMotion.value.x,this.locationMotion.value.y,this.locationMotion.value.z)),this.cameraMotion.ended||(this.cameraMotion.update(r),s.longitude=this.cameraMotion.value.longitude,s.latitude=this.cameraMotion.value.latitude,s.fov=this.cameraMotion.value.fov),isEmptyObject(o)||this.models.setMaterial(o),isEmptyObject(s)||this.setCamera(s),this.intersectMesh&&this.intersectMesh.parent){var l=this.camera.position.distanceTo(this.intersectMesh.position),u=2*Math.tan(.5*this.camera.fov/180*Math.PI),c=l*u/5;this.intersectMesh.scale.setScalar(c)}}},t.prototype.getTargetState=function(){var r=this.cameraMotion.getKeyFrameSegment(now())[1],n=this.locationMotion.getKeyFrameSegment(now())[1];return __assign(__assign({},this.currentPano),{mode:this.mode,longitude:r.value.longitude,latitude:r.value.latitude,fov:r.value.fov,offset:new Vector3(n.value.x,n.value.y,n.value.z),distance:n.value.distance})},t.prototype.initAnimation=function(){var r=this;return this.destroyed?Promise.resolve():new Promise(function(n){var o=r.initial;o.state,o.currentState;var s=o.duration,l=o.userAction;r.userAction=l;var u=t.initAnimationEndState(r),c=pick(u,["longitude","latitude","fov"]),h={x:u.offset.x,y:u.offset.y,z:u.offset.z,distance:u.distance},f={modelAlpha:1},m={perspToOrtho:0};r.emit("initAnimation.start",createEvent("initAnimation.start",{state:u,userAction:r.userAction})),r.modelAlphaMotion.set(f,s/3).catch(noop$1),r.perspToOrthoMotion.set(m,s).catch(noop$1),r.cameraMotion.set(c,s).catch(noop$1),r.locationMotion.set(h,s).then(function(){r.emit("initAnimation.end",createEvent("initAnimation.end",{state:u,userAction:r.userAction}))},function(y){var A=__assign(__assign(__assign({},r.currentPano),{mode:r.mode}),clonePose(r.camera.pose));r.emit("initAnimation.end",createEvent("initAnimation.end",{state:A,userAction:r.userAction}))}).then(function(){n()})})},t.prototype.updateRenderSize=function(r){this.needsRender=!0,this.modelSceneNeedsRender=!0,this.screenBuffers.forEach(function(n){n!==null&&n.setSize(r.x,r.y)})},t.prototype.getForwardObserverOrNot=function(r){var n=this,o=this.models.intersectRaycaster(r)[0];if(!o)return null;var s=this.works.resolvedObservers.filter(function(h){for(var f,m=0,y=n.models;m<y.length;m++){var A=y[m];if(A.visible&&((f=A.work)===null||f===void 0?void 0:f.workCode)===h.work.workCode)return!0}return!1}),l=arrayMin(s,function(h){return h.standingPosition.distanceTo(o.point)},!0),u=l[0],c=l[1];return u&&c<10?u:null},t.prototype.coordinatesForOffset=function(r){var n=this.renderer.getSize(new Vector2);return{longitude:-2*r.x/(n.x*this.scissor.width),latitude:2*r.y/(n.y*this.scissor.height)}},t.prototype.requestMomentumMovement=function(r,n,o,s){var l=this;if(this.inMomentumMovement!==null){for(var u=__assign({},o),c={longitude:0,latitude:0},h=0;h<s;h++)u.longitude*=.996,u.latitude*=.996*.998,c.longitude+=u.longitude,c.latitude+=u.latitude;var f=formatRad(this.cameraMotion.value.longitude+c.longitude),m=clamp$1(this.cameraMotion.value.latitude+c.latitude,this.minLatitude,this.maxLatitude),y=__assign(__assign({},this.currentPano),{mode:this.mode,longitude:f,latitude:m,fov:this.cameraMotion.value.fov,offset:this.camera.pose.offset.clone(),distance:this.camera.pose.distance}),A=!(u.longitude>1e-4||u.longitude<-1e-4||u.latitude>1e-4||u.latitude<-1e-4),M=createEvent("gesture.momentum",__assign(__assign({},r),{isFirst:n,isFinal:A,state:y}));if(this.inMomentumMovement.event=M,this.emit("gesture.momentum",M),r.defaultPrevented){this.inMomentumMovement=null;return}this.inMomentumMovement&&(this.cameraMotion.set({longitude:f,latitude:m},0).catch(noop$1),A?this.inMomentumMovement=null:AnimationFrameLoop.shared.add(function(b,T){l.requestMomentumMovement(r,!1,u,T|0)},!0,1))}},t.prototype.onPanGesture=function(r){this.userAction=r.userAction,this.stopMomentumMovement(),this.hideIntersectMesh();var n=this.panState,o=r.pointers.length;if(r.isFinal?delete this.panState:this.panState={pointerLength:o,x:r.center.x,y:r.center.y},!(typeof n>"u"||n.pointerLength!==o)){var s={x:r.center.x-n.x,y:r.center.y-n.y},l=this.relativeClientPosition(r.center),u=this.camera.pose.latitude<Math.PI/6||l.y<0?1:-1;s.x*=u;var c=this.coordinatesForOffset(s),h=formatRad(this.cameraMotion.value.longitude+c.longitude),f=clamp$1(this.cameraMotion.value.latitude+c.latitude,this.minLatitude,this.maxLatitude);this.camera.aspect<1&&Math.abs(r.overallVelocityX)>.2&&Math.atan2(Math.abs(r.overallVelocityY),Math.abs(r.overallVelocityX))<Math.PI/6.923&&(f=this.cameraMotion.value.latitude);var m=__assign(__assign({},this.currentPano),{mode:this.mode,longitude:h,latitude:f,fov:this.camera.pose.fov,offset:this.camera.pose.offset,distance:this.camera.pose.distance});if(r.state=m,this.emit("gesture.pan",r),!r.defaultPrevented&&(this.cameraMotion.set({longitude:m.longitude,latitude:m.latitude},0).catch(noop$1),r.isFinal)){var y=r.velocityX*u,A=r.velocityY;this.inMomentumMovement={uuid:createUuid()},this.requestMomentumMovement(r,!0,this.coordinatesForOffset({x:y,y:A}),0)}}},t.prototype.onPinchGesture=function(r){var n;if(this.initAnimationIsReady){this.userAction=r.userAction,this.stopMomentumMovement();var o=(n=this.pinchState)===null||n===void 0?void 0:n.fov;if(r.isFirst){this.pinchState={x:r.center.x,y:r.center.y,fov:this.cameraMotion.value.fov};return}if(r.isFinal&&(delete this.panState,delete this.pinchState),typeof o<"u"){var s=clamp$1(o/r.scale,this.minFov,this.maxFov);r.state.fov=s,this.emit("gesture.pinch",r),!r.defaultPrevented&&(this.cameraMotion.set({fov:s},0).catch(noop$1),this.onPanGesture(r))}}},t.prototype.onMouseMove=function(r){var n,o;if(this.intersectMesh.parent&&!this.panState){if(this.emit("gesture.mousemove",r),r.defaultPrevented){this.hideIntersectMesh();return}var s=r.center.raycaster;if(r.isFinal&&this.intersectMesh.parent&&this.intersectMesh.visible===!0){this.hideIntersectMesh();return}var l=this.models.intersectRaycaster(s)[0],u=createEvent("intersect.update",{raycaster:s,intersection:l??null,object:this.intersectMesh});if(this.emit("intersect.update",u),u.defaultPrevented){this.hideIntersectMesh();return}if(l){var c=(o=(n=l.face)===null||n===void 0?void 0:n.normal)!==null&&o!==void 0?o:new Vector3().copy(s.ray.direction).multiplyScalar(-1),h=c.clone(),f=l.point.clone();this.intersectMesh.position.copy(f);var m=f.clone().add(h);if(this.intersectMesh.lookAt(m),Math.abs(c.y)>.99){var y=this.camera.position.clone().sub(f);this.intersectMesh.rotation.z=-Math.atan2(y.z,y.x)}this.intersectMesh.visible=!0,this.needsRender=!0}else this.hideIntersectMesh()}},t.prototype.onMouseWheel=function(r){if(this.initAnimationIsReady){this.userAction=r.userAction,this.stopMomentumMovement();var n=this,o=n.minFov,s=n.maxFov,l=clamp$1(this.camera.fov-r.center.delta,o,s);r.state.fov=l,this.emit("gesture.mousewheel",r),!r.defaultPrevented&&this.cameraMotion.set({fov:l},0).catch(noop$1)}},t.prototype.onTapGesture=function(r){var n=this;this.userAction=!0,this.stopMomentumMovement();var o=r.center.raycaster,s=this.getForwardObserverOrNot(o);if(!s)this.emit("gesture.tap",r);else{var l={longitude:this.camera.pose.longitude,latitude:0},u=__assign(__assign({},r.state),{mode:"Panorama",workCode:s.pano.workCode,panoIndex:s.pano.panoIndex,longitude:l.longitude,latitude:l.latitude,offset:s?s.position.clone():new Vector3,distance:0});if(r.state=u,this.emit("gesture.tap",r),!r.defaultPrevented&&(this.emit("pano.select",createEvent("pano.select",{prevPano:this.currentPano,state:u,userAction:r.userAction,options:l,progress:0,error:null})),s&&s.active)){var c=this.currentTapId=createUuid();this.preloadPano(s.pano).then(function(h){n.currentTapId===c&&n.emit("pano.request",createEvent("pano.request",{userAction:!0,prevPano:n.currentPano,progress:0,state:u,options:l,error:null}))})}}},t.prototype.onDblTapGesture=function(r){this.userAction=r.userAction,this.stopMomentumMovement();var n=this.cameraMotion.value.fov,o=this.minFov-n<n-this.defaultFov?this.minFov:this.defaultFov;r.state.fov=o,this.emit("gesture.dbltap",r),!r.defaultPrevented&&(this.cameraMotion.set({fov:o},360).catch(noop$1),this.hideIntersectMesh())},t.prototype.hideIntersectMesh=function(){this.intersectMesh.visible=!1,this.needsRender=!0},t}(BaseController);__assign({},omit(defaultFloorplanControllerCustomInitArgs,["defaultLongitude","defaultLatitude","maxLatitude","minLatitude"]));var TopviewController=function(e){__extends(t,e);function t(r){var n=this,o=t.parseArgs(r);return n=e.call(this,o)||this,n.mode="Topview",n}return t.parseArgs=function(r){if(r instanceof t)return r;var n=__assign(__assign({},r),{defaultLongitude:0,defaultLatitude:Math.PI/2});return e.parseArgs.call(this,n)},t.initAnimationEndState=function(r){var n=this.parseArgs(r),o=e.initAnimationEndState.call(this,n);return __assign(__assign({},o),{longitude:n.defaultLongitude,latitude:n.defaultLatitude,mode:"Topview"})},t.prototype.updateConfiguration=function(r){return e.prototype.updateConfiguration.call(this,__assign(__assign({},r),{defaultLongitude:0,defaultLatitude:Math.PI/2}))},t.prototype.updateModel=function(r){this.needsRender=!0,this.modelSceneNeedsRender=!0;var n=this.models.bounding.getCenter(new Vector3);this.locationMotion.set({x:n.x,y:n.y,z:n.z,distance:FloorplanController.distanceFromModel(this.models,this.defaultFov,this.camera.aspect)},0).catch(noop$1)},t.prototype.updateCamera=function(r,n,o){var s=this;return this.initAnimationReady.then(function(){s.userAction=o,s.stopMomentumMovement();var l={},u={};return r.distance!==void 0&&(l.distance=r.distance),r.offset!==void 0&&(l.x=r.offset.x,l.y=r.offset.y,l.z=r.offset.z),r.longitude!==void 0&&(u.longitude=r.longitude),r.latitude!==void 0&&(u.latitude=r.latitude),r.fov!==void 0&&(u.fov=r.fov),s.locationMotion.set(l,n).catch(noop$1),s.cameraMotion.set(u,n).catch(noop$1)})},t.prototype.updateCameraWithKeyframes=function(r,n,o){var s=this;return this.initAnimationReady.then(function(){s.userAction=o,s.stopMomentumMovement();for(var l=[],u=[],c=0,h=r;c<h.length;c++){var f=h[c];l.push({key:f.key,progress:f.progress,value:{distance:f.value.distance,x:f.value.offset.x,y:f.value.offset.y,z:f.value.offset.z}}),u.push({key:f.key,progress:f.progress,value:{longitude:f.value.longitude,latitude:f.value.latitude,fov:f.value.fov}})}return s.locationMotion.setKeyframes(l,n).catch(noop$1),s.cameraMotion.setKeyframes(r,n)})},t.prototype.initAnimation=function(){var r=this;return this.destroyed?Promise.resolve():new Promise(function(n){var o=r.initial;o.state,o.currentState;var s=o.duration,l=o.userAction;r.userAction=l;var u=t.initAnimationEndState(r),c={longitude:u.longitude,latitude:u.latitude,fov:u.fov},h={x:u.offset.x,y:u.offset.y,z:u.offset.z,distance:u.distance},f={modelAlpha:1},m={perspToOrtho:1};r.emit("initAnimation.start",createEvent("initAnimation.start",{state:u,userAction:r.userAction})),r.modelAlphaMotion.set(f,s/3).catch(noop$1),r.perspToOrthoMotion.set(m,s).catch(noop$1),r.cameraMotion.set(c,s).catch(noop$1),r.locationMotion.set(h,s).then(function(){r.emit("initAnimation.end",createEvent("initAnimation.end",{state:u,userAction:r.userAction}))},function(y){var A=__assign(__assign(__assign({},r.currentPano),{mode:r.mode}),clonePose(r.camera.pose));r.emit("initAnimation.end",createEvent("initAnimation.end",{state:A,userAction:r.userAction}))}).then(function(){n()})})},t.prototype.requestMomentumMovement=function(){this.inMomentumMovement=null},t.prototype.onPanGesture=function(r){this.userAction=r.userAction,this.stopMomentumMovement();var n=this.panState,o=r.pointers.length;if(r.isFinal?delete this.panState:this.panState={pointerLength:o,x:r.center.x,y:r.center.y},!(typeof n>"u"||n.pointerLength!==o)){var s={x:r.center.x-n.x,y:r.center.y-n.y},l=new Vector3(this.locationMotion.value.x,this.locationMotion.value.y,this.locationMotion.value.z),u=this.locationMotion.value.distance;u*=Math.tan(this.cameraMotion.value.fov/2*Math.PI/180);var c=this.renderer.getSize(new Vector2),h=2*s.x*u/c.y,f=2*s.y*u/c.y,m=new Vector3;m.setFromMatrixColumn(this.camera.matrix,0),m.multiplyScalar(-h),l.add(m),m.setFromMatrixColumn(this.camera.matrix,1),m.multiplyScalar(f),l.add(m);var y=this.models.bounding.getCenter(new Vector3),A=this.models.bounding.getSize(new Vector3),M=Math.max(A.x,A.y,A.z)/2;l.clamp(y.clone().sub(new Vector3().setScalar(M)),y.clone().add(new Vector3().setScalar(M)));var b=__assign(__assign({},this.currentPano),{mode:this.mode,longitude:0,latitude:Math.PI/2,fov:this.cameraMotion.value.fov,offset:l,distance:this.locationMotion.value.distance});r.state=b,this.emit("gesture.pan",r),!r.defaultPrevented&&this.locationMotion.set({x:l.x,y:l.y,z:l.z},0).catch(noop$1)}},t.prototype.onPinchGesture=function(r){var n;if(this.initAnimationIsReady){this.userAction=r.userAction,this.stopMomentumMovement();var o=(n=this.pinchState)===null||n===void 0?void 0:n.fov;if(r.isFirst){this.pinchState={x:r.center.x,y:r.center.y,fov:this.cameraMotion.value.fov};return}if(r.isFinal&&delete this.pinchState,typeof o<"u"){var s=clamp$1(o/r.scale,this.minFov,this.maxFov);r.state.fov=s,this.emit("gesture.pinch",r),!r.defaultPrevented&&(this.cameraMotion.set({fov:s},0).catch(noop$1),r.type="gesture.pan",this.onPanGesture(r))}}},t.prototype.onMouseWheel=function(r){if(this.initAnimationIsReady){this.userAction=r.userAction,this.stopMomentumMovement();var n=clamp$1(this.cameraMotion.value.fov-r.center.delta,this.minFov,this.maxFov);r.state.fov=n,this.emit("gesture.mousewheel",r),!r.defaultPrevented&&this.cameraMotion.set({fov:n},0).catch(noop$1)}},t}(FloorplanController),defaultPanoramaLikeControllerCustomInitArgs={defaultLatitude:0,defaultFov:90,maxFov:120,minFov:20,maxLatitude:+Math.PI/2,minLatitude:-Math.PI/2,moveSpeed:3.4,intersectMeshCreator:function(){return new IntersectMesh}},PanoramaLikeController=function(e){__extends(t,e);function t(r){var n=this,o=t.parseArgs(r);return n=e.call(this,o)||this,n.mode="PanoramaLike",n.defaultLatitude=o.defaultLatitude,n.defaultFov=o.defaultFov,n.maxFov=o.maxFov,n.minFov=o.minFov,n.maxLatitude=o.maxLatitude,n.minLatitude=o.minLatitude,n.moveSpeed=o.moveSpeed,n.intersectMeshCreator=o.intersectMeshCreator,n.intersectMesh=n.intersectMeshCreator(),n.intersectMesh.name="intersect",n.intersectMesh.visible=!1,n.helper.add(n.intersectMesh),n}return t.parseArgs=function(r){var n,o,s,l,u,c,h,f;if(r instanceof t)return r;var m=e.parseArgs.call(this,r);return __assign(__assign({},m),{defaultLatitude:(n=r.defaultLatitude)!==null&&n!==void 0?n:defaultPanoramaLikeControllerCustomInitArgs.defaultLatitude,defaultFov:(o=r.defaultFov)!==null&&o!==void 0?o:defaultPanoramaLikeControllerCustomInitArgs.defaultFov,maxFov:(s=r.maxFov)!==null&&s!==void 0?s:defaultPanoramaLikeControllerCustomInitArgs.maxFov,minFov:(l=r.minFov)!==null&&l!==void 0?l:defaultPanoramaLikeControllerCustomInitArgs.minFov,maxLatitude:(u=r.maxLatitude)!==null&&u!==void 0?u:defaultPanoramaLikeControllerCustomInitArgs.maxLatitude,minLatitude:(c=r.minLatitude)!==null&&c!==void 0?c:defaultPanoramaLikeControllerCustomInitArgs.minLatitude,moveSpeed:(h=r.moveSpeed)!==null&&h!==void 0?h:defaultPanoramaLikeControllerCustomInitArgs.moveSpeed,intersectMeshCreator:(f=r.intersectMeshCreator)!==null&&f!==void 0?f:defaultPanoramaLikeControllerCustomInitArgs.intersectMeshCreator})},t.initAnimationEndState=function(r){var n,o,s,l,u,c,h=this.parseArgs(r),f=h.works,m=r.initial,y=m.state,A=m.currentState,M=typeof y.panoIndex=="number"?{workCode:(s=(n=y.workCode)!==null&&n!==void 0?n:(o=h.works[0])===null||o===void 0?void 0:o.workCode)!==null&&s!==void 0?s:"",panoIndex:y.panoIndex}:{workCode:A.workCode,panoIndex:A.panoIndex},b=f.getResolvedObserver(M),T=(l=y.longitude)!==null&&l!==void 0?l:A.longitude,_=clamp$1((u=y.latitude)!==null&&u!==void 0?u:isFristPersonMode(A.mode)?A.latitude:h.defaultLatitude,h.minLatitude,h.maxLatitude),S=clamp$1((c=y.fov)!==null&&c!==void 0?c:isFristPersonMode(A.mode)?A.fov:h.defaultFov,h.minFov,h.maxFov),C=b?b.position.clone():new Vector3;return{workCode:M.workCode,panoIndex:M.panoIndex,mode:"PanoramaLike",longitude:T,latitude:_,fov:S,offset:C,distance:0}},t.prototype.updateConfiguration=function(r){var n=e.prototype.updateConfiguration.call(this,r);if(n===!1)return!1;if(r.defaultLatitude!==void 0&&this.defaultLatitude!==r.defaultLatitude&&(this.defaultLatitude=r.defaultLatitude),r.maxLatitude!==void 0&&this.maxLatitude!==r.maxLatitude&&(this.maxLatitude=r.maxLatitude),r.minLatitude!==void 0&&this.minLatitude!==r.minLatitude&&(this.minLatitude=r.minLatitude),r.defaultFov!==void 0&&this.defaultFov!==r.defaultFov&&(this.defaultFov=r.defaultFov),r.maxFov!==void 0&&this.maxFov!==r.maxFov&&(this.maxFov=r.maxFov),r.minFov!==void 0&&this.minFov!==r.minFov&&(this.minFov=r.minFov),r.moveSpeed!==void 0&&this.moveSpeed!==r.moveSpeed&&(this.moveSpeed=r.moveSpeed),r.intersectMeshCreator!==void 0&&this.intersectMeshCreator!==r.intersectMeshCreator){this.intersectMeshCreator=r.intersectMeshCreator;var o=this.intersectMesh;this.intersectMesh=this.intersectMeshCreator(),this.intersectMesh.name=o.name,this.intersectMesh.visible=o.visible;var s=this.intersectMesh.parent;s&&s.add(this.intersectMesh),o.dispose()}return!0},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.intersectMesh&&(this.helper.remove(this.intersectMesh),this.intersectMesh.dispose()),delete this.panState},t.prototype.isReady=function(){return this.panState||this.pinchState?!1:e.prototype.isReady.call(this)},t.prototype.calculateMovingDuration=function(r,n){switch(typeof r){case"function":return r(n,this.moveSpeed);case"number":return r;case"string":return Number(r);default:return clamp$1(n,2,5)/this.moveSpeed*1e3}},t.prototype.hideIntersectMesh=function(){this.intersectMesh.visible=!1,this.needsRender=!0},t.prototype.coordinatesForOffset=function(r){var n=this.cameraMotion.value.fov,o=this.camera.aspect,s=this.renderer.getSize(new Vector2);return{longitude:2*r.x/(s.x*this.scissor.width)*n/95*o,latitude:-2*r.y/(s.y*this.scissor.height)*n/95}},t.prototype.cameraBounce=function(){var r=this.cameraMotion.value,n=r.longitude,o=r.latitude,s=r.fov,l=[{progress:0,value:{longitude:n,latitude:o,fov:s}},{progress:.5,value:{longitude:n,latitude:o,fov:s*.98}},{progress:1,value:{longitude:n,latitude:o,fov:s}}];this.cameraMotion.setKeyframes(l,500).catch(noop$1)},t.prototype.requestMomentumMovement=function(r,n,o,s){var l=this;if(this.inMomentumMovement!==null){for(var u=__assign({},o),c={longitude:0,latitude:0},h=0;h<s;h++)u.longitude*=.996,u.latitude*=.996*.99,c.longitude+=u.longitude,c.latitude+=u.latitude;var f=formatRad(this.cameraMotion.value.longitude+c.longitude),m=clamp$1(this.cameraMotion.value.latitude+c.latitude,this.minLatitude,this.maxLatitude),y=__assign(__assign({},this.currentPano),{mode:this.mode,longitude:f,latitude:m,fov:this.cameraMotion.value.fov,offset:this.camera.pose.offset.clone(),distance:this.camera.pose.distance}),A=!(u.longitude>1e-4||u.longitude<-1e-4||u.latitude>1e-4||u.latitude<-1e-4),M=createEvent("gesture.momentum",__assign(__assign({},r),{isFirst:n,isFinal:A,state:y}));if(this.inMomentumMovement.event=M,this.emit("gesture.momentum",M),r.defaultPrevented){this.inMomentumMovement=null;return}this.inMomentumMovement&&(this.cameraMotion.set({longitude:f,latitude:m},0).catch(noop$1),A?this.inMomentumMovement=null:AnimationFrameLoop.shared.add(function(b,T){l.requestMomentumMovement(r,!1,u,T|0)},!0,1))}},t.prototype.onPanGesture=function(r){this.userAction=r.userAction,this.stopMomentumMovement(),this.hideIntersectMesh();var n=this.panState,o=r.pointers.length;if(r.isFinal?delete this.panState:this.panState={pointerLength:o,x:r.center.x,y:r.center.y},!(typeof n>"u"||n.pointerLength!==o)){var s={x:r.center.x-n.x,y:r.center.y-n.y},l=this.coordinatesForOffset(s),u=formatRad(this.cameraMotion.value.longitude+l.longitude),c=clamp$1(this.cameraMotion.value.latitude+l.latitude,this.minLatitude,this.maxLatitude);this.camera.aspect<1&&Math.abs(r.overallVelocityX)>.2&&Math.atan2(Math.abs(r.overallVelocityY),Math.abs(r.overallVelocityX))<Math.PI/6.923&&(c=this.cameraMotion.value.latitude);var h=__assign(__assign({},this.currentPano),{mode:this.mode,longitude:u,latitude:c,fov:this.cameraMotion.value.fov,offset:this.camera.pose.offset.clone(),distance:this.camera.pose.distance});if(r.state=h,this.emit("gesture.pan",r),!r.defaultPrevented){var f={longitude:h.longitude,latitude:h.latitude,fov:h.fov};if(this.cameraMotion.set(f,0).catch(noop$1),r.isFinal){var m=r.velocityX,y=r.velocityY*.6;Math.abs(y)>.5&&Math.abs(m)<.5&&(m=0),this.inMomentumMovement={uuid:createUuid()},this.requestMomentumMovement(r,!0,this.coordinatesForOffset({x:m,y}),0)}}}},t.prototype.onPinchGesture=function(r){var n;this.userAction=r.userAction,this.stopMomentumMovement();var o=(n=this.pinchState)===null||n===void 0?void 0:n.fov,s=r.scale;if(r.isFirst){this.pinchState={x:r.center.x,y:r.center.y,fov:this.cameraMotion.value.fov};return}if(r.isFinal&&delete this.pinchState,typeof o<"u"){var l=clamp$1(o/s,this.minFov,this.maxFov);r.state.fov=l,this.emit("gesture.pinch",r),!r.defaultPrevented&&(this.cameraMotion.set({fov:l},0).catch(noop$1),r.type="gesture.pan",this.onPanGesture(r))}},t.prototype.onMouseWheel=function(r){this.userAction=r.userAction,this.stopMomentumMovement();var n=clamp$1(this.cameraMotion.value.fov-r.center.delta,this.minFov,this.maxFov);r.state.fov=n,this.emit("gesture.mousewheel",r),!r.defaultPrevented&&(this.cameraMotion.set({fov:n},0).catch(noop$1),this.onMouseMove(r))},t.prototype.onMouseMove=function(r){var n,o;if(this.intersectMesh.parent&&!this.panState&&(this.emit("gesture.mousemove",r),!r.defaultPrevented)){var s=r.center.raycaster;if(r.isFinal&&this.intersectMesh.parent){this.hideIntersectMesh();return}var l=this.models.intersectRaycaster(s)[0],u=createEvent("intersect.update",{raycaster:s,intersection:l??null,object:this.intersectMesh});if(this.emit("intersect.update",u),u.defaultPrevented){this.hideIntersectMesh();return}if(l){var c=(o=(n=l.face)===null||n===void 0?void 0:n.normal)!==null&&o!==void 0?o:new Vector3().copy(s.ray.direction).multiplyScalar(-1),h=c.clone(),f=l.point.clone();this.intersectMesh.position.copy(f);var m=f.clone().add(h);if(this.intersectMesh.lookAt(m),Math.abs(c.y)>.99){var y=this.camera.position.clone().sub(f);this.intersectMesh.rotation.z=-Math.atan2(y.z,y.x)}this.intersectMesh.visible=!0,this.needsRender=!0}else this.hideIntersectMesh()}},t.prototype.onDblTapGesture=function(r){this.userAction=r.userAction,this.stopMomentumMovement();var n=this.cameraMotion.value.fov,o=2,s=this.works.getResolvedObserver(this.currentPano);if(s){var l=s.images.tiles;l&&l.length&&(o=Math.max.apply(Math,l.map(function(h){return h.level})))}var u=Math.max(40-o*5,this.minFov,5),c=u-n<n-this.defaultFov?u:this.defaultFov;r.state.fov=c,this.emit("gesture.dbltap",r),!r.defaultPrevented&&(this.cameraMotion.set({fov:c},360).catch(noop$1),this.hideIntersectMesh())},t}(BaseController),blankVideo="data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw",result;function canplayVideo(){return result||(result=new Promise(function(e){var t,r=document.createElement("video");r.muted=!0,r.src=blankVideo,r.addEventListener("timeupdate",function n(){r.removeEventListener("timeupdate",n,!1),clearTimeout(t);var o=document.createElement("canvas");o.width=o.height=1;var s=o.getContext("2d");if(!s){e(!1);return}s.drawImage(r,0,0,1,1);var l=s.getImageData(0,0,1,1).data;l[3]>10?e(!0):e(!1)},!1),r.addEventListener("canplay",function n(){r.removeEventListener("canplay",n,!1),r.play()},!1),t=window.setTimeout(function(){return e(!1)},1e3)}))}var FRAGMENT=`
#include <common>
uniform sampler2D inputBuffer;
uniform float scale;
varying vec2 vUv;

void main() {
  float u = (vUv.x - 0.5) * scale + 0.5;
  float v = (vUv.y - 0.5) * scale + 0.5;
  vec3 rgb = texture2D(inputBuffer, vec2(u, v)).rgb;
  float luminance = clamp(linearToRelativeLuminance(rgb), 0.1, 0.9);
  gl_FragColor = vec4(luminance);
}
`,LuminancePass=function(e){__extends(t,e);function t(r,n){return n===void 0&&(n=.5),e.call(this,r,{uniforms:{inputBuffer:new Uniform(null),scale:new Uniform(n)},fragment:FRAGMENT})||this}return t}(Pass),Effect=function(){function e(t,r,n,o){this.enable=!0,this.renderer=t,this.camera=n,this.models=o,this.scene=r,this.copyPass=new CopyPass(this.renderer)}return e.prototype.render=function(t,r){},e.prototype.dispose=function(){this.copyPass.dispose()},e}(),NextStepPass=function(e){__extends(t,e);function t(r,n){n===void 0&&(n=.002);var o=e.call(this,r,{uniforms:{targetBuffer:new Uniform(null),inputBuffer:new Uniform(null),step:new Uniform(n)},fragment:`
        uniform sampler2D targetBuffer;
        uniform sampler2D inputBuffer;
        uniform float step;
        varying vec2 vUv;
        void main() {

          #ifdef GL_EXT_shader_texture_lod
            #if __VERSION__ < 300
              float target = texture2DLodEXT(targetBuffer, vUv, 5.0).r;
            #else
              float target = textureLod(targetBuffer, vUv, 5.0).r;
            #endif
          #else
            float target = texture2D(targetBuffer, vUv).r;
          #endif
          float current = texture2D(inputBuffer, vUv).r;

          float result;
          if (abs(target - current) < step) {
            result = target;
          } else if (target - current > 0.0) {
            result = current + step;
          } else {
            result = current - step;
          }
          gl_FragColor = vec4(result, result, result, 1.0);
        }
      `})||this;return o.material.extensions.shaderTextureLOD=!0,o}return Object.defineProperty(t.prototype,"targetBuffer",{get:function(){return this.material.uniforms.targetBuffer.value},set:function(r){this.material.uniforms.targetBuffer.value=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"step",{get:function(){return this.material.uniforms.step.value},set:function(r){this.material.uniforms.step.value=r},enumerable:!1,configurable:!0}),t}(Pass),LuminanceAdaptivePass=function(e){__extends(t,e);function t(r){var n=e.call(this,r,{uniforms:{inputBuffer:new Uniform(null),luminanceAdaptiveBuffer:new Uniform(null),progress:new Uniform(0)},fragment:`
        #include <common>
        uniform sampler2D inputBuffer;
        uniform sampler2D luminanceAdaptiveBuffer;
        uniform float progress;
        varying vec2 vUv;

        void main() {
          float middleGrey = 1.5;
          float whitePoint = 13.0;
          float exposure = 1.4;
          vec4 inputColor = texture2D(inputBuffer, vUv);
          vec3 rgb = inputColor.rgb * exposure;
          float alpha = inputColor.a;
          float luminance = linearToRelativeLuminance(rgb);
          float lumAvg = texture2D(luminanceAdaptiveBuffer, vec2(0.5)).r;
          float lumScaled = (luminance * middleGrey) / max(lumAvg, 1e-6);
          float lumCompressed = lumScaled * (1.0 + lumScaled / (whitePoint * whitePoint));
          lumCompressed /= (1.0 + lumScaled);
          rgb = clamp(lumCompressed * rgb, 0.0, 1.0);
          gl_FragColor = mix(inputColor, vec4(rgb, alpha), progress * 0.9);
        }
      `})||this;return n.material.transparent=!0,n}return Object.defineProperty(t.prototype,"luminanceAdaptiveBuffer",{get:function(){return this.material.uniforms.luminanceAdaptiveBuffer.value},set:function(r){this.material.uniforms.luminanceAdaptiveBuffer.value=r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"progress",{get:function(){return this.material.uniforms.progress.value},set:function(r){this.material.uniforms.progress.value=r},enumerable:!1,configurable:!0}),t}(Pass),LuminanceAdaptiveEffect=function(e){__extends(t,e);function t(r,n,o,s){var l=e.call(this,r,n,o,s)||this;return l.enableTime=now(),l.renderer=r,l.valuePass=new ValuePass(l.renderer),l.luminancePass=new LuminancePass(l.renderer,Math.sqrt(1/3)),l.nextStepPass=new NextStepPass(l.renderer,.01),l.luminanceAdaptivePass=new LuminanceAdaptivePass(l.renderer),l}return t.prototype.render=function(r){this.renderer.setRenderTarget(r[0]),this.renderer.render(this.scene,this.camera),this.enableTime===null&&(this.enableTime=now()),this.luminanceTargetBuffer||(this.luminanceTargetBuffer=new WebGLRenderTarget(128,128,{minFilter:LinearMipmapLinearFilter,magFilter:LinearFilter,encoding:this.renderer.outputEncoding,stencilBuffer:!1,depthBuffer:!1,format:RGBAFormat,generateMipmaps:!0}),this.nextStepPass.targetBuffer=this.luminanceTargetBuffer.texture),this.luminancePass.render(r[0],this.luminanceTargetBuffer),this.luminancePrevBuffer||(this.luminancePrevBuffer=new WebGLRenderTarget(1,1,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType,encoding:this.renderer.outputEncoding,stencilBuffer:!1,depthBuffer:!1}),this.valuePass.render(new Vector3(.5,.5,.5),this.luminancePrevBuffer)),this.luminanceNextBuffer||(this.luminanceNextBuffer=new WebGLRenderTarget(1,1,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType,encoding:this.renderer.outputEncoding,stencilBuffer:!1,depthBuffer:!1}),this.valuePass.render(new Vector3(.5,.5,.5),this.luminanceNextBuffer),this.luminanceAdaptivePass.luminanceAdaptiveBuffer=this.luminanceNextBuffer.texture),this.copyPass.render(this.luminanceNextBuffer,this.luminancePrevBuffer),this.nextStepPass.render(this.luminancePrevBuffer,this.luminanceNextBuffer),this.luminanceAdaptivePass.progress=Math.min((now()-this.enableTime)/100,1),this.luminanceAdaptivePass.render(r[0],r[1])},t.prototype.dispose=function(){var r,n,o;(r=this.luminanceTargetBuffer)===null||r===void 0||r.dispose(),(n=this.luminancePrevBuffer)===null||n===void 0||n.dispose(),(o=this.luminanceNextBuffer)===null||o===void 0||o.dispose(),this.copyPass.dispose(),this.luminancePass.dispose(),this.nextStepPass.dispose(),this.luminanceAdaptivePass.dispose()},t}(Effect),_a$1,sharedSortVector3=new Vector3,MAX_TILE_COUNT=64,SQRT1_2=(_a$1=Math.SQRT1_2)!==null&&_a$1!==void 0?_a$1:Math.sqrt(2),TILE_QUATERNION={up:new Quaternion(SQRT1_2,0,0,SQRT1_2),down:new Quaternion(-SQRT1_2,0,0,SQRT1_2),left:new Quaternion(0,SQRT1_2,0,SQRT1_2),right:new Quaternion(0,-SQRT1_2,0,SQRT1_2),front:new Quaternion(0,0,0,1),back:new Quaternion(0,1,0,0)},vertices$2=new Float32Array([-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0]),uvs$1=new Float32Array([0,0,1,0,0,1,1,1]),index$2=new Uint8Array([0,1,2,1,3,2]),geometry$3=new BufferGeometry;geometry$3.setAttribute("position",new BufferAttribute(vertices$2,3));geometry$3.setAttribute("uv",new BufferAttribute(uvs$1,2));geometry$3.setIndex(new BufferAttribute(index$2,1));var TILE_MATERIAL_VERTEX_SHADER=`
uniform float flipY;
varying vec2 vUv;
void main() {
  vUv = vec2(uv.x, mix((1.0 - uv.y), uv.y, flipY));
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,TILE_MATERIAL_FRAGMENT_SHADER=`
#if defined(USE_LUMINANCE)
uniform sampler2D luminanceMap;
#endif
uniform sampler2D map;
uniform float level;
varying vec2 vUv;

void main() {
  gl_FragColor = texture2D(map, vUv);
  #if defined(USE_LUMINANCE)
  gl_FragColor.a = 1.0 - texture2D(luminanceMap, vUv).r;
  #endif
}
`,TileMaterial=function(e){__extends(t,e);function t(){var r=e.call(this,{uniforms:{map:{value:null},luminanceMap:{value:null},flipY:{value:1},level:{value:0}},vertexShader:TILE_MATERIAL_VERTEX_SHADER,fragmentShader:TILE_MATERIAL_FRAGMENT_SHADER})||this;return r.depthTest=!1,r.depthWrite=!1,r.blending=NoBlending,r.map=r.uniforms.map.value,r.luminanceMap=r.uniforms.luminanceMap.value,r.flipY=!!r.uniforms.flipY.value,r.level=r.uniforms.level.value,Object.defineProperties(r,{map:{get:function(){return this.uniforms.map.value},set:function(n){this.uniforms.map.value=n}},luminanceMap:{get:function(){return this.uniforms.luminanceMap.value},set:function(n){this.uniforms.luminanceMap.value=n,this.defines.USE_LUMINANCE=n!==null,this.needsUpdate=!0}},flipY:{get:function(){return this.uniforms.flipY.value===1},set:function(n){this.uniforms.flipY.value=n?1:0}},level:{get:function(){return this.uniforms.level.value},set:function(n){this.uniforms.level.value=n}}}),r}return t}(ShaderMaterial),TileMesh=function(e){__extends(t,e);function t(r,n){var o=e.call(this,geometry$3,new TileMaterial)||this;return r.box.getCenter(o.position),o.quaternion.multiplyQuaternions(new Quaternion().setFromAxisAngle(new Vector3(0,1,0),-Math.PI),TILE_QUATERNION[r.face]),o.scale.setScalar(r.size),o.node=r,o.name="tiling:tile",o.material.visible=!1,o.activeTime=-1,o.disposed=!1,o.needsRender=!1,o.frustumCulled=!1,n.then(function(s){var l=s[0],u=s[1];o.disposed?(l.dispose(),u==null||u.dispose()):(o.material.map=l,o.material.luminanceMap=u,o.material.flipY=!!l.flipY,o.material.level=r.level,o.material.needsUpdate=!0,o.material.visible=!0,o.needsRender=!0)}).catch(noop$1),o}return t.prototype.updateTime=function(r){},t.prototype.dispose=function(){var r;this.disposed=!0,this.material.map&&(this.material.map.dispose(),(r=this.material.luminanceMap)===null||r===void 0||r.dispose()),this.material.dispose()},t}(Mesh),TilingObject3D=function(e){__extends(t,e);function t(){var r=e.call(this)||this;return r.needsRender=!1,r.name="tiling",r}return t}(Group),Tiling=function(){function e(t,r,n){this.disposed=!1,this.textureLoader=new TextureLoader,this.minLevel=r,this.level=0,this.panoId="[0]",this.maxRequest=e.DEFAULT_MAX_REQUEST,this.pedding=0,this.tileTree=createTileCubeTree(this.minLevel),this.tileMeshes=new Map,this.resource=[],this.luminance=null,this.imageOptions=n,this.fetcher=t,this.object=new TilingObject3D,this.object.renderOrder=-3}return e.prototype.setFetcher=function(t){this.fetcher=t},e.prototype.cleanup=function(){var t=this;this.tileMeshes.forEach(function(r){r.dispose(),t.object.remove(r),t.object.needsRender=!0}),this.tileMeshes.clear()},e.prototype.setRotation=function(t){this.disposed||this.object.quaternion.equals(t)||(this.object.quaternion.copy(t),this.object.needsRender=!0)},e.prototype.setPosition=function(t){this.disposed||this.object.position.equals(t)||(this.object.position.copy(t),this.object.needsRender=!0)},e.prototype.setResource=function(t,r){var n,o;if(!this.disposed&&!(this.resource===t&&this.luminance===r)){this.cleanup(),this.resource=t;var s=(o=(n=t.slice().sort(function(l,u){return u.level-l.level})[0])===null||n===void 0?void 0:n.level)!==null&&o!==void 0?o:0;this.tileTree=createTileCubeTree(s),this.luminance=r,this.object.needsRender=!0}},e.prototype.update=function(t,r,n){var o=this;if(!this.disposed){this.level=r;var s=t.planes[5].normal,l=[];r>=this.minLevel&&traverseTileCubeNode(this.tileTree,function(S){if(!(S.level<o.minLevel)){if(S.level>r||!t.intersectsBox(S.box))return!1;l.push(S)}}),l.sort(function(S,C){return S.level!==C.level?S.level-C.level:S.box.getCenter(sharedSortVector3).angleTo(s)-C.box.getCenter(sharedSortVector3).angleTo(s)});for(var u=new Set,c=function(S){var C=h.resource.filter(function(j){return j.level===S.level})[0];if(!C)return"continue";if(u.add(S),h.tileMeshes.has(S))return h.tileMeshes.get(S).activeTime=n,"continue";if(h.pedding>=h.maxRequest)return"continue";var P=C.size,F=h.imageOptions.transform,O=Math.pow(2,S.level)*S.position.y,N=Math.pow(2,S.level)*S.position.x,V="".concat(h.panoId,".").concat(S.face,".").concat(S.level,".").concat(O,".").concat(N),q=__assign(__assign({},pick(h.imageOptions,["format","sharpen","mappings"])),{key:"pano_tile.".concat(V),size:C.scale>=1?void 0:P*S.size*C.scale,cut:S.size===1?void 0:[P*S.position.x,P*S.position.y,P*S.size,P*S.size]});S.size===1&&console.warn("tile: ".concat(q.key," should not appear.")),S.level===1&&C.scale>=.5&&(q.format==="jpg"||/\.jpg$/.test(C[S.face]))&&(q.size=void 0,q.quality||(q.quality=70));var Q=h.textureLoader.loadTexture(C[S.face],{imageURL:{transform:F,options:q},minFilter:LinearFilter,magFilter:LinearFilter,generateMipmaps:!1,fetcher:h.fetcher}).then(function(j){return j.body}),z=null;if(h.luminance){var H=h.luminance[S.face],W=H.match(/\/cube_(\d+)\//),J=W?Number(W[1]):!1;if(J!==!1){var G=C.size*C.scale/2,te=G*S.size,X=J<G?H.replace(/\/cube_(\d+)\//,"cube_"+G):H,K=__assign(__assign({},q),{size:J*S.size===te?void 0:te,cut:S.size===1?void 0:[J*S.position.x,J*S.position.y,J*S.size,J*S.size],key:"pano_tile_luminance.".concat(V)});S.size===1&&console.warn("tile: ".concat(K.key," should not appear.")),z=h.textureLoader.loadTexture(X,{imageURL:{transform:h.imageOptions.transform,options:K},minFilter:LinearFilter,magFilter:LinearFilter,fetcher:h.fetcher}).then(function(j){return j.body}).catch(function(){return null})}}h.pedding++;var Z=Promise.all([Q,z]).then(function(j){return o.pedding--,j},function(j){return o.pedding--,Promise.reject(j)}),ee=new TileMesh(S,Z);ee.name="tiling:tile-".concat(V),ee.activeTime=n,ee.renderOrder=S.level,h.tileMeshes.set(S,ee),h.object.needsRender=!0,h.object.add(ee)},h=this,f=0,m=l;f<m.length;f++){var y=m[f];c(y)}var A=[];this.tileMeshes.forEach(function(S,C){u.has(C)||A.push(C),S.visible=C.level<=r});for(var M=A.sort(function(S,C){var P,F,O,N;return((F=(P=o.tileMeshes.get(C))===null||P===void 0?void 0:P.activeTime)!==null&&F!==void 0?F:0)-((N=(O=o.tileMeshes.get(S))===null||O===void 0?void 0:O.activeTime)!==null&&N!==void 0?N:0)}).slice(Math.max(0,MAX_TILE_COUNT-u.size)),b=0,T=M;b<T.length;b++){var y=T[b],_=this.tileMeshes.get(y);_&&(_.dispose(),this.object.remove(_),this.object.needsRender=!0),this.tileMeshes.delete(y)}}},e.prototype.dispose=function(){this.cleanup(),this.resource=[],this.disposed=!0},e.DEFAULT_MAX_REQUEST=3,e}(),vertices$1=new Float32Array([-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1]),index$1=new Uint8Array([0,2,1,2,3,1,4,6,5,6,7,5,8,10,9,10,11,9,12,14,13,14,15,13,16,18,17,18,19,17,20,22,21,22,23,21]),sharedGeometry$1=new BufferGeometry;sharedGeometry$1.setAttribute("position",new BufferAttribute(vertices$1,3));sharedGeometry$1.setIndex(new BufferAttribute(index$1,1));var PANO_VIDEO_MATERIAL_VERTEX_SHADER=`
#if defined(USE_PANO_VIDEO)
varying vec3 worldPosition;
#endif
void main() {
  vec4 transformed = vec4(position, 1.0);
  #if defined(USE_PANO_VIDEO)
  worldPosition = (modelMatrix * transformed).xyz;
  #endif
  gl_Position = projectionMatrix * modelViewMatrix * transformed;
}
`,PANO_VIDEO_TILE_MATERIAL_FRAGMENT_SHADER=`
uniform vec2 size;
uniform mat4 matrix;
uniform float alpha;
uniform sampler2D map;
#if defined(USE_PANO_VIDEO)
varying vec3 worldPosition;
#endif
#include <common>
void main() {
  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
  #if defined(USE_PANO_VIDEO)
  vec3 cameraToVertex = worldPosition - cameraPosition;
  vec4 mapCoods = vec4(cameraToVertex, 1.0) * matrix;
  vec2 uv = vec2(
    0.5 + mapCoods.x / mapCoods.z / size.x,
    0.5 - mapCoods.y / mapCoods.z / size.y
  );
  vec4 videoColor = texture2D(map, uv);
  float match = (1.0 - step(0.0, mapCoods.z)) * (1.0 - step(0.5, abs(uv.x - 0.5))) * (1.0 - step(0.5, abs(uv.y - 0.5)));
  float blendAlpha = clamp(0.0, 1.0, 5.0 * (1.0 - clamp(distance(uv, vec2(0.5, 0.5)) / 0.55 , 0.0, 1.0)));
  gl_FragColor = vec4(videoColor.rgb, match * blendAlpha * alpha);
  #endif
}
`,PanoVideo=function(){function e(){this.material=new ShaderMaterial({vertexShader:PANO_VIDEO_MATERIAL_VERTEX_SHADER,fragmentShader:PANO_VIDEO_TILE_MATERIAL_FRAGMENT_SHADER,uniforms:{size:new Uniform(null),matrix:new Uniform(null),alpha:new Uniform(null),map:new Uniform(null)},depthTest:!1,depthWrite:!1,defines:{USE_PANO_VIDEO:!1},blending:CustomBlending,blendSrc:SrcAlphaFactor,blendDst:OneMinusSrcAlphaFactor,blendSrcAlpha:OneFactor,blendDstAlpha:OneMinusSrcAlphaFactor}),this.object=new Mesh(sharedGeometry$1,this.material),this.object.visible=!1,this.object.renderOrder=-1,this.object.frustumCulled=!1,this.object.name="pano-video",this.alphaMotion=new Motion({alpha:0})}return e.prototype.setMaterial=function(t){t?(this.material.uniforms.size.value=t.size,this.material.uniforms.matrix.value=t.matrix,this.material.uniforms.map.value=t.map,this.alphaMotion.set({alpha:t.alpha},500).catch(noop$1),this.material.uniforms.alpha.value=t.alpha):(this.material.uniforms.size.value=null,this.material.uniforms.matrix.value=null,this.material.uniforms.map.value=null,this.alphaMotion.set({alpha:0},0).catch(noop$1));var r=t!==null,n=this.material.defines.USE_PANO_VIDEO;r!==n&&(this.material.defines.USE_PANO_VIDEO=r,this.material.needsUpdate=!0,this.object.visible=t!==null)},e.prototype.updateTime=function(t){this.alphaMotion.ended||(this.alphaMotion.update(t),this.material.uniforms.alpha.value=this.alphaMotion.value.alpha)},e.prototype.dispose=function(){this.material.dispose()},e}(),ROTATE_Y_PI_MATRIX$1=new Matrix4().makeRotationAxis(new Vector3(0,1,0),Math.PI),PANO_TEXTURE_SCALE$1=new Vector3(-1,1,1),CubeRenderTargetPool=function(){function e(t){t===void 0&&(t=0),this.width=t,this.pool=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.pool.length},enumerable:!1,configurable:!0}),e.prototype.create=function(){return new WebGLCubeRenderTarget(this.width,{stencilBuffer:!1,depthBuffer:!1})},e.prototype.pop=function(){var t=this.pool.pop();return t||this.create()},e.prototype.push=function(t){this.pool.indexOf(t)===-1&&this.pool.push(t)},e.prototype.clear=function(){for(var t=0,r=this.pool;t<r.length;t++){var n=r[t];n.dispose()}this.pool.length=0},e}(),defaultPanoramaControllerCustomInitArgs=__assign(__assign({},defaultPanoramaLikeControllerCustomInitArgs),{maxAccessibleDistance:5,panoTapTriggerRadius:.5,panoCircleMeshCreator:function(e){return new PanoCircleMesh},tiledCubeTextureLevel:2,tileLevelForFov:function(e,t){var r,n=function(u){return u/180*Math.PI},o=(r=Math.log2)!==null&&r!==void 0?r:function(u){return Math.log(u)*Math.LOG2E},s=t.height/2/Math.tan(n(e/2))*Math.tan(n(45))*2,l=Math.max(o(s/512),0);return l<2.3&&l>.1&&(l=1),l=l%1>.75?Math.ceil(l):Math.floor(l),l},tileMaxRequest:3,luminanceAdaptiveEffectEnable:!0}),PanoramaController=function(e){__extends(t,e);function t(r){var n=this,o,s,l,u,c=t.parseArgs(r);n=e.call(this,c)||this,n.mode="Panorama",n.tileLevel=0,n.initAnimationed=!1,n.maxAccessibleDistance=c.maxAccessibleDistance,n.panoTapTriggerRadius=c.panoTapTriggerRadius,n.panoCircleMeshCreator=c.panoCircleMeshCreator,n.tiledCubeTextureLevel=c.tiledCubeTextureLevel,n.tileLevelForFov=c.tileLevelForFov,n.tileMaxRequest=c.tileMaxRequest,n.luminanceAdaptiveEffectEnable=c.luminanceAdaptiveEffectEnable,n.luminanceAdaptiveEffect=new LuminanceAdaptiveEffect(n.renderer,n.modelScene,n.camera,n.models),n.colorCubeRenderTargetPool=new CubeRenderTargetPool,n.luminanceCubeRenderTargetPool=new CubeRenderTargetPool;var h=n.models.getMaterial()||{},f=h.pano0,m=h.pano1;f&&(m==null?void 0:m.map)!==f.map&&(n.models.setMaterial({pano0:m}),f.map.dispose(),f.map instanceof TileCubeTextureTarget&&f.map.cubeRenderTarget&&n.colorCubeRenderTargetPool.push(f.map.cubeRenderTarget),f.luminanceMap&&(f.luminanceMap.dispose(),f.luminanceMap instanceof TileCubeTextureTarget&&f.luminanceMap.cubeRenderTarget&&n.luminanceCubeRenderTargetPool.push(f.luminanceMap.cubeRenderTarget)));var y=new Set;f&&y.add(f),m&&y.add(m);for(var A=n.colorCubeRenderTargetPool.size+y.size;A<2;A++){var M=Math.max(1024*n.tiledCubeTextureLevel,512),b=n.colorCubeRenderTargetPool.create();b.setSize(M,M),renderCubeTextureToCubeRenderTarget(null,b,n.renderer),n.colorCubeRenderTargetPool.push(b)}n.panoMeshes={},n.updatePanoMeshes(),n.locationMotion=new Motion({count:0,distance:n.camera.pose.distance}),n.modelAlphaMotion=new Motion({modelAlpha:(s=(o=n.models.getMaterial())===null||o===void 0?void 0:o.modelAlpha)!==null&&s!==void 0?s:0}),n.perspToOrthoMotion=new Motion({perspToOrtho:n.camera.perspToOrtho.x}),n.panoResources={},n.panoResources[n.locationMotion.keyframes[0].key=n.locationMotion.keyframes[1].key=createUuid()]={panoId:panoStringify(n.currentPano),panoPicture:(u=(l=n.models.getMaterial())===null||l===void 0?void 0:l.pano1)!==null&&u!==void 0?u:null,position:n.camera.pose.offset.clone(),effect:"fly",fixCameraTransform:new Matrix4};var T=n.works.getResolvedObserver(n.currentPano);return n.textureLoader=new TextureLoader,n.tiling=new Tiling(T?getFetcher(T.work):internalFetcher,n.tiledCubeTextureLevel+1,n.imageOptions),n.scene.add(n.tiling.object),n.panoVideo=new PanoVideo,n.scene.add(n.panoVideo.object),n}return t.parseArgs=function(r){var n,o,s,l,u,c,h;if(r instanceof t)return r;var f=e.parseArgs.call(this,r);return __assign(__assign({},f),{maxAccessibleDistance:(n=r.maxAccessibleDistance)!==null&&n!==void 0?n:defaultPanoramaControllerCustomInitArgs.maxAccessibleDistance,panoTapTriggerRadius:(o=r.panoTapTriggerRadius)!==null&&o!==void 0?o:defaultPanoramaControllerCustomInitArgs.panoTapTriggerRadius,panoCircleMeshCreator:(s=r.panoCircleMeshCreator)!==null&&s!==void 0?s:defaultPanoramaControllerCustomInitArgs.panoCircleMeshCreator,tiledCubeTextureLevel:(l=r.tiledCubeTextureLevel)!==null&&l!==void 0?l:defaultPanoramaControllerCustomInitArgs.tiledCubeTextureLevel,tileLevelForFov:(u=r.tileLevelForFov)!==null&&u!==void 0?u:defaultPanoramaControllerCustomInitArgs.tileLevelForFov,tileMaxRequest:(c=r.tileMaxRequest)!==null&&c!==void 0?c:defaultPanoramaControllerCustomInitArgs.tileMaxRequest,luminanceAdaptiveEffectEnable:(h=r.luminanceAdaptiveEffectEnable)!==null&&h!==void 0?h:defaultPanoramaControllerCustomInitArgs.luminanceAdaptiveEffectEnable})},t.initAnimationEndState=function(r){var n=this.parseArgs(r),o=e.initAnimationEndState.call(this,n);return __assign(__assign({},o),{mode:"Panorama"})},t.prototype.updateConfiguration=function(r){var n=this,o=e.prototype.updateConfiguration.call(this,r);if(o===!1)return!1;if(r.maxAccessibleDistance!==void 0&&this.maxAccessibleDistance!==r.maxAccessibleDistance&&(this.maxAccessibleDistance=r.maxAccessibleDistance),r.panoTapTriggerRadius!==void 0&&this.panoTapTriggerRadius!==r.panoTapTriggerRadius&&(this.panoTapTriggerRadius=r.panoTapTriggerRadius),r.panoCircleMeshCreator!==void 0&&this.panoCircleMeshCreator!==r.panoCircleMeshCreator&&(this.panoCircleMeshCreator=r.panoCircleMeshCreator,this.panoMeshes)){for(var s=Object.keys(this.panoMeshes),l=0,u=s;l<u.length;l++){var c=u[l],h=this.panoMeshes[c];this.helper.remove(h),h.dispose(),delete this.panoMeshes[c]}this.updatePanoMeshes()}return r.tiledCubeTextureLevel!==void 0&&this.tiledCubeTextureLevel!==r.tiledCubeTextureLevel&&(this.tiledCubeTextureLevel=r.tiledCubeTextureLevel,setTimeout(function(){n.moveToPano(n.currentPano,{},!0)},30)),r.tileLevelForFov!==void 0&&this.tileLevelForFov!==r.tileLevelForFov&&(this.tileLevelForFov=r.tileLevelForFov),r.tileMaxRequest!==void 0&&this.tileMaxRequest!==r.tileMaxRequest&&(this.tileMaxRequest=r.tileMaxRequest),r.luminanceAdaptiveEffectEnable!==void 0&&this.luminanceAdaptiveEffectEnable!==r.luminanceAdaptiveEffectEnable&&(this.luminanceAdaptiveEffectEnable=r.luminanceAdaptiveEffectEnable),!0},t.prototype.destroy=function(){var r,n;if(e.prototype.destroy.call(this),this.scene.remove(this.tiling.object),this.tiling.dispose(),this.locationMotion.dispose(),this.colorCubeRenderTargetPool.clear(),this.luminanceCubeRenderTargetPool.clear(),delete this.pendingTextureTask,this.panoMeshes)for(var o=Object.keys(this.panoMeshes),s=0,l=o;s<l.length;s++){var u=l[s],c=this.panoMeshes[u];this.helper.remove(c),c.dispose(),delete this.panoMeshes[u]}var h=this.videoTexture.image;h.pause(),h.oncanplay=function(){},h.ontimeupdate=function(){},this.scene.remove(this.panoVideo.object),this.panoVideo.setMaterial(null),this.panoVideo.dispose();for(var f=(r=this.models.getMaterial())!==null&&r!==void 0?r:{},m=f.pano0,y=f.pano1,A=0,M=Object.keys(this.panoResources);A<M.length;A++){var b=M[A],T=this.panoResources[b];if(T.panoPicture){var _=T.panoPicture.map;_&&_!==(m==null?void 0:m.map)&&_!==(y==null?void 0:y.map)&&(_.dispose(),(n=T.panoPicture.luminanceMap)===null||n===void 0||n.dispose(),T.panoPicture=null)}delete this.panoResources[b]}this.luminanceAdaptiveEffect.dispose()},t.prototype.isReady=function(){return this.locationMotion.ended!==!0?!1:e.prototype.isReady.call(this)},t.prototype.isTileReady=function(){var r,n,o,s=this.panoResourceFromLocationMotionKeyframe(this.locationMotion.keyframes[this.locationMotion.keyframes.length-1]),l=((r=s.panoPicture)===null||r===void 0?void 0:r.map)instanceof TileCubeTextureTarget&&(o=(n=s.panoPicture)===null||n===void 0?void 0:n.map.tilePending)!==null&&o!==void 0?o:0,u=l<=0,c=this.tiling.pedding,h=this.tiling.object.visible&&c<=0;return this.initAnimationed&&u&&h},t.prototype.updateWork=function(r,n,o,s){var l=this;this.userAction=s,this.works=r;var u=t.initAnimationEndState(__assign(__assign({},this),{initial:{currentState:__assign(__assign({},this.currentPano),this.camera.pose),duration:o.duration,effect:o.effect,state:n,userAction:s}})),c={workCode:u.workCode,panoIndex:u.panoIndex},h=this.works.getWork(c.workCode);return this.tiling.setFetcher(h?getFetcher(h):internalFetcher),this.tiling.cleanup(),this.initAnimationed=!1,this.hideIntersectMesh(),this.updatePanoMeshes(),this.moveToPano(c,{effect:o.effect,duration:o.duration,longitude:n.longitude,latitude:n.latitude,fov:n.fov,moveEndCallback:function(){l.initAnimationed=!0},moveCancelCallback:function(){l.initAnimationed=!0}},s),!0},t.prototype.updateModel=function(r){this.models=r,this.updatePanoMeshes()},t.prototype.updateTime=function(r,n){var o=this,s,l,u,c,h,f,m,y,A,M;if(!this.destroyed){var b={},T={},_=this.panoResourceFromLocationMotionKeyframe(this.locationMotion.keyframes[0]),S=this.panoResourceFromLocationMotionKeyframe(this.locationMotion.keyframes[this.locationMotion.keyframes.length-1]),C=!1;if(this.cameraMotion.ended===!1&&(this.cameraMotion.update(r),T.longitude=this.cameraMotion.value.longitude,T.latitude=this.cameraMotion.value.latitude,T.fov=this.cameraMotion.value.fov),this.modelAlphaMotion.ended===!1&&(this.modelAlphaMotion.update(r),b.modelAlpha=this.modelAlphaMotion.value.modelAlpha),this.perspToOrthoMotion.ended===!1&&(this.perspToOrthoMotion.update(r),this.camera.perspToOrtho.setScalar(clamp$1(this.perspToOrthoMotion.value.perspToOrtho,0,1))),this.locationMotion.ended===!1){this.locationMotion.update(r);var P=this.locationMotion.getKeyFrameSegment(r),F=P[0],O=P[1],N=this.panoResourceFromLocationMotionKeyframe(F),V=this.panoResourceFromLocationMotionKeyframe(O),q=new Vector3().copy(N.position),Q=new Vector3().copy(V.position),z=this.locationMotion.value.count-O.value.count+1;b.progress=z,V.panoPicture&&(z<1?N.panoPicture&&(b.pano0=N.panoPicture):b.pano0=V.panoPicture,b.pano1=V.panoPicture),V.effect==="montage"?b.transition="BLACK":V.effect==="spread"?b.transition="SPREAD":b.transition="FADE",(V.effect==="zoomin"||V.effect==="zoomout")&&(b.progress=Math.pow(z,3)),z<1&&V.effect!=="fly"&&(b.pano0&&N.panoPicture&&(b.pano0={map:b.pano0.map,zoom:b.pano0.zoom,luminanceMap:b.pano0.luminanceMap,matrix:N.panoPicture.matrix.clone().premultiply(N.fixCameraTransform).setPosition(V.position)}),q.copy(Q),C=!0),T.distance=this.locationMotion.value.distance,T.offset=new Vector3(q.x+(Q.x-q.x)*z,q.y+(Q.y-q.y)*z,q.z+(Q.z-q.z)*z);for(var H=[],W=[],J=0,G=this.locationMotion.keyframes;J<G.length;J++){var te=G[J],X=te.key,K=te.progress;X!==void 0&&(H.push(X),K>this.locationMotion.progress&&W.push(X))}for(var Z=0,ee=Object.keys(this.panoResources);Z<ee.length;Z++){var j=ee[Z];if(!(W.indexOf(j)>=0)){var re=this.panoResources[j];if(re.panoPicture){var pe=re.panoPicture.map,ge=re.panoPicture.luminanceMap;if(pe){if(pe===((s=b.pano0)===null||s===void 0?void 0:s.map)||pe===((l=b.pano1)===null||l===void 0?void 0:l.map))continue;pe instanceof TileCubeTextureTarget&&pe.cubeRenderTarget&&this.colorCubeRenderTargetPool.push(pe.cubeRenderTarget),pe.dispose(),ge&&(ge instanceof TileCubeTextureTarget&&ge.cubeRenderTarget&&this.luminanceCubeRenderTargetPool.push(ge.cubeRenderTarget),ge.dispose()),re.panoPicture=null}}H.indexOf(j)>=0||delete this.panoResources[j]}}this.currentPano=panoParse(V.panoId),this.emit("pano.moving",createEvent("pano.moving",{userAction:this.userAction,prevPano:panoParse(_.panoId),state:__assign(__assign(__assign(__assign({},panoParse(S.panoId)),{mode:this.mode}),clonePose(this.camera.pose)),T),options:{},progress:this.locationMotion.progress,error:null}))}isEmptyObject(b)===!1&&(!((u=b.pano0)===null||u===void 0)&&u.map&&b.pano0.map instanceof TileCubeTextureTarget&&!b.pano0.map.cubeRenderTarget&&(b.pano0.map.cubeRenderTarget=this.colorCubeRenderTargetPool.pop()),!((c=b.pano0)===null||c===void 0)&&c.luminanceMap&&b.pano0.luminanceMap instanceof TileCubeTextureTarget&&!b.pano0.luminanceMap.cubeRenderTarget&&(b.pano0.luminanceMap.cubeRenderTarget=this.luminanceCubeRenderTargetPool.pop()),!((h=b.pano1)===null||h===void 0)&&h.map&&b.pano1.map instanceof TileCubeTextureTarget&&!b.pano1.map.cubeRenderTarget&&(b.pano1.map.cubeRenderTarget=this.colorCubeRenderTargetPool.pop()),!((f=b.pano1)===null||f===void 0)&&f.luminanceMap&&b.pano1.luminanceMap instanceof TileCubeTextureTarget&&!b.pano1.luminanceMap.cubeRenderTarget&&(b.pano1.luminanceMap.cubeRenderTarget=this.luminanceCubeRenderTargetPool.pop()),this.models.setMaterial(b)),isEmptyObject(T)===!1&&this.setCamera(T);var _e=this.works.getResolvedObserver(this.currentPano),he=this.locationMotion.ended?this.getForwardObserverOrNot():null;if(this.camera.pose.distance>.1||C)for(var Fe=0,Re=Object.keys(this.panoMeshes);Fe<Re.length;Fe++){var Le=Re[Fe],Se=this.panoMeshes[Le];Se.setOpacity(0),Se.setCurrent(!1),Se.updateTime&&Se.updateTime(r,n),Se.visible=!1}else if(_e){var we=arrayMin(_e.visibleIds,function(Ue){var He=o.works.getResolvedObserver(Ue);return He?_e.standingPosition.distanceTo(He.standingPosition):1/0},!0),Ve=we[1];Ve=clamp$1(Ve,2.5,1/0);for(var je=_e.visibleIds.concat(panoStringify(this.currentPano)),st=this.camera.getDirection(new Vector3),We=0,bt=Object.keys(this.panoMeshes);We<bt.length;We++){var Le=bt[We],Se=this.panoMeshes[Le],oe=this.works.getResolvedObserver(Le);if(je.indexOf(Le)===-1)Se.setCurrent(!1),Se.setOpacity(0);else if(!oe)Se.setCurrent(!1),Se.setOpacity(0);else if(!oe.loadable&&!oe.active)Se.setCurrent(!1),Se.setOpacity(0);else{var ue=Se.position.clone().setY(this.camera.position.y).distanceTo(this.camera.position);Se.setCurrent(!Se.loading&&Se.progress===0&&he!==null&&he.panoId===Le),Se.setOpacity(ue<.01?0:clamp$1(Ve/ue*1.2,.4,.85));var Qe=this.camera.position.clone().setY(Se.position.y),Me=new Vector3().copy(Se.position).sub(Qe).normalize();if(Le===panoStringify(this.currentPano)){var De=clamp$1((.5-Qe.distanceTo(Se.position))/.5,0,1);Me.multiplyScalar(1-De).add(st.clone().multiplyScalar(De))}Me.length()>0&&Se.quaternion.setFromEuler(new Euler(0,Math.atan2(Me.x,Me.z),0))}Se.updateTime&&Se.updateTime(r,n)}}var be=this.tileLevel=function(){if(o.tileLevelForFov===!1)return 0;var Ue=o.renderer.getDrawingBufferSize(new Vector2);Ue.width*=o.scissor.width,Ue.height*=o.scissor.height;var He=S.panoId,qe=o.works.getResolvedObserver(He),ke=o.imageOptions.size;if(typeof ke>"u"&&qe){var ve=qe.images.up.match(/\/cube_(\d+)\//);ve&&(ke=Number(ve[1]))}typeof ke>"u"&&(ke=2048);var Ye=0;ke>=1024&&(Ye=1),ke>=2048&&(Ye=2),ke>=4096&&(Ye=3),ke>=8192&&(Ye=4);var tt=o.tileLevelForFov(o.camera.fov,Ue);return tt>Ye?tt:0}(),ze=function(){var Ue=o.camera.quaternion.clone(),He=o.works.getResolvedObserver(S.panoId),qe=He??_e;qe&&Ue.premultiply(qe.quaternion.clone().inverse());var ke=new Matrix4().makeRotationFromQuaternion(Ue),ve=new Matrix4().getInverse(ke),Ye=new Frustum().setFromProjectionMatrix(new Matrix4().multiplyMatrices(o.camera.projectionMatrix,ve));return Ye}();S.panoId===panoStringify(this.currentPano)&&(((m=S.panoPicture)===null||m===void 0?void 0:m.map)instanceof TileCubeTextureTarget&&(S.panoPicture.map.maxRequest=this.tileMaxRequest,S.panoPicture.map.update(ze,Math.min(be,this.tiledCubeTextureLevel)),S.panoPicture.map.needsRender===!0&&(S.panoPicture.map.needsRender=!1,this.needsRender=!0,this.modelSceneNeedsRender=!0)),((y=S.panoPicture)===null||y===void 0?void 0:y.luminanceMap)instanceof TileCubeTextureTarget&&(S.panoPicture.luminanceMap.maxRequest=this.tileMaxRequest,S.panoPicture.luminanceMap.update(ze,Math.min(be,this.tiledCubeTextureLevel)),S.panoPicture.luminanceMap.needsRender===!0&&(S.panoPicture.luminanceMap.needsRender=!1,this.needsRender=!0,this.modelSceneNeedsRender=!0)));{var at=this.tiling.object.visible;if(this.initAnimationed){var ot=S.panoId,nt=this.works.getResolvedObserver(ot);nt?isSimilarVector3(this.camera.position,nt.position)&&this.locationMotion.ended?(this.tiling.object.visible=!0,this.tiling.panoId!==ot&&this.tiling.cleanup(),this.tiling.panoId=ot,this.tiling.setResource((M=(A=nt.images)===null||A===void 0?void 0:A.tiles)!==null&&M!==void 0?M:[],this.enableIOSEDR&&nt.images.luminance?nt.images.luminance:null),this.tiling.setFetcher(getFetcher(nt.work)),this.tiling.setRotation(nt.quaternion),this.tiling.setPosition(nt.position),this.tiling.maxRequest=this.tileMaxRequest,be>this.tiledCubeTextureLevel?this.tiling.update(ze,be,r):this.tiling.update(ze,0,r)):this.tiling.object.visible=!1:this.tiling.object.visible=!1}else this.tiling.object.visible=!1;at!==this.tiling.object.visible&&(this.tiling.object.needsRender=!0,this.modelSceneNeedsRender=!0)}this.panoVideo.object.position.copy(this.camera.position),this.panoVideo.updateTime(r),this.intersectMesh.scale.setScalar(clamp$1(this.cameraMotion.value.fov/45,0,1))}},t.prototype.render=function(r,n){var o=this.renderer.getRenderTarget(),s=this.works.getResolvedObserver(this.currentPano);s&&s.video&&(this.needsRender=!0,this.modelSceneNeedsRender=!0),this.updateScreenBuffer(n),this.enableFragDepth?(r&&(n==="luminance"?(this.luminanceAdaptiveEffect.enable=this.luminanceAdaptiveEffectEnable,this.luminanceAdaptiveEffect.render(this.screenBuffers)):(this.renderer.setRenderTarget(this.modelRenderTarget),this.renderer.render(this.modelScene,this.camera))),this.depthCopyPass.render(this.modelRenderTarget.depthTexture,o),this.renderer.autoClearDepth=!1,this.renderer.autoClearColor=!0,this.copyPass.render(this.modelRenderTarget,o),this.renderer.setRenderTarget(o),this.renderer.autoClearColor=!1,this.renderer.autoClearDepth=!1,this.renderer.render(this.scene,this.camera),this.renderer.autoClearColor=!0,this.renderer.autoClearDepth=!0):n==="luminance"?(this.luminanceAdaptiveEffect.enable=this.luminanceAdaptiveEffectEnable,this.luminanceAdaptiveEffect.render(this.screenBuffers)):(this.renderer.render(this.modelScene,this.camera),this.renderer.autoClearColor=!1,this.renderer.autoClearDepth=!1,this.renderer.render(this.scene,this.camera),this.renderer.autoClearColor=!0,this.renderer.autoClearDepth=!0)},t.prototype.postProcessing=function(r,n){if(!this.destroyed&&n==="luminance")return this.luminanceAdaptiveEffect||(this.luminanceAdaptiveEffect=new LuminanceAdaptiveEffect(this.renderer,this.scene,this.camera,this.models),this.luminanceAdaptiveEffect.enable=this.luminanceAdaptiveEffectEnable),this.luminanceAdaptiveEffect.render(r)},t.prototype.getTargetState=function(){var r=this.cameraMotion.getKeyFrameSegment(now())[1],n=this.locationMotion.getKeyFrameSegment(now())[1],o=this.panoResourceFromLocationMotionKeyframe(n),s=this.works.getResolvedObserver(o.panoId);return{workCode:s?s.work.workCode:this.currentPano.workCode,panoIndex:s?s.panoIndex:this.currentPano.panoIndex,mode:this.mode,longitude:r.value.longitude,latitude:r.value.latitude,fov:r.value.fov,offset:s?s.position.clone():this.camera.position.clone(),distance:this.locationMotion.value.distance}},t.prototype.moveToPano=function(r,n,o){var s=this,l,u,c,h,f=(l=n.effect)!==null&&l!==void 0?l:"fly";this.userAction=o,this.stopMomentumMovement();var m=this.works.getResolvedObserver(r);if(!m)throw new Error("Invalid PanoId ".concat(JSON.stringify(r)));var y=getImageSizeFromURL(m.images.up),A=this.imageOptions.size;typeof A>"u"&&m&&y&&(A=Number(y)),typeof A>"u"&&(A=2048);var M=this.imageOptions.transform,b=__assign({key:"pano.".concat(m.panoId)},pick(this.imageOptions,["format","size","quality","sharpen","mappings"])),T=m.images,_=(c=(u=m.images.tiles)===null||u===void 0?void 0:u.filter(function(G){return G.size>A}))!==null&&c!==void 0?c:null,S=M,C={key:"pano_luminance.".concat(m.panoId),size:b.size?b.size/2:void 0},P=this.enableIOSEDR&&m.images.luminance?m.images.luminance:null,F=function(){if(!m.images.tiles||!P)return null;var G=getImageSizeFromURL(P.up);return G?_==null?void 0:_.map(function(te){var X=te.size*te.scale/2;return G<X?{level:te.level,size:X,scale:1,back:replaceImageSize(P.back,X),front:replaceImageSize(P.front,X),left:replaceImageSize(P.left,X),right:replaceImageSize(P.right,X),up:replaceImageSize(P.up,X),down:replaceImageSize(P.down,X)}:{level:te.level,size:G,scale:X/G,back:P.back,front:P.front,left:P.left,right:P.right,up:P.up,down:P.down}}):null}(),O="pano:"+jsonHash([T,b,M,this.tiledCubeTextureLevel]);if(this.pendingTextureTask){if(this.pendingTextureTask.hash===O)return;var N=this.pendingTextureTask.panoId;(h=this.panoMeshes[N])===null||h===void 0||h.setProgress(0),this.emit("pano.texture.abort",createEvent("pano.texture.abort",{error:null,progress:0,meta:null,pano:m.pano}))}var V="move-to-pano-"+m.panoId;this.pending.add(V);var q=this.models.getMaterial()||{},Q=q.pano0,z=q.pano1,H;if(Q&&Q.map.name===O&&Q.luminanceMap!==null===this.enableIOSEDR?H=Q:(z==null?void 0:z.map.name)===O&&z.luminanceMap!==null===this.enableIOSEDR&&(H=z),H){var W={panoId:m.panoId,effect:f,panoPicture:{zoom:1,map:H.map,luminanceMap:H.luminanceMap,matrix:new Matrix4().compose(m.position,m.quaternion,PANO_TEXTURE_SCALE$1)},position:m.position.clone(),fixCameraTransform:new Matrix4};AnimationFrameLoop.shared.add(function(){s.pending.delete(V),s.doMoveToPano(m.pano,W,n)},!0,1);return}this.pendingTextureTask={panoId:m.panoId,hash:O,onLoad:function(G,te){var X;if(s.pending.delete(V),s.destroyed)G.body.dispose();else{G.body.name=O;var K={panoId:m.panoId,effect:f,panoPicture:{zoom:1,map:G.body,luminanceMap:(X=te==null?void 0:te.body)!==null&&X!==void 0?X:null,matrix:new Matrix4().compose(m.position,m.quaternion,PANO_TEXTURE_SCALE$1)},position:m.position.clone(),fixCameraTransform:new Matrix4};s.doMoveToPano(m.pano,K,n)}},onError:function(G){s.pending.delete(V);var te=__assign(__assign(__assign({},m.pano),{mode:s.mode}),clonePose(s.camera.pose));s.emit("pano.error",createEvent("pano.error",{error:G,userAction:s.userAction,options:n,prevPano:s.currentPano,progress:0,state:te})),s.emit("pano.cancel",createEvent("pano.cancel",{error:G,userAction:s.userAction,options:n,prevPano:s.currentPano,progress:0,state:te})),s.emit("error",G),n.moveCancelCallback&&n.moveCancelCallback()}};var J=this.panoMeshes[m.panoId];J&&J.tap&&J.tap(),Promise.all([this.tileLevelForFov&&_&&_.length?this.textureLoader.loadTiledCubeTexture(T,_,{tileMaxLevel:this.tiledCubeTextureLevel,imageURL:{transform:M,options:b},minFilter:LinearFilter,magFilter:LinearFilter,generateMipmaps:!1,format:RGBAFormat,viaAjax:!0,fetcher:getFetcher(m.work)},void 0,void 0,function(G){var te,X;s.emit("pano.texture.progress",createEvent("pano.texture.progress",{error:null,progress:G,meta:null,pano:m.pano})),((te=s.pendingTextureTask)===null||te===void 0?void 0:te.hash)===O&&((X=s.panoMeshes[m.panoId])===null||X===void 0||X.setProgress(G))},this.renderer):this.textureLoader.loadCubeTexture(T,{imageURL:{transform:M,options:b},format:RGBAFormat,viaAjax:!0,fetcher:getFetcher(m.work)},void 0,void 0,function(G){var te,X;s.emit("pano.texture.progress",createEvent("pano.texture.progress",{error:null,progress:G,meta:null,pano:m.pano})),((te=s.pendingTextureTask)===null||te===void 0?void 0:te.hash)===O&&((X=s.panoMeshes[m.panoId])===null||X===void 0||X.setProgress(G))},this.renderer),P?this.tileLevelForFov&&F&&F.length?this.textureLoader.loadTiledCubeTexture(P,F,{tileMaxLevel:this.tiledCubeTextureLevel,imageURL:{transform:S,options:C},minFilter:LinearFilter,magFilter:LinearFilter,generateMipmaps:!1,fetcher:getFetcher(m.work)},void 0,void 0,void 0,this.renderer).catch(function(){return null}):this.textureLoader.loadCubeTexture(P,{imageURL:{transform:S,options:C},fetcher:getFetcher(m.work)},void 0,void 0,void 0,this.renderer).catch(function(){return null}):Promise.resolve(null)]).then(function(G){var te,X,K=G[0],Z=G[1];((te=s.pendingTextureTask)===null||te===void 0?void 0:te.hash)===O?(s.pendingTextureTask.onLoad(K,Z),(X=s.panoMeshes[m.panoId])===null||X===void 0||X.setProgress(0),delete s.pendingTextureTask,s.emit("pano.texture.success",createEvent("pano.texture.success",{error:null,progress:1,meta:K.meta,pano:m.pano}))):(K.body.dispose(),Z==null||Z.body.dispose())}).catch(function(G){var te,X;((te=s.pendingTextureTask)===null||te===void 0?void 0:te.hash)===O&&(s.pendingTextureTask.onError(G),(X=s.panoMeshes[m.panoId])===null||X===void 0||X.setProgress(0),delete s.pendingTextureTask,s.emit("pano.texture.error",createEvent("pano.texture.error",{error:G,progress:0,meta:null,pano:m.pano})),s.emit("error",G))}),this.emit("pano.texture.load",createEvent("pano.texture.load",{error:null,progress:0,meta:null,pano:m.pano}))},t.prototype.initAnimation=function(){var r=this;return this.destroyed?Promise.resolve():new Promise(function(n){var o=r.initial,s=o.duration,l=o.effect,u=o.userAction;r.userAction=u;var c=t.initAnimationEndState(r),h={workCode:c.workCode,panoIndex:c.panoIndex},f={modelAlpha:0},m={perspToOrtho:0},y=!1;r.moveToPano(h,{longitude:c.longitude,latitude:c.latitude,fov:c.fov,effect:l,duration:s,moveStartCallback:function(A){y=!0,r.perspToOrthoMotion.set(m,s).catch(noop$1),r.modelAlphaMotion.setKeyframes([{progress:0,value:__assign({},r.modelAlphaMotion.value)},{progress:.6,value:__assign({},r.modelAlphaMotion.value)},{progress:1,value:f}],s).catch(noop$1),r.emit("initAnimation.start",createEvent("initAnimation.start",{state:A,userAction:r.userAction}))},moveEndCallback:function(A){r.emit("initAnimation.end",createEvent("initAnimation.end",{state:A,userAction:r.userAction})),r.initAnimationed=!0,n()},moveCancelCallback:function(){var A=__assign(__assign(__assign({},h),{mode:r.mode}),clonePose(r.camera.pose));y===!1&&r.emit("initAnimation.start",createEvent("initAnimation.start",{state:A,userAction:r.userAction})),r.emit("initAnimation.end",createEvent("initAnimation.end",{state:A,userAction:r.userAction})),r.initAnimationed=!0,n()}},u)})},t.prototype.panoResourceFromLocationMotionKeyframe=function(r){return this.panoResources[r.key]},t.prototype.locationMotionKeyframesLength=function(r){for(var n=0,o=1;o<r.length;o++){var s=this.panoResourceFromLocationMotionKeyframe(r[o-1]).position,l=this.panoResourceFromLocationMotionKeyframe(r[o]).position,u=s.distanceTo(l)*(r[o].value.count-r[o-1].value.count);n+=u}return n},t.prototype.updatePanoMeshes=function(){for(var r=this,n={},o=Object.keys(this.panoMeshes),s=0,l=o;s<l.length;s++){var u=l[s],c=this.panoMeshes[u];n[u]=c,delete this.panoMeshes[u]}for(var h=1,f={},m=function(O){var N=arrayMin(O.accessibleIds,function(q){var Q=r.works.getResolvedObserver(q);if(!Q)return 1/0;var z=Q.standingPosition.distanceTo(O.standingPosition);return clamp$1(z,1,1/0)},!0),V=N[1];f[O.panoId]===void 0&&(f[O.panoId]=V)},y=0,A=this.works.resolvedObservers;y<A.length;y++){var M=A[y];m(M)}var b=Object.keys(f).map(function(O){return f[O]});if(b.length){var T=b.reduce(function(O,N){return O+N},0)/b.length;h=clamp$1(T*.6,1,3)}for(var _=0,S=this.works.resolvedObservers;_<S.length;_++){var M=S[_],c=void 0;n[M.panoId]?(c=n[M.panoId],c.loading===!0&&M.loadable===!1&&c.setLoading(!1),delete n[M.panoId]):(c=this.panoCircleMeshCreator(M.pano),c.name="PanoCircleMesh_"+M.panoId,this.helper.add(c)),c.scale.set(h,1,h),c.position.copy(M.standingPosition),this.panoMeshes[M.panoId]=c}for(var C=0,P=Object.keys(n);C<P.length;C++){var F=P[C];this.helper.remove(n[F]),n[F].dispose(),delete n[F]}},t.prototype.doMoveToPano=function(r,n,o){var s=this,l,u,c,h,f,m,y,A,M,b,T;o===void 0&&(o={});var _=now(),S=createUuid();this.tiling.cleanup(),this.panoResources[S]=n;var C=1,P,F,O;if(this.locationMotion.ended){var N=this.locationMotion.getKeyFrameSegment(_);N[0];var V=N[1],q=this.locationMotion.value,Q=((l=this.panoResourceFromLocationMotionKeyframe(V))!==null&&l!==void 0?l:this.camera).position,z=n.position;P=Math.max(Q.distanceTo(z),C),F=[{key:V.key,progress:0,value:__assign(__assign({},q),{count:0})},{key:S,progress:1,value:{distance:0,count:1}}],O=0}else{var H=this.locationMotion.getKeyFrameSegment(_),W=H[0],V=H[1],q=this.locationMotion.value,J=this.panoResourceFromLocationMotionKeyframe(W).position,Q=this.panoResourceFromLocationMotionKeyframe(V).position,z=n.position,G=V.value.count-q.count,te=Math.max(J.distanceTo(Q),C)*G,X=Math.max(Q.distanceTo(z),C);P=te+X,F=[{key:W.key,progress:0,value:__assign({},q)},{key:V.key,progress:te/P,value:V.value},{key:S,progress:1,value:{count:V.value.count+1,distance:0}}];var K=this.locationMotionKeyframesLength(this.locationMotion.keyframes),Z=this.locationMotionKeyframesLength(F);K===0||K===0?O=0:O=this.locationMotion.getProgressVelocity(_)*K/Z}var ee=n.effect==="instant"?0:this.calculateMovingDuration(o.duration,n.effect==="fly"?P:0),j={longitude:o.longitude,latitude:o.latitude,fov:o.fov},re=__assign(__assign({},r),{mode:this.mode,longitude:(u=j.longitude)!==null&&u!==void 0?u:this.camera.pose.longitude,latitude:(c=j.latitude)!==null&&c!==void 0?c:this.camera.pose.latitude,fov:(h=j.fov)!==null&&h!==void 0?h:this.camera.pose.fov,offset:n.position.clone(),distance:this.camera.pose.distance}),pe=this.currentPano;if(this.emit("pano.moveTo",createEvent("pano.moveTo",{options:o,prevPano:pe,progress:0,state:re,userAction:this.userAction,error:null})),o.moveStartCallback&&o.moveStartCallback(re),this.videoTexture&&this.videoTexture.image instanceof HTMLVideoElement&&this.videoTexture.image.getAttribute("src")&&(this.videoTexture.image.pause(),this.videoTexture.image.removeAttribute("uuid"),this.videoTexture.image.removeAttribute("src"),this.videoTexture.image.oncanplay=noop$1,this.videoTexture.needsUpdate=!0),this.panoVideo.setMaterial(null),n.effect==="fly")this.cameraMotion.set(j,ee).catch(noop$1);else{var ge=coordinatesToVector({longitude:this.cameraMotion.value.longitude,latitude:this.cameraMotion.value.latitude}),_e=coordinatesToVector({longitude:(f=j.longitude)!==null&&f!==void 0?f:this.cameraMotion.value.longitude,latitude:(m=j.latitude)!==null&&m!==void 0?m:this.cameraMotion.value.latitude}),he=new Object3D;he.lookAt(ge);var Fe=new Matrix4().makeRotationFromQuaternion(he.quaternion);he.lookAt(_e);var Re=new Matrix4().makeRotationFromQuaternion(he.quaternion),Le=new Matrix4().getInverse(Fe).premultiply(Re),Se=this.cameraMotion.value.fov,we=(y=j.fov)!==null&&y!==void 0?y:this.cameraMotion.value.fov,Ve=1;n.effect==="zoomin"?Ve=1.5:n.effect==="zoomout"&&(Ve=.4);for(var je=clamp$1(we*Ve,1,170),st=0;st<F.length-1;st++){var We=F[st].key;if(We){var bt=this.panoResources[We];bt&&(bt.fixCameraTransform.copy(Le),bt.panoPicture&&(bt.panoPicture.zoom=Math.tan(Se/2/180*Math.PI)/Math.tan(je/2/180*Math.PI)))}}this.cameraMotion.setKeyframes([{progress:0,value:{longitude:this.cameraMotion.value.longitude,latitude:this.cameraMotion.value.latitude,fov:this.cameraMotion.value.fov}},{progress:0,value:{longitude:(A=j.longitude)!==null&&A!==void 0?A:this.cameraMotion.value.longitude,latitude:(M=j.latitude)!==null&&M!==void 0?M:this.cameraMotion.value.latitude,fov:je}},{progress:1,value:{longitude:(b=j.longitude)!==null&&b!==void 0?b:this.cameraMotion.value.longitude,latitude:(T=j.latitude)!==null&&T!==void 0?T:this.cameraMotion.value.latitude,fov:we}}],ee).catch(noop$1)}var oe=this.locationMotion.setKeyframes(F,ee,O);oe.then(function(){for(var ue,Qe,Me=0,De=s.models;Me<De.length;Me++){var be=De[Me];be.show()}var ze=__assign(__assign({},r),{mode:s.mode,longitude:s.camera.pose.longitude,latitude:s.camera.pose.latitude,fov:s.camera.pose.fov,offset:s.camera.pose.offset.clone(),distance:s.camera.pose.distance});s.emit("pano.arrived",createEvent("pano.arrived",{options:o,prevPano:pe,progress:1,state:ze,userAction:s.userAction,error:null})),o.moveEndCallback&&o.moveEndCallback(ze);var at=s.works.getResolvedObserver(r);if(at&&at.video&&s.videoTexture&&s.videoTexture.image instanceof HTMLVideoElement){var ot=ROTATE_Y_PI_MATRIX$1.clone().multiply((Qe=(ue=s.models.getMaterial().pano1)===null||ue===void 0?void 0:ue.matrix)!==null&&Qe!==void 0?Qe:new Matrix4).multiply(at.video.matrix),nt={map:s.videoTexture,size:at.video.size,matrix:ot,alpha:1},Ue=createUuid(),He=s.videoTexture.image;He.setAttribute("uuid",Ue),canplayVideo().then(function(qe){qe&&at.video&&He.getAttribute("uuid")===Ue&&(He.oncanplay=function(){He.oncanplay=noop$1,He.play()},He.ontimeupdate=function(){He.currentTime>.5&&(He.ontimeupdate=noop$1,s.panoVideo.setMaterial(nt))},He.src=at.video.source)}).catch(function(){He.removeAttribute("uuid")})}},function(){s.emit("pano.cancel",createEvent("pano.cancel",{options:o,prevPano:pe,progress:0,state:re,userAction:s.userAction,error:null})),o.moveCancelCallback&&o.moveCancelCallback()})},t.prototype.getForwardObserverOrNot=function(r){var n=this,o=this.works.getResolvedObserver(this.currentPano);if(!o)return null;var s=r??new Raycaster(this.camera.position.clone(),this.camera.getDirection(new Vector3));s.params.Points={threshold:.1};var l=o.standingPosition.clone();if(o.position.distanceTo(s.ray.origin)>1){var u=this.models.intersectRaycaster(new Raycaster(s.ray.origin,new Vector3(0,-1,0)))[0];u&&u.distance<=2?l.copy(u.point):l.copy(s.ray.origin).add(new Vector3(0,-1.5,0))}var c=this.models.intersectRaycaster(s)[0],h=c?c.point:s.ray.origin.clone().add(s.ray.direction.clone().normalize().multiplyScalar(3)),f=h.clone().sub(l).normalize();if(f.length()===0)return null;for(var m=o.accessibleIds.filter(function(F){if(F===panoStringify(n.currentPano))return!1;var O=n.works.getResolvedObserver(F);if(!O)return!1;var N=O.standingPosition.clone().project(n.camera);return Math.abs(N.z)>1||Math.abs(N.x)>1||Math.abs(N.y)>1?!1:O.loadable||O.active}),y=m.slice().sort(function(F,O){var N=n.works.getResolvedObserver(F).standingPosition.clone().distanceTo(l),V=n.works.getResolvedObserver(O).standingPosition.clone().distanceTo(l);return N-V}),A=0,M=[Math.PI/8,Math.PI/6,Math.PI/4,Math.PI/3];A<M.length;A++)for(var b=M[A],T=0,_=y;T<_.length;T++){var S=_[T],C=this.works.getResolvedObserver(S);if(C){var P=C.standingPosition.clone().sub(l);if(P&&P.length()!==0&&f.angleTo(P)<b)return C}}return null},t.prototype.onTapGesture=function(r){var n=this,o;if(this.userAction=r.userAction,this.stopMomentumMovement(),!!this.initAnimationed){if(!this.locationMotion.ended){var s=this.panoResourceFromLocationMotionKeyframe(this.locationMotion.keyframes[this.locationMotion.keyframes.length-1]);if(s.panoId!==panoStringify(this.currentPano))return}var l=r.center.raycaster,u=this.camera.getDirection(new Vector3).setY(0),c=null,h=this.works.getResolvedObserver(this.currentPano);if(h){var f=h.accessibleIds.filter(function(Z){if(Z===panoStringify(n.currentPano))return!1;var ee=n.works.getResolvedObserver(Z);return!ee||ee.position.distanceTo(n.camera.position)>n.maxAccessibleDistance?!1:ee.loadable||ee.active}),m=this.models.intersectRaycaster(l)[0];if(m){var y=arrayMin(f,function(Z){var ee=n.works.getResolvedObserver(Z);if(!ee)return 1/0;var j=ee.standingPosition.clone();return j.distanceTo(m.point)},!0),A=y[0],M=y[1];A&&M<this.panoTapTriggerRadius&&(c=(o=this.works.getResolvedObserver(A))!==null&&o!==void 0?o:null)}c||(c=this.getForwardObserverOrNot(l));for(var b=0,T=this.locationMotion.keyframes;b<T.length;b++){var _=T[b],S=this.panoResourceFromLocationMotionKeyframe(_);if(!(_.progress<this.locationMotion.progress)&&c&&S.panoId===c.panoId){c=null;break}}if(!c)this.emit("gesture.tap",r),r.defaultPrevented||this.locationMotion.ended===!0&&this.cameraBounce();else{for(var C={},P=Math.PI/6,F=Math.PI/12,O=c.position.clone().setY(0).sub(h.position.clone().setY(0)).normalize(),N=[],V=[],q=[],Q=0,z=c.accessibleIds;Q<z.length;Q++){var A=z[Q],H=panoParse(A);if(!(panoEqual(H,this.currentPano)||panoEqual(H,c.pano))){var W=this.works.getResolvedObserver(A);if(W){var J=W.position.clone().sub(c.position).setY(0);O.angleTo(J)<P&&q.push(J)}}}var G=q.length>0?q:__spreadArray(__spreadArray([],N,!0),V,!0),te=G.slice().sort(function(Z,ee){return Z.angleTo(O)-ee.angleTo(O)})[0];te&&te.angleTo(u)>F&&(C.longitude=Math.atan2(-te.x,-te.z)),this.cameraMotion.value.latitude<-Math.PI/4&&(C.latitude=clamp$1(0,this.minLatitude,this.maxLatitude));var X=__assign({},r.state);if(X.workCode=c.pano.workCode,X.panoIndex=c.pano.panoIndex,C.longitude!==void 0&&(X.longitude=C.longitude),C.latitude!==void 0&&(X.latitude=C.latitude),C.fov!==void 0&&(X.fov=C.fov),X.distance=0,X.offset=c.position.clone(),r.state=X,this.emit("gesture.tap",r),!r.defaultPrevented){if(this.emit("pano.select",createEvent("pano.select",{prevPano:this.currentPano,state:X,userAction:r.userAction,options:C,progress:0,error:null})),c&&!c.active){var K=c.panoId;this.panoMeshes[K]&&(this.panoMeshes[K].setDisabled(!1),this.panoMeshes[K].setLoading(!0))}c&&c.active&&this.emit("pano.request",createEvent("pano.request",{userAction:r.userAction,prevPano:this.currentPano,progress:0,state:X,options:C,error:null}))}}}}},t}(PanoramaLikeController),DEG_TO_RAD=Math.PI/180,RAD_TO_DEG=180/Math.PI,MIN_TIMESTEP=.001,MAX_TIMESTEP=1,isIOS=function(){var e=typeof navigator<"u"&&/iPad|iPhone|iPod/.test(navigator.platform);return function(){return e}}(),isSafari=function(){var e=typeof navigator<"u"&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return e}}(),isFirefoxAndroid=function(){var e=typeof navigator<"u"&&navigator.userAgent.indexOf("Firefox")!==-1&&navigator.userAgent.indexOf("Android")!==-1;return function(){return e}}(),getChromeVersion=function(){var e=typeof navigator<"u"?navigator.userAgent.match(/.*Chrome\/([0-9]+)/):null,t=e?parseInt(e[1],10):null;return function(){return t}}(),isChromeWithoutDeviceMotion=function(){var e=!1;if(getChromeVersion()===65){var t=typeof navigator<"u"?navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/):null;if(t){var r=t[1].split(".");r[0],r[1];var n=r[2],o=r[3];e=parseInt(n,10)===3325&&parseInt(o,10)<148}}return function(){return e}}(),isSafariWithoutDeviceMotion=function(){var e=isIOS()&&isSafari()&&typeof navigator<"u"&&navigator.userAgent.indexOf("13_4")!==-1;return function(){return e}}(),isR7=function(){var e=typeof navigator<"u"&&navigator.userAgent.indexOf("R7 Build")!==-1;return function(){return e}}();function isLandscapeMode(){var e=typeof window<"u"&&(window.orientation==90||window.orientation==-90);return isR7()?!e:e}function isTimestampDeltaValid(e){return!(isNaN(e)||e<=MIN_TIMESTEP||e>MAX_TIMESTEP)}function getQuaternionAngle(e){if(e.w>1)return 0;var t=2*Math.acos(e.w);return t}var warnOnce=function(){var e={};return function(t,r){e[t]===void 0&&(console.warn("cardboard: "+r),e[t]=!0)}}();function getOriginFromUrl(e){var t,r=e.indexOf("://");r!==-1?t=r+3:t=0;var n=e.indexOf("/",t);return n===-1&&(n=e.length),e.substring(0,n)}function isInsideCrossOriginIFrame(){if(typeof window>"u"||typeof document>"u")return!1;var e=window.self!==window.top,t=getOriginFromUrl(document.referrer),r=getOriginFromUrl(window.location.href);return e&&t!==r}var updateEyeViewMatrices=function(){function e(n,o,s){var l=o?o[0]:0,u=o?o[1]:0,c=o?o[2]:0,h=o?o[3]:1,f=l+l,m=u+u,y=c+c,A=l*f,M=l*m,b=l*y,T=u*m,_=u*y,S=c*y,C=h*f,P=h*m,F=h*y;return n[0]=1-(T+S),n[1]=M+F,n[2]=b-P,n[3]=0,n[4]=M-F,n[5]=1-(A+S),n[6]=_+C,n[7]=0,n[8]=b+P,n[9]=_-C,n[10]=1-(A+T),n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function t(n,o,s){var l=s[0],u=s[1],c=s[2],h,f,m,y,A,M,b,T,_,S,C,P;return o===n?(n[12]=o[0]*l+o[4]*u+o[8]*c+o[12],n[13]=o[1]*l+o[5]*u+o[9]*c+o[13],n[14]=o[2]*l+o[6]*u+o[10]*c+o[14],n[15]=o[3]*l+o[7]*u+o[11]*c+o[15]):(h=o[0],f=o[1],m=o[2],y=o[3],A=o[4],M=o[5],b=o[6],T=o[7],_=o[8],S=o[9],C=o[10],P=o[11],n[0]=h,n[1]=f,n[2]=m,n[3]=y,n[4]=A,n[5]=M,n[6]=b,n[7]=T,n[8]=_,n[9]=S,n[10]=C,n[11]=P,n[12]=h*l+A*u+_*c+o[12],n[13]=f*l+M*u+S*c+o[13],n[14]=m*l+b*u+C*c+o[14],n[15]=y*l+T*u+P*c+o[15]),n}function r(n,o){var s=o[0],l=o[1],u=o[2],c=o[3],h=o[4],f=o[5],m=o[6],y=o[7],A=o[8],M=o[9],b=o[10],T=o[11],_=o[12],S=o[13],C=o[14],P=o[15],F=s*f-l*h,O=s*m-u*h,N=s*y-c*h,V=l*m-u*f,q=l*y-c*f,Q=u*y-c*m,z=A*S-M*_,H=A*C-b*_,W=A*P-T*_,J=M*C-b*S,G=M*P-T*S,te=b*P-T*C,X=F*te-O*G+N*J+V*W-q*H+Q*z;return X?(X=1/X,n[0]=(f*te-m*G+y*J)*X,n[1]=(u*G-l*te-c*J)*X,n[2]=(S*Q-C*q+P*V)*X,n[3]=(b*q-M*Q-T*V)*X,n[4]=(m*W-h*te-y*H)*X,n[5]=(s*te-u*W+c*H)*X,n[6]=(C*N-_*Q-P*O)*X,n[7]=(A*Q-b*N+T*O)*X,n[8]=(h*G-f*W+y*z)*X,n[9]=(l*W-s*G-c*z)*X,n[10]=(_*q-S*N+P*F)*X,n[11]=(M*N-A*q-T*F)*X,n[12]=(f*H-h*J-m*z)*X,n[13]=(s*J-l*H+u*z)*X,n[14]=(S*O-_*V-C*F)*X,n[15]=(A*V-M*O+b*F)*X,n):null}return function(n,o,s){e(n,o),s&&t(n,n,s),r(n,n)}}(),SensorSample=function(){function e(t,r){t===void 0&&(t=new Vector3),r===void 0&&(r=0),this.sample=t,this.timestampS=r}return e.prototype.set=function(t,r){this.sample=t,this.timestampS=r},e.prototype.copy=function(t){this.set(t.sample,t.timestampS)},e}(),ComplementaryFilter=function(){function e(t,r){this.kFilter=t,this.isDebug=r,this.currentAccelMeasurement=new SensorSample,this.currentGyroMeasurement=new SensorSample,this.previousGyroMeasurement=new SensorSample,isIOS()?this.filterQ=new Quaternion(-1,0,0,1):this.filterQ=new Quaternion(1,0,0,1),this.previousFilterQ=new Quaternion,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Quaternion,this.isOrientationInitialized=!1,this.estimatedGravity=new Vector3,this.measuredGravity=new Vector3,this.gyroIntegralQ=new Quaternion}return e.prototype.addAccelMeasurement=function(t,r){this.currentAccelMeasurement.set(t,r)},e.prototype.addGyroMeasurement=function(t,r){this.currentGyroMeasurement.set(t,r);var n=r-this.previousGyroMeasurement.timestampS;isTimestampDeltaValid(n)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},e.prototype.getOrientation=function(){return this.filterQ},e.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var t=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,r=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,t);this.gyroIntegralQ.multiply(r),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(r);var n=new Quaternion;n.copy(this.filterQ),n.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(n),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var o=new Quaternion;o.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),o.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",RAD_TO_DEG*getQuaternionAngle(o),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var s=new Quaternion;s.copy(this.filterQ),s.multiply(o),this.filterQ.slerp(s,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},e.prototype.accelToQuaternion_=function(t){var r=new Vector3;r.copy(t),r.normalize();var n=new Quaternion;return n.setFromUnitVectors(new Vector3(0,0,-1),r),n.inverse(),n},e.prototype.gyroToQuaternionDelta_=function(t,r){var n=new Quaternion,o=new Vector3;return o.copy(t),o.normalize(),n.setFromAxisAngle(o,t.length()*r),n},e}(),PosePredictor=function(){function e(t,r){this.predictionTimeS=t,this.isDebug=r,this.previousQ=new Quaternion,this.previousTimestampS=null,this.deltaQ=new Quaternion,this.outQ=new Quaternion}return e.prototype.getPrediction=function(t,r,n){if(!this.previousTimestampS)return this.previousQ.copy(t),this.previousTimestampS=n,t;var o=new Vector3;o.copy(r),o.normalize();var s=r.length();if(s<DEG_TO_RAD*20)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(RAD_TO_DEG*s).toFixed(1)),this.outQ.copy(t),this.previousQ.copy(t),this.outQ;var l=s*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(o,l),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(t),this.previousTimestampS=n,this.outQ},e}(),Distortion=function(){function e(t){this.coefficients=t}return e.prototype.distortInverse=function(t){for(var r=0,n=1,o=t-this.distort(r);Math.abs(n-r)>1e-4;){var s=t-this.distort(n),l=n-s*((n-r)/(s-o));r=n,n=l,o=s}return n},e.prototype.distort=function(t){for(var r=t*t,n=0,o=0;o<this.coefficients.length;o++)n=r*(n+this.coefficients[o]);return(n+1)*t},e}(),Pose=function(){function e(){this.angularAcceleration=null,this.angularVelocity=null,this.linearAcceleration=null,this.linearVelocity=null,this.orientation=null,this.position=null}return e}(),FieldOfView=function(){function e(){this.leftDegrees=0,this.rightDegrees=0,this.upDegrees=0,this.downDegrees=0}return e}(),Sensor=function(){function e(t,r,n,o){this.viewer={id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]},this.device={widthMeters:.11,heightMeters:.062,bevelMeters:.004},this.depthNear=.01,this.depthFar=1e4,this.yawOnly=n,this.accelerometer=new Vector3,this.gyroscope=new Vector3,this.filter=new ComplementaryFilter(t,o),this.posePredictor=new PosePredictor(r,o),this.isFirefoxAndroid=isFirefoxAndroid(),this.isIOS=isIOS();var s=getChromeVersion();this.isDeviceMotionInRadians=!this.isIOS&&s!==null&&s<66,this.isWithoutDeviceMotion=isChromeWithoutDeviceMotion()||isSafariWithoutDeviceMotion(),this.filterToWorldQ=new Quaternion,isIOS()?this.filterToWorldQ.setFromAxisAngle(new Vector3(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new Vector3(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Quaternion,this.worldToScreenQ=new Quaternion,this.originalPoseAdjustQ=new Quaternion;var l=typeof window<"u"?-window.orientation*Math.PI/180:0;this.originalPoseAdjustQ.setFromAxisAngle(new Vector3(0,0,1),l),this.setScreenTransform_(),isLandscapeMode()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Quaternion,this.orientationOut_=new Float32Array(4),this.previousTimestampS=Date.now()}return e.prototype.getPosition=function(){return null},e.prototype.getOrientation=function(){var t;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var s=new Quaternion().setFromAxisAngle(new Vector3(0,0,-1),0),l=new Quaternion;return typeof window<"u"&&window.orientation===-90?l.setFromAxisAngle(new Vector3(0,1,0),Math.PI/-2):l.setFromAxisAngle(new Vector3(0,1,0),Math.PI/2),s.multiply(l)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var s=new Quaternion;return s.setFromAxisAngle(new Vector3(1,0,0),-Math.PI/2),s}(),t=this._deviceOrientationQ;var r=new Quaternion;return r.copy(t),r.multiply(this.deviceOrientationFilterToWorldQ),r.multiply(this.resetQ),r.multiply(this.worldToScreenQ),r.multiplyQuaternions(this.deviceOrientationFixQ,r),this.yawOnly&&(r.x=0,r.z=0,r.normalize()),this.orientationOut_[0]=r.x,this.orientationOut_[1]=r.y,this.orientationOut_[2]=r.z,this.orientationOut_[3]=r.w,this.orientationOut_}else{var n=this.filter.getOrientation();t=this.posePredictor.getPrediction(n,this.gyroscope,this.previousTimestampS)}var o=new Quaternion;return o.copy(this.filterToWorldQ),o.multiply(this.resetQ),o.multiply(t),o.multiply(this.worldToScreenQ),this.yawOnly&&(o.x=0,o.z=0,o.normalize()),this.orientationOut_[0]=o.x,this.orientationOut_[1]=o.y,this.orientationOut_[2]=o.z,this.orientationOut_[3]=o.w,this.orientationOut_},e.prototype.getPose=function(){var t=new Pose;return t.orientation=this.getOrientation(),t},e.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),isLandscapeMode()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},e.prototype.getFrameData=function(t){var r=this.getOrientation(),n=this.getEyeOffset(),o=this.getEyeProjectionMatrix();return t.pose.angularAcceleration=null,t.pose.angularVelocity=null,t.pose.linearAcceleration=null,t.pose.linearVelocity=null,t.pose.orientation=r,t.pose.position=null,t.timestamp=this.previousTimestampS,t.leftProjectionMatrix.set(o.left),t.rightProjectionMatrix.set(o.right),updateEyeViewMatrices(t.leftViewMatrix,r,n.left),updateEyeViewMatrices(t.rightViewMatrix,r,n.right),t},e.prototype.start=function(){if(typeof window>"u")return function(){};var t=this.onDeviceMotion_.bind(this),r=this.onOrientationChange_.bind(this),n=this.onMessage_.bind(this),o=this.onDeviceOrientation_.bind(this);return isIOS()&&isInsideCrossOriginIFrame()&&window.addEventListener("message",n),window.addEventListener("orientationchange",r),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",o):window.addEventListener("devicemotion",t),function(){window.removeEventListener("devicemotion",t),window.removeEventListener("deviceorientation",r),window.removeEventListener("orientationchange",r),window.removeEventListener("message",n)}},e.prototype.getEyeOffset=function(){return{left:[-this.viewer.interLensDistance*.5,0,0],right:[this.viewer.interLensDistance*.5,0,0]}},e.prototype.getEyeProjectionMatrix=function(){var t=this.getEyeFieldOfView(),r=this.depthNear,n=this.depthFar,o={left:[],right:[]};{var s=t.left.upDegrees*DEG_TO_RAD,l=t.left.downDegrees*DEG_TO_RAD,u=t.left.leftDegrees*DEG_TO_RAD,c=t.left.rightDegrees*DEG_TO_RAD,h=2/(u+c),f=2/(s+l);o.left[0]=h,o.left[1]=0,o.left[2]=0,o.left[3]=0,o.left[4]=0,o.left[5]=f,o.left[6]=0,o.left[7]=0,o.left[8]=-((u-c)*h*.5),o.left[9]=(s-l)*f*.5,o.left[10]=n/(r-n),o.left[11]=-1,o.left[12]=0,o.left[13]=0,o.left[14]=n*r/(r-n),o.left[15]=0}{var s=t.right.upDegrees*DEG_TO_RAD,l=t.right.downDegrees*DEG_TO_RAD,u=t.right.leftDegrees*DEG_TO_RAD,c=t.right.rightDegrees*DEG_TO_RAD,h=2/(u+c),f=2/(s+l);o.right[0]=h,o.right[1]=0,o.right[2]=0,o.right[3]=0,o.right[4]=0,o.right[5]=f,o.right[6]=0,o.right[7]=0,o.right[8]=-((u-c)*h*.5),o.right[9]=(s-l)*f*.5,o.right[10]=n/(r-n),o.right[11]=-1,o.right[12]=0,o.right[13]=0,o.right[14]=n*r/(r-n),o.right[15]=0}return o},e.prototype.getEyeFieldOfView=function(){var t=this.viewer,r=this.device,n=new Distortion(t.distortionCoefficients),o=t.screenLensDistance,s=(r.widthMeters-t.interLensDistance)/2,l=t.interLensDistance/2,u=t.baselineLensDistance-r.bevelMeters,c=r.heightMeters-u,h=RAD_TO_DEG*Math.atan(n.distort(s/o)),f=RAD_TO_DEG*Math.atan(n.distort(l/o)),m=RAD_TO_DEG*Math.atan(n.distort(u/o)),y=RAD_TO_DEG*Math.atan(n.distort(c/o)),A=new FieldOfView,M=new FieldOfView;return A.leftDegrees=Math.min(h,t.fov),A.rightDegrees=Math.min(f,t.fov),A.downDegrees=Math.min(m,t.fov),A.upDegrees=Math.min(y,t.fov),M.leftDegrees=A.rightDegrees,M.rightDegrees=A.leftDegrees,M.upDegrees=A.upDegrees,M.downDegrees=A.downDegrees,{left:A,right:M}},e.prototype.onDeviceOrientation_=function(t){this._deviceOrientationQ=this._deviceOrientationQ||new Quaternion;var r=t.alpha,n=t.beta,o=t.gamma;r=(r||0)*Math.PI/180,n=(n||0)*Math.PI/180,o=(o||0)*Math.PI/180,this._deviceOrientationQ.setFromEuler(new Euler(r,n,-o,"YXZ"))},e.prototype.onDeviceMotion_=function(t){this.updateDeviceMotion_(t)},e.prototype.updateDeviceMotion_=function(t){var r=t.accelerationIncludingGravity,n=t.rotationRate,o=t.timeStamp/1e3,s=o-this.previousTimestampS;if(s<0){warnOnce("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=o;return}else if(s<=MIN_TIMESTEP||s>MAX_TIMESTEP){warnOnce("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=o;return}r&&(this.accelerometer.set(-r.x,-r.y,-r.z),n&&(isR7()?this.gyroscope.set(-n.beta,n.alpha,n.gamma):this.gyroscope.set(n.alpha,n.beta,n.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,o)),this.filter.addAccelMeasurement(this.accelerometer,o)),this.previousTimestampS=o},e.prototype.onOrientationChange_=function(){this.setScreenTransform_()},e.prototype.onMessage_=function(t){var r=t.data;if(!(!r||!r.type)){var n=r.type.toLowerCase();n==="devicemotion"&&this.updateDeviceMotion_(r.deviceMotionEvent)}},e.prototype.setScreenTransform_=function(){this.worldToScreenQ.set(0,0,0,1);var t=typeof window<"u"?window.orientation:0;switch(t){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new Vector3(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new Vector3(0,0,1),Math.PI/2);break}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},e}(),defaultLeftBounds=[0,0,.5,1],defaultRightBounds=[.5,0,.5,1],Cardboard=function(){function e(t){var r=this;this.renderer=t,this.sensor=new Sensor(.98,.04,!1,!1),this.scale=1,this.cameraL=new PerspectiveCamera,this.cameraR=new PerspectiveCamera;var n=this.sensor.start();this.dispose=function(){var o=r.renderer.getSize(new Vector2);r.renderer.setScissor(0,0,o.width,o.height),r.renderer.setViewport(0,0,o.width,o.height),r.renderer.setScissorTest(!1),n()}}return e.prototype.render=function(t,r){var n=this.renderer.getSize(new Vector2);if(n.width>n.height){var o=t.autoUpdate;o&&(t.updateMatrixWorld(),t.autoUpdate=!1);var s={x:Math.round(n.width*defaultLeftBounds[0]),y:Math.round(n.height*defaultLeftBounds[1]),width:Math.round(n.width*defaultLeftBounds[2]),height:Math.round(n.height*defaultLeftBounds[3])},l={x:Math.round(n.width*defaultRightBounds[0]),y:Math.round(n.height*defaultRightBounds[1]),width:Math.round(n.width*defaultRightBounds[2]),height:Math.round(n.height*defaultRightBounds[3])};this.renderer.setScissorTest(!0),this.renderer.autoClear&&this.renderer.clear(),r.parent===null&&r.updateMatrixWorld(),r.matrixWorld.decompose(this.cameraL.position,this.cameraL.quaternion,this.cameraL.scale),r.matrixWorld.decompose(this.cameraR.position,this.cameraR.quaternion,this.cameraR.scale);var u=this.sensor.getEyeOffset();this.cameraL.translateOnAxis(new Vector3().fromArray(u.left),this.scale),this.cameraR.translateOnAxis(new Vector3().fromArray(u.right),this.scale);var c=this.sensor.getEyeProjectionMatrix();this.cameraL.projectionMatrix.elements=c.left.slice(),this.cameraR.projectionMatrix.elements=c.right.slice(),this.renderer.setViewport(s.x,s.y,s.width,s.height),this.renderer.setScissor(s.x,s.y,s.width,s.height),this.renderer.render(t,this.cameraL),this.renderer.setViewport(l.x,l.y,l.width,l.height),this.renderer.setScissor(l.x,l.y,l.width,l.height),this.renderer.render(t,this.cameraR),this.renderer.setViewport(0,0,n.width,n.height),this.renderer.setScissor(0,0,n.width,n.height),this.renderer.setScissorTest(!1),o&&(t.autoUpdate=!0)}else this.renderer.render(t,r)},e.prototype.dispose=function(){},e}();const cardboard="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAADqCAMAAAAvZYhaAAAC/VBMVEUAAAD///99fX37+/v5+fn29vbx8fHv7+/Nzc3o6Ojq6urh4eHU1NTR0dGDg4Pl5eWSkpLHx8fj4+Pe3t7X19fAwMDZ2dnCwsKrq6uioqLb29uNjY2enp67u7t5eXmAgIC2traWlpa5ubnKysqmpqZycnKHh4eurq6ysrKKioqDg4Pd3d12dnb9/f1vb2/s7OxlZWXz8/OoqKiZmZlpaWmbm5teXl7W1tbJycnExMRiYmJsbGywsLCPj49aWlq9vb1UVFRYWFhra2t+fn7t7e1RUVFOTk6Dg4OAgICCgoKKioqEhISIiIhqamqCgoKIiIiQkJCIiIiWlpawsLBmZmaAgICenp6Li4uBgYGTk5OMjIyVlZWFhYWCgoKvr6+Ojo59fX2SkpKvr6+Ojo6QkJCurq6BgYGxsbF8fHx4eHitra2enp6srKyJiYmurq54eHj5+fl+fn57e3v////5+fnS0tLAwMCVlZWwsLCurq5QUFCtra2EhISUlJSwsLCUlJSUlJSlpaWVlZW3t7diYmLAwMCFhYV3d3f///+tra3///9XV1eampqnp6d8fHz///////9VVVVlZWVtbW3+/v5SUlKcnJytra28vLzGxsbR0dHX19doaGiWlpafn5/Hx8ezs7Nzc3Nubm7AwMCIiIjj4+NTU1P29vZbW1vl5eVkZGTMzMxYWFjq6upfX1/k5OT////4+PjV1dWkpKRoaGj4+Pizs7Pm5ubAwMCfn5+vr6+urq4wMDCxsbG2tra5ubliYmIuLi6zs7NHR0empqY0NDRCQkKqqqo5OTmoqKg7OztfX19dXV1oaGikpKRkZGStra0hISE/Pz89PT0pKSlmZmZJSUlERERbW1s2NjZVVVUmJia7u7uEhIRXV1dZWVlLS0tOTk6srKxqamojIyNTU1MrKyuAgICCgoJRUVFra2ttbW13d3dxcXFvb299fX1zc3N2dnZ5eXl8fHyHh4eSkpKenp6Ojo6VlZWMjIyYmJihoaGcnJyJiYmamprZ2YdEAAAAunRSTlMAs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7P9s7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Oz+QSzswb9DiH3FyI57Jn1ajgu7uHYmIgr8OHHwqVOQybv6OZuUvTt3dHPrIeFSNVgLCAWD9/UqKebiH1iXVTczcvKvambhnBuY/vGrKqjlHlzVDj37s/Fw7+tpJGAeN7VzcWTgGJNQ8O9u7iko5aVjvbNsa+so1pd3mNGAAAqAElEQVR42uzZzWvTYBwH8DxNmvRlfVNr17Wl05a9dISyiugO4qVQ2g1pVyx2Q7QKCoIivgxF1HnTXbbDDnNDJ8iQHcQX8O3We1t6GnjJyYPSuTmdf4C/ZE260U5rl6bJ2g8Pu2zP5cvz++ZJhilOcOxcfPHq/NuFhVcftK8WXizeCGItFWKKX5x/23Zk3/6OPr1+j0mr1fkpkuxXv5luBbbZWPzevEWjMRja2iCrvXs3stJRFGRFEDhOT1xv5QWCkYvPPtosFg+XFZyrvSYdRUJEBA4Igg2LRuBhk+cVOndv3uWyWm0DlqMajWafXkcSNNrexA2sSQ1dvPK+86DruNUGWRn6dGoa/dvk9BjWbMLxZ7e7e3ogK5fVZtBTOKrew6Y6Xufu3Qm0d3f3dEJWGj1Fo/81dbU52isUf2T3etvZrHoG9vtxVKOJm9guF049ddrt3gBkdVCzh0DlWtO4YejT00OHnU44VwHXPgqJ4PV1bFeKDD8xH4Cs7PaAtY9AYpncfeUFSR0zc1l5B/Q4EhW9q+KCpHodXFYBjxZxWnFtk9SZrl4uK6/Hj+pmWvlxDQ2fMRq7eh0OSIpCW7Ti2iJ8/4zK7WazcloqJtUaxqLweFSl4rI6ZNOhylpxsUKpqFsF3EazS4ukNLmIKcuJpFHF6erUI8lNKeiaGrl7WcUxtu+nUUO8VsZLEDz8VBy33YCjxnko+1dsrtI5hz1q1GATcm76YCrpVnHMVgrJgWwfjCN3u1Sc3k4TkgtZNv3QcLHS3Wyly4ncqis8/qSYlFNDINl5IZ9ZDKaifFHZSCRLkzKZxZEkX1QHtUi+ZDCLQlEZ2/uQzDX2c0T4vjzuntWaatiVPiQU1YEBoahoRMNCNRBzv9zuqCNJo1BUdGU4jcOiqyDhfgmLvryoOnClkfRwhcehqDh2A4ErkGTNBa9+paLClUqSK2rkrnCjMhFK9mYMqy+4Jwhf8wjlIWcvjcYGGYbxxUZvmd6V93w9XmicHpJQmD0zifM+ZovYzFWsjMifiB0urVpRyMeJmI+pyBnCxBcaF8avQ60kL58nYkyJ78f3leUvXwqrP9e/MqzBCCaykWRp/NTKQT0fHfzN8L79WlteSm9S+MUdt2t16XR4+vVXTd2vhtVfRrL9cw9ijGB9rZDOgPRm+XxunQGnRD9Ubm8bqRgvZ0Z9woFaX81lNqQzW7MCKwy4IE5T8YfKbNWRSmG6FCtN3upSNpspKosKLBXY6jorxuPPyF+pSKWYezDIFP1YyWXYpLJlSeWFqNi0fFD7O235VFTFOWbVUjUiKRIWBaTZP5vgk/r2vZDOgkylAczD4tMCy5DW6R2V+vBlvqkohZhN8DX1dY09UkJW5b0uJMXJ/dzRIEaKpe5wmShlmEv4hOHLf84WlU8gEKLi5Zagtk5itTkR5f/trvNvj/JTsKr4Xf3366GnhKSy2WJWmZJKpypfDCoHVmHriZpu6hvzZ+zu0HH8kBj8+KvKfyfN/j/UnclvG1UcxxGnhGxKaVIIioBEosi9gVAaCSkHkFhFgAOrBEIgDixCnOAAAgmVG1cEZ7jxHzi2YzvYcWyP3cRNY6e1J2sdJ7bjbLXTLOL73rzFz88TGqip+cyLZ+kMJB++v988jwN0fSJMFb1JIFxxXXq3kq4wCIjWw/+gVT3G6+++/wOtP7wmMuUVooASqtmNQim/6djd36tUyuX9o930WnZrXagCJdwQnz3lc+JvrVb16MXW+/4P/PaRg3X0AstUUm1WRil7VIn5xzkeD74EU4fl3c0CVC0bG/iLvHi6rs7vf60ncR9E4kXbVvcbf724+a2VZpMUdCuhysgfHS5xR1KVR+dyZQdvrNdOdT9851X+IWnr/wDR0h15I2kmuSwK8eQetwG+dGP+4200rW9Oq+r8/a3NT9cPH/K3x+tRSJKx8haObvqvXx8fx8CLrokOLBp/7q69daq5An5BtrWL0trVitHFkcea4M9/FY2qGBGhQreKFNI3x68TdFXSGIaO3+P3e6a+vK1Uvc+ev7R1NT1i7pktxU3AVEU2HIee64JxDCy1lrgqrBVV3Ne7r/ztZMFq6w+NtHWdUeg604Vhu62f2/Dr277m8wQ0KqkqvnkMUSo2uWKFWKvKTxaMy1+c7Oq7Tuu9ctuZZucX/mnD5kbUpCSBkT6AG00VXNkJ0/BzYeCxk2L1Ki3AnjNtZzDaFGqPnXROw6//46vnHWmHNaMyhari/iS86EAThgYNVd0ZBM0V5U37mdXnZF51/kJbc9Mr5wmzTJSZjG7tuXVTateyK0U9WXR1oq0PHiaz9fa25kY0qp31ZIaHKn8LEYEOLDpSVI0w2dv5SvoS/F5/wkBcPYH/Is791WC3DcNuXz+3oddXzxMyXFUBmQJWZ1Kxb1oeeVPUVPF82dt6Ea4e7r+/iRnCPIG6Wit5M1zV+v6YNMDE6NiUIPmqh99aGPrs9OXH4GoY39KF+y9o4KB+XD8HNOz6vs9ek40qg4Vg7E5JUdZig83NUE7h9ZuhYLJ2vvUs6e0DfVVc6LtAwErsY9gepzTs+l8/WuPzhCQyRWPlzR6M12Bri/4Rhh6setGCKMXWz8/VzK/g6nxfczLE737ZQiQDiKpoibZ0NVeQYhcs20Kki4rfGsQY0G+JL6BhPdnX19vXS8BKbst9sVaQ5zTm+h9G0w5HGsvWbIZhzh45x+tio4pmyq4SdagqDI7br3zq+jYaVktv8/HHG8+z8ltPilBt36Sh0pNFZdzmNMvjnIzdPK5Ubh0fHsRik6oq4Fei9XP1nRBF+EDvWYXes70YyrZyTDt+56/HM2KaKtz95rkqY99pdWUdmyJURTljt/Y3C7ORqMB6ompsrZUP3doMntMpZX2L5zHtZ5uLDv5AYdswM4zk9oEw5dFUKcL0jjVWLpq5mXDIlUpM5PhDeWEMzkwzshlTmrxUNiUeMj/XiWCdBUNnhwTYwbDbVtaUO3s9OhXBkS1G55Eqind3TE636+pi9aZNGpbKxZxrenpl5Uo4HE75XC5XYC4TEb4iUpdZONBuh8DtFj3+A9Kx2sFQ+xAFGwLsYNhuC+7g9QiV1dS3Z2GKsVHxezgyWZov7Z4Y21kNTFNWgA+2Ai5CYAKf9AhhEalrR86zJO7Jl5msV3ErbG8aLrFnL1aosJD624kJUWypmyzZ6qm0qWwGgWKsEK4FwuGQJcsVMr0WoiKT1FaexkpNlt/dyaoQ84aB9uag47OXECmwbWTmCRkQP3J6JGp71xsXS9ZSOpqaBqqra1dC4USKuAKpjBdIXyRcNFtIFhC+3BjuGHsHTaqwg9De0Y5B14BuA2Xf7pw7cv2ljzBTgKxsKQJPzJWxJ+pP6lKipfs63JiBH10VcKEQ4YqSMr0CIouHa1/t7sgVhvUW8XU8Re5oAj57ic+pTOqJpqp4rImCKm5Kr0Ow5w1M18JcXQGkxwcYoSj9CF+my7KVPKhtWRjv8pb1YMfd5hKefZJUkTkVsGSZedGqVF+gfo937mZuMD+aKyaLdC3mKhWYicOVECYaVxx2PGq03JdfILLQsh7p6GjpaMGgawX1mN05//L6H0bp3S+dRagY6OrZSevGpCCCpatypxeuTduoYrkCrnAiHOC2Urk4gCvFlmkeacGy6vBlTN+7tR+QLjp25/2b61s+hSaSqq34vMBSRVuHrqtez/KXvSGIsXXFZd24weswRUC0KN64Yis6SaIlVRE+svp7Z8vdA/VnzRQ2kqurMlVrl627Ud0iBDVPPPeMYDi1cmKs4MqSFbLqMEUJRfHLRlXhYm3edCjJosKW8Hs13+PznJa7xXujaTpVwPSzSlXUAVUED1noi16JUtgtIxGGAKUEtdbOVIFAOBGCKiZrdRayLF1xflckn9M6FVtu0rbwbxN8jF/Uxrc92DKIYa0BVicfA+r26a8f/PQlqwC3IsSU7FVjXBXXpCNq8KAQ9LlCiitNFZCufIFEIsxzFQpdhSyqS9qihVjmomSLf4w+nnlq8C7QjfojqcpumKsyVfPm9pRf4lGalpYsZ3bB5fP5UgjWFRtXTJV05XNBFhEFVSA4q9mihVjA31h44k2LzhwGL14cvDhIwQaGsmaIff3c019/CQ+KHaz+qmNViklR9Lu1D5anEgn4XD7MMOHKZ+NKVQWxVFYCrhhhwzCYL2JLFuJYdRVSZQf33PMjHjngB+m+2E3BBoayBnxbX1NOe/17L1lPP0uov2pXxZt+BXE71J1NbgXhicpCEQbsVNWXNROStuIGELbkLbGi1iDwv0hldf+nkFYFWdmiSU0J4hV62wF/27PKpgv4YApFWL9haaq4K9fMTDAk8RrSFtNFu9amlMV9fUxkne/+7xjGVJ2kKrucWaWIiVXayfKu2tJ9TRUSSBRVhVdShDdOaFcM6coVDEpZ4VDUkLZEISJa62qwAKalnUTWMKV7uJuCDQxlDcS2ft5tX49WRVOFVqWqyuSnSNAxavDU+tozXdQUf4GrgH2srimqAFpclSxcnDQseLJ414q6hS0erd+JrMeH8X/UODeMcQ7IbbwAbVs/9zavHxh1ULZYq5IlaBy6qStVkx6tpe0gc4SBxSrCldtrV8AFAnNzc0wVkWUajNpoxVgFimjhcenDkHXuv+C9Uev9XzGphAqYu043hf9TlCgzh0NvgBcfXuiPXq8IV6avKa5uSFeE1NzcBI8VMJeXZbRmq6J1LBoW84UHD/fiffS5xvMTujppVeu8VUlbxZjbggdeLUEmy7+f8wFY4g2LBStVq2paUwVXMlihiYk5pgokMsvVtiCLt/g9tWWBnyFLJKvnXI8CDgiwg6GstXPsr/8UXR1kDThSSzATKbsFfvqlNS1weTtIJbHyoyvW3a+oroDqSlUVCIQhK8xVJSALCFmA1+GuejMEB1RWT2NhqnbisKS6ymQKU+5q1Dr0sNeYEWB5wop90X1tiqXfBVVXYObq1SBTJWQpXYvJyrJYyWjFGi5rBKpIr8p7V3PClZgv7ON7cApRdBG3RA+rxMOIiyCDhQFEsPRYAZtYgbmFhSCPFZivKwu2xERL6Joisp7uGRnpGenBoGsNebz+OSP214+QaRVk5SM57mpeulqOOYFbhaqSuioZmiQ2A1WGOndHt1Jc6d3K4ipkcVdqstRZ/DYVVc0SldU/Iugf6SdgpW4DrPTj9Jjd9f3szXIpmsvxUMkKNNc0VVrHKi8SR0wTT5XQhh9Zzt0VVbauUqGFxcUZ4WpmBrJAtay41eHzRJXa4oms8/2NgfWqUjIHVxzhKnqLqHLSFylLMVZegBjpCJvKfgrBkqki6K5UVZCVWFxcJKY0WUDp8HnpqfGyfnrGAdYKJlelPF7IrP/ppKI0xORhfwFCmCTmSN1nHcv+LsiQrvBoZm5x8SoTBVVclt60aLKsRZU1MDDQP9CPQdcCdV85DsQ1QL9+YDRNVBUzMCVKcFW62hyzTPFcqdECe0QVF0M3a/fJ5zQiVnbtClTFCiws5ia4KhA8QRa+Dz1ZDwzccf6i7Wx60zjCON5PEPVoq5WcRFGd+ugoN/fUSy9VT1UPTXuu1EPVr5B7T/02wAG0ZrFZMAjMshCVBRziXTCOncR2Xtqq/3nZfXZmdrdJtf15CsYiCvzyf56dmd3iH3msLv2kqvGCTnK9KcVAmNbfMf4e8xSRoor5GO29JlTlzq5UV028Ipu5EtiZyXIuKVP/r6zfWLd6Xg0ByQLUrqQo9mXqetep14D0wi3pj6m9K0dBmlw909uV2Ege4gUlVNm2nyWL9aw0Wbfv3r199zbGXUDfp9wDeh491v78Y97XF0qzwojOMw+OSgQKUWtZjXUfnVtEiVbNxuO6WOlAFLnKjFW86T5bLKZwJbFJljF3OIMqNihgJSGrWH5m3aoNU2Zj5639sKzI0nS9rD05aMJWnCQxKtpjUYVP02IFjKOgPD/Rx2sZkqocWa0zocpMVqH8FmAV2AoBqUq4Om+UFNQavOohLMzWQSV70hBPsqAqyxWeRLKEKWAh4mRKkaVPtDLLUHD/9n2M24T2c/qe7s3nRa7SGju46JZLZUOXFHbYEoUlL9GrKY7Ux/xYCFm5rurkittqLsaTKalieFClL6VlsjRKvAx37xcJjoNBNX2+AC5MVRiSPyrRKeQabFWAsn9Fj8EIT8ieiFY4SgWC5hCvwOaNPcbPkZWWrHtFuvpmJ4CrDFVwBUoYiitRi0dh4nQ7XByY+1fyMQOV+kw7h0qySBXVIGiGvh+qroZZyXLMZCmy9u7vcfANBr+X0GP6efpzfsZc9DyUpqgCJes5c0XZSs61dmqRKsCjpe9fyccCrO6eGCcGZQkKDFVN2/d9y04wHJIshiJLC1ZJytrb3t7b3vtg8Icw6J6BCdbzlKOgYNngwUrT1ZioV+ixHj8y9q8SJpC8FFdKCequmgvf8xVVubIUU/yGy9ouir3vMGtwVFOTCL+zXxaUjGRd1bUp03EFNvT9q0pEnbWskdKujlNjBejkxNBrtdzYFFylyBpklWFJytrcLoyvsHI25wsc33kHT13Zs9Sp1sUTc+9O1GEtMRLUR81+XTw5P1cHUhbfbve8ieLKlAXSZfHGymVtbCtsbG9g0L3AfGz+DMEKfNnYSRTwJ773ttyFKoZWhQ3e2RVXgO3sqftXMlR1puKg368oqgD5NHIF+pbXclxhKlZlWSmyqjkNHrKKAh1rrbgax678V1DVFclS29b1QeqqhS1nlKkoIBXNvl0zF86mKnLV8x1nbAukKbh6H1liBQuKlLX9eCc4pQv4FFX+ZVfUoJGtmxq19mRd8aZF+1cUKw7WdzWtBOk5HM1Vf4rFsStFkSur9T6yMNh/hSbr252dM2VuRa46h10AX1HTinj+xFBFsmj/KqIuwVTpmXJunlzRslkg9pDtllMdQ5USq3xZpCqRrE83dnc3djc4+AaD7kH69wT9mdOdYBD3dYnP8f7sCihYGGBtlqA0wGdaVIEUKw7e8zN1O4ZUyRIckSowgQDLpmYVkS+LhGEIWbvF8BjtfUKqkrL+mHNT+Ooq04e2VoLJsEhZZqwAzsGTLHPdzKBYgV4IAaGq6v2TVRIjlnVv9x5Gjgl6jvaYvkcVXgpVlCvBct6VtqJgiduqkiutXeNd1pOx4pAsqyYTyEjaVEtQbLdbeP9eXIGEazm5sshXXIb3igHHQlmFZIrjXXNXZYzIF6/DTnasuKxePVYFyBR84B3XUtqV2q+aUa7sFvZdrKEkocp1nZx5FonCbbGyNoOdoJUswUiVFyBYXJc6e1iqsyv9hHu/J2XVKVjSBpdVORbdioJl5Eqe7uotOp3BLBJFuMD51+VOKRL2n2Vt3tvEUH6EiUMwmcSpIledxnwOVaIQqRQv8nIFcMCrU2OnVAlZrjtiz8xuVwhVJGsKV75ZgS6YVvNk0RwrTtbDzQ8GogweYeJAswVy5b2BK6ji0Gzr1VNylXrdmU2yDFcHtus2a0oJGjPROFduZzCoWqqpmGr+Fk0JQ/giWUXwbbBzThUo8ECbu5pryXp7DFV5ripox5DFRgx1JHs6tckVSHfVA1Zn0B5MaWYF3FjXtJMnq0TJKlgWtkjbhilwI13FTYuxX08/DJKrOt4bTOnNSuro4cQyyapndHaosodVaAgVVZIpY5CzU0ozB5L1oBhZ2HHoKK6EreW8MQdQlZg/dMOnubkCIws9XK9AmmvikgW2GMpy1U+6OlkYzQqqhCxypcsSoZKmSNanRbDJtrLiXuVhCP5qxLLk/AGyXuS2q/hyxmSqaFrOmYZhP32PoZl0ZTvtk5NxiirhajY7yT4VBleA6yJZdwqR9SAIdjytBoFzCFGNuAzn3NWfx6kLHEVW33JtowRJlhWGrrp1BVRXYIj+vfRJFfUqwSxUZAE6yQpV0XGwcFmPg+DUFyQ/sveMqeLQEXHeI1dmu5IGcLzrGc2KsLETNKKjIKkiV7ZtdZbLZUtLFUxJUMqTrAk8ZJGqFFkPP32I8Z9l4XShVoEtjLeNhm6rfGLmSnMFrOm0KVxpoZJOwvHYUkrQdDVtL5erhCuJNDWdAT9TVkbPuvOwCLBL+tIHpIoFq81UUYfnvM09CkpXB3g/IzVWZIpJGWKtcJCUSapkv1qcLFcrzyhAyhXIWhqKnhVDsj5+8GFaHjx8gKF//10QvFRccU4bgFciNflQqCJZhivQw9shVXqsQD/0/YXZregw6EDVapKnCnSMCTzJolApsooAyXohRZErVOG8S1XIm/zrfzkMCqzZbGi4IlUwMsS/y1SLFR0GwxOoWoYZfV26ov5uXlN6SaqKl/UoCM6oswucKg8WG7Jn4Wb2Pq5GeCN9vQKpK3ErM/xFbl1tV1KVW12BgZsbq4z+LibwkAVSZN0pgkfsSj9SJbiAK64qttW9TlFlbqD3wzA8SDdFK+QJ/oaZ3q6gyvJWDD/jEEiEmS0LZaiKKmNA1lZxsmRjp9/e8gqqulKXtLXObVfSFZtGTXVXTXIltNg+/gq/py1w3NYKnHdm2jKQKlCCf492xvydl6FGGcnaKkjWt0FwQaakrOsGo5s4JM6beq5SN9DDxcJWelWTXAlTgNnCW5tY9GNrMmCmzpdjbXvBzBVceeSKggXgytNllVGGW1tbX3xcBNhUXsMUpQoMeKgYcSG+1qYMRqyYIj7lRBUarihV0ta4WsVmVdVf4N0vJk57xThf+i65Sq3BcBaCQWzK/L8zLzVT2AkXsu4U8IVkrePGLmWtSRRuOOdmripaCYLZYjxLqcB+BF3oOHUGoA3YDJSnaqCmapqeKuC1iYGy1mkZZVgWsm4VlCzIIleC5w2gHhCHWTUY5wr0sTttG65IlnJVaNhqA6wBIet8NfBmlkCqipuV4Wqiu1I+rOCFago3hx9t3br1ScGy6NcnvWkA0gX2kwvn9HYF3MlkYajSChAjwgonLQfv1PFDV18HZsQKjAe6q2SwvD+MYB19dKtAWeeaq+p1QpVo8jfHuisJ5Qp2sCtm6Y29T644NqGcj3+vZgX8DFcyWP6NMmtgXHNZXxTBT7jkT/t1i51GgjnP1lq7kkNr7YIptsWapCq9/kiVJHsfJkXVuKqp0j9fxb+OXTFZ7Ot7LiuFL2AQNwr5z2HJckgWY9VQmMNXKGXJvavU/fM+NsXcgxxZdhI9VUBVhaHLWjgkKuOTezrJboVb8IjLKoSfgmBFseK80GRhjPTODvQz7ljGTJLLQF1VzzBFqvKPgYJFa8AtER3jM6H8QG3vZfBDobLOhSoMwU5Dt3VE7SrzOlmbLfnSZ6HATutWZqqymxVUqXSUz8+SRei/k6IAbkC3/AuT9XkhsnByZ8XrD0NyYwTrylg3V8zLZFstv5k9tSJRdmZbp1QRslc5eqRErvRP/XvBTQlfksbXXJbGJ7CHG+NxPl/KMqwSfzc05qdQlZcr2Bni5VoyVn1KlV6Bw+liylWRK5dildHYJ06y8MSd+Zl/kNXaj0qQovX6I8j67PMCkLKqBF7B/uGhZuuEYpVx7WfPbzl+/mzBcs5ujso4nVC+Wrt5qlRXC6+ajBRhfvamfxNNGOQd6P4KWbBVmKwqgRfQNoLVmNQEGbGCnxCbYMMcV8OTqzK2MCP21yQrt7GPW51UqqSKXJ1Sa2eI0+i/C1kJPoc53KSS/xwui2KFsTxs6MlyyVVdm10JPxbCGZIqo1d1jqSpEh/gapYWK0LWn2mJ00n5BFz/MpqJ8iF9/UPdufy4FMVx/MYf4E9ghURELMQCEa/Em3gl4hWPeEYICfGKJREiQbARwULEwoYVG4nGdWk7DUHTpEbbSKudajvtdDpjiO9533POvUXNovOZ03tvaybRT76/X29Oz22HFzvOZLgaFfRk9YAqVBm+XofWIPODhVQvou9NV6pZ9Yl3XCBKbOKfIatdqlJJ4UShdNmfrVyBKAypiq0rQxU655GsUZaFVFH6XatnSVd2CQK68hNFGNrYS/rVwriRjRfVp/f0XoUpr0BMVfJTu4fUrAxTRcvQewhZmyYjW+P/CH4Jo92xkKW+nLnieUawmsKVWr6gvQmRwd9mQpoVSGWpKYrbHPn14znLl/tCr0BFKvn2z6JAVLarYlNkSgFXiTUOODt+FJCyVKzwwpx2abQwBC0RKztXdJoTf55sc2L16xkn0UrX6/VKJf+Lta5E7ItExeorXlgZ7TyBqKzAF0MsUloRYiSy1x2wdzRl+VX1fBjyzKbVCHcFW5/IH78SqmxXVeGqWahX4IrQ4k2sZKr6+jmp5tZszK+wIPTGBhNSk4AvsV7rEHaOoqzvSIbv+9EHPbMOK1IVMFcnvCITxF/0SSv/+XrG5a7ieRIrThOuSLz6NFOpXu2dEwzbEtkwkkRWD2JKMHQxV+4xh7ByPJhoMX7ieIx/eYzI0r93vwVVTJcwVtVipbl69+otWSXLVGGItq5s/XzGSdcr3FU+X5ma4E2s1StNiWVPXJhC1Jz5tTvF/qEfwhJumih62+pQFp+XrjrHkPWBEhuBKKZLUISsQFewk8RffOOuguasPgtXkYoEtvL8839wa5VTeFOILZeWvgA1YsD+4W2sXME3vBuz7eqknW5Ac5UDeNMaTVkfhKsPPzyKqxrXC7tdEZirWCxFVYXMhMqZy2FpqpIHaf+Viz9+9hejKeFLCdN0vYiVapX0UKvp6ZLIjeBTxVb9ZI84nOVE1jj8UHBggofsx+3fYbI+SFexGG9ZdMPola6YKVWD5I2WJDElZBmqECxBi5mSNOWZFycbHx78ma7U+2u1avk7KFf76pV8+ufgwPBIHIaC4ReNajXIxlFHsonI+m+kLOmq6HFcaetrmCvMXObeolUFpIrbasgLyYaoK6WL9zKurBNYm2I7lSn2Qgi2LHEkqxGtUZKlVElZvGlhgIxWgkIVrqyJ5YpRX6iMXIFMVs4vpVkBKnjP6VzYczp8mVLtCsQ3Oz7OTkS0JozDmEBRx9p9sQ8CD0tZMbgilDyOOjd9yVQZrf0bVBWTsGRXoJw37ucXdGKDUGmuCqKbdZoqtgU4Yqp4pNh2nUNQXQu2JvwvkFWWqkCu7ElcLuwVZL3mqHYFVcWUZsqeNI6TOqFPx9ViVSDEO1dFN2xIEmzw9cJ3HJ1j49HBR11WVakCLuG9cKVi9eVDEWTet3EFWz1EFQtAxG+K2po69B/Bko3KbuzAdAUWn8Xr4KjIinGw4CJX8wTy5PT1a721v3sZhalSz0tblRRF+cmvu8OI533AFEiPdGBJDtxUosSOxyp7xrFYdoVEa9qEaRLcwQg7Nh8TsqQrdKFcn67KxU7UIFf1qbdI+Bz0GkhVCVlf3OeAxWAEiiAJgzKVfL1mw+3Ektjo9ccjxWwddkK+cxu2/odF+XyZq6IUIcvQFddq8GMyR2P1UU5Z2Y2dU3quGC5I8ixXYPBfMqV2ovz08wXFRSeQ5ePAf8kSycpRW9DQ7wFN1483cpLhZaqnCEq5b/Y7p/ZbXAPi0js8tQGRLLqHK0qTS7BRZjD8Z1X22TobuCFTuN3a54SwGZWEaE2aNkmAQ3VfYf473wtZOaYK1D0D90dPNPWNLTorUlXFVFizAsrV1yxXRdi97ezeYzv2btq2gqWL2GqkG54qMrPo9DwxUdp8FdtiT1WJEjy0ywll1RVia1LHkDKkqopwRah4Js0ecXIPSqWeb6+Eq/bLPMp4BrL/yqeweMe2pdQXsdUYpI1a5gZH1n3ey7kms1OpMyuYIu1qsdOGlReQrM5tIVnVWIyqCpHljlBXOWYq9fIdxzZlXJk0wOqDPTH/c1i2aSnt9JDVGGalBrgZ677csKHBSlBxaL3TniVHaFl1LqsMVUJWqZiPeBFPo/UpQ+Yvk5+/fnylFqUZbd12lXETgL9SHTRex8+TUkQxNhpxJkKLkryv7TVFdKuRTRzc54Sigk1VTfcxafokjND76jGaLCJKuCoVInCly8LscQfrrGKsQJix7VZBjC/kQSHfiHBH8rRAv6+EAX+3Ms4Ysof2ifS2Z/kF4qoj0LOqyhUoQI/ua8CWFe4KprisRgIIYWcC/tPbWLrSEV909HNzw5DogapPgSwzddgswHCWXJ/+37JKjKmGKshqs35PmrKClYknfNx1Alh2diNk5ac2lSpgqbLbFDY8sbdObj91+OL6E84/sWrSnOlzMJgCHAB2v83jAGVYU65AOuIZXWuQuQqvwMBFoaVE1hetsG6y+ey2rSumYsGIhpkoYYjYOXhy+5RTZw5fPLdv/a7jRuH9Q7jmdALpWdSUkgU8U1bQREzblY6ZEchSvv5UJLsunpm7/eTBPZyDB08eOrR9+1xoOXP48F2Y2bd+/S5bTudsuD1n4ZyFFBxQcIBB90HgYVKGJSHrOwZk0aalhA3JVGmEqqKy8uJTIRgnnG5jyfWZC2diLMSYyVH3sQHiWOxJskrSFWa+GzRZRJiUxVWFL3S01+8Vhaosve1xupANt2f+I0hWjasCTJan6xoSrmxVGNyUvoI25mYpohK3O93Ikmv/KGs/GjxVpWSxaPnKMGx6L2z53reSuqiTHRx2uhOEawZl5oyZGHQPxLHYa7KUq3K5wWIl4wVZfzqzErK4qlRNXqkoivGc06UsucZU/R378/k+WoJKlkCWoW0K2C+BGETV57wLU9SWzNcup2vZcHvGX4Nk9clYwRVkCVHY0O2QPb1nNytAVJFPNiWuXP7DuOV0MSRc/5AsnyozWRiQZTWr4AtuMlDVOwBHTJfilNPVbJg9e8ZspgMHGHyvHuMcgCzlyp8ssqUHg393bdI38qEj0WEXJKgvDC6ta1uWDNfs9ihZ/T5V1XI6IvHYGNBOQkMueMO1g3D19he1BF3UlajE7jsltcL117KkKsiqTo1oQNeAOWllX5uUgSq46vmhXafIo9XtVcjDNWv2rNkYs+QeGI8dKBQgi4vCqBYMV16kpdefHSuooq5ycSFJ9i2ycdc7Y4ENj2f9CSSrXhZUQT5i4A0HTcT4U8VX7dcirglsjY1g0XBd+pOse5AlTYXI4t3KMsVVcVfpIFVgz3FnrLDq8R9lVZQqUImYNImq4NfAr0lxNciLlhvMky4+IbVYfGnerFnzZs3DCJRVKFSUqlqtVo/EDVnxb8SUfWUSQiWvyPoed4O5OXZyRVl5dV4495Gsalm4Av1wZZAMUIVQ+a5eS7NVgjZblzhjjYdtZeWlKmoLdgxfL4zP/mKhArwGY7+gCsMicsUZgyx7wNQsmLcAQ5rC4VMpq8aJWHxI4mMqpCryPr66eg1UInLJrs7lY87YZMPpBYE8giyVKtAXj5vJKiahpPcz/QrpqH71WjL6YdgD3JSWsN0rnbHKkkuhsmqQVeWq+oisiO6rytejv6XAEweuVKzUVRlc23hnLLPyKtUzf8F8DLbHEWT1iVBRWSMRostvq94LW/rVRzxXMcRKiBI/LFvNvc4Y5wb8mGASvi5l9YGBOGRp0Wr0MlvUl9whVr/bO3fdtmEoDPNJ0r1P0UW+oKC1GGjRJoCBdKinwB09B/DgIICHvELRIQ+RQYuHnqxdjI42ejMqVWpguUWPKNJHFKtKBZJBlD5YpucPh8c/aRLeeHSOK/vgFHzBak93bsgaY3ZIVUl+eQCgVdZPcTsE5RCJqs+/lSrSJUvrhFkBX+RkJdmBXCFr1bRA+drjpp52uS35fPPDWxYQnzFbuJo6zhPnIOt6g5s06QxEfN8PAPGytQUf0JbQRbK+x4YjlR9eDpg9dOdOFjEPv0hXiMgOoJXWe7rblnIbLuWms8mz+oX2kozqEOdrLC1hSpJWVjZB+HS1TSjbgDyWZALPmXXwhdNxOvhCWz20JVyluoIYQKiiyRhqNwG/RvLsiGdW18WI2chw2pEkpRWgLEUICk9V1zf6X56bMKMqz6s+s5QrpWuc2PIlQbBSogAO+XR1Ky6afvy0AuGKniXhPWIWI3U5vdRW4AcCkJArJN7d7SLtlx9VW8pXbdfN/6frfJPYUq58cqWivBpIlTrFRcJOObOe4SKx1Vsj20Cwjam01JODjiUpcbaE9jL4W9Hkla7tNgTI9XgxmtChiMie0F5G/930+vX6wOOsKvinKDlaFdrL4XOcipIACOpcxco820J7BfhsLH1F+jyUQxE2hvYqdEezo8lk8hQIavQFwiwN7ZV5Awa0+Mnh1nen/Z44BkLv9DljYHVorwbfgwGtf4iL2u+03weXYKJKi5pXE0J7FU5Bw8zz+N6Q0F4OD4EwvhWRJoX2UoZhUY9PZ2PYrNBewuAODLzDUMPjMQ8Kd6GIaMZaclxG8FfcIWsxGLkxGOzazl7AYKLn09idtd2qmP7ZiZsK24fHR20MLafPB6O2UTWAP1yGz7GpTmekAAAAAElFTkSuQmCC",phone="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAAClCAMAAADyFTYfAAAC+lBMVEUAAABISEhKSkpGRkZERERCQkJOTk45OTlBQUFQUFBSUlJUVFQ7OztYWFg/Pz8/Pz9aWlpkZGQ3NzdcXFxeXl5MTExHR0dhYWFJSUk9PT1WVlZMTEygoKBERERFRUVmZmZQUFA9PT1LS0tra2tPT09ubm5SUlI2NjZXV1czMzOpqalTU1O3t7dVVVVoaGhaWlpqamq1tbWhoaGenp6lpaWurq6ysrJZWVmjo6OgoKBUVFRdXV1cXFyvr6+0tLSwsLCrq6ubm5syMjKbm5twcHCQkJCLi4uGhobLy8uCgoJ9fX1ycnLPz894eHizs7NxcXFgYGCVlZWYmJh7e3umpqa3t7fOzs7JycnFxcWvr6+JiYl0dHRra2uSkpKNjY2IiIi4uLiUlJSsrKx3d3fDw8OHh4eQkJB9fX2dnZ2UlJR/f3++vr6RkZFzc3ODg4OioqKcnJyUlJSCgoJ4eHirq6u4uLh4eHiBgYF2dnaLi4uMjIyjo6OZmZm1tbWwsLCcnJyxsbF6enqAgICwsLC9vb26urqjo6OKioqsrKyWlpaoqKhbW1u2traCgoJ6enqZmZmbm5t+fn6JiYmgoKC0tLS4uLhmZma0tLSYmJhxcXF1dXWlpaWfn5+IiIicnJyzs7Ofn5+xsbGampq7u7vAwMCMjIxgYGChoaGgoKCQkJCOjo5vb2+RkZG1tbWOjo6Hh4d6enq1tbV8fHzGxsZubm5mZmanp6eZmZmvr6+Hh4eTk5Ojo6NwcHCenp6mpqZ6enqlpaWWlpaJiYmlpaVjY2OcnJyKiop9fX1/f3+CgoKlpaV4eHiUlJSIiIixsbGqqqqGhoZxcXGPj4+ysrK1tbWurq63t7eBgYG2tra2tralpaV+fn6enp6tra2EhISZmZmVlZWGhoZycnKhoaHV1dXX19fW1tbZ2dmrq6upqamwsLDa2trU1NSzs7Ovr6+ysrKurq6tra3S0tLGxsa9vb3Q0NDDw8PNzc3BwcG/v7/IyMi6urq4uLi1tbVYe8d+AAAA5HRSTlMA4+Pj4+Dj4OPj4+Pg4+Pg4+Pg4+Pj4OPg4OPg7+Dg4+Dj4OPg4+Dg4ODM4Mzg4+DjzPDwzMzM4MzM4ODgzMzMzMzg7uPMzMz+zMzM/swD4+DNzMz0/vz8+fXNzerMzAr58dPN9fLs7MzMzPn05My3j1w/Lff07+7MLRH77+7u7uVbJfr39PPr6eno6Ofn59W7jl9ZVxAK+ffr6dXVuHNAQCYm/Prx6uff3NLNuaePjX9zc/vq6d/f3NbUyK6rqaeNjXMR6ufc2tG9vLynp4xzWUnn0ry8t6WZemFLNxrRyMjIxGrWwvApAAASsUlEQVR42uzW12tTYRjH8aMQvLDiJDa2aimigqiQ3NjLIjVpTQutrba2FkupthXqIA6caNUaxYUXDlTcWhUVB+LeCxXUGy8EFxlocoxohokJ+Hvfk9Pn4q1By/EYwe9f8OHhd4b0P40qmXfm6vuJV8/Mk/6BVp19XD2Rd+Lq8xIprVu88kY1sEnuCYCltK1k3tbi+kXV8HLsgzpHIuFwnpHSMowA2EXVi7j2wYzA9/j3eLyioiL7lZRuYQTFxcX19fDiuNVtju+sOLio9ayUTmEERZO4lk9hoyUYDALburBXd8ORhkSF/DmN7osRTJoELcJtHzgrgqx43V1TRkYPtOFDQrZI6RFGAKuqrX9RFY1GgV2yYEgGsEqDErKcDs8bRtBcVFTEucDeXxv9FkWBhp4ZiLwNstwu6Z04gkdFPK59uDT+jRXccaG3KYntOK8sl0t/tcXPXhY2N6vahy9aw+EwsI4FRhNL4aoZZPmzpH80gtOFhdA2K9r75V+/htH0w4N6m3h0XF4/WQ5If6tVtx8VshTtpRWHvqJw1FJj6I0ELrT6c2kET1usHdqHzu2xGNNWzcwEFQlTgFb369II3lmtLS2Fire9PGaLgXvwcC9+WOLy6Li6cmkEe6ysFu69lB222aANm2sMLOISVkeuOALrVCsP2NfO6ZGIDbXOzDIoqVjUCTfwUdIvjGDCVGCTt22vskWQ7VBdL4OaOAXSMq5+18UIJkzo4B5fe85ut0cisbXnB6vW1FtAAb24i+c+hRVazp16b3UoZEfbF2YNNhCXsDQF3a+LEZyq5VjluBerQl9CqLKu/5DByEDcVMdFAR22e+D2ydraWlXbvn7Kly/Q2sp3GocIWuG4+nIxgicFKKk9fvSQy8+00xtygOXaX1+uyNV6BLcKOBbhsheX+T0uv99/bukAI7BMK16X3mLicUcEPv457oG9J6cV8Bj28rrJbrfH5Qo5dmUa0U+PS1hEWoGr9QiapqnaguNHK71uaD2rG0YZFWzqKZg61Y74+Ee4JftuvS2FVvHWXpzv9jHtlPEDM3FZgUta8UkjLbj96LpajmBLaWlTUxK7eZ3dh7wux67cTGjVJbB+TUveGs25d7Y9KS0rZdwmaC8frfR5YfXNahvNsHRc1m+9FtAYM8ag7QjelJVBq1z32Hw3qF7fZEvfXI6l4xpTLFf8Lef1mWHWlIsR5JexuHbzcrvPizxVm7JykcKlKYjeVJ+IHmOcZgSuViO4lp+fr2DR+kovuysbQZagRZ1gSStuoRsuqxkXI5jTmM/jXIzAi3w2S98sxLW5xE35iQA4Q3gtmOrMKveTFiNQsQgj4FaMIAfWJJe0qlc4boop1CS12XTdro8gr7ERXN7m9ZU4LJrVNnLYMEFLxyUvaVniFvqhNlA1GEPJvptX8vIa85K35SNANsvQnGGIYclLWjou1YGl1wJ5l2pwXYxgdh6PH3f3crsbny6vHyMAlrTCcUmb+rjEXZHUgvupqyO4Pm5cUgssRuCGFiMYm4NScVP+OIpbIG62mbi/PQIVC+6xNR4vw9osY4bDqnrFKSjRcAVvZw8acbt23f0/SLV7n6aiMAzg8SMkSkwkaPz+SPwqbbHcXAVjpRJ1cFIGAjJqTB1IR+IiyiDRBRZhkYGYuDK4ECb/AAcd/IgObscGk8YAf4Hve96ePj19r+e28eEf+OXJc889bfn04cqlK47LI+CYyYXc+dPCTRpu+uXmiNWq5XrcPx1yl169v0RhLVt5BJypcuE8x3VLSeOqbvVywWUtuO2PIHtJtMxdmzZMpREM5HLQppTLadHWvYlaxz3O+aO4wRFks1mnXX46bq10EvTnOJ2UywmUK1Rwb3bc7tLi+yzFlfuyPoLn5eLV3NVcR+WeONnBFITLWOFutjOClY8jI9kGd21ORjARn+nv7xcutLpcSYArCXAxBs3VI/g6cjlb12YxgkeZfqu1QbsWeza4XEon5V7gdsENj2D1MqVe7vLLxklQzGQyrKVAaxMqFw8a0g73OLjBEQxftrHaphFkBIt29RY4Spv25QK4wF5or903775eHx4erne7PDNe/UV/NIJCRsJY4upyj6XfHBH1imgEXJIKd3PrnyMYHCStlPuAR1C1IxgdGhpq1oIrWJu0m6OHDX25wPG4m8kjKA2SVrgja3O1KoVGcK4wREG5BGZs6BSTBMoVbahccDeJq0fwpVQi7KCdwgMaQZWq3Z6cL1BYK162SrfeoYtyrdfDhk4xlOtryeu1q0YQRYS15V6nEZgqZ6rcY7EFaDngkla3i49oTpv+iVKV67Xrb/fnj1I+KpWEO7xOI+BMxHevFSTYArR6C4JFuekXR30Xg7avL5m79COfz0d1rh2BqRoaQfEatF656lgIXcvDXH2KwZvMXfkWRaSNSHt99mGVsKb6vHyKsNDiQRMt2gUXWmA7vy645frtbjW4i9SslPt5ZrtqKBNxpVgkrea65bZebrxDt4Obo+ai3L5E7ru6NhqcZmqVR8C5xlFab7rhKegHLV2L6frtbglXtJa7fpu1U+WLo0UbT4stoNxcMtfXYrr6Z6kwty9pDIsRdcvaWW52en501Gk5oi0ka9X7V50LwVMsrFVj2LBvBrYSuDRD2tsvCKu4arl40Nq6iqX/zqMvN4q7JdxVovKxwNq5AWC1ViLDtd4WrXih/a+LrmjBjYW7mJfM1kxtsoewvle/Ijih96+N1qaXq7U+d4O4d77lbbfr28ZMVyqVu3eLo6FycYgprTrE2rvcHAl0q8awwlgS3zPm3gJhKbco5zhJZ24GN0fRSgJclNvJp4hWbiztfs/bdulQ2J7ncimMRc5w/Cl45QIradGCm/r61VpwY+EuUbXc7rgxYwR1adIiA5RD2IJg4YXWRbCdlKu3cKPB3SDuCmO53NptbhZSaIGlXOSc4hwIfhUiVl2u/hQRKBftxjIG90J7yOVSdLO+V7CSHpfe0/61HN0GD139UwS0/2r3u32jfTamtkBQR9Va1yv9OS1yyOWs0oa2EFgutMKN69xV+0ajLbxVxXqRZrUUWs6BQwc4vb29x/zLjY+FNjQFcNHuF7uFGdoCtOAOuFyEVheLkFa8kv2cw+Rt99tyF48rWOHaM5enW4ZUtJ5XqGJVWkiBFa5kXz3OG/jPQbXcFi5Z6W/CmHmxetQzVKp+wMLaXq1FjnK6u7t9beLlRrTCjcG1BxmduhW9WnFKUC7ScMpm1Q5IStZWbrfN3nr8LahyKU+auXLRNcYkvRRgBRRBraBKudB6te7rdlyA9+zdw+nq6iKtOhaEGzvub+JGFFNzXEyWmYob3KyTIl6tVgoruOJ1OXiwhRs3ceViLu1Ci6fLST2tgkILbwPqsNA6qkS04FJ22uzYDe4zx40oNeImnwXt70CCdvVeEXAhVVzyco6PjY097rpx5PXGb+JGBC7RzRxYHLHQpjQLK6T7odVQaD2oSKHl9Nx/tGcXx223xGMAF3sNbdZz+lxILfRvc2f2clMUhvGNkzFucOPOrTtD4kJcupArc8oQURQyJZI5U5nKzI1ZQiFTpkLxDyhxZZ91bHPmsbzvWmftd6/1rGWT4zjP58Plr6ffftdwPptHyylI0Al7FVQOkxrczLjLuC+clRZMiI/ZPPCE4dNleX1ne0qCsBVKu4qRodCuKdahDIogY6sQz1iNC8L+iratNNvWa7bCyTKWgS/x6FHTxfrbGAElVMaFXg0pzoOu8Hh5sFYAkTZPjkq/Ca1pV1/oUruwLyiZBdArLLc+p8MLukocDQyqtKuvn2mZcOdskFbW2hzTpxVnXVrsVXARVXBz2o4dO2pc2y6vYUAbecBCT5eHK6hxXk3q4BZBg7hsrsFFUhOcXPS7MRZmgQ1qEFjAfFCkzUk5BpfL5UctZoHg4sYAcB1UjxaXMNAAaAG3r22XUAO8uIShBbCbhUEA5cooAFyXlH5Z3DZZtjQh2rzdAmV40EoKuEIbHVtC6k8EwQzj2nTr1q1zlvVPBjLuUG438nAFaIWzWC5uuFxaO2froEhrFZDhJbCUo1k2RXBjswAONeEhS9+wj/Hi4DKpZkVcgXVwF2XZhIRoPdzQydZDRVyeswaUvrv4tIWHS6wFUEb1abvl6Tg7y7Yl5uNfcvcPDgpdveATBr06xmK1MGQtrgDTk5bNTwZKuxo0RGtIi7wwDNwDo88ptIEFoQ19wehymrUubEgSXa7gFijNX9ADKBZPX3k8VtjGwJAVWMHtzem4lF0wuEM0buR+QzyAjUFeLgsLWxigrcdwurA4DDSt4FK5SycRLtMyrmxiJNE5i4fFPMFezbqAtUpwzhpS+sXpROY+SDSuaVeqRVzoVWhttbKCAS3H2xigr4Y155VejQq7s2xZYnCHcLsKaC0qDFrvrAiPWM4JHuDk4oSc9XCn09Z8JeNyt0aGHl6gWLjf8EB9WpPgZlY4Jb4Gkm5MeyPhmJ+5SVUqkE7gMiZ2pEFnXVx8xAqkdnSBB5zKbLodu5zoEK2RAZ+uQoC2ZDebc3q0QupW6wwDD/f2UqFNzA80kQxQbWgWdI01i7QOKEjroIoH0GyHTVzt03tJPUzLuEpooyeFAmVx0KKySItLwi8esJy348Tdb+inGJaeTXzcVHCjqy1IAL2GN97uoaZQqkMLzW6a/vTVK/qpgBOrkjxsLuGq1HRqElEWeONDNu4Bbr2DyrZftPTZM6LN7jpvHCJYIwM8XRYXDouS6GERcUMS4OgSCV4+o7zqf2A+QyJu6gorEgCtkCItYMITJmMLcEWCZy9f0z/9y07yyhDBNajIG7mMKXMWUIUWQE2sBNlLerPBy2cbtu1MMJp2GLkbmAX0HTvSeLi4L4gfaULWigT0NiTCXWckwGjaYeRuoNnwaiuBBQx79QetA+rhbjrycjTlxxuRAHE1r0pTC+ntEb1eQ6Or3IKKJDYLOs1YoF819eMOSBBqNw19XNfrF8XSd6zYdh6uR4q7rsr5/of0m7FAgiBuH3LXoS2bBbkHfKAJWOClSGtJhfbo7NHfGHb1FZAAwrTa3RLa6NE2uB5gsRoXeiUJFq/WL/L6fucMSoBhWi2DsMIuJnKm4V+5tYCKHuCeq7Jn3Zf3nFEgQSTaBZah0G35p0q4mUXa+AJW33QfnX3oC9PuAgni0bR9VKry5cs5gQGog/uLYv2LLju3RILX+j1e74+BBCW4xEsyWFq49o59DOrhuq0WyoViWYKl9GYswl1wCiT4dZiWZaB2cdDG14Tf23hTKrgvODrls36R1+Qt25M/Dbug2xUFOLEjjaMBbLhKlgTG7Tx98rt3THvsNEpQHi5XP2qOsBxZwkqPto6uYIGwVvaO+qpf5DUeJPgjXJUqBxeURVy53wiLgLPr9u6PGvZQVILyMC3jmnbLP60TWtxwSWBykQSHvn5l2o0swV/ipkoFL2PgIC6o3vwC0CJuu0UL9Hu8vu4iCf4qxGrc7QwiiAW61PiaAFPLlfZC/7H6RV6H97MEDcFN1W9/WifBy0NcwDofmTXiE9NqCRqDO0CpFM40MV6oFou1C1ibRatHjGDahVtJgkZE0w5QqXJoQVko1y3Wpc0lGPOBaceJBA1ql93NSfHyCD9Uil512j97HfnM7/Ea8Wn96UkNQpV2U6V0tUAaXW7jNwYswYxdL94y7VqSoKFhWiMDXnUBaHBwoQT9Prx4Szm3TyRodLupoMJHH5LyK+9es8+l/CKvDytukQQND8FSlFIOreGM0/omiATVapVo12xd0jhExKW5294RAc40RVoftY47cd2LKtMOFwkajzuAeVOlIhfJeKahLyiWJRhLr3Ai2BVzQYKG4lLYXfg8HCSI33a2nTH5OaVWmzYHJGhsdLmDuN2exAonBTzZIuzEUS+ec0ZMBQn+Ea5KlXNI4C/UAO/k6hKwBptJgn8fgmVckgFXML9YEEFLUKMvlqAp0eWyDEAL65dLqyWo6RekTZ2XNCsD6rgpTK/4p3WcrrPH1ghWJGhONC3JoGAkRHH1JKjpNEcCxOV2I8MWyiUJqNVajSVodgiWcVMVLVeSS1ATCZoc88qjVKlSc3kSLJ5c5V6rTZQAcVkGbBeuOkgCgq2CBM3MoFwGr1tvim2aMpZZqyBBc3N1UF2GX90j9SQJKCBB83OfYAcNVjFcSrvzo95WOShB83Ody5V24fqzO0nAUSzB/89Nph38VqmuOa3gticJOP9fApuHTDt4nFJ7AXdPC0lg8/gq8y5XapSrgpUgbQ0JpF5u97hS1fOC26nlJJA8Yd41Sg3fU4dtRQkKeXSN3jo4Qqm0397OmyZOGatoDrScBIWM3DFn5kXi1ZyqRSUoZtKOa1vWKArztqgEnhIHty4f9/btuEstKwGkxf+XuCT5CbTFnFRuxktuAAAAAElFTkSuQmCC";var _a,LOCALE={zh:{TITLE:"眼镜模式",HIT:"请将手机横屏放入 VR 眼镜中"},en:{TITLE:"GLASSES MODE",HIT:"Please put the mobile phone horizontally into the VR glasses."},ja:{TITLE:"メガネモード",HIT:"携帯電話をVRメガネに水平に入れてください。"}},TEXT=typeof navigator<"u"&&(_a=LOCALE[navigator.language.split("-")[0]])!==null&&_a!==void 0?_a:LOCALE.zh,CONTENTS=`
<style>
.$id {
  all: initial;
  position: absolute;
  overflow: hidden;
  display: none;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}
.$id-modal {
  width: 100%;
  height: 332px;
  position: absolute;
  bottom: -2px;
  left: 0;
  right: 0;
  overflow: hidden;
  pointer-events: none;
  will-change: transform;
  animation: $id-modal-fade-in 0.3s ease 1;
}
.$id-modal-bg {
  background: rgba(0, 0, 0, 0.75);
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
}
.$id-modal-bg-line {
  height: 1px;
  background-image: linear-gradient(
    85deg,
    rgba(162, 177, 255, 0.3) 1%,
    rgba(120, 126, 255, 0.8) 30%,
    rgba(147, 218, 255, 0.8) 66%,
    rgba(250, 255, 184, 0.3) 92%
  );
}
.$id-modal-bg-wave svg {
  width: 375px;
  height: 61px;
  display: block;
}
.$id-modal-content {
  color: #ffffff;
  padding: 0 14px;
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  overflow: hidden;
}
.$id-modal-content-title {
  font-size: 17px;
  font-family: sans-serif;
  line-height: 18px;
  padding: 20px 0;
  font-weight: bold;
}
.$id-modal-content-hit {
  font-size: 14px;
  font-family: sans-serif;
  line-height: 24px;
  opacity: 0.85;
}
.$id-modal-content-guide {
  position: relative;
  width: 168px;
  height: 139px;
  margin: 36px auto 0;
}
.$id-modal-content-guide-cardboard {
  position: absolute;
  width: 100px;
  height: 82px;
  left: 68px;
  top: 57px;
}
.$id-modal-content-guide-cardboard-image {
  width: 100px;
  height: 82px;
  background-image: url(`.concat(cardboard,`);
  background-size: 100%;
  background-repeat: no-repeat;
}
.$id-modal-content-guide-phone {
  position: absolute;
  width: 58px;
  height: 56px;
  left: 0;
  top: 0;
}
.$id-modal-content-guide-phone-move-x {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  will-change: transform;
  animation: $id-guide-move-x 4s 0.5s infinite;
}
.$id-modal-content-guide-phone-move-y {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  will-change: transform;
  animation: $id-guide-move-y 4s cubic-bezier(0.42, 0, 0.23, 0.98) 0.5s infinite;
}
.$id-modal-content-guide-phone-blink {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  will-change: opacity;
  animation: $id-guide-blink 4s 0.5s infinite;
}
.$id-modal-content-guide-phone-image {
  width: 58px;
  height: 56px;
  background-image: url(`).concat(phone,`);
  background-size: 100%;
  background-repeat: no-repeat;
}
.$id-modal-close {
  position: absolute;
  top: 20px;
  right: 14px;
  width: 14px;
  height: 14px;
}
.$id-modal-close svg {
  width: 14px;
  height: 14px;
  display: block;
}

@keyframes $id-modal-fade-in {
  0% { transform: translate3d(0, 100%, 0); opacity: 0.5; }
  100% { transform: translate3d(0, 0, 0);  opacity: 1; }
}
@keyframes $id-guide-blink {
  0% { opacity: 0; }
  7% { opacity: 0; }
  12% { opacity: 1; }
  29% { opacity: 1; }
  34% { opacity: 0.3; }
  39% { opacity: 1; }
  44% { opacity: 0.3; }
  49% { opacity: 1; }
  80% { opacity: 1; }
  100% { opacity: 0; }
}
@keyframes $id-guide-move-x {
  0% { transform: translate3d(0, 0, 0); }
  57% { transform: translate3d(0, 0, 0); }
  80% { transform: translate3d(70px, 0, 0); }
  100% { transform: translate3d(70px, 0, 0); }
}
@keyframes $id-guide-move-y {
  0% { transform: translate3d(0, 0, 0); }
  57% { transform: translate3d(0, 0, 0); }
  80% { transform: translate3d(0, 58px, 0); }
  100% { transform: translate3d(0, 58px, 0); }
}
@media screen and (orientation: portrait) {
  .$id {
    display: block;
  }
}
</style>
<div class="$id-modal">
  <div class="$id-modal-bg">
    <div class="$id-modal-bg-line"></div>
    <div class="$id-modal-bg-wave">
      <svg width="375" height="61" viewBox="0 0 375 61" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient x1="0" y1="0%" x2="0" y2="100%" id="$id-2y6_dj_hgp">
            <stop stop-color="#8598FF" stop-opacity="0.15" offset="0%"></stop>
            <stop stop-color="#000" stop-opacity="0" offset="100%"></stop>
          </linearGradient>
        </defs>
        <path transform="translate(187.5, 30.5) scale(-1, 1) translate(-187.5, -30.5)" fill="url(#$id-2y6_dj_hgp)" d="
M0,1
C83.001,1.706 140.146,4.164 171.435,8.374
C218.369,14.688 253.467,26.308 273.002,33
C292.536,39.691323.501,51 343.709,56
C357.182,59.333 367.612,61 375,61
L375,0
L0,0
L0,1
Z
"></path>
      </svg>
    </div>
  </div>
  <div class="$id-modal-content">
    <div class="$id-modal-content-title">`).concat(TEXT.TITLE,`</div>
    <div class="$id-modal-content-hit">`).concat(TEXT.HIT,`</div>
    <div class="$id-modal-content-guide">
      <div class="$id-modal-content-guide-phone">
        <div class="$id-modal-content-guide-phone-move-x">
          <div class="$id-modal-content-guide-phone-move-y">
            <div class="$id-modal-content-guide-phone-blink">
              <div class="$id-modal-content-guide-phone-image"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="$id-modal-content-guide-cardboard">
        <div class="$id-modal-content-guide-cardboard-image"></div>
      </div>
    </div>
  </div>
  <div class="$id-modal-close">
    <svg width="14" height="14" viewBox="0 0 14 14" version="1.1" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient cx="50%" cy="50%" fx="50%" fy="50%" r="70%" id="$id-ho0itsc4p9">
          <stop stop-color="#FFF" stop-opacity="0.75" offset="0%"></stop>
          <stop stop-color="#FFF" stop-opacity="0.22" offset="100%"></stop>
        </radialGradient>
      </defs>
      <path transform="translate(-3, -3)" fill="url(#$id-ho0itsc4p9)" fill-rule="nonzero" d="
M16.791,3.198
C17.044,3.438 17.067,3.814 16.860,4.080
L16.791,4.156
L12.144,9.331
C11.803,9.711 11.803,10.288 12.144,10.668
L16.791,15.843
C17.044,16.084 17.067,16.460 16.860,16.725
L16.791,16.801
C16.538,17.042 16.142,17.063 15.864,16.867
L15.784,16.801
L10.000,11.250
L4.215,16.801
L4.135,16.867
C3.857,17.063 3.461,17.042 3.208,16.801
L3.208,16.801
L3.139,16.725
C2.932,16.460 2.955,16.084 3.208,15.843
L3.208,15.843
L7.855,10.668
C8.196,10.288 8.196,9.711 7.855,9.331
L7.855,9.331
L3.208,4.156
L3.139,4.080
C2.932,3.814 2.955,3.438 3.208,3.198
C3.486,2.933 3.937,2.933 4.215,3.198
L4.215,3.198 L9.999,8.749
L15.784,3.198
C16.062,2.933 16.513,2.933 16.791,3.198
Z
"></path>
    </svg>
  </div>
</div>
`);function createContents(e){for(var t=1,r=document.getElementsByTagName("meta"),n=0;n<r.length;n++){var o=r[n];if(o.getAttribute("name")==="viewport"){var s=o.getAttribute("content")||"",l=s.match(/initial\-scale\=([\d|\.]+)/);l&&(t=Number(l[1])),isNaN(t)&&(t=1)}}var u=function(c){return Math.floor(c*t)+"px"};return CONTENTS.replace(/\n/g," ").replace(/\ +/g," ").replace(/\$id/g,e).replace(/(\d+)px/g,function(c,h){return u(Number(h))})}function createHelper(){var e="five_vr_helper_"+createUuid(),t=createContents(e),r=document.createElement("div");return r.className=e,r.innerHTML=t,r}var sharedGeometry=new CircleBufferGeometry(.12,16),vertexShader=`
varying vec2 vUv;
#include <common>
#include <logdepthbuf_pars_vertex>
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  #include <logdepthbuf_vertex>
}
`,fragmentShader=`
uniform float circleScale;
uniform float circleFade;
uniform float circleOpacity;
uniform float loadingAngle;
uniform float loadingOpacity;
uniform float opacity;
uniform float disable;
varying vec2 vUv;

#include <common>
#include <logdepthbuf_pars_fragment>
#define SMOOTH_DIST 0.017
#define CENTER vec2(0.5, 0.5)

float inside(float innerDist) {
  float dist = length(CENTER - vUv);
  return smoothstep(innerDist, innerDist + SMOOTH_DIST, dist);
}
float outside(float outerDist) {
  float dist = length(CENTER - vUv);
  return 1.0 - smoothstep(outerDist - SMOOTH_DIST, outerDist, dist);
}

vec4 create_circle() {
  float dist = length(CENTER - vUv);
  float gradient = clamp(0.98 + abs(dot(normalize(vec2(1.0, -1.0)), vUv - CENTER)) * 2.0, 0.0, 1.0);
  vec3 color = mix(vec3(0.576, 0.635, 1.0), vec3(1.0, 1.0, 1.0), circleFade * 0.5);
  return vec4(color, 1.0 * gradient * circleOpacity * outside(0.3 * circleScale));
}

vec4 create_disable() {
  float dist = length(CENTER - vUv);
  return vec4(1.0, 1.0, 1.0, 0.5 * outside(0.32 * circleScale));
}

vec4 create_loading() {
  float angle = PI - atan(CENTER.x - vUv.x, CENTER.y - vUv.y);
  angle = mod(angle + loadingAngle, PI2);
  float gradient = (1.0 - smoothstep(0.0, PI2, angle)) * 0.9 + 0.1;
  return vec4(1.0, 1.0, 1.0, gradient * loadingOpacity * inside(0.2 * circleScale) * outside(0.25 * circleScale));
}

void main() {
  #include <logdepthbuf_fragment>
  gl_FragColor = vec4(1.0, 1.0, 1.0, 0);

  vec4 circleColor = create_circle();
  gl_FragColor = mix(gl_FragColor, circleColor, circleColor.a);

  vec4 loadingColor = create_loading();
  gl_FragColor = mix(gl_FragColor, loadingColor, loadingColor.a);

  gl_FragColor = mix(gl_FragColor, create_disable(), disable);

  gl_FragColor = vec4(gl_FragColor.rgb, gl_FragColor.a * opacity);
}
`,ringVertexShader=`
varying vec2 vUv;
#include <common>
#include <logdepthbuf_pars_vertex>
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  #include <logdepthbuf_vertex>
}
`,ringFragmentShader=`
varying vec2 vUv;
uniform float opacity;
#include <common>
#include <logdepthbuf_pars_fragment>

float smoothDist = 0.01;
void main() {
  #include <logdepthbuf_fragment>
  vec2 center = vec2(0.5, 0.5);
  float dist = length(center - vUv);
  float outerDist = 0.49;
  float innerDist = 0.29;

  float outside = 1.0 - smoothstep(outerDist - smoothDist, outerDist, dist);
  float inside = smoothstep(innerDist, innerDist + smoothDist, dist);

  vec4 bg = vec4(0.576, 0.635, 1.0, 0.3);
  float gradientAlpha = clamp(abs(dist - (outerDist + innerDist) / 2.0) / (outerDist - innerDist) * 1.5 + 0.1, 0.0, 1.0);
  vec4 gradient = vec4(1.0, 1.0, 1.0, gradientAlpha);

  gl_FragColor = mix(bg, gradient, gradient.a);

  gl_FragColor = vec4(gl_FragColor.rgb, gl_FragColor.a * opacity * outside * inside);
}
`,PanoSphereMesh=function(e){__extends(t,e);function t(){var r=e.call(this)||this;r.progress=0,r.opacity=0,r.loading=!1,r.current=!1,r.disabled=!1,r.currentMotion=new Motion({ringScale:1.1,ringOpacity:0,circleFade:0,circleOpacity:.85,circleScale:1}),r.opacityMotion=new Motion({opacity:0}),r.loadingMotion=new Motion({opacity:0}),r.disableMotion=new Motion({opacity:0});var n={blending:CustomBlending,blendSrc:SrcAlphaFactor,blendDst:OneMinusSrcAlphaFactor,blendSrcAlpha:OneFactor,blendDstAlpha:OneMinusSrcAlphaFactor,depthWrite:!1,transparent:!0};return r.hitTestMesh=new Mesh(sharedGeometry,new MeshBasicMaterial(__assign(__assign({},n),{color:0,opacity:0}))),r.hitTestMesh.scale.set(1.5,1.5,1.5),r.ringMesh=new Mesh(sharedGeometry,new ShaderMaterial(__assign(__assign({},n),{vertexShader:ringVertexShader,fragmentShader:ringFragmentShader,uniforms:{opacity:{value:0}}}))),r.panoMesh=new Mesh(sharedGeometry,new ShaderMaterial(__assign(__assign({},n),{vertexShader,fragmentShader,uniforms:{circleScale:{value:1.1},circleFade:{value:0},circleOpacity:{value:.5},loadingAngle:{value:0},loadingOpacity:{value:0},opacity:{value:0},disable:{value:0}}}))),r.add(r.hitTestMesh),r.add(r.ringMesh),r.add(r.panoMesh),r.renderOrder=1e4,r.needsRender=!0,r}return t.prototype.setProgress=function(r){this.progress=r,this.setLoading(r>0)},t.prototype.setOpacity=function(r){this.opacity!==r&&(this.opacity=r=clamp$1(r,0,1),this.opacityMotion.set({opacity:r},30).catch(noop$1))},t.prototype.setCurrent=function(r){if(this.current!==r){if(r){var n=[{progress:0,value:{ringScale:2,ringOpacity:0,circleFade:0,circleOpacity:.85,circleScale:1}},{progress:.05,value:{ringScale:1,ringOpacity:1,circleFade:0,circleOpacity:.85,circleScale:1}},{progress:.15,value:{ringScale:1.2,ringOpacity:1,circleFade:0,circleOpacity:.85,circleScale:1}},{progress:.25,value:{ringScale:1.1,ringOpacity:1,circleFade:0,circleOpacity:.85,circleScale:1}},{progress:.8,value:{ringScale:1.1,ringOpacity:1,circleFade:1,circleOpacity:.85,circleScale:1}},{progress:.9,value:{ringScale:1.1,ringOpacity:1,circleFade:1,circleOpacity:.65,circleScale:.8}},{progress:.92,value:{ringScale:1.1,ringOpacity:1,circleFade:1,circleOpacity:.65,circleScale:.8}},{progress:1,value:{ringScale:1.1,ringOpacity:1,circleFade:1,circleOpacity:.85,circleScale:1.1}}];this.currentMotion.setKeyframes(n,1500).catch(noop$1)}else{var n=[{progress:0,value:__assign({},this.currentMotion.value)},{progress:1,value:{ringScale:1.1,ringOpacity:0,circleFade:0,circleOpacity:.85,circleScale:1}}];this.currentMotion.setKeyframes(n,200).catch(noop$1)}this.current=r}},t.prototype.setLoading=function(r){this.loading!==r&&(r?this.loadingMotion.setKeyframes([{progress:0,value:{opacity:0}},{progress:.3,value:{opacity:0}},{progress:1,value:{opacity:.8}}],500).catch(noop$1):this.loadingMotion.set({opacity:0},0).catch(noop$1),this.loading=r,this.disabled===!0&&this.setDisabled(!1),this.needsRender=!0)},t.prototype.setDisabled=function(r){this.disabled!==r&&(this.disabled=r,this.loading===!0&&this.setLoading(!1),this.disableMotion.set({opacity:r?1:0},300).catch(noop$1),this.needsRender=!0)},t.prototype.tap=function(){return Promise.resolve()},t.prototype.updateTime=function(r,n){this.opacityMotion.update(r),this.currentMotion.update(r),this.loadingMotion.update(r);var o=this.opacityMotion.value.opacity;this.visible=o!==0;var s=this.currentMotion.value,l=s.ringScale,u=s.ringOpacity,c=s.circleFade,h=s.circleOpacity,f=s.circleScale;this.ringMesh.scale.set(l,1,l),this.ringMesh.material.uniforms.opacity.value=u*o,this.panoMesh.material.uniforms.opacity.value=o,this.panoMesh.material.uniforms.circleOpacity.value=h,this.panoMesh.material.uniforms.circleScale.value=f,this.panoMesh.material.uniforms.circleFade.value=c,this.panoMesh.material.uniforms.loadingOpacity.value=this.loadingMotion.value.opacity,this.panoMesh.material.uniforms.disable.value=this.disableMotion.value.opacity,this.panoMesh.material.uniforms.loadingAngle.value=r/120%(Math.PI*2),this.needsRender=!0},t.prototype.dispose=function(){this.hitTestMesh.material.dispose(),this.ringMesh.material.dispose(),this.panoMesh.material.dispose()},t}(Object3D),ACTIVE_TO_CURRENT_DELAY=1500;__assign({},omit(defaultPanoramaControllerCustomInitArgs,["maxLatitude","minLatitude"]));var VRPanoramaController=function(e){__extends(t,e);function t(r){var n=this,o=t.parseArgs(r);n=e.call(this,o)||this,n.mode="VRPanorama",n.cardboard=new Cardboard(n.renderer);var s=createHelper();n.helperElement=s;var l=new Hammer(s);return n.element.parentNode&&(n.element.parentNode.insertBefore(s,n.element),n.setHelperElementSize(),l.on("tap",function(){return n.emit("vr.requestExit",createEvent("vr.requestExit",{}))})),n.destroyHelper=function(){l.destroy(),s.parentNode&&s.parentNode.removeChild(s),delete n.helperElement},n}return t.parseArgs=function(r){if(r instanceof t)return r;var n=__assign(__assign({},r),{maxLatitude:Math.PI/2,minLatitude:-Math.PI/2});return e.parseArgs.call(this,n)},t.initAnimationEndState=function(r){var n=this.parseArgs(r),o=e.initAnimationEndState.call(this,n);return __assign(__assign({},o),{mode:"VRPanorama"})},t.prototype.updateConfiguration=function(r){return e.prototype.updateConfiguration.call(this,__assign(__assign({},r),{maxLatitude:Math.PI/2,minLatitude:-Math.PI/2}))},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.cardboard.dispose(),this.destroyHelper();for(var r=Object.keys(this.panoMeshes),n=0,o=r;n<o.length;n++){var s=o[n],l=this.panoMeshes[s];this.helper.remove(l),l.dispose(),delete this.panoMeshes[s]}},t.prototype.isReady=function(){return!1},t.prototype.updateRenderSize=function(){this.needsRender=!0,this.modelSceneNeedsRender=!0,this.setHelperElementSize()},t.prototype.updateCamera=function(r,n,o){return Promise.resolve()},t.prototype.updateCameraWithKeyframes=function(r,n,o){return Promise.resolve()},t.prototype.updatePanoMeshesVisible=function(){for(var r=this.works.getResolvedObserver(this.currentPano),n=(r?r.visibleIds:[]).concat(panoStringify(this.currentPano)),o=0,s=this.works.resolvedObservers;o<s.length;o++){var l=s[o],u=this.panoMeshes[l.panoId];u&&(n.indexOf(l.panoId)>=0?u.parent!==this.helper&&this.helper.add(u):u.parent===this.helper&&(this.helper.remove(u),u.setOpacity(0)))}},t.prototype.updatePanoMeshes=function(){for(var r=Object.keys(this.panoMeshes),n=0,o=r;n<o.length;n++){var s=o[n],l=this.panoMeshes[s];this.helper.remove(l),l.dispose(),delete this.panoMeshes[s]}for(var u=0,c=this.works.resolvedObservers;u<c.length;u++){var h=c[u],f=h.panoId,m=new PanoSphereMesh;m.name="panoSphere_".concat(f),m.position.copy(h.position),m.needsRender=!0,this.panoMeshes[f]=m}this.updatePanoMeshesVisible()},t.prototype.updateTime=function(r,n){var o=this,s,l,u,c,h,f,m,y,A,M;if(!this.destroyed){var b=this.currentPano;this.userAction=!0,this.needsRender=!0,this.modelSceneNeedsRender=!0;var T={},_={},S=this.panoResourceFromLocationMotionKeyframe(this.locationMotion.keyframes[0]),C=this.panoResourceFromLocationMotionKeyframe(this.locationMotion.keyframes[this.locationMotion.keyframes.length-1]),P=!1;if(this.modelAlphaMotion.ended===!1&&(this.modelAlphaMotion.update(r),T.modelAlpha=this.modelAlphaMotion.value.modelAlpha),this.perspToOrthoMotion.ended===!1&&(this.perspToOrthoMotion.update(r),this.camera.perspToOrtho.setScalar(clamp$1(this.perspToOrthoMotion.value.perspToOrtho,0,1))),this.locationMotion.ended===!1){this.locationMotion.update(r);var F=this.locationMotion.getKeyFrameSegment(r),O=F[0],N=F[1],V=this.panoResourceFromLocationMotionKeyframe(O),q=this.panoResourceFromLocationMotionKeyframe(N),Q=V.position,z=q.position,H=this.locationMotion.value.count-N.value.count+1;T.progress=H,q.panoPicture&&(H<1?V.panoPicture&&(T.pano0=V.panoPicture):T.pano0=q.panoPicture,T.pano1=q.panoPicture),q.effect==="montage"?T.transition="BLACK":q.effect==="spread"?T.transition="SPREAD":T.transition="FADE",(q.effect==="zoomin"||q.effect==="zoomout")&&(T.progress=Math.pow(H,3)),H<1&&q.effect!=="fly"&&(T.pano0&&V.panoPicture&&(T.pano0={map:T.pano0.map,zoom:T.pano0.zoom,luminanceMap:T.pano0.luminanceMap,matrix:V.panoPicture.matrix.clone().premultiply(V.fixCameraTransform).setPosition(q.position)}),Q.copy(z),P=!0),_.distance=this.locationMotion.value.distance,_.offset=new Vector3(Q.x+(z.x-Q.x)*H,Q.y+(z.y-Q.y)*H,Q.z+(z.z-Q.z)*H);for(var W=[],J=[],G=0,te=this.locationMotion.keyframes;G<te.length;G++){var X=te[G],K=X.key,Z=X.progress;K!==void 0&&(W.push(K),Z>this.locationMotion.progress&&J.push(K))}for(var ee=0,j=Object.keys(this.panoResources);ee<j.length;ee++){var re=j[ee];if(!(J.indexOf(re)>=0)){var pe=this.panoResources[re];if(pe.panoPicture){var ge=pe.panoPicture.map,_e=pe.panoPicture.luminanceMap;if(ge){if(ge===((s=T.pano0)===null||s===void 0?void 0:s.map)||ge===((l=T.pano1)===null||l===void 0?void 0:l.map))continue;ge instanceof TileCubeTextureTarget&&ge.cubeRenderTarget&&this.colorCubeRenderTargetPool.push(ge.cubeRenderTarget),ge.dispose(),_e&&(_e instanceof TileCubeTextureTarget&&_e.cubeRenderTarget&&this.luminanceCubeRenderTargetPool.push(_e.cubeRenderTarget),_e.dispose()),pe.panoPicture=null}}W.indexOf(re)>=0||delete this.panoResources[re]}}this.currentPano=panoParse(q.panoId),this.emit("pano.moving",createEvent("pano.moving",{userAction:this.userAction,prevPano:panoParse(S.panoId),state:__assign(__assign(__assign(__assign({},panoParse(C.panoId)),{mode:this.mode}),clonePose(this.camera.pose)),_),options:{},progress:this.locationMotion.progress,error:null}))}isEmptyObject(T)===!1&&(!((u=T.pano0)===null||u===void 0)&&u.map&&T.pano0.map instanceof TileCubeTextureTarget&&!T.pano0.map.cubeRenderTarget&&(T.pano0.map.cubeRenderTarget=this.colorCubeRenderTargetPool.pop()),!((c=T.pano0)===null||c===void 0)&&c.luminanceMap&&T.pano0.luminanceMap instanceof TileCubeTextureTarget&&!T.pano0.luminanceMap.cubeRenderTarget&&(T.pano0.luminanceMap.cubeRenderTarget=this.luminanceCubeRenderTargetPool.pop()),!((h=T.pano1)===null||h===void 0)&&h.map&&T.pano1.map instanceof TileCubeTextureTarget&&!T.pano1.map.cubeRenderTarget&&(T.pano1.map.cubeRenderTarget=this.colorCubeRenderTargetPool.pop()),!((f=T.pano1)===null||f===void 0)&&f.luminanceMap&&T.pano1.luminanceMap instanceof TileCubeTextureTarget&&!T.pano1.luminanceMap.cubeRenderTarget&&(T.pano1.luminanceMap.cubeRenderTarget=this.luminanceCubeRenderTargetPool.pop()),this.models.setMaterial(T)),_.offset&&this.camera.position.copy(_.offset),panoEqual(this.currentPano,b)&&this.updatePanoMeshesVisible();var he=this.camera.pose.longitude,Fe=this.camera.pose.latitude;this.camera.quaternion.fromArray(this.cardboard.sensor.getOrientation()),this.camera.computePose();var Re=this.works.getResolvedObserver(this.currentPano);if(this.camera.pose.distance>.1||P)for(var Le=0,Se=Object.keys(this.panoMeshes);Le<Se.length;Le++){var we=Se[Le],Ve=this.panoMeshes[we];Ve.setOpacity(0),Ve.updateTime&&Ve.updateTime(r,n),Ve.visible=!1}else if(Re)for(var je=Re.visibleIds.concat(panoStringify(this.currentPano)),st=0,We=je;st<We.length;st++){var we=We[st],bt=panoParse(we),oe=this.works.getResolvedObserver(bt);if(oe){var Ve=this.panoMeshes[we];if(!oe.loadable&&!oe.active){Ve.setOpacity(0);continue}var ue=Ve.position.clone().setY(this.camera.position.y).distanceTo(this.camera.position);ue<.05?Ve.setOpacity(0):Ve.setOpacity(clamp$1(1.5/ue,0,1)),panoEqual(this.currentPano,bt)&&Ve.setOpacity(0),Ve.lookAt(this.camera.position)}}if(this.locationMotion.ended)for(var Qe=this.intersect(r),Me=0,De=this.works.resolvedObservers;Me<De.length;Me++){var oe=De[Me],Ve=this.panoMeshes[oe.panoId];Ve&&(Ve.setCurrent(Ve===Qe),Ve.updateTime&&Ve.updateTime(r,n))}(he!==this.camera.pose.longitude||Fe!==this.camera.pose.latitude)&&(this.cameraMotion.set(pick(this.camera.pose,["longitude","latitude"]),0).catch(noop$1),this.emit("camera.update",createEvent("camera.update",{userAction:!0,state:__assign(__assign(__assign({},this.currentPano),{mode:this.mode}),clonePose(this.camera.pose))})));var be=this.tileLevel=function(){if(o.tileLevelForFov===!1)return 0;var Ue=o.renderer.getDrawingBufferSize(new Vector2);Ue.width*=o.scissor.width,Ue.height*=o.scissor.height;var He=C.panoId,qe=o.works.getResolvedObserver(He),ke=o.imageOptions.size;if(typeof ke>"u"&&qe){var ve=qe.images.up.match(/\/cube_(\d+)\//);ve&&(ke=Number(ve[1]))}typeof ke>"u"&&(ke=2048);var Ye=0;ke>=1024&&(Ye=1),ke>=2048&&(Ye=2),ke>=4096&&(Ye=3),ke>=8192&&(Ye=4);var tt=o.tileLevelForFov(o.camera.fov,Ue);return tt>Ye?tt:0}(),ze=function(){var Ue=o.camera.quaternion.clone(),He=o.works.getResolvedObserver(C.panoId),qe=He??Re;qe&&Ue.premultiply(qe.quaternion.clone().inverse());var ke=new Matrix4().makeRotationFromQuaternion(Ue),ve=new Matrix4().getInverse(ke),Ye=new Frustum().setFromProjectionMatrix(new Matrix4().multiplyMatrices(o.camera.projectionMatrix,ve));return Ye}();C.panoId===panoStringify(this.currentPano)&&(((m=C.panoPicture)===null||m===void 0?void 0:m.map)instanceof TileCubeTextureTarget&&(C.panoPicture.map.maxRequest=this.tileMaxRequest,C.panoPicture.map.update(ze,be),C.panoPicture.map.needsRender===!0&&(C.panoPicture.map.needsRender=!1,this.needsRender=!0,this.modelSceneNeedsRender=!0)),((y=C.panoPicture)===null||y===void 0?void 0:y.luminanceMap)instanceof TileCubeTextureTarget&&(C.panoPicture.luminanceMap.maxRequest=this.tileMaxRequest,C.panoPicture.luminanceMap.update(ze,be),C.panoPicture.luminanceMap.needsRender===!0&&(C.panoPicture.luminanceMap.needsRender=!1,this.needsRender=!0,this.modelSceneNeedsRender=!0)));{var at=this.tiling.object.visible;if(this.initAnimationed){var ot=C.panoId,nt=this.works.getResolvedObserver(ot);nt?isSimilarVector3(this.camera.position,nt.position)&&this.locationMotion.ended?(this.tiling.object.visible=!0,this.tiling.panoId!==ot&&this.tiling.cleanup(),this.tiling.panoId=ot,this.tiling.setResource((M=(A=nt.images)===null||A===void 0?void 0:A.tiles)!==null&&M!==void 0?M:[],this.enableIOSEDR&&nt.images.luminance?nt.images.luminance:null),this.tiling.setFetcher(getFetcher(nt.work)),this.tiling.setRotation(nt.quaternion),this.tiling.setPosition(nt.position),this.tiling.maxRequest=this.tileMaxRequest,be>this.tiledCubeTextureLevel?this.tiling.update(ze,be,r):this.tiling.update(ze,0,r)):this.tiling.object.visible=!1:this.tiling.object.visible=!1}else this.tiling.object.visible=!1;at!==this.tiling.object.visible&&(this.tiling.object.needsRender=!0,this.modelSceneNeedsRender=!0)}this.panoVideo.object.position.copy(this.camera.position),this.panoVideo.updateTime(r)}},t.prototype.render=function(){this.cardboard.render(this.modelScene,this.camera),this.renderer.autoClear=!1,this.cardboard.render(this.scene,this.camera),this.renderer.autoClear=!0},t.prototype.setCamera=function(r){},t.prototype.destroyHelper=function(){},t.prototype.setHelperElementSize=function(){if(this.helperElement){var r=new Vector2(this.element.offsetWidth,this.element.offsetHeight),n=r.x*this.scissor.left,o=r.y*(1-this.scissor.bottom-this.scissor.height),s=r.x*this.scissor.width,l=r.y*this.scissor.height;this.helperElement.style.marginLeft=n+"px",this.helperElement.style.marginTop=o+"px",this.helperElement.style.width=s+"px",this.helperElement.style.height=l+"px"}},t.prototype.intersect=function(r){var n,o;if(this.locationMotion.ended===!1){this.intersectMesh.visible=!1,delete this.activePanoMesh,delete this.activeTime;return}if(this.activePanoMesh&&this.activeTime&&r-this.activeTime>ACTIVE_TO_CURRENT_DELAY){for(var s=this.activePanoMesh,l=Object.keys(this.panoMeshes),u=null,c=0,h=l;c<h.length;c++){var f=h[c];if(this.panoMeshes[f]===s){u=f;break}}return u!==null&&this.moveToPano(panoParse(u),{},!0),delete this.activePanoMesh,delete this.activeTime,s}var m=this.camera.getDirection(new Vector3),y=new Raycaster(this.camera.position,m);y.params.Points={threshold:.1};for(var A=void 0,M=[],b=this.works.getResolvedObserver(this.currentPano),T=b?b.visibleIds:[],_=0,S=T;_<S.length;_++){var u=S[_],C=this.panoMeshes[u],P=y.intersectObject((n=C.hitTestMesh)!==null&&n!==void 0?n:C,!0)[0];P&&M.push({panoMesh:C,intersection:__assign({floor:(o=b==null?void 0:b.floorIndex)!==null&&o!==void 0?o:0},P)})}var F=M.sort(function(Q,z){return Q.intersection.distance-z.intersection.distance})[0];F?(A=F.intersection,this.activePanoMesh!==F.panoMesh&&(this.activePanoMesh=F.panoMesh,this.activeTime=r),this.intersectMesh.position.copy(F.panoMesh.position),this.intersectMesh.lookAt(this.camera.position)):(this.activePanoMesh=void 0,this.activeTime=void 0),A||(A=this.models.intersectRaycaster(y)[0]);var O=createEvent("intersect.update",{raycaster:y,intersection:A??null,object:this.intersectMesh});if(this.emit("intersect.update",O),O.defaultPrevented){this.hideIntersectMesh();return}if(A&&A.face){var N=A.face.normal,V=new Quaternion;V.setFromUnitVectors(new Vector3(0,0,1),N),this.intersectMesh.quaternion.copy(V);var q=A.point.clone();this.intersectMesh.position.copy(q),F?this.intersectMesh.visible=!1:this.intersectMesh.visible=!0}else this.intersectMesh.visible=!1;return F==null?void 0:F.panoMesh},t.prototype.onPanGesture=function(){},t.prototype.onTapGesture=function(){},t.prototype.onPinchGesture=function(){},t.prototype.onMouseMove=function(){},t.prototype.onMouseOut=function(){},t}(PanoramaController),HUMAN_EYE_POSITION=new Vector3(0,1.6,0);__assign({},defaultPanoramaLikeControllerCustomInitArgs);var ModelController=function(e){__extends(t,e);function t(r){var n=this,o,s=t.parseArgs(r);return n=e.call(this,s)||this,n.mode="Model",n.locationMotion=new Motion({x:n.camera.pose.offset.x,y:n.camera.pose.offset.y,z:n.camera.pose.offset.z,distance:n.camera.pose.distance}),n.modelAlphaMotion=new Motion({modelAlpha:(o=n.models.getMaterial().modelAlpha)!==null&&o!==void 0?o:0}),n.perspToOrthoMotion=new Motion({perspToOrtho:n.camera.perspToOrtho.x}),n}return t.parseArgs=function(r){return r instanceof t?r:e.parseArgs.call(this,r)},t.initAnimationEndState=function(r){var n,o,s,l,u,c,h=this.parseArgs(r),f=h.works,m=r.initial,y=m.state,A=m.currentState,M=typeof y.panoIndex=="number"?{workCode:(s=(n=y.workCode)!==null&&n!==void 0?n:(o=h.works[0])===null||o===void 0?void 0:o.workCode)!==null&&s!==void 0?s:"",panoIndex:y.panoIndex}:{workCode:A.workCode,panoIndex:A.panoIndex},b=f.getResolvedObserver(M),T=(l=y.longitude)!==null&&l!==void 0?l:A.longitude,_=clamp$1((u=y.latitude)!==null&&u!==void 0?u:!b||isFristPersonMode(A.mode)?A.latitude:h.defaultLatitude,h.minLatitude,h.maxLatitude),S=clamp$1((c=y.fov)!==null&&c!==void 0?c:!b||isFristPersonMode(A.mode)?A.fov:h.defaultFov,h.minFov,h.maxFov),C=new Vector3;if(h.initial.state.offset)C.copy(h.initial.state.offset);else if(b)C.copy(b.position);else{var P=coordinatesToVector(A).setLength(A.distance);C.copy(h.initial.currentState.offset).sub(P)}return{workCode:M.workCode,panoIndex:M.panoIndex,mode:"Model",longitude:T,latitude:_,fov:S,offset:C,distance:0}},t.prototype.updateConfiguration=function(r){return e.prototype.updateConfiguration.call(this,r)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.locationMotion.dispose()},t.prototype.isReady=function(){return this.locationMotion.ended===!1?!1:e.prototype.isReady.call(this)},t.prototype.updateWork=function(r,n,o,s){this.works=r;var l=t.initAnimationEndState(__assign(__assign({},this),{initial:{currentState:__assign(__assign({},this.currentPano),this.camera.pose),duration:o.duration,effect:o.effect,state:n,userAction:s}}));return this.hideIntersectMesh(),this.moveToPosition(l.offset,{duration:0,longitude:l.longitude,latitude:l.latitude,fov:l.fov},s),!0},t.prototype.updateCamera=function(r,n,o){var s=this;return this.initAnimationReady.then(function(){s.userAction=o,s.stopMomentumMovement();var l={},u={};return l.distance=0,r.offset!==void 0&&(l.x=r.offset.x,l.y=r.offset.y,l.z=r.offset.z),r.longitude!==void 0&&(u.longitude=r.longitude),r.latitude!==void 0&&(u.latitude=r.latitude),r.fov!==void 0&&(u.fov=r.fov),s.locationMotion.set(l,n).catch(noop$1),s.cameraMotion.set(u,n).catch(noop$1)})},t.prototype.updateCameraWithKeyframes=function(r,n,o){var s=this;return this.initAnimationReady.then(function(){s.userAction=o,s.stopMomentumMovement();for(var l=[],u=[],c=0,h=r;c<h.length;c++){var f=h[c];l.push({key:f.key,progress:f.progress,value:{distance:0,x:f.value.offset.x,y:f.value.offset.x,z:f.value.offset.x}}),u.push({key:f.key,progress:f.progress,value:{longitude:f.value.longitude,latitude:f.value.latitude,fov:f.value.fov}})}return s.locationMotion.setKeyframes(l,n).catch(noop$1),s.cameraMotion.setKeyframes(r,n)})},t.prototype.updateTime=function(r,n){if(!this.destroyed){var o={},s={};if(this.modelAlphaMotion.ended||(this.modelAlphaMotion.update(r),o.modelAlpha=this.modelAlphaMotion.value.modelAlpha),this.perspToOrthoMotion.ended||(this.perspToOrthoMotion.update(r),this.camera.perspToOrtho.setScalar(clamp$1(this.perspToOrthoMotion.value.perspToOrtho,0,1))),!this.locationMotion.ended){this.locationMotion.update(r),s.distance=this.locationMotion.value.distance,s.offset=new Vector3(this.locationMotion.value.x,this.locationMotion.value.y,this.locationMotion.value.z);var l=new Vector3(this.locationMotion.value.x,this.locationMotion.value.y,this.locationMotion.value.z),u=this.works.resolvedObservers,c=arrayMin(u,function(h){return h.position.distanceTo(l)});this.currentPano=c?{workCode:c.work.workCode,panoIndex:c.panoIndex}:{workCode:"",panoIndex:0}}this.cameraMotion.ended||(this.cameraMotion.update(r),s.longitude=this.cameraMotion.value.longitude,s.latitude=this.cameraMotion.value.latitude,s.fov=this.cameraMotion.value.fov),isEmptyObject(o)||this.models.setMaterial(o),isEmptyObject(s)||this.setCamera(s)}},t.prototype.initAnimation=function(){var r=this;return this.destroyed?Promise.resolve():new Promise(function(n){var o=r.initial;o.state,o.currentState;var s=o.duration,l=o.userAction;r.userAction=l;var u=t.initAnimationEndState(r),c={modelAlpha:1},h={perspToOrtho:0},f={longitude:u.longitude,latitude:u.latitude,fov:u.fov,duration:s,moveStartCallback:function(m){r.perspToOrthoMotion.set(h,s).catch(noop$1),r.modelAlphaMotion.set(c,s).catch(noop$1),r.emit("initAnimation.start",createEvent("initAnimation.start",{state:m,userAction:r.userAction}))},moveEndCallback:function(m){r.emit("initAnimation.end",createEvent("initAnimation.end",{state:m,userAction:r.userAction})),n()},moveCancelCallback:function(){var m=r.currentPano,y=__assign(__assign({},m),{mode:r.mode,longitude:r.camera.pose.longitude,latitude:r.camera.pose.latitude,fov:r.camera.pose.fov,offset:r.camera.pose.offset.clone(),distance:r.camera.pose.distance});r.emit("initAnimation.end",createEvent("initAnimation.end",{state:y,userAction:r.userAction})),n()}};r.moveToPosition(u.offset,f,l)})},t.prototype.getTargetState=function(){var r=this.cameraMotion.getKeyFrameSegment(now())[1],n=this.locationMotion.getKeyFrameSegment(now())[1];return __assign(__assign({},this.currentPano),{mode:this.mode,longitude:r.value.longitude,latitude:r.value.latitude,fov:r.value.fov,offset:new Vector3(n.value.x,n.value.y,n.value.z),distance:n.value.distance})},t.prototype.moveToPano=function(r,n,o){n===void 0&&(n={});var s=this.works.getResolvedObserver(r);s&&this.moveToPosition(s.position,n,o)},t.prototype.moveToPosition=function(r,n,o){var s=this,l,u,c;n===void 0&&(n={}),this.userAction=o,this.stopMomentumMovement();for(var h=now(),f=new Vector3(this.locationMotion.value.x,this.locationMotion.value.y,this.locationMotion.value.z),m=f.distanceTo(r),y=this.locationMotion.getProgressVelocity(h),A=0,M=1;M<this.locationMotion.keyframes.length;M++){var b=this.locationMotion.keyframes[M-1].value,T=b.x,_=b.y,S=b.z,C=this.locationMotion.keyframes[M].value,P=C.x,F=C.y,O=C.z;A+=Math.sqrt(Math.pow(P-T,2)+Math.pow(F-_,2)+Math.pow(O-S,2))}var N=m===0?0:y*A/m,V=this.calculateMovingDuration(n.duration,m),q={x:r.x,y:r.y,z:r.z,distance:0},Q={longitude:n.longitude,latitude:n.latitude,fov:n.fov},z=this.works.resolvedObservers,H=arrayMin(z,function(te){return te.position.distanceTo(f)}),W=H?{workCode:H.work.workCode,panoIndex:H.panoIndex}:{workCode:"",panoIndex:0},J=__assign(__assign({},W),{mode:this.mode,longitude:(l=Q.longitude)!==null&&l!==void 0?l:this.camera.pose.longitude,latitude:(u=Q.latitude)!==null&&u!==void 0?u:this.camera.pose.latitude,fov:(c=Q.fov)!==null&&c!==void 0?c:this.camera.pose.fov,offset:r.clone(),distance:0}),G=this.currentPano;this.emit("pano.moveTo",createEvent("pano.moveTo",{options:n,prevPano:G,progress:0,state:J,userAction:this.userAction,error:null})),n.moveStartCallback&&n.moveStartCallback(J),this.cameraMotion.set(Q,V).catch(noop$1),this.locationMotion.set(q,V,N).then(function(){for(var te=0,X=s.models;te<X.length;te++){var K=X[te];K.show()}var Z=__assign(__assign(__assign({},W),{mode:s.mode}),clonePose(s.camera.pose));s.emit("pano.arrived",createEvent("pano.arrived",{options:n,prevPano:G,progress:0,state:Z,userAction:s.userAction,error:null})),n.moveEndCallback&&n.moveEndCallback(Z)},function(){n.moveCancelCallback&&n.moveCancelCallback(),s.emit("pano.cancel",createEvent("pano.cancel",{options:n,prevPano:G,progress:0,state:J,userAction:s.userAction,error:null}))})},t.prototype.onTapGesture=function(r){var n=r.center.raycaster;this.stopMomentumMovement();var o=this.models.intersectRaycaster(n)[0];if(o&&o.face){var s=o.face.normal,l=o.point;if(new Vector3(0,1,0).angleTo(s)>Math.PI/3){var u=s.clone().setLength(.3).add(l);n.set(u,new Vector3(0,-1,0)),o=this.models.intersectRaycaster(n)[0]}}if(o){var c=new Vector3().copy(o.point).add(HUMAN_EYE_POSITION),h=this.works.resolvedObservers,f=arrayMin(h,function(A){return A.position.distanceTo(c)},!0),m=f[0],y=f[1];m&&y<5&&(c.y=m.position.y),r.state.offset.copy(c),r.state.distance=0,this.emit("gesture.tap",r),r.defaultPrevented||this.moveToPosition(c,{},!0)}else this.emit("gesture.tap",r),r.defaultPrevented||this.cameraBounce()},t}(PanoramaLikeController);const edlVertexShader=function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=113,o=126,s=0,l="";return t[s].split(l).map(function(u){return u.charCodeAt(s)>o?u:String.fromCharCode((u.charCodeAt(s)+n)%o)}).join(l)}(`}rpvv|{-zrqvz}-sy|nH}rpvv|{-zrqvz}-v{Hnvor-rp@-}|vv|{Hnvor-rp?-H{vs|z-znA-}|wrpv|{Znv\x07H{vs|z-znA-z|qrycvrZnv\x07Hn\bv{t-rp?-bH|vq-znv{56-
b-J-HrpA-z]|vv|{-J-z|qrycvrZnv\x07-7-rpA5}|vv|{9>;=6Htyl]|vv|{-J-}|wrpv|{Znv\x07-7-z]|vv|{H\f`),edlFragmentShader=function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=113,o=126,s=0,l="";return t[s].split(l).map(function(u){return u.charCodeAt(s)>o?u:String.fromCharCode((u.charCodeAt(s)+n)%o)}).join(l)}(`0r\x07r{v|{-TYlRealsntlqr}u-G-r{noyr<<<<-nqn}rq-s|z-ur-RQY-unqr-p|qr-s|z-Puvvn{-O|pur{\b-v{-py|q-p|z}nrG<<-u}G<<tvuo;p|z<py|qp|z}nr<{x<rr<znr<}ytv{<\0RQY<unqr<RQY<<}rpvv|{-zrqvz}-sy|nH}rpvv|{-zrqvz}-v{H{vs|z-sy|n-prr{dvquH{vs|z-sy|n-prr{UrvtuH{vs|z-rp?-{rvtuo|h[RVTUO\\b_lP\\b[ajH{vs|z-sy|n-rqy\`r{tuH{vs|z-sy|n-nqvH{vs|z-sy|n-|}npv\bH{vs|z-sy|n-[rnH{vs|z-sy|n-SnH{vs|z-znA-]|wH{vs|z-nz}yr?Q-RQYP|y|Hn\bv{t-rp?-bHsy|n-r}|{r5sy|n-qr}u6
--rp?-_nqv-J-nqv-<-rp?5prr{dvqu9-prr{Urvtu6H--sy|n-z-J-=;=H--s|5v{-v-J-=H-v-I-[RVTUO\\b_lP\\b[aH-v886
----rp?-[rvtuo|-J-b-8-_nqv-7-{rvtuo|hvjH----sy|n-{rvtuo|Qr}u-J-r\x07r?Q5RQYP|y|9-[rvtuo|6;nH----{rvtuo|Qr}u-J-5{rvtuo|Qr}u-JJ->;=6-L-=;=-G-{rvtuo|Qr}uH----vs5{rvtuo|Qr}u-.J-=;=6
------vs5qr}u-JJ-=;=6
--------z-8J->==;=H------\fryr
--------z-8J-zn\x075=;=9-qr}u-:-{rvtuo|Qr}u6H------\f----\f--\f--r{-z-<-sy|n5[RVTUO\\b_lP\\b[a6H\f|vq-znv{56
--rpA-pRQY-J-r\x07r?Q5RQYP|y|9-b6H--sy|n-qr}u-J-pRQY;nH--qr}u-J-5qr}u-JJ->;=6-L-=;=-G-qr}uH--sy|n-r-J-r}|{r5qr}u6H--sy|n-unqr-J-r\x07}5:r-7-@==;=-7-rqy\`r{tu6H--tylSntP|y|-J-rpA5pRQY;to-7-unqr9-|}npv\b6H--
-<<-vr-rtyn-u\b}ro|yvp-qr}u-nyr-|-qr}u-ossr----sy|n-qy-J-}|5?;=9-qr}u6H----rpA-q}-J-]|w-7-rpA5=;=9-=;=9-:qy9->;=6H----sy|n-}	-J-q};	-<-q};H----sy|n-sntQr}u-J-5}	-8->;=6-<-?;=H----<<-tylSntQr}uRea-J-sntQr}uH--\f--vs5qr}u-JJ-=;=6
----qvpnqH--\f\f`);var EDLMaterial=function(e){__extends(t,e);function t(r){var n=e.call(this)||this;return n.uniforms={screenWidth:makeUniform$1("f",0),screenHeight:makeUniform$1("f",0),edlStrength:makeUniform$1("f",1),uNear:makeUniform$1("f",1),uFar:makeUniform$1("f",1),radius:makeUniform$1("f",1),neighbours:makeUniform$1("2fv",new Float32Array),depthMap:makeUniform$1("t",new Texture),uEDLColor:makeUniform$1("t",new Texture),uEDLDepth:makeUniform$1("t",new Texture),opacity:makeUniform$1("f",1),uProj:makeUniform$1("Matrix4fv",new Float32Array)},n.neighbourCount=8,n.updateShaderSource(),n.transparent=!0,n}return t.prototype.getUniform=function(r){return this.uniforms===void 0?void 0:this.uniforms[r].value},t.prototype.setUniform=function(r,n){if(this.uniforms!==void 0){var o=this.uniforms[r];o.value=n}},t.prototype.getDefines=function(){var r="";return r+="#define NEIGHBOUR_COUNT "+this.neighbourCount+`
`,r},t.prototype.updateShaderSource=function(){var r=this.getDefines()+edlVertexShader,n=this.getDefines()+edlFragmentShader;this.setValues({vertexShader:r,fragmentShader:n}),this.needsUpdate=!0},__decorate([uniform$1("screenWidth"),__metadata("design:type",Number)],t.prototype,"screenWidth",void 0),__decorate([uniform$1("screenHeight"),__metadata("design:type",Number)],t.prototype,"screenHeight",void 0),__decorate([uniform$1("edlStrength"),__metadata("design:type",Number)],t.prototype,"edlStrength",void 0),__decorate([uniform$1("uNear"),__metadata("design:type",Number)],t.prototype,"uNear",void 0),__decorate([uniform$1("uFar"),__metadata("design:type",Number)],t.prototype,"uFar",void 0),__decorate([uniform$1("radius"),__metadata("design:type",Number)],t.prototype,"radius",void 0),__decorate([uniform$1("neighbours",!0),__metadata("design:type",Float32Array)],t.prototype,"neighbours",void 0),__decorate([uniform$1("depthMap"),__metadata("design:type",Texture)],t.prototype,"depthMap",void 0),__decorate([uniform$1("uEDLColor"),__metadata("design:type",Texture)],t.prototype,"uEDLColor",void 0),__decorate([uniform$1("uEDLDepth"),__metadata("design:type",Texture)],t.prototype,"uEDLDepth",void 0),__decorate([uniform$1("uProj"),__metadata("design:type",Array)],t.prototype,"uProj",void 0),t}(RawShaderMaterial);function makeUniform$1(e,t){return{type:e,value:t}}function uniform$1(e,t){return t===void 0&&(t=!1),function(r,n){Object.defineProperty(r,n,{get:function(){return this.getUniform(e)},set:function(o){o!==this.getUniform(e)&&(this.setUniform(e,o),t&&this.updateShaderSource())}})}}var passCamera$1=new OrthographicCamera(-1,1,1,-1,0,1),geometry$2=new BufferGeometry;geometry$2.setAttribute("position",new Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3));geometry$2.setAttribute("uv",new Float32BufferAttribute([0,2,0,0,2,0],2));var mesh$2=new Mesh(geometry$2),edlEffectScene=new Scene$1;edlEffectScene.add(mesh$2);var EDLEffect=function(e){__extends(t,e);function t(r,n,o,s){var l=e.call(this,r,n,o,s)||this;return l.sharedV2=new Vector2,l.renderer=r,l.material=new EDLMaterial,mesh$2.material=l.material,l.material.needsUpdate=!0,l}return t.prototype.render=function(r){this.renderer.autoClearColor=!0,this.renderer.autoClearDepth=!0,this.renderer.setRenderTarget(r[0]),this.renderer.render(this.scene,this.camera);var n=this.camera,o=this.material.uniforms,s=this.renderer.getSize(this.sharedV2);o.screenWidth.value=s.x,o.screenHeight.value=s.y;var l=n.projectionMatrix,u=new Float32Array(16);u.set(l.elements);for(var c=new Float32Array(this.material.neighbourCount*2),h=0;h<this.material.neighbourCount;h++)c[2*h+0]=Math.cos(2*h*Math.PI/this.material.neighbourCount),c[2*h+1]=Math.sin(2*h*Math.PI/this.material.neighbourCount);o.neighbours.value=c,o.uNear.value=n.near,o.uFar.value=n.far,o.uEDLColor.value=r[0].texture,o.uProj.value=u,o.edlStrength.value=.5,o.radius.value=1,o.opacity.value=1,this.renderer.setRenderTarget(r[1]),this.renderer.render(edlEffectScene,passCamera$1)},t.prototype.dispose=function(){this.copyPass.dispose()},t}(Effect);const fragment=function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=113,o=126,s=0,l="";return t[s].split(l).map(function(u){return u.charCodeAt(s)>o?u:String.fromCharCode((u.charCodeAt(s)+n)%o)}).join(l)}(`}rpvv|{-zrqvz}-sy|nH}rpvv|{-zrqvz}-v{H{vs|z-nz}yr?Q-drvtuZn}H{vs|z-nz}yr?Q-Qr}uZn}Hn\bv{t-rp?-bH|vq-znv{56-
sy|n-qr}u-J-r\x07r?Q5Qr}uZn}9-b6;Hvs5qr}u-KJ->;=6
qvpnqH\frpA-p|y|-J-r\x07r?Q5drvtuZn}9-b6H-p|y|-J-p|y|-<-p|y|;HtylSntP|y|-J-rpA5p|y|;\x07\b	9->;=6H-\f`),vertex=function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=113,o=126,s=0,l="";return t[s].split(l).map(function(u){return u.charCodeAt(s)>o?u:String.fromCharCode((u.charCodeAt(s)+n)%o)}).join(l)}(`}rpvv|{-zrqvz}-sy|nH}rpvv|{-zrqvz}-v{Hnvor-rp@-}|vv|{Hnvor-rp?-H{vs|z-znA-}|wrpv|{Znv\x07H{vs|z-znA-z|qrycvrZnv\x07Hn\bv{t-rp?-bH|vq-znv{56-
b-J-Htyl]|vv|{-J-}|wrpv|{Znv\x07-7-z|qrycvrZnv\x07-7-rpA5}|vv|{9>;=6H\f`);var HQMaterial=function(e){__extends(t,e);function t(r){var n=e.call(this,{vertexShader:vertex,fragmentShader:fragment})||this;return n.uniforms={uDepthMap:makeUniform("t",null),uWeightMap:makeUniform("t",null)},n.depthTest=!0,n.depthWrite=!0,n.opacity=1,n}return t.prototype.getUniform=function(r){return this.uniforms===void 0?void 0:this.uniforms[r].value},t.prototype.setUniform=function(r,n){if(this.uniforms!==void 0){var o=this.uniforms[r];o.value=n}},__decorate([uniform("uDepthMap"),__metadata("design:type",Number)],t.prototype,"uDepthMap",void 0),__decorate([uniform("uWeightMap"),__metadata("design:type",Number)],t.prototype,"uWeightMap",void 0),t}(RawShaderMaterial);function makeUniform(e,t){return{type:e,value:t}}function uniform(e,t){return t===void 0&&(t=!1),function(r,n){Object.defineProperty(r,n,{get:function(){return this.getUniform(e)},set:function(o){o!==this.getUniform(e)&&(this.setUniform(e,o),t&&this.updateShaderSource())}})}}var passCamera=new OrthographicCamera(-1,1,1,-1,0,1),geometry$1=new BufferGeometry;geometry$1.setAttribute("position",new Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3));geometry$1.setAttribute("uv",new Float32BufferAttribute([0,2,0,0,2,0],2));var mesh$1=new Mesh(geometry$1),hqScene=new Scene$1;hqScene.add(mesh$1);var HQEffect=function(e){__extends(t,e);function t(r,n,o,s){var l=e.call(this,r,n,o,s)||this;return l.sharedV2=new Vector2,l.renderer=r,l.material=new HQMaterial,l.camera=o,mesh$1.material=l.material,l}return t.prototype.render=function(r){this.models.setMaterial({useHQDepth:!0,useHQWeight:!1}),this.models.update(this.renderer,this.camera,"Mapview"),this.renderer.autoClearColor=!0,this.renderer.autoClearDepth=!0,this.renderer.setRenderTarget(r[0]),this.renderer.render(this.scene,this.camera),this.models.setMaterial({useHQWeight:!0,useHQDepth:!1}),this.models.update(this.renderer,this.camera,"Mapview"),this.renderer.autoClearDepth=!1,this.renderer.autoClearColor=!0,this.renderer.setClearColor(new Color(0,0,0)),this.renderer.setClearAlpha(0),this.renderer.setRenderTarget(r[1]),this.renderer.render(this.scene,this.camera),this.material.uniforms.uWeightMap.value=r[1].texture,this.material.uniforms.uDepthMap.value=r[0].depthTexture,this.renderer.autoClearDepth=!0,this.renderer.autoClearColor=!0,this.renderer.setClearColor(new Color(0,0,0)),this.renderer.setClearAlpha(1),this.renderer.setRenderTarget(r[2]),this.renderer.render(hqScene,passCamera)},t.prototype.dispose=function(){this.copyPass.dispose()},t}(Effect),minDistance=.5,PANGESTURE_FORWARD_ANGLE=Math.PI/7,defaultMapviewControllerCustomInitArgs={defaultLongitude:Math.PI/4,defaultLatitude:Math.PI/4,defaultDistance:150,maxLatitude:+Math.PI/2,minLatitude:0,cameraType:"auto",cameraFence:null,intersectMeshCreator:function(){return new IntersectMesh}},MapviewController=function(e){__extends(t,e);function t(r){var n=this,o,s=t.parseArgs(r);return n=e.call(this,s)||this,n.mode="Mapview",n.defaultLongitude=s.defaultLongitude,n.defaultLatitude=s.defaultLatitude,n.defaultDistance=s.defaultDistance,n.maxLatitude=s.maxLatitude,n.minLatitude=s.minLatitude,n.cameraType=s.cameraType,n.cameraFence=s.cameraFence,n.locationMotion=new Motion({x:n.camera.pose.offset.x,y:n.camera.pose.offset.y,z:n.camera.pose.offset.z,distance:n.camera.pose.distance}),n.modelAlphaMotion=new Motion({modelAlpha:(o=n.models.getMaterial().modelAlpha)!==null&&o!==void 0?o:0}),n.perspToOrthoMotion=new Motion({perspToOrtho:n.camera.perspToOrtho.x}),n.intersectMeshCreator=s.intersectMeshCreator,n.intersectMesh=n.intersectMeshCreator(),n.intersectMesh.name="intersect",n.intersectMesh.visible=!1,n.currentTapId=null,n.helper.add(n.intersectMesh),n.edlTarget=new WebGLRenderTarget(1024,1024,{generateMipmaps:!1,minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat,type:FloatType,depthTexture:new DepthTexture(1024,1024,UnsignedIntType)}),n.edlEffect=new EDLEffect(n.renderer,n.modelScene,n.camera,n.models),n.hqEffect=new HQEffect(n.renderer,n.modelScene,n.camera,n.models),n}return t.parseArgs=function(r){var n,o,s,l,u,c,h,f;if(r instanceof t)return r;var m=e.parseArgs.call(this,r);return __assign(__assign({},m),{defaultLongitude:(n=r.defaultLongitude)!==null&&n!==void 0?n:defaultMapviewControllerCustomInitArgs.defaultLongitude,defaultLatitude:(o=r.defaultLatitude)!==null&&o!==void 0?o:defaultMapviewControllerCustomInitArgs.defaultLatitude,defaultDistance:(s=r.defaultDistance)!==null&&s!==void 0?s:defaultMapviewControllerCustomInitArgs.defaultDistance,maxLatitude:(l=r.maxLatitude)!==null&&l!==void 0?l:defaultMapviewControllerCustomInitArgs.maxLatitude,minLatitude:(u=r.minLatitude)!==null&&u!==void 0?u:defaultMapviewControllerCustomInitArgs.minLatitude,cameraType:(c=r.cameraType)!==null&&c!==void 0?c:defaultMapviewControllerCustomInitArgs.cameraType,cameraFence:(h=r.cameraFence)!==null&&h!==void 0?h:defaultMapviewControllerCustomInitArgs.cameraFence,intersectMeshCreator:(f=r.intersectMeshCreator)!==null&&f!==void 0?f:defaultMapviewControllerCustomInitArgs.intersectMeshCreator})},t.distanceFromModel=function(r,n,o){var s=r.bounding,l=Math.pow(Math.pow(s.max.x-s.min.x+1,2)+Math.pow(s.max.y-s.min.y+1,2)+Math.pow(s.max.z-s.min.z+1,2),1/2),u=l/2/Math.tan(Math.PI*n/360);return o<1&&(u=u/o),isNaN(u)?l:u},t.initAnimationEndState=function(r){var n,o,s,l,u,c,h,f=this.parseArgs(r),m=f.works,y=f.models,A=r.initial,M=A.state,b=A.currentState,T=typeof M.panoIndex=="number"?{workCode:(s=(n=M.workCode)!==null&&n!==void 0?n:(o=f.works[0])===null||o===void 0?void 0:o.workCode)!==null&&s!==void 0?s:"",panoIndex:M.panoIndex}:{workCode:b.workCode,panoIndex:b.panoIndex},_=m.getResolvedObserver(T),S=(l=M.fov)!==null&&l!==void 0?l:60,C=clamp$1((u=M.latitude)!==null&&u!==void 0?u:isThirdPersonMode(b.mode)?b.latitude:f.defaultLatitude,f.minLatitude,f.maxLatitude),P=t.distanceFromModel(f.models,S,f.camera.aspect),F=new Vector3,O=(c=M.distance)!==null&&c!==void 0?c:Math.min(f.defaultDistance,P),N=(h=M.longitude)!==null&&h!==void 0?h:isThirdPersonMode(b.mode)?b.longitude:f.defaultLongitude;return M.offset?F.copy(M.offset):f.defaultDistance<P&&_?(F.copy(_.position),M.longitude===void 0&&(N=b.longitude)):(y.bounding.getCenter(F),O=P),__assign(__assign({},T),{mode:"Mapview",longitude:N,latitude:C,fov:S,offset:F,distance:O})},t.prototype.updateConfiguration=function(r){var n=e.prototype.updateConfiguration.call(this,r);if(n===!1)return!1;if(r.defaultLongitude!==void 0&&this.defaultLongitude!==r.defaultLongitude&&(this.defaultLongitude=r.defaultLongitude),r.defaultLatitude!==void 0&&this.defaultLatitude!==r.defaultLatitude&&(this.defaultLatitude=r.defaultLatitude),r.defaultDistance!==void 0&&this.defaultDistance!==r.defaultDistance&&(this.defaultDistance=r.defaultDistance),r.maxLatitude!==void 0&&this.maxLatitude!==r.maxLatitude&&(this.maxLatitude=r.maxLatitude),r.minLatitude!==void 0&&this.minLatitude!==r.minLatitude&&(this.minLatitude=r.minLatitude),r.cameraType!==void 0&&this.cameraType!==r.cameraType&&(this.cameraType=r.cameraType),this.cameraFence instanceof Box3&&r.cameraFence instanceof Box3?this.cameraFence.equals(r.cameraFence)||(this.cameraFence=r.cameraFence):this.cameraFence instanceof Sphere&&r.cameraFence instanceof Sphere?this.cameraFence.equals(r.cameraFence)||(this.cameraFence=r.cameraFence):r.cameraFence!==void 0&&(this.cameraFence=r.cameraFence),r.intersectMeshCreator!==void 0&&this.intersectMeshCreator!==r.intersectMeshCreator){this.intersectMeshCreator=r.intersectMeshCreator;var o=this.intersectMesh;this.intersectMesh=this.intersectMeshCreator(),this.intersectMesh.name=o.name,this.intersectMesh.visible=o.visible;var s=this.intersectMesh.parent;s&&s.add(this.intersectMesh),o.dispose()}return!0},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.locationMotion.dispose(),delete this.panState,this.intersectMesh.dispose(),this.helper.remove(this.intersectMesh)},t.prototype.isReady=function(){return this.locationMotion.ended===!1?!1:e.prototype.isReady.call(this)},t.prototype.updateWork=function(r,n,o,s){this.userAction=s,this.works=r;var l=t.initAnimationEndState(__assign(__assign({},this),{initial:{currentState:__assign(__assign({},this.currentPano),this.camera.pose),duration:o.duration,effect:o.effect,state:n,userAction:s}}));this.currentPano={workCode:l.workCode,panoIndex:l.panoIndex};var u={longitude:l.longitude,latitude:l.latitude,fov:l.fov},c={x:l.offset.x,y:l.offset.y,z:l.offset.z,distance:l.distance,orthoDistance:l.distance};return this.locationMotion.set(c,o.duration).catch(noop$1),this.cameraMotion.set(u,o.duration).catch(noop$1),!0},t.prototype.updateModel=function(r){e.prototype.updateModel.call(this,r);var n=r.bounding.getCenter(new Vector3),o=t.distanceFromModel(r,this.cameraMotion.value.fov,this.camera.aspect);this.updateCamera({offset:n,distance:o},0,!0)},t.prototype.updateCamera=function(r,n,o){var s=this;return this.initAnimationReady.then(function(){s.userAction=o,s.stopMomentumMovement();var l={},u={};return r.distance!==void 0&&(l.distance=r.distance),r.offset!==void 0&&(l.x=r.offset.x,l.y=r.offset.y,l.z=r.offset.z),r.longitude!==void 0&&(u.longitude=r.longitude),r.latitude!==void 0&&(u.latitude=r.latitude),r.fov!==void 0&&(u.fov=r.fov),s.locationMotion.set(l,n).catch(noop$1),s.cameraMotion.set(u,n).catch(noop$1)})},t.prototype.updateCameraWithKeyframes=function(r,n,o){var s=this;return this.initAnimationReady.then(function(){s.userAction=o,s.stopMomentumMovement();for(var l=[],u=[],c=0,h=r;c<h.length;c++){var f=h[c];l.push({key:f.key,progress:f.progress,value:{distance:f.value.distance,x:f.value.offset.x,y:f.value.offset.x,z:f.value.offset.x}}),u.push({key:f.key,progress:f.progress,value:{longitude:f.value.longitude,latitude:f.value.latitude,fov:f.value.fov}})}return s.locationMotion.setKeyframes(l,n).catch(noop$1),s.cameraMotion.setKeyframes(r,n)})},t.prototype.updateTime=function(r,n){if(!this.destroyed){var o={},s={};this.locationMotion.ended||(this.locationMotion.update(r),s.distance=this.locationMotion.value.distance,s.offset=new Vector3(this.locationMotion.value.x,this.locationMotion.value.y,this.locationMotion.value.z)),this.cameraMotion.ended||(this.cameraMotion.update(r),s.longitude=this.cameraMotion.value.longitude,s.latitude=this.cameraMotion.value.latitude,s.fov=this.cameraMotion.value.fov),this.modelAlphaMotion.ended||(this.modelAlphaMotion.update(r),o.modelAlpha=this.modelAlphaMotion.value.modelAlpha);var l=0;if(this.cameraType==="auto"?l=Math.abs(Math.PI/2-this.cameraMotion.value.latitude)<.02||Math.abs(-Math.PI/2-this.cameraMotion.value.latitude)<.02?1:0:this.cameraType==="perspective"?l=0:this.cameraType==="orthographic"&&(l=1),this.perspToOrthoMotion.getTargetKeyframe().value.perspToOrtho!==l&&this.perspToOrthoMotion.set({perspToOrtho:l},500).catch(noop$1),this.perspToOrthoMotion.ended||(this.perspToOrthoMotion.update(r),this.camera.perspToOrtho.setScalar(clamp$1(this.perspToOrthoMotion.value.perspToOrtho,0,1))),isEmptyObject(o)||this.models.setMaterial(o),isEmptyObject(s)||this.setCamera(s),this.cameraFence&&!this.panState&&!this.pinchState&&!this.mouseWheelState&&!this.inMomentumMovement&&this.locationMotion.ended&&this.perspToOrthoMotion.ended&&this.cameraMotion.ended){var u=coordinatesToVector(this.camera.pose,new Vector3),c=new Vector3().copy(this.camera.pose.offset).sub(u.clone().multiplyScalar(this.camera.pose.distance));if(this.cameraFence.distanceToPoint(c)>.01){var h=this.cameraFence.clampPoint(c,new Vector3),f=this.camera.pose.offset.clone().add(h).sub(c),m=__assign(__assign({},this.currentPano),{mode:this.mode,longitude:this.camera.pose.longitude,latitude:this.camera.pose.latitude,fov:this.camera.pose.fov,offset:f,distance:this.camera.pose.distance});this.fixFinalState(m),this.locationMotion.set({x:m.offset.x,y:m.offset.y,z:m.offset.z,distance:m.distance},300).catch(noop$1)}}if(this.intersectMesh&&this.intersectMesh.parent){var y=this.camera.position.distanceTo(this.intersectMesh.position),A=2*Math.tan(.5*this.camera.fov/180*Math.PI),M=y*A/5;this.intersectMesh.scale.setScalar(M)}}},t.prototype.getTargetState=function(){var r=this.cameraMotion.getKeyFrameSegment(now())[1],n=this.locationMotion.getKeyFrameSegment(now())[1];return __assign(__assign({},this.currentPano),{mode:this.mode,longitude:r.value.longitude,latitude:r.value.latitude,fov:r.value.fov,distance:n.value.distance,offset:new Vector3(n.value.x,n.value.y,n.value.z)})},t.prototype.initAnimation=function(){var r=this;return this.destroyed?Promise.resolve():new Promise(function(n){var o=r.initial;o.state,o.currentState;var s=o.duration,l=o.userAction;r.userAction=l;var u=t.initAnimationEndState(r),c={longitude:u.longitude,latitude:u.latitude,fov:u.fov},h={x:u.offset.x,y:u.offset.y,z:u.offset.z,distance:u.distance},f={modelAlpha:1},m={perspToOrtho:0};r.emit("initAnimation.start",createEvent("initAnimation.start",{state:u,userAction:r.userAction})),r.perspToOrthoMotion.set(m,s).catch(noop$1),r.modelAlphaMotion.set(f,s/3).catch(noop$1),r.cameraMotion.set(c,s).catch(noop$1),r.locationMotion.set(h,s).then(function(){r.emit("initAnimation.end",createEvent("initAnimation.end",{state:u,userAction:r.userAction}))},function(y){var A=__assign(__assign(__assign({},r.currentPano),{mode:r.mode}),clonePose(r.camera.pose));r.emit("initAnimation.end",createEvent("initAnimation.end",{state:A,userAction:r.userAction}))}).then(function(){n()})})},t.prototype.getForwardObserverOrNot=function(r){var n=this,o=this.models.intersectRaycaster(r)[0];if(!o)return null;var s=this.works.resolvedObservers.filter(function(h){for(var f,m=0,y=n.models;m<y.length;m++){var A=y[m];if(A.visible&&((f=A.work)===null||f===void 0?void 0:f.workCode)===h.work.workCode)return!0}return!1}),l=arrayMin(s,function(h){return h.standingPosition.distanceTo(o.point)},!0),u=l[0],c=l[1];return u&&c<10?u:null},t.prototype.coordinatesForOffset=function(r){var n=this.renderer.getSize(new Vector2);return{longitude:-2*r.x/(n.x*this.scissor.width),latitude:2*r.y/(n.y*this.scissor.height)}},t.prototype.requestMomentumMovement=function(r,n,o,s){var l=this;if(this.inMomentumMovement!==null){for(var u=__assign({},o),c={longitude:0,latitude:0,x:0,y:0,z:0},h=0;h<s;h++)u.longitude*=.996,u.latitude*=.996*.998,u.x*=.99,u.y*=.99,u.z*=.99,c.longitude+=u.longitude,c.latitude+=u.latitude,c.x+=u.x,c.y+=u.y,c.z+=u.z;var f=formatRad(this.cameraMotion.value.longitude+c.longitude),m=clamp$1(this.cameraMotion.value.latitude+c.latitude,this.minLatitude,this.maxLatitude),y=new Vector3(this.locationMotion.value.x+c.x,this.locationMotion.value.y+c.y,this.locationMotion.value.z+c.z),A=__assign(__assign({},this.currentPano),{mode:this.mode,longitude:f,latitude:m,offset:y,fov:this.cameraMotion.value.fov,distance:this.locationMotion.value.distance}),M=r.state.offset.clone().sub(coordinatesToVector(r.state).setLength(A.distance)),b=!(Math.abs(u.longitude)>1e-4||Math.abs(u.latitude)>1e-4||Math.abs(u.x)>1e-4||Math.abs(u.y)>1e-4||Math.abs(u.z)>1e-4),T=this.cameraFence?this.cameraFence.containsPoint(M):!0;T===!1&&(b=!0);var _=createEvent("gesture.momentum",__assign(__assign({},r),{isFirst:n,isFinal:b,state:A}));if(this.inMomentumMovement.event=_,this.emit("gesture.momentum",_),r.defaultPrevented){this.inMomentumMovement=null;return}this.inMomentumMovement&&(this.cameraMotion.set({longitude:f,latitude:m},0).catch(noop$1),this.locationMotion.set({x:A.offset.x,y:A.offset.y,z:A.offset.z,distance:A.distance},0).catch(noop$1),b?this.inMomentumMovement=null:AnimationFrameLoop.shared.add(function(S,C){l.requestMomentumMovement(r,!1,u,C|0)},!0,1))}},t.prototype.fixFinalState=function(r){if(this.perspToOrthoMotion.getTargetKeyframe().value.perspToOrtho!==1){var n=coordinatesToVector(r,new Vector3),o=new Vector3().copy(r.offset).sub(n.clone().multiplyScalar(r.distance)),s=new Raycaster(o,n);s.params.Points={threshold:.1},s.near=this.camera.near,s.far=this.camera.far;var l;if(l=this.models.intersectRaycaster(s).filter(function(m){var y,A=(y=m.face)===null||y===void 0?void 0:y.normal;return A&&s.ray.direction.dot(A)>=0?!1:m.distance>minDistance+s.near})[0],!l){var u=new Plane(new Vector3(0,1,0),-this.models.bounding.min.y),c=s.ray.intersectPlane(u,new Vector3);if(c){var h=c.distanceTo(s.ray.origin);h<1e3&&h>=s.near&&(l={distance:h,floor:0,point:c,object:this.scene,face:null})}}if(!l){var f=Math.max(r.distance,3);l={distance:f,floor:0,point:s.ray.direction.clone().setLength(f).add(s.ray.origin),object:this.scene,face:null}}l&&(r.distance=clamp$1(l.distance,0,1/0),r.offset.copy(o).add(n.clone().multiplyScalar(r.distance)))}},t.prototype.onPanGesture=function(r){this.userAction=r.userAction,this.stopMomentumMovement(),this.hideIntersectMesh();var n=r.pointers.length,o=this.panState,s=0,l=!1;r.pointerType==="mouse"&&(s=r.srcEvent.buttons,l=r.srcEvent.shiftKey),o&&s===0&&o.buttons!==0&&(s=o.buttons);var u=o==null?void 0:o.target;if(!u){var c=this.relativeClientPosition(r.center),h=new Raycaster;h.params.Points={threshold:.1},h.setFromCamera(c,this.camera),h.near=this.camera.near,u=new Vector3().copy(h.ray.direction).multiplyScalar(3).add(h.ray.origin);var f=this.models.intersectRaycaster(h)[0];if(!f&&h.ray.direction.y<-.3){var m=new Plane(new Vector3(0,1,0),0),y=h.ray.intersectPlane(m,new Vector3);if(y){var A=y.distanceTo(h.ray.origin);A<1e4&&A>=h.near&&(f={distance:A,floor:0,point:y,object:this.scene})}}if(f)u.copy(f.point);else{var M=new Vector3().copy(this.camera.pose.offset).sub(this.camera.position).normalize(),m=new Plane().setFromNormalAndCoplanarPoint(M,this.camera.pose.offset);h.ray.intersectPlane(m,u)}}if(r.isFinal?delete this.panState:this.panState={target:u,buttons:s,pointerLength:n,x:r.center.x,y:r.center.y},!(typeof o>"u"||o.pointerLength!==n)){var b=n>1||s===2||l;if(b){var T={x:r.center.x-o.x,y:r.center.y-o.y},_=new Vector3(this.locationMotion.value.x,this.locationMotion.value.y,this.locationMotion.value.z),S=coordinatesToVector(this.cameraMotion.value).setLength(this.locationMotion.value.distance).add(_),C=new Vector3().copy(S).sub(o.target).length();C*=Math.tan(this.camera.pose.fov/2*Math.PI/180);var P=this.renderer.getSize(new Vector2),F=2*T.x*C/P.y,O=2*T.y*C/P.y,N=new Vector3;N.setFromMatrixColumn(this.camera.matrix,0),N.multiplyScalar(-F),_.add(N),this.camera.pose.latitude<PANGESTURE_FORWARD_ANGLE?N.setFromMatrixColumn(this.camera.matrix,1):(N.setFromMatrixColumn(this.camera.matrix,0),N.crossVectors(this.camera.up,N)),N.multiplyScalar(O),_.add(N);var V=__assign(__assign({},this.currentPano),{mode:this.mode,longitude:this.camera.pose.longitude,latitude:this.camera.pose.latitude,fov:this.camera.pose.fov,offset:_,distance:this.camera.pose.distance});if(r.state=V,this.emit("gesture.pan",r),r.defaultPrevented)return;if(this.locationMotion.set({x:V.offset.x,y:V.offset.y,z:V.offset.z},0).catch(noop$1),r.isFinal&&(this.fixFinalState(V),Object.assign(r,{__fixFinalState:!0}),this.locationMotion.set({distance:V.distance,x:V.offset.x,y:V.offset.y,z:V.offset.z},0).catch(noop$1)),r.isFinal){var q=this.renderer.getSize(new Vector2),Q=2*r.velocityX*C/q.y,z=2*r.velocityY*C/q.y,H=new Vector3,W=new Vector3;H.setFromMatrixColumn(this.camera.matrix,0),H.multiplyScalar(-Q),W.add(H),this.camera.pose.latitude<PANGESTURE_FORWARD_ANGLE?H.setFromMatrixColumn(this.camera.matrix,1):(H.setFromMatrixColumn(this.camera.matrix,0),H.crossVectors(this.camera.up,H)),H.multiplyScalar(z),W.add(H),this.inMomentumMovement={uuid:createUuid()},this.requestMomentumMovement(r,!0,{longitude:0,latitude:0,x:W.x,y:W.y,z:W.z},0)}}else{var T={x:r.center.x-o.x,y:r.center.y-o.y},J=this.coordinatesForOffset(T),G=formatRad(this.cameraMotion.value.longitude+J.longitude),te=clamp$1(this.cameraMotion.value.latitude+J.latitude,this.minLatitude,this.maxLatitude);this.camera.aspect<1&&Math.abs(r.overallVelocityX)>.2&&Math.atan2(Math.abs(r.overallVelocityY),Math.abs(r.overallVelocityX))<Math.PI/6.923&&(te=this.cameraMotion.value.latitude);var V=__assign(__assign({},this.currentPano),{mode:this.mode,longitude:G,latitude:te,fov:this.camera.pose.fov,offset:this.camera.pose.offset,distance:this.camera.pose.distance});if(r.isFinal&&Object.assign(r,{__fixFinalState:!0}),r.state=V,this.emit("gesture.pan",r),r.defaultPrevented)return;if(r.isFinal?this.locationMotion.set({distance:V.distance,x:V.offset.x,y:V.offset.y,z:V.offset.z},0).catch(noop$1):this.cameraMotion.set({longitude:V.longitude,latitude:V.latitude},0).catch(noop$1),r.isFinal){var X=r.velocityX,K=r.velocityY;this.inMomentumMovement={uuid:createUuid()},this.requestMomentumMovement(r,!0,__assign(__assign({},this.coordinatesForOffset({x:X,y:K})),{x:0,y:0,z:0}),0)}}}},t.prototype.onPinchGesture=function(r){var n;if(this.initAnimationIsReady){this.userAction=r.userAction,this.stopMomentumMovement(),this.hideIntersectMesh();var o=(n=this.pinchState)===null||n===void 0?void 0:n.distance;if(r.isFirst){this.pinchState={x:r.center.x,y:r.center.y,scale:1,distance:this.locationMotion.value.distance};return}if(typeof o<"u"){var s=this.models.bounding.getCenter(new Vector3),l=t.distanceFromModel(this.models,this.cameraMotion.value.fov,this.camera.aspect),u=clamp$1(o/r.scale,minDistance,1/0),c=r.state.offset.clone().sub(coordinatesToVector(r.state).setLength(u)),h=this.models.bounding.containsPoint(c),f;if(!h&&this.pinchState&&this.pinchState.scale>r.scale&&s.distanceTo(c)>l?f=r.state.distance:(f=u,this.pinchState&&(this.pinchState.scale=r.scale)),r.state.distance=f,this.emit("gesture.pinch",r),!r.defaultPrevented&&(this.locationMotion.set({distance:r.state.distance},0).catch(noop$1),r.pointerType!=="mouse"&&(r.type="gesture.pan",this.onPanGesture(r)),r.isFinal)){if(!("__fixFinalState"in r)){var m=r.state;this.fixFinalState(r.state);var y={x:m.offset.x,y:m.offset.y,z:m.offset.z,distance:m.distance};this.locationMotion.set(y,0).catch(noop$1)}delete this.panState,delete this.pinchState}}}},t.prototype.onMouseMove=function(r){var n,o;if(this.intersectMesh.parent&&!this.panState&&!this.pinchState&&!this.mouseWheelState&&(this.emit("gesture.mousemove",r),!r.defaultPrevented)){var s=r.center.raycaster;if(s.near=this.camera.near,s.far=this.camera.far,r.isFinal&&this.intersectMesh.parent&&this.intersectMesh.visible===!0){this.hideIntersectMesh();return}var l=this.models.intersectRaycaster(s)[0],u=createEvent("intersect.update",{raycaster:s,intersection:l??null,object:this.intersectMesh});if(this.emit("intersect.update",u),u.defaultPrevented){this.hideIntersectMesh();return}if(l){var c=(o=(n=l.face)===null||n===void 0?void 0:n.normal)!==null&&o!==void 0?o:new Vector3().copy(s.ray.direction).multiplyScalar(-1),h=c.clone(),f=l.point.clone();this.intersectMesh.position.copy(f);var m=f.clone().add(h);if(this.intersectMesh.lookAt(m),Math.abs(c.y)>.99){var y=this.camera.position.clone().sub(f);this.intersectMesh.rotation.z=-Math.atan2(y.z,y.x)}this.intersectMesh.visible=!0,this.needsRender=!0}else this.hideIntersectMesh()}},t.prototype.onMouseWheel=function(r){if(this.initAnimationIsReady)if(this.userAction=r.userAction,this.stopMomentumMovement(),this.hideIntersectMesh(),r.isFinal){var n=r.state;if(this.fixFinalState(n),this.emit("gesture.mousewheel",r),r.defaultPrevented)return;var o={x:n.offset.x,y:n.offset.y,z:n.offset.z,distance:n.distance};this.locationMotion.set(o,0).catch(noop$1)}else{var s=Math.max(this.locationMotion.value.distance-this.camera.near,0),l=r.center.delta/10*Math.max(s/5,.1);if(this.locationMotion.value.distance-l>=minDistance){var u=this.locationMotion.value.distance-l;r.state.distance=u}else{var c=coordinatesToVector(this.cameraMotion.value);c.setLength(l),r.state.offset.add(c)}if(this.emit("gesture.mousewheel",r),r.defaultPrevented)return;this.locationMotion.set({distance:r.state.distance,x:r.state.offset.x,y:r.state.offset.y,z:r.state.offset.z},0).catch(noop$1)}},t.prototype.onTapGesture=function(r){var n=this;this.userAction=r.userAction,this.stopMomentumMovement();var o=r.center.raycaster,s=this.getForwardObserverOrNot(o);if(!s)this.emit("gesture.tap",r);else{var l={longitude:this.camera.pose.longitude,latitude:0},u=__assign(__assign({},r.state),{mode:"Panorama",workCode:s.pano.workCode,panoIndex:s.pano.panoIndex,longitude:l.longitude,latitude:l.latitude,offset:s?s.position.clone():new Vector3,distance:0});if(r.state=u,this.emit("gesture.tap",r),!r.defaultPrevented&&(this.emit("pano.select",createEvent("pano.select",{prevPano:this.currentPano,state:u,userAction:r.userAction,options:l,progress:0,error:null})),s&&s.active)){var c=this.currentTapId=createUuid();this.preloadPano(s.pano).then(function(h){n.currentTapId===c&&n.emit("pano.request",createEvent("pano.request",{userAction:!0,prevPano:n.currentPano,progress:0,state:u,options:l,error:null}))})}}},t.prototype.onDblTapGesture=function(r){if(this.initAnimationIsReady){this.userAction=r.userAction,this.stopMomentumMovement(),this.hideIntersectMesh();var n=r.state,o=r.center.raycaster,s=o.ray.origin.clone().add(o.ray.direction.clone().setLength(3)),l=1,u=3,c=l,h=this.models.intersectRaycaster(o)[0];if(h&&(s=h.point.clone(),h.distance>(l+u)/2?c=l:c=u),r.state.distance=c,r.state.offset=s,this.emit("gesture.dbltap",r),!r.defaultPrevented){var f={x:n.offset.x,y:n.offset.y,z:n.offset.z,distance:n.distance};this.locationMotion.set(f,360).catch(noop$1),this.hideIntersectMesh()}}},t.prototype.hideIntersectMesh=function(){this.intersectMesh.visible=!1,this.needsRender=!0},t.prototype.render=function(r,n){var o=this.renderer.getRenderTarget();this.updateScreenBuffer(n),this.enableFragDepth?(r&&(n==="edl"?this.edlEffect.render(this.screenBuffers):n==="hq"?this.hqEffect.render(this.screenBuffers):(this.renderer.setRenderTarget(this.modelRenderTarget),this.renderer.render(this.modelScene,this.camera))),this.depthCopyPass.render(this.modelRenderTarget.depthTexture,o),this.renderer.autoClearDepth=!1,this.renderer.autoClearColor=!0,this.copyPass.render(this.modelRenderTarget,o),this.renderer.setRenderTarget(o),this.renderer.autoClearColor=!1,this.renderer.autoClearDepth=!1,this.renderer.render(this.scene,this.camera),this.renderer.autoClearColor=!0,this.renderer.autoClearDepth=!0):(n==="edl"?this.edlEffect.render(this.screenBuffers):n==="hq"?this.hqEffect.render(this.screenBuffers):this.renderer.render(this.modelScene,this.camera),this.renderer.autoClearColor=!1,this.renderer.autoClearDepth=!1,this.renderer.render(this.scene,this.camera),this.renderer.autoClearColor=!0,this.renderer.autoClearDepth=!0)},t}(BaseController);function isNil(e){return e==null}var _moveEvent={type:"move"},XRController=function(){function e(){this._targetRay=null,this._grip=null,this._hand=null,this._axes=[0,0]}return e.prototype.getHandSpace=function(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},e.prototype.getTargetRaySpace=function(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay},e.prototype.getGripSpace=function(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip},e.prototype.dispatchEvent=function(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this},e.prototype.disconnect=function(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this},e.prototype.getAxes=function(){return this._axes},e.prototype.update=function(t,r,n){var o=null,s=null,l=null,u=this._targetRay,c=this._grip,h=this._hand;if(t&&t.gamepad&&t.gamepad.axes&&(this._axes=[t.gamepad.axes[2],t.gamepad.axes[3]]),t&&r.session.visibilityState!=="visible-blurred")if(u!==null&&(o=r.getPose(t.targetRaySpace,n),o!==null&&(u.matrix.fromArray(o.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),o.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(o.linearVelocity)):u.hasLinearVelocity=!1,o.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(o.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent))),h&&t.hand){l=!0;for(var f=0,m=t.hand.values();f<m.length;f++){var y=m[f],A=r.getJointPose(y,n);if(h.joints[y.jointName]===void 0){var M=new Group;M.matrixAutoUpdate=!1,M.visible=!1,h.joints[y.jointName]=M,h.add(M)}var b=h.joints[y.jointName];A!==null&&(b.matrix.fromArray(A.transform.matrix),b.matrix.decompose(b.position,b.rotation,b.scale),b.jointRadius=A.radius),b.visible=A!==null}var T=h.joints["index-finger-tip"],_=h.joints["thumb-tip"],S=T.position.distanceTo(_.position),C=.02,P=.005;h.inputState.pinching&&S>C+P?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!h.inputState.pinching&&S<=C-P&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else c!==null&&t.gripSpace&&(s=r.getPose(t.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));return u!==null&&(u.visible=o!==null),c!==null&&(c.visible=s!==null),h!==null&&(h.visible=l!==null),this},e}(),framebufferScaleFactor=1,XRManager=function(){function e(t,r,n){var o,s,l,u,c;this.isPanorama=(o=n==null?void 0:n.isPanorama)!==null&&o!==void 0?o:!0;var h=navigator.userAgent.toLowerCase(),f;h.includes("pico")?f="Pico":h.includes("oculus")?f="Oculus":f="VP",this.machineType=(s=n==null?void 0:n.machineType)!==null&&s!==void 0?s:f,this.renderer=t,this.gl=r,this.enabled=!1,this.session=null,this.referenceSpaceType=(l=n==null?void 0:n.referenceSpaceType)!==null&&l!==void 0?l:"local-floor",this.referenceSpace=null,this.onSessionStartCallback=(u=n==null?void 0:n.onSessionStart)!==null&&u!==void 0?u:noop$1,this.onSessionEndCallback=(c=n==null?void 0:n.onSessionEnd)!==null&&c!==void 0?c:noop$1,this.controllers=[new XRController,new XRController],this.inputSourcesMap=new Map,this.cameraVR=new ArrayCamera,this.cameraL=new PerspectiveCamera,this.cameraR=new PerspectiveCamera,this.cameraL.viewport=new Vector4,this.cameraR.viewport=new Vector4,this.cameraL.layers.enable(1),this.cameraR.layers.enable(2),this.cameraVR.layers.enable(1),this.cameraVR.layers.enable(2),this.isPresenting=!1,this.currentDepthNear=null,this.currentDepthFar=null,this.cameraLPos=new Vector3,this.cameraRPos=new Vector3}return e.prototype.getController=function(t){var r=this.controllers[t];return r||console.warn("no controller find"),r.getTargetRaySpace()},e.prototype.getRightController=function(){if(!this.session)return null;var t=this.session.inputSources[0].handedness==="right"?0:1,r=this.controllers[t];return r||console.warn("no controller find"),r.getTargetRaySpace()},e.prototype.getLeftController=function(){if(!this.session)return null;var t=this.session.inputSources[0].handedness==="left"?0:1,r=this.controllers[t];return r||console.warn("no controller find"),r.getTargetRaySpace()},e.prototype.getControllerGrip=function(t){var r=this.controllers[t];return r||console.warn("no controller find"),r.getGripSpace()},e.prototype.getCameras=function(){return{cameraL:this.cameraL,cameraR:this.cameraR,cameraVR:this.cameraVR}},e.prototype.updateCamera=function(t,r){r===null?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(r.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)},e.prototype.setProjectionFromUnion=function(t,r,n){this.cameraLPos.setFromMatrixPosition(r.matrixWorld),this.cameraRPos.setFromMatrixPosition(n.matrixWorld);var o=this.cameraLPos.distanceTo(this.cameraRPos),s=r.projectionMatrix.elements,l=n.projectionMatrix.elements,u=s[14]/(s[10]-1),c=s[14]/(s[10]+1),h=(s[9]+1)/s[5],f=(s[9]-1)/s[5],m=(s[8]-1)/s[0],y=(l[8]+1)/l[0],A=u*m,M=u*y,b=o/(-m+y),T=b*-m;r.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(T),t.translateZ(b),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);var _=u+b,S=c+b,C=A-T,P=M+(o-T),F=h*c/S*_,O=f*c/S*_;t.projectionMatrix.makePerspective(C,P,F,O,_,S)},e.prototype.getCamera=function(t){this.cameraVR.near=this.cameraR.near=this.cameraL.near=t.near,this.cameraVR.far=this.cameraR.far=this.cameraL.far=t.far,this.session&&(this.currentDepthNear!==this.cameraVR.near||this.currentDepthFar!==this.cameraVR.far)&&(this.session.updateRenderState({depthNear:this.cameraVR.near,depthFar:this.cameraVR.far}),this.currentDepthNear=this.cameraVR.near,this.currentDepthFar=this.cameraVR.far);var r=t.parent,n=this.cameraVR.cameras;this.updateCamera(this.cameraVR,r);for(var o=0;o<n.length;o++)this.updateCamera(n[o],r);t.matrixWorld.copy(this.cameraVR.matrixWorld);for(var s=t.children,o=0,l=s.length;o<l;o++)s[o].updateMatrixWorld(!0);return n.length===2?this.setProjectionFromUnion(this.cameraVR,this.cameraL,this.cameraR):this.cameraVR.projectionMatrix.copy(this.cameraL.projectionMatrix),this.cameraVR},e.prototype.updateInputSources=function(t){if(!this.session){console.warn("session is lose!");return}for(var r=this.session.inputSources,n=0;n<this.controllers.length;n++)this.inputSourcesMap.set(r[n],this.controllers[n]);for(var n=0;n<t.removed.length;n++){var o=t.removed[n],s=this.inputSourcesMap.get(o);s&&(s.dispatchEvent({type:"disconnected",data:o}),this.inputSourcesMap.delete(o))}for(var n=0;n<t.added.length;n++){var o=t.added[n],s=this.inputSourcesMap.get(o);s&&s.dispatchEvent({type:"connected",data:o})}},e.prototype.onSessionEvent=function(t){var r=this.inputSourcesMap.get(t.inputSource);r&&r.dispatchEvent({type:t.type})},e.prototype.onSessionEnd=function(){this.inputSourcesMap.forEach(function(t,r){t.disconnect(r)}),this.inputSourcesMap.clear(),this.renderer.setFramebuffer(null),this.renderer.setRenderTarget(this.renderer.getRenderTarget()),this.isPresenting=!1,this.session=null,AnimationFrameLoop.shared.setContext(null),this.onSessionEndCallback()},e.prototype.onRequestReferenceSpace=function(t){this.referenceSpace=t,this.isPresenting=!0,this.session&&this.onSessionStartCallback(this.session)},e.prototype.setSession=function(t){var r=this;if(this.session=t,this.session){this.session.addEventListener("select",function(o){r.onSessionEvent(o)}),this.session.addEventListener("selectstart",function(o){r.onSessionEvent(o)}),this.session.addEventListener("selectend",function(o){r.onSessionEvent(o)}),this.session.addEventListener("squeeze",function(o){r.onSessionEvent(o)}),this.session.addEventListener("squeezestart",function(o){r.onSessionEvent(o)}),this.session.addEventListener("squeezeend",function(o){r.onSessionEvent(o)}),this.session.addEventListener("end",function(o){r.onSessionEnd()});var n=this.gl.getContextAttributes();this.gl.makeXRCompatible().then(function(){var o={antialias:n==null?void 0:n.antialias,alpha:n==null?void 0:n.alpha,depth:n==null?void 0:n.depth,stencil:n==null?void 0:n.stencil,framebufferScaleFactor};if(!r.session){console.error("session is lose while set session!");return}switch(r.machineType){case"Pico":case"VP":r.session.updateRenderState({baseLayer:new XRWebGLLayer(r.session,r.gl,o)});break;case"Oculus":r.session.updateRenderState({baseLayer:new XRWebGLLayer(r.session,r.gl,o)});break;default:r.machineType;break}r.session.requestReferenceSpace(r.referenceSpaceType).then(function(s){r.onRequestReferenceSpace(s)}),r.session.addEventListener("inputsourceschange",function(s){r.updateInputSources(s)})})}},e}(),LineSegmentsGeometry=function(e){__extends(t,e);function t(){var r=e.call(this)||this;r.type="LineSegmentsGeometry";var n=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],o=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],s=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];return r.setIndex(s),r.setAttribute("position",new Float32BufferAttribute(n,3)),r.setAttribute("uv",new Float32BufferAttribute(o,2)),r}return t.prototype.applyMatrix4=function(r){var n=this.attributes.instanceStart,o=this.attributes.instanceEnd;return n!==void 0&&(n.applyMatrix4(r),o.applyMatrix4(r),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},t.prototype.setPositions=function(r){var n;r instanceof Float32Array?n=r:Array.isArray(r)?n=new Float32Array(r):n=new Float32Array;var o=new InstancedInterleavedBuffer(n,6,1);return this.setAttribute("instanceStart",new InterleavedBufferAttribute(o,3,0)),this.setAttribute("instanceEnd",new InterleavedBufferAttribute(o,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},t.prototype.setColors=function(r){var n;r instanceof Float32Array?n=r:Array.isArray(r)?n=new Float32Array(r):n=new Float32Array;var o=new InstancedInterleavedBuffer(n,6,1);return this.setAttribute("instanceColorStart",new InterleavedBufferAttribute(o,3,0)),this.setAttribute("instanceColorEnd",new InterleavedBufferAttribute(o,3,3)),this},t.prototype.fromWireframeGeometry=function(r){return this.setPositions(r.attributes.position.array),this},t.prototype.fromEdgesGeometry=function(r){return this.setPositions(r.attributes.position.array),this},t.prototype.fromMesh=function(r){return this.fromWireframeGeometry(new WireframeGeometry(r.geometry)),this},t.prototype.fromLineSegments=function(r){var n=r.geometry;if(n instanceof Geometry){var o=new BufferGeometry().fromGeometry(n);this.setPositions(o.attributes.position.array)}else n instanceof BufferGeometry&&this.setPositions(n.attributes.position.array);return this},t.prototype.computeBoundingBox=function(){this.boundingBox===null&&(this.boundingBox=new Box3);var r=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(r!==void 0&&n!==void 0){var o=new Box3;this.boundingBox.setFromBufferAttribute(r),o.setFromBufferAttribute(n),this.boundingBox.union(o)}},t.prototype.computeBoundingSphere=function(){this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingBox===null&&this.computeBoundingBox();var r=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(r!==void 0&&n!==void 0){var o=this.boundingSphere.center;this.boundingBox.getCenter(o);for(var s=0,l=new Vector3,u=0,c=r.count;u<c;u++)l.fromBufferAttribute(r,u),s=Math.max(s,o.distanceToSquared(l)),l.fromBufferAttribute(n,u),s=Math.max(s,o.distanceToSquared(l));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}},t.prototype.toJSON=function(){},t}(InstancedBufferGeometry);Object.assign(LineSegmentsGeometry.prototype,{isLineSegmentsGeometry:!0});var lineShader={uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.fog,{linewidth:{value:1},resolution:{value:new Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1},opacity:{value:1}}]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		varying vec2 vUv;

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;

			#endif

			float aspect = resolution.x / resolution.y;

			vUv = uv;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec2 ndcStart = clipStart.xy / clipStart.w;
			vec2 ndcEnd = clipEnd.xy / clipEnd.w;

			// direction
			vec2 dir = ndcEnd - ndcStart;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			// perpendicular to dir
			vec2 offset = vec2( dir.y, - dir.x );

			// undo aspect ratio adjustment
			dir.x /= aspect;
			offset.x /= aspect;

			// sign flip
			if ( position.x < 0.0 ) offset *= - 1.0;

			// endcaps
			if ( position.y < 0.0 ) {

				offset += - dir;

			} else if ( position.y > 1.0 ) {

				offset += dir;

			}

			// adjust for linewidth
			offset *= linewidth;

			// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
			offset /= resolution.y;

			// select end
			vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

			// back to clip space
			offset *= clip.w;

			clip.xy += offset;

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;

		#ifdef USE_DASH

			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		varying vec2 vUv;

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			if ( abs( vUv.y ) > 1.0 ) {

				float a = vUv.x;
				float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
				float len2 = a * a + b * b;

				if ( len2 > 1.0 ) discard;

			}

			vec4 diffuseColor = vec4( diffuse, opacity );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );

			#include <tonemapping_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`},LineMaterial=function(e){__extends(t,e);function t(r){var n=e.call(this,{uniforms:UniformsUtils.clone(lineShader.uniforms),vertexShader:lineShader.vertexShader,fragmentShader:lineShader.fragmentShader,clipping:!0})||this;return n.type="LineMaterial",n.dashed=!1,Object.defineProperties(n,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(o){this.uniforms.diffuse.value=o}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(o){this.uniforms.linewidth.value=o}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(o){this.uniforms.dashScale.value=o}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(o){this.uniforms.dashSize.value=o}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(o){this.uniforms.gapSize.value=o}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(o){this.uniforms.opacity.value=o}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(o){this.uniforms.resolution.value.copy(o)}}}),n.setValues(r),n}return t}(ShaderMaterial);Object.assign(LineMaterial.prototype,{isLineMaterial:!0});var LineSegments2=function(e){__extends(t,e);function t(r,n){var o=e.call(this)||this;return o.type="LineSegments2",o.geometry=r!==void 0?r:new LineSegmentsGeometry,o.material=n!==void 0?n:new LineMaterial({color:Math.random()*16777215}),o}return t.prototype.computeLineDistances=function(){for(var r=this.geometry,n=r.attributes.instanceStart,o=r.attributes.instanceEnd,s=new Float32Array(2*n.count),l=new Vector3,u=new Vector3,c=0,h=0,f=n.count;c<f;c++,h+=2)l.fromBufferAttribute(n,c),u.fromBufferAttribute(o,c),s[h]=h===0?0:s[h-1],s[h+1]=s[h]+l.distanceTo(u);var m=new InstancedInterleavedBuffer(s,2,1);return r.setAttribute("instanceDistanceStart",new InterleavedBufferAttribute(m,1,0)),r.setAttribute("instanceDistanceEnd",new InterleavedBufferAttribute(m,1,1)),this},t.prototype.raycast=function(r,n){r.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var o=r.ray,s=r.camera,l=s.projectionMatrix,u=this.geometry,c=this.material,h=c.resolution,f=c.linewidth,m=u.attributes.instanceStart,y=u.attributes.instanceEnd,A=new Vector4,M=new Vector4,b=new Vector4,T=new Vector3,_=new Matrix4,S=new Line3,C=new Vector3;o.at(1,b),b.w=1,b.applyMatrix4(s.matrixWorldInverse),b.applyMatrix4(l),b.multiplyScalar(1/b.w),b.x*=h.x/2,b.y*=h.y/2,b.z=0,T.copy(b);var P=this.matrixWorld;_.multiplyMatrices(s.matrixWorldInverse,P);for(var F=0,O=m.count;F<O;F++){A.fromBufferAttribute(m,F),M.fromBufferAttribute(y,F),A.w=1,M.w=1,A.applyMatrix4(_),M.applyMatrix4(_),A.applyMatrix4(l),M.applyMatrix4(l),A.multiplyScalar(1/A.w),M.multiplyScalar(1/M.w);var N=A.z<-1&&M.z<-1,V=A.z>1&&M.z>1;if(!(N||V)){A.x*=h.x/2,A.y*=h.y/2,M.x*=h.x/2,M.y*=h.y/2,S.start.copy(A),S.start.z=0,S.end.copy(M),S.end.z=0;var q=S.closestPointToPointParameter(T,!0);S.at(q,C);var Q=MathUtils.lerp(A.z,M.z,q),z=Q>=-1&&Q<=1,H=T.distanceTo(C)<f*.5;if(z&&H){S.start.fromBufferAttribute(m,F),S.end.fromBufferAttribute(y,F),S.start.applyMatrix4(P),S.end.applyMatrix4(P);var W=new Vector3,J=new Vector3;o.distanceSqToSegment(S.start,S.end,J,W),n.push({point:J,pointOnLine:W,distance:o.origin.distanceTo(J),object:this,faceIndex:F})}}}},t}(Mesh);Object.assign(LineSegments2.prototype,{isLineSegments2:!0});var Line2=function(e){__extends(t,e);function t(r,n){var o=e.call(this,r,n)||this;return o.type="Line2",o}return t}(LineSegments2);Object.assign(Line2.prototype,{isLine2:!0});var LineGeometry=function(e){__extends(t,e);function t(){var r=e.call(this)||this;return r.type="LineGeometry",r}return t.prototype.setPositions=function(r){for(var n=r.length-3,o=new Float32Array(2*n),s=0;s<n;s+=3)o[2*s]=r[s],o[2*s+1]=r[s+1],o[2*s+2]=r[s+2],o[2*s+3]=r[s+3],o[2*s+4]=r[s+4],o[2*s+5]=r[s+5];return e.prototype.setPositions.call(this,o),this},t.prototype.setColors=function(r){for(var n=r.length-3,o=new Float32Array(2*n),s=0;s<n;s+=3)o[2*s]=r[s],o[2*s+1]=r[s+1],o[2*s+2]=r[s+2],o[2*s+3]=r[s+3],o[2*s+4]=r[s+4],o[2*s+5]=r[s+5];return e.prototype.setColors.call(this,o),this},t.prototype.fromLine=function(r){var n=r.geometry;if(n instanceof Geometry){var o=new BufferGeometry().fromGeometry(n);this.setPositions(o.attributes.position.array)}else n instanceof BufferGeometry&&this.setPositions(n.attributes.position.array);return this},t.prototype.copy=function(){return this},t}(LineSegmentsGeometry);Object.assign(LineGeometry.prototype,{isLineGeometry:!0});var circleImageURL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sHDgwCEMBJZu0AAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAABM5JREFUWMO1V0tPG2cUPZ4Hxh6DazIOrjFNqJs0FIMqWFgWQkatsmvVbtggKlSVRVf5AWz4AWz4AUSKEChll19QJYSXkECuhFxsHjEhxCYm+DWGMZ5HF72DJq4bAzFXurI0M/I5997v3u9cC65vTJVn2lX/xHINQOYSBLTLEuIuCWw4Z3IGAEvf6ASmVHjNzHCXBG4A0AjACsAOwEbO0nsFQBnAGYASAIl+ZRMR7SolMEdsByD09fV5R0ZGgg8ePPjW5/N1iqLYpuu6RZblciKR2I9Go69evnwZnZ+fjwI4IS8AKBIRzeQfJWCANwKwh0KhtrGxsYehUOin1tbW+zzP23ietzY2NnIAoGmaLsuyUiqVyvl8XtrY2NiamZn589mzZxsAUgCOAeQAnFI2tI+VxIjaAeDzoaGh7xYWFuZOTk6OZVk+12uYqqq6JEnn0Wg0OT4+/geAXwGEAdwDIFJQXC1wO4DWR48e/RCPxxclSSroVzRFUbSDg4P848ePFwH8DuAhkWih83TRQWxFOXgAwvDwcOfo6OhvXV1d39tsNtuVBwTDWBwOh1UUxVsMw1hXVlbSdCgNV43uYSvrHg6H24aHh38eHBz85TrgF9FYLHA4HLzH43FvbW2d7u/vG+dANp8FpqIlbd3d3V8Fg8EfBUFw4BONZVmL3+9vHhkZCQL4AoAHgJPK8G+yzC0XDofdoVAo5PP5vkadTBAEtr+/39ff3x8gAp/RPOEqx2qjx+NpvXv3bk9DQ0NDvQgwDIOWlhZrMBj8kgi0UJdxRgYMArzL5XJ7vd57qLPZ7Xamp6fnNgBXtQxcjFuHw+Hyer3t9SYgCAITCAScAJoBNNEY/08GOFVVrfVMv7kMNDntFD1vjIAPrlRN0xjckOm6biFQ3jwNPwDMZrOnqVTqfb3Bi8Wivru7W/VCYkwPlKOjo0IikXh7EwQikYgE4Nw0CfXKDCipVCoTj8df3QABbW1tLUc6oUgkFPMkVACUNjc337148eKvw8PDbJ2jP1taWkoCyNDVXDSECmNSK4qiKNLq6urW8+fPI/UicHx8rD59+jSVy+WOAKSJhKENwFItLtoxk8mwsixzHR0dHe3t7c5PAU+n09rs7OzJkydPYqVSaQfANoDXALIk31S2smU1TWMPDg7K5XKZ7+3t9TudTut1U7+wsFCcmJiIpdPpbQBxADsAknQWymYCOukBHYCuKApisdhpMpnURFEU79y503TVyKenpzOTk5M7e3t7MQKPV0Zv1gNm+awB0MvlshqLxfLb29uyJElWURSbXC4XXyvqxcXFs6mpqeTc3Nzu3t7e3wQcA7BPZ8Cov1pNlJplmQtAG8MwHV6v95tAINA5MDBwPxAIuLu6upr8fr/VAN3c3JQjkcjZ+vp6fnl5+d2bN29SuVzuNYAEpf01CdRChUL+X1VskHACuA3Ay3Fcu9vt7nA6nZ7m5uYWQRCaNE3jVVW15PP580KhIGUymWw2m00DOAJwSP4WwPtq4LX2Ao6USxNlQyS/RcQcdLGwlNIz6vEMAaZpNzCk2Pll94LK/cDYimxERiBwG10sxjgvEZBE0UpE6vxj+0Ct5bTaXthgEhRmja8QWNkkPGsuIpfdjpkK+cZUWTC0KredVmtD/gdlSl6EG4AMvQAAAABJRU5ErkJggg==",DEFAULT_COLOR=14467195,POINT_SIZE=8,DEFAULT_LINEWIDTH=2,DEFAULT_DASHSCALE=20,sharedCircleTexture=null,FiveLine=function(e){__extends(t,e);function t(r,n){r===void 0&&(r=new Vector3),n===void 0&&(n=new Vector3);var o=e.call(this)||this;o.type="FiveLine",o.needsRender=!0;var s=new LineGeometry,l=new LineMaterial({color:DEFAULT_COLOR,linewidth:DEFAULT_LINEWIDTH,dashScale:DEFAULT_DASHSCALE,dashed:!1});o.line=new Line2(s,l);var u=new BufferGeometry,c=new PointsMaterial({color:DEFAULT_COLOR,size:POINT_SIZE,map:sharedCircleTexture||(sharedCircleTexture=new TextureLoader$1().load(circleImageURL)),sizeAttenuation:!1,transparent:!0});return o.points=new Points(u,c),o.points.renderOrder=11,o.points.frustumCulled=!1,o.setPoints(r,n),o.add(o.line,o.points),o}return Object.defineProperty(t,"version",{get:function(){return"6.4.0-alpha.40"},enumerable:!1,configurable:!0}),t.prototype.setPoints=function(r,n){var o=[].concat(r.toArray(),n.toArray());this.points.geometry.setAttribute("position",new BufferAttribute(new Float32Array(o),3)),this.line.geometry.setPositions(o),this.line.computeLineDistances(),this.needsRender=!0},t.prototype.getPoints=function(){var r=this.points.geometry.attributes.position.array;return[new Vector3(r[0],r[1],r[2]),new Vector3(r[3],r[4],r[5])]},t.prototype.setMaterial=function(r){var n=this.line.material;for(var o in r)if(r.hasOwnProperty(o)){var s=r[o];o==="dashed"?(n.dashed=s,s?n.defines.USE_DASH="":delete n.defines.USE_DASH,n.needsUpdate=!0):n[o]=r[o]}this.needsRender=!0},t.prototype.setResolution=function(r,n){var o=this.line.material.resolution;(o.x!==r||o.y!==n)&&(o.set(r,n),this.needsRender=!0)},t}(Object3D);Object.assign(FiveLine.prototype,{isFiveLine:!0});var Constants={ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};function fetchJsonFile(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return[4,fetch(e)];case 1:if(t=r.sent(),t.ok)return[2,t.json()];throw new Error(t.statusText)}})})}function fetchProfilesList(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:if(!e)throw new Error("No basePath supplied");return t="profilesList.json",[4,fetchJsonFile("".concat(e,"/").concat(t))];case 1:return r=n.sent(),[2,r]}})})}function fetchProfile(e,t){return __awaiter(this,arguments,void 0,function(r,n,o,s){var l,u,c,h,f,m;return o===void 0&&(o=null),s===void 0&&(s=!0),__generator(this,function(y){switch(y.label){case 0:if(!r)throw new Error("No xrInputSource supplied");if(!n)throw new Error("No basePath supplied");return[4,fetchProfilesList(n)];case 1:if(l=y.sent(),r.profiles.some(function(A){var M=l[A];return M&&(u={profileId:A,profilePath:"".concat(n,"/").concat(M.path),deprecated:!!M.deprecated}),!!u}),!u){if(!o)throw new Error("No matching profile name found");if(c=l[o],!c)throw new Error('No matching profile name found and default profile "'.concat(o,'" missing.'));u={profileId:o,profilePath:"".concat(n,"/").concat(c.path),deprecated:!!c.deprecated}}return[4,fetchJsonFile(u.profilePath)];case 2:if(h=y.sent(),s){if(m=void 0,m=h.layouts[r.handedness],!m)throw new Error("No matching handedness, ".concat(r.handedness,", in profile ").concat(u.profileId));m.assetPath&&(f=u.profilePath.replace("profile.json",m.assetPath))}return[2,{profile:h,assetPath:f}]}})})}var defaultComponentValues={xAxis:0,yAxis:0,button:0,state:Constants.ComponentState.DEFAULT};function normalizeAxes(e,t){e===void 0&&(e=0),t===void 0&&(t=0);var r=e,n=t,o=Math.sqrt(e*e+t*t);if(o>1){var s=Math.atan2(t,e);r=Math.cos(s),n=Math.sin(s)}var l={normalizedXAxis:r*.5+.5,normalizedYAxis:n*.5+.5};return l}var VisualResponse=function(){function e(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===Constants.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(defaultComponentValues)}return e.prototype.updateFromComponent=function(t){var r=t.xAxis,n=t.yAxis,o=t.button,s=t.state,l=normalizeAxes(r,n),u=l.normalizedXAxis,c=l.normalizedYAxis;switch(this.componentProperty){case Constants.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?u:.5;break;case Constants.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?c:.5;break;case Constants.ComponentProperty.BUTTON:this.value=this.states.includes(s)?o:0;break;case Constants.ComponentProperty.STATE:this.valueNodeProperty===Constants.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error("Unexpected visualResponse componentProperty ".concat(this.componentProperty))}},e}(),Component=function(){function e(t,r){var n=this;if(!t||!r||!r.visualResponses||!r.gamepadIndices||Object.keys(r.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=t,this.type=r.type,this.rootNodeName=r.rootNodeName,this.touchPointNodeName=r.touchPointNodeName,this.visualResponses={},Object.keys(r.visualResponses).forEach(function(o){var s=new VisualResponse(r.visualResponses[o]);n.visualResponses[o]=s}),this.gamepadIndices=Object.assign({},r.gamepadIndices),this.values={state:Constants.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}return Object.defineProperty(e.prototype,"data",{get:function(){var t=__assign({id:this.id},this.values);return t},enumerable:!1,configurable:!0}),e.prototype.updateFromGamepad=function(t){var r=this;if(this.values.state=Constants.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&t.buttons.length>this.gamepadIndices.button){var n=t.buttons[this.gamepadIndices.button];this.values.button=n.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,n.pressed||this.values.button===1?this.values.state=Constants.ComponentState.PRESSED:(n.touched||this.values.button>Constants.ButtonTouchThreshold)&&(this.values.state=Constants.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Constants.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Constants.AxisTouchThreshold&&(this.values.state=Constants.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Constants.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Constants.AxisTouchThreshold&&(this.values.state=Constants.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(function(o){o.updateFromComponent(r.values)})},e}(),MotionController=function(){function e(t,r,n){var o=this;if(!t)throw new Error("No xrInputSource supplied");if(!r)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=n,this.id=r.profileId,this.layoutDescription=r.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(function(s){var l=o.layoutDescription.components[s];o.components[s]=new Component(s,l)}),this.updateFromGamepad()}return Object.defineProperty(e.prototype,"gripSpace",{get:function(){return this.xrInputSource.gripSpace},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"targetRaySpace",{get:function(){return this.xrInputSource.targetRaySpace},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var t=[];return Object.values(this.components).forEach(function(r){t.push(r.data)}),t},enumerable:!1,configurable:!0}),e.prototype.updateFromGamepad=function(){var t=this;Object.values(this.components).forEach(function(r){r.updateFromGamepad(t.xrInputSource.gamepad)})},e}(),DEFAULT_PROFILES_PATH="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",DEFAULT_PROFILE="generic-trigger",XRControllerModel=function(e){__extends(t,e);function t(){var r=e.call(this)||this;return r.motionController=null,r.envMap=null,r}return t.prototype.setEnvironmentMap=function(r){var n=this;return this.envMap==r?this:(this.envMap=r,this.traverse(function(o){o instanceof Mesh&&o.isMesh&&(o.material.envMap=n.envMap,o.material.needsUpdate=!0)}),this)},t.prototype.updateMatrixWorld=function(r){e.prototype.updateMatrixWorld.call(this,r),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(function(n){Object.values(n.visualResponses).forEach(function(o){var s=o.valueNode,l=o.minNode,u=o.maxNode,c=o.value,h=o.valueNodeProperty;s&&(h===Constants.VisualResponseProperty.VISIBILITY?s.visible=c:h===Constants.VisualResponseProperty.TRANSFORM&&(s.quaternion.copy(l.quaternion).slerp(u.quaternion,c),s.position.lerpVectors(l.position,u.position,c)))})}))},t}(Object3D);function findNodes(e,t){Object.values(e.components).forEach(function(r){var n=r.type,o=r.touchPointNodeName,s=r.visualResponses;if(n===Constants.ComponentType.TOUCHPAD)if(r.touchPointNode=t.getObjectByName(o),r.touchPointNode){var l=new SphereGeometry(.001),u=new MeshBasicMaterial({color:255}),c=new Mesh(l,u);r.touchPointNode.add(c)}else console.warn("Could not find touch dot, ".concat(r.touchPointNodeName,", in touchpad component ").concat(r.id));Object.values(s).forEach(function(h){var f=h.valueNodeName,m=h.minNodeName,y=h.maxNodeName,A=h.valueNodeProperty;if(A===Constants.VisualResponseProperty.TRANSFORM){if(h.minNode=t.getObjectByName(m),h.maxNode=t.getObjectByName(y),!h.minNode){console.warn("Could not find ".concat(m," in the model"));return}if(!h.maxNode){console.warn("Could not find ".concat(y," in the model"));return}}h.valueNode=t.getObjectByName(f),h.valueNode||console.warn("Could not find ".concat(f," in the model"))})})}function addAssetSceneToControllerModel(e,t){findNodes(e.motionController,t),e.envMap&&t.traverse(function(r){r instanceof Mesh&&r.isMesh&&(r.material.envMap=e.envMap,r.material.needsUpdate=!0)}),e.add(t)}var XRControllerModelFactory=function(){function e(t){t===void 0&&(t=null),this.gltfLoader=t,this.path=DEFAULT_PROFILES_PATH,this._assetCache={}}return e.prototype.createControllerModel=function(t){var r=this,n=new XRControllerModel,o=null;return t.addEventListener("connected",function(s){var l=s.data;l.targetRayMode!=="tracked-pointer"||!l.gamepad||fetchProfile(l,r.path,DEFAULT_PROFILE).then(function(u){var c=u.profile,h=u.assetPath;n.motionController=new MotionController(l,c,h);var f=r._assetCache[n.motionController.assetUrl];if(f)o=f.scene.clone(),addAssetSceneToControllerModel(n,o);else{if(!r.gltfLoader)throw new Error("GLTFLoader not set.");r.gltfLoader.load(n.motionController.assetUrl,function(m){r._assetCache[n.motionController.assetUrl]=m,o=m.scene.clone(),addAssetSceneToControllerModel(n,o)})}}).catch(function(u){console.warn(u)})}),t.addEventListener("disconnected",function(){n.motionController=null,n.remove(o),o=null}),n},e}();__assign({},omit(defaultPanoramaControllerCustomInitArgs,["maxLatitude","minLatitude"]));function mapPanoResource(e,t){return e}var CONTROLLER_EVNET_DELTA_TIME=300,ROTATE_Y_PI_MATRIX=new Matrix4().makeRotationAxis(new Vector3(0,1,0),Math.PI),PANO_TEXTURE_SCALE=new Vector3(-1,1,1),XRPanoramaController=function(e){__extends(t,e);function t(r){var n=e.call(this,r)||this;n.xrManager=new XRManager(n.renderer,n.renderer.getContext(),{onSessionStart:function(c){n.emit("xr.session.start",createEvent("xr.session.start",{session:c,machineType:n.xrManager.machineType}))},onSessionEnd:function(){n.emit("xr.session.end",createEvent("xr.session.end",{session:null,machineType:n.xrManager.machineType}))}}),n.xrControllerRay={left:new Raycaster,right:new Raycaster},n.xrControllerRay.left.params.Points={threshold:.1},n.xrControllerRay.right.params.Points={threshold:.1},n.gazeRay=null,n.pointerLines={left:new FiveLine,right:new FiveLine},n.pointerLines.left.visible=!1,n.pointerLines.right.visible=!0,n.pointerLines.left.setMaterial({color:new Vector3(1,1,1)}),n.pointerLines.left.points.material.depthTest=!1,n.pointerLines.right.setMaterial({color:new Vector3(1,1,1)}),n.pointerLines.right.points.material.depthTest=!1,n.controllerWrappers=[new Group,new Group];var o=n.xrManager.getController(0);n.controllerWrappers[0].add(o);var s=n.xrManager.getController(1);n.controllerWrappers[1].add(s);var l=new XRControllerModelFactory;l.gltfLoader={load:function(c,h){internalFetcher.ajax(c,{responseType:"arraybuffer"}).then(function(f){var m;return parseGltf(f.body,{resourcePath:c.slice(0,c.lastIndexOf("/")+1),search:(m=c.split("?")[1])!==null&&m!==void 0?m:"",fetcher:internalFetcher})}).then(function(f){return h(f)})}},(n.xrManager.machineType==="Oculus"||n.xrManager.machineType==="Pico")&&n.scene.add(n.pointerLines.left,n.pointerLines.right,n.controllerWrappers[0],n.controllerWrappers[1]),n.panoResources={},n.panoResources[n.locationMotion.keyframes[0].key=n.locationMotion.keyframes[1].key=createUuid()]={panoId:panoStringify(n.currentPano),leftPanoPicture:null,position:n.camera.pose.offset.clone(),effect:"fade",fixCameraTransform:new Matrix4},n.parallaxCameraMatrixs=[];var u=AnimationFrameLoop.shared.getContext();return u?(n.on("xr.session.end",function(){n.scene.remove(n.pointerLines.left,n.pointerLines.right)}),n.xrManager.setSession(u),n.on("xr.session.start",function(){var c=n.xrManager.getControllerGrip(0);c.add(l.createControllerModel(c)),n.controllerWrappers[0].add(c);var h=n.xrManager.getControllerGrip(1);h.add(l.createControllerModel(h)),n.controllerWrappers[1].add(h)}),n.xrHandleState={LeftAxesUp:{touchStartTime:0,touchStart:!1},LeftAxesDown:{touchStartTime:0,touchStart:!1},LeftAxesLeft:{touchStartTime:0,touchStart:!1},LeftAxesRight:{touchStartTime:0,touchStart:!1},LeftTrigger:{touchStartTime:0,touchStart:!1},LeftPinch:{touchStartTime:0,touchStart:!1},RightAxesUp:{touchStartTime:0,touchStart:!1},RightAxesDown:{touchStartTime:0,touchStart:!1},RightAxesLeft:{touchStartTime:0,touchStart:!1},RightAxesRight:{touchStartTime:0,touchStart:!1},RightTrigger:{touchStartTime:0,touchStart:!1},RightPinch:{touchStartTime:0,touchStart:!1},Y:{touchStartTime:0,touchStart:!1},X:{touchStartTime:0,touchStart:!1},A:{touchStartTime:0,touchStart:!1},B:{touchStartTime:0,touchStart:!1}},n.xrManager.machineType==="VP"&&n.initHandEvent(),n):(console.error("获取session失败，请退出重试"),n)}return t.parseArgs=function(r){if(r instanceof t)return r;var n=__assign(__assign({},r),{maxLatitude:Math.PI/2,minLatitude:-Math.PI/2});return e.parseArgs.call(this,n)},t.initAnimationEndState=function(r){var n=this.parseArgs(r),o=e.initAnimationEndState.call(this,n);return __assign(__assign({},o),{mode:"XRPanorama"})},t.prototype.updateConfiguration=function(r){return e.prototype.updateConfiguration.call(this,__assign(__assign({},r),{maxLatitude:Math.PI/2,minLatitude:-Math.PI/2}))},t.prototype.moveToPano=function(r,n,o){var s=this,l,u,c,h,f=(l=n.effect)!==null&&l!==void 0?l:"fade";this.userAction=o,this.stopMomentumMovement();var m=this.works.getResolvedObserver(r);if(!m)throw new Error("Invalid PanoIndex");var y=getImageSizeFromURL(m.images.up),A=this.imageOptions.size;typeof A>"u"&&m&&y&&(A=Number(y)),typeof A>"u"&&(A=2048);var M=this.imageOptions.transform,b=function(z,H){return mapPanoResource(applyImageURLOptions(z,M,H))},T=__assign({key:"pano.".concat(m.panoId)},pick(this.imageOptions,["format","size","quality"])),_=m.images,S=(c=(u=m.images.tiles)===null||u===void 0?void 0:u.filter(function(z){return z.size>A}))!==null&&c!==void 0?c:null,C="pano:"+jsonHash([_,T,M]);if(this.pendingTextureTask){if(this.pendingTextureTask.hash===C)return;var P=this.pendingTextureTask.panoId;(h=this.panoMeshes[P])===null||h===void 0||h.setProgress(0),this.emit("pano.texture.abort",createEvent("pano.texture.abort",{error:null,progress:0,meta:null,pano:m.pano}))}var F=this.models.getMaterial()||{},O=F.pano0,N=F.pano1,V;if((O==null?void 0:O.map.name)===C?V=O:(N==null?void 0:N.map.name)===C&&(V=N),V){var q={panoId:m.panoId,effect:f,leftPanoPicture:{zoom:1,map:V.map,luminanceMap:V.luminanceMap,matrix:new Matrix4().compose(m.position,m.quaternion,PANO_TEXTURE_SCALE)},position:m.position.clone(),fixCameraTransform:new Matrix4};this.doMoveToPano(m.pano,q,n);return}var Q="move-to-pano-"+m.panoId;this.pending.add(Q),this.pendingTextureTask={panoId:m.panoId,hash:C,onLoad:function(z){if(s.pending.delete(Q),s.destroyed)z.body.dispose();else{z.body.name=C;var H={panoId:m.panoId,effect:f,leftPanoPicture:{zoom:1,map:z.body,luminanceMap:null,matrix:new Matrix4().compose(m.position,m.quaternion,PANO_TEXTURE_SCALE)},position:m.position.clone(),fixCameraTransform:new Matrix4};s.doMoveToPano(m.pano,H,n)}},onError:function(z){s.pending.delete(Q);var H=__assign(__assign(__assign({},m.pano),{mode:s.mode}),clonePose(s.camera.pose));s.emit("pano.error",createEvent("pano.error",{error:z,userAction:s.userAction,options:n,prevPano:s.currentPano,progress:0,state:H})),s.emit("pano.cancel",createEvent("pano.cancel",{error:null,userAction:s.userAction,options:n,prevPano:s.currentPano,progress:0,state:H})),n.moveCancelCallback&&n.moveCancelCallback()}},Promise.all([this.tileLevelForFov&&S&&S.length?this.textureLoader.loadTiledCubeTexture(_,S,{tileMaxLevel:this.tiledCubeTextureLevel,imageURL:{transform:b,options:T},format:RGBAFormat,minFilter:LinearFilter,magFilter:LinearFilter,generateMipmaps:!1,viaAjax:!0,fetcher:getFetcher(m.work)},void 0,void 0,function(z){var H,W;s.emit("pano.texture.progress",createEvent("pano.texture.progress",{error:null,progress:z,meta:null,pano:m.pano})),((H=s.pendingTextureTask)===null||H===void 0?void 0:H.hash)===C&&((W=s.panoMeshes[m.panoId])===null||W===void 0||W.setProgress(z))},this.renderer):this.textureLoader.loadCubeTexture(_,{imageURL:{transform:b,options:T},format:RGBAFormat,fetcher:getFetcher(m.work)},void 0,void 0,function(z){var H,W;((H=s.pendingTextureTask)===null||H===void 0?void 0:H.hash)===C&&((W=s.panoMeshes[m.panoId])===null||W===void 0||W.setProgress(z)),s.emit("pano.texture.progress",createEvent("pano.texture.progress",{error:null,progress:z,meta:null,pano:m.pano}))},this.renderer)]).then(function(z){var H,W,J=z[0];((H=s.pendingTextureTask)===null||H===void 0?void 0:H.hash)===C?(s.pendingTextureTask.onLoad(J),(W=s.panoMeshes[m.panoId])===null||W===void 0||W.setProgress(0),delete s.pendingTextureTask,s.emit("pano.texture.success",createEvent("pano.texture.success",{error:null,progress:1,meta:J.meta,pano:m.pano}))):J.body.dispose()}).catch(function(z){var H,W;((H=s.pendingTextureTask)===null||H===void 0?void 0:H.hash)===C&&(s.pendingTextureTask.onError(z),(W=s.panoMeshes[m.panoId])===null||W===void 0||W.setProgress(0),delete s.pendingTextureTask,s.emit("pano.texture.error",createEvent("pano.texture.error",{error:z,progress:0,meta:null,pano:m.pano})),s.emit("error",z))}),this.emit("pano.texture.load",createEvent("pano.texture.load",{error:null,progress:0,meta:null,pano:m.pano}))},t.prototype.doMoveToPano=function(r,n,o){var s=this,l,u,c,h,f,m,y,A,M,b;o===void 0&&(o={});var T=now(),_=createUuid();this.panoResources[_]=n;var S=1,C,P,F;if(this.locationMotion.ended){var O=this.locationMotion.getKeyFrameSegment(T);O[0];var N=O[1],V=this.locationMotion.value,q=this.panoResourceFromLocationMotionKeyframe(N).position,Q=n.position;C=Math.max(q.distanceTo(Q),S),P=[{key:N.key,progress:0,value:__assign(__assign({},V),{count:0})},{key:_,progress:1,value:{distance:0,count:1}}],F=0}else{var z=this.locationMotion.getKeyFrameSegment(T),H=z[0],N=z[1],V=this.locationMotion.value,W=this.panoResourceFromLocationMotionKeyframe(H).position,q=this.panoResourceFromLocationMotionKeyframe(N).position,Q=n.position,J=N.value.count-V.count,G=Math.max(W.distanceTo(q),S)*J,te=Math.max(q.distanceTo(Q),S);C=G+te,P=[{key:H.key,progress:0,value:__assign({},V)},{key:N.key,progress:G/C,value:N.value},{key:_,progress:1,value:{count:N.value.count+1,distance:0}}];var X=this.locationMotionKeyframesLength(this.locationMotion.keyframes),K=this.locationMotionKeyframesLength(P);F=this.locationMotion.getProgressVelocity(T)*X/K}var Z=n.effect==="instant"?0:this.calculateMovingDuration(o.duration,n.effect==="fly"?C:0),ee={longitude:o.longitude,latitude:o.latitude,fov:o.fov},j=__assign(__assign({},r),{mode:this.mode,longitude:(l=ee.longitude)!==null&&l!==void 0?l:this.camera.pose.longitude,latitude:(u=ee.latitude)!==null&&u!==void 0?u:this.camera.pose.latitude,fov:(c=ee.fov)!==null&&c!==void 0?c:this.camera.pose.fov,offset:n.position.clone(),distance:0}),re=this.currentPano;if(this.emit("pano.moveTo",createEvent("pano.moveTo",{options:o,prevPano:re,progress:0,state:j,userAction:this.userAction,error:null})),o.moveStartCallback&&o.moveStartCallback(j),this.videoTexture&&this.videoTexture.image instanceof HTMLVideoElement&&this.videoTexture.image.getAttribute("src")&&(this.videoTexture.image.pause(),this.videoTexture.image.removeAttribute("uuid"),this.videoTexture.image.removeAttribute("src"),this.videoTexture.image.oncanplay=noop$1,this.videoTexture.needsUpdate=!0),this.panoVideo.setMaterial(null),n.effect==="fly")this.cameraMotion.set(ee,Z).catch(noop$1);else{var pe=coordinatesToVector({longitude:this.cameraMotion.value.longitude,latitude:this.cameraMotion.value.latitude}),ge=coordinatesToVector({longitude:(h=ee.longitude)!==null&&h!==void 0?h:this.cameraMotion.value.longitude,latitude:(f=ee.latitude)!==null&&f!==void 0?f:this.cameraMotion.value.latitude}),_e=new Object3D;_e.lookAt(pe);var he=new Matrix4().makeRotationFromQuaternion(_e.quaternion);_e.lookAt(ge);var Fe=new Matrix4().makeRotationFromQuaternion(_e.quaternion),Re=new Matrix4().getInverse(he).premultiply(Fe),Le=this.cameraMotion.value.fov,Se=(m=ee.fov)!==null&&m!==void 0?m:this.cameraMotion.value.fov,we=1;n.effect==="zoomin"?we=1.5:n.effect==="zoomout"&&(we=.4);for(var Ve=Se*we,je=0;je<P.length-1;je++){var st=P[je].key;if(st){var We=this.panoResources[st];We&&(We.fixCameraTransform.copy(Re),We.leftPanoPicture&&(We.leftPanoPicture.zoom=Math.tan(Le/2/180*Math.PI)/Math.tan(Ve/2/180*Math.PI)))}}this.cameraMotion.setKeyframes([{progress:0,value:{longitude:this.cameraMotion.value.longitude,latitude:this.cameraMotion.value.latitude,fov:this.cameraMotion.value.fov}},{progress:0,value:{longitude:(y=ee.longitude)!==null&&y!==void 0?y:this.cameraMotion.value.longitude,latitude:(A=ee.latitude)!==null&&A!==void 0?A:this.cameraMotion.value.latitude,fov:Ve}},{progress:1,value:{longitude:(M=ee.longitude)!==null&&M!==void 0?M:this.cameraMotion.value.longitude,latitude:(b=ee.latitude)!==null&&b!==void 0?b:this.cameraMotion.value.latitude,fov:Se}}],Z).catch(noop$1)}var bt=this.locationMotion.setKeyframes(P,Z,F);bt.then(function(){for(var oe,ue,Qe,Me=0,De=s.models;Me<De.length;Me++){var be=De[Me];be.show()}var ze=__assign(__assign({},r),{mode:s.mode,longitude:s.camera.pose.longitude,latitude:s.camera.pose.latitude,fov:s.camera.pose.fov,offset:s.camera.pose.offset.clone(),distance:0});s.emit("pano.arrived",createEvent("pano.arrived",{options:o,prevPano:re,progress:1,state:ze,userAction:s.userAction,error:null})),o.moveEndCallback&&o.moveEndCallback(ze);var at=s.works.getResolvedObserver(s.currentPano);if(at&&at.video&&s.videoTexture&&s.videoTexture.image instanceof HTMLVideoElement){var ot=ROTATE_Y_PI_MATRIX.clone().multiply((Qe=(ue=(oe=s.models.getMaterial())===null||oe===void 0?void 0:oe.pano1)===null||ue===void 0?void 0:ue.matrix)!==null&&Qe!==void 0?Qe:new Matrix4).multiply(at.video.matrix),nt={map:s.videoTexture,size:at.video.size,matrix:ot,alpha:1},Ue=createUuid(),He=s.videoTexture.image;He.setAttribute("uuid",Ue),canplayVideo().then(function(qe){qe&&at.video&&He.getAttribute("uuid")===Ue&&(He.oncanplay=function(){He.oncanplay=noop$1,He.play()},He.ontimeupdate=function(){He.currentTime>.5&&(He.ontimeupdate=noop$1,s.panoVideo.setMaterial(nt))},He.src=at.video.source)}).catch(function(){He.removeAttribute("uuid")})}},function(){s.emit("pano.cancel",createEvent("pano.cancel",{options:o,prevPano:re,progress:0,state:j,userAction:s.userAction,error:null})),o.moveCancelCallback&&o.moveCancelCallback()})},t.prototype.checkSelectedPano=function(r){var n=this,o,s,l,u;this.stopMomentumMovement();var c=this.camera.getDirection(new Vector3).setY(0),h=null,f=this.works.getResolvedObserver(this.currentPano);if(!f)return null;var m=f.accessibleIds.filter(function(ge){var _e=panoParse(ge);if(panoEqual(_e,n.currentPano))return!1;var he=n.works.getResolvedObserver(_e);return!he||he.position.distanceTo(n.camera.position)>n.maxAccessibleDistance?!1:he.loadable||he.active}),y=this.models.intersectRaycaster(r)[0];if(y){var A=arrayMin(m,function(ge){var _e=n.works.getResolvedObserver(ge);if(!_e)return 1/0;var he=_e.standingPosition.clone();return he.distanceTo(y.point)},!0),M=A[0],b=A[1];M&&b<this.panoTapTriggerRadius&&(h=(o=this.works.getResolvedObserver(M))!==null&&o!==void 0?o:null)}if(isNil(h)){var T=this.getForwardObserverOrNot(r);T&&(h=T)}for(var _=0,S=this.locationMotion.keyframes;_<S.length;_++){var C=S[_],P=this.panoResourceFromLocationMotionKeyframe(C);if(!(C.progress<this.locationMotion.progress)&&h&&P.panoId===h.panoId){h=null;break}}if(isNil(h))return this.locationMotion.ended===!0&&this.cameraBounce(),null;if(h&&!h.active){var F=h.panoId;this.panoMeshes[F]&&(this.panoMeshes[F].setDisabled(!1),this.panoMeshes[F].setLoading(!0))}var O={};if(h){for(var N=Math.PI/6,V=Math.PI/12,q=new Vector3(0,1,0),Q=h.position.clone().setY(0).sub(f.position.clone().setY(0)).normalize(),z=Q.clone().applyAxisAngle(q,N),H=Q.clone().applyAxisAngle(q,-N),W=[],J=[],G=[],te=0,X=h.accessibleIds;te<X.length;te++){var M=X[te],K=panoParse(M);if(!(panoEqual(K,this.currentPano)||panoEqual(K,h.pano))){var Z=this.works.getResolvedObserver(M);if(Z){var ee=Z.position.clone().sub(h.position).setY(0);Q.angleTo(ee)<N?G.push(ee):z.angleTo(ee)<N?W.push(ee):H.angleTo(ee)<N&&J.push(ee)}}}var j=G.length>0?G:__spreadArray(__spreadArray([],W,!0),J,!0),re=j.slice().sort(function(ge,_e){return ge.angleTo(Q)-_e.angleTo(Q)})[0];re&&re.angleTo(c)>V&&(O.longitude=Math.atan2(-re.x,-re.z))}this.cameraMotion.value.latitude<-Math.PI/4&&(O.latitude=clamp$1(0,this.minLatitude,this.maxLatitude)),this.cameraMotion.value.fov<60&&(O.fov=this.defaultFov);var pe={workCode:h.pano.workCode,panoIndex:h.pano.panoIndex,mode:this.mode,longitude:(s=O.longitude)!==null&&s!==void 0?s:this.camera.pose.longitude,latitude:(l=O.latitude)!==null&&l!==void 0?l:this.camera.pose.latitude,fov:(u=O.fov)!==null&&u!==void 0?u:this.camera.pose.fov,distance:0,offset:h?h.position.clone():new Vector3};return this.emit("pano.select",createEvent("pano.select",{prevPano:this.currentPano,state:pe,userAction:!0,options:O,progress:0,error:null})),h&&h.active?(this.emit("pano.request",createEvent("pano.request",{userAction:!0,prevPano:this.currentPano,progress:0,state:pe,options:O,error:null})),h.pano):null},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.isReady=function(){return!1},t.prototype.updateCamera=function(r,n,o){return Promise.resolve()},t.prototype.updateCameraWithKeyframes=function(r,n,o){return Promise.resolve()},t.prototype.updateTime=function(r,n){for(var o=this,s,l,u,c,h,f,m,y,A=[],M=2;M<arguments.length;M++)A[M-2]=arguments[M];this.userAction=!0;var b={},T={},_=this.panoResourceFromLocationMotionKeyframe(this.locationMotion.keyframes[0]),S=this.panoResourceFromLocationMotionKeyframe(this.locationMotion.keyframes[this.locationMotion.keyframes.length-1]),C=!1;if(this.cameraMotion.ended===!1&&(this.cameraMotion.update(r),T.longitude=this.cameraMotion.value.longitude,T.latitude=this.cameraMotion.value.latitude,T.fov=this.cameraMotion.value.fov),this.modelAlphaMotion.ended===!1&&(this.modelAlphaMotion.update(r),b.modelAlpha=this.modelAlphaMotion.value.modelAlpha),this.perspToOrthoMotion.ended===!1&&(this.perspToOrthoMotion.update(r),this.camera.perspToOrtho.setScalar(clamp$1(this.perspToOrthoMotion.value.perspToOrtho,0,1))),this.locationMotion.ended===!1){this.locationMotion.update(r);var P=this.locationMotion.getKeyFrameSegment(r),F=P[0],O=P[1],N=this.panoResourceFromLocationMotionKeyframe(F),V=this.panoResourceFromLocationMotionKeyframe(O),q=new Vector3().copy(N.position),Q=new Vector3().copy(V.position),z=this.locationMotion.value.count-O.value.count+1;b.progress=z,V.leftPanoPicture&&(z<1?N.leftPanoPicture&&(b.pano0=N.leftPanoPicture):b.pano0=V.leftPanoPicture,b.pano1=V.leftPanoPicture),V.effect==="montage"?b.transition="BLACK":V.effect==="spread"?b.transition="SPREAD":b.transition="FADE",(V.effect==="zoomin"||V.effect==="zoomout")&&(b.progress=Math.pow(z,3)),z<1&&V.effect!=="fly"&&(b.pano0&&N.leftPanoPicture&&(b.pano0={map:b.pano0.map,zoom:b.pano0.zoom,luminanceMap:b.pano0.luminanceMap,matrix:N.leftPanoPicture.matrix.clone().setPosition(V.position)}),q.copy(Q),C=!0),T.distance=this.locationMotion.value.distance,T.offset=new Vector3(q.x+(Q.x-q.x)*z,q.y+(Q.y-q.y)*z,q.z+(Q.z-q.z)*z);for(var H=[],W=[],J=0,G=this.locationMotion.keyframes;J<G.length;J++){var te=G[J],X=te.key,K=te.progress;X!==void 0&&(H.push(X),K>this.locationMotion.progress&&W.push(X))}for(var Z=0,ee=Object.keys(this.panoResources);Z<ee.length;Z++){var j=ee[Z];if(!(W.indexOf(j)>=0)){var re=this.panoResources[j];if(re.leftPanoPicture){var pe=re.leftPanoPicture.map;if(pe){if(pe===((s=b.pano0)===null||s===void 0?void 0:s.map)||pe===((l=b.pano1)===null||l===void 0?void 0:l.map))continue;pe instanceof TileCubeTextureTarget&&pe.cubeRenderTarget&&this.colorCubeRenderTargetPool.push(pe.cubeRenderTarget),pe.dispose(),re.leftPanoPicture=null}}H.indexOf(j)>=0||delete this.panoResources[j]}}this.currentPano=panoParse(V.panoId),this.emit("pano.moving",createEvent("pano.moving",{userAction:this.userAction,prevPano:panoParse(_.panoId),state:__assign(__assign(__assign(__assign({},panoParse(S.panoId)),{mode:this.mode}),clonePose(this.camera.pose)),T),options:{},progress:this.locationMotion.progress,error:null}))}isEmptyObject(b)===!1&&(!((u=b.pano0)===null||u===void 0)&&u.map&&b.pano0.map instanceof TileCubeTextureTarget&&!b.pano0.map.cubeRenderTarget&&(b.pano0.map.cubeRenderTarget=this.colorCubeRenderTargetPool.pop()),!((c=b.pano1)===null||c===void 0)&&c.map&&b.pano1.map instanceof TileCubeTextureTarget&&!b.pano1.map.cubeRenderTarget&&(b.pano1.map.cubeRenderTarget=this.colorCubeRenderTargetPool.pop()),this.models.setMaterial(b)),isEmptyObject(T)===!1&&this.setCamera(T);var ge=this.works.getResolvedObserver(this.currentPano),_e=A[1];if(!_e){console.error("xrFrame丢失，请重试");return}if(!this.xrManager.session){console.error("session丢失，请重试");return}var he=this.xrManager.referenceSpace;if(he){var Fe=this.xrManager.cameraVR,Re=this.xrManager.cameraL,Le=this.xrManager.cameraR,Se=[Re,Le],we=_e.getViewerPose(he),Ve=new Vector3(0,0,0);if(we){var je;je=this.xrManager.session.renderState.baseLayer;var st=we.views;if(!je){console.error("no layer found");return}this.renderer.setFramebuffer(je.framebuffer);var We=!1;st.length!==Fe.cameras.length&&(Fe.cameras.length=0,We=!0),this.parallaxCameraMatrixs=[];var bt=new Vector3,oe=new Vector3;new Matrix4().fromArray(st[0].transform.matrix).decompose(bt,new Quaternion,new Vector3),new Matrix4().fromArray(st[1].transform.matrix).decompose(oe,new Quaternion,new Vector3),oe.clone().sub(bt).normalize();var ue=new Vector3,Qe=new Quaternion,Me=new Vector3;this.camera.matrix.decompose(ue,Qe,Me);for(var De=0;De<st.length;De++){var be=st[De],ze=je.getViewport(be),at=Se[De];at.matrix.fromArray(be.transform.matrix);var ot=new Vector3,nt=new Quaternion,Ue=new Vector3;at.matrix.decompose(ot,nt,Ue),Ve.copy(ue),at.position.copy(ue),at.quaternion.copy(nt),at.scale.copy(Ue),at.updateMatrix(),at.projectionMatrix.fromArray(be.projectionMatrix),at.viewport.set(ze.x,ze.y,ze.width,ze.height),We===!0&&Fe.cameras.push(at)}if(this.xrManager.session&&this.xrManager.session.inputSources){for(var De=0;De<this.xrManager.session.inputSources.length;De++)if(this.xrManager.session.inputSources[De]&&this.xrManager.session.inputSources[De].targetRayMode==="transient-pointer"){var He=_e.getPose(this.xrManager.session.inputSources[De].targetRaySpace,he);if(He){var qe=new Vector3(0,0,-1).applyQuaternion(He.transform.orientation),ke=new Raycaster(this.camera.position,qe);this.gazeRay=ke}}}if(this.xrManager.machineType==="Oculus"||this.xrManager.machineType==="Pico"){for(var ve=this.xrManager.session.inputSources,De=0;De<ve.length;De++){var Ye=this.xrManager.controllers[De],tt=ve[De];if(tt){Ye&&Ye.update(tt,_e,he);var ke=this.xrManager.getController(De),xt=new Vector3(0,1.2,0),Ze=ke.position.clone().add(Ve).sub(xt);tt.handedness==="left"?this.xrControllerRay.left.set(Ze,new Vector3(0,0,-1).applyEuler(ke.rotation)):tt.handedness==="right"&&this.xrControllerRay.right.set(Ze,new Vector3(0,0,-1).applyEuler(ke.rotation)),this.controllerWrappers[De].position.copy(new Vector3(0,0,0).add(Ve).sub(xt));var lt=this.models.intersectRaycaster(this.xrControllerRay.right);if(lt.length===0&&(lt=this.xrControllerRay.right.intersectObject(this.boundingMesh,!0).map(function(pr){var fr;return __assign({floor:(fr=ge==null?void 0:ge.floorIndex)!==null&&fr!==void 0?fr:0},pr)})),lt.length>=1&&lt[0].face)if(tt.handedness==="right"){var Pt=this.xrControllerRay.right.intersectObject(this.xrCustomObjectsScene,!0),Lt=lt[0].face.normal,Gt=Lt.clone(),Rt=lt[0].point.clone();this.intersectMesh.position.copy(Rt);var Ft=Rt.clone().add(Gt);if(this.intersectMesh.lookAt(Ft),Math.abs(Lt.y)>.99){var Nt=this.camera.position.clone().sub(Rt);this.intersectMesh.rotation.z=-Math.atan2(Nt.z,Nt.x)}this.intersectMesh.visible=!0,this.needsRender=!0,Pt.length>0?(this.pointerLines.right.setPoints(Ze,Pt[0].point),this.pointerLines.right.points.visible=!0,this.intersectMesh.visible=!1):(this.pointerLines.right.points.visible=!1,this.pointerLines.right.setPoints(Ze,lt[0].point));var Ht=lt[0],or=createEvent("intersect.update",{raycaster:(h=this.xrControllerRay.right)!==null&&h!==void 0?h:null,intersection:Ht??null,object:this.intersectMesh});if(this.emit("intersect.update",or),or.defaultPrevented){this.hideIntersectMesh();return}}else this.pointerLines.left.setPoints(Ze,lt[0].point)}}this.updateControllerHelper(ve,r,n)}if(this.camera.pose.distance>.1||C)for(var Xt=0,Zt=Object.keys(this.panoMeshes);Xt<Zt.length;Xt++){var ae=Zt[Xt],Pe=this.panoMeshes[ae];Pe.setOpacity(0),Pe.setCurrent(!1),Pe.updateTime&&Pe.updateTime(r,n),Pe.visible=!1}else if(ge){var Te=arrayMin(ge.visibleIds,function(jt){var kt=o.works.getResolvedObserver(jt);return kt?ge.standingPosition.distanceTo(kt.standingPosition):1/0},!0),Ne=Te[1];Ne=clamp$1(Ne,2.5,1/0);for(var it=ge.visibleIds.concat(panoStringify(this.currentPano)),ft=this.getForwardObserverOrNot(),gt=this.camera.getDirection(new Vector3),ut=0,vt=Object.keys(this.panoMeshes);ut<vt.length;ut++){var ae=vt[ut],Pe=this.panoMeshes[ae],yt=this.works.getResolvedObserver(ae);if(it.indexOf(ae)===-1)Pe.setCurrent(!1),Pe.setOpacity(0);else if(!yt)Pe.setCurrent(!1),Pe.setOpacity(0);else if(!yt.loadable&&!yt.active)Pe.setCurrent(!1),Pe.setOpacity(0);else{var Ot=Pe.position.clone().setY(this.camera.position.y).distanceTo(this.camera.position);Pe.setCurrent(!Pe.loading&&Pe.progress===0&&ft!==null&&ft.panoId===ae),Pe.setOpacity(Ot<.01?0:clamp$1(Ne/Ot*1.2,.65,.98));var It=this.camera.position.clone().setY(Pe.position.y),qe=new Vector3().copy(Pe.position).sub(It).normalize();if(ae===panoStringify(this.currentPano)){var Tt=clamp$1((.5-It.distanceTo(Pe.position))/.5,0,1);qe.multiplyScalar(1-Tt).add(gt.clone().multiplyScalar(Tt))}qe.length()>0&&Pe.quaternion.setFromEuler(new Euler(0,Math.atan2(qe.x,qe.z),0))}Pe.updateTime&&Pe.updateTime(r,n)}}var ht=function(){return 4}(),St=function(){var jt=new PerspectiveCamera;jt.applyMatrix4(Fe.matrix),jt.position.set(0,0,0);var kt=o.works.getResolvedObserver(S.panoId),pr=kt??ge;pr&&jt.quaternion.premultiply(pr.quaternion.clone().inverse()),jt.updateProjectionMatrix(),jt.updateMatrixWorld(!0);var fr=new Frustum().setFromProjectionMatrix(new Matrix4().multiplyMatrices(jt.projectionMatrix,jt.matrixWorldInverse));return fr}();S.panoId===panoStringify(this.currentPano)&&((f=S.leftPanoPicture)===null||f===void 0?void 0:f.map)instanceof TileCubeTextureTarget&&(S.leftPanoPicture.map.maxRequest=this.tileMaxRequest,S.leftPanoPicture.map.update(St,ht),S.leftPanoPicture.map.needsRender===!0&&(this.needsRender=!0,this.modelSceneNeedsRender=!0));{var zt=this.tiling.object.visible;if(this.initAnimationed){var Dt=S.panoId,Et=this.works.getResolvedObserver(Dt);Et?isSimilarVector3(this.camera.position,Et.position)&&this.locationMotion.ended?(this.tiling.object.visible=!0,this.tiling.panoId!==Dt&&this.tiling.cleanup(),this.tiling.panoId=Dt,this.tiling.setResource((y=(m=Et.images)===null||m===void 0?void 0:m.tiles)!==null&&y!==void 0?y:[],this.enableIOSEDR&&Et.images.luminance?Et.images.luminance:null),this.tiling.setFetcher(getFetcher(Et.work)),this.tiling.setRotation(Et.quaternion),this.tiling.setPosition(Et.position),this.tiling.maxRequest=this.tileMaxRequest,ht>this.tiledCubeTextureLevel?this.tiling.update(St,ht,r):this.tiling.update(St,0,r)):this.tiling.object.visible=!1:this.tiling.object.visible=!1}else this.tiling.object.visible=!1;zt!==this.tiling.object.visible&&(this.tiling.object.needsRender=!0,this.modelSceneNeedsRender=!0)}this.panoVideo.object.position.copy(this.camera.position),this.panoVideo.updateTime(r)}}},t.prototype.render=function(){var r=this.xrManager.getCamera(this.camera);this.renderer.render(this.modelScene,r),this.renderer.autoClearColor=!1,this.renderer.autoClearDepth=!1,this.renderer.render(this.scene,r),this.renderer.autoClearColor=!0,this.renderer.autoClearDepth=!0},t.prototype.onPanGesture=function(){},t.prototype.onTapGesture=function(){},t.prototype.onPinchGesture=function(){},t.prototype.onMouseMove=function(){},t.prototype.onMouseOut=function(){},t.prototype.panoResourceFromLocationMotionKeyframe=function(r){return this.panoResources[r.key]},t.prototype.updateControllerHelper=function(r,n,o){var s=this.xrControllerRay.left,l=this.xrControllerRay.right;if(!(!r||r.length===0)){for(var u={buttons:{X:!1,Y:!1,LeftTrigger:!1,LeftPinch:!1,A:!1,B:!1,RightTrigger:!1,RightPinch:!1}},c=0;c<r.length;c++){var h=r[c].handedness,f=r[c].gamepad;switch(h){case"left":f.axes&&(this.emitHandleEvent(f.axes[2]===-1,"LeftAxesLeft",n),this.emitHandleEvent(f.axes[2]===1,"LeftAxesRight",n),this.emitHandleEvent(f.axes[3]===-1,"LeftAxesUp",n),this.emitHandleEvent(f.axes[3]===1,"LeftAxesDown",n)),f!=null&&f.buttons&&(f.buttons[4]&&this.emitHandleEvent(f.buttons[4].pressed,"X",n),f.buttons[5]&&this.emitHandleEvent(f.buttons[5].pressed,"Y",n),f.buttons[0]&&this.emitHandleEvent(f.buttons[0].pressed,"LeftTrigger",n),f.buttons[1]&&this.emitHandleEvent(f.buttons[1].pressed,"LeftPinch",n));var m={raycaster:s,axes:{up:f.axes&&f.axes[3]<0?Math.abs(f.axes[3]):0,down:f.axes&&f.axes[3]<0?0:Math.abs(f.axes[3]),left:f.axes&&f.axes[2]<0?Math.abs(f.axes[2]):0,right:f.axes&&f.axes[2]<0?0:Math.abs(f.axes[2])},deltaTime:o};u.buttons.X=f.buttons&&f.buttons[4]?f.buttons[4].pressed:!1,u.buttons.Y=f.buttons&&f.buttons[5]?f==null?void 0:f.buttons[5].pressed:!1,u.buttons.LeftTrigger=f.buttons&&f.buttons[0]?f==null?void 0:f.buttons[0].pressed:!1,u.buttons.LeftPinch=f.buttons&&f.buttons[1]?f==null?void 0:f.buttons[1].pressed:!1,u.left=m;break;case"right":f.axes&&(this.emitHandleEvent(f.axes[2]===-1,"RightAxesLeft",n),this.emitHandleEvent(f.axes[2]===1,"RightAxesRight",n),this.emitHandleEvent(f.axes[3]===-1,"RightAxesUp",n),this.emitHandleEvent(f.axes[3]===1,"RightAxesDown",n)),f.buttons&&(f.buttons[4]&&this.emitHandleEvent(f.buttons[4].pressed,"A",n),f.buttons[5]&&this.emitHandleEvent(f.buttons[5].pressed,"B",n),f.buttons[0]&&this.emitHandleEvent(f.buttons[0].pressed,"RightTrigger",n),f.buttons[1]&&this.emitHandleEvent(f.buttons[1].pressed,"RightPinch",n));var y={raycaster:l,axes:{up:f.axes&&f.axes[3]<0?Math.abs(f.axes[3]):0,down:f.axes&&f.axes[3]<0?0:Math.abs(f.axes[3]),left:f.axes&&f.axes[2]<0?Math.abs(f.axes[2]):0,right:f.axes&&f.axes[2]<0?0:Math.abs(f.axes[2])},deltaTime:o};u.right=y,u.buttons.A=f.buttons&&f.buttons[4]?f==null?void 0:f.buttons[4].pressed:!1,u.buttons.B=f.buttons&&f.buttons[5]?f==null?void 0:f.buttons[5].pressed:!1,u.buttons.RightTrigger=f.buttons&&f.buttons[0]?f==null?void 0:f.buttons[0].pressed:!1,u.buttons.RightPinch=f.buttons&&f.buttons[1]?f==null?void 0:f.buttons[1].pressed:!1;break}}this.emit("xr.controller.update",createEvent("xr.controller.update",u))}},t.prototype.emitHandleEvent=function(r,n,o){var s=this.xrControllerRay.left,l=this.xrControllerRay.right;if(r)if(this.xrHandleState[n].touchStart===!1)this.xrHandleState[n].touchStartTime=o,this.xrHandleState[n].touchStart=!0,this.emit("xr.gesture.buttonDown",createEvent("xr.gesture.buttonDown",{session:this.xrManager.session,machineType:this.xrManager.machineType,buttons:n,isFinal:!1,isFirst:!0,controllers:{raycaster:{leftRay:s,rightRay:l}}}));else{var u=o-this.xrHandleState[n].touchStartTime;u>CONTROLLER_EVNET_DELTA_TIME&&this.emit("xr.gesture.press",createEvent("xr.gesture.tap",{session:this.xrManager.session,machineType:this.xrManager.machineType,buttons:n,isFinal:!0,isFirst:!0,controllers:{raycaster:{leftRay:s,rightRay:l}}}))}else if(this.xrHandleState[n].touchStart===!0){this.emit("xr.gesture.buttonUp",createEvent("xr.gesture.buttonUp",{session:this.xrManager.session,machineType:this.xrManager.machineType,buttons:n,isFinal:!0,isFirst:!1,controllers:{raycaster:{leftRay:s,rightRay:l}}}));var u=o-this.xrHandleState[n].touchStartTime;if(u<=CONTROLLER_EVNET_DELTA_TIME){var c=createEvent("xr.gesture.tap",{session:this.xrManager.session,machineType:this.xrManager.machineType,buttons:n,isFinal:!0,isFirst:!1,controllers:{raycaster:{leftRay:s,rightRay:l}}}),h=this.emit("xr.gesture.tap",c);!h&&!c.defaultPrevented&&n==="RightTrigger"&&this.checkSelectedPano(this.xrControllerRay.right)}this.xrHandleState[n].touchStart=!1,this.xrHandleState[n].touchStartTime=0}},t.prototype.initHandEvent=function(){var r=this;if(!this.xrManager.session)throw new Error("初始化失败");this.xrManager.session.addEventListener("select",function(n){r.gazeRay&&r.checkSelectedPano(r.gazeRay)})},t}(PanoramaController),Controllers={Floorplan:FloorplanController,Topview:TopviewController,Panorama:PanoramaController,VRPanorama:VRPanoramaController,Model:ModelController,Mapview:MapviewController,XRPanorama:XRPanoramaController},PROXY_CONTROLLER_EVENT_NAMES=["gesture.pan","gesture.tap","gesture.dbltap","gesture.press","gesture.pinch","gesture.mousewheel","gesture.mousemove","gesture.momentum","initAnimation.start","initAnimation.end","camera.update","intersect.update","pano.select","pano.moveTo","pano.moving","pano.arrived","pano.cancel","pano.error","pano.texture.load","pano.texture.progress","pano.texture.success","pano.texture.error","pano.texture.abort","xr.session.start","xr.session.end","xr.gesture.tap","xr.gesture.press","xr.gesture.buttonUp","xr.gesture.buttonDown","xr.controller.update"];function initLegacyEvent(e){e.on("initAnimation.start",function(t){e.emit("initAnimationWillStart",t.state.panoIndex,t.state,t.userAction)}),e.on("initAnimation.end",function(t){e.emit("initAnimationEnded",t.state.panoIndex,t.state,t.userAction)}),e.on("gesture.pan",function(t){var r=!1;r=e.emit("wantsGesture","pan",t.pointers,t.isFinal),r&&t.preventDefault(),r=e.emit("wantsPanGesture",t.state,t.isFinal),r&&t.preventDefault(),t.defaultPrevented||(e.emit("gesture","pan",t.pointers,t.isFinal),e.emit("panGesture",t.state,t.isFinal))}),e.on("gesture.tap",function(t){var r=!1;r=e.emit("wantsGesture","tap",t.pointers,t.isFinal),r&&t.preventDefault(),r=e.emit("wantsTapGesture",t.center.raycaster,t.center.coords,t.isFinal),r&&t.preventDefault(),t.defaultPrevented||(e.emit("gesture","tap",t.pointers,t.isFinal),e.emit("tapGesture",t.center.raycaster,t.center.coords,t.isFinal))}),e.on("gesture.dbltap",function(t){var r=!1;r=e.emit("wantsGesture","dbltap",t.pointers,t.isFinal),r&&t.preventDefault(),r=e.emit("wantsDblTapGesture",t.center.raycaster,t.center.coords,t.isFinal),r&&t.preventDefault(),t.defaultPrevented||(e.emit("gesture","dbltap",t.pointers,t.isFinal),e.emit("dblTapGesture",t.center.raycaster,t.center.coords,t.isFinal))}),e.on("gesture.press",function(t){var r=!1;r=e.emit("wantsGesture","press",t.pointers,t.isFinal),r&&t.preventDefault(),r=e.emit("wantsPressGesture",t.center.raycaster,t.center.coords,t.center.delta,t.isFinal),r&&t.preventDefault(),t.defaultPrevented||(e.emit("gesture","press",t.pointers,t.isFinal),e.emit("pressGesture",t.center.raycaster,t.center.coords,t.center.delta,t.isFinal))}),e.on("gesture.pinch",function(t){var r=!1;r=e.emit("wantsGesture","pinch",t.pointers,t.isFinal),r&&t.preventDefault(),r=e.emit("wantsPinchGesture",t.scale,t.state.fov,t.isFinal),r&&t.preventDefault(),t.defaultPrevented||(e.emit("gesture","pinch",t.pointers,t.isFinal),e.emit("pinchGesture",t.scale,t.state.fov,t.isFinal))}),e.on("gesture.mousewheel",function(t){var r=!1;r=e.emit("wantsGesture","mouseWheel",t.pointers,t.isFinal),r&&t.preventDefault(),r=e.emit("wantsMouseWheel",t.center.delta,t.state.fov,t.isFinal),r&&t.preventDefault(),t.defaultPrevented||(e.emit("gesture","mouseWheel",t.pointers,t.isFinal),e.emit("mouseWheel",t.center.delta,t.state.fov,t.isFinal))}),e.on("gesture.mousemove",function(t){var r=!1;r=e.emit("wantsGesture","mouseMove",t.pointers,t.isFinal),r&&t.preventDefault(),t.defaultPrevented||(e.emit("gesture","mouseMove",t.pointers,t.isFinal),r=e.emit("wantsChangeCameraFov",t.state.fov),r&&t.preventDefault())}),e.on("gesture.momentum",function(t){var r=!1;r=e.emit("wantsInteriaPan",t.state),r&&t.preventDefault(),t.defaultPrevented||e.emit("interiaPan",t.state,t.isFinal)}),e.on("camera.update",function(t){e.emit("cameraFovUpdate",t.state.fov,t.userAction),e.emit("cameraDirectionUpdate",t.state,t.userAction);var r=coordinatesToVector(t.state);r.setLength(t.state.distance);var n=t.state.offset.clone().sub(r);e.emit("cameraPositionUpdate",n,t.userAction),e.emit("cameraUpdate",t.state,t.userAction)}),e.on("intersect.update",function(t){if(t.intersection){var r=!1;r=e.emit("wantsShowIntersectionOnModel",t.raycaster),r&&t.preventDefault(),t.defaultPrevented||e.emit("intersectionOnModelUpdate",t.intersection,t.object)}else e.emit("intersectionHidden")}),e.on("pano.request",function(t){var r=e.emit("wantsMoveToPano",t.state.panoIndex,t.options,t.userAction);r||(r=e.emit("wantsToMoveToPano",t.state.panoIndex,t.options,t.userAction)),r&&t.preventDefault(),t.defaultPrevented||e.emit("panoWillLoad",t.state.panoIndex)}),e.on("pano.select",function(t){e.emit("panoSelected",t.state.panoIndex)}),e.on("pano.moveTo",function(t){e.emit("panoLoaded",t.state.panoIndex),e.emit("moveToPano",t.state.panoIndex,t.userAction),e.emit("panoWillArrive",t.state.panoIndex,t.state,t.userAction)}),e.on("pano.moving",function(t){e.emit("movingToPano",t.state.panoIndex,t.prevPano.panoIndex,t.progress)}),e.on("pano.arrived",function(t){e.emit("panoArrived",t.state.panoIndex,t.state,t.userAction)}),e.on("pano.cancel",function(t){e.emit("moveToPanoCanceled",t.state.panoIndex)}),e.on("pano.error",function(t){e.emit("panoLoadError",t.error,t.state.panoIndex)}),e.on("pano.texture.load",function(t){e.emit("textureStartLoad",t.pano.panoIndex)}),e.on("pano.texture.success",function(t){e.emit("textureLoaded",t.pano.panoIndex,t.meta)}),e.on("pano.texture.error",function(t){e.emit("textureError",t.error,t.pano.panoIndex)}),e.on("pano.texture.abort",function(t){e.emit("textureAbort",t.pano.panoIndex)}),e.on("pano.texture.progress",function(t){e.emit("textureLoading",t.progress,t.pano.panoIndex)}),e.on("xr.session.start",function(t){e.emit("webXRSessionStart")}),e.on("xr.session.end",function(t){e.emit("webXRSessionEnd")}),e.on("xr.gesture.tap",function(t){e.emit("webXRControllerEvent","tap",t.buttons,{raycaster:t.controllers.raycaster})}),e.on("xr.gesture.press",function(t){e.emit("webXRControllerEvent","press",t.buttons,{raycaster:t.controllers.raycaster})}),e.on("xr.gesture.buttonUp",function(t){e.emit("webXRControllerEvent","buttonUp",t.buttons,{raycaster:t.controllers.raycaster})}),e.on("xr.gesture.buttonDown",function(t){e.emit("webXRControllerEvent","buttonDown",t.buttons,{raycaster:t.controllers.raycaster})}),e.on("xr.controller.update",function(t){e.emit("webXRControllerRayUpdate",{leftRay:t.left?t.left.raycaster:void 0,rightRay:t.right?t.right.raycaster:void 0}),t.left&&e.emit("webXRAxesUpdate","left",{raycaster:{leftRay:t.left?t.left.raycaster:void 0,rightRay:t.right?t.right.raycaster:void 0},axesState:{up:t.left.axes.up,down:t.left.axes.down,left:t.left.axes.left,right:t.left.axes.right},deltaTime:t.left.deltaTime}),t.right&&e.emit("webXRAxesUpdate","right",{raycaster:{leftRay:t.left?t.left.raycaster:void 0,rightRay:t.right?t.right.raycaster:void 0},axesState:{up:t.right.axes.up,down:t.right.axes.down,left:t.right.axes.left,right:t.right.axes.right},deltaTime:t.right.deltaTime})}),e.on("works.request",function(t){e.emit("willLoad",t.input,t.works[0],t.state)}),e.on("works.load",function(t){e.emit("load",t.input,t.works[0],t.state)}),e.on("works.ready",function(t){e.emit("loaded",t.input,t.works[0])}),e.on("state.change",function(t){e.emit("stateChange",t.state,t.userAction)}),e.on("currentState.change",function(t){e.emit("currentStateChange",t.state,t.userAction)}),e.on("state.set",function(t){e.emit("setState",t.state)}),e.on("state.synced",function(t){e.emit("stateSynced",t.state)}),e.on("model.request",function(t){e.emit("modelWillLoad",t.work.model)}),e.on("model.error",function(t){e.emit("modelLoadError",t.error,t.model)}),e.on("model.load",function(t){e.emit("modelLoaded",t.model)}),e.on("model.changeShownFloor",function(t){e.emit("modelShownFloorChange",t.model.shownFloor,t.model.floorLength)}),e.on("render",function(t){e.emit("renderFrame",t.needsRender)}),e.on("mode.change.request",function(t){e.emit("wantsChangeMode",t.mode,t.prevMode)}),e.on("mode.change",function(t){e.emit("modeChange",t.mode,t.prevMode,t.state.panoIndex,t.state,t.userAction)}),e.on("helpers.visible",function(t){e.emit("helpersVisibleChange",t.object.visible)}),e.on("network.resource",function(t){e.emit("network",t.source,t.requestType,t.requestState,t.detail)})}function generateDefaultVideoElement(){if(typeof window<"u"){var e=document.createElement("video");e.loop=!0,e.autoplay=!0,e.playsInline=!0,e.muted=!0,e.crossOrigin="";var t=function(){document.removeEventListener("touchstart",t,!1),document.removeEventListener("mousedown",t,!1),e.muted=!1};return document.addEventListener("touchstart",t,!1),document.addEventListener("mousedown",t,!1),e}else return{}}function initLights(e){var t=new Group;t.name="internalLights";{var r=new DirectionalLight(16777215,.3);r.position.copy(new Vector3(1,1,1)),t.add(r)}{var r=new DirectionalLight(16777215,.1);r.position.copy(new Vector3(-1,-1,-1)),t.add(r)}{var r=new DirectionalLight(16777215,.1);t.add(r)}{var r=new AmbientLight(16777215,.6);t.add(r)}e.add(t)}function parseKeyValue(e){for(var t,r,n={},o=e.split(/(\;|\,)/),s=0,l=o;s<l.length;s++){var u=l[s],c=u.split("="),h=(t=c[0])===null||t===void 0?void 0:t.trim(),f=(r=c[1])===null||r===void 0?void 0:r.trim();h&&f&&(n[h]=f)}return n}function getViewportScale(){var e;if(typeof document<"u")for(var t=document.getElementsByTagName("meta"),r=0;r<t.length;r++){var n=t[r];if(n.getAttribute("name")==="viewport"){var o=parseKeyValue((e=n.getAttribute("content"))!==null&&e!==void 0?e:""),s=Number(o["initial-scale"]);if(!isNaN(s))return s}}return 1}const textureURL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAV8AAAA/CAQAAADtPwPkAAAR+0lEQVR4AezYg3LEQACH8d1cbdu23Q5qG9G47z/TN/h6tn2b/H+TUTLc7yjcOXV46OUAnUs6EbUp022ZBXc1NhoZYYd7fjDRvdcHAwrlK2QBVJ4sgoqONmY45RUT23sZ6H42F2hK5CtkMbjhZlDmUUcvq1zyieUVyjbE4I1GBfItwxG56YaUZTQwyh4P6NgJ4YYYvCuQb5kOyI03pORjiqe4Lwpq5pt1vJqfUwKWJVbSMYfppYconG+maNNQOWBZuwHTzicGel75NtFOkxr5apmV8cikcko0DrDQs863AeGl0cE0+1xy573m0/wf0cEKW6H7BWtggiMG8sy3oHRDpJMw4NWb6am/bv9znkqEzjd61t5oo5clTrjhwevO75EJRBKSRt745Z16ZEjcM73sccZplBPm8PyTcxZAkSRdHm/acJ0Z3JZhHB0BxqDHgWFZFmm0ZbCw87twI/zc3e/Cz93vPneXtU/WdQS3oTviXdY/q5PsJKfoGuQjZuO/0in1qsj85cuXrxqeAOJpGqdJOqrUutgVl2Qb0BWqp/RE8AWWVB7t2KrIzY2Wx2fWKl7yfswgxqj8lYummYa3hfwF9MuQRmbfQE4ocPDjtUWQ6Tq1M2w7gC2EcrMGtWS6xlpGKEDDcb1vUQ25zT4lrC2s0dU4gFPppKkbeIYr7NMpqjStuFg5rNU9epGyt8PXyfX4DE1bKLhR/1XPxwJhp5DAV67T9ZPwFdovhBMIGUYoRBN4wim6S3eoXVEHXdLgmwY0x6BQnO4xPJ0Ar5OVxhQF0L9UslRM4yaQQfQImnBegi8vhY2A1k6YLlrj61TwDdNQnIISwiPvpD7TwYQTssZXK47vg8y9Gp2nxRcATkozOEmdCeObSt3IIo+xf/00IDRKAaZ89PBTkHqpkA5LagKeNZKlIhqX8RcQ95GHtdYA62Y6rOg5LLsOSnoyvk4V38hFhytef+V9/3DER1P48W89o1GxE9o5vns2Mk+F7yiftafEN4nhmUv9DKEeyqI0U+l0CQg+B//sZ5+6lOuqKaTgm0LH41RHw/CsLZRk4huiYxrvP2SNr1OSS+Dr1ulBMR+K9SqHa58Oec49VgL3mXHvDr7QfuM7LMNrH1/IS30Moe64SLYBuFVJ+MbnJY7L+GrVQkFcl4ISx/fEll4ZWnz18DpcSzUCX602LqD9svDLzmdaLkP28P1+VsJjsx/4hmh6x/gmm/i6pbrGneCL9iCOg0dQUvF1UwEdVvG19r2uTXxXLz0J37eLjfZoF++tTtPnU/cWp5e8n3An0m/G+U7qjiy4PpHyV16HKx5flCxAV/H9A88nUnZ7l7KN78SBxPcQgzLAepxEScU3l7pZ6fL2+Dot8fXECfj+QRoGYAwlAfBSPrXQXQri0Pd85NJKcVw8XUdt1LZapk7YRhO1RdpmFJwW8ozekYvx2/fjM5Hr5MfQ95HvcY2a/9hoNK4yEntL+dEuGseTdNmxIPqd5v2YRjeaX8pQ8IW2ohuP7+dTN87RMK4aitx8XPsH0r2oBqNRqrv7+gmjjY7uIr6TBxBfL2MlxNRKSVp8S5CTuGgHXxfkFvh69Pq3LD4pkkd2bdRvHaSNC3/l2sQXAccdlIS+lc57qhPJwxPybT7XSxnUrdqnXuHlJHS+mjZfJfUZR9s2FuQR+EQKdSi9Am8UTnsEvlYS+L6TFwW6kl74Vjr6AFHsX89rgg8njRltK0XPOL7NyDL0IurV4VtMwafB1709vu9X4OjWHoP3z1Ii7eaQdG00Lx5n8HXyDSva/dU0Pq2vZnKYxHYMYRo1WY5ov1G7Vh4r3y+kMdgbilxeOrV0aqOFenFl8GGJig7rG0bbPRqiSRpP2AL0w+yon9dHbi43zFetnKcuw9ZLeSa+7kTw/TDfuFu0Z7Vp/uhyHfPkAZ5ufP9wLIfD49E3clR818rR089Lzyy+VRREPneICnYLX9cT8PVKQs36TbQ3i6NcCwYkxEAQ3phN4CjAvC4mFr5vrlKe7AizBKj8cu33s7i9GbeY7BHYujTjjd3Bx54SSyT4m8mxOoYOAGX/DtwvnGE1M+5v5Bgt1hbkJRW9Cxv9X81GL2i5jqaoJ4avBcCsLYp+Ru+VC5sWPpFhXt8/EPvJL2F/alJDEeIjUhcrP5P45rDeATPj+wKl7gBf1fcq+HpVnfHO1vEf//UCHgt/OxfDE3onj5UkfTaThrg3NCGoBUCtZjvgMnwQB0bG5XENeraJ5XEWvtiHkqSVRqN+uQ4lEx2o+69SeY1dC++Wcsj+LCW+H0ZE4KtDWHkGwCtrxstbFqr51e9wbz42E2fpjRQsqEn50PnM4eumO9IbujCi393Hd+3q72TI+p9DPyyfraF+c3rOx0KJyB2z7Fa1yCO8HoHzlDFhPiWD8XoB3aPppRrUQdRp1D8qE9exdgr+Zbpqf8BLfmZ/bMYbh87k58VCSswCjQoLPPw4Jnp4uFi/YQlfKB5eBd/gr6aqB973zbDAF+v5PN+NZEvm+84bSkhxUPE9C9wqbeJ7Hi+gA9Jr5ZM7x9el4mulyK0Bb2xiMTj3/iBtK77Tnii27H/MlCfsjcJY+2oTg2/U4TYWQERE0r+aCouBcx5zEZzEYrqui8JXsQW/X8FLHJ3IVbWXhQV3zAJCjFQst1F25y1arlXwhRR4Bb4rZ3VPy5d+bHEtHIPF27K16ItYuKXM5kHD10M9DKFeSpbqLlOYAlRiC99yCiDmbUf0206jPPO7b/iud71avBkHf+kQP0OrWHBFrhmt75ZyPzbLg5KmWK9oH4Oq1eFZOm0c6n48mdfer46HcLUZU3pGB8R9IDBbJ+N7v1q0J2xhudZ45tcL8PN16vq9WizwtRLwFQtKER+NDypj4QQOdJNY3NC7GEsaGtiSmDsA+CZhyx+hXFHjYrgGGXpZNvDNpn5gWWuiWkUtyEB0UcrO8Y2L9KI9K+cXLmxqruGd6pcKfycj/ij3URVgu6bPUaycN1qXTHD+KoOmjGORnH57q8rh+e9sTHk5r1+7zpEXk36bp7iiXRrBW61e5k/D0fn+EXF/OxYEypFW3ZH1HzPt4Pv5PN2Rd7VJLDZeboGnbpSPwPDcBw5f6AIysadFOR9Hr7vksoFvE91jdbdYvzpYqyIvdQPU87uKL45u3u213CA8qkYPT6H1YgwIfkz7RI5xJdomfjoV4PXjfjgaRkNGhHwG1mNt1oq0y/j+SaZ5pV0LnrlG89Dl1YkmEsc3nKKzMKskJD+fx6NhlFiohdTe5EsZIig5WPgWUYCC9Dx5TG/sA5x15LCBbzXDtx/+uh74VmMZjLDamh8JvhzQtSsoeVTNNXB/Euv96LRR/qjO+By5xTxxJ683/FB00Pj0fZz9F2GPa70Ld2hbbVptWmjWabbGCl/ZAiTsbJa5hQ9OK/eWFE4xva9nG3z1zwCtnFXjYr6c3ykxPn9QiYWEWPhA4uuiDnzBpt4EMcg0QOm28M0gP76hJuELbIdZi4PqaILpJI+RYz4ZV42y+q49wBcxIbyXTmtXgevRWPl3MmjSSJU5vB3J0TA2Uu8mtP+R5/Au4iiF6NrUUiuCieOiJpnJq8gSXzwFLFiLP8X6bV0bYvzt8TXj75eLtKPRauY1RM1HR7GwEHpFbonIWAPwjxpfqJSCyBVUsk/DFOChhC18kyiPHFvwdVGh6XFbmfLx+RRi4jaqYiCnUDO1wc4u4ovo7pfS+XFD32e9GzndwxJiHcbQ/Vz6JrBMDGYyYK5l7YOsfkS2MVePfGkLsNXLGl9hIVbWXAv9fQ5i/j6UFL1RaQffB9qlwn3tS4WxMhaxETCMz6T9ZTqCk5FznoOKL9SEXMMIUwAZW6dNfCEVX61azdxwmIbg4aHdwtcj5KVBeNiqrb2+g5M8hTskSB6exHZ5bMEIF/wCoOT128zvdXziMLbvuDu/Usmh0oG7doMmafKNSmt8hQWUnmzhjJf/RskXCzQL8aYNfLG/QPGLY5KjKtcuNPGsyGytmj0/kPi6qdXwwJCPvOTYI3zTaICCNEh9FGSWM54OX4+A1UI80RV98czWKceJf65ervsleJm164/7ganACHHn+IPz8Nby1ptcnRztRWbipArvp4/gRchodbIFvsBSWPBaW+CHtzWfauFfcmnKRuyr+Fiu1WbzGKtCPWWMHjIgU1/Mgn2B74GKfbkajHwtVIHy3uBbh0Ocj9oplCC+kIJvYuKvI9bbkUUQ2+JaG7AeknwvhLd0YUxx+SZIf4XkGeqHUCNt9N8sQdvYlwtl9H4hMzqI5dHosMIX2taCl2s6LRowaubPyld/IgcvHBJPnKGnHDLh0ArfqzlYtkv5D8++4RsAvPbwTaJzgDcIDzxIRXuEbx4NIsYupjt7gi/6idL3j1AIqPY+OPH5PGO67x/jUS9NvF6hTte7x2kaCvtSZJiMlxjxMSqEtqXr3GPMn/9y4cXUypS/ymPxbIAvmurtYl9o7dqmBV9KdbLOgsik4B3d6xW/lO7w/kfe+yfx7bFuGkwY3/C6sURDj8584rCxJH5QtnYFVrFQVL35HNoQgO0jvt228XVRC4WQPLtANyiEzb1gD/BNoy5kHa5QEnUmiq/uG2fubeXh+kwuNj8IRxAoOqiLIqfTaNw84SfLWsDmqo08k30prHVKbHuYDo7ez6U7EsLX0oJX1ltV2AOg2KfoMPPA/sTx/ZPMqF9YiN11AsHLFrHgaAT3GBvw7hO+U9TH4bX10rgVx7YgMr0p7Pow4tL8XcY3l1kJMfVQmsA3fa/wFQh3JK9eivtV+tCaD4cUjdZvIRI9BfDUDd6PkkbfKhVbOJf/jUpuQcXXlgVNv68ejr4gTflk5AZ71+jR4AvEdPg6PDNpaz6a2AQm2otoWKvVS+LVTyL4OnaE7wSNUjfdpnZb+KbQdcA7Jr5ek0od8MD9dNjiN43t4etk1v0ITfyw6gS+Q4l5XwGwbXli+u/sj6pWGu9XfyYXx75d18+lf6t0tnau/pXKv8+xzorIkltn0l4r2dYCXlO8XDRbu9xw/9g/Zko2FXSFtKPxOxn3q+caluteK5lJsboXwVP/S27cPVz28X3i3/Ll/v8eDVMPDmzwvDbwddMt+NoROhq3yXcC4D7KpmTyA+XnqEzSFQrawDeLrsNemHrEL2+24r7NlENZUMa2vyxkH2DIs628e669ubdsR4VXC7C9u79eIVJtOwgdgO/dOICHGK6jQHaIwdXN4Lwt0LWHr4d6kX8tV+ozqAs+uYCSmO2w+jd4zGNeUYL4nqZxeN5WKVgooSAClmEaYhqhdit89QC7niSbCEM2sdkBuHYxQg9ri5ZjkuhI6DMP+J7cTvEtokEx0aPscyddoFJKpSZqV7G1GTxcpmEthpnw5058c6GfwqpwzGOtGjXSJI3FLYhc+O+jSr9aGhPWQlRshS8AticLX7wnsgbXxt6gsWCpRBa0vRGQM8oB9dhmP3QAwFX4c079dJNq6Qi5xbuyTmpPSJ1Ur4UtF7GoTtmUL3zxaWqMU8P/k3cXSQ1EQRjHGdzdHTa4u7tzBs7CedhykNwF2/5jq56iU11db6Lv2yTj8hs3JoiU9sZZp5/62J5v1z9NjrDHaSbnbFMf52sHrDUVaidDxNG0o9+uLjfosfdb3jT5d5j757riJgst9NIZQ2Pn+ySZll80vjI6Wz/hQJG4vPG0L/H6poQch/dW3vL3B0u8jl0HvVj5PvHCElEF8DUAFikVYTcvmfBdDzQlvvMXSV5lP5zrXj/fJ54zuWaeeuoqkW8AwCIaqeTZKkmYrpPwR2eqN9X72W7EG57vU67OBeuMV8KXLUzv93UTTj42tvaFS++GVsc5JRyLSLJ8nzO555hFBmiSRCqMr4GwrcmGkib5xSvcwmzFK6e8s7DMa2xH4YZdZumSOwsVzFeBWdr37tpIhOpSwXqONNgZq/2KgvBt54znHN1HzlljTO4oVD5fb+prNIJXQNL1ofDKQisbPLJDv3jNSLq9OkYBEIihKIj3v7S1TRQCX5Kdl1ZQlol7LF+E++fwirfiq2sf4cTXxc6hzxffPuLEeqSWrPGWMF58TWr5viyJAP5/4EV4KePiaSE8eNRgjDy8/tyRW+FZjhS+2tlovNJovtJovNJ0uhK6Wo64SDdxEbM//KesjwAAAABJRU5ErkJggg==";var imageSize=[351,63],imageOffset=[20,20],vertices=new Float32Array([-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0]),uvs=new Float32Array([0,0,1,0,0,1,1,1]),index=new Uint8Array([0,1,2,1,3,2]),geometry=new BufferGeometry;geometry.setAttribute("position",new BufferAttribute(vertices,3));geometry.setAttribute("uv",new BufferAttribute(uvs,2));geometry.setIndex(new BufferAttribute(index,1));var material=new MeshBasicMaterial({transparent:!0,depthTest:!1,depthWrite:!1,stencilWrite:!1,fog:!1}),mesh=new Mesh(geometry,material);mesh.matrixAutoUpdate=!1;var scene=new Scene$1;scene.add(mesh);scene.matrixAutoUpdate=!1;var camera=new OrthographicCamera(-.5,.5,.5,-.5,.1,1);camera.position.set(0,0,.5);camera.lookAt(0,0,0);camera.updateMatrixWorld(!0);camera.matrixAutoUpdate=!1;var prevViewport=new Vector4,prevScissor=new Vector4;function renderPoweredByRealsee(e){if(material.map){var t=e.getViewport(prevViewport),r=e.getScissor(prevScissor),n=e.getScissorTest(),o=e.autoClear,s=r.x+imageOffset[0]/3,l=r.y+imageOffset[1]/3,u=imageSize[0]/3,c=imageSize[1]/3;e.setViewport(s,l,u,c),e.setScissor(s,l,u,c),e.setScissorTest(!0),e.autoClear=!1,e.render(scene,camera),e.setViewport(t),e.setScissor(r),e.setScissorTest(n),e.autoClear=o}else{var h=new Texture,f=new Image;f.onload=function(){h.image=f,h.wrapS=ClampToEdgeWrapping,h.wrapT=ClampToEdgeWrapping,h.minFilter=LinearFilter,h.needsUpdate=!0,h.generateMipmaps=!1,material.needsUpdate=!0,f.onload=noop$1},f.src=textureURL,material.map=h}}var DEFAULT_MODE_CHANGE_DURATION=800,DEFAULT_CAMERA_FOV=90,DEFAULT_REQUEST_PROXY=function(e){return e.replace("//vrlab-public.ljcdn.com/","//vr-public.realsee-cdn.cn/").replace("//vrlab-image4.ljcdn.com/","//vr-image-4.realsee-cdn.cn/").replace("//vrlab-image3.ljcdn.com/","//vr-image-3.realsee-cdn.cn/").replace("//vrlab-image2.ljcdn.com/","//vr-image-2.realsee-cdn.cn/").replace("//vrlab-image1.ljcdn.com/","//vr-image-1.realsee-cdn.cn/")},sharedVector2=new Vector2,sharedSphere=new Sphere,sharedFrustum=new Frustum,sharedProjScreenMatrix=new Matrix4,clockForMixer=new WeakMap,worksMap=new WeakMap,emptyWorks=createWorks([]);new Scene;var Five=function(e){__extends(t,e);function t(r){r===void 0&&(r={});var n,o,s,l,u,c,h,f,m,y,A,M,b=e.call(this)||this;if(b.ident=createUuid(),typeof window<"u"&&(__FIVE_DEBUG__.instances[b.ident]=b),b.renderSwitch01=0,b.currentMode="Panorama",b.pano={workCode:"",panoIndex:0},b.needsRender=!1,b.modelSceneNeedsRender=!1,b.onlyRenderIfNeeds=(n=r.onlyRenderIfNeeds)!==null&&n!==void 0?n:!0,b.imageOptions=__assign({},(o=r.imageOptions)!==null&&o!==void 0?o:{}),b.textureOptions=__assign({},(s=r.textureOptions)!==null&&s!==void 0?s:{}),b.poweredByRealsee=(l=r.poweredByRealsee)!==null&&l!==void 0?l:!0,b.extraElements=[],b.controllerInits={Panorama:Object.assign({},r.panorama),Model:Object.assign({},r.model),Floorplan:Object.assign({},r.floorplan),Topview:Object.assign({},r.topview),Mapview:Object.assign({},r.mapview),VRPanorama:Object.assign({},r.vrPanorama),XRPanorama:Object.assign({},r.xrPanorama)},b.fps={testCount:0,testTime:now()},b.info=null,b.modeChangeDuration=(u=r.modeChangeDuration)!==null&&u!==void 0?u:DEFAULT_MODE_CHANGE_DURATION,b.enableWheel=(c=r.enableWheel)!==null&&c!==void 0?c:!0,typeof window<"u")if("renderer"in r)r.renderer instanceof InternalWebGLRenderer&&b.throwError(new Error("cannot render a internal renderer")),b.renderer=r.renderer;else try{b.renderer=new InternalWebGLRenderer({preserveDrawingBuffer:r.preserveDrawingBuffer,backgroundColor:r.backgroundColor,backgroundAlpha:r.backgroundAlpha,antialias:r.antialias,webgl2:r.webgl2,logarithmicDepthBuffer:r.logarithmicDepthBuffer,precision:r.precision,powerPreference:r.powerPreference});var T=getViewportScale();b.renderer.setPixelRatio(T===1?window.devicePixelRatio:1),b.renderer.setSize(512,512)}catch(z){z instanceof Error&&b.throwError(z)}b.getPixelsRenderTarget=new WebGLRenderTarget(1,1,{encoding:(f=(h=b.renderer)===null||h===void 0?void 0:h.outputEncoding)!==null&&f!==void 0?f:sRGBEncoding,generateMipmaps:!1});var _=new DepthTexture(1,1);_.generateMipmaps=!1,_.format=DepthStencilFormat,_.type=UnsignedInt248Type,b.modelRenderTarget=new WebGLRenderTarget(1,1,{encoding:(y=(m=b.renderer)===null||m===void 0?void 0:m.outputEncoding)!==null&&y!==void 0?y:sRGBEncoding,depthTexture:_,generateMipmaps:!1,depthBuffer:!0,stencilBuffer:!0}),b.scissor=Object.assign({left:0,bottom:0,width:1,height:1},r.scissor),b.camera=new Camera(DEFAULT_CAMERA_FOV),b.scene=new Scene,b.xrCustomObjectsScene=new Scene$1,b.scene.add(b.xrCustomObjectsScene),b.scene.matrixAutoUpdate=!1,b.lastLoadWorkTask=Promise.resolve(),b.requestProxy=(A=r.requestProxy)!==null&&A!==void 0?A:DEFAULT_REQUEST_PROXY,b.networkSubscribe=new NetworkSubscribe,b.networkSubscribe.on("network",function(z,H,W,J){var G;b.emit("network.resource",createEvent("network.resource",{source:z,requestType:H,requestState:W,detail:J})),(G=b.analysis)===null||G===void 0||G.network(b.works,z,H,W,J)}),b.boundingMesh=generateBoundingMesh(new Box3(new Vector3(-.5,-.5,-.5),new Vector3(.5,.5,.5))),b.boundingMesh.name="bounding",b.models=createModels(),b.models.push(new Model),b.lastModels=createModels(),b.lastWorks=createWorks([]),b.readyCallbacks=[],b.syncingState=!1,b.helperGroup=new Group,b.helperGroup.name="helper",b.helperGroup.matrixAutoUpdate=!1,b.scene.add(b.helperGroup),b.modelGroup=new Group,b.modelGroup.visible=!1,b.modelGroup.name="model",b.modelGroup.matrixAutoUpdate=!1,b.modelScene=new Scene$1,b.modelScene.add(b.modelGroup),b.modelScene.add(b.boundingMesh),b.modelScene.matrixAutoUpdate=!1,b.videoTexture=new VideoTexture(r.videoInstance||generateDefaultVideoElement()),initLights(b.scene),initLights(b.modelScene),b.state={mode:b.currentMode,workCode:b.pano.workCode,panoIndex:b.pano.panoIndex,longitude:b.camera.pose.longitude,latitude:b.camera.pose.latitude,fov:b.camera.pose.fov,offset:b.camera.pose.offset.clone(),distance:b.camera.pose.distance},b.stateSynced=!1,b._enablePostProcessing=!1,b._enableIOSEDR=!1,b._enableEDL=!1,b._enableHQ=!1,b.destroyed=!1,b.paused=!0,typeof window<"u"&&(r.play!==!1&&b.play(),b.stopAnimationLoop=AnimationFrameLoop.shared.add(function(z,H){for(var W=[],J=2;J<arguments.length;J++)W[J-2]=arguments[J];b.updateTime.apply(b,__spreadArray([z,H],W,!1))},!1,0,10));var S=function(){typeof document<"u"&&document.fullscreenElement===null&&b.currentMode==="VRPanorama"&&b.controller.emit("vr.requestExit",createEvent("vr.requestExit",{}))},C=function(){b.needsRender=!0,b.modelSceneNeedsRender=!0};if(typeof document<"u"&&document.addEventListener("fullscreenchange",S,!1),b.renderer&&b.renderer.domElement.addEventListener("webglcontextrestored",C,!1),b.removeEventListeners=function(){typeof document<"u"&&document.removeEventListener("fullscreenchange",S,!1),b.renderer&&b.renderer.domElement.removeEventListener("webglcontextrestored",C,!1)},b.plugins={},r.plugins&&r.plugins.length)for(var P=0,F=r.plugins;P<F.length;P++){var O=F[P];if(typeof O=="function")O(b);else if(Array.isArray(O)){var N=O[0],V=O[1],q=O[2];if(typeof N=="function"){var Q=N(b,q);typeof V=="string"&&(b.plugins[V]?b.throwError(new Error("plugin name ".concat(V," is exists."))):b.plugins[V]=Q)}}}return b.gpuPickingRenderTarget=new WebGLRenderTarget(1,1,{generateMipmaps:!1}),b.meshReplaceMaterialMap=new Map,b.meshOriginMaterialMap=new Map,initLegacyEvent(b),b.enableLayeringRendering=(M=r.enableLayeringRendering)!==null&&M!==void 0?M:!1,b}return Object.defineProperty(t,"version",{get:function(){return"6.4.0-alpha.40"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"dracoPath",{get:function(){return draco.decoderPath},set:function(r){draco.setDecoderPath(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ktx2Path",{get:function(){return ktx2.transcoderPath},set:function(r){ktx2.setTranscoderPath(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"panoIndex",{get:function(){return this.pano.panoIndex},enumerable:!1,configurable:!0}),t.prototype.getGPUPicking=function(r,n,o,s,l){var u=this;if(s===void 0&&(s=1),l===void 0&&(l=new Vector3(0,0,0)),!this.renderer)throw new Error("renderer is not initialized.");var c=this.models.getMaterial(),h=c.constantColor,f=c.colorStyle;this.models.setMaterial({colorStyle:"CONSTANT",constantColor:l}),this.scene.traverse(function(M){if(!(!(M instanceof Mesh)||M instanceof PBMMesh||M instanceof PBMSkinnedMesh)){var b=Object.keys(o).filter(function(_){return _===M.uuid})[0];if(b)if(u.meshOriginMaterialMap.set(b,M.material),u.meshReplaceMaterialMap.get(b))M.material=u.meshReplaceMaterialMap.get(b);else{var T=new ShaderMaterial({uniforms:{color:{value:o[b]}},vertexShader:`
          void main() {
            vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
            gl_Position = projectionMatrix * mvPosition;
          }
          `,fragmentShader:`
          uniform vec3 color;
          void main() {
            gl_FragColor = vec4( color, 1.0 );
          }
          `});T.depthTest=M.material.depthTest,T.side=M.material.side,u.meshReplaceMaterialMap.set(b,T),M.material=T}}});var m=this.renderer.getSize(new Vector2);this.camera.setViewOffset(m.width,m.height,r*s,n*s,1,1),this.renderer.setRenderTarget(this.gpuPickingRenderTarget),this.render();var y=new Uint8Array(4);this.renderer.readRenderTargetPixels(this.gpuPickingRenderTarget,0,0,1,1,y),this.renderer.setRenderTarget(null),this.camera.clearViewOffset(),this.scene.traverse(function(M){!(M instanceof Mesh)||M instanceof PBMMesh||M instanceof PBMSkinnedMesh||u.meshOriginMaterialMap.get(M.uuid)&&(M.material=u.meshOriginMaterialMap.get(M.uuid))}),this.models.setMaterial({colorStyle:f,constantColor:h});var A=Object.keys(o).filter(function(M){return o[M].equals(new Color().setRGB(y[0]/255,y[1]/255,y[2]/255))})[0];return A||!1},t.prototype.dispose=function(){var r,n;if(this.destroyed!==!0){delete __FIVE_DEBUG__.instances[this.ident],this.emit("dispose"),this.destroyed=!0,this.pause(),this.stopAnimationLoop&&(this.stopAnimationLoop(),delete this.stopAnimationLoop),(r=this.renderer)===null||r===void 0||r.setAnimationLoop(null),this.off(),this.networkSubscribe.off(),this.controller&&(this.controller.destroy(),this.controller=void 0);var o=this.getElement();o&&o.parentNode&&o.parentNode.removeChild(o);var s=this.models.getMaterial();s&&(s.pano0&&s.pano0.map.dispose(),s.pano1&&s.pano1.map!==((n=s.pano0)===null||n===void 0?void 0:n.map)&&s.pano1.map.dispose());for(var l=0,u=this.models;l<u.length;l++){var c=u[l];c.dispose()}this.models.length=0,this.models.setMaterial({pano0:null,pano1:null}),this.meshReplaceMaterialMap.forEach(function(h){h.dispose()}),this.meshOriginMaterialMap.forEach(function(h){h.dispose()}),this.renderer instanceof InternalWebGLRenderer&&this.renderer.forceContextLoss&&this.renderer.forceContextLoss()}},t.prototype.setScissor=function(r){var n;if(Object.assign(this.scissor,r),this.controller&&this.controller.updateRenderSize){var o=new Vector2;(n=this.renderer)===null||n===void 0||n.getDrawingBufferSize(o),this.controller.updateRenderSize(o)}},Object.defineProperty(t.prototype,"helperVisible",{get:function(){return this.helperGroup.visible},set:function(r){this.helperGroup.visible!==r&&(this.helperGroup.visible=r,this.emit("helpers.visible",createEvent("helpers.visible",{object:this.helperGroup})),this.needsRender=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableIOSEDR",{get:function(){return this._enableIOSEDR},set:function(r){this._enableIOSEDR!==r&&(this._enableIOSEDR=r,this.currentMode&&this.currentMode==="Panorama"&&this.changeMode(this.currentMode,this.getCurrentState(),0,!1,!0))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"postProcessingType",{get:function(){return this.currentMode==="Panorama"&&this.enableIOSEDR&&this.enablePostProcessing?"luminance":this.currentMode==="Mapview"&&this.enableEDL?"edl":this.currentMode==="Mapview"&&this.enableHQ?"hq":null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableEDL",{get:function(){return this._enableEDL},set:function(r){if(r===!0&&this.currentMode!==t.Mode.Mapview)throw new Error("只支持Mapview下开启EDL");this._enableEDL!==r&&(this._enableEDL=r,this.boundingMesh.visible=!r,this.needsRender=!0,this.modelSceneNeedsRender=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableHQ",{get:function(){return this._enableHQ},set:function(r){if(r===!0&&this.currentMode!==t.Mode.Mapview)throw new Error("只支持Mapview下开启HQ");this._enableHQ!==r&&(this._enableHQ=r,this.boundingMesh.visible=!r,this.needsRender=!0,this.modelSceneNeedsRender=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enablePostProcessing",{get:function(){return this._enablePostProcessing},set:function(r){this._enablePostProcessing!==r&&(this._enablePostProcessing=r),this.needsRender=!0,this.modelSceneNeedsRender=!0},enumerable:!1,configurable:!0}),t.prototype.updateConfiguration=function(r,n){n===void 0&&(n=!0);var o=!1;if(r.panorama&&(Object.assign(this.controllerInits.Panorama,omitUndefinedFields(r.panorama)),this.currentMode==="Panorama"&&(o=!0)),r.model&&(Object.assign(this.controllerInits.Model,omitUndefinedFields(r.model)),this.currentMode==="Model"&&(o=!0)),r.floorplan&&(Object.assign(this.controllerInits.Floorplan,omitUndefinedFields(r.floorplan)),this.currentMode==="Floorplan"&&(o=!0)),r.topview&&(Object.assign(this.controllerInits.Topview,omitUndefinedFields(r.topview)),this.currentMode==="Topview"&&(o=!0)),r.mapview&&(Object.assign(this.controllerInits.Mapview,omitUndefinedFields(r.mapview)),this.currentMode==="Mapview"&&(o=!0)),r.vrPanorama&&(Object.assign(this.controllerInits.VRPanorama,omitUndefinedFields(r.vrPanorama)),this.currentMode==="VRPanorama"&&(o=!0)),r.imageOptions&&(Object.assign(this.imageOptions,r.imageOptions),(this.currentMode==="Panorama"||this.currentMode==="VRPanorama")&&(o=!0)),r.textureOptions&&Object.assign(this.textureOptions,r.textureOptions),n&&o&&this.controller&&this.currentMode){var s=this.controller.updateConfiguration(this.controllerInits[this.currentMode]);s||this.changeMode(this.currentMode,this.getCurrentState(),0,!1,!0)}},t.prototype.appendTo=function(r,n){if(n===void 0&&(n={}),!!this.renderer){if(!(this.renderer instanceof InternalWebGLRenderer)){this.throwError(new Error("cannot call appendTo method when render a external renderer"));return}var o=this.getElement();if(o){r.appendChild(o),this.refresh(n);var s=window.getComputedStyle(r).position;s!=="relative"&&s!=="absolute"&&s!=="fixed"&&s!=="sticky"&&(r.style.position="relative")}}},t.prototype.refresh=function(r,n){if(r===void 0&&(r={}),!!this.renderer){var o=this.getElement();if(o){var s=o.parentNode;if(s&&s.nodeName){var l=r.width,u=l===void 0?s.offsetWidth:l,c=r.height,h=c===void 0?s.offsetHeight:c;this.renderer instanceof InternalWebGLRenderer&&(n&&this.renderer.setPixelRatio(n),this.renderer.setSize(u,h))}var f=new Vector2;if(this.renderer.getDrawingBufferSize(f),this.controller&&this.controller.updateRenderSize&&this.controller.updateRenderSize(f),this.modelRenderTarget.width!==f.x||this.modelRenderTarget.height!==f.y){this.modelRenderTarget.setSize(f.x,f.y),this.modelRenderTarget.depthTexture.dispose();var m=new DepthTexture(f.x,f.y);m.generateMipmaps=!1,m.format=DepthStencilFormat,m.type=UnsignedInt248Type,this.modelRenderTarget.depthTexture=m,this.modelRenderTarget.depthTexture.needsUpdate=!0}this.needsRender=!0,this.modelSceneNeedsRender=!0,this.render(noop$1,!0)}}},t.prototype.addExtraElement=function(r){var n=this;return this.extraElements.indexOf(r)===-1&&(this.extraElements.push(r),this.controller&&this.controller.bindExtraElement(r)),function(){return n.removeExtraElement(r)}},t.prototype.removeExtraElement=function(r){var n=this.extraElements.indexOf(r);n!==-1&&(this.extraElements.splice(n,1),this.controller&&this.controller.unbindExtraElement(r))},t.prototype.getPose=function(){var r=this.camera.copyPose(),n=r.longitude,o=r.latitude,s=r.fov,l=r.offset,u=r.distance;return{longitude:n,latitude:o,fov:s,offset:l.clone(),distance:u}},t.prototype.getSize=function(r){if(!this.renderer)throw new Error("renderer is not initialized");return this.renderer.getSize(r),r.x*=this.scissor.width,r.y*=this.scissor.height,r},t.prototype.getDrawingBufferSize=function(r){if(!this.renderer)throw new Error("renderer is not initialized");return this.renderer.getDrawingBufferSize(r),r.x*=this.scissor.width,r.y*=this.scissor.height,r},t.prototype.updateCamera=function(r,n,o){if(o===void 0&&(o=!0),!this.controller)throw new Error("controller is not initialized.");return this.controller.updateCamera(r,n,o)},t.prototype.updateCameraWithKeyframes=function(r,n,o){if(o===void 0&&(o=!0),!this.controller)throw new Error("controller is not initialized.");return this.controller.updateCameraWithKeyframes(r,n,o)},t.prototype.getLongitudeAndLatitude=function(){var r=this.getPose(),n=r.longitude,o=r.latitude;return{longitude:n,latitude:o}},t.prototype.getOffset=function(){return this.getPose().offset},t.prototype.getCameraLocal=function(){if(this.pano.workCode&&this.controller&&this.works){var r=this.works.getResolvedObserver(this.pano);if(r){var n=new Object3D;return n.position.copy(r.position),n.quaternion.copy(r.quaternion),n.scale.set(1,1,1),n.matrix.compose(n.position,n.quaternion,n.scale),n.matrixAutoUpdate=!1,cameraWorldToLocal(this.camera,n)}}return null},Object.defineProperty(t.prototype,"works",{get:function(){var r=worksMap.get(this);if(!r)return emptyWorks;for(var n=0,o=r;n<o.length;n++){var s=o[n];if(!workRawMapping.has(s))return emptyWorks}return r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"work",{get:function(){return this.works[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"model",{get:function(){return this.models[0]},enumerable:!1,configurable:!0}),t.prototype.load=function(r,n,o,s){var l=this;if(s===void 0&&(s=!0),!this.renderer)throw new Error("renderer is not initialized");var u=this.lastLoadWorkTask.then(function(){return isPromise(r)?r.then(function(c){return l.load_(c,n,o,s)}):l.load_(r,n,o,s)});return this.lastLoadWorkTask=u.catch(function(c){l.throwError(c)}),u},t.prototype.load_=function(r,n,o,s){var l=this,u,c,h,f,m,y,A,M;s===void 0&&(s=!0);var b={};typeof o=="number"?b.duration=o:typeof o=="object"&&Object.assign(b,o),this.works===emptyWorks&&(b.duration===void 0&&(b.duration=0),b.effect===void 0&&(b.effect="instant"));var T=[];if(Array.isArray(r))for(var _=0,S=r;_<S.length;_++){var C=S[_];typeof C!="string"&&"work"in C?T.push(parseWork(C.work,C)):T.push(parseWork(C))}else T.push(parseWork(r));for(var P=createWorks(T),F=function(ge){var _e=O,he=new Fetcher({allowHosts:ge.allowHosts,get requestProxy(){return _e.requestProxy},get networkSubscribe(){return _e.networkSubscribe}});registerFetcher(ge,he)},O=this,N=0,V=P;N<V.length;N++){var q=V[N];F(q)}this.lastWorks=this.works,n===void 0&&(n="inherit"),n==="inherit"&&this.lastWorks.length===0&&(n="initial");var Q=P.initial,z=Q.work.observers[0],H=z?{workCode:z.work.workCode,panoIndex:z.panoIndex}:{workCode:Q.work.workCode,panoIndex:0},W=(u=Q.mode)!==null&&u!==void 0?u:z?"Panorama":"Mapview",J={};if(n==="inherit"){W=this.currentMode;var G=P.resolvedObservers[this.panoIndex];G?H={workCode:G.work.workCode,panoIndex:G.panoIndex}:typeof P.initial.panoIndex=="number"?H={workCode:P.initial.work.workCode,panoIndex:P.initial.panoIndex}:(W==="Panorama"||W==="VRPanorama"||W==="XRPanorama")&&(W="Mapview"),J={longitude:this.camera.pose.longitude,latitude:this.camera.pose.latitude,fov:this.camera.pose.fov,distance:void 0,offset:void 0}}else if(n==="initial")typeof Q.panoIndex=="number"&&(H={workCode:Q.work.workCode,panoIndex:Q.panoIndex}),Q.mode&&(W=Q.mode),J={longitude:Q.longitude,latitude:Q.latitude,fov:Q.fov,distance:Q.distance,offset:(c=Q.offset)===null||c===void 0?void 0:c.clone()};else{if(W=(h=n.mode)!==null&&h!==void 0?h:this.currentMode,typeof n.panoIndex=="number"){var G=P.getResolvedObserver({workCode:(m=(f=n.workCode)!==null&&f!==void 0?f:Q.work.workCode)!==null&&m!==void 0?m:"",panoIndex:n.panoIndex});G&&(H={workCode:G.work.workCode,panoIndex:G.panoIndex})}J={longitude:n.longitude,latitude:n.latitude,fov:n.fov,distance:n.distance,offset:n.offset}}var te=__assign(__assign(__assign({},H),{mode:W}),J),X=this.getCurrentState(),K=(y=b.duration)!==null&&y!==void 0?y:this.modeChangeDuration;(W==="Floorplan"||W==="Topview"||W==="Mapview")&&this.currentMode===W&&(K=0);var Z="fly";(W==="Panorama"||W==="VRPanorama"||W==="XRPanorama")&&this.currentMode===W&&(Z=(A=b.effect)!==null&&A!==void 0?A:"fade"),this.emit("works.request",createEvent("works.request",{input:r,works:P,state:te,userAction:s}));var ee=function(){l.modelGroup.visible=!0,l.pano=H;var ge=__assign(__assign({initial:{state:te,currentState:X,duration:K,effect:Z,userAction:s}},l.commonParams()),l.controllerInits[W]),_e=Controllers[W].initAnimationEndState(ge);if(l.controller&&l.currentMode===W)l.controller.updateWork(P,_e,{effect:Z,duration:K},s)===!1&&(l.controller.destroy(),l.controller=l.applyController(W,ge));else{var he=l.currentMode;if(l.controller)l.controller.destroy();else{var Fe=Controllers[W].initAnimationEndState(ge);l.camera.setFromPose(Fe),l.emit("camera.update",createEvent("camera.update",{state:l.getCurrentState(),userAction:s}))}l.controller=l.applyController(W,ge);var Re=createEvent("mode.change",{prevMode:he,mode:W,state:_e,userAction:s});l.emit("mode.change",Re)}};worksMap.set(this,P);var j=Promise.resolve();if(W===t.Mode.Floorplan||W===t.Mode.Topview||W===t.Mode.Mapview||W===t.Mode.Model)this.models.loaded===!1&&(this.camera.setFromPose(te),assignPose(this.state,this.camera.pose)),this.controller||(this.currentMode=W),j=this.loadModel(P,b).then(function(){l.needsRender=!0,l.modelSceneNeedsRender=!0,ee(),l.emit("camera.update",createEvent("camera.update",{state:l.getCurrentState(),userAction:s}))});else{ee();var re=!1,pe=function(){l.works===P&&re===!1&&(l.needsRender=!0,l.modelSceneNeedsRender=!0,l.emit("camera.update",createEvent("camera.update",{state:l.getCurrentState(),userAction:s})),l.loadModel(P,b),re=!0)};this.controller.once("pano.arrived",pe),this.controller.once("pano.cancel",pe),setTimeout(pe,((M=b.duration)!==null&&M!==void 0?M:this.modeChangeDuration)+1e3)}return this.emit("works.load",createEvent("works.load",{input:r,state:this.getCurrentState(),userAction:s,works:P})),j.then(function(){return l.ready()}).then(function(){var ge;l.emit("works.ready",createEvent("works.ready",{input:r,state:l.getCurrentState(),userAction:s,works:P})),(ge=l.analysis)===null||ge===void 0||ge.work(P)})},t.prototype.reset=function(){var r=this,n=this.lastLoadWorkTask.then(function(){return r.reset_()});return this.lastLoadWorkTask=n.catch(function(o){r.throwError(o)}),n},t.prototype.reset_=function(){var r=this;return new Promise(function(n){var o;r.controller&&(r.controller.destroy(),r.controller=void 0);var s=r.models.getMaterial();s&&(s.pano0&&s.pano0.map.dispose(),s.pano1&&s.pano1.map!==((o=s.pano0)===null||o===void 0?void 0:o.map)&&s.pano1.map.dispose()),r.models.setMaterial({pano0:null,pano1:null,modelAlpha:1}),r.lastModels.setMaterial({pano0:null,pano1:null,modelAlpha:1}),r.renderer&&(r.models.update(r.renderer,r.camera,r.currentMode),r.lastModels.update(r.renderer,r.camera,r.currentMode),r.model&&r.boundingMesh.update(r.renderer,r.camera,r.model));for(var l=0,u=r.models;l<u.length;l++){var c=u[l];r.lastModels.push(c)}if(r.models.length=0,r.lastModels.length>0){for(var h=0,f=r.lastModels;h<f.length;h++){var c=f[h];r.modelGroup.remove(c),c.dispose(),r.needsRender=!0,r.modelSceneNeedsRender=!0}r.lastModels.length=0}r.lastWorks&&delete r.lastWorks,worksMap.delete(r),r.currentMode="Mapview",r.pano={workCode:"",panoIndex:0},r.camera.setFromPose({distance:0,fov:DEFAULT_CAMERA_FOV,longitude:0,latitude:0,offset:new Vector3(0,0,0)}),r.state={mode:r.currentMode,workCode:r.pano.workCode,panoIndex:r.pano.panoIndex,longitude:r.camera.pose.longitude,latitude:r.camera.pose.latitude,fov:r.camera.pose.fov,offset:r.camera.pose.offset.clone(),distance:r.camera.pose.distance},r.models.needsRender=!1,r.camera.needsRender=!1,r.needsRender=!1,r.modelSceneNeedsRender=!1,n()})},t.prototype.changeMode=function(r,n,o,s,l){var u=this;return n===void 0&&(n={}),s===void 0&&(s=!0),l===void 0&&(l=!1),new Promise(function(c,h){var f,m,y,A;if(!u.renderer)throw new Error("renderer is not initialized.");n=__assign({},n);var M=0;u.controller&&(typeof o=="number"?M=o:M=(f=o==null?void 0:o.duration)!==null&&f!==void 0?f:u.modeChangeDuration);var b="fly";u.controller&&typeof o=="object"&&o.effect&&(b=o.effect);var T=typeof n.panoIndex=="number"?{workCode:(A=(m=n.workCode)!==null&&m!==void 0?m:(y=u.work)===null||y===void 0?void 0:y.workCode)!==null&&A!==void 0?A:"",panoIndex:n.panoIndex}:u.pano;if(!t.Mode.hasOwnProperty(r)){var _=new Error('mode "'.concat(r,'" is not existed'));u.throwError(_),h(_);return}if((r===t.Mode.Panorama||r===t.Mode.VRPanorama||r===t.Mode.XRPanorama)&&!u.works.getResolvedObserver(T)){var _=new Error("PanoId ".concat(panoStringify(T)," not existed."));u.throwError(_),h(_);return}(r===t.Mode.Floorplan||r===t.Mode.Topview||r===t.Mode.Mapview||r===t.Mode.Model)&&(u.models.loaded||(M=0));var S=u.controller,C=u.currentMode,P=function(){if(u.controller&&u.controller.stopMomentumMovement(),u.controller&&l===!1&&C===r)r===t.Mode.Panorama||r===t.Mode.Model||r===t.Mode.VRPanorama||r===t.Mode.XRPanorama?!panoEqual(u.pano,T)&&"moveToPano"in u.controller&&typeof u.controller.moveToPano=="function"?u.controller.moveToPano(T,__assign({duration:M},n),s):u.controller.updateCamera(n,M,s).catch(noop$1):(panoEqual(u.pano,T)||(u.pano=T),u.controller.updateCamera(n,M,s).catch(noop$1));else{var O=__assign(__assign({},n),T),N=__assign(__assign({initial:{state:O,currentState:u.getCurrentState(),duration:M,effect:b,userAction:s}},u.commonParams()),u.controllerInits[r]),V=Controllers[r].initAnimationEndState(N),q=createEvent("mode.change.request",{prevMode:u.currentMode,mode:r,state:V,userAction:s});if(u.emit("mode.change.request",q),!q.defaultPrevented){S&&S.destroy(),u.controller=u.applyController(r,N);var Q=createEvent("mode.change",{prevMode:u.currentMode,mode:r,state:V,userAction:s});u.emit("mode.change",Q)}}c()};if(r===t.Mode.VRPanorama)u.requestFullscreen(),requestDeviceOrientationPermission().then(function(){return P()}).catch(function(O){O instanceof Error&&(u.exitFullscreen(),u.throwError(O),h(O))});else if(r===t.Mode.XRPanorama){var F=AnimationFrameLoop.shared.getContext();F?F.end():requestXRSessionPermission().then(function(O){AnimationFrameLoop.shared.setContext(O),P()}).catch(function(O){O instanceof Error&&(u.throwError(O),h(O))})}else P()})},t.prototype.getPixels=function(r,n,o,s,l,u,c){if(!this.renderer)throw new Error("renderer is not initialized.");var h=this.renderer.getPixelRatio(),f=this.renderer.getRenderTarget(),m=this.renderer.getSize(new Vector2),y=0,A=0,M=1,b=1,T,_,S,C,P;typeof r=="number"?(y=r,typeof n=="number"&&(A=n),typeof o=="number"&&(M=o),typeof s=="number"&&(b=s),T=l,_=u,P=c):(y=r.x,A=r.y,M=r.width,b=r.height,T=r.pixelRatio,_=r.flipY,S=r.helperVisible,C=r.skipPanorama,P=r.buffer),y=Math.ceil(y),A=Math.ceil(A),M=Math.ceil(M),b=Math.ceil(b),T=Math.ceil(T??h),_=_??!1;var F=this.getPixelsRenderTarget;F.setSize(M*T,b*T),this.renderer.setRenderTarget(F),this.camera.pixelRatio=T,this.camera.resolution.set(M,b),this.camera.setViewOffset(m.width,m.height,y,m.height-A-b,M,b);for(var O=0,N=this.scene.children;O<N.length;O++){var V=N[O];V instanceof Object3D&&V.traverseVisible(function(pe){pe.setResolution&&pe.setResolution(M*T/h,b*T/h)})}this.models.autoUpdate=!1;var q=!0,Q=0;C&&(this.controller instanceof Controllers.Panorama||this.controller instanceof Controllers.VRPanorama||this.controller instanceof Controllers.XRPanorama)&&(q=this.controller.tiling.object.visible,this.controller.tiling.object.visible=!1,Q=this.models.getMaterial().modelAlpha,this.models.setMaterial({modelAlpha:C===!0?1:Q}));var z=this.helperVisible;S===!1&&(this.helperVisible=!1),this.models.update(this.renderer,this.camera,this.currentMode),this.controller?(this.controller.updateRenderSize(new Vector2(M*T,b*T)),this.controller.render(!0,this.postProcessingType)):(this.renderer.render(this.scene,this.camera),this.renderer.autoClearDepth=!1,this.renderer.autoClearColor=!1,this.renderer.render(this.modelScene,this.camera),this.renderer.autoClearDepth=!0,this.renderer.autoClearColor=!0),this.helperVisible=z,C&&(this.controller instanceof Controllers.Panorama||this.controller instanceof Controllers.VRPanorama||this.controller instanceof Controllers.XRPanorama)&&(this.controller.tiling.object.visible=q,this.models.setMaterial({modelAlpha:Q})),this.models.update(this.renderer,this.camera,this.currentMode),this.models.autoUpdate=!0;var H=M*T,W=b*T,J=H*W,G=J*4,te;try{if(P){if(P.length!==G)throw new Error("buffer length is not equals pixels ".concat(G))}else P=new Uint8Array(G);if(this.renderer.readRenderTargetPixels(F,0,0,M*T,b*T,P),_)for(var X=J/2,K=0,Z=0,ee=0,j=0;Z<X;Z++)for(j=(W-Math.floor(Z/H)-1)*H+Z%H,ee=0;ee<4;ee++)K=P[Z*4+ee],P[Z*4+ee]=P[j*4+ee],P[j*4+ee]=K}catch(pe){te=pe}if(this.renderer.setRenderTarget(f),this.controller&&this.controller.updateRenderSize){var re=new Vector2;this.renderer.getDrawingBufferSize(re),this.controller.updateRenderSize(re)}if(this.camera.clearViewOffset(),this.camera.pixelRatio=h,this.getSize(this.camera.resolution),this.camera.aspect=this.camera.resolution.width/this.camera.resolution.height,te)throw te;return P},t.prototype.getElement=function(){var r;return(r=this.renderer)===null||r===void 0?void 0:r.domElement},Object.defineProperty(t.prototype,"observers",{get:function(){return this.works.resolvedObservers},enumerable:!1,configurable:!0}),t.prototype.render=function(r,n){var o=this;if(n===void 0&&(n=!1),!this.renderer)return null;if(n){var s=this.renderer.getSize(sharedVector2);this.scene.traverseVisible(function(l){l.setResolution&&l.setResolution(s.x,s.y)})}return this.aroundScissor(function(){if(o.renderer){var l=o.scene.background;o.modelScene.background=o.camera.isOrthographicCamera?null:l,o.modelScene.environment=o.scene.environment,o.scene.background=null,o.controller?(o.controller.render(o.onlyRenderIfNeeds?o.modelSceneNeedsRender:!0,o.postProcessingType),o.info={memory:__assign({},o.controller.renderer.info.memory),render:__assign({},o.controller.renderer.info.render)}):(o.renderer.render(o.scene,o.camera),o.info={memory:__assign({},o.renderer.info.memory),render:__assign({},o.renderer.info.render)}),o.scene.background=l,o.modelScene.background=null,o.modelScene.environment=null,o.poweredByRealsee&&o.currentMode!=="VRPanorama"&&o.currentMode!=="XRPanorama"&&o.renderer.getRenderTarget()!==o.getPixelsRenderTarget&&renderPoweredByRealsee(o.renderer)}r&&AnimationFrameLoop.shared.add(r,!0)}),null},t.prototype.updateTime=function(r,n){for(var o,s=this,l=[],u=2;u<arguments.length;u++)l[u-2]=arguments[u];if(!this.destroyed){if(this.works.update(),this.syncingState=this.syncState(r,n),this.controller&&(o=this.controller).updateTime.apply(o,__spreadArray([r,n],l,!1)),this.renderer&&(this.camera.pixelRatio=this.renderer.getPixelRatio(),this.getSize(this.camera.resolution),this.camera.aspect=this.camera.resolution.width/this.camera.resolution.height),this.camera.environment=this.scene.environment,this.camera.updateTime(r),this.renderer){ktx2.detectSupport(this.renderer);var c=this.models.loaded,h=this.models.refined;if(this.models.update(this.renderer,this.camera,this.currentMode),this.camera.autoNearFar){var f=this.models.bounding.getBoundingSphere(sharedSphere),m=f.radius*2;f.containsPoint(this.camera.position)||(m=this.camera.position.distanceTo(f.center)+f.radius),m=clamp$1(m,800,5e4),this.camera.far!==m&&(this.camera.far=m);var y=m/1e4;y=clamp$1(y,.03,.1),this.camera.near!==y&&(this.camera.near=y)}if(c===!1&&this.models.loaded===!0&&this.emit("models.load",createEvent("models.load",{models:this.models})),h===!1&&this.models.refined===!0&&this.emit("models.refined",createEvent("models.refined",{models:this.models})),this.models.loaded){for(var A=0,M=this.models;A<M.length;A++){var b=M[A];b.parent!==this.modelGroup&&(this.modelGroup.add(b),this.needsRender=!0,this.modelSceneNeedsRender=!0)}if(this.lastModels.length>0){for(var T=0,_=this.lastModels;T<_.length;T++){var b=_[T];this.modelGroup.remove(b),b.dispose(),this.needsRender=!0,this.modelSceneNeedsRender=!0}this.lastModels.length=0}this.lastWorks&&delete this.lastWorks}this.lastModels.setMaterial(this.models.getMaterial()),this.lastModels.materialVersion=this.models.materialVersion,this.lastModels.update(this.renderer,this.camera,this.currentMode)}this.syncingState=!1;var S=new Vector2(512,512),C=new Vector2(512,512);this.renderer&&(this.renderer.getSize(S),S.x*=this.scissor.width,S.y*=this.scissor.height,this.renderer.getDrawingBufferSize(C),C.x*=this.scissor.width,C.y*=this.scissor.height);{for(var P=new Box3,F=new Box3,O=new Vector3(4,4,4),N=0,V=this.works.resolvedObservers;N<V.length;N++){var q=V[N];F.setFromCenterAndSize(q.position,O),P.union(F)}if(P.union(this.models.bounding),this.lastWorks)for(var Q=0,z=this.lastWorks.resolvedObservers;Q<z.length;Q++){var q=z[Q];F.setFromCenterAndSize(q.position,O),P.union(F)}P.union(this.lastModels.bounding),P.getCenter(this.boundingMesh.position),P.getSize(this.boundingMesh.scale),this.boundingMesh.boundingBox.copy(P),this.renderer&&this.model&&this.boundingMesh.update(this.renderer,this.camera,this.model)}var H=createEvent("render.prepare",{needsRender:!0,info:null});if(this.emit("render.prepare",H),!H.defaultPrevented){var W=[];sharedProjScreenMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),sharedFrustum.setFromProjectionMatrix(sharedProjScreenMatrix);for(var J=0,G=this.scene.children;J<G.length;J++){var te=G[J];te!==this.modelGroup&&te!==this.boundingMesh&&te.traverseVisible(function(re){if(re.setResolution&&re.setResolution(S.x,S.y),re.setTime&&re.setTime(r),re.mixer instanceof AnimationMixer){var pe=clockForMixer.get(re.mixer);pe||(pe=new Clock,clockForMixer.set(re.mixer,pe)),re.mixer.update(pe.getDelta())}(re instanceof Mesh||re instanceof Line||re instanceof Points)&&(re instanceof ImmediateRenderObject||!re.frustumCulled||sharedFrustum.intersectsObject(re))&&W.push(re)})}if(C.width*C.height>4096*2048?this.renderSwitch01=this.renderSwitch01^1:this.renderSwitch01=0,this.renderer&&this.paused===!1&&this.renderSwitch01===0){var X=void 0;if(this.onlyRenderIfNeeds!==!0)X=this.render();else{if(this.controller&&(this.controller.needsRender===!0&&(this.controller.needsRender=!1,this.needsRender=!0),this.controller.modelSceneNeedsRender===!0&&(this.controller.modelSceneNeedsRender=!1,this.modelSceneNeedsRender=!0)),this.camera.needsRender===!0&&(this.camera.needsRender=!1,this.needsRender=!0,this.modelSceneNeedsRender=!0),this.models.needsRender===!0&&(this.models.needsRender=!1,this.needsRender=!0,this.modelSceneNeedsRender=!0),this.needsRender!==!0)for(var K=0,Z=W;K<Z.length;K++){var ee=Z[K],j=function(re){re.needsRender===!0?(re.needsRender=!1,s.needsRender=!0):re.mixer&&re.mixer.stats.actions.inUse>0&&(s.needsRender=!0)};j(ee),ee.traverseAncestors(j)}(this.needsRender!==!1||this.modelSceneNeedsRender!==!1)&&(X=this.render())}this.needsRender=!1,this.modelSceneNeedsRender=!1,this.hasListener("render")&&this.emit("render",createEvent("render",{needsRender:X!==void 0,info:this.info}))}this.needsRender=!1,this.modelSceneNeedsRender=!1}this.fps.testTime&&r-this.fps.testTime<1e3?this.fps.testCount++:(this.emit("fps",this.fps.testCount),this.fps.testTime=r,this.fps.testCount=0)}},t.prototype.pause=function(){this.paused=!0,this.renderer&&this.renderer instanceof InternalWebGLRenderer&&this.renderer.clear(!0,!0,!0)},t.prototype.play=function(){this.needsRender=!0,this.modelSceneNeedsRender=!0,this.paused=!1},t.prototype.moveToPano=function(r,n,o){n===void 0&&(n={}),o===void 0&&(o=!0);var s=this,l=s.controller,u=s.renderer;if(!l)return this.throwError(new Error("controller is not initialized.")),Promise.resolve();if(!u)return this.throwError(new Error("renderer is not initialized.")),Promise.resolve();var c=this.works.getResolvedObserver(r);if(!c)return this.throwError(new Error("pano ".concat(JSON.stringify(r)," not existed."))),Promise.resolve();var h={workCode:c.work.workCode,panoIndex:c.panoIndex};return"moveToPano"in l&&typeof l.moveToPano=="function"?l.moveToPano(h,n,o):c&&(this.pano=h,this.once("initAnimation.start",function(f){n.moveStartCallback&&n.moveStartCallback(f.state)}),this.once("initAnimation.end",function(f){n.moveEndCallback&&n.moveEndCallback(f.state)}),this.changeMode(t.Mode.Panorama,n,{effect:n.effect},o)),this.ready()},t.prototype.preloadPano=function(r,n){var o=this;n===void 0&&(n=noop$1);var s=this.works.getResolvedObserver(r);if(!s)return Promise.reject(new Error("Pano ".concat(JSON.stringify(r)," never found")));var l=["right","left","up","down","front","back"],u=now();return Promise.all(l.map(function(c){var h=__assign({key:"pano.".concat(s.panoId,".").concat(c)},pick(o.imageOptions,["size","format","quality","mappings"])),f=s.images[c],m=o.imageOptions.transform?o.imageOptions.transform(f,h):imageURL(f,h);return getFetcher(s.work).preload(m)})).then(function(){var c=now()-u;return n(c),c})},t.prototype.project2d=function(r,n){if(n===void 0&&(n=!1),!this.renderer)return null;if(this.models.length>0&&n){var o=this.camera.position,s=r.clone().sub(o),l=new Raycaster(o,s.clone().normalize());l.params.Points={threshold:.1};var u=this.models.intersectRaycaster(l)[0];if(u&&u.distance+.01<s.length())return null}var c=r.clone().project(this.camera);if(Math.abs(c.z)>1)return null;var h=this.renderer.getSize(new Vector2),f=h.x*this.scissor.width,m=h.y*this.scissor.height,y=h.x*this.scissor.left+(c.x+1)/2*f,A=h.y*(1-this.scissor.bottom-this.scissor.height)+(-c.y+1)/2*m;return new Vector2(y,A)},t.prototype.getRenderObjects=function(r){sharedProjScreenMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),sharedFrustum.setFromProjectionMatrix(sharedProjScreenMatrix),r||(r=this.scene);var n=[];return r.traverseVisible(function(o){(o instanceof Mesh||o instanceof Line||o instanceof Points)&&(o instanceof ImmediateRenderObject||!o.frustumCulled||sharedFrustum.intersectsObject(o))&&n.push(o)}),n},t.prototype.getCurrentState=function(){return __assign(__assign({},this.getPose()),{mode:this.currentMode,workCode:this.pano.workCode,panoIndex:this.pano.panoIndex})},t.prototype.setState=function(r,n,o){var s,l,u,c,h,f,m,y,A,M;n===void 0&&(n=!1),o===void 0&&(o=!0),r=Object.assign({},r),r.offset&&!(r instanceof Vector3)&&(r.offset=new Vector3(r.offset.x,r.offset.y,r.offset.z));var b;if(typeof r.panoIndex=="number")if(r.workCode)b={workCode:r.workCode,panoIndex:r.panoIndex};else{var T=(l=(s=this.work)===null||s===void 0?void 0:s.workCode)!==null&&l!==void 0?l:"",_=this.state.workCode;this.works.filter(function(H){return H.workCode===_}).length>0&&(T=_),b={workCode:T,panoIndex:r.panoIndex}}var S=(u=r.mode)!==null&&u!==void 0?u:this.state.mode,C,P,F,O,N;if(this.controller&&this.controller.stopMomentumMovement(),this.state.mode!==S){if(S==="VRPanorama"){this.changeMode("VRPanorama",void 0,void 0,!0);return}var V={workCode:b==null?void 0:b.workCode,panoIndex:b==null?void 0:b.panoIndex};typeof r.longitude=="number"&&(V.longitude=r.longitude),typeof r.latitude=="number"&&(V.latitude=r.latitude),typeof r.fov=="number"&&(V.fov=r.fov),typeof r.distance=="number"&&(V.distance=r.distance),r.offset instanceof Vector3&&(V.offset=r.offset);var q=__assign(__assign({initial:{state:V,currentState:this.getCurrentState(),duration:this.modeChangeDuration,effect:"fly",userAction:!1}},this.commonParams()),this.controllerInits[S]),Q=Controllers[S].initAnimationEndState(q);C=Q.longitude,P=Q.latitude,F=Q.fov,O=Q.offset,N=Q.distance}else C=(c=r.longitude)!==null&&c!==void 0?c:this.state.longitude,P=(h=r.latitude)!==null&&h!==void 0?h:this.state.latitude,F=(f=r.fov)!==null&&f!==void 0?f:this.state.fov,O=(m=r.offset)!==null&&m!==void 0?m:this.state.offset,N=(y=r.distance)!==null&&y!==void 0?y:this.state.distance;var z={workCode:(b??this.pano).workCode,panoIndex:(b??this.pano).panoIndex,mode:S,longitude:C,latitude:P,fov:F,offset:O,distance:N};this.emit("state.set",createEvent("state.set",{userAction:o,state:z})),stateEqual(this.state,z)||(this.controller&&z.mode==="VRPanorama"&&z.mode!==this.state.mode?(assignState(this.state,z),this.changeMode("VRPanorama")):this.controller&&z.mode==="XRPanorama"&&z.mode!==this.state.mode?(assignState(this.state,z),this.changeMode("XRPanorama")):(assignState(this.state,z),this.controller&&o&&(this.controller.userAction=!1),n&&this.state.mode===z.mode&&(this.syncingState=this.syncState(now(),0,n),this.syncingState&&((A=this.controller)===null||A===void 0||A.updateTime(now(),0),this.syncingState=!1)),this.emit("state.change",createEvent("state.change",{userAction:o,state:this.state})),(M=this.analysis)===null||M===void 0||M.state(this.works,this.state)))},t.prototype.aroundScissor=function(r){if(this.renderer){if(this.state.mode==="XRPanorama"){r();return}var n=new Vector2,o=this.scissor.left!==0||this.scissor.bottom!==0||this.scissor.width!==1||this.scissor.height!==1;if(o){this.renderer.getSize(n);var s=Math.floor(n.x*this.scissor.left),l=Math.floor(n.y*this.scissor.bottom),u=Math.floor(n.x*this.scissor.width),c=Math.floor(n.y*this.scissor.height);this.renderer.setViewport(s,l,u,c),this.renderer.setScissor(s,l,u,c),this.renderer.setScissorTest(!0)}r(),o&&(this.renderer.setViewport(0,0,n.x,n.y),this.renderer.setScissor(0,0,n.x,n.y),this.renderer.setScissorTest(!1))}},t.prototype.syncState=function(r,n,o){o===void 0&&(o=!1);var s=this.stateSynced;if(this.stateSynced=!1,!this.controller)return!1;if(this.state.mode!==this.currentMode){var l={mode:this.state.mode,workCode:this.state.workCode,panoIndex:this.state.panoIndex,longitude:this.state.longitude,latitude:this.state.latitude,fov:this.state.fov,offset:this.state.offset,distance:this.state.distance};return this.changeMode(this.state.mode,l,this.modeChangeDuration,this.controller.userAction),!0}if(!this.controller.isReady())return!1;if(this.controller instanceof Controllers.Model){if(notSimilarVector3(this.camera.pose.offset,this.state.offset)){var u={longitude:this.state.longitude,latitude:this.state.latitude,fov:this.state.fov,offset:this.state.offset};return this.controller.moveToPosition(this.state.offset,__assign(__assign({},u),{duration:o?0:void 0}),!1),!0}}else{var c={workCode:this.state.workCode,panoIndex:this.state.panoIndex};if(!panoEqual(c,this.pano)&&"moveToPano"in this.controller&&typeof this.controller.moveToPano=="function"){var u={longitude:this.state.longitude,latitude:this.state.latitude,fov:this.state.fov,offset:this.state.offset,distance:this.state.distance};return this.controller.moveToPano(c,u,!1),!0}}if(this.controller instanceof Controllers.Floorplan||this.controller instanceof Controllers.Topview||this.controller instanceof Controllers.Mapview){var h=1,f=.2,m=.2,y=Math.PI/45,A=o?this.state.fov:stepNumber(this.camera.pose.fov,this.state.fov,h),M=Math.abs(this.camera.pose.distance-this.state.distance),b=M>m*15?M/15:f,T=o?this.state.distance:stepNumber(this.camera.pose.distance,this.state.distance,b),_=this.camera.pose.offset.distanceTo(this.state.offset),S=_>m*15?_/15:m,C=o?new Vector3().copy(this.state.offset):stepVector(this.camera.pose.offset,this.state.offset,S),P=o?{longitude:this.state.longitude,latitude:this.state.latitude}:stepCoordinates({longitude:this.camera.pose.longitude,latitude:this.camera.pose.latitude},{longitude:this.state.longitude,latitude:this.state.latitude},y),F=P.longitude,O=P.latitude;if(notSimilarValue(A,this.camera.pose.fov)||notSimilarVector3(C,this.camera.pose.offset)||notSimilarValue(T,this.camera.pose.distance)||notSimilarValue(F,this.camera.pose.longitude,Math.PI*2)||notSimilarValue(O,this.camera.pose.latitude)){var N={x:C.x,y:C.y,z:C.z},V={fov:A};return Object.assign(N,{distance:T}),Object.assign(V,{longitude:F,latitude:O}),this.controller.stopMomentumMovement(),this.controller.cameraMotion.set(V,0).catch(noop$1),this.controller.locationMotion.set(N,0).catch(noop$1),!0}}else{var q=1,Q=Math.PI/45,A=o?this.state.fov:stepNumber(this.camera.pose.fov,this.state.fov,q),z=o?{longitude:this.state.longitude,latitude:this.state.latitude}:stepCoordinates({longitude:this.camera.pose.longitude,latitude:this.camera.pose.latitude},{longitude:this.state.longitude,latitude:this.state.latitude},Q),F=z.longitude,O=z.latitude,T=this.state.distance,C=new Vector3().copy(this.state.offset);if(notSimilarValue(T,this.camera.pose.distance)&&(this.state.distance=this.camera.pose.distance),notSimilarVector3(C,this.camera.pose.offset)&&(this.state.offset=this.camera.pose.offset.clone()),notSimilarValue(F,this.camera.pose.longitude,Math.PI*2)||notSimilarValue(O,this.camera.pose.latitude)||notSimilarValue(A,this.camera.pose.fov))return this.controller.stopMomentumMovement(),this.controller.cameraMotion.set({longitude:F,latitude:O,fov:A},0).catch(noop$1),!0}if(this.stateSynced=!0,s===!1&&this.emit("state.synced",createEvent("state.synced",{userAction:!1,state:this.state})),this.readyCallbacks.length&&this.stateSynced){var H=this.currentMode,W=H===t.Mode.Floorplan||H===t.Mode.Topview||H===t.Mode.Mapview||H===t.Mode.Model;if(!W||this.models.loaded){var J=this.readyCallbacks.slice();this.readyCallbacks.length=0;for(var G=0,te=J;G<te.length;G++){var X=te[G];this.controller instanceof Controllers.Panorama&&X.tile===!0&&!this.controller.isTileReady()?this.readyCallbacks.push(X):X()}}}return!1},t.prototype.ready=function(r){var n=this;return r===void 0&&(r={}),new Promise(function(o){var s;n.readyCallbacks.push(Object.assign(o,{tile:(s=r.tile)!==null&&s!==void 0?s:!1}))})},t.prototype.requestFullscreen=function(){var r;if(isMobile){var n=(r=this.getElement())===null||r===void 0?void 0:r.parentNode;n&&"requestFullscreen"in n&&typeof document<"u"&&document.fullscreenElement===null&&n.requestFullscreen()}},t.prototype.exitFullscreen=function(){typeof document<"u"&&document.fullscreenElement&&"exitFullscreen"in document&&document.exitFullscreen()},t.prototype.throwError=function(r){this.hasListener("error")?this.emit("error",r):console.error(r)},t.prototype.loadModel=function(r,n){for(var o=this,s,l,u,c,h,f,m=[],y=function(O){var N=A.models.filter(function(z){var H;return((H=z.work)===null||H===void 0?void 0:H.workCode)===O.workCode})[0];if(N)N.work=O,m.push(N);else{var V=new Model({onError:function(z){o.emit("model.error",createEvent("model.error",{work:O,model:V,error:z})),o.throwError(z)},onShownFloorChange:function(z){o.emit("model.changeShownFloor",createEvent("model.changeShownFloor",{work:O,model:V,error:null}))},onLoad:function(){o.emit("model.load",createEvent("model.load",{work:O,model:V,error:null}))}});m.push(V),A.emit("model.request",createEvent("model.request",{work:O,model:V,error:null}));var q=(u=(l=(s=n.model)===null||s===void 0?void 0:s.textureOptions)!==null&&l!==void 0?l:n.textureOptions)!==null&&u!==void 0?u:A.textureOptions,Q=(h=(c=n.model)===null||c===void 0?void 0:c["3d-tiles"])!==null&&h!==void 0?h:n["3d-tiles"];V.load(O,{light:(f=n.model)===null||f===void 0?void 0:f.light,textureOptions:q,"3d-tiles":Q})}},A=this,M=0,b=r;M<b.length;M++){var T=b[M];y(T)}if(this.models.length>0){for(var _=0,S=this.models;_<S.length;_++){var C=S[_];m.indexOf(C)===-1&&this.lastModels.push(C)}this.models.length=0}for(var P=0,F=m;P<F.length;P++){var C=F[P];this.models.push(C)}return this.renderer&&(this.models.loaded=!1),new Promise(function(O){o.on("models.load",function(){o.controller&&o.controller.updateModel(o.models),O()})})},t.prototype.commonParams=function(){return{ident:this.ident,scene:this.scene,xrCustomObjectsScene:this.xrCustomObjectsScene,helper:this.helperGroup,boundingMesh:this.boundingMesh,camera:this.camera,renderer:this.renderer,scissor:this.scissor,element:this.getElement(),models:this.models,works:this.works,imageOptions:this.imageOptions,enableWheel:this.enableWheel,enableIOSEDR:this._enableIOSEDR,enableEDL:this.enableEDL,enableHQ:this.enableHQ,extraElements:this.extraElements,videoTexture:this.videoTexture,modelScene:this.modelScene,modelRenderTarget:this.modelRenderTarget,enableLayeringRendering:this.enableLayeringRendering}},t.prototype.applyController=function(r,n){var o=this;if(!this.renderer)throw new Error("renderer is not initialized.");r!==t.Mode.Mapview&&(this.enableEDL=!1,this.enableHQ=!1);var s=Controllers[r];this.currentMode=r;for(var l=new s(n),u=function(A){l.on(A,function(){for(var M=[],b=0;b<arguments.length;b++)M[b]=arguments[b];var T=o.emit.apply(o,__spreadArray([A],M,!1));if(T)return!1})},c=0,h=PROXY_CONTROLLER_EVENT_NAMES;c<h.length;c++){var f=h[c];u(f)}{var m=Controllers[r].initAnimationEndState(n),y=n.initial.userAction;stateEqual(this.state,m)||(assignState(this.state,m),this.emit("state.change",createEvent("state.change",{userAction:y,state:this.state}))),this.emit("currentState.change",createEvent("currentState.change",{userAction:y,state:this.getCurrentState()}))}return l.on("camera.update",function(A){var M;if(o.controller){var b=o.controller.getTargetState();A.userAction&&o.syncingState===!1&&o.state.mode===b.mode&&!stateEqual(o.state,b)&&(assignState(o.state,b),o.emit("state.change",createEvent("state.change",{userAction:A.userAction,state:o.state})),(M=o.analysis)===null||M===void 0||M.state(o.works,o.state))}o.emit("currentState.change",createEvent("currentState.change",{userAction:A.userAction,state:o.getCurrentState()}))}),l.on("initAnimation.start",function(A){var M,b=A.state,T=A.userAction;T&&o.state.mode===b.mode&&!stateEqual(o.state,b)&&(assignState(o.state,b),o.emit("state.change",createEvent("state.change",{userAction:T,state:o.state})),(M=o.analysis)===null||M===void 0||M.state(o.works,o.state))}),l.on("initAnimation.end",function(A){var M,b=A.state,T=A.userAction;o.pano={workCode:b.workCode,panoIndex:b.panoIndex},T&&o.state.mode===b.mode&&!stateEqual(o.state,b)&&(assignState(o.state,b),o.emit("state.change",createEvent("state.change",{userAction:T,state:o.state})),(M=o.analysis)===null||M===void 0||M.state(o.works,o.state))}),l.on("pano.moveTo",function(A){var M,b=A.state,T=A.userAction;o.pano={workCode:b.workCode,panoIndex:b.panoIndex},T&&o.state.mode===b.mode&&!stateEqual(o.state,b)&&(assignState(o.state,b),o.emit("state.change",createEvent("state.change",{userAction:T,state:o.state})),(M=o.analysis)===null||M===void 0||M.state(o.works,o.state))}),l.on("pano.arrived",function(A){var M,b=A.state,T=A.userAction;o.pano={workCode:b.workCode,panoIndex:b.panoIndex},T&&o.state.mode===b.mode&&!stateEqual(o.state,b)&&(assignState(o.state,b),o.emit("state.change",createEvent("state.change",{userAction:T,state:o.state})),(M=o.analysis)===null||M===void 0||M.state(o.works,o.state))}),l.on("pano.cancel",function(A){var M,b=A.state,T=A.userAction;T&&o.state.mode===b.mode&&!stateEqual(o.state,b)&&(assignState(o.state,b),o.emit("state.change",createEvent("state.change",{userAction:T,state:o.state})),(M=o.analysis)===null||M===void 0||M.state(o.works,o.state))}),l.on("pano.moveTo",function(A){var M=A.userAction;o.emit("currentState.change",createEvent("currentState.change",{userAction:M,state:o.getCurrentState()}))}),l.on("pano.request",function(A){o.emit("pano.request",A),A.defaultPrevented||o.moveToPano(A.state,A.options,A.userAction)}),l.on("vr.requestExit",function(){o.currentMode===t.Mode.VRPanorama&&(o.exitFullscreen(),o.changeMode(t.Mode.Panorama))}),l.on("error",function(A){return o.throwError(A)}),l},t.prototype.removeEventListeners=function(){},t.prototype.getWorkResources=function(r){var n=this,o,s=this.models.find(function(h){return h.work===r}),l=((o=s==null?void 0:s.viewLayers)!==null&&o!==void 0?o:[]).map(function(h){return h.scene});function u(h){var f=/([0-9a-z\.\_\-]+)([\?\#].*)?$/i.exec(h);if(f){var m=String(f[1]).trim().split(".").slice(1).reverse()[0];if(m)return m}return""}function c(h,f){f===void 0&&(f=0);var m=[];if(h.content&&h.content.uri){var y=u(h.content.uri);if(y==="json"){var A=imageURL(h.content.uri,{key:"model.".concat(f)});m.push({url:A,type:"tileset"})}else if(y==="at3d"&&h.extras[y]){var A=h.content.uri;m.push({url:A,type:"model"});for(var M=h.extras[y],b=M.textureArray,T=M.textureOptions,_=0,S=b;_<S.length;_++){var C=S[_],P=__assign({key:"texture.pbm"},pick(T,["format","quality","size","sharpen","mappings"])),F=applyImageURLOptions(C,T==null?void 0:T.transform,P);m.push({url:F,type:"texture"})}}else{var A=imageURL(h.content.uri,{key:"model.".concat(f)});m.push({url:A,type:"model"})}}if(h.children)for(var O=0;O<h.children.length;O++){var N=h.children[O];m.push.apply(m,c(N,O))}return m}return Promise.all(l.map(function(h){return h.loadAllTilesets()})).then(function(){for(var h=[],f=["right","left","up","down","front","back"],m=0,y=r.observers;m<y.length;m++){for(var A=y[m],M=0,b=f;M<b.length;M++){var T=b[M],_=__assign({key:"pano.".concat(panoStringify(A.pano),".").concat(T)},pick(n.imageOptions,["size","format","quality","mappings"])),S=A.images[T],C=applyImageURLOptions(S,n.imageOptions.transform,_);h.push({url:C,type:"pano"})}if(A.images.tiles)for(var P=0,F=A.images.tiles;P<F.length;P++)for(var O=F[P],N=0,V=f;N<V.length;N++)for(var T=V[N],q=O.size,Q=Math.pow(2,O.level),z=1/Q,H=0;H<Q;H++)for(var W=0;W<Q;W++){var J="".concat(A.panoId,".").concat(T,".").concat(O.level,".").concat(H,".").concat(W),_=__assign(__assign({key:"pano_tile.".concat(J)},pick(n.imageOptions,["format","size","quality","sharpen","mappings"])),{size:O.scale>=1?void 0:q*z*O.scale,cut:z===1?void 0:[q*z*W,q*z*H,q*z,q*z]}),C=applyImageURLOptions(O[T],n.imageOptions.transform,_);h.push({url:C,type:"pano_tile"})}}for(var G=0,te=l;G<te.length;G++){var X=te[G];X.tileset.url&&h.push({url:X.tileset.url,type:"model"}),h.push.apply(h,c(X.tileset.root))}return h})},Object.defineProperty(t.prototype,"internalLightsEnabled",{get:function(){var r=this.scene.children.find(function(n){return n.name==="internalLights"});return r?r.visible:!1},set:function(r){var n=this.scene.children.find(function(o){return o.name==="internalLights"});n&&(n.visible=r),n=this.modelScene.children.find(function(o){return o.name==="internalLights"}),n&&(n.visible=r)},enumerable:!1,configurable:!0}),t.Mode={Panorama:"Panorama",Model:"Model",Floorplan:"Floorplan",Topview:"Topview",Mapview:"Mapview",VRPanorama:"VRPanorama",XRPanorama:"XRPanorama"},t.Line=null,t}(Subscribe),__FIVE_DEBUG__={instances:{},constructor:Five};typeof window<"u"&&Object.assign(window,{__FIVE_DEBUG__});var k=function(e,t){return k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},k(e,t)};function B(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");k(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var g=function(){return g=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},g.apply(this,arguments)},E=[],R=[];function ie(e){var t=e===void 0?{}:e,r=t.backgroundColor,n=r===void 0?1579548:r,o=t.backgroundAlpha,s=o===void 0?1:o,l=t.preserveDrawingBuffer,u=l===void 0?!0:l,c=t.pixelRatio,h=c===void 0?1:c,f=t.webgl2,m=f===void 0?!1:f;if(typeof window<"u"){var y=null;if(m?y=E.shift():y=R.shift(),!y){if(m){var A=document.createElement("canvas"),M=A.getContext("webgl2");M?y=new WebGLRenderer({preserveDrawingBuffer:u,antialias:!0,alpha:!0,stencil:!0,canvas:A,context:M}):(console.error("error occurred when getting webgl2 canvas context, mybe webgl2 not support, fallback to webgl."),y=new WebGLRenderer({preserveDrawingBuffer:u,antialias:!1,alpha:!0,stencil:!0}))}else y=new WebGLRenderer({preserveDrawingBuffer:u,antialias:!1,alpha:!0,stencil:!0});y.outputEncoding=sRGBEncoding}return y.setPixelRatio(h),y.setClearColor(n,s),y.autoClear=!0,y}}function se(e){if(e){var t=e.capabilities.isWebGL2;t?R.indexOf(e)===-1&&R.push(e):E.indexOf(e)===-1&&E.push(e)}}var L=reactExports.createContext(null);function p(){var e=reactExports.useContext(L);if(!e)throw new Error("FiveProvider never found.");return e.five}function ce(e,t){var r=Array.isArray(e)?e:[e],n=Array.isArray(t)?t:[t];if(r.length!==n.length)return!1;for(var o=0;o<r.length;o++)if(r[o].workCode!==n[o].workCode)return!1;return!0}function Ge(e){return e===void 0&&(e={}),function(t){B(r,t);function r(n){var o=t.call(this,n)||this;return o.__fiveEventDisposers=[],o.__fiveDisposeTimer=null,o.five=new Five(g(g({},e),{renderer:void 0})),o.loadWork=o.loadWork.bind(o),o.state={},o}return r.prototype.loadWork=function(n,o,s,l){if(l===void 0&&(l=!0),this.props.work)throw new Error("props 'works' is set in fiveProvider, if you need modify work internal, use 'initialWork' instead.");return this.five.load(n,o,s,l)},r.prototype.shouldComponentUpdate=function(n){return this.five.renderer&&this.five&&n.work&&!ce(n.work,this.five.works)&&this.five.load(n.work,n.initialState,n.initialOptions),!0},r.prototype.componentDidMount=function(){var n=this,o;clearTimeout(this.__fiveDisposeTimer),this.__fiveDisposeTimer=null;var s;if(typeof window<"u"){var l=getViewportScale(),u=l===1?window.devicePixelRatio:1;s=ie({pixelRatio:u,backgroundAlpha:e.backgroundAlpha,backgroundColor:e.backgroundColor,webgl2:e==null?void 0:e.webgl2,preserveDrawingBuffer:e==null?void 0:e.preserveDrawingBuffer})}this.five.renderer=s,this.setState({renderer:s}),this.__fiveEventDisposers.push(this.five.on("load",function(){n.props.onWorksChange&&n.props.onWorksChange(n.five.works)})),this.__fiveEventDisposers.push(this.five.on("stateChange",function(h,f){n.props.onStateChange&&n.props.onStateChange(h,f)})),this.__fiveEventDisposers.push(this.five.on("currentStateChange",function(h,f){n.props.onCurrentStateChange&&n.props.onCurrentStateChange(h,f)})),this.__fiveEventDisposers.push(this.five.on("error",function(h){n.props.onError?n.props.onError(h):console.warn(h.message)}));var c=this.props.work||this.props.initialWork;c&&this.five.load(c,this.props.initialState,this.props.initialOptions,(o=this.props.initialUserAction)!==null&&o!==void 0?o:!0)},r.prototype.componentWillUnmount=function(){var n=this,o;(o=this.five.controller)===null||o===void 0||o.destroy();var s=this.five.renderer;this.five.renderer=void 0,se(s),this.setState({renderer:void 0}),this.__fiveDisposeTimer=setTimeout(function(){n.__fiveDisposeTimer=null,n.five.dispose()},1e3)},r.prototype.render=function(){var n=this.five,o=this.loadWork,s=this.state.renderer;return reactExports.createElement(L.Provider,{value:{renderer:s,five:n,loadWork:o}},this.props.children)},r}(reactExports.Component)}var fe=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,le={display:"inline-block",overflow:"hidden"},Ae=function(e){var t=e.width,r=e.height,n=p(),o=reactExports.createRef(),s=g({width:t,height:r},le);return fe(function(){var l=o.current;if(l&&n.renderer){var u=n.renderer.domElement;if(u.parentNode!==null&&u.parentNode!==l)throw new Error("There are more than 2 fiveCanvas in this context.");return u.parentNode!==l&&l.appendChild(u),n.camera.aspect=t/r,n.camera.updateProjectionMatrix(),n.renderer.setSize(t,r),n.refresh({width:t,height:r}),n.needsRender=!0,function(){u.parentNode===l&&l.removeChild(u)}}},[n,n.renderer,t,r,o.current]),reactExports.createElement("div",{ref:o,style:s})};function Ie(){return p()}function asyncGeneratorStep(e,t,r,n,o,s,l){try{var u=e[s](l),c=u.value}catch(h){r(h);return}u.done?t(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var s=e.apply(t,r);function l(c){asyncGeneratorStep(s,n,o,l,u,"next",c)}function u(c){asyncGeneratorStep(s,n,o,l,u,"throw",c)}l(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},_setPrototypeOf(e,t)}function _inherits(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(e)}function _assertThisInitialized(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){if(t&&(_typeof(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},_getPrototypeOf(e)}var runtime={exports:{}},hasRequiredRuntime;function requireRuntime(){return hasRequiredRuntime||(hasRequiredRuntime=1,function(e){var t=function(r){var n=Object.prototype,o=n.hasOwnProperty,s,l=typeof Symbol=="function"?Symbol:{},u=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",h=l.toStringTag||"@@toStringTag";function f(K,Z,ee){return Object.defineProperty(K,Z,{value:ee,enumerable:!0,configurable:!0,writable:!0}),K[Z]}try{f({},"")}catch{f=function(Z,ee,j){return Z[ee]=j}}function m(K,Z,ee,j){var re=Z&&Z.prototype instanceof S?Z:S,pe=Object.create(re.prototype),ge=new G(j||[]);return pe._invoke=z(K,ee,ge),pe}r.wrap=m;function y(K,Z,ee){try{return{type:"normal",arg:K.call(Z,ee)}}catch(j){return{type:"throw",arg:j}}}var A="suspendedStart",M="suspendedYield",b="executing",T="completed",_={};function S(){}function C(){}function P(){}var F={};f(F,u,function(){return this});var O=Object.getPrototypeOf,N=O&&O(O(te([])));N&&N!==n&&o.call(N,u)&&(F=N);var V=P.prototype=S.prototype=Object.create(F);C.prototype=P,f(V,"constructor",P),f(P,"constructor",C),C.displayName=f(P,h,"GeneratorFunction");function q(K){["next","throw","return"].forEach(function(Z){f(K,Z,function(ee){return this._invoke(Z,ee)})})}r.isGeneratorFunction=function(K){var Z=typeof K=="function"&&K.constructor;return Z?Z===C||(Z.displayName||Z.name)==="GeneratorFunction":!1},r.mark=function(K){return Object.setPrototypeOf?Object.setPrototypeOf(K,P):(K.__proto__=P,f(K,h,"GeneratorFunction")),K.prototype=Object.create(V),K},r.awrap=function(K){return{__await:K}};function Q(K,Z){function ee(pe,ge,_e,he){var Fe=y(K[pe],K,ge);if(Fe.type==="throw")he(Fe.arg);else{var Re=Fe.arg,Le=Re.value;return Le&&typeof Le=="object"&&o.call(Le,"__await")?Z.resolve(Le.__await).then(function(Se){ee("next",Se,_e,he)},function(Se){ee("throw",Se,_e,he)}):Z.resolve(Le).then(function(Se){Re.value=Se,_e(Re)},function(Se){return ee("throw",Se,_e,he)})}}var j;function re(pe,ge){function _e(){return new Z(function(he,Fe){ee(pe,ge,he,Fe)})}return j=j?j.then(_e,_e):_e()}this._invoke=re}q(Q.prototype),f(Q.prototype,c,function(){return this}),r.AsyncIterator=Q,r.async=function(K,Z,ee,j,re){re===void 0&&(re=Promise);var pe=new Q(m(K,Z,ee,j),re);return r.isGeneratorFunction(Z)?pe:pe.next().then(function(ge){return ge.done?ge.value:pe.next()})};function z(K,Z,ee){var j=A;return function(pe,ge){if(j===b)throw new Error("Generator is already running");if(j===T){if(pe==="throw")throw ge;return X()}for(ee.method=pe,ee.arg=ge;;){var _e=ee.delegate;if(_e){var he=H(_e,ee);if(he){if(he===_)continue;return he}}if(ee.method==="next")ee.sent=ee._sent=ee.arg;else if(ee.method==="throw"){if(j===A)throw j=T,ee.arg;ee.dispatchException(ee.arg)}else ee.method==="return"&&ee.abrupt("return",ee.arg);j=b;var Fe=y(K,Z,ee);if(Fe.type==="normal"){if(j=ee.done?T:M,Fe.arg===_)continue;return{value:Fe.arg,done:ee.done}}else Fe.type==="throw"&&(j=T,ee.method="throw",ee.arg=Fe.arg)}}}function H(K,Z){var ee=K.iterator[Z.method];if(ee===s){if(Z.delegate=null,Z.method==="throw"){if(K.iterator.return&&(Z.method="return",Z.arg=s,H(K,Z),Z.method==="throw"))return _;Z.method="throw",Z.arg=new TypeError("The iterator does not provide a 'throw' method")}return _}var j=y(ee,K.iterator,Z.arg);if(j.type==="throw")return Z.method="throw",Z.arg=j.arg,Z.delegate=null,_;var re=j.arg;if(!re)return Z.method="throw",Z.arg=new TypeError("iterator result is not an object"),Z.delegate=null,_;if(re.done)Z[K.resultName]=re.value,Z.next=K.nextLoc,Z.method!=="return"&&(Z.method="next",Z.arg=s);else return re;return Z.delegate=null,_}q(V),f(V,h,"Generator"),f(V,u,function(){return this}),f(V,"toString",function(){return"[object Generator]"});function W(K){var Z={tryLoc:K[0]};1 in K&&(Z.catchLoc=K[1]),2 in K&&(Z.finallyLoc=K[2],Z.afterLoc=K[3]),this.tryEntries.push(Z)}function J(K){var Z=K.completion||{};Z.type="normal",delete Z.arg,K.completion=Z}function G(K){this.tryEntries=[{tryLoc:"root"}],K.forEach(W,this),this.reset(!0)}r.keys=function(K){var Z=[];for(var ee in K)Z.push(ee);return Z.reverse(),function j(){for(;Z.length;){var re=Z.pop();if(re in K)return j.value=re,j.done=!1,j}return j.done=!0,j}};function te(K){if(K){var Z=K[u];if(Z)return Z.call(K);if(typeof K.next=="function")return K;if(!isNaN(K.length)){var ee=-1,j=function re(){for(;++ee<K.length;)if(o.call(K,ee))return re.value=K[ee],re.done=!1,re;return re.value=s,re.done=!0,re};return j.next=j}}return{next:X}}r.values=te;function X(){return{value:s,done:!0}}return G.prototype={constructor:G,reset:function(K){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(J),!K)for(var Z in this)Z.charAt(0)==="t"&&o.call(this,Z)&&!isNaN(+Z.slice(1))&&(this[Z]=s)},stop:function(){this.done=!0;var K=this.tryEntries[0],Z=K.completion;if(Z.type==="throw")throw Z.arg;return this.rval},dispatchException:function(K){if(this.done)throw K;var Z=this;function ee(he,Fe){return pe.type="throw",pe.arg=K,Z.next=he,Fe&&(Z.method="next",Z.arg=s),!!Fe}for(var j=this.tryEntries.length-1;j>=0;--j){var re=this.tryEntries[j],pe=re.completion;if(re.tryLoc==="root")return ee("end");if(re.tryLoc<=this.prev){var ge=o.call(re,"catchLoc"),_e=o.call(re,"finallyLoc");if(ge&&_e){if(this.prev<re.catchLoc)return ee(re.catchLoc,!0);if(this.prev<re.finallyLoc)return ee(re.finallyLoc)}else if(ge){if(this.prev<re.catchLoc)return ee(re.catchLoc,!0)}else if(_e){if(this.prev<re.finallyLoc)return ee(re.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(K,Z){for(var ee=this.tryEntries.length-1;ee>=0;--ee){var j=this.tryEntries[ee];if(j.tryLoc<=this.prev&&o.call(j,"finallyLoc")&&this.prev<j.finallyLoc){var re=j;break}}re&&(K==="break"||K==="continue")&&re.tryLoc<=Z&&Z<=re.finallyLoc&&(re=null);var pe=re?re.completion:{};return pe.type=K,pe.arg=Z,re?(this.method="next",this.next=re.finallyLoc,_):this.complete(pe)},complete:function(K,Z){if(K.type==="throw")throw K.arg;return K.type==="break"||K.type==="continue"?this.next=K.arg:K.type==="return"?(this.rval=this.arg=K.arg,this.method="return",this.next="end"):K.type==="normal"&&Z&&(this.next=Z),_},finish:function(K){for(var Z=this.tryEntries.length-1;Z>=0;--Z){var ee=this.tryEntries[Z];if(ee.finallyLoc===K)return this.complete(ee.completion,ee.afterLoc),J(ee),_}},catch:function(K){for(var Z=this.tryEntries.length-1;Z>=0;--Z){var ee=this.tryEntries[Z];if(ee.tryLoc===K){var j=ee.completion;if(j.type==="throw"){var re=j.arg;J(ee)}return re}}throw new Error("illegal catch attempt")},delegateYield:function(K,Z,ee){return this.delegate={iterator:te(K),resultName:Z,nextLoc:ee},this.method==="next"&&(this.arg=s),_}},r}(e.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(runtime)),runtime.exports}var regenerator,hasRequiredRegenerator;function requireRegenerator(){return hasRequiredRegenerator||(hasRequiredRegenerator=1,regenerator=requireRuntime()),regenerator}var regeneratorExports=requireRegenerator();const _regeneratorRuntime=getDefaultExportFromCjs(regeneratorExports);function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _requestAnimationFrame=window.requestAnimationFrame||function(e){return setTimeout(function(){return e(performance.now())},16)},_cancelAnimationFrame=window.cancelAnimationFrame||clearTimeout;function requestAnimationFrameInterval(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:60,r=-1,n=0,o=-1,s=1e3/t;function l(u){o===-1&&(o=u),r=_requestAnimationFrame(l);var c=u-n;c<s||(n=u,e&&e(u-o))}return r=_requestAnimationFrame(l),function(){_cancelAnimationFrame(r)}}var VreoKeyframeEnum;(function(e){e.CameraMovement="CameraMovement",e.PanoTag="PanoTag",e.PanoTextLabel="PanoTextLabel",e.Prompter="Prompter",e.UpdateVRPanorama="UpdateVRPanorama",e.ModelVideo="ModelVideo",e.PanoEffect="PanoEffect",e.InfoPanel="InfoPanel",e.VideoEffect="VideoEffect",e.BgMusic="BgMusic",e.Exit="Exit",e.Custom="Custom"})(VreoKeyframeEnum||(VreoKeyframeEnum={}));var PanoTagEnum;(function(e){e.Text="Text",e.Image="Image"})(PanoTagEnum||(PanoTagEnum={}));var PanoTagStyleEnum;(function(e){e.Growth="Growth",e.Expand="Expand"})(PanoTagStyleEnum||(PanoTagStyleEnum={}));var PanoEffectEnum;(function(e){e.Distance="Distance"})(PanoEffectEnum||(PanoEffectEnum={}));var InfoPanelTypeEnum;(function(e){e.Image="Image",e.Video="Video"})(InfoPanelTypeEnum||(InfoPanelTypeEnum={}));var InfoPanelStyleEnum;(function(e){e.Drawer="Drawer",e.PopUp="PopUp"})(InfoPanelStyleEnum||(InfoPanelStyleEnum={}));export{PointsMaterial as $,Ae as A,BufferGeometry as B,InstancedInterleavedBuffer as C,DoubleSide as D,InterleavedBufferAttribute as E,Five as F,Ge as G,Geometry as H,Ie as I,Sphere as J,UniformsLib as K,LinearFilter as L,MeshBasicMaterial as M,Vector2 as N,Vector4 as O,Line3 as P,MathUtils as Q,ReactDOM as R,Subscribe as S,TextureLoader$1 as T,UniformsUtils as U,VreoKeyframeEnum as V,WireframeGeometry as W,Float32BufferAttribute as X,InstancedBufferGeometry as Y,ShaderMaterial as Z,_inherits as _,Vector3 as a,NearestMipmapNearestFilter as a$,Points as a0,Object3D as a1,Color as a2,Quaternion as a3,PlaneGeometry as a4,Scene$1 as a5,Group as a6,EdgesGeometry as a7,CircleGeometry as a8,DstAlphaFactor as a9,Texture as aA,RepeatWrapping as aB,ClampToEdgeWrapping as aC,Uint16BufferAttribute as aD,Matrix3 as aE,NumberKeyframeTrack as aF,Euler as aG,QuaternionKeyframeTrack as aH,VectorKeyframeTrack as aI,AnimationClip as aJ,PointLight as aK,SpotLight as aL,DirectionalLight as aM,OrthographicCamera as aN,PerspectiveCamera as aO,NearestFilter as aP,OneMinusSrcAlphaFactor as aQ,OneFactor as aR,MeshPhysicalMaterial as aS,MeshStandardMaterial as aT,TangentSpaceNormalMap as aU,Interpolant as aV,InterleavedBuffer as aW,RGBAFormat as aX,LinearMipmapLinearFilter as aY,NearestMipmapLinearFilter as aZ,LinearMipmapNearestFilter as a_,SrcAlphaFactor as aa,DstColorFactor as ab,AddEquation as ac,CustomBlending as ad,RingGeometry as ae,CurvePath as af,LineCurve3 as ag,TubeGeometry as ah,SphereGeometry as ai,Face3 as aj,Plane as ak,sRGBEncoding as al,Curve as am,Loader as an,LoaderUtils as ao,FileLoader as ap,AmbientLight as aq,Skeleton as ar,LineBasicMaterial as as,Line as at,MeshPhongMaterial as au,SkinnedMesh as av,Bone as aw,PropertyBinding as ax,EquirectangularReflectionMapping as ay,MeshLambertMaterial as az,Raycaster as b,MirroredRepeatWrapping as b0,Material as b1,LineSegments as b2,LineLoop as b3,InterpolateDiscrete as b4,InterpolateLinear as b5,CompressedTextureLoader as b6,RGB_ETC1_Format as b7,RGBA_S3TC_DXT5_Format as b8,RGBA_S3TC_DXT3_Format as b9,RGB_S3TC_DXT1_Format as ba,AnimationMixer as bb,FrontSide as bc,TriangleFanDrawMode as bd,TriangleStripDrawMode as be,BoxGeometry as bf,ConeGeometry as bg,CylinderGeometry as bh,WebGLRenderer as bi,React as c,reactDomExports as d,_classCallCheck as e,_defineProperty as f,getDefaultExportFromCjs as g,_assertThisInitialized as h,_createClass as i,jsxRuntimeExports as j,requestAnimationFrameInterval as k,_getPrototypeOf as l,_possibleConstructorReturn as m,_asyncToGenerator as n,_regeneratorRuntime as o,parseWork as p,InfoPanelStyleEnum as q,reactExports as r,InfoPanelTypeEnum as s,BufferAttribute as t,Mesh as u,RGBFormat as v,VideoTexture as w,_setPrototypeOf as x,Matrix4 as y,Box3 as z};
